function KR(i,n){for(var a=0;a<n.length;a++){const d=n[a];if(typeof d!="string"&&!Array.isArray(d)){for(const y in d)if(y!=="default"&&!(y in i)){const v=Object.getOwnPropertyDescriptor(d,y);v&&Object.defineProperty(i,y,v.get?v:{enumerable:!0,get:()=>d[y]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const v of y)if(v.type==="childList")for(const C of v.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&d(C)}).observe(document,{childList:!0,subtree:!0});function a(y){const v={};return y.integrity&&(v.integrity=y.integrity),y.referrerPolicy&&(v.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?v.credentials="include":y.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function d(y){if(y.ep)return;y.ep=!0;const v=a(y);fetch(y.href,v)}})();function J0(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function YR(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var n=i.default;if(typeof n=="function"){var a=function d(){var y=!1;try{y=this instanceof d}catch{}return y?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(i).forEach(function(d){var y=Object.getOwnPropertyDescriptor(i,d);Object.defineProperty(a,d,y.get?y:{enumerable:!0,get:function(){return i[d]}})}),a}var mS={exports:{}},yx={},gS={exports:{}},Xi={};var bk;function gU(){if(bk)return Xi;bk=1;var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),C=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),L=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),W=Symbol.iterator;function X(ze){return ze===null||typeof ze!="object"?null:(ze=W&&ze[W]||ze["@@iterator"],typeof ze=="function"?ze:null)}var ee={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},he=Object.assign,se={};function oe(ze,It,xr){this.props=ze,this.context=It,this.refs=se,this.updater=xr||ee}oe.prototype.isReactComponent={},oe.prototype.setState=function(ze,It){if(typeof ze!="object"&&typeof ze!="function"&&ze!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ze,It,"setState")},oe.prototype.forceUpdate=function(ze){this.updater.enqueueForceUpdate(this,ze,"forceUpdate")};function ve(){}ve.prototype=oe.prototype;function me(ze,It,xr){this.props=ze,this.context=It,this.refs=se,this.updater=xr||ee}var Se=me.prototype=new ve;Se.constructor=me,he(Se,oe.prototype),Se.isPureReactComponent=!0;var Re=Array.isArray,Be=Object.prototype.hasOwnProperty,rt={current:null},We={key:!0,ref:!0,__self:!0,__source:!0};function Ct(ze,It,xr){var Lr,yn={},Yr=null,Zr=null;if(It!=null)for(Lr in It.ref!==void 0&&(Zr=It.ref),It.key!==void 0&&(Yr=""+It.key),It)Be.call(It,Lr)&&!We.hasOwnProperty(Lr)&&(yn[Lr]=It[Lr]);var Qr=arguments.length-2;if(Qr===1)yn.children=xr;else if(1<Qr){for(var ir=Array(Qr),Hr=0;Hr<Qr;Hr++)ir[Hr]=arguments[Hr+2];yn.children=ir}if(ze&&ze.defaultProps)for(Lr in Qr=ze.defaultProps,Qr)yn[Lr]===void 0&&(yn[Lr]=Qr[Lr]);return{$$typeof:i,type:ze,key:Yr,ref:Zr,props:yn,_owner:rt.current}}function Ht(ze,It){return{$$typeof:i,type:ze.type,key:It,ref:ze.ref,props:ze.props,_owner:ze._owner}}function Zt(ze){return typeof ze=="object"&&ze!==null&&ze.$$typeof===i}function rr(ze){var It={"=":"=0",":":"=2"};return"$"+ze.replace(/[=:]/g,function(xr){return It[xr]})}var $t=/\/+/g;function Rt(ze,It){return typeof ze=="object"&&ze!==null&&ze.key!=null?rr(""+ze.key):It.toString(36)}function Gt(ze,It,xr,Lr,yn){var Yr=typeof ze;(Yr==="undefined"||Yr==="boolean")&&(ze=null);var Zr=!1;if(ze===null)Zr=!0;else switch(Yr){case"string":case"number":Zr=!0;break;case"object":switch(ze.$$typeof){case i:case n:Zr=!0}}if(Zr)return Zr=ze,yn=yn(Zr),ze=Lr===""?"."+Rt(Zr,0):Lr,Re(yn)?(xr="",ze!=null&&(xr=ze.replace($t,"$&/")+"/"),Gt(yn,It,xr,"",function(Hr){return Hr})):yn!=null&&(Zt(yn)&&(yn=Ht(yn,xr+(!yn.key||Zr&&Zr.key===yn.key?"":(""+yn.key).replace($t,"$&/")+"/")+ze)),It.push(yn)),1;if(Zr=0,Lr=Lr===""?".":Lr+":",Re(ze))for(var Qr=0;Qr<ze.length;Qr++){Yr=ze[Qr];var ir=Lr+Rt(Yr,Qr);Zr+=Gt(Yr,It,xr,ir,yn)}else if(ir=X(ze),typeof ir=="function")for(ze=ir.call(ze),Qr=0;!(Yr=ze.next()).done;)Yr=Yr.value,ir=Lr+Rt(Yr,Qr++),Zr+=Gt(Yr,It,xr,ir,yn);else if(Yr==="object")throw It=String(ze),Error("Objects are not valid as a React child (found: "+(It==="[object Object]"?"object with keys {"+Object.keys(ze).join(", ")+"}":It)+"). If you meant to render a collection of children, use an array instead.");return Zr}function Ar(ze,It,xr){if(ze==null)return ze;var Lr=[],yn=0;return Gt(ze,Lr,"","",function(Yr){return It.call(xr,Yr,yn++)}),Lr}function Ut(ze){if(ze._status===-1){var It=ze._result;It=It(),It.then(function(xr){(ze._status===0||ze._status===-1)&&(ze._status=1,ze._result=xr)},function(xr){(ze._status===0||ze._status===-1)&&(ze._status=2,ze._result=xr)}),ze._status===-1&&(ze._status=0,ze._result=It)}if(ze._status===1)return ze._result.default;throw ze._result}var Xt={current:null},ut={transition:null},Mt={ReactCurrentDispatcher:Xt,ReactCurrentBatchConfig:ut,ReactCurrentOwner:rt};function Qt(){throw Error("act(...) is not supported in production builds of React.")}return Xi.Children={map:Ar,forEach:function(ze,It,xr){Ar(ze,function(){It.apply(this,arguments)},xr)},count:function(ze){var It=0;return Ar(ze,function(){It++}),It},toArray:function(ze){return Ar(ze,function(It){return It})||[]},only:function(ze){if(!Zt(ze))throw Error("React.Children.only expected to receive a single React element child.");return ze}},Xi.Component=oe,Xi.Fragment=a,Xi.Profiler=y,Xi.PureComponent=me,Xi.StrictMode=d,Xi.Suspense=M,Xi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mt,Xi.act=Qt,Xi.cloneElement=function(ze,It,xr){if(ze==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ze+".");var Lr=he({},ze.props),yn=ze.key,Yr=ze.ref,Zr=ze._owner;if(It!=null){if(It.ref!==void 0&&(Yr=It.ref,Zr=rt.current),It.key!==void 0&&(yn=""+It.key),ze.type&&ze.type.defaultProps)var Qr=ze.type.defaultProps;for(ir in It)Be.call(It,ir)&&!We.hasOwnProperty(ir)&&(Lr[ir]=It[ir]===void 0&&Qr!==void 0?Qr[ir]:It[ir])}var ir=arguments.length-2;if(ir===1)Lr.children=xr;else if(1<ir){Qr=Array(ir);for(var Hr=0;Hr<ir;Hr++)Qr[Hr]=arguments[Hr+2];Lr.children=Qr}return{$$typeof:i,type:ze.type,key:yn,ref:Yr,props:Lr,_owner:Zr}},Xi.createContext=function(ze){return ze={$$typeof:C,_currentValue:ze,_currentValue2:ze,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ze.Provider={$$typeof:v,_context:ze},ze.Consumer=ze},Xi.createElement=Ct,Xi.createFactory=function(ze){var It=Ct.bind(null,ze);return It.type=ze,It},Xi.createRef=function(){return{current:null}},Xi.forwardRef=function(ze){return{$$typeof:s,render:ze}},Xi.isValidElement=Zt,Xi.lazy=function(ze){return{$$typeof:F,_payload:{_status:-1,_result:ze},_init:Ut}},Xi.memo=function(ze,It){return{$$typeof:L,type:ze,compare:It===void 0?null:It}},Xi.startTransition=function(ze){var It=ut.transition;ut.transition={};try{ze()}finally{ut.transition=It}},Xi.unstable_act=Qt,Xi.useCallback=function(ze,It){return Xt.current.useCallback(ze,It)},Xi.useContext=function(ze){return Xt.current.useContext(ze)},Xi.useDebugValue=function(){},Xi.useDeferredValue=function(ze){return Xt.current.useDeferredValue(ze)},Xi.useEffect=function(ze,It){return Xt.current.useEffect(ze,It)},Xi.useId=function(){return Xt.current.useId()},Xi.useImperativeHandle=function(ze,It,xr){return Xt.current.useImperativeHandle(ze,It,xr)},Xi.useInsertionEffect=function(ze,It){return Xt.current.useInsertionEffect(ze,It)},Xi.useLayoutEffect=function(ze,It){return Xt.current.useLayoutEffect(ze,It)},Xi.useMemo=function(ze,It){return Xt.current.useMemo(ze,It)},Xi.useReducer=function(ze,It,xr){return Xt.current.useReducer(ze,It,xr)},Xi.useRef=function(ze){return Xt.current.useRef(ze)},Xi.useState=function(ze){return Xt.current.useState(ze)},Xi.useSyncExternalStore=function(ze,It,xr){return Xt.current.useSyncExternalStore(ze,It,xr)},Xi.useTransition=function(){return Xt.current.useTransition()},Xi.version="18.3.1",Xi}var wk;function ew(){return wk||(wk=1,gS.exports=gU()),gS.exports}var Sk;function yU(){if(Sk)return yx;Sk=1;var i=ew(),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,y=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v={key:!0,ref:!0,__self:!0,__source:!0};function C(s,M,L){var F,W={},X=null,ee=null;L!==void 0&&(X=""+L),M.key!==void 0&&(X=""+M.key),M.ref!==void 0&&(ee=M.ref);for(F in M)d.call(M,F)&&!v.hasOwnProperty(F)&&(W[F]=M[F]);if(s&&s.defaultProps)for(F in M=s.defaultProps,M)W[F]===void 0&&(W[F]=M[F]);return{$$typeof:n,type:s,key:X,ref:ee,props:W,_owner:y.current}}return yx.Fragment=a,yx.jsx=C,yx.jsxs=C,yx}var Tk;function _U(){return Tk||(Tk=1,mS.exports=yU()),mS.exports}var h=_U(),Mb={},yS={exports:{}},yc={},_S={exports:{}},xS={};var Ek;function xU(){return Ek||(Ek=1,(function(i){function n(ut,Mt){var Qt=ut.length;ut.push(Mt);e:for(;0<Qt;){var ze=Qt-1>>>1,It=ut[ze];if(0<y(It,Mt))ut[ze]=Mt,ut[Qt]=It,Qt=ze;else break e}}function a(ut){return ut.length===0?null:ut[0]}function d(ut){if(ut.length===0)return null;var Mt=ut[0],Qt=ut.pop();if(Qt!==Mt){ut[0]=Qt;e:for(var ze=0,It=ut.length,xr=It>>>1;ze<xr;){var Lr=2*(ze+1)-1,yn=ut[Lr],Yr=Lr+1,Zr=ut[Yr];if(0>y(yn,Qt))Yr<It&&0>y(Zr,yn)?(ut[ze]=Zr,ut[Yr]=Qt,ze=Yr):(ut[ze]=yn,ut[Lr]=Qt,ze=Lr);else if(Yr<It&&0>y(Zr,Qt))ut[ze]=Zr,ut[Yr]=Qt,ze=Yr;else break e}}return Mt}function y(ut,Mt){var Qt=ut.sortIndex-Mt.sortIndex;return Qt!==0?Qt:ut.id-Mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;i.unstable_now=function(){return v.now()}}else{var C=Date,s=C.now();i.unstable_now=function(){return C.now()-s}}var M=[],L=[],F=1,W=null,X=3,ee=!1,he=!1,se=!1,oe=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,me=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Se(ut){for(var Mt=a(L);Mt!==null;){if(Mt.callback===null)d(L);else if(Mt.startTime<=ut)d(L),Mt.sortIndex=Mt.expirationTime,n(M,Mt);else break;Mt=a(L)}}function Re(ut){if(se=!1,Se(ut),!he)if(a(M)!==null)he=!0,Ut(Be);else{var Mt=a(L);Mt!==null&&Xt(Re,Mt.startTime-ut)}}function Be(ut,Mt){he=!1,se&&(se=!1,ve(Ct),Ct=-1),ee=!0;var Qt=X;try{for(Se(Mt),W=a(M);W!==null&&(!(W.expirationTime>Mt)||ut&&!rr());){var ze=W.callback;if(typeof ze=="function"){W.callback=null,X=W.priorityLevel;var It=ze(W.expirationTime<=Mt);Mt=i.unstable_now(),typeof It=="function"?W.callback=It:W===a(M)&&d(M),Se(Mt)}else d(M);W=a(M)}if(W!==null)var xr=!0;else{var Lr=a(L);Lr!==null&&Xt(Re,Lr.startTime-Mt),xr=!1}return xr}finally{W=null,X=Qt,ee=!1}}var rt=!1,We=null,Ct=-1,Ht=5,Zt=-1;function rr(){return!(i.unstable_now()-Zt<Ht)}function $t(){if(We!==null){var ut=i.unstable_now();Zt=ut;var Mt=!0;try{Mt=We(!0,ut)}finally{Mt?Rt():(rt=!1,We=null)}}else rt=!1}var Rt;if(typeof me=="function")Rt=function(){me($t)};else if(typeof MessageChannel<"u"){var Gt=new MessageChannel,Ar=Gt.port2;Gt.port1.onmessage=$t,Rt=function(){Ar.postMessage(null)}}else Rt=function(){oe($t,0)};function Ut(ut){We=ut,rt||(rt=!0,Rt())}function Xt(ut,Mt){Ct=oe(function(){ut(i.unstable_now())},Mt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ut){ut.callback=null},i.unstable_continueExecution=function(){he||ee||(he=!0,Ut(Be))},i.unstable_forceFrameRate=function(ut){0>ut||125<ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ht=0<ut?Math.floor(1e3/ut):5},i.unstable_getCurrentPriorityLevel=function(){return X},i.unstable_getFirstCallbackNode=function(){return a(M)},i.unstable_next=function(ut){switch(X){case 1:case 2:case 3:var Mt=3;break;default:Mt=X}var Qt=X;X=Mt;try{return ut()}finally{X=Qt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ut,Mt){switch(ut){case 1:case 2:case 3:case 4:case 5:break;default:ut=3}var Qt=X;X=ut;try{return Mt()}finally{X=Qt}},i.unstable_scheduleCallback=function(ut,Mt,Qt){var ze=i.unstable_now();switch(typeof Qt=="object"&&Qt!==null?(Qt=Qt.delay,Qt=typeof Qt=="number"&&0<Qt?ze+Qt:ze):Qt=ze,ut){case 1:var It=-1;break;case 2:It=250;break;case 5:It=1073741823;break;case 4:It=1e4;break;default:It=5e3}return It=Qt+It,ut={id:F++,callback:Mt,priorityLevel:ut,startTime:Qt,expirationTime:It,sortIndex:-1},Qt>ze?(ut.sortIndex=Qt,n(L,ut),a(M)===null&&ut===a(L)&&(se?(ve(Ct),Ct=-1):se=!0,Xt(Re,Qt-ze))):(ut.sortIndex=It,n(M,ut),he||ee||(he=!0,Ut(Be))),ut},i.unstable_shouldYield=rr,i.unstable_wrapCallback=function(ut){var Mt=X;return function(){var Qt=X;X=Mt;try{return ut.apply(this,arguments)}finally{X=Qt}}}})(xS)),xS}var Ck;function vU(){return Ck||(Ck=1,_S.exports=xU()),_S.exports}var Ak;function bU(){if(Ak)return yc;Ak=1;var i=ew(),n=vU();function a(_){for(var w="https://reactjs.org/docs/error-decoder.html?invariant="+_,P=1;P<arguments.length;P++)w+="&args[]="+encodeURIComponent(arguments[P]);return"Minified React error #"+_+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d=new Set,y={};function v(_,w){C(_,w),C(_+"Capture",w)}function C(_,w){for(y[_]=w,_=0;_<w.length;_++)d.add(w[_])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),M=Object.prototype.hasOwnProperty,L=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,F={},W={};function X(_){return M.call(W,_)?!0:M.call(F,_)?!1:L.test(_)?W[_]=!0:(F[_]=!0,!1)}function ee(_,w,P,z){if(P!==null&&P.type===0)return!1;switch(typeof w){case"function":case"symbol":return!0;case"boolean":return z?!1:P!==null?!P.acceptsBooleans:(_=_.toLowerCase().slice(0,5),_!=="data-"&&_!=="aria-");default:return!1}}function he(_,w,P,z){if(w===null||typeof w>"u"||ee(_,w,P,z))return!0;if(z)return!1;if(P!==null)switch(P.type){case 3:return!w;case 4:return w===!1;case 5:return isNaN(w);case 6:return isNaN(w)||1>w}return!1}function se(_,w,P,z,Z,ie,we){this.acceptsBooleans=w===2||w===3||w===4,this.attributeName=z,this.attributeNamespace=Z,this.mustUseProperty=P,this.propertyName=_,this.type=w,this.sanitizeURL=ie,this.removeEmptyString=we}var oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(_){oe[_]=new se(_,0,!1,_,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(_){var w=_[0];oe[w]=new se(w,1,!1,_[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(_){oe[_]=new se(_,2,!1,_.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(_){oe[_]=new se(_,2,!1,_,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(_){oe[_]=new se(_,3,!1,_.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(_){oe[_]=new se(_,3,!0,_,null,!1,!1)}),["capture","download"].forEach(function(_){oe[_]=new se(_,4,!1,_,null,!1,!1)}),["cols","rows","size","span"].forEach(function(_){oe[_]=new se(_,6,!1,_,null,!1,!1)}),["rowSpan","start"].forEach(function(_){oe[_]=new se(_,5,!1,_.toLowerCase(),null,!1,!1)});var ve=/[\-:]([a-z])/g;function me(_){return _[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(_){var w=_.replace(ve,me);oe[w]=new se(w,1,!1,_,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(_){var w=_.replace(ve,me);oe[w]=new se(w,1,!1,_,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(_){var w=_.replace(ve,me);oe[w]=new se(w,1,!1,_,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(_){oe[_]=new se(_,1,!1,_.toLowerCase(),null,!1,!1)}),oe.xlinkHref=new se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(_){oe[_]=new se(_,1,!1,_.toLowerCase(),null,!0,!0)});function Se(_,w,P,z){var Z=oe.hasOwnProperty(w)?oe[w]:null;(Z!==null?Z.type!==0:z||!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(he(w,P,Z,z)&&(P=null),z||Z===null?X(w)&&(P===null?_.removeAttribute(w):_.setAttribute(w,""+P)):Z.mustUseProperty?_[Z.propertyName]=P===null?Z.type===3?!1:"":P:(w=Z.attributeName,z=Z.attributeNamespace,P===null?_.removeAttribute(w):(Z=Z.type,P=Z===3||Z===4&&P===!0?"":""+P,z?_.setAttributeNS(z,w,P):_.setAttribute(w,P))))}var Re=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Be=Symbol.for("react.element"),rt=Symbol.for("react.portal"),We=Symbol.for("react.fragment"),Ct=Symbol.for("react.strict_mode"),Ht=Symbol.for("react.profiler"),Zt=Symbol.for("react.provider"),rr=Symbol.for("react.context"),$t=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),Gt=Symbol.for("react.suspense_list"),Ar=Symbol.for("react.memo"),Ut=Symbol.for("react.lazy"),Xt=Symbol.for("react.offscreen"),ut=Symbol.iterator;function Mt(_){return _===null||typeof _!="object"?null:(_=ut&&_[ut]||_["@@iterator"],typeof _=="function"?_:null)}var Qt=Object.assign,ze;function It(_){if(ze===void 0)try{throw Error()}catch(P){var w=P.stack.trim().match(/\n( *(at )?)/);ze=w&&w[1]||""}return`
`+ze+_}var xr=!1;function Lr(_,w){if(!_||xr)return"";xr=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(w)if(w=function(){throw Error()},Object.defineProperty(w.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(w,[])}catch(Bt){var z=Bt}Reflect.construct(_,[],w)}else{try{w.call()}catch(Bt){z=Bt}_.call(w.prototype)}else{try{throw Error()}catch(Bt){z=Bt}_()}}catch(Bt){if(Bt&&z&&typeof Bt.stack=="string"){for(var Z=Bt.stack.split(`
`),ie=z.stack.split(`
`),we=Z.length-1,Ye=ie.length-1;1<=we&&0<=Ye&&Z[we]!==ie[Ye];)Ye--;for(;1<=we&&0<=Ye;we--,Ye--)if(Z[we]!==ie[Ye]){if(we!==1||Ye!==1)do if(we--,Ye--,0>Ye||Z[we]!==ie[Ye]){var ft=`
`+Z[we].replace(" at new "," at ");return _.displayName&&ft.includes("<anonymous>")&&(ft=ft.replace("<anonymous>",_.displayName)),ft}while(1<=we&&0<=Ye);break}}}finally{xr=!1,Error.prepareStackTrace=P}return(_=_?_.displayName||_.name:"")?It(_):""}function yn(_){switch(_.tag){case 5:return It(_.type);case 16:return It("Lazy");case 13:return It("Suspense");case 19:return It("SuspenseList");case 0:case 2:case 15:return _=Lr(_.type,!1),_;case 11:return _=Lr(_.type.render,!1),_;case 1:return _=Lr(_.type,!0),_;default:return""}}function Yr(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case We:return"Fragment";case rt:return"Portal";case Ht:return"Profiler";case Ct:return"StrictMode";case Rt:return"Suspense";case Gt:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case rr:return(_.displayName||"Context")+".Consumer";case Zt:return(_._context.displayName||"Context")+".Provider";case $t:var w=_.render;return _=_.displayName,_||(_=w.displayName||w.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case Ar:return w=_.displayName||null,w!==null?w:Yr(_.type)||"Memo";case Ut:w=_._payload,_=_._init;try{return Yr(_(w))}catch{}}return null}function Zr(_){var w=_.type;switch(_.tag){case 24:return"Cache";case 9:return(w.displayName||"Context")+".Consumer";case 10:return(w._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=w.render,_=_.displayName||_.name||"",w.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return w;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Yr(w);case 8:return w===Ct?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w}return null}function Qr(_){switch(typeof _){case"boolean":case"number":case"string":case"undefined":return _;case"object":return _;default:return""}}function ir(_){var w=_.type;return(_=_.nodeName)&&_.toLowerCase()==="input"&&(w==="checkbox"||w==="radio")}function Hr(_){var w=ir(_)?"checked":"value",P=Object.getOwnPropertyDescriptor(_.constructor.prototype,w),z=""+_[w];if(!_.hasOwnProperty(w)&&typeof P<"u"&&typeof P.get=="function"&&typeof P.set=="function"){var Z=P.get,ie=P.set;return Object.defineProperty(_,w,{configurable:!0,get:function(){return Z.call(this)},set:function(we){z=""+we,ie.call(this,we)}}),Object.defineProperty(_,w,{enumerable:P.enumerable}),{getValue:function(){return z},setValue:function(we){z=""+we},stopTracking:function(){_._valueTracker=null,delete _[w]}}}}function Ur(_){_._valueTracker||(_._valueTracker=Hr(_))}function Ti(_){if(!_)return!1;var w=_._valueTracker;if(!w)return!0;var P=w.getValue(),z="";return _&&(z=ir(_)?_.checked?"true":"false":_.value),_=z,_!==P?(w.setValue(_),!0):!1}function Sn(_){if(_=_||(typeof document<"u"?document:void 0),typeof _>"u")return null;try{return _.activeElement||_.body}catch{return _.body}}function Ci(_,w){var P=w.checked;return Qt({},w,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:P??_._wrapperState.initialChecked})}function At(_,w){var P=w.defaultValue==null?"":w.defaultValue,z=w.checked!=null?w.checked:w.defaultChecked;P=Qr(w.value!=null?w.value:P),_._wrapperState={initialChecked:z,initialValue:P,controlled:w.type==="checkbox"||w.type==="radio"?w.checked!=null:w.value!=null}}function pt(_,w){w=w.checked,w!=null&&Se(_,"checked",w,!1)}function Sr(_,w){pt(_,w);var P=Qr(w.value),z=w.type;if(P!=null)z==="number"?(P===0&&_.value===""||_.value!=P)&&(_.value=""+P):_.value!==""+P&&(_.value=""+P);else if(z==="submit"||z==="reset"){_.removeAttribute("value");return}w.hasOwnProperty("value")?Vr(_,w.type,P):w.hasOwnProperty("defaultValue")&&Vr(_,w.type,Qr(w.defaultValue)),w.checked==null&&w.defaultChecked!=null&&(_.defaultChecked=!!w.defaultChecked)}function Dr(_,w,P){if(w.hasOwnProperty("value")||w.hasOwnProperty("defaultValue")){var z=w.type;if(!(z!=="submit"&&z!=="reset"||w.value!==void 0&&w.value!==null))return;w=""+_._wrapperState.initialValue,P||w===_.value||(_.value=w),_.defaultValue=w}P=_.name,P!==""&&(_.name=""),_.defaultChecked=!!_._wrapperState.initialChecked,P!==""&&(_.name=P)}function Vr(_,w,P){(w!=="number"||Sn(_.ownerDocument)!==_)&&(P==null?_.defaultValue=""+_._wrapperState.initialValue:_.defaultValue!==""+P&&(_.defaultValue=""+P))}var Ke=Array.isArray;function Je(_,w,P,z){if(_=_.options,w){w={};for(var Z=0;Z<P.length;Z++)w["$"+P[Z]]=!0;for(P=0;P<_.length;P++)Z=w.hasOwnProperty("$"+_[P].value),_[P].selected!==Z&&(_[P].selected=Z),Z&&z&&(_[P].defaultSelected=!0)}else{for(P=""+Qr(P),w=null,Z=0;Z<_.length;Z++){if(_[Z].value===P){_[Z].selected=!0,z&&(_[Z].defaultSelected=!0);return}w!==null||_[Z].disabled||(w=_[Z])}w!==null&&(w.selected=!0)}}function jt(_,w){if(w.dangerouslySetInnerHTML!=null)throw Error(a(91));return Qt({},w,{value:void 0,defaultValue:void 0,children:""+_._wrapperState.initialValue})}function yr(_,w){var P=w.value;if(P==null){if(P=w.children,w=w.defaultValue,P!=null){if(w!=null)throw Error(a(92));if(Ke(P)){if(1<P.length)throw Error(a(93));P=P[0]}w=P}w==null&&(w=""),P=w}_._wrapperState={initialValue:Qr(P)}}function pr(_,w){var P=Qr(w.value),z=Qr(w.defaultValue);P!=null&&(P=""+P,P!==_.value&&(_.value=P),w.defaultValue==null&&_.defaultValue!==P&&(_.defaultValue=P)),z!=null&&(_.defaultValue=""+z)}function Jt(_){var w=_.textContent;w===_._wrapperState.initialValue&&w!==""&&w!==null&&(_.value=w)}function Or(_){switch(_){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sn(_,w){return _==null||_==="http://www.w3.org/1999/xhtml"?Or(w):_==="http://www.w3.org/2000/svg"&&w==="foreignObject"?"http://www.w3.org/1999/xhtml":_}var Mn,Gi=(function(_){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(w,P,z,Z){MSApp.execUnsafeLocalFunction(function(){return _(w,P,z,Z)})}:_})(function(_,w){if(_.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in _)_.innerHTML=w;else{for(Mn=Mn||document.createElement("div"),Mn.innerHTML="<svg>"+w.valueOf().toString()+"</svg>",w=Mn.firstChild;_.firstChild;)_.removeChild(_.firstChild);for(;w.firstChild;)_.appendChild(w.firstChild)}});function yi(_,w){if(w){var P=_.firstChild;if(P&&P===_.lastChild&&P.nodeType===3){P.nodeValue=w;return}}_.textContent=w}var vt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},or=["Webkit","ms","Moz","O"];Object.keys(vt).forEach(function(_){or.forEach(function(w){w=w+_.charAt(0).toUpperCase()+_.substring(1),vt[w]=vt[_]})});function dn(_,w,P){return w==null||typeof w=="boolean"||w===""?"":P||typeof w!="number"||w===0||vt.hasOwnProperty(_)&&vt[_]?(""+w).trim():w+"px"}function Ln(_,w){_=_.style;for(var P in w)if(w.hasOwnProperty(P)){var z=P.indexOf("--")===0,Z=dn(P,w[P],z);P==="float"&&(P="cssFloat"),z?_.setProperty(P,Z):_[P]=Z}}var Bn=Qt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ze(_,w){if(w){if(Bn[_]&&(w.children!=null||w.dangerouslySetInnerHTML!=null))throw Error(a(137,_));if(w.dangerouslySetInnerHTML!=null){if(w.children!=null)throw Error(a(60));if(typeof w.dangerouslySetInnerHTML!="object"||!("__html"in w.dangerouslySetInnerHTML))throw Error(a(61))}if(w.style!=null&&typeof w.style!="object")throw Error(a(62))}}function ur(_,w){if(_.indexOf("-")===-1)return typeof w.is=="string";switch(_){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kr=null;function An(_){return _=_.target||_.srcElement||window,_.correspondingUseElement&&(_=_.correspondingUseElement),_.nodeType===3?_.parentNode:_}var ki=null,Yn=null,Ri=null;function ui(_){if(_=Qd(_)){if(typeof ki!="function")throw Error(a(280));var w=_.stateNode;w&&(w=pf(w),ki(_.stateNode,_.type,w))}}function _i(_){Yn?Ri?Ri.push(_):Ri=[_]:Yn=_}function Ds(){if(Yn){var _=Yn,w=Ri;if(Ri=Yn=null,ui(_),w)for(_=0;_<w.length;_++)ui(w[_])}}function oo(_,w){return _(w)}function Is(){}var ao=!1;function No(_,w,P){if(ao)return _(w,P);ao=!0;try{return oo(_,w,P)}finally{ao=!1,(Yn!==null||Ri!==null)&&(Is(),Ds())}}function Nt(_,w){var P=_.stateNode;if(P===null)return null;var z=pf(P);if(z===null)return null;P=z[w];e:switch(w){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(z=!z.disabled)||(_=_.type,z=!(_==="button"||_==="input"||_==="select"||_==="textarea")),_=!z;break e;default:_=!1}if(_)return null;if(P&&typeof P!="function")throw Error(a(231,w,typeof P));return P}var us=!1;if(s)try{var ks={};Object.defineProperty(ks,"passive",{get:function(){us=!0}}),window.addEventListener("test",ks,ks),window.removeEventListener("test",ks,ks)}catch{us=!1}function fo(_,w,P,z,Z,ie,we,Ye,ft){var Bt=Array.prototype.slice.call(arguments,3);try{w.apply(P,Bt)}catch(vr){this.onError(vr)}}var vn=!1,$e=null,ne=!1,ce=null,be={onError:function(_){vn=!0,$e=_}};function De(_,w,P,z,Z,ie,we,Ye,ft){vn=!1,$e=null,fo.apply(be,arguments)}function Ee(_,w,P,z,Z,ie,we,Ye,ft){if(De.apply(this,arguments),vn){if(vn){var Bt=$e;vn=!1,$e=null}else throw Error(a(198));ne||(ne=!0,ce=Bt)}}function Fe(_){var w=_,P=_;if(_.alternate)for(;w.return;)w=w.return;else{_=w;do w=_,(w.flags&4098)!==0&&(P=w.return),_=w.return;while(_)}return w.tag===3?P:null}function et(_){if(_.tag===13){var w=_.memoizedState;if(w===null&&(_=_.alternate,_!==null&&(w=_.memoizedState)),w!==null)return w.dehydrated}return null}function qe(_){if(Fe(_)!==_)throw Error(a(188))}function fe(_){var w=_.alternate;if(!w){if(w=Fe(_),w===null)throw Error(a(188));return w!==_?null:_}for(var P=_,z=w;;){var Z=P.return;if(Z===null)break;var ie=Z.alternate;if(ie===null){if(z=Z.return,z!==null){P=z;continue}break}if(Z.child===ie.child){for(ie=Z.child;ie;){if(ie===P)return qe(Z),_;if(ie===z)return qe(Z),w;ie=ie.sibling}throw Error(a(188))}if(P.return!==z.return)P=Z,z=ie;else{for(var we=!1,Ye=Z.child;Ye;){if(Ye===P){we=!0,P=Z,z=ie;break}if(Ye===z){we=!0,z=Z,P=ie;break}Ye=Ye.sibling}if(!we){for(Ye=ie.child;Ye;){if(Ye===P){we=!0,P=ie,z=Z;break}if(Ye===z){we=!0,z=ie,P=Z;break}Ye=Ye.sibling}if(!we)throw Error(a(189))}}if(P.alternate!==z)throw Error(a(190))}if(P.tag!==3)throw Error(a(188));return P.stateNode.current===P?_:w}function Ve(_){return _=fe(_),_!==null?Xe(_):null}function Xe(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var w=Xe(_);if(w!==null)return w;_=_.sibling}return null}var ct=n.unstable_scheduleCallback,tr=n.unstable_cancelCallback,cr=n.unstable_shouldYield,Nr=n.unstable_requestPaint,Ir=n.unstable_now,jr=n.unstable_getCurrentPriorityLevel,Rr=n.unstable_ImmediatePriority,ni=n.unstable_UserBlockingPriority,$i=n.unstable_NormalPriority,rs=n.unstable_LowPriority,Yi=n.unstable_IdlePriority,Ii=null,gn=null;function Ni(_){if(gn&&typeof gn.onCommitFiberRoot=="function")try{gn.onCommitFiberRoot(Ii,_,void 0,(_.current.flags&128)===128)}catch{}}var In=Math.clz32?Math.clz32:js,di=Math.log,Oi=Math.LN2;function js(_){return _>>>=0,_===0?32:31-(di(_)/Oi|0)|0}var bs=64,Qi=4194304;function po(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function Hi(_,w){var P=_.pendingLanes;if(P===0)return 0;var z=0,Z=_.suspendedLanes,ie=_.pingedLanes,we=P&268435455;if(we!==0){var Ye=we&~Z;Ye!==0?z=po(Ye):(ie&=we,ie!==0&&(z=po(ie)))}else we=P&~Z,we!==0?z=po(we):ie!==0&&(z=po(ie));if(z===0)return 0;if(w!==0&&w!==z&&(w&Z)===0&&(Z=z&-z,ie=w&-w,Z>=ie||Z===16&&(ie&4194240)!==0))return w;if((z&4)!==0&&(z|=P&16),w=_.entangledLanes,w!==0)for(_=_.entanglements,w&=z;0<w;)P=31-In(w),Z=1<<P,z|=_[P],w&=~Z;return z}function ws(_,w){switch(_){case 1:case 2:case 4:return w+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ra(_,w){for(var P=_.suspendedLanes,z=_.pingedLanes,Z=_.expirationTimes,ie=_.pendingLanes;0<ie;){var we=31-In(ie),Ye=1<<we,ft=Z[we];ft===-1?((Ye&P)===0||(Ye&z)!==0)&&(Z[we]=ws(Ye,w)):ft<=w&&(_.expiredLanes|=Ye),ie&=~Ye}}function Uo(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function lo(){var _=bs;return bs<<=1,(bs&4194240)===0&&(bs=64),_}function ot(_){for(var w=[],P=0;31>P;P++)w.push(_);return w}function br(_,w,P){_.pendingLanes|=w,w!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,w=31-In(w),_[w]=P}function pn(_,w){var P=_.pendingLanes&~w;_.pendingLanes=w,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=w,_.mutableReadLanes&=w,_.entangledLanes&=w,w=_.entanglements;var z=_.eventTimes;for(_=_.expirationTimes;0<P;){var Z=31-In(P),ie=1<<Z;w[Z]=0,z[Z]=-1,_[Z]=-1,P&=~ie}}function Vn(_,w){var P=_.entangledLanes|=w;for(_=_.entanglements;P;){var z=31-In(P),Z=1<<z;Z&w|_[z]&w&&(_[z]|=w),P&=~Z}}var $n=0;function jo(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var Il,eu,Rd,Lu,Rs,$o=!1,La=[],Fs=null,_t=null,Tr=null,an=new Map,Gn=new Map,Ei=[],_s="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function na(_,w){switch(_){case"focusin":case"focusout":Fs=null;break;case"dragenter":case"dragleave":_t=null;break;case"mouseover":case"mouseout":Tr=null;break;case"pointerover":case"pointerout":an.delete(w.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gn.delete(w.pointerId)}}function Zs(_,w,P,z,Z,ie){return _===null||_.nativeEvent!==ie?(_={blockedOn:w,domEventName:P,eventSystemFlags:z,nativeEvent:ie,targetContainers:[Z]},w!==null&&(w=Qd(w),w!==null&&eu(w)),_):(_.eventSystemFlags|=z,w=_.targetContainers,Z!==null&&w.indexOf(Z)===-1&&w.push(Z),_)}function qo(_,w,P,z,Z){switch(w){case"focusin":return Fs=Zs(Fs,_,w,P,z,Z),!0;case"dragenter":return _t=Zs(_t,_,w,P,z,Z),!0;case"mouseover":return Tr=Zs(Tr,_,w,P,z,Z),!0;case"pointerover":var ie=Z.pointerId;return an.set(ie,Zs(an.get(ie)||null,_,w,P,z,Z)),!0;case"gotpointercapture":return ie=Z.pointerId,Gn.set(ie,Zs(Gn.get(ie)||null,_,w,P,z,Z)),!0}return!1}function Ql(_){var w=lu(_.target);if(w!==null){var P=Fe(w);if(P!==null){if(w=P.tag,w===13){if(w=et(P),w!==null){_.blockedOn=w,Rs(_.priority,function(){Rd(P)});return}}else if(w===3&&P.stateNode.current.memoizedState.isDehydrated){_.blockedOn=P.tag===3?P.stateNode.containerInfo:null;return}}}_.blockedOn=null}function tu(_){if(_.blockedOn!==null)return!1;for(var w=_.targetContainers;0<w.length;){var P=ec(_.domEventName,_.eventSystemFlags,w[0],_.nativeEvent);if(P===null){P=_.nativeEvent;var z=new P.constructor(P.type,P);kr=z,P.target.dispatchEvent(z),kr=null}else return w=Qd(P),w!==null&&eu(w),_.blockedOn=P,!1;w.shift()}return!0}function Jl(_,w,P){tu(_)&&P.delete(w)}function Uh(){$o=!1,Fs!==null&&tu(Fs)&&(Fs=null),_t!==null&&tu(_t)&&(_t=null),Tr!==null&&tu(Tr)&&(Tr=null),an.forEach(Jl),Gn.forEach(Jl)}function $h(_,w){_.blockedOn===w&&(_.blockedOn=null,$o||($o=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Uh)))}function Du(_){function w(Z){return $h(Z,_)}if(0<La.length){$h(La[0],_);for(var P=1;P<La.length;P++){var z=La[P];z.blockedOn===_&&(z.blockedOn=null)}}for(Fs!==null&&$h(Fs,_),_t!==null&&$h(_t,_),Tr!==null&&$h(Tr,_),an.forEach(w),Gn.forEach(w),P=0;P<Ei.length;P++)z=Ei[P],z.blockedOn===_&&(z.blockedOn=null);for(;0<Ei.length&&(P=Ei[0],P.blockedOn===null);)Ql(P),P.blockedOn===null&&Ei.shift()}var Dn=Re.ReactCurrentBatchConfig,bc=!0;function op(_,w,P,z){var Z=$n,ie=Dn.transition;Dn.transition=null;try{$n=1,ap(_,w,P,z)}finally{$n=Z,Dn.transition=ie}}function zg(_,w,P,z){var Z=$n,ie=Dn.transition;Dn.transition=null;try{$n=4,ap(_,w,P,z)}finally{$n=Z,Dn.transition=ie}}function ap(_,w,P,z){if(bc){var Z=ec(_,w,P,z);if(Z===null)cf(_,w,z,ru,P),na(_,z);else if(qo(Z,_,w,P,z))z.stopPropagation();else if(na(_,z),w&4&&-1<_s.indexOf(_)){for(;Z!==null;){var ie=Qd(Z);if(ie!==null&&Il(ie),ie=ec(_,w,P,z),ie===null&&cf(_,w,z,ru,P),ie===Z)break;Z=ie}Z!==null&&z.stopPropagation()}else cf(_,w,z,null,P)}}var ru=null;function ec(_,w,P,z){if(ru=null,_=An(z),_=lu(_),_!==null)if(w=Fe(_),w===null)_=null;else if(P=w.tag,P===13){if(_=et(w),_!==null)return _;_=null}else if(P===3){if(w.stateNode.current.memoizedState.isDehydrated)return w.tag===3?w.stateNode.containerInfo:null;_=null}else w!==_&&(_=null);return ru=_,null}function Md(_){switch(_){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jr()){case Rr:return 1;case ni:return 4;case $i:case rs:return 16;case Yi:return 536870912;default:return 16}default:return 16}}var Pl=null,Cm=null,wc=null;function tc(){if(wc)return wc;var _,w=Cm,P=w.length,z,Z="value"in Pl?Pl.value:Pl.textContent,ie=Z.length;for(_=0;_<P&&w[_]===Z[_];_++);var we=P-_;for(z=1;z<=we&&w[P-z]===Z[ie-z];z++);return wc=Z.slice(_,1<z?1-z:void 0)}function nu(_){var w=_.keyCode;return"charCode"in _?(_=_.charCode,_===0&&w===13&&(_=13)):_=w,_===10&&(_=13),32<=_||_===13?_:0}function qh(){return!0}function iu(){return!1}function Xs(_){function w(P,z,Z,ie,we){this._reactName=P,this._targetInst=Z,this.type=z,this.nativeEvent=ie,this.target=we,this.currentTarget=null;for(var Ye in _)_.hasOwnProperty(Ye)&&(P=_[Ye],this[Ye]=P?P(ie):ie[Ye]);return this.isDefaultPrevented=(ie.defaultPrevented!=null?ie.defaultPrevented:ie.returnValue===!1)?qh:iu,this.isPropagationStopped=iu,this}return Qt(w.prototype,{preventDefault:function(){this.defaultPrevented=!0;var P=this.nativeEvent;P&&(P.preventDefault?P.preventDefault():typeof P.returnValue!="unknown"&&(P.returnValue=!1),this.isDefaultPrevented=qh)},stopPropagation:function(){var P=this.nativeEvent;P&&(P.stopPropagation?P.stopPropagation():typeof P.cancelBubble!="unknown"&&(P.cancelBubble=!0),this.isPropagationStopped=qh)},persist:function(){},isPersistent:qh}),w}var co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(_){return _.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Da=Xs(co),su=Qt({},co,{view:0,detail:0}),Fg=Xs(su),ii,Gh,Ld,Wh=Qt({},su,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mo,button:0,buttons:0,relatedTarget:function(_){return _.relatedTarget===void 0?_.fromElement===_.srcElement?_.toElement:_.fromElement:_.relatedTarget},movementX:function(_){return"movementX"in _?_.movementX:(_!==Ld&&(Ld&&_.type==="mousemove"?(ii=_.screenX-Ld.screenX,Gh=_.screenY-Ld.screenY):Gh=ii=0,Ld=_),ii)},movementY:function(_){return"movementY"in _?_.movementY:Gh}}),$r=Xs(Wh),Am=Qt({},Wh,{dataTransfer:0}),Ou=Xs(Am),ia=Qt({},su,{relatedTarget:0}),Dd=Xs(ia),va=Qt({},co,{animationName:0,elapsedTime:0,pseudoElement:0}),Er=Xs(va),si=Qt({},co,{clipboardData:function(_){return"clipboardData"in _?_.clipboardData:window.clipboardData}}),ei=Xs(si),sa=Qt({},co,{data:0}),zu=Xs(sa),xi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fu(_){var w=this.nativeEvent;return w.getModifierState?w.getModifierState(_):(_=Od[_])?!!w[_]:!1}function mo(){return Fu}var Ss=Qt({},su,{key:function(_){if(_.key){var w=xi[_.key]||_.key;if(w!=="Unidentified")return w}return _.type==="keypress"?(_=nu(_),_===13?"Enter":String.fromCharCode(_)):_.type==="keydown"||_.type==="keyup"?lp[_.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mo,charCode:function(_){return _.type==="keypress"?nu(_):0},keyCode:function(_){return _.type==="keydown"||_.type==="keyup"?_.keyCode:0},which:function(_){return _.type==="keypress"?nu(_):_.type==="keydown"||_.type==="keyup"?_.keyCode:0}}),S_=Xs(Ss),Hh=Qt({},Wh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cp=Xs(Hh),Zh=Qt({},su,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mo}),up=Xs(Zh),Im=Qt({},co,{propertyName:0,elapsedTime:0,pseudoElement:0}),dp=Xs(Im),Go=Qt({},Wh,{deltaX:function(_){return"deltaX"in _?_.deltaX:"wheelDeltaX"in _?-_.wheelDeltaX:0},deltaY:function(_){return"deltaY"in _?_.deltaY:"wheelDeltaY"in _?-_.wheelDeltaY:"wheelDelta"in _?-_.wheelDelta:0},deltaZ:0,deltaMode:0}),ba=Xs(Go),wa=[9,13,27,32],Xh=s&&"CompositionEvent"in window,sl=null;s&&"documentMode"in document&&(sl=document.documentMode);var Bs=s&&"TextEvent"in window&&!sl,kl=s&&(!Xh||sl&&8<sl&&11>=sl),rc=" ",Ms=!1;function Sc(_,w){switch(_){case"keyup":return wa.indexOf(w.keyCode)!==-1;case"keydown":return w.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jr(_){return _=_.detail,typeof _=="object"&&"data"in _?_.data:null}var _r=!1;function zd(_,w){switch(_){case"compositionend":return Jr(w);case"keypress":return w.which!==32?null:(Ms=!0,rc);case"textInput":return _=w.data,_===rc&&Ms?null:_;default:return null}}function Xr(_,w){if(_r)return _==="compositionend"||!Xh&&Sc(_,w)?(_=tc(),wc=Cm=Pl=null,_r=!1,_):null;switch(_){case"paste":return null;case"keypress":if(!(w.ctrlKey||w.altKey||w.metaKey)||w.ctrlKey&&w.altKey){if(w.char&&1<w.char.length)return w.char;if(w.which)return String.fromCharCode(w.which)}return null;case"compositionend":return kl&&w.locale!=="ko"?null:w.data;default:return null}}var hp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fd(_){var w=_&&_.nodeName&&_.nodeName.toLowerCase();return w==="input"?!!hp[_.type]:w==="textarea"}function qr(_,w,P,z){_i(z),w=jn(w,"onChange"),0<w.length&&(P=new Da("onChange","change",null,P,z),_.push({event:P,listeners:w}))}var Bu=null,Vu=null;function nc(_){Cc(_,0)}function Kh(_){var w=Ml(_);if(Ti(w))return _}function Bd(_,w){if(_==="change")return w}var oa=!1;if(s){var Yh;if(s){var ol="oninput"in document;if(!ol){var Qh=document.createElement("div");Qh.setAttribute("oninput","return;"),ol=typeof Qh.oninput=="function"}Yh=ol}else Yh=!1;oa=Yh&&(!document.documentMode||9<document.documentMode)}function Ha(){Bu&&(Bu.detachEvent("onpropertychange",Tc),Vu=Bu=null)}function Tc(_){if(_.propertyName==="value"&&Kh(Vu)){var w=[];qr(w,Vu,_,An(_)),No(nc,w)}}function T_(_,w,P){_==="focusin"?(Ha(),Bu=w,Vu=P,Bu.attachEvent("onpropertychange",Tc)):_==="focusout"&&Ha()}function Jh(_){if(_==="selectionchange"||_==="keyup"||_==="keydown")return Kh(Vu)}function ef(_,w){if(_==="click")return Kh(w)}function fp(_,w){if(_==="input"||_==="change")return Kh(w)}function Bg(_,w){return _===w&&(_!==0||1/_===1/w)||_!==_&&w!==w}var Vs=typeof Object.is=="function"?Object.is:Bg;function Vd(_,w){if(Vs(_,w))return!0;if(typeof _!="object"||_===null||typeof w!="object"||w===null)return!1;var P=Object.keys(_),z=Object.keys(w);if(P.length!==z.length)return!1;for(z=0;z<P.length;z++){var Z=P[z];if(!M.call(w,Z)||!Vs(_[Z],w[Z]))return!1}return!0}function tf(_){for(;_&&_.firstChild;)_=_.firstChild;return _}function Ud(_,w){var P=tf(_);_=0;for(var z;P;){if(P.nodeType===3){if(z=_+P.textContent.length,_<=w&&z>=w)return{node:P,offset:w-_};_=z}e:{for(;P;){if(P.nextSibling){P=P.nextSibling;break e}P=P.parentNode}P=void 0}P=tf(P)}}function Ec(_,w){return _&&w?_===w?!0:_&&_.nodeType===3?!1:w&&w.nodeType===3?Ec(_,w.parentNode):"contains"in _?_.contains(w):_.compareDocumentPosition?!!(_.compareDocumentPosition(w)&16):!1:!1}function Vg(){for(var _=window,w=Sn();w instanceof _.HTMLIFrameElement;){try{var P=typeof w.contentWindow.location.href=="string"}catch{P=!1}if(P)_=w.contentWindow;else break;w=Sn(_.document)}return w}function pp(_){var w=_&&_.nodeName&&_.nodeName.toLowerCase();return w&&(w==="input"&&(_.type==="text"||_.type==="search"||_.type==="tel"||_.type==="url"||_.type==="password")||w==="textarea"||_.contentEditable==="true")}function E_(_){var w=Vg(),P=_.focusedElem,z=_.selectionRange;if(w!==P&&P&&P.ownerDocument&&Ec(P.ownerDocument.documentElement,P)){if(z!==null&&pp(P)){if(w=z.start,_=z.end,_===void 0&&(_=w),"selectionStart"in P)P.selectionStart=w,P.selectionEnd=Math.min(_,P.value.length);else if(_=(w=P.ownerDocument||document)&&w.defaultView||window,_.getSelection){_=_.getSelection();var Z=P.textContent.length,ie=Math.min(z.start,Z);z=z.end===void 0?ie:Math.min(z.end,Z),!_.extend&&ie>z&&(Z=z,z=ie,ie=Z),Z=Ud(P,ie);var we=Ud(P,z);Z&&we&&(_.rangeCount!==1||_.anchorNode!==Z.node||_.anchorOffset!==Z.offset||_.focusNode!==we.node||_.focusOffset!==we.offset)&&(w=w.createRange(),w.setStart(Z.node,Z.offset),_.removeAllRanges(),ie>z?(_.addRange(w),_.extend(we.node,we.offset)):(w.setEnd(we.node,we.offset),_.addRange(w)))}}for(w=[],_=P;_=_.parentNode;)_.nodeType===1&&w.push({element:_,left:_.scrollLeft,top:_.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<w.length;P++)_=w[P],_.element.scrollLeft=_.left,_.element.scrollTop=_.top}}var Pm=s&&"documentMode"in document&&11>=document.documentMode,$d=null,Nl=null,qd=null,mp=!1;function rf(_,w,P){var z=P.window===P?P.document:P.nodeType===9?P:P.ownerDocument;mp||$d==null||$d!==Sn(z)||(z=$d,"selectionStart"in z&&pp(z)?z={start:z.selectionStart,end:z.selectionEnd}:(z=(z.ownerDocument&&z.ownerDocument.defaultView||window).getSelection(),z={anchorNode:z.anchorNode,anchorOffset:z.anchorOffset,focusNode:z.focusNode,focusOffset:z.focusOffset}),qd&&Vd(qd,z)||(qd=z,z=jn(Nl,"onSelect"),0<z.length&&(w=new Da("onSelect","select",null,w,P),_.push({event:w,listeners:z}),w.target=$d)))}function Gd(_,w){var P={};return P[_.toLowerCase()]=w.toLowerCase(),P["Webkit"+_]="webkit"+w,P["Moz"+_]="moz"+w,P}var Za={animationend:Gd("Animation","AnimationEnd"),animationiteration:Gd("Animation","AnimationIteration"),animationstart:Gd("Animation","AnimationStart"),transitionend:Gd("Transition","TransitionEnd")},aa={},gp={};s&&(gp=document.createElement("div").style,"AnimationEvent"in window||(delete Za.animationend.animation,delete Za.animationiteration.animation,delete Za.animationstart.animation),"TransitionEvent"in window||delete Za.transitionend.transition);function Wd(_){if(aa[_])return aa[_];if(!Za[_])return _;var w=Za[_],P;for(P in w)if(w.hasOwnProperty(P)&&P in gp)return aa[_]=w[P];return _}var Uu=Wd("animationend"),$u=Wd("animationiteration"),yp=Wd("animationstart"),nf=Wd("transitionend"),Oa=new Map,Hd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qt(_,w){Oa.set(_,w),v(w,[_])}for(var sf=0;sf<Hd.length;sf++){var of=Hd[sf],af=of.toLowerCase(),ic=of[0].toUpperCase()+of.slice(1);qt(af,"on"+ic)}qt(Uu,"onAnimationEnd"),qt($u,"onAnimationIteration"),qt(yp,"onAnimationStart"),qt("dblclick","onDoubleClick"),qt("focusin","onFocus"),qt("focusout","onBlur"),qt(nf,"onTransitionEnd"),C("onMouseEnter",["mouseout","mouseover"]),C("onMouseLeave",["mouseout","mouseover"]),C("onPointerEnter",["pointerout","pointerover"]),C("onPointerLeave",["pointerout","pointerover"]),v("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),v("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),v("onBeforeInput",["compositionend","keypress","textInput","paste"]),v("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),v("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),v("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gu=new Set("cancel close invalid load scroll toggle".split(" ").concat(qu));function ou(_,w,P){var z=_.type||"unknown-event";_.currentTarget=P,Ee(z,w,void 0,_),_.currentTarget=null}function Cc(_,w){w=(w&4)!==0;for(var P=0;P<_.length;P++){var z=_[P],Z=z.event;z=z.listeners;e:{var ie=void 0;if(w)for(var we=z.length-1;0<=we;we--){var Ye=z[we],ft=Ye.instance,Bt=Ye.currentTarget;if(Ye=Ye.listener,ft!==ie&&Z.isPropagationStopped())break e;ou(Z,Ye,Bt),ie=ft}else for(we=0;we<z.length;we++){if(Ye=z[we],ft=Ye.instance,Bt=Ye.currentTarget,Ye=Ye.listener,ft!==ie&&Z.isPropagationStopped())break e;ou(Z,Ye,Bt),ie=ft}}}if(ne)throw _=ce,ne=!1,ce=null,_}function xs(_,w){var P=w[Yd];P===void 0&&(P=w[Yd]=new Set);var z=_+"__bubble";P.has(z)||(km(w,_,2,!1),P.add(z))}function _p(_,w,P){var z=0;w&&(z|=4),km(P,_,z,w)}var Wu="_reactListening"+Math.random().toString(36).slice(2);function lf(_){if(!_[Wu]){_[Wu]=!0,d.forEach(function(P){P!=="selectionchange"&&(Gu.has(P)||_p(P,!1,_),_p(P,!0,_))});var w=_.nodeType===9?_:_.ownerDocument;w===null||w[Wu]||(w[Wu]=!0,_p("selectionchange",!1,w))}}function km(_,w,P,z){switch(Md(w)){case 1:var Z=op;break;case 4:Z=zg;break;default:Z=ap}P=Z.bind(null,w,P,_),Z=void 0,!us||w!=="touchstart"&&w!=="touchmove"&&w!=="wheel"||(Z=!0),z?Z!==void 0?_.addEventListener(w,P,{capture:!0,passive:Z}):_.addEventListener(w,P,!0):Z!==void 0?_.addEventListener(w,P,{passive:Z}):_.addEventListener(w,P,!1)}function cf(_,w,P,z,Z){var ie=z;if((w&1)===0&&(w&2)===0&&z!==null)e:for(;;){if(z===null)return;var we=z.tag;if(we===3||we===4){var Ye=z.stateNode.containerInfo;if(Ye===Z||Ye.nodeType===8&&Ye.parentNode===Z)break;if(we===4)for(we=z.return;we!==null;){var ft=we.tag;if((ft===3||ft===4)&&(ft=we.stateNode.containerInfo,ft===Z||ft.nodeType===8&&ft.parentNode===Z))return;we=we.return}for(;Ye!==null;){if(we=lu(Ye),we===null)return;if(ft=we.tag,ft===5||ft===6){z=ie=we;continue e}Ye=Ye.parentNode}}z=z.return}No(function(){var Bt=ie,vr=An(P),Cr=[];e:{var mr=Oa.get(_);if(mr!==void 0){var Kr=Da,on=_;switch(_){case"keypress":if(nu(P)===0)break e;case"keydown":case"keyup":Kr=S_;break;case"focusin":on="focus",Kr=Dd;break;case"focusout":on="blur",Kr=Dd;break;case"beforeblur":case"afterblur":Kr=Dd;break;case"click":if(P.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Kr=$r;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Kr=Ou;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Kr=up;break;case Uu:case $u:case yp:Kr=Er;break;case nf:Kr=dp;break;case"scroll":Kr=Fg;break;case"wheel":Kr=ba;break;case"copy":case"cut":case"paste":Kr=ei;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Kr=cp}var nn=(w&4)!==0,ps=!nn&&_==="scroll",Lt=nn?mr!==null?mr+"Capture":null:mr;nn=[];for(var xt=Bt,Vt;xt!==null;){Vt=xt;var Br=Vt.stateNode;if(Vt.tag===5&&Br!==null&&(Vt=Br,Lt!==null&&(Br=Nt(xt,Lt),Br!=null&&nn.push(al(xt,Br,Vt)))),ps)break;xt=xt.return}0<nn.length&&(mr=new Kr(mr,on,null,P,vr),Cr.push({event:mr,listeners:nn}))}}if((w&7)===0){e:{if(mr=_==="mouseover"||_==="pointerover",Kr=_==="mouseout"||_==="pointerout",mr&&P!==kr&&(on=P.relatedTarget||P.fromElement)&&(lu(on)||on[Rl]))break e;if((Kr||mr)&&(mr=vr.window===vr?vr:(mr=vr.ownerDocument)?mr.defaultView||mr.parentWindow:window,Kr?(on=P.relatedTarget||P.toElement,Kr=Bt,on=on?lu(on):null,on!==null&&(ps=Fe(on),on!==ps||on.tag!==5&&on.tag!==6)&&(on=null)):(Kr=null,on=Bt),Kr!==on)){if(nn=$r,Br="onMouseLeave",Lt="onMouseEnter",xt="mouse",(_==="pointerout"||_==="pointerover")&&(nn=cp,Br="onPointerLeave",Lt="onPointerEnter",xt="pointer"),ps=Kr==null?mr:Ml(Kr),Vt=on==null?mr:Ml(on),mr=new nn(Br,xt+"leave",Kr,P,vr),mr.target=ps,mr.relatedTarget=Vt,Br=null,lu(vr)===Bt&&(nn=new nn(Lt,xt+"enter",on,P,vr),nn.target=Vt,nn.relatedTarget=ps,Br=nn),ps=Br,Kr&&on)t:{for(nn=Kr,Lt=on,xt=0,Vt=nn;Vt;Vt=Zd(Vt))xt++;for(Vt=0,Br=Lt;Br;Br=Zd(Br))Vt++;for(;0<xt-Vt;)nn=Zd(nn),xt--;for(;0<Vt-xt;)Lt=Zd(Lt),Vt--;for(;xt--;){if(nn===Lt||Lt!==null&&nn===Lt.alternate)break t;nn=Zd(nn),Lt=Zd(Lt)}nn=null}else nn=null;Kr!==null&&Ug(Cr,mr,Kr,nn,!1),on!==null&&ps!==null&&Ug(Cr,ps,on,nn,!0)}}e:{if(mr=Bt?Ml(Bt):window,Kr=mr.nodeName&&mr.nodeName.toLowerCase(),Kr==="select"||Kr==="input"&&mr.type==="file")var Nn=Bd;else if(Fd(mr))if(oa)Nn=fp;else{Nn=Jh;var Hn=T_}else(Kr=mr.nodeName)&&Kr.toLowerCase()==="input"&&(mr.type==="checkbox"||mr.type==="radio")&&(Nn=ef);if(Nn&&(Nn=Nn(_,Bt))){qr(Cr,Nn,P,vr);break e}Hn&&Hn(_,mr,Bt),_==="focusout"&&(Hn=mr._wrapperState)&&Hn.controlled&&mr.type==="number"&&Vr(mr,"number",mr.value)}switch(Hn=Bt?Ml(Bt):window,_){case"focusin":(Fd(Hn)||Hn.contentEditable==="true")&&($d=Hn,Nl=Bt,qd=null);break;case"focusout":qd=Nl=$d=null;break;case"mousedown":mp=!0;break;case"contextmenu":case"mouseup":case"dragend":mp=!1,rf(Cr,P,vr);break;case"selectionchange":if(Pm)break;case"keydown":case"keyup":rf(Cr,P,vr)}var Zn;if(Xh)e:{switch(_){case"compositionstart":var Xn="onCompositionStart";break e;case"compositionend":Xn="onCompositionEnd";break e;case"compositionupdate":Xn="onCompositionUpdate";break e}Xn=void 0}else _r?Sc(_,P)&&(Xn="onCompositionEnd"):_==="keydown"&&P.keyCode===229&&(Xn="onCompositionStart");Xn&&(kl&&P.locale!=="ko"&&(_r||Xn!=="onCompositionStart"?Xn==="onCompositionEnd"&&_r&&(Zn=tc()):(Pl=vr,Cm="value"in Pl?Pl.value:Pl.textContent,_r=!0)),Hn=jn(Bt,Xn),0<Hn.length&&(Xn=new zu(Xn,_,null,P,vr),Cr.push({event:Xn,listeners:Hn}),Zn?Xn.data=Zn:(Zn=Jr(P),Zn!==null&&(Xn.data=Zn)))),(Zn=Bs?zd(_,P):Xr(_,P))&&(Bt=jn(Bt,"onBeforeInput"),0<Bt.length&&(vr=new zu("onBeforeInput","beforeinput",null,P,vr),Cr.push({event:vr,listeners:Bt}),vr.data=Zn))}Cc(Cr,w)})}function al(_,w,P){return{instance:_,listener:w,currentTarget:P}}function jn(_,w){for(var P=w+"Capture",z=[];_!==null;){var Z=_,ie=Z.stateNode;Z.tag===5&&ie!==null&&(Z=ie,ie=Nt(_,P),ie!=null&&z.unshift(al(_,ie,Z)),ie=Nt(_,w),ie!=null&&z.push(al(_,ie,Z))),_=_.return}return z}function Zd(_){if(_===null)return null;do _=_.return;while(_&&_.tag!==5);return _||null}function Ug(_,w,P,z,Z){for(var ie=w._reactName,we=[];P!==null&&P!==z;){var Ye=P,ft=Ye.alternate,Bt=Ye.stateNode;if(ft!==null&&ft===z)break;Ye.tag===5&&Bt!==null&&(Ye=Bt,Z?(ft=Nt(P,ie),ft!=null&&we.unshift(al(P,ft,Ye))):Z||(ft=Nt(P,ie),ft!=null&&we.push(al(P,ft,Ye)))),P=P.return}we.length!==0&&_.push({event:w,listeners:we})}var C_=/\r\n?/g,Nm=/\u0000|\uFFFD/g;function $g(_){return(typeof _=="string"?_:""+_).replace(C_,`
`).replace(Nm,"")}function Mi(_,w,P){if(w=$g(w),$g(_)!==w&&P)throw Error(a(425))}function xp(){}var vp=null,uf=null;function Xd(_,w){return _==="textarea"||_==="noscript"||typeof w.children=="string"||typeof w.children=="number"||typeof w.dangerouslySetInnerHTML=="object"&&w.dangerouslySetInnerHTML!==null&&w.dangerouslySetInnerHTML.__html!=null}var df=typeof setTimeout=="function"?setTimeout:void 0,Hu=typeof clearTimeout=="function"?clearTimeout:void 0,Zu=typeof Promise=="function"?Promise:void 0,hf=typeof queueMicrotask=="function"?queueMicrotask:typeof Zu<"u"?function(_){return Zu.resolve(null).then(_).catch(Kd)}:df;function Kd(_){setTimeout(function(){throw _})}function bp(_,w){var P=w,z=0;do{var Z=P.nextSibling;if(_.removeChild(P),Z&&Z.nodeType===8)if(P=Z.data,P==="/$"){if(z===0){_.removeChild(Z),Du(w);return}z--}else P!=="$"&&P!=="$?"&&P!=="$!"||z++;P=Z}while(P);Du(w)}function sc(_){for(;_!=null;_=_.nextSibling){var w=_.nodeType;if(w===1||w===3)break;if(w===8){if(w=_.data,w==="$"||w==="$!"||w==="$?")break;if(w==="/$")return null}}return _}function jm(_){_=_.previousSibling;for(var w=0;_;){if(_.nodeType===8){var P=_.data;if(P==="$"||P==="$!"||P==="$?"){if(w===0)return _;w--}else P==="/$"&&w++}_=_.previousSibling}return null}var jl=Math.random().toString(36).slice(2),Xa="__reactFiber$"+jl,au="__reactProps$"+jl,Rl="__reactContainer$"+jl,Yd="__reactEvents$"+jl,ff="__reactListeners$"+jl,qg="__reactHandles$"+jl;function lu(_){var w=_[Xa];if(w)return w;for(var P=_.parentNode;P;){if(w=P[Rl]||P[Xa]){if(P=w.alternate,w.child!==null||P!==null&&P.child!==null)for(_=jm(_);_!==null;){if(P=_[Xa])return P;_=jm(_)}return w}_=P,P=_.parentNode}return null}function Qd(_){return _=_[Xa]||_[Rl],!_||_.tag!==5&&_.tag!==6&&_.tag!==13&&_.tag!==3?null:_}function Ml(_){if(_.tag===5||_.tag===6)return _.stateNode;throw Error(a(33))}function pf(_){return _[au]||null}var Rm=[],Jd=-1;function cu(_){return{current:_}}function Ts(_){0>Jd||(_.current=Rm[Jd],Rm[Jd]=null,Jd--)}function vs(_,w){Jd++,Rm[Jd]=_.current,_.current=w}var oc={},Ro=cu(oc),Sa=cu(!1),ac=oc;function Ac(_,w){var P=_.type.contextTypes;if(!P)return oc;var z=_.stateNode;if(z&&z.__reactInternalMemoizedUnmaskedChildContext===w)return z.__reactInternalMemoizedMaskedChildContext;var Z={},ie;for(ie in P)Z[ie]=w[ie];return z&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=w,_.__reactInternalMemoizedMaskedChildContext=Z),Z}function go(_){return _=_.childContextTypes,_!=null}function uu(){Ts(Sa),Ts(Ro)}function Mm(_,w,P){if(Ro.current!==oc)throw Error(a(168));vs(Ro,w),vs(Sa,P)}function za(_,w,P){var z=_.stateNode;if(w=w.childContextTypes,typeof z.getChildContext!="function")return P;z=z.getChildContext();for(var Z in z)if(!(Z in w))throw Error(a(108,Zr(_)||"Unknown",Z));return Qt({},P,z)}function Xu(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||oc,ac=Ro.current,vs(Ro,_),vs(Sa,Sa.current),!0}function eh(_,w,P){var z=_.stateNode;if(!z)throw Error(a(169));P?(_=za(_,w,ac),z.__reactInternalMemoizedMergedChildContext=_,Ts(Sa),Ts(Ro),vs(Ro,_)):Ts(Sa),vs(Sa,P)}var Wo=null,Ku=!1,th=!1;function wp(_){Wo===null?Wo=[_]:Wo.push(_)}function rh(_){Ku=!0,wp(_)}function ll(){if(!th&&Wo!==null){th=!0;var _=0,w=$n;try{var P=Wo;for($n=1;_<P.length;_++){var z=P[_];do z=z(!0);while(z!==null)}Wo=null,Ku=!1}catch(Z){throw Wo!==null&&(Wo=Wo.slice(_+1)),ct(Rr,ll),Z}finally{$n=w,th=!1}}return null}var lc=[],Ic=0,nh=null,ih=0,Fa=[],Ho=0,Yu=null,Pc=1,cc="";function du(_,w){lc[Ic++]=ih,lc[Ic++]=nh,nh=_,ih=w}function mf(_,w,P){Fa[Ho++]=Pc,Fa[Ho++]=cc,Fa[Ho++]=Yu,Yu=_;var z=Pc;_=cc;var Z=32-In(z)-1;z&=~(1<<Z),P+=1;var ie=32-In(w)+Z;if(30<ie){var we=Z-Z%5;ie=(z&(1<<we)-1).toString(32),z>>=we,Z-=we,Pc=1<<32-In(w)+Z|P<<Z|z,cc=ie+_}else Pc=1<<ie|P<<Z|z,cc=_}function Lm(_){_.return!==null&&(du(_,1),mf(_,1,0))}function sh(_){for(;_===nh;)nh=lc[--Ic],lc[Ic]=null,ih=lc[--Ic],lc[Ic]=null;for(;_===Yu;)Yu=Fa[--Ho],Fa[Ho]=null,cc=Fa[--Ho],Fa[Ho]=null,Pc=Fa[--Ho],Fa[Ho]=null}var Ta=null,Ba=null,ds=!1,Ka=null;function Dm(_,w){var P=ar(5,null,null,0);P.elementType="DELETED",P.stateNode=w,P.return=_,w=_.deletions,w===null?(_.deletions=[P],_.flags|=16):w.push(P)}function Om(_,w){switch(_.tag){case 5:var P=_.type;return w=w.nodeType!==1||P.toLowerCase()!==w.nodeName.toLowerCase()?null:w,w!==null?(_.stateNode=w,Ta=_,Ba=sc(w.firstChild),!0):!1;case 6:return w=_.pendingProps===""||w.nodeType!==3?null:w,w!==null?(_.stateNode=w,Ta=_,Ba=null,!0):!1;case 13:return w=w.nodeType!==8?null:w,w!==null?(P=Yu!==null?{id:Pc,overflow:cc}:null,_.memoizedState={dehydrated:w,treeContext:P,retryLane:1073741824},P=ar(18,null,null,0),P.stateNode=w,P.return=_,_.child=P,Ta=_,Ba=null,!0):!1;default:return!1}}function gf(_){return(_.mode&1)!==0&&(_.flags&128)===0}function uc(_){if(ds){var w=Ba;if(w){var P=w;if(!Om(_,w)){if(gf(_))throw Error(a(418));w=sc(P.nextSibling);var z=Ta;w&&Om(_,w)?Dm(z,P):(_.flags=_.flags&-4097|2,ds=!1,Ta=_)}}else{if(gf(_))throw Error(a(418));_.flags=_.flags&-4097|2,ds=!1,Ta=_}}}function hu(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;Ta=_}function Qu(_){if(_!==Ta)return!1;if(!ds)return hu(_),ds=!0,!1;var w;if((w=_.tag!==3)&&!(w=_.tag!==5)&&(w=_.type,w=w!=="head"&&w!=="body"&&!Xd(_.type,_.memoizedProps)),w&&(w=Ba)){if(gf(_))throw zm(),Error(a(418));for(;w;)Dm(_,w),w=sc(w.nextSibling)}if(hu(_),_.tag===13){if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(a(317));e:{for(_=_.nextSibling,w=0;_;){if(_.nodeType===8){var P=_.data;if(P==="/$"){if(w===0){Ba=sc(_.nextSibling);break e}w--}else P!=="$"&&P!=="$!"&&P!=="$?"||w++}_=_.nextSibling}Ba=null}}else Ba=Ta?sc(_.stateNode.nextSibling):null;return!0}function zm(){for(var _=Ba;_;)_=sc(_.nextSibling)}function Ya(){Ba=Ta=null,ds=!1}function yf(_){Ka===null?Ka=[_]:Ka.push(_)}var Sp=Re.ReactCurrentBatchConfig;function Ju(_,w,P){if(_=P.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(P._owner){if(P=P._owner,P){if(P.tag!==1)throw Error(a(309));var z=P.stateNode}if(!z)throw Error(a(147,_));var Z=z,ie=""+_;return w!==null&&w.ref!==null&&typeof w.ref=="function"&&w.ref._stringRef===ie?w.ref:(w=function(we){var Ye=Z.refs;we===null?delete Ye[ie]:Ye[ie]=we},w._stringRef=ie,w)}if(typeof _!="string")throw Error(a(284));if(!P._owner)throw Error(a(290,_))}return _}function _f(_,w){throw _=Object.prototype.toString.call(w),Error(a(31,_==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":_))}function Tp(_){var w=_._init;return w(_._payload)}function xf(_){function w(Lt,xt){if(_){var Vt=Lt.deletions;Vt===null?(Lt.deletions=[xt],Lt.flags|=16):Vt.push(xt)}}function P(Lt,xt){if(!_)return null;for(;xt!==null;)w(Lt,xt),xt=xt.sibling;return null}function z(Lt,xt){for(Lt=new Map;xt!==null;)xt.key!==null?Lt.set(xt.key,xt):Lt.set(xt.index,xt),xt=xt.sibling;return Lt}function Z(Lt,xt){return Lt=tn(Lt,xt),Lt.index=0,Lt.sibling=null,Lt}function ie(Lt,xt,Vt){return Lt.index=Vt,_?(Vt=Lt.alternate,Vt!==null?(Vt=Vt.index,Vt<xt?(Lt.flags|=2,xt):Vt):(Lt.flags|=2,xt)):(Lt.flags|=1048576,xt)}function we(Lt){return _&&Lt.alternate===null&&(Lt.flags|=2),Lt}function Ye(Lt,xt,Vt,Br){return xt===null||xt.tag!==6?(xt=rn(Vt,Lt.mode,Br),xt.return=Lt,xt):(xt=Z(xt,Vt),xt.return=Lt,xt)}function ft(Lt,xt,Vt,Br){var Nn=Vt.type;return Nn===We?vr(Lt,xt,Vt.props.children,Br,Vt.key):xt!==null&&(xt.elementType===Nn||typeof Nn=="object"&&Nn!==null&&Nn.$$typeof===Ut&&Tp(Nn)===xt.type)?(Br=Z(xt,Vt.props),Br.ref=Ju(Lt,xt,Vt),Br.return=Lt,Br):(Br=Pn(Vt.type,Vt.key,Vt.props,null,Lt.mode,Br),Br.ref=Ju(Lt,xt,Vt),Br.return=Lt,Br)}function Bt(Lt,xt,Vt,Br){return xt===null||xt.tag!==4||xt.stateNode.containerInfo!==Vt.containerInfo||xt.stateNode.implementation!==Vt.implementation?(xt=oi(Vt,Lt.mode,Br),xt.return=Lt,xt):(xt=Z(xt,Vt.children||[]),xt.return=Lt,xt)}function vr(Lt,xt,Vt,Br,Nn){return xt===null||xt.tag!==7?(xt=Wr(Vt,Lt.mode,Br,Nn),xt.return=Lt,xt):(xt=Z(xt,Vt),xt.return=Lt,xt)}function Cr(Lt,xt,Vt){if(typeof xt=="string"&&xt!==""||typeof xt=="number")return xt=rn(""+xt,Lt.mode,Vt),xt.return=Lt,xt;if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case Be:return Vt=Pn(xt.type,xt.key,xt.props,null,Lt.mode,Vt),Vt.ref=Ju(Lt,null,xt),Vt.return=Lt,Vt;case rt:return xt=oi(xt,Lt.mode,Vt),xt.return=Lt,xt;case Ut:var Br=xt._init;return Cr(Lt,Br(xt._payload),Vt)}if(Ke(xt)||Mt(xt))return xt=Wr(xt,Lt.mode,Vt,null),xt.return=Lt,xt;_f(Lt,xt)}return null}function mr(Lt,xt,Vt,Br){var Nn=xt!==null?xt.key:null;if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Nn!==null?null:Ye(Lt,xt,""+Vt,Br);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case Be:return Vt.key===Nn?ft(Lt,xt,Vt,Br):null;case rt:return Vt.key===Nn?Bt(Lt,xt,Vt,Br):null;case Ut:return Nn=Vt._init,mr(Lt,xt,Nn(Vt._payload),Br)}if(Ke(Vt)||Mt(Vt))return Nn!==null?null:vr(Lt,xt,Vt,Br,null);_f(Lt,Vt)}return null}function Kr(Lt,xt,Vt,Br,Nn){if(typeof Br=="string"&&Br!==""||typeof Br=="number")return Lt=Lt.get(Vt)||null,Ye(xt,Lt,""+Br,Nn);if(typeof Br=="object"&&Br!==null){switch(Br.$$typeof){case Be:return Lt=Lt.get(Br.key===null?Vt:Br.key)||null,ft(xt,Lt,Br,Nn);case rt:return Lt=Lt.get(Br.key===null?Vt:Br.key)||null,Bt(xt,Lt,Br,Nn);case Ut:var Hn=Br._init;return Kr(Lt,xt,Vt,Hn(Br._payload),Nn)}if(Ke(Br)||Mt(Br))return Lt=Lt.get(Vt)||null,vr(xt,Lt,Br,Nn,null);_f(xt,Br)}return null}function on(Lt,xt,Vt,Br){for(var Nn=null,Hn=null,Zn=xt,Xn=xt=0,Yo=null;Zn!==null&&Xn<Vt.length;Xn++){Zn.index>Xn?(Yo=Zn,Zn=null):Yo=Zn.sibling;var ai=mr(Lt,Zn,Vt[Xn],Br);if(ai===null){Zn===null&&(Zn=Yo);break}_&&Zn&&ai.alternate===null&&w(Lt,Zn),xt=ie(ai,xt,Xn),Hn===null?Nn=ai:Hn.sibling=ai,Hn=ai,Zn=Yo}if(Xn===Vt.length)return P(Lt,Zn),ds&&du(Lt,Xn),Nn;if(Zn===null){for(;Xn<Vt.length;Xn++)Zn=Cr(Lt,Vt[Xn],Br),Zn!==null&&(xt=ie(Zn,xt,Xn),Hn===null?Nn=Zn:Hn.sibling=Zn,Hn=Zn);return ds&&du(Lt,Xn),Nn}for(Zn=z(Lt,Zn);Xn<Vt.length;Xn++)Yo=Kr(Zn,Lt,Xn,Vt[Xn],Br),Yo!==null&&(_&&Yo.alternate!==null&&Zn.delete(Yo.key===null?Xn:Yo.key),xt=ie(Yo,xt,Xn),Hn===null?Nn=Yo:Hn.sibling=Yo,Hn=Yo);return _&&Zn.forEach(function(Vl){return w(Lt,Vl)}),ds&&du(Lt,Xn),Nn}function nn(Lt,xt,Vt,Br){var Nn=Mt(Vt);if(typeof Nn!="function")throw Error(a(150));if(Vt=Nn.call(Vt),Vt==null)throw Error(a(151));for(var Hn=Nn=null,Zn=xt,Xn=xt=0,Yo=null,ai=Vt.next();Zn!==null&&!ai.done;Xn++,ai=Vt.next()){Zn.index>Xn?(Yo=Zn,Zn=null):Yo=Zn.sibling;var Vl=mr(Lt,Zn,ai.value,Br);if(Vl===null){Zn===null&&(Zn=Yo);break}_&&Zn&&Vl.alternate===null&&w(Lt,Zn),xt=ie(Vl,xt,Xn),Hn===null?Nn=Vl:Hn.sibling=Vl,Hn=Vl,Zn=Yo}if(ai.done)return P(Lt,Zn),ds&&du(Lt,Xn),Nn;if(Zn===null){for(;!ai.done;Xn++,ai=Vt.next())ai=Cr(Lt,ai.value,Br),ai!==null&&(xt=ie(ai,xt,Xn),Hn===null?Nn=ai:Hn.sibling=ai,Hn=ai);return ds&&du(Lt,Xn),Nn}for(Zn=z(Lt,Zn);!ai.done;Xn++,ai=Vt.next())ai=Kr(Zn,Lt,Xn,ai.value,Br),ai!==null&&(_&&ai.alternate!==null&&Zn.delete(ai.key===null?Xn:ai.key),xt=ie(ai,xt,Xn),Hn===null?Nn=ai:Hn.sibling=ai,Hn=ai);return _&&Zn.forEach(function(Ow){return w(Lt,Ow)}),ds&&du(Lt,Xn),Nn}function ps(Lt,xt,Vt,Br){if(typeof Vt=="object"&&Vt!==null&&Vt.type===We&&Vt.key===null&&(Vt=Vt.props.children),typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case Be:e:{for(var Nn=Vt.key,Hn=xt;Hn!==null;){if(Hn.key===Nn){if(Nn=Vt.type,Nn===We){if(Hn.tag===7){P(Lt,Hn.sibling),xt=Z(Hn,Vt.props.children),xt.return=Lt,Lt=xt;break e}}else if(Hn.elementType===Nn||typeof Nn=="object"&&Nn!==null&&Nn.$$typeof===Ut&&Tp(Nn)===Hn.type){P(Lt,Hn.sibling),xt=Z(Hn,Vt.props),xt.ref=Ju(Lt,Hn,Vt),xt.return=Lt,Lt=xt;break e}P(Lt,Hn);break}else w(Lt,Hn);Hn=Hn.sibling}Vt.type===We?(xt=Wr(Vt.props.children,Lt.mode,Br,Vt.key),xt.return=Lt,Lt=xt):(Br=Pn(Vt.type,Vt.key,Vt.props,null,Lt.mode,Br),Br.ref=Ju(Lt,xt,Vt),Br.return=Lt,Lt=Br)}return we(Lt);case rt:e:{for(Hn=Vt.key;xt!==null;){if(xt.key===Hn)if(xt.tag===4&&xt.stateNode.containerInfo===Vt.containerInfo&&xt.stateNode.implementation===Vt.implementation){P(Lt,xt.sibling),xt=Z(xt,Vt.children||[]),xt.return=Lt,Lt=xt;break e}else{P(Lt,xt);break}else w(Lt,xt);xt=xt.sibling}xt=oi(Vt,Lt.mode,Br),xt.return=Lt,Lt=xt}return we(Lt);case Ut:return Hn=Vt._init,ps(Lt,xt,Hn(Vt._payload),Br)}if(Ke(Vt))return on(Lt,xt,Vt,Br);if(Mt(Vt))return nn(Lt,xt,Vt,Br);_f(Lt,Vt)}return typeof Vt=="string"&&Vt!==""||typeof Vt=="number"?(Vt=""+Vt,xt!==null&&xt.tag===6?(P(Lt,xt.sibling),xt=Z(xt,Vt),xt.return=Lt,Lt=xt):(P(Lt,xt),xt=rn(Vt,Lt.mode,Br),xt.return=Lt,Lt=xt),we(Lt)):P(Lt,xt)}return ps}var ed=xf(!0),Ep=xf(!1),fu=cu(null),kc=null,oh=null,Cp=null;function Fm(){Cp=oh=kc=null}function ah(_){var w=fu.current;Ts(fu),_._currentValue=w}function td(_,w,P){for(;_!==null;){var z=_.alternate;if((_.childLanes&w)!==w?(_.childLanes|=w,z!==null&&(z.childLanes|=w)):z!==null&&(z.childLanes&w)!==w&&(z.childLanes|=w),_===P)break;_=_.return}}function Qa(_,w){kc=_,Cp=oh=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&w)!==0&&(Ca=!0),_.firstContext=null)}function la(_){var w=_._currentValue;if(Cp!==_)if(_={context:_,memoizedValue:w,next:null},oh===null){if(kc===null)throw Error(a(308));oh=_,kc.dependencies={lanes:0,firstContext:_}}else oh=oh.next=_;return w}var Ja=null;function lh(_){Ja===null?Ja=[_]:Ja.push(_)}function ch(_,w,P,z){var Z=w.interleaved;return Z===null?(P.next=P,lh(w)):(P.next=Z.next,Z.next=P),w.interleaved=P,cl(_,z)}function cl(_,w){_.lanes|=w;var P=_.alternate;for(P!==null&&(P.lanes|=w),P=_,_=_.return;_!==null;)_.childLanes|=w,P=_.alternate,P!==null&&(P.childLanes|=w),P=_,_=_.return;return P.tag===3?P.stateNode:null}var Zo=!1;function Ap(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gg(_,w){_=_.updateQueue,w.updateQueue===_&&(w.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Ea(_,w){return{eventTime:_,lane:w,tag:0,payload:null,callback:null,next:null}}function Ll(_,w,P){var z=_.updateQueue;if(z===null)return null;if(z=z.shared,(Ji&2)!==0){var Z=z.pending;return Z===null?w.next=w:(w.next=Z.next,Z.next=w),z.pending=w,cl(_,P)}return Z=z.interleaved,Z===null?(w.next=w,lh(z)):(w.next=Z.next,Z.next=w),z.interleaved=w,cl(_,P)}function hr(_,w,P){if(w=w.updateQueue,w!==null&&(w=w.shared,(P&4194240)!==0)){var z=w.lanes;z&=_.pendingLanes,P|=z,w.lanes=P,Vn(_,P)}}function Ip(_,w){var P=_.updateQueue,z=_.alternate;if(z!==null&&(z=z.updateQueue,P===z)){var Z=null,ie=null;if(P=P.firstBaseUpdate,P!==null){do{var we={eventTime:P.eventTime,lane:P.lane,tag:P.tag,payload:P.payload,callback:P.callback,next:null};ie===null?Z=ie=we:ie=ie.next=we,P=P.next}while(P!==null);ie===null?Z=ie=w:ie=ie.next=w}else Z=ie=w;P={baseState:z.baseState,firstBaseUpdate:Z,lastBaseUpdate:ie,shared:z.shared,effects:z.effects},_.updateQueue=P;return}_=P.lastBaseUpdate,_===null?P.firstBaseUpdate=w:_.next=w,P.lastBaseUpdate=w}function Va(_,w,P,z){var Z=_.updateQueue;Zo=!1;var ie=Z.firstBaseUpdate,we=Z.lastBaseUpdate,Ye=Z.shared.pending;if(Ye!==null){Z.shared.pending=null;var ft=Ye,Bt=ft.next;ft.next=null,we===null?ie=Bt:we.next=Bt,we=ft;var vr=_.alternate;vr!==null&&(vr=vr.updateQueue,Ye=vr.lastBaseUpdate,Ye!==we&&(Ye===null?vr.firstBaseUpdate=Bt:Ye.next=Bt,vr.lastBaseUpdate=ft))}if(ie!==null){var Cr=Z.baseState;we=0,vr=Bt=ft=null,Ye=ie;do{var mr=Ye.lane,Kr=Ye.eventTime;if((z&mr)===mr){vr!==null&&(vr=vr.next={eventTime:Kr,lane:0,tag:Ye.tag,payload:Ye.payload,callback:Ye.callback,next:null});e:{var on=_,nn=Ye;switch(mr=w,Kr=P,nn.tag){case 1:if(on=nn.payload,typeof on=="function"){Cr=on.call(Kr,Cr,mr);break e}Cr=on;break e;case 3:on.flags=on.flags&-65537|128;case 0:if(on=nn.payload,mr=typeof on=="function"?on.call(Kr,Cr,mr):on,mr==null)break e;Cr=Qt({},Cr,mr);break e;case 2:Zo=!0}}Ye.callback!==null&&Ye.lane!==0&&(_.flags|=64,mr=Z.effects,mr===null?Z.effects=[Ye]:mr.push(Ye))}else Kr={eventTime:Kr,lane:mr,tag:Ye.tag,payload:Ye.payload,callback:Ye.callback,next:null},vr===null?(Bt=vr=Kr,ft=Cr):vr=vr.next=Kr,we|=mr;if(Ye=Ye.next,Ye===null){if(Ye=Z.shared.pending,Ye===null)break;mr=Ye,Ye=mr.next,mr.next=null,Z.lastBaseUpdate=mr,Z.shared.pending=null}}while(!0);if(vr===null&&(ft=Cr),Z.baseState=ft,Z.firstBaseUpdate=Bt,Z.lastBaseUpdate=vr,w=Z.shared.interleaved,w!==null){Z=w;do we|=Z.lane,Z=Z.next;while(Z!==w)}else ie===null&&(Z.shared.lanes=0);vo|=we,_.lanes=we,_.memoizedState=Cr}}function dc(_,w,P){if(_=w.effects,w.effects=null,_!==null)for(w=0;w<_.length;w++){var z=_[w],Z=z.callback;if(Z!==null){if(z.callback=null,z=P,typeof Z!="function")throw Error(a(191,Z));Z.call(z)}}}var uh={},Dl=cu(uh),pu=cu(uh),mu=cu(uh);function Nc(_){if(_===uh)throw Error(a(174));return _}function vf(_,w){switch(vs(mu,w),vs(pu,_),vs(Dl,uh),_=w.nodeType,_){case 9:case 11:w=(w=w.documentElement)?w.namespaceURI:sn(null,"");break;default:_=_===8?w.parentNode:w,w=_.namespaceURI||null,_=_.tagName,w=sn(w,_)}Ts(Dl),vs(Dl,w)}function Ol(){Ts(Dl),Ts(pu),Ts(mu)}function rd(_){Nc(mu.current);var w=Nc(Dl.current),P=sn(w,_.type);w!==P&&(vs(pu,_),vs(Dl,P))}function nd(_){pu.current===_&&(Ts(Dl),Ts(pu))}var ns=cu(0);function bf(_){for(var w=_;w!==null;){if(w.tag===13){var P=w.memoizedState;if(P!==null&&(P=P.dehydrated,P===null||P.data==="$?"||P.data==="$!"))return w}else if(w.tag===19&&w.memoizedProps.revealOrder!==void 0){if((w.flags&128)!==0)return w}else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return null;w=w.return}w.sibling.return=w.return,w=w.sibling}return null}var Pp=[];function kp(){for(var _=0;_<Pp.length;_++)Pp[_]._workInProgressVersionPrimary=null;Pp.length=0}var wf=Re.ReactCurrentDispatcher,Sf=Re.ReactCurrentBatchConfig,ul=0,Ps=null,Ks=null,Ys=null,Tf=!1,dh=!1,id=0,Wg=0;function Mo(){throw Error(a(321))}function Np(_,w){if(w===null)return!1;for(var P=0;P<w.length&&P<_.length;P++)if(!Vs(_[P],w[P]))return!1;return!0}function Ef(_,w,P,z,Z,ie){if(ul=ie,Ps=w,w.memoizedState=null,w.updateQueue=null,w.lanes=0,wf.current=_===null||_.memoizedState===null?Zg:Dp,_=P(z,Z),dh){ie=0;do{if(dh=!1,id=0,25<=ie)throw Error(a(301));ie+=1,Ys=Ks=null,w.updateQueue=null,wf.current=Gm,_=P(z,Z)}while(dh)}if(wf.current=He,w=Ks!==null&&Ks.next!==null,ul=0,Ys=Ks=Ps=null,Tf=!1,w)throw Error(a(300));return _}function Cf(){var _=id!==0;return id=0,_}function dl(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ys===null?Ps.memoizedState=Ys=_:Ys=Ys.next=_,Ys}function hl(){if(Ks===null){var _=Ps.alternate;_=_!==null?_.memoizedState:null}else _=Ks.next;var w=Ys===null?Ps.memoizedState:Ys.next;if(w!==null)Ys=w,Ks=_;else{if(_===null)throw Error(a(310));Ks=_,_={memoizedState:Ks.memoizedState,baseState:Ks.baseState,baseQueue:Ks.baseQueue,queue:Ks.queue,next:null},Ys===null?Ps.memoizedState=Ys=_:Ys=Ys.next=_}return Ys}function Af(_,w){return typeof w=="function"?w(_):w}function jp(_){var w=hl(),P=w.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=_;var z=Ks,Z=z.baseQueue,ie=P.pending;if(ie!==null){if(Z!==null){var we=Z.next;Z.next=ie.next,ie.next=we}z.baseQueue=Z=ie,P.pending=null}if(Z!==null){ie=Z.next,z=z.baseState;var Ye=we=null,ft=null,Bt=ie;do{var vr=Bt.lane;if((ul&vr)===vr)ft!==null&&(ft=ft.next={lane:0,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null}),z=Bt.hasEagerState?Bt.eagerState:_(z,Bt.action);else{var Cr={lane:vr,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null};ft===null?(Ye=ft=Cr,we=z):ft=ft.next=Cr,Ps.lanes|=vr,vo|=vr}Bt=Bt.next}while(Bt!==null&&Bt!==ie);ft===null?we=z:ft.next=Ye,Vs(z,w.memoizedState)||(Ca=!0),w.memoizedState=z,w.baseState=we,w.baseQueue=ft,P.lastRenderedState=z}if(_=P.interleaved,_!==null){Z=_;do ie=Z.lane,Ps.lanes|=ie,vo|=ie,Z=Z.next;while(Z!==_)}else Z===null&&(P.lanes=0);return[w.memoizedState,P.dispatch]}function hc(_){var w=hl(),P=w.queue;if(P===null)throw Error(a(311));P.lastRenderedReducer=_;var z=P.dispatch,Z=P.pending,ie=w.memoizedState;if(Z!==null){P.pending=null;var we=Z=Z.next;do ie=_(ie,we.action),we=we.next;while(we!==Z);Vs(ie,w.memoizedState)||(Ca=!0),w.memoizedState=ie,w.baseQueue===null&&(w.baseState=ie),P.lastRenderedState=ie}return[ie,z]}function Bm(){}function Rp(_,w){var P=Ps,z=hl(),Z=w(),ie=!Vs(z.memoizedState,Z);if(ie&&(z.memoizedState=Z,Ca=!0),z=z.queue,kf(Hg.bind(null,P,z,_),[_]),z.getSnapshot!==w||ie||Ys!==null&&Ys.memoizedState.tag&1){if(P.flags|=2048,uo(9,Vm.bind(null,P,z,Z,w),void 0,null),$s===null)throw Error(a(349));(ul&30)!==0||If(P,w,Z)}return Z}function If(_,w,P){_.flags|=16384,_={getSnapshot:w,value:P},w=Ps.updateQueue,w===null?(w={lastEffect:null,stores:null},Ps.updateQueue=w,w.stores=[_]):(P=w.stores,P===null?w.stores=[_]:P.push(_))}function Vm(_,w,P,z){w.value=P,w.getSnapshot=z,jc(w)&&ca(_)}function Hg(_,w,P){return P(function(){jc(w)&&ca(_)})}function jc(_){var w=_.getSnapshot;_=_.value;try{var P=w();return!Vs(_,P)}catch{return!0}}function ca(_){var w=cl(_,1);w!==null&&G(w,_,1,-1)}function Rc(_){var w=dl();return typeof _=="function"&&(_=_()),w.memoizedState=w.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Af,lastRenderedState:_},w.queue=_,_=_.dispatch=zt.bind(null,Ps,_),[w.memoizedState,_]}function uo(_,w,P,z){return _={tag:_,create:w,destroy:P,deps:z,next:null},w=Ps.updateQueue,w===null?(w={lastEffect:null,stores:null},Ps.updateQueue=w,w.lastEffect=_.next=_):(P=w.lastEffect,P===null?w.lastEffect=_.next=_:(z=P.next,P.next=_,_.next=z,w.lastEffect=_)),_}function Mc(){return hl().memoizedState}function Pf(_,w,P,z){var Z=dl();Ps.flags|=_,Z.memoizedState=uo(1|w,P,void 0,z===void 0?null:z)}function hh(_,w,P,z){var Z=hl();z=z===void 0?null:z;var ie=void 0;if(Ks!==null){var we=Ks.memoizedState;if(ie=we.destroy,z!==null&&Np(z,we.deps)){Z.memoizedState=uo(w,P,ie,z);return}}Ps.flags|=_,Z.memoizedState=uo(1|w,P,ie,z)}function Mp(_,w){return Pf(8390656,8,_,w)}function kf(_,w){return hh(2048,8,_,w)}function Lp(_,w){return hh(4,2,_,w)}function fl(_,w){return hh(4,4,_,w)}function bi(_,w){if(typeof w=="function")return _=_(),w(_),function(){w(null)};if(w!=null)return _=_(),w.current=_,function(){w.current=null}}function fh(_,w,P){return P=P!=null?P.concat([_]):null,hh(4,4,bi.bind(null,w,_),P)}function sd(){}function od(_,w){var P=hl();w=w===void 0?null:w;var z=P.memoizedState;return z!==null&&w!==null&&Np(w,z[1])?z[0]:(P.memoizedState=[_,w],_)}function Um(_,w){var P=hl();w=w===void 0?null:w;var z=P.memoizedState;return z!==null&&w!==null&&Np(w,z[1])?z[0]:(_=_(),P.memoizedState=[_,w],_)}function $m(_,w,P){return(ul&21)===0?(_.baseState&&(_.baseState=!1,Ca=!0),_.memoizedState=P):(Vs(P,w)||(P=lo(),Ps.lanes|=P,vo|=P,_.baseState=!0),w)}function qm(_,w){var P=$n;$n=P!==0&&4>P?P:4,_(!0);var z=Sf.transition;Sf.transition={};try{_(!1),w()}finally{$n=P,Sf.transition=z}}function gu(){return hl().memoizedState}function ua(_,w,P){var z=U(_);if(P={lane:z,action:P,hasEagerState:!1,eagerState:null,next:null},er(_))ad(w,P);else if(P=ch(_,w,P,z),P!==null){var Z=q();G(P,_,z,Z),is(P,w,z)}}function zt(_,w,P){var z=U(_),Z={lane:z,action:P,hasEagerState:!1,eagerState:null,next:null};if(er(_))ad(w,Z);else{var ie=_.alternate;if(_.lanes===0&&(ie===null||ie.lanes===0)&&(ie=w.lastRenderedReducer,ie!==null))try{var we=w.lastRenderedState,Ye=ie(we,P);if(Z.hasEagerState=!0,Z.eagerState=Ye,Vs(Ye,we)){var ft=w.interleaved;ft===null?(Z.next=Z,lh(w)):(Z.next=ft.next,ft.next=Z),w.interleaved=Z;return}}catch{}finally{}P=ch(_,w,Z,z),P!==null&&(Z=q(),G(P,_,z,Z),is(P,w,z))}}function er(_){var w=_.alternate;return _===Ps||w!==null&&w===Ps}function ad(_,w){dh=Tf=!0;var P=_.pending;P===null?w.next=w:(w.next=P.next,P.next=w),_.pending=w}function is(_,w,P){if((P&4194240)!==0){var z=w.lanes;z&=_.pendingLanes,P|=z,w.lanes=P,Vn(_,P)}}var He={readContext:la,useCallback:Mo,useContext:Mo,useEffect:Mo,useImperativeHandle:Mo,useInsertionEffect:Mo,useLayoutEffect:Mo,useMemo:Mo,useReducer:Mo,useRef:Mo,useState:Mo,useDebugValue:Mo,useDeferredValue:Mo,useTransition:Mo,useMutableSource:Mo,useSyncExternalStore:Mo,useId:Mo,unstable_isNewReconciler:!1},Zg={readContext:la,useCallback:function(_,w){return dl().memoizedState=[_,w===void 0?null:w],_},useContext:la,useEffect:Mp,useImperativeHandle:function(_,w,P){return P=P!=null?P.concat([_]):null,Pf(4194308,4,bi.bind(null,w,_),P)},useLayoutEffect:function(_,w){return Pf(4194308,4,_,w)},useInsertionEffect:function(_,w){return Pf(4,2,_,w)},useMemo:function(_,w){var P=dl();return w=w===void 0?null:w,_=_(),P.memoizedState=[_,w],_},useReducer:function(_,w,P){var z=dl();return w=P!==void 0?P(w):w,z.memoizedState=z.baseState=w,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:w},z.queue=_,_=_.dispatch=ua.bind(null,Ps,_),[z.memoizedState,_]},useRef:function(_){var w=dl();return _={current:_},w.memoizedState=_},useState:Rc,useDebugValue:sd,useDeferredValue:function(_){return dl().memoizedState=_},useTransition:function(){var _=Rc(!1),w=_[0];return _=qm.bind(null,_[1]),dl().memoizedState=_,[w,_]},useMutableSource:function(){},useSyncExternalStore:function(_,w,P){var z=Ps,Z=dl();if(ds){if(P===void 0)throw Error(a(407));P=P()}else{if(P=w(),$s===null)throw Error(a(349));(ul&30)!==0||If(z,w,P)}Z.memoizedState=P;var ie={value:P,getSnapshot:w};return Z.queue=ie,Mp(Hg.bind(null,z,ie,_),[_]),z.flags|=2048,uo(9,Vm.bind(null,z,ie,P,w),void 0,null),P},useId:function(){var _=dl(),w=$s.identifierPrefix;if(ds){var P=cc,z=Pc;P=(z&~(1<<32-In(z)-1)).toString(32)+P,w=":"+w+"R"+P,P=id++,0<P&&(w+="H"+P.toString(32)),w+=":"}else P=Wg++,w=":"+w+"r"+P.toString(32)+":";return _.memoizedState=w},unstable_isNewReconciler:!1},Dp={readContext:la,useCallback:od,useContext:la,useEffect:kf,useImperativeHandle:fh,useInsertionEffect:Lp,useLayoutEffect:fl,useMemo:Um,useReducer:jp,useRef:Mc,useState:function(){return jp(Af)},useDebugValue:sd,useDeferredValue:function(_){var w=hl();return $m(w,Ks.memoizedState,_)},useTransition:function(){var _=jp(Af)[0],w=hl().memoizedState;return[_,w]},useMutableSource:Bm,useSyncExternalStore:Rp,useId:gu,unstable_isNewReconciler:!1},Gm={readContext:la,useCallback:od,useContext:la,useEffect:kf,useImperativeHandle:fh,useInsertionEffect:Lp,useLayoutEffect:fl,useMemo:Um,useReducer:hc,useRef:Mc,useState:function(){return hc(Af)},useDebugValue:sd,useDeferredValue:function(_){var w=hl();return Ks===null?w.memoizedState=_:$m(w,Ks.memoizedState,_)},useTransition:function(){var _=hc(Af)[0],w=hl().memoizedState;return[_,w]},useMutableSource:Bm,useSyncExternalStore:Rp,useId:gu,unstable_isNewReconciler:!1};function el(_,w){if(_&&_.defaultProps){w=Qt({},w),_=_.defaultProps;for(var P in _)w[P]===void 0&&(w[P]=_[P]);return w}return w}function Op(_,w,P,z){w=_.memoizedState,P=P(z,w),P=P==null?w:Qt({},w,P),_.memoizedState=P,_.lanes===0&&(_.updateQueue.baseState=P)}var ph={isMounted:function(_){return(_=_._reactInternals)?Fe(_)===_:!1},enqueueSetState:function(_,w,P){_=_._reactInternals;var z=q(),Z=U(_),ie=Ea(z,Z);ie.payload=w,P!=null&&(ie.callback=P),w=Ll(_,ie,Z),w!==null&&(G(w,_,Z,z),hr(w,_,Z))},enqueueReplaceState:function(_,w,P){_=_._reactInternals;var z=q(),Z=U(_),ie=Ea(z,Z);ie.tag=1,ie.payload=w,P!=null&&(ie.callback=P),w=Ll(_,ie,Z),w!==null&&(G(w,_,Z,z),hr(w,_,Z))},enqueueForceUpdate:function(_,w){_=_._reactInternals;var P=q(),z=U(_),Z=Ea(P,z);Z.tag=2,w!=null&&(Z.callback=w),w=Ll(_,Z,z),w!==null&&(G(w,_,z,P),hr(w,_,z))}};function ld(_,w,P,z,Z,ie,we){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(z,ie,we):w.prototype&&w.prototype.isPureReactComponent?!Vd(P,z)||!Vd(Z,ie):!0}function Xg(_,w,P){var z=!1,Z=oc,ie=w.contextType;return typeof ie=="object"&&ie!==null?ie=la(ie):(Z=go(w)?ac:Ro.current,z=w.contextTypes,ie=(z=z!=null)?Ac(_,Z):oc),w=new w(P,ie),_.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=ph,_.stateNode=w,w._reactInternals=_,z&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=Z,_.__reactInternalMemoizedMaskedChildContext=ie),w}function Kg(_,w,P,z){_=w.state,typeof w.componentWillReceiveProps=="function"&&w.componentWillReceiveProps(P,z),typeof w.UNSAFE_componentWillReceiveProps=="function"&&w.UNSAFE_componentWillReceiveProps(P,z),w.state!==_&&ph.enqueueReplaceState(w,w.state,null)}function Nf(_,w,P,z){var Z=_.stateNode;Z.props=P,Z.state=_.memoizedState,Z.refs={},Ap(_);var ie=w.contextType;typeof ie=="object"&&ie!==null?Z.context=la(ie):(ie=go(w)?ac:Ro.current,Z.context=Ac(_,ie)),Z.state=_.memoizedState,ie=w.getDerivedStateFromProps,typeof ie=="function"&&(Op(_,w,ie,P),Z.state=_.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof Z.getSnapshotBeforeUpdate=="function"||typeof Z.UNSAFE_componentWillMount!="function"&&typeof Z.componentWillMount!="function"||(w=Z.state,typeof Z.componentWillMount=="function"&&Z.componentWillMount(),typeof Z.UNSAFE_componentWillMount=="function"&&Z.UNSAFE_componentWillMount(),w!==Z.state&&ph.enqueueReplaceState(Z,Z.state,null),Va(_,P,Z,z),Z.state=_.memoizedState),typeof Z.componentDidMount=="function"&&(_.flags|=4194308)}function fc(_,w){try{var P="",z=w;do P+=yn(z),z=z.return;while(z);var Z=P}catch(ie){Z=`
Error generating stack: `+ie.message+`
`+ie.stack}return{value:_,source:w,stack:Z,digest:null}}function pl(_,w,P){return{value:_,source:null,stack:P??null,digest:w??null}}function jf(_,w){try{console.error(w.value)}catch(P){setTimeout(function(){throw P})}}var Yg=typeof WeakMap=="function"?WeakMap:Map;function Rf(_,w,P){P=Ea(-1,P),P.tag=3,P.payload={element:null};var z=w.value;return P.callback=function(){t||(t=!0,c=z),jf(_,w)},P}function mh(_,w,P){P=Ea(-1,P),P.tag=3;var z=_.type.getDerivedStateFromError;if(typeof z=="function"){var Z=w.value;P.payload=function(){return z(Z)},P.callback=function(){jf(_,w)}}var ie=_.stateNode;return ie!==null&&typeof ie.componentDidCatch=="function"&&(P.callback=function(){jf(_,w),typeof z!="function"&&(p===null?p=new Set([this]):p.add(this));var we=w.stack;this.componentDidCatch(w.value,{componentStack:we!==null?we:""})}),P}function yu(_,w,P){var z=_.pingCache;if(z===null){z=_.pingCache=new Yg;var Z=new Set;z.set(w,Z)}else Z=z.get(w),Z===void 0&&(Z=new Set,z.set(w,Z));Z.has(P)||(Z.add(P),_=Dt.bind(null,_,w,P),w.then(_,_))}function zp(_){do{var w;if((w=_.tag===13)&&(w=_.memoizedState,w=w!==null?w.dehydrated!==null:!0),w)return _;_=_.return}while(_!==null);return null}function Fp(_,w,P,z,Z){return(_.mode&1)===0?(_===w?_.flags|=65536:(_.flags|=128,P.flags|=131072,P.flags&=-52805,P.tag===1&&(P.alternate===null?P.tag=17:(w=Ea(-1,1),w.tag=2,Ll(P,w,1))),P.lanes|=1),_):(_.flags|=65536,_.lanes=Z,_)}var Qg=Re.ReactCurrentOwner,Ca=!1;function da(_,w,P,z){w.child=_===null?Ep(w,null,P,z):ed(w,_.child,P,z)}function Xo(_,w,P,z,Z){P=P.render;var ie=w.ref;return Qa(w,Z),z=Ef(_,w,P,z,ie,Z),P=Cf(),_!==null&&!Ca?(w.updateQueue=_.updateQueue,w.flags&=-2053,_.lanes&=~Z,Fl(_,w,Z)):(ds&&P&&Lm(w),w.flags|=1,da(_,w,z,Z),w.child)}function Wm(_,w,P,z,Z){if(_===null){var ie=P.type;return typeof ie=="function"&&!Mr(ie)&&ie.defaultProps===void 0&&P.compare===null&&P.defaultProps===void 0?(w.tag=15,w.type=ie,Lc(_,w,ie,z,Z)):(_=Pn(P.type,null,z,w,w.mode,Z),_.ref=w.ref,_.return=w,w.child=_)}if(ie=_.child,(_.lanes&Z)===0){var we=ie.memoizedProps;if(P=P.compare,P=P!==null?P:Vd,P(we,z)&&_.ref===w.ref)return Fl(_,w,Z)}return w.flags|=1,_=tn(ie,z),_.ref=w.ref,_.return=w,w.child=_}function Lc(_,w,P,z,Z){if(_!==null){var ie=_.memoizedProps;if(Vd(ie,z)&&_.ref===w.ref)if(Ca=!1,w.pendingProps=z=ie,(_.lanes&Z)!==0)(_.flags&131072)!==0&&(Ca=!0);else return w.lanes=_.lanes,Fl(_,w,Z)}return Tn(_,w,P,z,Z)}function Jg(_,w,P){var z=w.pendingProps,Z=z.children,ie=_!==null?_.memoizedState:null;if(z.mode==="hidden")if((w.mode&1)===0)w.memoizedState={baseLanes:0,cachePool:null,transitions:null},vs(ha,Ko),Ko|=P;else{if((P&1073741824)===0)return _=ie!==null?ie.baseLanes|P:P,w.lanes=w.childLanes=1073741824,w.memoizedState={baseLanes:_,cachePool:null,transitions:null},w.updateQueue=null,vs(ha,Ko),Ko|=_,null;w.memoizedState={baseLanes:0,cachePool:null,transitions:null},z=ie!==null?ie.baseLanes:P,vs(ha,Ko),Ko|=z}else ie!==null?(z=ie.baseLanes|P,w.memoizedState=null):z=P,vs(ha,Ko),Ko|=z;return da(_,w,Z,P),w.child}function zi(_,w){var P=w.ref;(_===null&&P!==null||_!==null&&_.ref!==P)&&(w.flags|=512,w.flags|=2097152)}function Tn(_,w,P,z,Z){var ie=go(P)?ac:Ro.current;return ie=Ac(w,ie),Qa(w,Z),P=Ef(_,w,P,z,ie,Z),z=Cf(),_!==null&&!Ca?(w.updateQueue=_.updateQueue,w.flags&=-2053,_.lanes&=~Z,Fl(_,w,Z)):(ds&&z&&Lm(w),w.flags|=1,da(_,w,P,Z),w.child)}function Hm(_,w,P,z,Z){if(go(P)){var ie=!0;Xu(w)}else ie=!1;if(Qa(w,Z),w.stateNode===null)yh(_,w),Xg(w,P,z),Nf(w,P,z,Z),z=!0;else if(_===null){var we=w.stateNode,Ye=w.memoizedProps;we.props=Ye;var ft=we.context,Bt=P.contextType;typeof Bt=="object"&&Bt!==null?Bt=la(Bt):(Bt=go(P)?ac:Ro.current,Bt=Ac(w,Bt));var vr=P.getDerivedStateFromProps,Cr=typeof vr=="function"||typeof we.getSnapshotBeforeUpdate=="function";Cr||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(Ye!==z||ft!==Bt)&&Kg(w,we,z,Bt),Zo=!1;var mr=w.memoizedState;we.state=mr,Va(w,z,we,Z),ft=w.memoizedState,Ye!==z||mr!==ft||Sa.current||Zo?(typeof vr=="function"&&(Op(w,P,vr,z),ft=w.memoizedState),(Ye=Zo||ld(w,P,Ye,z,mr,ft,Bt))?(Cr||typeof we.UNSAFE_componentWillMount!="function"&&typeof we.componentWillMount!="function"||(typeof we.componentWillMount=="function"&&we.componentWillMount(),typeof we.UNSAFE_componentWillMount=="function"&&we.UNSAFE_componentWillMount()),typeof we.componentDidMount=="function"&&(w.flags|=4194308)):(typeof we.componentDidMount=="function"&&(w.flags|=4194308),w.memoizedProps=z,w.memoizedState=ft),we.props=z,we.state=ft,we.context=Bt,z=Ye):(typeof we.componentDidMount=="function"&&(w.flags|=4194308),z=!1)}else{we=w.stateNode,Gg(_,w),Ye=w.memoizedProps,Bt=w.type===w.elementType?Ye:el(w.type,Ye),we.props=Bt,Cr=w.pendingProps,mr=we.context,ft=P.contextType,typeof ft=="object"&&ft!==null?ft=la(ft):(ft=go(P)?ac:Ro.current,ft=Ac(w,ft));var Kr=P.getDerivedStateFromProps;(vr=typeof Kr=="function"||typeof we.getSnapshotBeforeUpdate=="function")||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(Ye!==Cr||mr!==ft)&&Kg(w,we,z,ft),Zo=!1,mr=w.memoizedState,we.state=mr,Va(w,z,we,Z);var on=w.memoizedState;Ye!==Cr||mr!==on||Sa.current||Zo?(typeof Kr=="function"&&(Op(w,P,Kr,z),on=w.memoizedState),(Bt=Zo||ld(w,P,Bt,z,mr,on,ft)||!1)?(vr||typeof we.UNSAFE_componentWillUpdate!="function"&&typeof we.componentWillUpdate!="function"||(typeof we.componentWillUpdate=="function"&&we.componentWillUpdate(z,on,ft),typeof we.UNSAFE_componentWillUpdate=="function"&&we.UNSAFE_componentWillUpdate(z,on,ft)),typeof we.componentDidUpdate=="function"&&(w.flags|=4),typeof we.getSnapshotBeforeUpdate=="function"&&(w.flags|=1024)):(typeof we.componentDidUpdate!="function"||Ye===_.memoizedProps&&mr===_.memoizedState||(w.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||Ye===_.memoizedProps&&mr===_.memoizedState||(w.flags|=1024),w.memoizedProps=z,w.memoizedState=on),we.props=z,we.state=on,we.context=ft,z=Bt):(typeof we.componentDidUpdate!="function"||Ye===_.memoizedProps&&mr===_.memoizedState||(w.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||Ye===_.memoizedProps&&mr===_.memoizedState||(w.flags|=1024),z=!1)}return pc(_,w,P,z,ie,Z)}function pc(_,w,P,z,Z,ie){zi(_,w);var we=(w.flags&128)!==0;if(!z&&!we)return Z&&eh(w,P,!1),Fl(_,w,ie);z=w.stateNode,Qg.current=w;var Ye=we&&typeof P.getDerivedStateFromError!="function"?null:z.render();return w.flags|=1,_!==null&&we?(w.child=ed(w,_.child,null,ie),w.child=ed(w,null,Ye,ie)):da(_,w,Ye,ie),w.memoizedState=z.state,Z&&eh(w,P,!0),w.child}function mc(_){var w=_.stateNode;w.pendingContext?Mm(_,w.pendingContext,w.pendingContext!==w.context):w.context&&Mm(_,w.context,!1),vf(_,w.containerInfo)}function gc(_,w,P,z,Z){return Ya(),yf(Z),w.flags|=256,da(_,w,P,z),w.child}var Us={dehydrated:null,treeContext:null,retryLane:0};function _u(_){return{baseLanes:_,cachePool:null,transitions:null}}function Bp(_,w,P){var z=w.pendingProps,Z=ns.current,ie=!1,we=(w.flags&128)!==0,Ye;if((Ye=we)||(Ye=_!==null&&_.memoizedState===null?!1:(Z&2)!==0),Ye?(ie=!0,w.flags&=-129):(_===null||_.memoizedState!==null)&&(Z|=1),vs(ns,Z&1),_===null)return uc(w),_=w.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((w.mode&1)===0?w.lanes=1:_.data==="$!"?w.lanes=8:w.lanes=1073741824,null):(we=z.children,_=z.fallback,ie?(z=w.mode,ie=w.child,we={mode:"hidden",children:we},(z&1)===0&&ie!==null?(ie.childLanes=0,ie.pendingProps=we):ie=Fn(we,z,0,null),_=Wr(_,z,P,null),ie.return=w,_.return=w,ie.sibling=_,w.child=ie,w.child.memoizedState=_u(P),w.memoizedState=Us,_):Mf(w,we));if(Z=_.memoizedState,Z!==null&&(Ye=Z.dehydrated,Ye!==null))return ml(_,w,we,z,Ye,Z,P);if(ie){ie=z.fallback,we=w.mode,Z=_.child,Ye=Z.sibling;var ft={mode:"hidden",children:z.children};return(we&1)===0&&w.child!==Z?(z=w.child,z.childLanes=0,z.pendingProps=ft,w.deletions=null):(z=tn(Z,ft),z.subtreeFlags=Z.subtreeFlags&14680064),Ye!==null?ie=tn(Ye,ie):(ie=Wr(ie,we,P,null),ie.flags|=2),ie.return=w,z.return=w,z.sibling=ie,w.child=z,z=ie,ie=w.child,we=_.child.memoizedState,we=we===null?_u(P):{baseLanes:we.baseLanes|P,cachePool:null,transitions:we.transitions},ie.memoizedState=we,ie.childLanes=_.childLanes&~P,w.memoizedState=Us,z}return ie=_.child,_=ie.sibling,z=tn(ie,{mode:"visible",children:z.children}),(w.mode&1)===0&&(z.lanes=P),z.return=w,z.sibling=null,_!==null&&(P=w.deletions,P===null?(w.deletions=[_],w.flags|=16):P.push(_)),w.child=z,w.memoizedState=null,z}function Mf(_,w){return w=Fn({mode:"visible",children:w},_.mode,0,null),w.return=_,_.child=w}function gh(_,w,P,z){return z!==null&&yf(z),ed(w,_.child,null,P),_=Mf(w,w.pendingProps.children),_.flags|=2,w.memoizedState=null,_}function ml(_,w,P,z,Z,ie,we){if(P)return w.flags&256?(w.flags&=-257,z=pl(Error(a(422))),gh(_,w,we,z)):w.memoizedState!==null?(w.child=_.child,w.flags|=128,null):(ie=z.fallback,Z=w.mode,z=Fn({mode:"visible",children:z.children},Z,0,null),ie=Wr(ie,Z,we,null),ie.flags|=2,z.return=w,ie.return=w,z.sibling=ie,w.child=z,(w.mode&1)!==0&&ed(w,_.child,null,we),w.child.memoizedState=_u(we),w.memoizedState=Us,ie);if((w.mode&1)===0)return gh(_,w,we,null);if(Z.data==="$!"){if(z=Z.nextSibling&&Z.nextSibling.dataset,z)var Ye=z.dgst;return z=Ye,ie=Error(a(419)),z=pl(ie,z,void 0),gh(_,w,we,z)}if(Ye=(we&_.childLanes)!==0,Ca||Ye){if(z=$s,z!==null){switch(we&-we){case 4:Z=2;break;case 16:Z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Z=32;break;case 536870912:Z=268435456;break;default:Z=0}Z=(Z&(z.suspendedLanes|we))!==0?0:Z,Z!==0&&Z!==ie.retryLane&&(ie.retryLane=Z,cl(_,Z),G(z,_,Z,-1))}return Ue(),z=pl(Error(a(421))),gh(_,w,we,z)}return Z.data==="$?"?(w.flags|=128,w.child=_.child,w=Ot.bind(null,_),Z._reactRetry=w,null):(_=ie.treeContext,Ba=sc(Z.nextSibling),Ta=w,ds=!0,Ka=null,_!==null&&(Fa[Ho++]=Pc,Fa[Ho++]=cc,Fa[Ho++]=Yu,Pc=_.id,cc=_.overflow,Yu=w),w=Mf(w,z.children),w.flags|=4096,w)}function zl(_,w,P){_.lanes|=w;var z=_.alternate;z!==null&&(z.lanes|=w),td(_.return,w,P)}function xu(_,w,P,z,Z){var ie=_.memoizedState;ie===null?_.memoizedState={isBackwards:w,rendering:null,renderingStartTime:0,last:z,tail:P,tailMode:Z}:(ie.isBackwards=w,ie.rendering=null,ie.renderingStartTime=0,ie.last=z,ie.tail=P,ie.tailMode=Z)}function cd(_,w,P){var z=w.pendingProps,Z=z.revealOrder,ie=z.tail;if(da(_,w,z.children,P),z=ns.current,(z&2)!==0)z=z&1|2,w.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=w.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&zl(_,P,w);else if(_.tag===19)zl(_,P,w);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===w)break e;for(;_.sibling===null;){if(_.return===null||_.return===w)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}z&=1}if(vs(ns,z),(w.mode&1)===0)w.memoizedState=null;else switch(Z){case"forwards":for(P=w.child,Z=null;P!==null;)_=P.alternate,_!==null&&bf(_)===null&&(Z=P),P=P.sibling;P=Z,P===null?(Z=w.child,w.child=null):(Z=P.sibling,P.sibling=null),xu(w,!1,Z,P,ie);break;case"backwards":for(P=null,Z=w.child,w.child=null;Z!==null;){if(_=Z.alternate,_!==null&&bf(_)===null){w.child=Z;break}_=Z.sibling,Z.sibling=P,P=Z,Z=_}xu(w,!0,P,null,ie);break;case"together":xu(w,!1,null,null,void 0);break;default:w.memoizedState=null}return w.child}function yh(_,w){(w.mode&1)===0&&_!==null&&(_.alternate=null,w.alternate=null,w.flags|=2)}function Fl(_,w,P){if(_!==null&&(w.dependencies=_.dependencies),vo|=w.lanes,(P&w.childLanes)===0)return null;if(_!==null&&w.child!==_.child)throw Error(a(153));if(w.child!==null){for(_=w.child,P=tn(_,_.pendingProps),w.child=P,P.return=w;_.sibling!==null;)_=_.sibling,P=P.sibling=tn(_,_.pendingProps),P.return=w;P.sibling=null}return w.child}function vu(_,w,P){switch(w.tag){case 3:mc(w),Ya();break;case 5:rd(w);break;case 1:go(w.type)&&Xu(w);break;case 4:vf(w,w.stateNode.containerInfo);break;case 10:var z=w.type._context,Z=w.memoizedProps.value;vs(fu,z._currentValue),z._currentValue=Z;break;case 13:if(z=w.memoizedState,z!==null)return z.dehydrated!==null?(vs(ns,ns.current&1),w.flags|=128,null):(P&w.child.childLanes)!==0?Bp(_,w,P):(vs(ns,ns.current&1),_=Fl(_,w,P),_!==null?_.sibling:null);vs(ns,ns.current&1);break;case 19:if(z=(P&w.childLanes)!==0,(_.flags&128)!==0){if(z)return cd(_,w,P);w.flags|=128}if(Z=w.memoizedState,Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),vs(ns,ns.current),z)break;return null;case 22:case 23:return w.lanes=0,Jg(_,w,P)}return Fl(_,w,P)}var Vp,Aa,_h,Lf;Vp=function(_,w){for(var P=w.child;P!==null;){if(P.tag===5||P.tag===6)_.appendChild(P.stateNode);else if(P.tag!==4&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===w)break;for(;P.sibling===null;){if(P.return===null||P.return===w)return;P=P.return}P.sibling.return=P.return,P=P.sibling}},Aa=function(){},_h=function(_,w,P,z){var Z=_.memoizedProps;if(Z!==z){_=w.stateNode,Nc(Dl.current);var ie=null;switch(P){case"input":Z=Ci(_,Z),z=Ci(_,z),ie=[];break;case"select":Z=Qt({},Z,{value:void 0}),z=Qt({},z,{value:void 0}),ie=[];break;case"textarea":Z=jt(_,Z),z=jt(_,z),ie=[];break;default:typeof Z.onClick!="function"&&typeof z.onClick=="function"&&(_.onclick=xp)}Ze(P,z);var we;P=null;for(Bt in Z)if(!z.hasOwnProperty(Bt)&&Z.hasOwnProperty(Bt)&&Z[Bt]!=null)if(Bt==="style"){var Ye=Z[Bt];for(we in Ye)Ye.hasOwnProperty(we)&&(P||(P={}),P[we]="")}else Bt!=="dangerouslySetInnerHTML"&&Bt!=="children"&&Bt!=="suppressContentEditableWarning"&&Bt!=="suppressHydrationWarning"&&Bt!=="autoFocus"&&(y.hasOwnProperty(Bt)?ie||(ie=[]):(ie=ie||[]).push(Bt,null));for(Bt in z){var ft=z[Bt];if(Ye=Z?.[Bt],z.hasOwnProperty(Bt)&&ft!==Ye&&(ft!=null||Ye!=null))if(Bt==="style")if(Ye){for(we in Ye)!Ye.hasOwnProperty(we)||ft&&ft.hasOwnProperty(we)||(P||(P={}),P[we]="");for(we in ft)ft.hasOwnProperty(we)&&Ye[we]!==ft[we]&&(P||(P={}),P[we]=ft[we])}else P||(ie||(ie=[]),ie.push(Bt,P)),P=ft;else Bt==="dangerouslySetInnerHTML"?(ft=ft?ft.__html:void 0,Ye=Ye?Ye.__html:void 0,ft!=null&&Ye!==ft&&(ie=ie||[]).push(Bt,ft)):Bt==="children"?typeof ft!="string"&&typeof ft!="number"||(ie=ie||[]).push(Bt,""+ft):Bt!=="suppressContentEditableWarning"&&Bt!=="suppressHydrationWarning"&&(y.hasOwnProperty(Bt)?(ft!=null&&Bt==="onScroll"&&xs("scroll",_),ie||Ye===ft||(ie=[])):(ie=ie||[]).push(Bt,ft))}P&&(ie=ie||[]).push("style",P);var Bt=ie;(w.updateQueue=Bt)&&(w.flags|=4)}},Lf=function(_,w,P,z){P!==z&&(w.flags|=4)};function bu(_,w){if(!ds)switch(_.tailMode){case"hidden":w=_.tail;for(var P=null;w!==null;)w.alternate!==null&&(P=w),w=w.sibling;P===null?_.tail=null:P.sibling=null;break;case"collapsed":P=_.tail;for(var z=null;P!==null;)P.alternate!==null&&(z=P),P=P.sibling;z===null?w||_.tail===null?_.tail=null:_.tail.sibling=null:z.sibling=null}}function yo(_){var w=_.alternate!==null&&_.alternate.child===_.child,P=0,z=0;if(w)for(var Z=_.child;Z!==null;)P|=Z.lanes|Z.childLanes,z|=Z.subtreeFlags&14680064,z|=Z.flags&14680064,Z.return=_,Z=Z.sibling;else for(Z=_.child;Z!==null;)P|=Z.lanes|Z.childLanes,z|=Z.subtreeFlags,z|=Z.flags,Z.return=_,Z=Z.sibling;return _.subtreeFlags|=z,_.childLanes=P,w}function Os(_,w,P){var z=w.pendingProps;switch(sh(w),w.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yo(w),null;case 1:return go(w.type)&&uu(),yo(w),null;case 3:return z=w.stateNode,Ol(),Ts(Sa),Ts(Ro),kp(),z.pendingContext&&(z.context=z.pendingContext,z.pendingContext=null),(_===null||_.child===null)&&(Qu(w)?w.flags|=4:_===null||_.memoizedState.isDehydrated&&(w.flags&256)===0||(w.flags|=1024,Ka!==null&&(le(Ka),Ka=null))),Aa(_,w),yo(w),null;case 5:nd(w);var Z=Nc(mu.current);if(P=w.type,_!==null&&w.stateNode!=null)_h(_,w,P,z,Z),_.ref!==w.ref&&(w.flags|=512,w.flags|=2097152);else{if(!z){if(w.stateNode===null)throw Error(a(166));return yo(w),null}if(_=Nc(Dl.current),Qu(w)){z=w.stateNode,P=w.type;var ie=w.memoizedProps;switch(z[Xa]=w,z[au]=ie,_=(w.mode&1)!==0,P){case"dialog":xs("cancel",z),xs("close",z);break;case"iframe":case"object":case"embed":xs("load",z);break;case"video":case"audio":for(Z=0;Z<qu.length;Z++)xs(qu[Z],z);break;case"source":xs("error",z);break;case"img":case"image":case"link":xs("error",z),xs("load",z);break;case"details":xs("toggle",z);break;case"input":At(z,ie),xs("invalid",z);break;case"select":z._wrapperState={wasMultiple:!!ie.multiple},xs("invalid",z);break;case"textarea":yr(z,ie),xs("invalid",z)}Ze(P,ie),Z=null;for(var we in ie)if(ie.hasOwnProperty(we)){var Ye=ie[we];we==="children"?typeof Ye=="string"?z.textContent!==Ye&&(ie.suppressHydrationWarning!==!0&&Mi(z.textContent,Ye,_),Z=["children",Ye]):typeof Ye=="number"&&z.textContent!==""+Ye&&(ie.suppressHydrationWarning!==!0&&Mi(z.textContent,Ye,_),Z=["children",""+Ye]):y.hasOwnProperty(we)&&Ye!=null&&we==="onScroll"&&xs("scroll",z)}switch(P){case"input":Ur(z),Dr(z,ie,!0);break;case"textarea":Ur(z),Jt(z);break;case"select":case"option":break;default:typeof ie.onClick=="function"&&(z.onclick=xp)}z=Z,w.updateQueue=z,z!==null&&(w.flags|=4)}else{we=Z.nodeType===9?Z:Z.ownerDocument,_==="http://www.w3.org/1999/xhtml"&&(_=Or(P)),_==="http://www.w3.org/1999/xhtml"?P==="script"?(_=we.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild)):typeof z.is=="string"?_=we.createElement(P,{is:z.is}):(_=we.createElement(P),P==="select"&&(we=_,z.multiple?we.multiple=!0:z.size&&(we.size=z.size))):_=we.createElementNS(_,P),_[Xa]=w,_[au]=z,Vp(_,w,!1,!1),w.stateNode=_;e:{switch(we=ur(P,z),P){case"dialog":xs("cancel",_),xs("close",_),Z=z;break;case"iframe":case"object":case"embed":xs("load",_),Z=z;break;case"video":case"audio":for(Z=0;Z<qu.length;Z++)xs(qu[Z],_);Z=z;break;case"source":xs("error",_),Z=z;break;case"img":case"image":case"link":xs("error",_),xs("load",_),Z=z;break;case"details":xs("toggle",_),Z=z;break;case"input":At(_,z),Z=Ci(_,z),xs("invalid",_);break;case"option":Z=z;break;case"select":_._wrapperState={wasMultiple:!!z.multiple},Z=Qt({},z,{value:void 0}),xs("invalid",_);break;case"textarea":yr(_,z),Z=jt(_,z),xs("invalid",_);break;default:Z=z}Ze(P,Z),Ye=Z;for(ie in Ye)if(Ye.hasOwnProperty(ie)){var ft=Ye[ie];ie==="style"?Ln(_,ft):ie==="dangerouslySetInnerHTML"?(ft=ft?ft.__html:void 0,ft!=null&&Gi(_,ft)):ie==="children"?typeof ft=="string"?(P!=="textarea"||ft!=="")&&yi(_,ft):typeof ft=="number"&&yi(_,""+ft):ie!=="suppressContentEditableWarning"&&ie!=="suppressHydrationWarning"&&ie!=="autoFocus"&&(y.hasOwnProperty(ie)?ft!=null&&ie==="onScroll"&&xs("scroll",_):ft!=null&&Se(_,ie,ft,we))}switch(P){case"input":Ur(_),Dr(_,z,!1);break;case"textarea":Ur(_),Jt(_);break;case"option":z.value!=null&&_.setAttribute("value",""+Qr(z.value));break;case"select":_.multiple=!!z.multiple,ie=z.value,ie!=null?Je(_,!!z.multiple,ie,!1):z.defaultValue!=null&&Je(_,!!z.multiple,z.defaultValue,!0);break;default:typeof Z.onClick=="function"&&(_.onclick=xp)}switch(P){case"button":case"input":case"select":case"textarea":z=!!z.autoFocus;break e;case"img":z=!0;break e;default:z=!1}}z&&(w.flags|=4)}w.ref!==null&&(w.flags|=512,w.flags|=2097152)}return yo(w),null;case 6:if(_&&w.stateNode!=null)Lf(_,w,_.memoizedProps,z);else{if(typeof z!="string"&&w.stateNode===null)throw Error(a(166));if(P=Nc(mu.current),Nc(Dl.current),Qu(w)){if(z=w.stateNode,P=w.memoizedProps,z[Xa]=w,(ie=z.nodeValue!==P)&&(_=Ta,_!==null))switch(_.tag){case 3:Mi(z.nodeValue,P,(_.mode&1)!==0);break;case 5:_.memoizedProps.suppressHydrationWarning!==!0&&Mi(z.nodeValue,P,(_.mode&1)!==0)}ie&&(w.flags|=4)}else z=(P.nodeType===9?P:P.ownerDocument).createTextNode(z),z[Xa]=w,w.stateNode=z}return yo(w),null;case 13:if(Ts(ns),z=w.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(ds&&Ba!==null&&(w.mode&1)!==0&&(w.flags&128)===0)zm(),Ya(),w.flags|=98560,ie=!1;else if(ie=Qu(w),z!==null&&z.dehydrated!==null){if(_===null){if(!ie)throw Error(a(318));if(ie=w.memoizedState,ie=ie!==null?ie.dehydrated:null,!ie)throw Error(a(317));ie[Xa]=w}else Ya(),(w.flags&128)===0&&(w.memoizedState=null),w.flags|=4;yo(w),ie=!1}else Ka!==null&&(le(Ka),Ka=null),ie=!0;if(!ie)return w.flags&65536?w:null}return(w.flags&128)!==0?(w.lanes=P,w):(z=z!==null,z!==(_!==null&&_.memoizedState!==null)&&z&&(w.child.flags|=8192,(w.mode&1)!==0&&(_===null||(ns.current&1)!==0?os===0&&(os=3):Ue())),w.updateQueue!==null&&(w.flags|=4),yo(w),null);case 4:return Ol(),Aa(_,w),_===null&&lf(w.stateNode.containerInfo),yo(w),null;case 10:return ah(w.type._context),yo(w),null;case 17:return go(w.type)&&uu(),yo(w),null;case 19:if(Ts(ns),ie=w.memoizedState,ie===null)return yo(w),null;if(z=(w.flags&128)!==0,we=ie.rendering,we===null)if(z)bu(ie,!1);else{if(os!==0||_!==null&&(_.flags&128)!==0)for(_=w.child;_!==null;){if(we=bf(_),we!==null){for(w.flags|=128,bu(ie,!1),z=we.updateQueue,z!==null&&(w.updateQueue=z,w.flags|=4),w.subtreeFlags=0,z=P,P=w.child;P!==null;)ie=P,_=z,ie.flags&=14680066,we=ie.alternate,we===null?(ie.childLanes=0,ie.lanes=_,ie.child=null,ie.subtreeFlags=0,ie.memoizedProps=null,ie.memoizedState=null,ie.updateQueue=null,ie.dependencies=null,ie.stateNode=null):(ie.childLanes=we.childLanes,ie.lanes=we.lanes,ie.child=we.child,ie.subtreeFlags=0,ie.deletions=null,ie.memoizedProps=we.memoizedProps,ie.memoizedState=we.memoizedState,ie.updateQueue=we.updateQueue,ie.type=we.type,_=we.dependencies,ie.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),P=P.sibling;return vs(ns,ns.current&1|2),w.child}_=_.sibling}ie.tail!==null&&Ir()>Ff&&(w.flags|=128,z=!0,bu(ie,!1),w.lanes=4194304)}else{if(!z)if(_=bf(we),_!==null){if(w.flags|=128,z=!0,P=_.updateQueue,P!==null&&(w.updateQueue=P,w.flags|=4),bu(ie,!0),ie.tail===null&&ie.tailMode==="hidden"&&!we.alternate&&!ds)return yo(w),null}else 2*Ir()-ie.renderingStartTime>Ff&&P!==1073741824&&(w.flags|=128,z=!0,bu(ie,!1),w.lanes=4194304);ie.isBackwards?(we.sibling=w.child,w.child=we):(P=ie.last,P!==null?P.sibling=we:w.child=we,ie.last=we)}return ie.tail!==null?(w=ie.tail,ie.rendering=w,ie.tail=w.sibling,ie.renderingStartTime=Ir(),w.sibling=null,P=ns.current,vs(ns,z?P&1|2:P&1),w):(yo(w),null);case 22:case 23:return ke(),z=w.memoizedState!==null,_!==null&&_.memoizedState!==null!==z&&(w.flags|=8192),z&&(w.mode&1)!==0?(Ko&1073741824)!==0&&(yo(w),w.subtreeFlags&6&&(w.flags|=8192)):yo(w),null;case 24:return null;case 25:return null}throw Error(a(156,w.tag))}function Df(_,w){switch(sh(w),w.tag){case 1:return go(w.type)&&uu(),_=w.flags,_&65536?(w.flags=_&-65537|128,w):null;case 3:return Ol(),Ts(Sa),Ts(Ro),kp(),_=w.flags,(_&65536)!==0&&(_&128)===0?(w.flags=_&-65537|128,w):null;case 5:return nd(w),null;case 13:if(Ts(ns),_=w.memoizedState,_!==null&&_.dehydrated!==null){if(w.alternate===null)throw Error(a(340));Ya()}return _=w.flags,_&65536?(w.flags=_&-65537|128,w):null;case 19:return Ts(ns),null;case 4:return Ol(),null;case 10:return ah(w.type._context),null;case 22:case 23:return ke(),null;case 24:return null;default:return null}}var Dc=!1,_o=!1,ud=typeof WeakSet=="function"?WeakSet:Set,hn=null;function wu(_,w){var P=_.ref;if(P!==null)if(typeof P=="function")try{P(null)}catch(z){yt(_,w,z)}else P.current=null}function dd(_,w,P){try{P()}catch(z){yt(_,w,z)}}var Su=!1;function Zm(_,w){if(vp=bc,_=Vg(),pp(_)){if("selectionStart"in _)var P={start:_.selectionStart,end:_.selectionEnd};else e:{P=(P=_.ownerDocument)&&P.defaultView||window;var z=P.getSelection&&P.getSelection();if(z&&z.rangeCount!==0){P=z.anchorNode;var Z=z.anchorOffset,ie=z.focusNode;z=z.focusOffset;try{P.nodeType,ie.nodeType}catch{P=null;break e}var we=0,Ye=-1,ft=-1,Bt=0,vr=0,Cr=_,mr=null;t:for(;;){for(var Kr;Cr!==P||Z!==0&&Cr.nodeType!==3||(Ye=we+Z),Cr!==ie||z!==0&&Cr.nodeType!==3||(ft=we+z),Cr.nodeType===3&&(we+=Cr.nodeValue.length),(Kr=Cr.firstChild)!==null;)mr=Cr,Cr=Kr;for(;;){if(Cr===_)break t;if(mr===P&&++Bt===Z&&(Ye=we),mr===ie&&++vr===z&&(ft=we),(Kr=Cr.nextSibling)!==null)break;Cr=mr,mr=Cr.parentNode}Cr=Kr}P=Ye===-1||ft===-1?null:{start:Ye,end:ft}}else P=null}P=P||{start:0,end:0}}else P=null;for(uf={focusedElem:_,selectionRange:P},bc=!1,hn=w;hn!==null;)if(w=hn,_=w.child,(w.subtreeFlags&1028)!==0&&_!==null)_.return=w,hn=_;else for(;hn!==null;){w=hn;try{var on=w.alternate;if((w.flags&1024)!==0)switch(w.tag){case 0:case 11:case 15:break;case 1:if(on!==null){var nn=on.memoizedProps,ps=on.memoizedState,Lt=w.stateNode,xt=Lt.getSnapshotBeforeUpdate(w.elementType===w.type?nn:el(w.type,nn),ps);Lt.__reactInternalSnapshotBeforeUpdate=xt}break;case 3:var Vt=w.stateNode.containerInfo;Vt.nodeType===1?Vt.textContent="":Vt.nodeType===9&&Vt.documentElement&&Vt.removeChild(Vt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Br){yt(w,w.return,Br)}if(_=w.sibling,_!==null){_.return=w.return,hn=_;break}hn=w.return}return on=Su,Su=!1,on}function Oc(_,w,P){var z=w.updateQueue;if(z=z!==null?z.lastEffect:null,z!==null){var Z=z=z.next;do{if((Z.tag&_)===_){var ie=Z.destroy;Z.destroy=void 0,ie!==void 0&&dd(w,P,ie)}Z=Z.next}while(Z!==z)}}function xh(_,w){if(w=w.updateQueue,w=w!==null?w.lastEffect:null,w!==null){var P=w=w.next;do{if((P.tag&_)===_){var z=P.create;P.destroy=z()}P=P.next}while(P!==w)}}function hd(_){var w=_.ref;if(w!==null){var P=_.stateNode;switch(_.tag){case 5:_=P;break;default:_=P}typeof w=="function"?w(_):w.current=_}}function Up(_){var w=_.alternate;w!==null&&(_.alternate=null,Up(w)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(w=_.stateNode,w!==null&&(delete w[Xa],delete w[au],delete w[Yd],delete w[ff],delete w[qg])),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function Of(_){return _.tag===5||_.tag===3||_.tag===4}function Xm(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||Of(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function $p(_,w,P){var z=_.tag;if(z===5||z===6)_=_.stateNode,w?P.nodeType===8?P.parentNode.insertBefore(_,w):P.insertBefore(_,w):(P.nodeType===8?(w=P.parentNode,w.insertBefore(_,P)):(w=P,w.appendChild(_)),P=P._reactRootContainer,P!=null||w.onclick!==null||(w.onclick=xp));else if(z!==4&&(_=_.child,_!==null))for($p(_,w,P),_=_.sibling;_!==null;)$p(_,w,P),_=_.sibling}function qp(_,w,P){var z=_.tag;if(z===5||z===6)_=_.stateNode,w?P.insertBefore(_,w):P.appendChild(_);else if(z!==4&&(_=_.child,_!==null))for(qp(_,w,P),_=_.sibling;_!==null;)qp(_,w,P),_=_.sibling}var Lo=null,gl=!1;function zc(_,w,P){for(P=P.child;P!==null;)vh(_,w,P),P=P.sibling}function vh(_,w,P){if(gn&&typeof gn.onCommitFiberUnmount=="function")try{gn.onCommitFiberUnmount(Ii,P)}catch{}switch(P.tag){case 5:_o||wu(P,w);case 6:var z=Lo,Z=gl;Lo=null,zc(_,w,P),Lo=z,gl=Z,Lo!==null&&(gl?(_=Lo,P=P.stateNode,_.nodeType===8?_.parentNode.removeChild(P):_.removeChild(P)):Lo.removeChild(P.stateNode));break;case 18:Lo!==null&&(gl?(_=Lo,P=P.stateNode,_.nodeType===8?bp(_.parentNode,P):_.nodeType===1&&bp(_,P),Du(_)):bp(Lo,P.stateNode));break;case 4:z=Lo,Z=gl,Lo=P.stateNode.containerInfo,gl=!0,zc(_,w,P),Lo=z,gl=Z;break;case 0:case 11:case 14:case 15:if(!_o&&(z=P.updateQueue,z!==null&&(z=z.lastEffect,z!==null))){Z=z=z.next;do{var ie=Z,we=ie.destroy;ie=ie.tag,we!==void 0&&((ie&2)!==0||(ie&4)!==0)&&dd(P,w,we),Z=Z.next}while(Z!==z)}zc(_,w,P);break;case 1:if(!_o&&(wu(P,w),z=P.stateNode,typeof z.componentWillUnmount=="function"))try{z.props=P.memoizedProps,z.state=P.memoizedState,z.componentWillUnmount()}catch(Ye){yt(P,w,Ye)}zc(_,w,P);break;case 21:zc(_,w,P);break;case 22:P.mode&1?(_o=(z=_o)||P.memoizedState!==null,zc(_,w,P),_o=z):zc(_,w,P);break;default:zc(_,w,P)}}function Km(_){var w=_.updateQueue;if(w!==null){_.updateQueue=null;var P=_.stateNode;P===null&&(P=_.stateNode=new ud),w.forEach(function(z){var Z=Ft.bind(null,_,z);P.has(z)||(P.add(z),z.then(Z,Z))})}}function yl(_,w){var P=w.deletions;if(P!==null)for(var z=0;z<P.length;z++){var Z=P[z];try{var ie=_,we=w,Ye=we;e:for(;Ye!==null;){switch(Ye.tag){case 5:Lo=Ye.stateNode,gl=!1;break e;case 3:Lo=Ye.stateNode.containerInfo,gl=!0;break e;case 4:Lo=Ye.stateNode.containerInfo,gl=!0;break e}Ye=Ye.return}if(Lo===null)throw Error(a(160));vh(ie,we,Z),Lo=null,gl=!1;var ft=Z.alternate;ft!==null&&(ft.return=null),Z.return=null}catch(Bt){yt(Z,w,Bt)}}if(w.subtreeFlags&12854)for(w=w.child;w!==null;)bh(w,_),w=w.sibling}function bh(_,w){var P=_.alternate,z=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:if(yl(w,_),Bl(_),z&4){try{Oc(3,_,_.return),xh(3,_)}catch(nn){yt(_,_.return,nn)}try{Oc(5,_,_.return)}catch(nn){yt(_,_.return,nn)}}break;case 1:yl(w,_),Bl(_),z&512&&P!==null&&wu(P,P.return);break;case 5:if(yl(w,_),Bl(_),z&512&&P!==null&&wu(P,P.return),_.flags&32){var Z=_.stateNode;try{yi(Z,"")}catch(nn){yt(_,_.return,nn)}}if(z&4&&(Z=_.stateNode,Z!=null)){var ie=_.memoizedProps,we=P!==null?P.memoizedProps:ie,Ye=_.type,ft=_.updateQueue;if(_.updateQueue=null,ft!==null)try{Ye==="input"&&ie.type==="radio"&&ie.name!=null&&pt(Z,ie),ur(Ye,we);var Bt=ur(Ye,ie);for(we=0;we<ft.length;we+=2){var vr=ft[we],Cr=ft[we+1];vr==="style"?Ln(Z,Cr):vr==="dangerouslySetInnerHTML"?Gi(Z,Cr):vr==="children"?yi(Z,Cr):Se(Z,vr,Cr,Bt)}switch(Ye){case"input":Sr(Z,ie);break;case"textarea":pr(Z,ie);break;case"select":var mr=Z._wrapperState.wasMultiple;Z._wrapperState.wasMultiple=!!ie.multiple;var Kr=ie.value;Kr!=null?Je(Z,!!ie.multiple,Kr,!1):mr!==!!ie.multiple&&(ie.defaultValue!=null?Je(Z,!!ie.multiple,ie.defaultValue,!0):Je(Z,!!ie.multiple,ie.multiple?[]:"",!1))}Z[au]=ie}catch(nn){yt(_,_.return,nn)}}break;case 6:if(yl(w,_),Bl(_),z&4){if(_.stateNode===null)throw Error(a(162));Z=_.stateNode,ie=_.memoizedProps;try{Z.nodeValue=ie}catch(nn){yt(_,_.return,nn)}}break;case 3:if(yl(w,_),Bl(_),z&4&&P!==null&&P.memoizedState.isDehydrated)try{Du(w.containerInfo)}catch(nn){yt(_,_.return,nn)}break;case 4:yl(w,_),Bl(_);break;case 13:yl(w,_),Bl(_),Z=_.child,Z.flags&8192&&(ie=Z.memoizedState!==null,Z.stateNode.isHidden=ie,!ie||Z.alternate!==null&&Z.alternate.memoizedState!==null||(Eu=Ir())),z&4&&Km(_);break;case 22:if(vr=P!==null&&P.memoizedState!==null,_.mode&1?(_o=(Bt=_o)||vr,yl(w,_),_o=Bt):yl(w,_),Bl(_),z&8192){if(Bt=_.memoizedState!==null,(_.stateNode.isHidden=Bt)&&!vr&&(_.mode&1)!==0)for(hn=_,vr=_.child;vr!==null;){for(Cr=hn=vr;hn!==null;){switch(mr=hn,Kr=mr.child,mr.tag){case 0:case 11:case 14:case 15:Oc(4,mr,mr.return);break;case 1:wu(mr,mr.return);var on=mr.stateNode;if(typeof on.componentWillUnmount=="function"){z=mr,P=mr.return;try{w=z,on.props=w.memoizedProps,on.state=w.memoizedState,on.componentWillUnmount()}catch(nn){yt(z,P,nn)}}break;case 5:wu(mr,mr.return);break;case 22:if(mr.memoizedState!==null){eg(Cr);continue}}Kr!==null?(Kr.return=mr,hn=Kr):eg(Cr)}vr=vr.sibling}e:for(vr=null,Cr=_;;){if(Cr.tag===5){if(vr===null){vr=Cr;try{Z=Cr.stateNode,Bt?(ie=Z.style,typeof ie.setProperty=="function"?ie.setProperty("display","none","important"):ie.display="none"):(Ye=Cr.stateNode,ft=Cr.memoizedProps.style,we=ft!=null&&ft.hasOwnProperty("display")?ft.display:null,Ye.style.display=dn("display",we))}catch(nn){yt(_,_.return,nn)}}}else if(Cr.tag===6){if(vr===null)try{Cr.stateNode.nodeValue=Bt?"":Cr.memoizedProps}catch(nn){yt(_,_.return,nn)}}else if((Cr.tag!==22&&Cr.tag!==23||Cr.memoizedState===null||Cr===_)&&Cr.child!==null){Cr.child.return=Cr,Cr=Cr.child;continue}if(Cr===_)break e;for(;Cr.sibling===null;){if(Cr.return===null||Cr.return===_)break e;vr===Cr&&(vr=null),Cr=Cr.return}vr===Cr&&(vr=null),Cr.sibling.return=Cr.return,Cr=Cr.sibling}}break;case 19:yl(w,_),Bl(_),z&4&&Km(_);break;case 21:break;default:yl(w,_),Bl(_)}}function Bl(_){var w=_.flags;if(w&2){try{e:{for(var P=_.return;P!==null;){if(Of(P)){var z=P;break e}P=P.return}throw Error(a(160))}switch(z.tag){case 5:var Z=z.stateNode;z.flags&32&&(yi(Z,""),z.flags&=-33);var ie=Xm(_);qp(_,ie,Z);break;case 3:case 4:var we=z.stateNode.containerInfo,Ye=Xm(_);$p(_,Ye,we);break;default:throw Error(a(161))}}catch(ft){yt(_,_.return,ft)}_.flags&=-3}w&4096&&(_.flags&=-4097)}function Ym(_,w,P){hn=_,Qm(_)}function Qm(_,w,P){for(var z=(_.mode&1)!==0;hn!==null;){var Z=hn,ie=Z.child;if(Z.tag===22&&z){var we=Z.memoizedState!==null||Dc;if(!we){var Ye=Z.alternate,ft=Ye!==null&&Ye.memoizedState!==null||_o;Ye=Dc;var Bt=_o;if(Dc=we,(_o=ft)&&!Bt)for(hn=Z;hn!==null;)we=hn,ft=we.child,we.tag===22&&we.memoizedState!==null?tg(Z):ft!==null?(ft.return=we,hn=ft):tg(Z);for(;ie!==null;)hn=ie,Qm(ie),ie=ie.sibling;hn=Z,Dc=Ye,_o=Bt}Jm(_)}else(Z.subtreeFlags&8772)!==0&&ie!==null?(ie.return=Z,hn=ie):Jm(_)}}function Jm(_){for(;hn!==null;){var w=hn;if((w.flags&8772)!==0){var P=w.alternate;try{if((w.flags&8772)!==0)switch(w.tag){case 0:case 11:case 15:_o||xh(5,w);break;case 1:var z=w.stateNode;if(w.flags&4&&!_o)if(P===null)z.componentDidMount();else{var Z=w.elementType===w.type?P.memoizedProps:el(w.type,P.memoizedProps);z.componentDidUpdate(Z,P.memoizedState,z.__reactInternalSnapshotBeforeUpdate)}var ie=w.updateQueue;ie!==null&&dc(w,ie,z);break;case 3:var we=w.updateQueue;if(we!==null){if(P=null,w.child!==null)switch(w.child.tag){case 5:P=w.child.stateNode;break;case 1:P=w.child.stateNode}dc(w,we,P)}break;case 5:var Ye=w.stateNode;if(P===null&&w.flags&4){P=Ye;var ft=w.memoizedProps;switch(w.type){case"button":case"input":case"select":case"textarea":ft.autoFocus&&P.focus();break;case"img":ft.src&&(P.src=ft.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(w.memoizedState===null){var Bt=w.alternate;if(Bt!==null){var vr=Bt.memoizedState;if(vr!==null){var Cr=vr.dehydrated;Cr!==null&&Du(Cr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}_o||w.flags&512&&hd(w)}catch(mr){yt(w,w.return,mr)}}if(w===_){hn=null;break}if(P=w.sibling,P!==null){P.return=w.return,hn=P;break}hn=w.return}}function eg(_){for(;hn!==null;){var w=hn;if(w===_){hn=null;break}var P=w.sibling;if(P!==null){P.return=w.return,hn=P;break}hn=w.return}}function tg(_){for(;hn!==null;){var w=hn;try{switch(w.tag){case 0:case 11:case 15:var P=w.return;try{xh(4,w)}catch(ft){yt(w,P,ft)}break;case 1:var z=w.stateNode;if(typeof z.componentDidMount=="function"){var Z=w.return;try{z.componentDidMount()}catch(ft){yt(w,Z,ft)}}var ie=w.return;try{hd(w)}catch(ft){yt(w,ie,ft)}break;case 5:var we=w.return;try{hd(w)}catch(ft){yt(w,we,ft)}}}catch(ft){yt(w,w.return,ft)}if(w===_){hn=null;break}var Ye=w.sibling;if(Ye!==null){Ye.return=w.return,hn=Ye;break}hn=w.return}}var Zi=Math.ceil,zf=Re.ReactCurrentDispatcher,Gp=Re.ReactCurrentOwner,_l=Re.ReactCurrentBatchConfig,Ji=0,$s=null,Qs=null,xo=0,Ko=0,ha=cu(0),os=0,hs=null,vo=0,Tu=0,wh=0,Sh=null,Ua=null,Eu=0,Ff=1/0,f=null,t=!1,c=null,p=null,x=!1,S=null,T=0,I=0,k=null,D=-1,O=0;function q(){return(Ji&6)!==0?Ir():D!==-1?D:D=Ir()}function U(_){return(_.mode&1)===0?1:(Ji&2)!==0&&xo!==0?xo&-xo:Sp.transition!==null?(O===0&&(O=lo()),O):(_=$n,_!==0||(_=window.event,_=_===void 0?16:Md(_.type)),_)}function G(_,w,P,z){if(50<I)throw I=0,k=null,Error(a(185));br(_,P,z),((Ji&2)===0||_!==$s)&&(_===$s&&((Ji&2)===0&&(Tu|=P),os===4&&pe(_,xo)),J(_,z),P===1&&Ji===0&&(w.mode&1)===0&&(Ff=Ir()+500,Ku&&ll()))}function J(_,w){var P=_.callbackNode;ra(_,w);var z=Hi(_,_===$s?xo:0);if(z===0)P!==null&&tr(P),_.callbackNode=null,_.callbackPriority=0;else if(w=z&-z,_.callbackPriority!==w){if(P!=null&&tr(P),w===1)_.tag===0?rh(de.bind(null,_)):wp(de.bind(null,_)),hf(function(){(Ji&6)===0&&ll()}),P=null;else{switch(jo(z)){case 1:P=Rr;break;case 4:P=ni;break;case 16:P=$i;break;case 536870912:P=Yi;break;default:P=$i}P=fr(P,Y.bind(null,_))}_.callbackPriority=w,_.callbackNode=P}}function Y(_,w){if(D=-1,O=0,(Ji&6)!==0)throw Error(a(327));var P=_.callbackNode;if(dt()&&_.callbackNode!==P)return null;var z=Hi(_,_===$s?xo:0);if(z===0)return null;if((z&30)!==0||(z&_.expiredLanes)!==0||w)w=Ge(_,z);else{w=z;var Z=Ji;Ji|=2;var ie=Me();($s!==_||xo!==w)&&(f=null,Ff=Ir()+500,Te(_,w));do try{tt();break}catch(Ye){_e(_,Ye)}while(!0);Fm(),zf.current=ie,Ji=Z,Qs!==null?w=0:($s=null,xo=0,w=os)}if(w!==0){if(w===2&&(Z=Uo(_),Z!==0&&(z=Z,w=te(_,Z))),w===1)throw P=hs,Te(_,0),pe(_,z),J(_,Ir()),P;if(w===6)pe(_,z);else{if(Z=_.current.alternate,(z&30)===0&&!ge(Z)&&(w=Ge(_,z),w===2&&(ie=Uo(_),ie!==0&&(z=ie,w=te(_,ie))),w===1))throw P=hs,Te(_,0),pe(_,z),J(_,Ir()),P;switch(_.finishedWork=Z,_.finishedLanes=z,w){case 0:case 1:throw Error(a(345));case 2:Qe(_,Ua,f);break;case 3:if(pe(_,z),(z&130023424)===z&&(w=Eu+500-Ir(),10<w)){if(Hi(_,0)!==0)break;if(Z=_.suspendedLanes,(Z&z)!==z){q(),_.pingedLanes|=_.suspendedLanes&Z;break}_.timeoutHandle=df(Qe.bind(null,_,Ua,f),w);break}Qe(_,Ua,f);break;case 4:if(pe(_,z),(z&4194240)===z)break;for(w=_.eventTimes,Z=-1;0<z;){var we=31-In(z);ie=1<<we,we=w[we],we>Z&&(Z=we),z&=~ie}if(z=Z,z=Ir()-z,z=(120>z?120:480>z?480:1080>z?1080:1920>z?1920:3e3>z?3e3:4320>z?4320:1960*Zi(z/1960))-z,10<z){_.timeoutHandle=df(Qe.bind(null,_,Ua,f),z);break}Qe(_,Ua,f);break;case 5:Qe(_,Ua,f);break;default:throw Error(a(329))}}}return J(_,Ir()),_.callbackNode===P?Y.bind(null,_):null}function te(_,w){var P=Sh;return _.current.memoizedState.isDehydrated&&(Te(_,w).flags|=256),_=Ge(_,w),_!==2&&(w=Ua,Ua=P,w!==null&&le(w)),_}function le(_){Ua===null?Ua=_:Ua.push.apply(Ua,_)}function ge(_){for(var w=_;;){if(w.flags&16384){var P=w.updateQueue;if(P!==null&&(P=P.stores,P!==null))for(var z=0;z<P.length;z++){var Z=P[z],ie=Z.getSnapshot;Z=Z.value;try{if(!Vs(ie(),Z))return!1}catch{return!1}}}if(P=w.child,w.subtreeFlags&16384&&P!==null)P.return=w,w=P;else{if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return!0;w=w.return}w.sibling.return=w.return,w=w.sibling}}return!0}function pe(_,w){for(w&=~wh,w&=~Tu,_.suspendedLanes|=w,_.pingedLanes&=~w,_=_.expirationTimes;0<w;){var P=31-In(w),z=1<<P;_[P]=-1,w&=~z}}function de(_){if((Ji&6)!==0)throw Error(a(327));dt();var w=Hi(_,0);if((w&1)===0)return J(_,Ir()),null;var P=Ge(_,w);if(_.tag!==0&&P===2){var z=Uo(_);z!==0&&(w=z,P=te(_,z))}if(P===1)throw P=hs,Te(_,0),pe(_,w),J(_,Ir()),P;if(P===6)throw Error(a(345));return _.finishedWork=_.current.alternate,_.finishedLanes=w,Qe(_,Ua,f),J(_,Ir()),null}function Ne(_,w){var P=Ji;Ji|=1;try{return _(w)}finally{Ji=P,Ji===0&&(Ff=Ir()+500,Ku&&ll())}}function Ce(_){S!==null&&S.tag===0&&(Ji&6)===0&&dt();var w=Ji;Ji|=1;var P=_l.transition,z=$n;try{if(_l.transition=null,$n=1,_)return _()}finally{$n=z,_l.transition=P,Ji=w,(Ji&6)===0&&ll()}}function ke(){Ko=ha.current,Ts(ha)}function Te(_,w){_.finishedWork=null,_.finishedLanes=0;var P=_.timeoutHandle;if(P!==-1&&(_.timeoutHandle=-1,Hu(P)),Qs!==null)for(P=Qs.return;P!==null;){var z=P;switch(sh(z),z.tag){case 1:z=z.type.childContextTypes,z!=null&&uu();break;case 3:Ol(),Ts(Sa),Ts(Ro),kp();break;case 5:nd(z);break;case 4:Ol();break;case 13:Ts(ns);break;case 19:Ts(ns);break;case 10:ah(z.type._context);break;case 22:case 23:ke()}P=P.return}if($s=_,Qs=_=tn(_.current,null),xo=Ko=w,os=0,hs=null,wh=Tu=vo=0,Ua=Sh=null,Ja!==null){for(w=0;w<Ja.length;w++)if(P=Ja[w],z=P.interleaved,z!==null){P.interleaved=null;var Z=z.next,ie=P.pending;if(ie!==null){var we=ie.next;ie.next=Z,z.next=we}P.pending=z}Ja=null}return _}function _e(_,w){do{var P=Qs;try{if(Fm(),wf.current=He,Tf){for(var z=Ps.memoizedState;z!==null;){var Z=z.queue;Z!==null&&(Z.pending=null),z=z.next}Tf=!1}if(ul=0,Ys=Ks=Ps=null,dh=!1,id=0,Gp.current=null,P===null||P.return===null){os=1,hs=w,Qs=null;break}e:{var ie=_,we=P.return,Ye=P,ft=w;if(w=xo,Ye.flags|=32768,ft!==null&&typeof ft=="object"&&typeof ft.then=="function"){var Bt=ft,vr=Ye,Cr=vr.tag;if((vr.mode&1)===0&&(Cr===0||Cr===11||Cr===15)){var mr=vr.alternate;mr?(vr.updateQueue=mr.updateQueue,vr.memoizedState=mr.memoizedState,vr.lanes=mr.lanes):(vr.updateQueue=null,vr.memoizedState=null)}var Kr=zp(we);if(Kr!==null){Kr.flags&=-257,Fp(Kr,we,Ye,ie,w),Kr.mode&1&&yu(ie,Bt,w),w=Kr,ft=Bt;var on=w.updateQueue;if(on===null){var nn=new Set;nn.add(ft),w.updateQueue=nn}else on.add(ft);break e}else{if((w&1)===0){yu(ie,Bt,w),Ue();break e}ft=Error(a(426))}}else if(ds&&Ye.mode&1){var ps=zp(we);if(ps!==null){(ps.flags&65536)===0&&(ps.flags|=256),Fp(ps,we,Ye,ie,w),yf(fc(ft,Ye));break e}}ie=ft=fc(ft,Ye),os!==4&&(os=2),Sh===null?Sh=[ie]:Sh.push(ie),ie=we;do{switch(ie.tag){case 3:ie.flags|=65536,w&=-w,ie.lanes|=w;var Lt=Rf(ie,ft,w);Ip(ie,Lt);break e;case 1:Ye=ft;var xt=ie.type,Vt=ie.stateNode;if((ie.flags&128)===0&&(typeof xt.getDerivedStateFromError=="function"||Vt!==null&&typeof Vt.componentDidCatch=="function"&&(p===null||!p.has(Vt)))){ie.flags|=65536,w&=-w,ie.lanes|=w;var Br=mh(ie,Ye,w);Ip(ie,Br);break e}}ie=ie.return}while(ie!==null)}Pt(P)}catch(Nn){w=Nn,Qs===P&&P!==null&&(Qs=P=P.return);continue}break}while(!0)}function Me(){var _=zf.current;return zf.current=He,_===null?He:_}function Ue(){(os===0||os===3||os===2)&&(os=4),$s===null||(vo&268435455)===0&&(Tu&268435455)===0||pe($s,xo)}function Ge(_,w){var P=Ji;Ji|=2;var z=Me();($s!==_||xo!==w)&&(f=null,Te(_,w));do try{it();break}catch(Z){_e(_,Z)}while(!0);if(Fm(),Ji=P,zf.current=z,Qs!==null)throw Error(a(261));return $s=null,xo=0,os}function it(){for(;Qs!==null;)mt(Qs)}function tt(){for(;Qs!==null&&!cr();)mt(Qs)}function mt(_){var w=gr(_.alternate,_,Ko);_.memoizedProps=_.pendingProps,w===null?Pt(_):Qs=w,Gp.current=null}function Pt(_){var w=_;do{var P=w.alternate;if(_=w.return,(w.flags&32768)===0){if(P=Os(P,w,Ko),P!==null){Qs=P;return}}else{if(P=Df(P,w),P!==null){P.flags&=32767,Qs=P;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{os=6,Qs=null;return}}if(w=w.sibling,w!==null){Qs=w;return}Qs=w=_}while(w!==null);os===0&&(os=5)}function Qe(_,w,P){var z=$n,Z=_l.transition;try{_l.transition=null,$n=1,Le(_,w,P,z)}finally{_l.transition=Z,$n=z}return null}function Le(_,w,P,z){do dt();while(S!==null);if((Ji&6)!==0)throw Error(a(327));P=_.finishedWork;var Z=_.finishedLanes;if(P===null)return null;if(_.finishedWork=null,_.finishedLanes=0,P===_.current)throw Error(a(177));_.callbackNode=null,_.callbackPriority=0;var ie=P.lanes|P.childLanes;if(pn(_,ie),_===$s&&(Qs=$s=null,xo=0),(P.subtreeFlags&2064)===0&&(P.flags&2064)===0||x||(x=!0,fr($i,function(){return dt(),null})),ie=(P.flags&15990)!==0,(P.subtreeFlags&15990)!==0||ie){ie=_l.transition,_l.transition=null;var we=$n;$n=1;var Ye=Ji;Ji|=4,Gp.current=null,Zm(_,P),bh(P,_),E_(uf),bc=!!vp,uf=vp=null,_.current=P,Ym(P),Nr(),Ji=Ye,$n=we,_l.transition=ie}else _.current=P;if(x&&(x=!1,S=_,T=Z),ie=_.pendingLanes,ie===0&&(p=null),Ni(P.stateNode),J(_,Ir()),w!==null)for(z=_.onRecoverableError,P=0;P<w.length;P++)Z=w[P],z(Z.value,{componentStack:Z.stack,digest:Z.digest});if(t)throw t=!1,_=c,c=null,_;return(T&1)!==0&&_.tag!==0&&dt(),ie=_.pendingLanes,(ie&1)!==0?_===k?I++:(I=0,k=_):I=0,ll(),null}function dt(){if(S!==null){var _=jo(T),w=_l.transition,P=$n;try{if(_l.transition=null,$n=16>_?16:_,S===null)var z=!1;else{if(_=S,S=null,T=0,(Ji&6)!==0)throw Error(a(331));var Z=Ji;for(Ji|=4,hn=_.current;hn!==null;){var ie=hn,we=ie.child;if((hn.flags&16)!==0){var Ye=ie.deletions;if(Ye!==null){for(var ft=0;ft<Ye.length;ft++){var Bt=Ye[ft];for(hn=Bt;hn!==null;){var vr=hn;switch(vr.tag){case 0:case 11:case 15:Oc(8,vr,ie)}var Cr=vr.child;if(Cr!==null)Cr.return=vr,hn=Cr;else for(;hn!==null;){vr=hn;var mr=vr.sibling,Kr=vr.return;if(Up(vr),vr===Bt){hn=null;break}if(mr!==null){mr.return=Kr,hn=mr;break}hn=Kr}}}var on=ie.alternate;if(on!==null){var nn=on.child;if(nn!==null){on.child=null;do{var ps=nn.sibling;nn.sibling=null,nn=ps}while(nn!==null)}}hn=ie}}if((ie.subtreeFlags&2064)!==0&&we!==null)we.return=ie,hn=we;else e:for(;hn!==null;){if(ie=hn,(ie.flags&2048)!==0)switch(ie.tag){case 0:case 11:case 15:Oc(9,ie,ie.return)}var Lt=ie.sibling;if(Lt!==null){Lt.return=ie.return,hn=Lt;break e}hn=ie.return}}var xt=_.current;for(hn=xt;hn!==null;){we=hn;var Vt=we.child;if((we.subtreeFlags&2064)!==0&&Vt!==null)Vt.return=we,hn=Vt;else e:for(we=xt;hn!==null;){if(Ye=hn,(Ye.flags&2048)!==0)try{switch(Ye.tag){case 0:case 11:case 15:xh(9,Ye)}}catch(Nn){yt(Ye,Ye.return,Nn)}if(Ye===we){hn=null;break e}var Br=Ye.sibling;if(Br!==null){Br.return=Ye.return,hn=Br;break e}hn=Ye.return}}if(Ji=Z,ll(),gn&&typeof gn.onPostCommitFiberRoot=="function")try{gn.onPostCommitFiberRoot(Ii,_)}catch{}z=!0}return z}finally{$n=P,_l.transition=w}}return!1}function nt(_,w,P){w=fc(P,w),w=Rf(_,w,1),_=Ll(_,w,1),w=q(),_!==null&&(br(_,1,w),J(_,w))}function yt(_,w,P){if(_.tag===3)nt(_,_,P);else for(;w!==null;){if(w.tag===3){nt(w,_,P);break}else if(w.tag===1){var z=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(p===null||!p.has(z))){_=fc(P,_),_=mh(w,_,1),w=Ll(w,_,1),_=q(),w!==null&&(br(w,1,_),J(w,_));break}}w=w.return}}function Dt(_,w,P){var z=_.pingCache;z!==null&&z.delete(w),w=q(),_.pingedLanes|=_.suspendedLanes&P,$s===_&&(xo&P)===P&&(os===4||os===3&&(xo&130023424)===xo&&500>Ir()-Eu?Te(_,0):wh|=P),J(_,w)}function Kt(_,w){w===0&&((_.mode&1)===0?w=1:(w=Qi,Qi<<=1,(Qi&130023424)===0&&(Qi=4194304)));var P=q();_=cl(_,w),_!==null&&(br(_,w,P),J(_,P))}function Ot(_){var w=_.memoizedState,P=0;w!==null&&(P=w.retryLane),Kt(_,P)}function Ft(_,w){var P=0;switch(_.tag){case 13:var z=_.stateNode,Z=_.memoizedState;Z!==null&&(P=Z.retryLane);break;case 19:z=_.stateNode;break;default:throw Error(a(314))}z!==null&&z.delete(w),Kt(_,P)}var gr;gr=function(_,w,P){if(_!==null)if(_.memoizedProps!==w.pendingProps||Sa.current)Ca=!0;else{if((_.lanes&P)===0&&(w.flags&128)===0)return Ca=!1,vu(_,w,P);Ca=(_.flags&131072)!==0}else Ca=!1,ds&&(w.flags&1048576)!==0&&mf(w,ih,w.index);switch(w.lanes=0,w.tag){case 2:var z=w.type;yh(_,w),_=w.pendingProps;var Z=Ac(w,Ro.current);Qa(w,P),Z=Ef(null,w,z,_,Z,P);var ie=Cf();return w.flags|=1,typeof Z=="object"&&Z!==null&&typeof Z.render=="function"&&Z.$$typeof===void 0?(w.tag=1,w.memoizedState=null,w.updateQueue=null,go(z)?(ie=!0,Xu(w)):ie=!1,w.memoizedState=Z.state!==null&&Z.state!==void 0?Z.state:null,Ap(w),Z.updater=ph,w.stateNode=Z,Z._reactInternals=w,Nf(w,z,_,P),w=pc(null,w,z,!0,ie,P)):(w.tag=0,ds&&ie&&Lm(w),da(null,w,Z,P),w=w.child),w;case 16:z=w.elementType;e:{switch(yh(_,w),_=w.pendingProps,Z=z._init,z=Z(z._payload),w.type=z,Z=w.tag=Gr(z),_=el(z,_),Z){case 0:w=Tn(null,w,z,_,P);break e;case 1:w=Hm(null,w,z,_,P);break e;case 11:w=Xo(null,w,z,_,P);break e;case 14:w=Wm(null,w,z,el(z.type,_),P);break e}throw Error(a(306,z,""))}return w;case 0:return z=w.type,Z=w.pendingProps,Z=w.elementType===z?Z:el(z,Z),Tn(_,w,z,Z,P);case 1:return z=w.type,Z=w.pendingProps,Z=w.elementType===z?Z:el(z,Z),Hm(_,w,z,Z,P);case 3:e:{if(mc(w),_===null)throw Error(a(387));z=w.pendingProps,ie=w.memoizedState,Z=ie.element,Gg(_,w),Va(w,z,null,P);var we=w.memoizedState;if(z=we.element,ie.isDehydrated)if(ie={element:z,isDehydrated:!1,cache:we.cache,pendingSuspenseBoundaries:we.pendingSuspenseBoundaries,transitions:we.transitions},w.updateQueue.baseState=ie,w.memoizedState=ie,w.flags&256){Z=fc(Error(a(423)),w),w=gc(_,w,z,P,Z);break e}else if(z!==Z){Z=fc(Error(a(424)),w),w=gc(_,w,z,P,Z);break e}else for(Ba=sc(w.stateNode.containerInfo.firstChild),Ta=w,ds=!0,Ka=null,P=Ep(w,null,z,P),w.child=P;P;)P.flags=P.flags&-3|4096,P=P.sibling;else{if(Ya(),z===Z){w=Fl(_,w,P);break e}da(_,w,z,P)}w=w.child}return w;case 5:return rd(w),_===null&&uc(w),z=w.type,Z=w.pendingProps,ie=_!==null?_.memoizedProps:null,we=Z.children,Xd(z,Z)?we=null:ie!==null&&Xd(z,ie)&&(w.flags|=32),zi(_,w),da(_,w,we,P),w.child;case 6:return _===null&&uc(w),null;case 13:return Bp(_,w,P);case 4:return vf(w,w.stateNode.containerInfo),z=w.pendingProps,_===null?w.child=ed(w,null,z,P):da(_,w,z,P),w.child;case 11:return z=w.type,Z=w.pendingProps,Z=w.elementType===z?Z:el(z,Z),Xo(_,w,z,Z,P);case 7:return da(_,w,w.pendingProps,P),w.child;case 8:return da(_,w,w.pendingProps.children,P),w.child;case 12:return da(_,w,w.pendingProps.children,P),w.child;case 10:e:{if(z=w.type._context,Z=w.pendingProps,ie=w.memoizedProps,we=Z.value,vs(fu,z._currentValue),z._currentValue=we,ie!==null)if(Vs(ie.value,we)){if(ie.children===Z.children&&!Sa.current){w=Fl(_,w,P);break e}}else for(ie=w.child,ie!==null&&(ie.return=w);ie!==null;){var Ye=ie.dependencies;if(Ye!==null){we=ie.child;for(var ft=Ye.firstContext;ft!==null;){if(ft.context===z){if(ie.tag===1){ft=Ea(-1,P&-P),ft.tag=2;var Bt=ie.updateQueue;if(Bt!==null){Bt=Bt.shared;var vr=Bt.pending;vr===null?ft.next=ft:(ft.next=vr.next,vr.next=ft),Bt.pending=ft}}ie.lanes|=P,ft=ie.alternate,ft!==null&&(ft.lanes|=P),td(ie.return,P,w),Ye.lanes|=P;break}ft=ft.next}}else if(ie.tag===10)we=ie.type===w.type?null:ie.child;else if(ie.tag===18){if(we=ie.return,we===null)throw Error(a(341));we.lanes|=P,Ye=we.alternate,Ye!==null&&(Ye.lanes|=P),td(we,P,w),we=ie.sibling}else we=ie.child;if(we!==null)we.return=ie;else for(we=ie;we!==null;){if(we===w){we=null;break}if(ie=we.sibling,ie!==null){ie.return=we.return,we=ie;break}we=we.return}ie=we}da(_,w,Z.children,P),w=w.child}return w;case 9:return Z=w.type,z=w.pendingProps.children,Qa(w,P),Z=la(Z),z=z(Z),w.flags|=1,da(_,w,z,P),w.child;case 14:return z=w.type,Z=el(z,w.pendingProps),Z=el(z.type,Z),Wm(_,w,z,Z,P);case 15:return Lc(_,w,w.type,w.pendingProps,P);case 17:return z=w.type,Z=w.pendingProps,Z=w.elementType===z?Z:el(z,Z),yh(_,w),w.tag=1,go(z)?(_=!0,Xu(w)):_=!1,Qa(w,P),Xg(w,z,Z),Nf(w,z,Z,P),pc(null,w,z,!0,_,P);case 19:return cd(_,w,P);case 22:return Jg(_,w,P)}throw Error(a(156,w.tag))};function fr(_,w){return ct(_,w)}function sr(_,w,P,z){this.tag=_,this.key=P,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=w,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ar(_,w,P,z){return new sr(_,w,P,z)}function Mr(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Gr(_){if(typeof _=="function")return Mr(_)?1:0;if(_!=null){if(_=_.$$typeof,_===$t)return 11;if(_===Ar)return 14}return 2}function tn(_,w){var P=_.alternate;return P===null?(P=ar(_.tag,w,_.key,_.mode),P.elementType=_.elementType,P.type=_.type,P.stateNode=_.stateNode,P.alternate=_,_.alternate=P):(P.pendingProps=w,P.type=_.type,P.flags=0,P.subtreeFlags=0,P.deletions=null),P.flags=_.flags&14680064,P.childLanes=_.childLanes,P.lanes=_.lanes,P.child=_.child,P.memoizedProps=_.memoizedProps,P.memoizedState=_.memoizedState,P.updateQueue=_.updateQueue,w=_.dependencies,P.dependencies=w===null?null:{lanes:w.lanes,firstContext:w.firstContext},P.sibling=_.sibling,P.index=_.index,P.ref=_.ref,P}function Pn(_,w,P,z,Z,ie){var we=2;if(z=_,typeof _=="function")Mr(_)&&(we=1);else if(typeof _=="string")we=5;else e:switch(_){case We:return Wr(P.children,Z,ie,w);case Ct:we=8,Z|=8;break;case Ht:return _=ar(12,P,w,Z|2),_.elementType=Ht,_.lanes=ie,_;case Rt:return _=ar(13,P,w,Z),_.elementType=Rt,_.lanes=ie,_;case Gt:return _=ar(19,P,w,Z),_.elementType=Gt,_.lanes=ie,_;case Xt:return Fn(P,Z,ie,w);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case Zt:we=10;break e;case rr:we=9;break e;case $t:we=11;break e;case Ar:we=14;break e;case Ut:we=16,z=null;break e}throw Error(a(130,_==null?_:typeof _,""))}return w=ar(we,P,w,Z),w.elementType=_,w.type=z,w.lanes=ie,w}function Wr(_,w,P,z){return _=ar(7,_,z,w),_.lanes=P,_}function Fn(_,w,P,z){return _=ar(22,_,z,w),_.elementType=Xt,_.lanes=P,_.stateNode={isHidden:!1},_}function rn(_,w,P){return _=ar(6,_,null,w),_.lanes=P,_}function oi(_,w,P){return w=ar(4,_.children!==null?_.children:[],_.key,w),w.lanes=P,w.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},w}function hi(_,w,P,z,Z){this.tag=w,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ot(0),this.expirationTimes=ot(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ot(0),this.identifierPrefix=z,this.onRecoverableError=Z,this.mutableSourceEagerHydrationData=null}function fi(_,w,P,z,Z,ie,we,Ye,ft){return _=new hi(_,w,P,Ye,ft),w===1?(w=1,ie===!0&&(w|=8)):w=0,ie=ar(3,null,null,w),_.current=ie,ie.stateNode=_,ie.memoizedState={element:z,isDehydrated:P,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ap(ie),_}function On(_,w,P){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rt,key:z==null?null:""+z,children:_,containerInfo:w,implementation:P}}function un(_){if(!_)return oc;_=_._reactInternals;e:{if(Fe(_)!==_||_.tag!==1)throw Error(a(170));var w=_;do{switch(w.tag){case 3:w=w.stateNode.context;break e;case 1:if(go(w.type)){w=w.stateNode.__reactInternalMemoizedMergedChildContext;break e}}w=w.return}while(w!==null);throw Error(a(171))}if(_.tag===1){var P=_.type;if(go(P))return za(_,P,w)}return w}function ti(_,w,P,z,Z,ie,we,Ye,ft){return _=fi(P,z,!0,_,Z,ie,we,Ye,ft),_.context=un(null),P=_.current,z=q(),Z=U(P),ie=Ea(z,Z),ie.callback=w??null,Ll(P,ie,Z),_.current.lanes=Z,br(_,Z,z),J(_,z),_}function Fi(_,w,P,z){var Z=w.current,ie=q(),we=U(Z);return P=un(P),w.context===null?w.context=P:w.pendingContext=P,w=Ea(ie,we),w.payload={element:_},z=z===void 0?null:z,z!==null&&(w.callback=z),_=Ll(Z,w,we),_!==null&&(G(_,Z,we,ie),hr(_,Z,we)),we}function Bi(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return _.child.stateNode;default:return _.child.stateNode}}function ri(_,w){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var P=_.retryLane;_.retryLane=P!==0&&P<w?P:w}}function wn(_,w){ri(_,w),(_=_.alternate)&&ri(_,w)}function mn(){return null}var ji=typeof reportError=="function"?reportError:function(_){console.error(_)};function es(_){this._internalRoot=_}Pi.prototype.render=es.prototype.render=function(_){var w=this._internalRoot;if(w===null)throw Error(a(409));Fi(_,w,null,null)},Pi.prototype.unmount=es.prototype.unmount=function(){var _=this._internalRoot;if(_!==null){this._internalRoot=null;var w=_.containerInfo;Ce(function(){Fi(null,_,null,null)}),w[Rl]=null}};function Pi(_){this._internalRoot=_}Pi.prototype.unstable_scheduleHydration=function(_){if(_){var w=Lu();_={blockedOn:null,target:_,priority:w};for(var P=0;P<Ei.length&&w!==0&&w<Ei[P].priority;P++);Ei.splice(P,0,_),P===0&&Ql(_)}};function Li(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11)}function bo(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11&&(_.nodeType!==8||_.nodeValue!==" react-mount-point-unstable "))}function fa(){}function Js(_,w,P,z,Z){if(Z){if(typeof z=="function"){var ie=z;z=function(){var Bt=Bi(we);ie.call(Bt)}}var we=ti(w,z,_,0,null,!1,!1,"",fa);return _._reactRootContainer=we,_[Rl]=we.current,lf(_.nodeType===8?_.parentNode:_),Ce(),we}for(;Z=_.lastChild;)_.removeChild(Z);if(typeof z=="function"){var Ye=z;z=function(){var Bt=Bi(ft);Ye.call(Bt)}}var ft=fi(_,0,!1,null,null,!1,!1,"",fa);return _._reactRootContainer=ft,_[Rl]=ft.current,lf(_.nodeType===8?_.parentNode:_),Ce(function(){Fi(w,ft,P,z)}),ft}function Wn(_,w,P,z,Z){var ie=P._reactRootContainer;if(ie){var we=ie;if(typeof Z=="function"){var Ye=Z;Z=function(){var ft=Bi(we);Ye.call(ft)}}Fi(w,we,_,Z)}else we=Js(P,w,_,Z,z);return Bi(we)}Il=function(_){switch(_.tag){case 3:var w=_.stateNode;if(w.current.memoizedState.isDehydrated){var P=po(w.pendingLanes);P!==0&&(Vn(w,P|1),J(w,Ir()),(Ji&6)===0&&(Ff=Ir()+500,ll()))}break;case 13:Ce(function(){var z=cl(_,1);if(z!==null){var Z=q();G(z,_,1,Z)}}),wn(_,1)}},eu=function(_){if(_.tag===13){var w=cl(_,134217728);if(w!==null){var P=q();G(w,_,134217728,P)}wn(_,134217728)}},Rd=function(_){if(_.tag===13){var w=U(_),P=cl(_,w);if(P!==null){var z=q();G(P,_,w,z)}wn(_,w)}},Lu=function(){return $n},Rs=function(_,w){var P=$n;try{return $n=_,w()}finally{$n=P}},ki=function(_,w,P){switch(w){case"input":if(Sr(_,P),w=P.name,P.type==="radio"&&w!=null){for(P=_;P.parentNode;)P=P.parentNode;for(P=P.querySelectorAll("input[name="+JSON.stringify(""+w)+'][type="radio"]'),w=0;w<P.length;w++){var z=P[w];if(z!==_&&z.form===_.form){var Z=pf(z);if(!Z)throw Error(a(90));Ti(z),Sr(z,Z)}}}break;case"textarea":pr(_,P);break;case"select":w=P.value,w!=null&&Je(_,!!P.multiple,w,!1)}},oo=Ne,Is=Ce;var $a={usingClientEntryPoint:!1,Events:[Qd,Ml,pf,_i,Ds,Ne]},zs={findFiberByHostInstance:lu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pa={bundleType:zs.bundleType,version:zs.version,rendererPackageName:zs.rendererPackageName,rendererConfig:zs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Re.ReactCurrentDispatcher,findHostInstanceByFiber:function(_){return _=Ve(_),_===null?null:_.stateNode},findFiberByHostInstance:zs.findFiberByHostInstance||mn,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ia=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ia.isDisabled&&Ia.supportsFiber)try{Ii=Ia.inject(pa),gn=Ia}catch{}}return yc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$a,yc.createPortal=function(_,w){var P=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Li(w))throw Error(a(200));return On(_,w,null,P)},yc.createRoot=function(_,w){if(!Li(_))throw Error(a(299));var P=!1,z="",Z=ji;return w!=null&&(w.unstable_strictMode===!0&&(P=!0),w.identifierPrefix!==void 0&&(z=w.identifierPrefix),w.onRecoverableError!==void 0&&(Z=w.onRecoverableError)),w=fi(_,1,!1,null,null,P,!1,z,Z),_[Rl]=w.current,lf(_.nodeType===8?_.parentNode:_),new es(w)},yc.findDOMNode=function(_){if(_==null)return null;if(_.nodeType===1)return _;var w=_._reactInternals;if(w===void 0)throw typeof _.render=="function"?Error(a(188)):(_=Object.keys(_).join(","),Error(a(268,_)));return _=Ve(w),_=_===null?null:_.stateNode,_},yc.flushSync=function(_){return Ce(_)},yc.hydrate=function(_,w,P){if(!bo(w))throw Error(a(200));return Wn(null,_,w,!0,P)},yc.hydrateRoot=function(_,w,P){if(!Li(_))throw Error(a(405));var z=P!=null&&P.hydratedSources||null,Z=!1,ie="",we=ji;if(P!=null&&(P.unstable_strictMode===!0&&(Z=!0),P.identifierPrefix!==void 0&&(ie=P.identifierPrefix),P.onRecoverableError!==void 0&&(we=P.onRecoverableError)),w=ti(w,null,_,1,P??null,Z,!1,ie,we),_[Rl]=w.current,lf(_),z)for(_=0;_<z.length;_++)P=z[_],Z=P._getVersion,Z=Z(P._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[P,Z]:w.mutableSourceEagerHydrationData.push(P,Z);return new Pi(w)},yc.render=function(_,w,P){if(!bo(w))throw Error(a(200));return Wn(null,_,w,!1,P)},yc.unmountComponentAtNode=function(_){if(!bo(_))throw Error(a(40));return _._reactRootContainer?(Ce(function(){Wn(null,null,_,!1,function(){_._reactRootContainer=null,_[Rl]=null})}),!0):!1},yc.unstable_batchedUpdates=Ne,yc.unstable_renderSubtreeIntoContainer=function(_,w,P,z){if(!bo(P))throw Error(a(200));if(_==null||_._reactInternals===void 0)throw Error(a(38));return Wn(_,w,P,!1,z)},yc.version="18.3.1-next-f1338f8080-20240426",yc}var Ik;function QR(){if(Ik)return yS.exports;Ik=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(n){console.error(n)}}return i(),yS.exports=bU(),yS.exports}var Pk;function wU(){if(Pk)return Mb;Pk=1;var i=QR();return Mb.createRoot=i.createRoot,Mb.hydrateRoot=i.hydrateRoot,Mb}var SU=wU();function TU(i,n){if(i instanceof RegExp)return{keys:!1,pattern:i};var a,d,y,v,C=[],s="",M=i.split("/");for(M[0]||M.shift();y=M.shift();)a=y[0],a==="*"?(C.push(a),s+=y[1]==="?"?"(?:/(.*))?":"/(.*)"):a===":"?(d=y.indexOf("?",1),v=y.indexOf(".",1),C.push(y.substring(1,~d?d:~v?v:y.length)),s+=~d&&!~v?"(?:/([^/]+?))?":"/([^/]+?)",~v&&(s+=(~d?"?":"")+"\\"+y.substring(v))):s+="/"+y;return{keys:C,pattern:new RegExp("^"+s+(n?"(?=$|/)":"/?$"),"i")}}var $=ew();const Un=J0($),x2=KR({__proto__:null,default:Un},[$]);var vS={exports:{}},bS={};var kk;function EU(){if(kk)return bS;kk=1;var i=ew();function n(W,X){return W===X&&(W!==0||1/W===1/X)||W!==W&&X!==X}var a=typeof Object.is=="function"?Object.is:n,d=i.useState,y=i.useEffect,v=i.useLayoutEffect,C=i.useDebugValue;function s(W,X){var ee=X(),he=d({inst:{value:ee,getSnapshot:X}}),se=he[0].inst,oe=he[1];return v(function(){se.value=ee,se.getSnapshot=X,M(se)&&oe({inst:se})},[W,ee,X]),y(function(){return M(se)&&oe({inst:se}),W(function(){M(se)&&oe({inst:se})})},[W]),C(ee),ee}function M(W){var X=W.getSnapshot;W=W.value;try{var ee=X();return!a(W,ee)}catch{return!0}}function L(W,X){return X()}var F=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?L:s;return bS.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:F,bS}var Nk;function CU(){return Nk||(Nk=1,vS.exports=EU()),vS.exports}var JR=CU();const AU=x2.useInsertionEffect,IU=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",PU=IU?$.useLayoutEffect:$.useEffect,kU=AU||PU,eM=i=>{const n=$.useRef([i,(...a)=>n[0](...a)]).current;return kU(()=>{n[0]=i}),n[1]},NU="popstate",v2="pushState",b2="replaceState",jU="hashchange",jk=[NU,v2,b2,jU],RU=i=>{for(const n of jk)addEventListener(n,i);return()=>{for(const n of jk)removeEventListener(n,i)}},tM=(i,n)=>JR.useSyncExternalStore(RU,i,n),MU=()=>location.search,LU=({ssrSearch:i=""}={})=>tM(MU,()=>i),Rk=()=>location.pathname,DU=({ssrPath:i}={})=>tM(Rk,i?()=>i:Rk),OU=(i,{replace:n=!1,state:a=null}={})=>history[n?b2:v2](a,"",i),zU=(i={})=>[DU(i),OU],Mk=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Mk]>"u"){for(const i of[v2,b2]){const n=history[i];history[i]=function(){const a=n.apply(this,arguments),d=new Event(i);return d.arguments=arguments,dispatchEvent(d),a}}Object.defineProperty(window,Mk,{value:!0})}const FU=(i,n)=>n.toLowerCase().indexOf(i.toLowerCase())?"~"+n:n.slice(i.length)||"/",rM=(i="")=>i==="/"?"":i,BU=(i,n)=>i[0]==="~"?i.slice(1):rM(n)+i,VU=(i="",n)=>FU(Lk(rM(i)),Lk(n)),Lk=i=>{try{return decodeURI(i)}catch{return i}},nM={hook:zU,searchHook:LU,parser:TU,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:i=>i},iM=$.createContext(nM),yv=()=>$.useContext(iM),sM={},oM=$.createContext(sM),UU=()=>$.useContext(oM),tw=i=>{const[n,a]=i.hook(i);return[VU(i.base,n),eM((d,y)=>a(BU(d,i.base),y))]},Al=()=>tw(yv()),aM=(i,n,a,d)=>{const{pattern:y,keys:v}=n instanceof RegExp?{keys:!1,pattern:n}:i(n||"*",d),C=y.exec(a)||[],[s,...M]=C;return s!==void 0?[!0,(()=>{const L=v!==!1?Object.fromEntries(v.map((W,X)=>[W,M[X]])):C.groups;let F={...M};return L&&Object.assign(F,L),F})(),...d?[s]:[]]:[!1,null]},$U=({children:i,...n})=>{const a=yv(),d=n.hook?nM:a;let y=d;const[v,C]=n.ssrPath?.split("?")??[];C&&(n.ssrSearch=C,n.ssrPath=v),n.hrefs=n.hrefs??n.hook?.hrefs;let s=$.useRef({}),M=s.current,L=M;for(let F in d){const W=F==="base"?d[F]+(n[F]||""):n[F]||d[F];M===L&&W!==L[F]&&(s.current=L={...L}),L[F]=W,(W!==d[F]||W!==y[F])&&(y=L)}return $.createElement(iM.Provider,{value:y,children:i})},Dk=({children:i,component:n},a)=>n?$.createElement(n,{params:a}):typeof i=="function"?i(a):i,qU=i=>{let n=$.useRef(sM);const a=n.current;return n.current=Object.keys(i).length!==Object.keys(a).length||Object.entries(i).some(([d,y])=>y!==a[d])?i:a},gs=({path:i,nest:n,match:a,...d})=>{const y=yv(),[v]=tw(y),[C,s,M]=a??aM(y.parser,i,v,n),L=qU({...UU(),...s});if(!C)return null;const F=M?$.createElement($U,{base:M},Dk(d,L)):Dk(d,L);return $.createElement(oM.Provider,{value:L,children:F})},xn=$.forwardRef((i,n)=>{const a=yv(),[d,y]=tw(a),{to:v="",href:C=v,onClick:s,asChild:M,children:L,className:F,replace:W,state:X,...ee}=i,he=eM(oe=>{oe.ctrlKey||oe.metaKey||oe.altKey||oe.shiftKey||oe.button!==0||(s?.(oe),oe.defaultPrevented||(oe.preventDefault(),y(C,i)))}),se=a.hrefs(C[0]==="~"?C.slice(1):a.base+C,a);return M&&$.isValidElement(L)?$.cloneElement(L,{onClick:he,href:se}):$.createElement("a",{...ee,onClick:he,href:se,className:F?.call?F(d===C):F,children:L,ref:n})}),lM=i=>Array.isArray(i)?i.flatMap(n=>lM(n&&n.type===$.Fragment?n.props.children:n)):[i],GU=({children:i,location:n})=>{const a=yv(),[d]=tw(a);for(const y of lM(i)){let v=0;if($.isValidElement(y)&&(v=aM(a.parser,y.props.path,n||d,y.props.nest))[0])return $.cloneElement(y,{match:v})}return null};var _v=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},WU={setTimeout:(i,n)=>setTimeout(i,n),clearTimeout:i=>clearTimeout(i),setInterval:(i,n)=>setInterval(i,n),clearInterval:i=>clearInterval(i)},HU=class{#e=WU;#r=!1;setTimeoutProvider(i){this.#e=i}setTimeout(i,n){return this.#e.setTimeout(i,n)}clearTimeout(i){this.#e.clearTimeout(i)}setInterval(i,n){return this.#e.setInterval(i,n)}clearInterval(i){this.#e.clearInterval(i)}},hT=new HU;function ZU(i){setTimeout(i,0)}var rw=typeof window>"u"||"Deno"in globalThis;function ju(){}function XU(i,n){return typeof i=="function"?i(n):i}function KU(i){return typeof i=="number"&&i>=0&&i!==1/0}function YU(i,n){return Math.max(i+(n||0)-Date.now(),0)}function fT(i,n){return typeof i=="function"?i(n):i}function QU(i,n){return typeof i=="function"?i(n):i}function Ok(i,n){const{type:a="all",exact:d,fetchStatus:y,predicate:v,queryKey:C,stale:s}=i;if(C){if(d){if(n.queryHash!==w2(C,n.options))return!1}else if(!Fx(n.queryKey,C))return!1}if(a!=="all"){const M=n.isActive();if(a==="active"&&!M||a==="inactive"&&M)return!1}return!(typeof s=="boolean"&&n.isStale()!==s||y&&y!==n.state.fetchStatus||v&&!v(n))}function zk(i,n){const{exact:a,status:d,predicate:y,mutationKey:v}=i;if(v){if(!n.options.mutationKey)return!1;if(a){if(Ag(n.options.mutationKey)!==Ag(v))return!1}else if(!Fx(n.options.mutationKey,v))return!1}return!(d&&n.state.status!==d||y&&!y(n))}function w2(i,n){return(n?.queryKeyHashFn||Ag)(i)}function Ag(i){return JSON.stringify(i,(n,a)=>pT(a)?Object.keys(a).sort().reduce((d,y)=>(d[y]=a[y],d),{}):a)}function Fx(i,n){return i===n?!0:typeof i!=typeof n?!1:i&&n&&typeof i=="object"&&typeof n=="object"?Object.keys(n).every(a=>Fx(i[a],n[a])):!1}var JU=Object.prototype.hasOwnProperty;function cM(i,n){if(i===n)return i;const a=Fk(i)&&Fk(n);if(!a&&!(pT(i)&&pT(n)))return n;const y=(a?i:Object.keys(i)).length,v=a?n:Object.keys(n),C=v.length,s=a?new Array(C):{};let M=0;for(let L=0;L<C;L++){const F=a?L:v[L],W=i[F],X=n[F];if(W===X){s[F]=W,(a?L<y:JU.call(i,F))&&M++;continue}if(W===null||X===null||typeof W!="object"||typeof X!="object"){s[F]=X;continue}const ee=cM(W,X);s[F]=ee,ee===W&&M++}return y===C&&M===y?i:s}function e6(i,n){if(!n||Object.keys(i).length!==Object.keys(n).length)return!1;for(const a in i)if(i[a]!==n[a])return!1;return!0}function Fk(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function pT(i){if(!Bk(i))return!1;const n=i.constructor;if(n===void 0)return!0;const a=n.prototype;return!(!Bk(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function Bk(i){return Object.prototype.toString.call(i)==="[object Object]"}function t6(i){return new Promise(n=>{hT.setTimeout(n,i)})}function r6(i,n,a){return typeof a.structuralSharing=="function"?a.structuralSharing(i,n):a.structuralSharing!==!1?cM(i,n):n}function n6(i,n,a=0){const d=[...i,n];return a&&d.length>a?d.slice(1):d}function i6(i,n,a=0){const d=[n,...i];return a&&d.length>a?d.slice(0,-1):d}var S2=Symbol();function uM(i,n){return!i.queryFn&&n?.initialPromise?()=>n.initialPromise:!i.queryFn||i.queryFn===S2?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}function s6(i,n){return typeof i=="function"?i(...n):!!i}var o6=class extends _v{#e;#r;#t;constructor(){super(),this.#t=i=>{if(!rw&&window.addEventListener){const n=()=>i();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}}}onSubscribe(){this.#r||this.setEventListener(this.#t)}onUnsubscribe(){this.hasListeners()||(this.#r?.(),this.#r=void 0)}setEventListener(i){this.#t=i,this.#r?.(),this.#r=i(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()})}setFocused(i){this.#e!==i&&(this.#e=i,this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(n=>{n(i)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},dM=new o6;function a6(){let i,n;const a=new Promise((y,v)=>{i=y,n=v});a.status="pending",a.catch(()=>{});function d(y){Object.assign(a,y),delete a.resolve,delete a.reject}return a.resolve=y=>{d({status:"fulfilled",value:y}),i(y)},a.reject=y=>{d({status:"rejected",reason:y}),n(y)},a}var l6=ZU;function c6(){let i=[],n=0,a=s=>{s()},d=s=>{s()},y=l6;const v=s=>{n?i.push(s):y(()=>{a(s)})},C=()=>{const s=i;i=[],s.length&&y(()=>{d(()=>{s.forEach(M=>{a(M)})})})};return{batch:s=>{let M;n++;try{M=s()}finally{n--,n||C()}return M},batchCalls:s=>(...M)=>{v(()=>{s(...M)})},schedule:v,setNotifyFunction:s=>{a=s},setBatchNotifyFunction:s=>{d=s},setScheduler:s=>{y=s}}}var il=c6(),u6=class extends _v{#e=!0;#r;#t;constructor(){super(),this.#t=i=>{if(!rw&&window.addEventListener){const n=()=>i(!0),a=()=>i(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a)}}}}onSubscribe(){this.#r||this.setEventListener(this.#t)}onUnsubscribe(){this.hasListeners()||(this.#r?.(),this.#r=void 0)}setEventListener(i){this.#t=i,this.#r?.(),this.#r=i(this.setOnline.bind(this))}setOnline(i){this.#e!==i&&(this.#e=i,this.listeners.forEach(a=>{a(i)}))}isOnline(){return this.#e}},v0=new u6;function d6(i){return Math.min(1e3*2**i,3e4)}function hM(i){return(i??"online")==="online"?v0.isOnline():!0}var mT=class extends Error{constructor(i){super("CancelledError"),this.revert=i?.revert,this.silent=i?.silent}};function fM(i){let n=!1,a=0,d;const y=a6(),v=()=>y.status!=="pending",C=se=>{if(!v()){const oe=new mT(se);X(oe),i.onCancel?.(oe)}},s=()=>{n=!0},M=()=>{n=!1},L=()=>dM.isFocused()&&(i.networkMode==="always"||v0.isOnline())&&i.canRun(),F=()=>hM(i.networkMode)&&i.canRun(),W=se=>{v()||(d?.(),y.resolve(se))},X=se=>{v()||(d?.(),y.reject(se))},ee=()=>new Promise(se=>{d=oe=>{(v()||L())&&se(oe)},i.onPause?.()}).then(()=>{d=void 0,v()||i.onContinue?.()}),he=()=>{if(v())return;let se;const oe=a===0?i.initialPromise:void 0;try{se=oe??i.fn()}catch(ve){se=Promise.reject(ve)}Promise.resolve(se).then(W).catch(ve=>{if(v())return;const me=i.retry??(rw?0:3),Se=i.retryDelay??d6,Re=typeof Se=="function"?Se(a,ve):Se,Be=me===!0||typeof me=="number"&&a<me||typeof me=="function"&&me(a,ve);if(n||!Be){X(ve);return}a++,i.onFail?.(a,ve),t6(Re).then(()=>L()?void 0:ee()).then(()=>{n?X(ve):he()})})};return{promise:y,status:()=>y.status,cancel:C,continue:()=>(d?.(),y),cancelRetry:s,continueRetry:M,canStart:F,start:()=>(F()?he():ee().then(he),y)}}var pM=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),KU(this.gcTime)&&(this.#e=hT.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(rw?1/0:300*1e3))}clearGcTimeout(){this.#e&&(hT.clearTimeout(this.#e),this.#e=void 0)}},h6=class extends pM{#e;#r;#t;#i;#n;#o;#a;constructor(i){super(),this.#a=!1,this.#o=i.defaultOptions,this.setOptions(i.options),this.observers=[],this.#i=i.client,this.#t=this.#i.getQueryCache(),this.queryKey=i.queryKey,this.queryHash=i.queryHash,this.#e=Vk(this.options),this.state=i.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(i){if(this.options={...this.#o,...i},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Vk(this.options);n.data!==void 0&&(this.setData(n.data,{updatedAt:n.dataUpdatedAt,manual:!0}),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#t.remove(this)}setData(i,n){const a=r6(this.state.data,i,this.options);return this.#s({data:a,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),a}setState(i,n){this.#s({type:"setState",state:i,setStateOptions:n})}cancel(i){const n=this.#n?.promise;return this.#n?.cancel(i),n?n.then(ju).catch(ju):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(i=>QU(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===S2||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>fT(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!YU(this.state.dataUpdatedAt,i)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(n=>n!==i),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#t.notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(i,n){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(i&&this.setOptions(i),!this.options.queryFn){const s=this.observers.find(M=>M.options.queryFn);s&&this.setOptions(s.options)}const a=new AbortController,d=s=>{Object.defineProperty(s,"signal",{enumerable:!0,get:()=>(this.#a=!0,a.signal)})},y=()=>{const s=uM(this.options,n),L=(()=>{const F={client:this.#i,queryKey:this.queryKey,meta:this.meta};return d(F),F})();return this.#a=!1,this.options.persister?this.options.persister(s,L,this):s(L)},C=(()=>{const s={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:y};return d(s),s})();this.options.behavior?.onFetch(C,this),this.#r=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==C.fetchOptions?.meta)&&this.#s({type:"fetch",meta:C.fetchOptions?.meta}),this.#n=fM({initialPromise:n?.initialPromise,fn:C.fetchFn,onCancel:s=>{s instanceof mT&&s.revert&&this.setState({...this.#r,fetchStatus:"idle"}),a.abort()},onFail:(s,M)=>{this.#s({type:"failed",failureCount:s,error:M})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:C.options.retry,retryDelay:C.options.retryDelay,networkMode:C.options.networkMode,canRun:()=>!0});try{const s=await this.#n.start();if(s===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(s),this.#t.config.onSuccess?.(s,this),this.#t.config.onSettled?.(s,this.state.error,this),s}catch(s){if(s instanceof mT){if(s.silent)return this.#n.promise;if(s.revert){if(this.state.data===void 0)throw s;return this.state.data}}throw this.#s({type:"error",error:s}),this.#t.config.onError?.(s,this),this.#t.config.onSettled?.(this.state.data,s,this),s}finally{this.scheduleGc()}}#s(i){const n=a=>{switch(i.type){case"failed":return{...a,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...f6(a.data,this.options),fetchMeta:i.meta??null};case"success":const d={...a,data:i.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:i.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#r=i.manual?d:void 0,d;case"error":const y=i.error;return{...a,error:y,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:y,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...i.state}}};this.state=n(this.state),il.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),this.#t.notify({query:this,type:"updated",action:i})})}};function f6(i,n){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:hM(n.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function Vk(i){const n=typeof i.initialData=="function"?i.initialData():i.initialData,a=n!==void 0,d=a?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:n,dataUpdateCount:0,dataUpdatedAt:a?d??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}function Uk(i){return{onFetch:(n,a)=>{const d=n.options,y=n.fetchOptions?.meta?.fetchMore?.direction,v=n.state.data?.pages||[],C=n.state.data?.pageParams||[];let s={pages:[],pageParams:[]},M=0;const L=async()=>{let F=!1;const W=he=>{Object.defineProperty(he,"signal",{enumerable:!0,get:()=>(n.signal.aborted?F=!0:n.signal.addEventListener("abort",()=>{F=!0}),n.signal)})},X=uM(n.options,n.fetchOptions),ee=async(he,se,oe)=>{if(F)return Promise.reject();if(se==null&&he.pages.length)return Promise.resolve(he);const me=(()=>{const rt={client:n.client,queryKey:n.queryKey,pageParam:se,direction:oe?"backward":"forward",meta:n.options.meta};return W(rt),rt})(),Se=await X(me),{maxPages:Re}=n.options,Be=oe?i6:n6;return{pages:Be(he.pages,Se,Re),pageParams:Be(he.pageParams,se,Re)}};if(y&&v.length){const he=y==="backward",se=he?p6:$k,oe={pages:v,pageParams:C},ve=se(d,oe);s=await ee(oe,ve,he)}else{const he=i??v.length;do{const se=M===0?C[0]??d.initialPageParam:$k(d,s);if(M>0&&se==null)break;s=await ee(s,se),M++}while(M<he)}return s};n.options.persister?n.fetchFn=()=>n.options.persister?.(L,{client:n.client,queryKey:n.queryKey,meta:n.options.meta,signal:n.signal},a):n.fetchFn=L}}}function $k(i,{pages:n,pageParams:a}){const d=n.length-1;return n.length>0?i.getNextPageParam(n[d],n,a[d],a):void 0}function p6(i,{pages:n,pageParams:a}){return n.length>0?i.getPreviousPageParam?.(n[0],n,a[0],a):void 0}var m6=class extends pM{#e;#r;#t;#i;constructor(i){super(),this.#e=i.client,this.mutationId=i.mutationId,this.#t=i.mutationCache,this.#r=[],this.state=i.state||mM(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){this.#r.includes(i)||(this.#r.push(i),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){this.#r=this.#r.filter(n=>n!==i),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){this.#r.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(i){const n=()=>{this.#n({type:"continue"})},a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=fM({fn:()=>this.options.mutationFn?this.options.mutationFn(i,a):Promise.reject(new Error("No mutationFn found")),onFail:(v,C)=>{this.#n({type:"failed",failureCount:v,error:C})},onPause:()=>{this.#n({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const d=this.state.status==="pending",y=!this.#i.canStart();try{if(d)n();else{this.#n({type:"pending",variables:i,isPaused:y}),await this.#t.config.onMutate?.(i,this,a);const C=await this.options.onMutate?.(i,a);C!==this.state.context&&this.#n({type:"pending",context:C,variables:i,isPaused:y})}const v=await this.#i.start();return await this.#t.config.onSuccess?.(v,i,this.state.context,this,a),await this.options.onSuccess?.(v,i,this.state.context,a),await this.#t.config.onSettled?.(v,null,this.state.variables,this.state.context,this,a),await this.options.onSettled?.(v,null,i,this.state.context,a),this.#n({type:"success",data:v}),v}catch(v){try{throw await this.#t.config.onError?.(v,i,this.state.context,this,a),await this.options.onError?.(v,i,this.state.context,a),await this.#t.config.onSettled?.(void 0,v,this.state.variables,this.state.context,this,a),await this.options.onSettled?.(void 0,v,i,this.state.context,a),v}finally{this.#n({type:"error",error:v})}}finally{this.#t.runNext(this)}}#n(i){const n=a=>{switch(i.type){case"failed":return{...a,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...a,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:i.error,failureCount:a.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=n(this.state),il.batch(()=>{this.#r.forEach(a=>{a.onMutationUpdate(i)}),this.#t.notify({mutation:this,type:"updated",action:i})})}};function mM(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var g6=class extends _v{constructor(i={}){super(),this.config=i,this.#e=new Set,this.#r=new Map,this.#t=0}#e;#r;#t;build(i,n,a){const d=new m6({client:i,mutationCache:this,mutationId:++this.#t,options:i.defaultMutationOptions(n),state:a});return this.add(d),d}add(i){this.#e.add(i);const n=Lb(i);if(typeof n=="string"){const a=this.#r.get(n);a?a.push(i):this.#r.set(n,[i])}this.notify({type:"added",mutation:i})}remove(i){if(this.#e.delete(i)){const n=Lb(i);if(typeof n=="string"){const a=this.#r.get(n);if(a)if(a.length>1){const d=a.indexOf(i);d!==-1&&a.splice(d,1)}else a[0]===i&&this.#r.delete(n)}}this.notify({type:"removed",mutation:i})}canRun(i){const n=Lb(i);if(typeof n=="string"){const d=this.#r.get(n)?.find(y=>y.state.status==="pending");return!d||d===i}else return!0}runNext(i){const n=Lb(i);return typeof n=="string"?this.#r.get(n)?.find(d=>d!==i&&d.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){il.batch(()=>{this.#e.forEach(i=>{this.notify({type:"removed",mutation:i})}),this.#e.clear(),this.#r.clear()})}getAll(){return Array.from(this.#e)}find(i){const n={exact:!0,...i};return this.getAll().find(a=>zk(n,a))}findAll(i={}){return this.getAll().filter(n=>zk(i,n))}notify(i){il.batch(()=>{this.listeners.forEach(n=>{n(i)})})}resumePausedMutations(){const i=this.getAll().filter(n=>n.state.isPaused);return il.batch(()=>Promise.all(i.map(n=>n.continue().catch(ju))))}};function Lb(i){return i.options.scope?.id}var y6=class extends _v{#e;#r=void 0;#t;#i;constructor(n,a){super(),this.#e=n,this.setOptions(a),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){const a=this.options;this.options=this.#e.defaultMutationOptions(n),e6(this.options,a)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),a?.mutationKey&&this.options.mutationKey&&Ag(a.mutationKey)!==Ag(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(n){this.#n(),this.#o(n)}getCurrentResult(){return this.#r}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#n(),this.#o()}mutate(n,a){return this.#i=a,this.#t?.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(n)}#n(){const n=this.#t?.state??mM();this.#r={...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset}}#o(n){il.batch(()=>{if(this.#i&&this.hasListeners()){const a=this.#r.variables,d=this.#r.context,y={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};n?.type==="success"?(this.#i.onSuccess?.(n.data,a,d,y),this.#i.onSettled?.(n.data,null,a,d,y)):n?.type==="error"&&(this.#i.onError?.(n.error,a,d,y),this.#i.onSettled?.(void 0,n.error,a,d,y))}this.listeners.forEach(a=>{a(this.#r)})})}},_6=class extends _v{constructor(i={}){super(),this.config=i,this.#e=new Map}#e;build(i,n,a){const d=n.queryKey,y=n.queryHash??w2(d,n);let v=this.get(y);return v||(v=new h6({client:i,queryKey:d,queryHash:y,options:i.defaultQueryOptions(n),state:a,defaultOptions:i.getQueryDefaults(d)}),this.add(v)),v}add(i){this.#e.has(i.queryHash)||(this.#e.set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const n=this.#e.get(i.queryHash);n&&(i.destroy(),n===i&&this.#e.delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){il.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return this.#e.get(i)}getAll(){return[...this.#e.values()]}find(i){const n={exact:!0,...i};return this.getAll().find(a=>Ok(n,a))}findAll(i={}){const n=this.getAll();return Object.keys(i).length>0?n.filter(a=>Ok(i,a)):n}notify(i){il.batch(()=>{this.listeners.forEach(n=>{n(i)})})}onFocus(){il.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){il.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},x6=class{#e;#r;#t;#i;#n;#o;#a;#s;constructor(i={}){this.#e=i.queryCache||new _6,this.#r=i.mutationCache||new g6,this.#t=i.defaultOptions||{},this.#i=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=dM.subscribe(async i=>{i&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=v0.subscribe(async i=>{i&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(i){return this.#e.findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return this.#r.findAll({...i,status:"pending"}).length}getQueryData(i){const n=this.defaultQueryOptions({queryKey:i});return this.#e.get(n.queryHash)?.state.data}ensureQueryData(i){const n=this.defaultQueryOptions(i),a=this.#e.build(this,n),d=a.state.data;return d===void 0?this.fetchQuery(i):(i.revalidateIfStale&&a.isStaleByTime(fT(n.staleTime,a))&&this.prefetchQuery(n),Promise.resolve(d))}getQueriesData(i){return this.#e.findAll(i).map(({queryKey:n,state:a})=>{const d=a.data;return[n,d]})}setQueryData(i,n,a){const d=this.defaultQueryOptions({queryKey:i}),v=this.#e.get(d.queryHash)?.state.data,C=XU(n,v);if(C!==void 0)return this.#e.build(this,d).setData(C,{...a,manual:!0})}setQueriesData(i,n,a){return il.batch(()=>this.#e.findAll(i).map(({queryKey:d})=>[d,this.setQueryData(d,n,a)]))}getQueryState(i){const n=this.defaultQueryOptions({queryKey:i});return this.#e.get(n.queryHash)?.state}removeQueries(i){const n=this.#e;il.batch(()=>{n.findAll(i).forEach(a=>{n.remove(a)})})}resetQueries(i,n){const a=this.#e;return il.batch(()=>(a.findAll(i).forEach(d=>{d.reset()}),this.refetchQueries({type:"active",...i},n)))}cancelQueries(i,n={}){const a={revert:!0,...n},d=il.batch(()=>this.#e.findAll(i).map(y=>y.cancel(a)));return Promise.all(d).then(ju).catch(ju)}invalidateQueries(i,n={}){return il.batch(()=>(this.#e.findAll(i).forEach(a=>{a.invalidate()}),i?.refetchType==="none"?Promise.resolve():this.refetchQueries({...i,type:i?.refetchType??i?.type??"active"},n)))}refetchQueries(i,n={}){const a={...n,cancelRefetch:n.cancelRefetch??!0},d=il.batch(()=>this.#e.findAll(i).filter(y=>!y.isDisabled()&&!y.isStatic()).map(y=>{let v=y.fetch(void 0,a);return a.throwOnError||(v=v.catch(ju)),y.state.fetchStatus==="paused"?Promise.resolve():v}));return Promise.all(d).then(ju)}fetchQuery(i){const n=this.defaultQueryOptions(i);n.retry===void 0&&(n.retry=!1);const a=this.#e.build(this,n);return a.isStaleByTime(fT(n.staleTime,a))?a.fetch(n):Promise.resolve(a.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(ju).catch(ju)}fetchInfiniteQuery(i){return i.behavior=Uk(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(ju).catch(ju)}ensureInfiniteQueryData(i){return i.behavior=Uk(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return v0.isOnline()?this.#r.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#r}getDefaultOptions(){return this.#t}setDefaultOptions(i){this.#t=i}setQueryDefaults(i,n){this.#i.set(Ag(i),{queryKey:i,defaultOptions:n})}getQueryDefaults(i){const n=[...this.#i.values()],a={};return n.forEach(d=>{Fx(i,d.queryKey)&&Object.assign(a,d.defaultOptions)}),a}setMutationDefaults(i,n){this.#n.set(Ag(i),{mutationKey:i,defaultOptions:n})}getMutationDefaults(i){const n=[...this.#n.values()],a={};return n.forEach(d=>{Fx(i,d.mutationKey)&&Object.assign(a,d.defaultOptions)}),a}defaultQueryOptions(i){if(i._defaulted)return i;const n={...this.#t.queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return n.queryHash||(n.queryHash=w2(n.queryKey,n)),n.refetchOnReconnect===void 0&&(n.refetchOnReconnect=n.networkMode!=="always"),n.throwOnError===void 0&&(n.throwOnError=!!n.suspense),!n.networkMode&&n.persister&&(n.networkMode="offlineFirst"),n.queryFn===S2&&(n.enabled=!1),n}defaultMutationOptions(i){return i?._defaulted?i:{...this.#t.mutations,...i?.mutationKey&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){this.#e.clear(),this.#r.clear()}},gM=$.createContext(void 0),v6=i=>{const n=$.useContext(gM);if(!n)throw new Error("No QueryClient set, use QueryClientProvider to set one");return n},b6=({client:i,children:n})=>($.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),h.jsx(gM.Provider,{value:i,children:n}));function yM(i,n){const a=v6(),[d]=$.useState(()=>new y6(a,i));$.useEffect(()=>{d.setOptions(i)},[d,i]);const y=$.useSyncExternalStore($.useCallback(C=>d.subscribe(il.batchCalls(C)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),v=$.useCallback((C,s)=>{d.mutate(C,s).catch(ju)},[d]);if(y.error&&s6(d.options.throwOnError,[y.error]))throw y.error;return{...y,mutate:v,mutateAsync:y.mutate}}async function w6(i){if(!i.ok){const n=await i.text()||i.statusText;throw new Error(`${i.status}: ${n}`)}}const S6=({on401:i})=>async({queryKey:n})=>{const a=await fetch(n[0],{credentials:"include"});return await w6(a),await a.json()},T6=new x6({defaultOptions:{queries:{queryFn:S6({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),E6=1,C6=1e6;let wS=0;function A6(){return wS=(wS+1)%Number.MAX_SAFE_INTEGER,wS.toString()}const SS=new Map,qk=i=>{if(SS.has(i))return;const n=setTimeout(()=>{SS.delete(i),Ix({type:"REMOVE_TOAST",toastId:i})},C6);SS.set(i,n)},I6=(i,n)=>{switch(n.type){case"ADD_TOAST":return{...i,toasts:[n.toast,...i.toasts].slice(0,E6)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(a=>a.id===n.toast.id?{...a,...n.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=n;return a?qk(a):i.toasts.forEach(d=>{qk(d.id)}),{...i,toasts:i.toasts.map(d=>d.id===a||a===void 0?{...d,open:!1}:d)}}case"REMOVE_TOAST":return n.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(a=>a.id!==n.toastId)}}},a0=[];let l0={toasts:[]};function Ix(i){l0=I6(l0,i),a0.forEach(n=>{n(l0)})}function P6({...i}){const n=A6(),a=y=>Ix({type:"UPDATE_TOAST",toast:{...y,id:n}}),d=()=>Ix({type:"DISMISS_TOAST",toastId:n});return Ix({type:"ADD_TOAST",toast:{...i,id:n,open:!0,onOpenChange:y=>{y||d()}}}),{id:n,dismiss:d,update:a}}function xv(){const[i,n]=$.useState(l0);return $.useEffect(()=>(a0.push(n),()=>{const a=a0.indexOf(n);a>-1&&a0.splice(a,1)}),[i]),{...i,toast:P6,dismiss:a=>Ix({type:"DISMISS_TOAST",toastId:a})}}var nw=QR();const k6=J0(nw);function ci(i,n,{checkForDefaultPrevented:a=!0}={}){return function(y){if(i?.(y),a===!1||!y.defaultPrevented)return n?.(y)}}function Gk(i,n){if(typeof i=="function")return i(n);i!=null&&(i.current=n)}function iw(...i){return n=>{let a=!1;const d=i.map(y=>{const v=Gk(y,n);return!a&&typeof v=="function"&&(a=!0),v});if(a)return()=>{for(let y=0;y<d.length;y++){const v=d[y];typeof v=="function"?v():Gk(i[y],null)}}}}function ta(...i){return $.useCallback(iw(...i),i)}function N6(i,n){const a=$.createContext(n),d=v=>{const{children:C,...s}=v,M=$.useMemo(()=>s,Object.values(s));return h.jsx(a.Provider,{value:M,children:C})};d.displayName=i+"Provider";function y(v){const C=$.useContext(a);if(C)return C;if(n!==void 0)return n;throw new Error(`\`${v}\` must be used within \`${i}\``)}return[d,y]}function Fh(i,n=[]){let a=[];function d(v,C){const s=$.createContext(C),M=a.length;a=[...a,C];const L=W=>{const{scope:X,children:ee,...he}=W,se=X?.[i]?.[M]||s,oe=$.useMemo(()=>he,Object.values(he));return h.jsx(se.Provider,{value:oe,children:ee})};L.displayName=v+"Provider";function F(W,X){const ee=X?.[i]?.[M]||s,he=$.useContext(ee);if(he)return he;if(C!==void 0)return C;throw new Error(`\`${W}\` must be used within \`${v}\``)}return[L,F]}const y=()=>{const v=a.map(C=>$.createContext(C));return function(s){const M=s?.[i]||v;return $.useMemo(()=>({[`__scope${i}`]:{...s,[i]:M}}),[s,M])}};return y.scopeName=i,[d,j6(y,...n)]}function j6(...i){const n=i[0];if(i.length===1)return n;const a=()=>{const d=i.map(y=>({useScope:y(),scopeName:y.scopeName}));return function(v){const C=d.reduce((s,{useScope:M,scopeName:L})=>{const W=M(v)[`__scope${L}`];return{...s,...W}},{});return $.useMemo(()=>({[`__scope${n.scopeName}`]:C}),[C])}};return a.scopeName=n.scopeName,a}function r_(i){const n=R6(i),a=$.forwardRef((d,y)=>{const{children:v,...C}=d,s=$.Children.toArray(v),M=s.find(L6);if(M){const L=M.props.children,F=s.map(W=>W===M?$.Children.count(L)>1?$.Children.only(null):$.isValidElement(L)?L.props.children:null:W);return h.jsx(n,{...C,ref:y,children:$.isValidElement(L)?$.cloneElement(L,void 0,F):null})}return h.jsx(n,{...C,ref:y,children:v})});return a.displayName=`${i}.Slot`,a}var _M=r_("Slot");function R6(i){const n=$.forwardRef((a,d)=>{const{children:y,...v}=a;if($.isValidElement(y)){const C=O6(y),s=D6(v,y.props);return y.type!==$.Fragment&&(s.ref=d?iw(d,C):C),$.cloneElement(y,s)}return $.Children.count(y)>1?$.Children.only(null):null});return n.displayName=`${i}.SlotClone`,n}var M6=Symbol("radix.slottable");function L6(i){return $.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===M6}function D6(i,n){const a={...n};for(const d in n){const y=i[d],v=n[d];/^on[A-Z]/.test(d)?y&&v?a[d]=(...s)=>{const M=v(...s);return y(...s),M}:y&&(a[d]=y):d==="style"?a[d]={...y,...v}:d==="className"&&(a[d]=[y,v].filter(Boolean).join(" "))}return{...i,...a}}function O6(i){let n=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,a=n&&"isReactWarning"in n&&n.isReactWarning;return a?i.ref:(n=Object.getOwnPropertyDescriptor(i,"ref")?.get,a=n&&"isReactWarning"in n&&n.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}function sw(i){const n=i+"CollectionProvider",[a,d]=Fh(n),[y,v]=a(n,{collectionRef:{current:null},itemMap:new Map}),C=se=>{const{scope:oe,children:ve}=se,me=Un.useRef(null),Se=Un.useRef(new Map).current;return h.jsx(y,{scope:oe,itemMap:Se,collectionRef:me,children:ve})};C.displayName=n;const s=i+"CollectionSlot",M=r_(s),L=Un.forwardRef((se,oe)=>{const{scope:ve,children:me}=se,Se=v(s,ve),Re=ta(oe,Se.collectionRef);return h.jsx(M,{ref:Re,children:me})});L.displayName=s;const F=i+"CollectionItemSlot",W="data-radix-collection-item",X=r_(F),ee=Un.forwardRef((se,oe)=>{const{scope:ve,children:me,...Se}=se,Re=Un.useRef(null),Be=ta(oe,Re),rt=v(F,ve);return Un.useEffect(()=>(rt.itemMap.set(Re,{ref:Re,...Se}),()=>void rt.itemMap.delete(Re))),h.jsx(X,{[W]:"",ref:Be,children:me})});ee.displayName=F;function he(se){const oe=v(i+"CollectionConsumer",se);return Un.useCallback(()=>{const me=oe.collectionRef.current;if(!me)return[];const Se=Array.from(me.querySelectorAll(`[${W}]`));return Array.from(oe.itemMap.values()).sort((rt,We)=>Se.indexOf(rt.ref.current)-Se.indexOf(We.ref.current))},[oe.collectionRef,oe.itemMap])}return[{Provider:C,Slot:L,ItemSlot:ee},he,d]}var z6=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ss=z6.reduce((i,n)=>{const a=r_(`Primitive.${n}`),d=$.forwardRef((y,v)=>{const{asChild:C,...s}=y,M=C?a:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(M,{...s,ref:v})});return d.displayName=`Primitive.${n}`,{...i,[n]:d}},{});function T2(i,n){i&&nw.flushSync(()=>i.dispatchEvent(n))}function vc(i){const n=$.useRef(i);return $.useEffect(()=>{n.current=i}),$.useMemo(()=>(...a)=>n.current?.(...a),[])}function F6(i,n=globalThis?.document){const a=vc(i);$.useEffect(()=>{const d=y=>{y.key==="Escape"&&a(y)};return n.addEventListener("keydown",d,{capture:!0}),()=>n.removeEventListener("keydown",d,{capture:!0})},[a,n])}var B6="DismissableLayer",gT="dismissableLayer.update",V6="dismissableLayer.pointerDownOutside",U6="dismissableLayer.focusOutside",Wk,xM=$.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ow=$.forwardRef((i,n)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:d,onPointerDownOutside:y,onFocusOutside:v,onInteractOutside:C,onDismiss:s,...M}=i,L=$.useContext(xM),[F,W]=$.useState(null),X=F?.ownerDocument??globalThis?.document,[,ee]=$.useState({}),he=ta(n,We=>W(We)),se=Array.from(L.layers),[oe]=[...L.layersWithOutsidePointerEventsDisabled].slice(-1),ve=se.indexOf(oe),me=F?se.indexOf(F):-1,Se=L.layersWithOutsidePointerEventsDisabled.size>0,Re=me>=ve,Be=q6(We=>{const Ct=We.target,Ht=[...L.branches].some(Zt=>Zt.contains(Ct));!Re||Ht||(y?.(We),C?.(We),We.defaultPrevented||s?.())},X),rt=G6(We=>{const Ct=We.target;[...L.branches].some(Zt=>Zt.contains(Ct))||(v?.(We),C?.(We),We.defaultPrevented||s?.())},X);return F6(We=>{me===L.layers.size-1&&(d?.(We),!We.defaultPrevented&&s&&(We.preventDefault(),s()))},X),$.useEffect(()=>{if(F)return a&&(L.layersWithOutsidePointerEventsDisabled.size===0&&(Wk=X.body.style.pointerEvents,X.body.style.pointerEvents="none"),L.layersWithOutsidePointerEventsDisabled.add(F)),L.layers.add(F),Hk(),()=>{a&&L.layersWithOutsidePointerEventsDisabled.size===1&&(X.body.style.pointerEvents=Wk)}},[F,X,a,L]),$.useEffect(()=>()=>{F&&(L.layers.delete(F),L.layersWithOutsidePointerEventsDisabled.delete(F),Hk())},[F,L]),$.useEffect(()=>{const We=()=>ee({});return document.addEventListener(gT,We),()=>document.removeEventListener(gT,We)},[]),h.jsx(ss.div,{...M,ref:he,style:{pointerEvents:Se?Re?"auto":"none":void 0,...i.style},onFocusCapture:ci(i.onFocusCapture,rt.onFocusCapture),onBlurCapture:ci(i.onBlurCapture,rt.onBlurCapture),onPointerDownCapture:ci(i.onPointerDownCapture,Be.onPointerDownCapture)})});ow.displayName=B6;var $6="DismissableLayerBranch",vM=$.forwardRef((i,n)=>{const a=$.useContext(xM),d=$.useRef(null),y=ta(n,d);return $.useEffect(()=>{const v=d.current;if(v)return a.branches.add(v),()=>{a.branches.delete(v)}},[a.branches]),h.jsx(ss.div,{...i,ref:y})});vM.displayName=$6;function q6(i,n=globalThis?.document){const a=vc(i),d=$.useRef(!1),y=$.useRef(()=>{});return $.useEffect(()=>{const v=s=>{if(s.target&&!d.current){let M=function(){bM(V6,a,L,{discrete:!0})};const L={originalEvent:s};s.pointerType==="touch"?(n.removeEventListener("click",y.current),y.current=M,n.addEventListener("click",y.current,{once:!0})):M()}else n.removeEventListener("click",y.current);d.current=!1},C=window.setTimeout(()=>{n.addEventListener("pointerdown",v)},0);return()=>{window.clearTimeout(C),n.removeEventListener("pointerdown",v),n.removeEventListener("click",y.current)}},[n,a]),{onPointerDownCapture:()=>d.current=!0}}function G6(i,n=globalThis?.document){const a=vc(i),d=$.useRef(!1);return $.useEffect(()=>{const y=v=>{v.target&&!d.current&&bM(U6,a,{originalEvent:v},{discrete:!1})};return n.addEventListener("focusin",y),()=>n.removeEventListener("focusin",y)},[n,a]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}function Hk(){const i=new CustomEvent(gT);document.dispatchEvent(i)}function bM(i,n,a,{discrete:d}){const y=a.originalEvent.target,v=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:a});n&&y.addEventListener(i,n,{once:!0}),d?T2(y,v):y.dispatchEvent(v)}var W6=ow,H6=vM,Qc=globalThis?.document?$.useLayoutEffect:()=>{},Z6="Portal",aw=$.forwardRef((i,n)=>{const{container:a,...d}=i,[y,v]=$.useState(!1);Qc(()=>v(!0),[]);const C=a||y&&globalThis?.document?.body;return C?k6.createPortal(h.jsx(ss.div,{...d,ref:n}),C):null});aw.displayName=Z6;function X6(i,n){return $.useReducer((a,d)=>n[a][d]??a,i)}var Bh=i=>{const{present:n,children:a}=i,d=K6(n),y=typeof a=="function"?a({present:d.isPresent}):$.Children.only(a),v=ta(d.ref,Y6(y));return typeof a=="function"||d.isPresent?$.cloneElement(y,{ref:v}):null};Bh.displayName="Presence";function K6(i){const[n,a]=$.useState(),d=$.useRef(null),y=$.useRef(i),v=$.useRef("none"),C=i?"mounted":"unmounted",[s,M]=X6(C,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return $.useEffect(()=>{const L=Db(d.current);v.current=s==="mounted"?L:"none"},[s]),Qc(()=>{const L=d.current,F=y.current;if(F!==i){const X=v.current,ee=Db(L);i?M("MOUNT"):ee==="none"||L?.display==="none"?M("UNMOUNT"):M(F&&X!==ee?"ANIMATION_OUT":"UNMOUNT"),y.current=i}},[i,M]),Qc(()=>{if(n){let L;const F=n.ownerDocument.defaultView??window,W=ee=>{const se=Db(d.current).includes(CSS.escape(ee.animationName));if(ee.target===n&&se&&(M("ANIMATION_END"),!y.current)){const oe=n.style.animationFillMode;n.style.animationFillMode="forwards",L=F.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=oe)})}},X=ee=>{ee.target===n&&(v.current=Db(d.current))};return n.addEventListener("animationstart",X),n.addEventListener("animationcancel",W),n.addEventListener("animationend",W),()=>{F.clearTimeout(L),n.removeEventListener("animationstart",X),n.removeEventListener("animationcancel",W),n.removeEventListener("animationend",W)}}else M("ANIMATION_END")},[n,M]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:$.useCallback(L=>{d.current=L?getComputedStyle(L):null,a(L)},[])}}function Db(i){return i?.animationName||"none"}function Y6(i){let n=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,a=n&&"isReactWarning"in n&&n.isReactWarning;return a?i.ref:(n=Object.getOwnPropertyDescriptor(i,"ref")?.get,a=n&&"isReactWarning"in n&&n.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}var Q6=x2[" useInsertionEffect ".trim().toString()]||Qc;function Rg({prop:i,defaultProp:n,onChange:a=()=>{},caller:d}){const[y,v,C]=J6({defaultProp:n,onChange:a}),s=i!==void 0,M=s?i:y;{const F=$.useRef(i!==void 0);$.useEffect(()=>{const W=F.current;W!==s&&console.warn(`${d} is changing from ${W?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),F.current=s},[s,d])}const L=$.useCallback(F=>{if(s){const W=e$(F)?F(i):F;W!==i&&C.current?.(W)}else v(F)},[s,i,v,C]);return[M,L]}function J6({defaultProp:i,onChange:n}){const[a,d]=$.useState(i),y=$.useRef(a),v=$.useRef(n);return Q6(()=>{v.current=n},[n]),$.useEffect(()=>{y.current!==a&&(v.current?.(a),y.current=a)},[a,y]),[a,d,v]}function e$(i){return typeof i=="function"}var t$=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),r$="VisuallyHidden",E2=$.forwardRef((i,n)=>h.jsx(ss.span,{...i,ref:n,style:{...t$,...i.style}}));E2.displayName=r$;var C2="ToastProvider",[A2,n$,i$]=sw("Toast"),[wM]=Fh("Toast",[i$]),[s$,lw]=wM(C2),SM=i=>{const{__scopeToast:n,label:a="Notification",duration:d=5e3,swipeDirection:y="right",swipeThreshold:v=50,children:C}=i,[s,M]=$.useState(null),[L,F]=$.useState(0),W=$.useRef(!1),X=$.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${C2}\`. Expected non-empty \`string\`.`),h.jsx(A2.Provider,{scope:n,children:h.jsx(s$,{scope:n,label:a,duration:d,swipeDirection:y,swipeThreshold:v,toastCount:L,viewport:s,onViewportChange:M,onToastAdd:$.useCallback(()=>F(ee=>ee+1),[]),onToastRemove:$.useCallback(()=>F(ee=>ee-1),[]),isFocusedToastEscapeKeyDownRef:W,isClosePausedRef:X,children:C})})};SM.displayName=C2;var TM="ToastViewport",o$=["F8"],yT="toast.viewportPause",_T="toast.viewportResume",EM=$.forwardRef((i,n)=>{const{__scopeToast:a,hotkey:d=o$,label:y="Notifications ({hotkey})",...v}=i,C=lw(TM,a),s=n$(a),M=$.useRef(null),L=$.useRef(null),F=$.useRef(null),W=$.useRef(null),X=ta(n,W,C.onViewportChange),ee=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),he=C.toastCount>0;$.useEffect(()=>{const oe=ve=>{d.length!==0&&d.every(Se=>ve[Se]||ve.code===Se)&&W.current?.focus()};return document.addEventListener("keydown",oe),()=>document.removeEventListener("keydown",oe)},[d]),$.useEffect(()=>{const oe=M.current,ve=W.current;if(he&&oe&&ve){const me=()=>{if(!C.isClosePausedRef.current){const rt=new CustomEvent(yT);ve.dispatchEvent(rt),C.isClosePausedRef.current=!0}},Se=()=>{if(C.isClosePausedRef.current){const rt=new CustomEvent(_T);ve.dispatchEvent(rt),C.isClosePausedRef.current=!1}},Re=rt=>{!oe.contains(rt.relatedTarget)&&Se()},Be=()=>{oe.contains(document.activeElement)||Se()};return oe.addEventListener("focusin",me),oe.addEventListener("focusout",Re),oe.addEventListener("pointermove",me),oe.addEventListener("pointerleave",Be),window.addEventListener("blur",me),window.addEventListener("focus",Se),()=>{oe.removeEventListener("focusin",me),oe.removeEventListener("focusout",Re),oe.removeEventListener("pointermove",me),oe.removeEventListener("pointerleave",Be),window.removeEventListener("blur",me),window.removeEventListener("focus",Se)}}},[he,C.isClosePausedRef]);const se=$.useCallback(({tabbingDirection:oe})=>{const me=s().map(Se=>{const Re=Se.ref.current,Be=[Re,...x$(Re)];return oe==="forwards"?Be:Be.reverse()});return(oe==="forwards"?me.reverse():me).flat()},[s]);return $.useEffect(()=>{const oe=W.current;if(oe){const ve=me=>{const Se=me.altKey||me.ctrlKey||me.metaKey;if(me.key==="Tab"&&!Se){const Be=document.activeElement,rt=me.shiftKey;if(me.target===oe&&rt){L.current?.focus();return}const Ht=se({tabbingDirection:rt?"backwards":"forwards"}),Zt=Ht.findIndex(rr=>rr===Be);TS(Ht.slice(Zt+1))?me.preventDefault():rt?L.current?.focus():F.current?.focus()}};return oe.addEventListener("keydown",ve),()=>oe.removeEventListener("keydown",ve)}},[s,se]),h.jsxs(H6,{ref:M,role:"region","aria-label":y.replace("{hotkey}",ee),tabIndex:-1,style:{pointerEvents:he?void 0:"none"},children:[he&&h.jsx(xT,{ref:L,onFocusFromOutsideViewport:()=>{const oe=se({tabbingDirection:"forwards"});TS(oe)}}),h.jsx(A2.Slot,{scope:a,children:h.jsx(ss.ol,{tabIndex:-1,...v,ref:X})}),he&&h.jsx(xT,{ref:F,onFocusFromOutsideViewport:()=>{const oe=se({tabbingDirection:"backwards"});TS(oe)}})]})});EM.displayName=TM;var CM="ToastFocusProxy",xT=$.forwardRef((i,n)=>{const{__scopeToast:a,onFocusFromOutsideViewport:d,...y}=i,v=lw(CM,a);return h.jsx(E2,{tabIndex:0,...y,ref:n,style:{position:"fixed"},onFocus:C=>{const s=C.relatedTarget;!v.viewport?.contains(s)&&d()}})});xT.displayName=CM;var vv="Toast",a$="toast.swipeStart",l$="toast.swipeMove",c$="toast.swipeCancel",u$="toast.swipeEnd",AM=$.forwardRef((i,n)=>{const{forceMount:a,open:d,defaultOpen:y,onOpenChange:v,...C}=i,[s,M]=Rg({prop:d,defaultProp:y??!0,onChange:v,caller:vv});return h.jsx(Bh,{present:a||s,children:h.jsx(f$,{open:s,...C,ref:n,onClose:()=>M(!1),onPause:vc(i.onPause),onResume:vc(i.onResume),onSwipeStart:ci(i.onSwipeStart,L=>{L.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ci(i.onSwipeMove,L=>{const{x:F,y:W}=L.detail.delta;L.currentTarget.setAttribute("data-swipe","move"),L.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${F}px`),L.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${W}px`)}),onSwipeCancel:ci(i.onSwipeCancel,L=>{L.currentTarget.setAttribute("data-swipe","cancel"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),L.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),L.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ci(i.onSwipeEnd,L=>{const{x:F,y:W}=L.detail.delta;L.currentTarget.setAttribute("data-swipe","end"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),L.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${F}px`),L.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${W}px`),M(!1)})})})});AM.displayName=vv;var[d$,h$]=wM(vv,{onClose(){}}),f$=$.forwardRef((i,n)=>{const{__scopeToast:a,type:d="foreground",duration:y,open:v,onClose:C,onEscapeKeyDown:s,onPause:M,onResume:L,onSwipeStart:F,onSwipeMove:W,onSwipeCancel:X,onSwipeEnd:ee,...he}=i,se=lw(vv,a),[oe,ve]=$.useState(null),me=ta(n,Gt=>ve(Gt)),Se=$.useRef(null),Re=$.useRef(null),Be=y||se.duration,rt=$.useRef(0),We=$.useRef(Be),Ct=$.useRef(0),{onToastAdd:Ht,onToastRemove:Zt}=se,rr=vc(()=>{oe?.contains(document.activeElement)&&se.viewport?.focus(),C()}),$t=$.useCallback(Gt=>{!Gt||Gt===1/0||(window.clearTimeout(Ct.current),rt.current=new Date().getTime(),Ct.current=window.setTimeout(rr,Gt))},[rr]);$.useEffect(()=>{const Gt=se.viewport;if(Gt){const Ar=()=>{$t(We.current),L?.()},Ut=()=>{const Xt=new Date().getTime()-rt.current;We.current=We.current-Xt,window.clearTimeout(Ct.current),M?.()};return Gt.addEventListener(yT,Ut),Gt.addEventListener(_T,Ar),()=>{Gt.removeEventListener(yT,Ut),Gt.removeEventListener(_T,Ar)}}},[se.viewport,Be,M,L,$t]),$.useEffect(()=>{v&&!se.isClosePausedRef.current&&$t(Be)},[v,Be,se.isClosePausedRef,$t]),$.useEffect(()=>(Ht(),()=>Zt()),[Ht,Zt]);const Rt=$.useMemo(()=>oe?MM(oe):null,[oe]);return se.viewport?h.jsxs(h.Fragment,{children:[Rt&&h.jsx(p$,{__scopeToast:a,role:"status","aria-live":d==="foreground"?"assertive":"polite",children:Rt}),h.jsx(d$,{scope:a,onClose:rr,children:nw.createPortal(h.jsx(A2.ItemSlot,{scope:a,children:h.jsx(W6,{asChild:!0,onEscapeKeyDown:ci(s,()=>{se.isFocusedToastEscapeKeyDownRef.current||rr(),se.isFocusedToastEscapeKeyDownRef.current=!1}),children:h.jsx(ss.li,{tabIndex:0,"data-state":v?"open":"closed","data-swipe-direction":se.swipeDirection,...he,ref:me,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:ci(i.onKeyDown,Gt=>{Gt.key==="Escape"&&(s?.(Gt.nativeEvent),Gt.nativeEvent.defaultPrevented||(se.isFocusedToastEscapeKeyDownRef.current=!0,rr()))}),onPointerDown:ci(i.onPointerDown,Gt=>{Gt.button===0&&(Se.current={x:Gt.clientX,y:Gt.clientY})}),onPointerMove:ci(i.onPointerMove,Gt=>{if(!Se.current)return;const Ar=Gt.clientX-Se.current.x,Ut=Gt.clientY-Se.current.y,Xt=!!Re.current,ut=["left","right"].includes(se.swipeDirection),Mt=["left","up"].includes(se.swipeDirection)?Math.min:Math.max,Qt=ut?Mt(0,Ar):0,ze=ut?0:Mt(0,Ut),It=Gt.pointerType==="touch"?10:2,xr={x:Qt,y:ze},Lr={originalEvent:Gt,delta:xr};Xt?(Re.current=xr,Ob(l$,W,Lr,{discrete:!1})):Zk(xr,se.swipeDirection,It)?(Re.current=xr,Ob(a$,F,Lr,{discrete:!1}),Gt.target.setPointerCapture(Gt.pointerId)):(Math.abs(Ar)>It||Math.abs(Ut)>It)&&(Se.current=null)}),onPointerUp:ci(i.onPointerUp,Gt=>{const Ar=Re.current,Ut=Gt.target;if(Ut.hasPointerCapture(Gt.pointerId)&&Ut.releasePointerCapture(Gt.pointerId),Re.current=null,Se.current=null,Ar){const Xt=Gt.currentTarget,ut={originalEvent:Gt,delta:Ar};Zk(Ar,se.swipeDirection,se.swipeThreshold)?Ob(u$,ee,ut,{discrete:!0}):Ob(c$,X,ut,{discrete:!0}),Xt.addEventListener("click",Mt=>Mt.preventDefault(),{once:!0})}})})})}),se.viewport)})]}):null}),p$=i=>{const{__scopeToast:n,children:a,...d}=i,y=lw(vv,n),[v,C]=$.useState(!1),[s,M]=$.useState(!1);return y$(()=>C(!0)),$.useEffect(()=>{const L=window.setTimeout(()=>M(!0),1e3);return()=>window.clearTimeout(L)},[]),s?null:h.jsx(aw,{asChild:!0,children:h.jsx(E2,{...d,children:v&&h.jsxs(h.Fragment,{children:[y.label," ",a]})})})},m$="ToastTitle",IM=$.forwardRef((i,n)=>{const{__scopeToast:a,...d}=i;return h.jsx(ss.div,{...d,ref:n})});IM.displayName=m$;var g$="ToastDescription",PM=$.forwardRef((i,n)=>{const{__scopeToast:a,...d}=i;return h.jsx(ss.div,{...d,ref:n})});PM.displayName=g$;var kM="ToastAction",NM=$.forwardRef((i,n)=>{const{altText:a,...d}=i;return a.trim()?h.jsx(RM,{altText:a,asChild:!0,children:h.jsx(I2,{...d,ref:n})}):(console.error(`Invalid prop \`altText\` supplied to \`${kM}\`. Expected non-empty \`string\`.`),null)});NM.displayName=kM;var jM="ToastClose",I2=$.forwardRef((i,n)=>{const{__scopeToast:a,...d}=i,y=h$(jM,a);return h.jsx(RM,{asChild:!0,children:h.jsx(ss.button,{type:"button",...d,ref:n,onClick:ci(i.onClick,y.onClose)})})});I2.displayName=jM;var RM=$.forwardRef((i,n)=>{const{__scopeToast:a,altText:d,...y}=i;return h.jsx(ss.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,...y,ref:n})});function MM(i){const n=[];return Array.from(i.childNodes).forEach(d=>{if(d.nodeType===d.TEXT_NODE&&d.textContent&&n.push(d.textContent),_$(d)){const y=d.ariaHidden||d.hidden||d.style.display==="none",v=d.dataset.radixToastAnnounceExclude==="";if(!y)if(v){const C=d.dataset.radixToastAnnounceAlt;C&&n.push(C)}else n.push(...MM(d))}}),n}function Ob(i,n,a,{discrete:d}){const y=a.originalEvent.currentTarget,v=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:a});n&&y.addEventListener(i,n,{once:!0}),d?T2(y,v):y.dispatchEvent(v)}var Zk=(i,n,a=0)=>{const d=Math.abs(i.x),y=Math.abs(i.y),v=d>y;return n==="left"||n==="right"?v&&d>a:!v&&y>a};function y$(i=()=>{}){const n=vc(i);Qc(()=>{let a=0,d=0;return a=window.requestAnimationFrame(()=>d=window.requestAnimationFrame(n)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(d)}},[n])}function _$(i){return i.nodeType===i.ELEMENT_NODE}function x$(i){const n=[],a=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const y=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||y?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)n.push(a.currentNode);return n}function TS(i){const n=document.activeElement;return i.some(a=>a===n?!0:(a.focus(),document.activeElement!==n))}var v$=SM,LM=EM,DM=AM,OM=IM,zM=PM,FM=NM,BM=I2;function VM(i){var n,a,d="";if(typeof i=="string"||typeof i=="number")d+=i;else if(typeof i=="object")if(Array.isArray(i)){var y=i.length;for(n=0;n<y;n++)i[n]&&(a=VM(i[n]))&&(d&&(d+=" "),d+=a)}else for(a in i)i[a]&&(d&&(d+=" "),d+=a);return d}function UM(){for(var i,n,a=0,d="",y=arguments.length;a<y;a++)(i=arguments[a])&&(n=VM(i))&&(d&&(d+=" "),d+=n);return d}const Xk=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,Kk=UM,P2=(i,n)=>a=>{var d;if(n?.variants==null)return Kk(i,a?.class,a?.className);const{variants:y,defaultVariants:v}=n,C=Object.keys(y).map(L=>{const F=a?.[L],W=v?.[L];if(F===null)return null;const X=Xk(F)||Xk(W);return y[L][X]}),s=a&&Object.entries(a).reduce((L,F)=>{let[W,X]=F;return X===void 0||(L[W]=X),L},{}),M=n==null||(d=n.compoundVariants)===null||d===void 0?void 0:d.reduce((L,F)=>{let{class:W,className:X,...ee}=F;return Object.entries(ee).every(he=>{let[se,oe]=he;return Array.isArray(oe)?oe.includes({...v,...s}[se]):{...v,...s}[se]===oe})?[...L,W,X]:L},[]);return Kk(i,C,M,a?.class,a?.className)};const b$=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),$M=(...i)=>i.filter((n,a,d)=>!!n&&d.indexOf(n)===a).join(" ");var w$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const S$=$.forwardRef(({color:i="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:d,className:y="",children:v,iconNode:C,...s},M)=>$.createElement("svg",{ref:M,...w$,width:n,height:n,stroke:i,strokeWidth:d?Number(a)*24/Number(n):a,className:$M("lucide",y),...s},[...C.map(([L,F])=>$.createElement(L,F)),...Array.isArray(v)?v:[v]]));const gi=(i,n)=>{const a=$.forwardRef(({className:d,...y},v)=>$.createElement(S$,{ref:v,iconNode:n,className:$M(`lucide-${b$(i)}`,d),...y}));return a.displayName=`${i}`,a};const vT=gi("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const n_=gi("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Yk=gi("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Sl=gi("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);const T$=gi("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Bx=gi("Beaker",[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]]);const E$=gi("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);const C$=gi("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);const A$=gi("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const qM=gi("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const I$=gi("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const GM=gi("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const WM=gi("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const cw=gi("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const P$=gi("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const bT=gi("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);const k$=gi("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const N$=gi("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);const j$=gi("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);const R$=gi("Earth",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const M$=gi("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const HM=gi("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);const wT=gi("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);const k2=gi("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const L$=gi("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const D$=gi("Images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]);const ZM=gi("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);const N2=gi("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);const ST=gi("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const O$=gi("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);const bv=gi("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const Ad=gi("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const z$=gi("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const Vx=gi("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const F$=gi("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const XM=gi("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const Ux=gi("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);const xc=gi("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const B$=gi("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);const KM=gi("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);const YM=gi("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);const TT=gi("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const j2=gi("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const V$=gi("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);const QM=gi("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);const Qk=gi("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const fm=gi("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const U$=gi("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);const Jf=gi("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const $$=gi("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),R2="-",q$=i=>{const n=W$(i),{conflictingClassGroups:a,conflictingClassGroupModifiers:d}=i;return{getClassGroupId:C=>{const s=C.split(R2);return s[0]===""&&s.length!==1&&s.shift(),JM(s,n)||G$(C)},getConflictingClassGroupIds:(C,s)=>{const M=a[C]||[];return s&&d[C]?[...M,...d[C]]:M}}},JM=(i,n)=>{if(i.length===0)return n.classGroupId;const a=i[0],d=n.nextPart.get(a),y=d?JM(i.slice(1),d):void 0;if(y)return y;if(n.validators.length===0)return;const v=i.join(R2);return n.validators.find(({validator:C})=>C(v))?.classGroupId},Jk=/^\[(.+)\]$/,G$=i=>{if(Jk.test(i)){const n=Jk.exec(i)[1],a=n?.substring(0,n.indexOf(":"));if(a)return"arbitrary.."+a}},W$=i=>{const{theme:n,prefix:a}=i,d={nextPart:new Map,validators:[]};return Z$(Object.entries(i.classGroups),a).forEach(([v,C])=>{ET(C,d,v,n)}),d},ET=(i,n,a,d)=>{i.forEach(y=>{if(typeof y=="string"){const v=y===""?n:eN(n,y);v.classGroupId=a;return}if(typeof y=="function"){if(H$(y)){ET(y(d),n,a,d);return}n.validators.push({validator:y,classGroupId:a});return}Object.entries(y).forEach(([v,C])=>{ET(C,eN(n,v),a,d)})})},eN=(i,n)=>{let a=i;return n.split(R2).forEach(d=>{a.nextPart.has(d)||a.nextPart.set(d,{nextPart:new Map,validators:[]}),a=a.nextPart.get(d)}),a},H$=i=>i.isThemeGetter,Z$=(i,n)=>n?i.map(([a,d])=>{const y=d.map(v=>typeof v=="string"?n+v:typeof v=="object"?Object.fromEntries(Object.entries(v).map(([C,s])=>[n+C,s])):v);return[a,y]}):i,X$=i=>{if(i<1)return{get:()=>{},set:()=>{}};let n=0,a=new Map,d=new Map;const y=(v,C)=>{a.set(v,C),n++,n>i&&(n=0,d=a,a=new Map)};return{get(v){let C=a.get(v);if(C!==void 0)return C;if((C=d.get(v))!==void 0)return y(v,C),C},set(v,C){a.has(v)?a.set(v,C):y(v,C)}}},eL="!",K$=i=>{const{separator:n,experimentalParseClassName:a}=i,d=n.length===1,y=n[0],v=n.length,C=s=>{const M=[];let L=0,F=0,W;for(let oe=0;oe<s.length;oe++){let ve=s[oe];if(L===0){if(ve===y&&(d||s.slice(oe,oe+v)===n)){M.push(s.slice(F,oe)),F=oe+v;continue}if(ve==="/"){W=oe;continue}}ve==="["?L++:ve==="]"&&L--}const X=M.length===0?s:s.substring(F),ee=X.startsWith(eL),he=ee?X.substring(1):X,se=W&&W>F?W-F:void 0;return{modifiers:M,hasImportantModifier:ee,baseClassName:he,maybePostfixModifierPosition:se}};return a?s=>a({className:s,parseClassName:C}):C},Y$=i=>{if(i.length<=1)return i;const n=[];let a=[];return i.forEach(d=>{d[0]==="["?(n.push(...a.sort(),d),a=[]):a.push(d)}),n.push(...a.sort()),n},Q$=i=>({cache:X$(i.cacheSize),parseClassName:K$(i),...q$(i)}),J$=/\s+/,e8=(i,n)=>{const{parseClassName:a,getClassGroupId:d,getConflictingClassGroupIds:y}=n,v=[],C=i.trim().split(J$);let s="";for(let M=C.length-1;M>=0;M-=1){const L=C[M],{modifiers:F,hasImportantModifier:W,baseClassName:X,maybePostfixModifierPosition:ee}=a(L);let he=!!ee,se=d(he?X.substring(0,ee):X);if(!se){if(!he){s=L+(s.length>0?" "+s:s);continue}if(se=d(X),!se){s=L+(s.length>0?" "+s:s);continue}he=!1}const oe=Y$(F).join(":"),ve=W?oe+eL:oe,me=ve+se;if(v.includes(me))continue;v.push(me);const Se=y(se,he);for(let Re=0;Re<Se.length;++Re){const Be=Se[Re];v.push(ve+Be)}s=L+(s.length>0?" "+s:s)}return s};function t8(){let i=0,n,a,d="";for(;i<arguments.length;)(n=arguments[i++])&&(a=tL(n))&&(d&&(d+=" "),d+=a);return d}const tL=i=>{if(typeof i=="string")return i;let n,a="";for(let d=0;d<i.length;d++)i[d]&&(n=tL(i[d]))&&(a&&(a+=" "),a+=n);return a};function r8(i,...n){let a,d,y,v=C;function C(M){const L=n.reduce((F,W)=>W(F),i());return a=Q$(L),d=a.cache.get,y=a.cache.set,v=s,s(M)}function s(M){const L=d(M);if(L)return L;const F=e8(M,a);return y(M,F),F}return function(){return v(t8.apply(null,arguments))}}const io=i=>{const n=a=>a[i]||[];return n.isThemeGetter=!0,n},rL=/^\[(?:([a-z-]+):)?(.+)\]$/i,n8=/^\d+\/\d+$/,i8=new Set(["px","full","screen"]),s8=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,o8=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,a8=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,l8=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,c8=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Wf=i=>Gy(i)||i8.has(i)||n8.test(i),rm=i=>p_(i,"length",y8),Gy=i=>!!i&&!Number.isNaN(Number(i)),ES=i=>p_(i,"number",Gy),_x=i=>!!i&&Number.isInteger(Number(i)),u8=i=>i.endsWith("%")&&Gy(i.slice(0,-1)),Vi=i=>rL.test(i),nm=i=>s8.test(i),d8=new Set(["length","size","percentage"]),h8=i=>p_(i,d8,nL),f8=i=>p_(i,"position",nL),p8=new Set(["image","url"]),m8=i=>p_(i,p8,x8),g8=i=>p_(i,"",_8),xx=()=>!0,p_=(i,n,a)=>{const d=rL.exec(i);return d?d[1]?typeof n=="string"?d[1]===n:n.has(d[1]):a(d[2]):!1},y8=i=>o8.test(i)&&!a8.test(i),nL=()=>!1,_8=i=>l8.test(i),x8=i=>c8.test(i),v8=()=>{const i=io("colors"),n=io("spacing"),a=io("blur"),d=io("brightness"),y=io("borderColor"),v=io("borderRadius"),C=io("borderSpacing"),s=io("borderWidth"),M=io("contrast"),L=io("grayscale"),F=io("hueRotate"),W=io("invert"),X=io("gap"),ee=io("gradientColorStops"),he=io("gradientColorStopPositions"),se=io("inset"),oe=io("margin"),ve=io("opacity"),me=io("padding"),Se=io("saturate"),Re=io("scale"),Be=io("sepia"),rt=io("skew"),We=io("space"),Ct=io("translate"),Ht=()=>["auto","contain","none"],Zt=()=>["auto","hidden","clip","visible","scroll"],rr=()=>["auto",Vi,n],$t=()=>[Vi,n],Rt=()=>["",Wf,rm],Gt=()=>["auto",Gy,Vi],Ar=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Ut=()=>["solid","dashed","dotted","double","none"],Xt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ut=()=>["start","end","center","between","around","evenly","stretch"],Mt=()=>["","0",Vi],Qt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ze=()=>[Gy,Vi];return{cacheSize:500,separator:":",theme:{colors:[xx],spacing:[Wf,rm],blur:["none","",nm,Vi],brightness:ze(),borderColor:[i],borderRadius:["none","","full",nm,Vi],borderSpacing:$t(),borderWidth:Rt(),contrast:ze(),grayscale:Mt(),hueRotate:ze(),invert:Mt(),gap:$t(),gradientColorStops:[i],gradientColorStopPositions:[u8,rm],inset:rr(),margin:rr(),opacity:ze(),padding:$t(),saturate:ze(),scale:ze(),sepia:Mt(),skew:ze(),space:$t(),translate:$t()},classGroups:{aspect:[{aspect:["auto","square","video",Vi]}],container:["container"],columns:[{columns:[nm]}],"break-after":[{"break-after":Qt()}],"break-before":[{"break-before":Qt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ar(),Vi]}],overflow:[{overflow:Zt()}],"overflow-x":[{"overflow-x":Zt()}],"overflow-y":[{"overflow-y":Zt()}],overscroll:[{overscroll:Ht()}],"overscroll-x":[{"overscroll-x":Ht()}],"overscroll-y":[{"overscroll-y":Ht()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[se]}],"inset-x":[{"inset-x":[se]}],"inset-y":[{"inset-y":[se]}],start:[{start:[se]}],end:[{end:[se]}],top:[{top:[se]}],right:[{right:[se]}],bottom:[{bottom:[se]}],left:[{left:[se]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",_x,Vi]}],basis:[{basis:rr()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Vi]}],grow:[{grow:Mt()}],shrink:[{shrink:Mt()}],order:[{order:["first","last","none",_x,Vi]}],"grid-cols":[{"grid-cols":[xx]}],"col-start-end":[{col:["auto",{span:["full",_x,Vi]},Vi]}],"col-start":[{"col-start":Gt()}],"col-end":[{"col-end":Gt()}],"grid-rows":[{"grid-rows":[xx]}],"row-start-end":[{row:["auto",{span:[_x,Vi]},Vi]}],"row-start":[{"row-start":Gt()}],"row-end":[{"row-end":Gt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Vi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Vi]}],gap:[{gap:[X]}],"gap-x":[{"gap-x":[X]}],"gap-y":[{"gap-y":[X]}],"justify-content":[{justify:["normal",...ut()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ut(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ut(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[me]}],px:[{px:[me]}],py:[{py:[me]}],ps:[{ps:[me]}],pe:[{pe:[me]}],pt:[{pt:[me]}],pr:[{pr:[me]}],pb:[{pb:[me]}],pl:[{pl:[me]}],m:[{m:[oe]}],mx:[{mx:[oe]}],my:[{my:[oe]}],ms:[{ms:[oe]}],me:[{me:[oe]}],mt:[{mt:[oe]}],mr:[{mr:[oe]}],mb:[{mb:[oe]}],ml:[{ml:[oe]}],"space-x":[{"space-x":[We]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[We]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Vi,n]}],"min-w":[{"min-w":[Vi,n,"min","max","fit"]}],"max-w":[{"max-w":[Vi,n,"none","full","min","max","fit","prose",{screen:[nm]},nm]}],h:[{h:[Vi,n,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Vi,n,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Vi,n,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Vi,n,"auto","min","max","fit"]}],"font-size":[{text:["base",nm,rm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ES]}],"font-family":[{font:[xx]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Vi]}],"line-clamp":[{"line-clamp":["none",Gy,ES]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Wf,Vi]}],"list-image":[{"list-image":["none",Vi]}],"list-style-type":[{list:["none","disc","decimal",Vi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[ve]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[ve]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ut(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Wf,rm]}],"underline-offset":[{"underline-offset":["auto",Wf,Vi]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:$t()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Vi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Vi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ve]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ar(),f8]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",h8]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},m8]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[he]}],"gradient-via-pos":[{via:[he]}],"gradient-to-pos":[{to:[he]}],"gradient-from":[{from:[ee]}],"gradient-via":[{via:[ee]}],"gradient-to":[{to:[ee]}],rounded:[{rounded:[v]}],"rounded-s":[{"rounded-s":[v]}],"rounded-e":[{"rounded-e":[v]}],"rounded-t":[{"rounded-t":[v]}],"rounded-r":[{"rounded-r":[v]}],"rounded-b":[{"rounded-b":[v]}],"rounded-l":[{"rounded-l":[v]}],"rounded-ss":[{"rounded-ss":[v]}],"rounded-se":[{"rounded-se":[v]}],"rounded-ee":[{"rounded-ee":[v]}],"rounded-es":[{"rounded-es":[v]}],"rounded-tl":[{"rounded-tl":[v]}],"rounded-tr":[{"rounded-tr":[v]}],"rounded-br":[{"rounded-br":[v]}],"rounded-bl":[{"rounded-bl":[v]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[ve]}],"border-style":[{border:[...Ut(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ve]}],"divide-style":[{divide:Ut()}],"border-color":[{border:[y]}],"border-color-x":[{"border-x":[y]}],"border-color-y":[{"border-y":[y]}],"border-color-s":[{"border-s":[y]}],"border-color-e":[{"border-e":[y]}],"border-color-t":[{"border-t":[y]}],"border-color-r":[{"border-r":[y]}],"border-color-b":[{"border-b":[y]}],"border-color-l":[{"border-l":[y]}],"divide-color":[{divide:[y]}],"outline-style":[{outline:["",...Ut()]}],"outline-offset":[{"outline-offset":[Wf,Vi]}],"outline-w":[{outline:[Wf,rm]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Rt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[ve]}],"ring-offset-w":[{"ring-offset":[Wf,rm]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",nm,g8]}],"shadow-color":[{shadow:[xx]}],opacity:[{opacity:[ve]}],"mix-blend":[{"mix-blend":[...Xt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Xt()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[d]}],contrast:[{contrast:[M]}],"drop-shadow":[{"drop-shadow":["","none",nm,Vi]}],grayscale:[{grayscale:[L]}],"hue-rotate":[{"hue-rotate":[F]}],invert:[{invert:[W]}],saturate:[{saturate:[Se]}],sepia:[{sepia:[Be]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[d]}],"backdrop-contrast":[{"backdrop-contrast":[M]}],"backdrop-grayscale":[{"backdrop-grayscale":[L]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[F]}],"backdrop-invert":[{"backdrop-invert":[W]}],"backdrop-opacity":[{"backdrop-opacity":[ve]}],"backdrop-saturate":[{"backdrop-saturate":[Se]}],"backdrop-sepia":[{"backdrop-sepia":[Be]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[C]}],"border-spacing-x":[{"border-spacing-x":[C]}],"border-spacing-y":[{"border-spacing-y":[C]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Vi]}],duration:[{duration:ze()}],ease:[{ease:["linear","in","out","in-out",Vi]}],delay:[{delay:ze()}],animate:[{animate:["none","spin","ping","pulse","bounce",Vi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Re]}],"scale-x":[{"scale-x":[Re]}],"scale-y":[{"scale-y":[Re]}],rotate:[{rotate:[_x,Vi]}],"translate-x":[{"translate-x":[Ct]}],"translate-y":[{"translate-y":[Ct]}],"skew-x":[{"skew-x":[rt]}],"skew-y":[{"skew-y":[rt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Vi]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Vi]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":$t()}],"scroll-mx":[{"scroll-mx":$t()}],"scroll-my":[{"scroll-my":$t()}],"scroll-ms":[{"scroll-ms":$t()}],"scroll-me":[{"scroll-me":$t()}],"scroll-mt":[{"scroll-mt":$t()}],"scroll-mr":[{"scroll-mr":$t()}],"scroll-mb":[{"scroll-mb":$t()}],"scroll-ml":[{"scroll-ml":$t()}],"scroll-p":[{"scroll-p":$t()}],"scroll-px":[{"scroll-px":$t()}],"scroll-py":[{"scroll-py":$t()}],"scroll-ps":[{"scroll-ps":$t()}],"scroll-pe":[{"scroll-pe":$t()}],"scroll-pt":[{"scroll-pt":$t()}],"scroll-pr":[{"scroll-pr":$t()}],"scroll-pb":[{"scroll-pb":$t()}],"scroll-pl":[{"scroll-pl":$t()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Vi]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[Wf,rm,ES]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},b8=r8(v8);function Ki(...i){return b8(UM(i))}const w8=v$,iL=$.forwardRef(({className:i,...n},a)=>h.jsx(LM,{ref:a,className:Ki("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",i),...n}));iL.displayName=LM.displayName;const S8=P2("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sL=$.forwardRef(({className:i,variant:n,...a},d)=>h.jsx(DM,{ref:d,className:Ki(S8({variant:n}),i),...a}));sL.displayName=DM.displayName;const T8=$.forwardRef(({className:i,...n},a)=>h.jsx(FM,{ref:a,className:Ki("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",i),...n}));T8.displayName=FM.displayName;const oL=$.forwardRef(({className:i,...n},a)=>h.jsx(BM,{ref:a,className:Ki("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...n,children:h.jsx(Jf,{className:"h-4 w-4"})}));oL.displayName=BM.displayName;const aL=$.forwardRef(({className:i,...n},a)=>h.jsx(OM,{ref:a,className:Ki("text-sm font-semibold",i),...n}));aL.displayName=OM.displayName;const lL=$.forwardRef(({className:i,...n},a)=>h.jsx(zM,{ref:a,className:Ki("text-sm opacity-90",i),...n}));lL.displayName=zM.displayName;function E8(){const{toasts:i}=xv();return h.jsxs(w8,{children:[i.map(function({id:n,title:a,description:d,action:y,...v}){return h.jsxs(sL,{...v,children:[h.jsxs("div",{className:"grid gap-1",children:[a&&h.jsx(aL,{children:a}),d&&h.jsx(lL,{children:d})]}),y,h.jsx(oL,{})]},n)}),h.jsx(iL,{})]})}const M2=$.createContext({});function L2(i){const n=$.useRef(null);return n.current===null&&(n.current=i()),n.current}const uw=$.createContext(null),D2=$.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});class C8 extends $.Component{getSnapshotBeforeUpdate(n){const a=this.props.childRef.current;if(a&&n.isPresent&&!this.props.isPresent){const d=this.props.sizeRef.current;d.height=a.offsetHeight||0,d.width=a.offsetWidth||0,d.top=a.offsetTop,d.left=a.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function A8({children:i,isPresent:n}){const a=$.useId(),d=$.useRef(null),y=$.useRef({width:0,height:0,top:0,left:0}),{nonce:v}=$.useContext(D2);return $.useInsertionEffect(()=>{const{width:C,height:s,top:M,left:L}=y.current;if(n||!d.current||!C||!s)return;d.current.dataset.motionPopId=a;const F=document.createElement("style");return v&&(F.nonce=v),document.head.appendChild(F),F.sheet&&F.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${s}px !important;
            top: ${M}px !important;
            left: ${L}px !important;
          }
        `),()=>{document.head.removeChild(F)}},[n]),h.jsx(C8,{isPresent:n,childRef:d,sizeRef:y,children:$.cloneElement(i,{ref:d})})}const I8=({children:i,initial:n,isPresent:a,onExitComplete:d,custom:y,presenceAffectsLayout:v,mode:C})=>{const s=L2(P8),M=$.useId(),L=$.useCallback(W=>{s.set(W,!0);for(const X of s.values())if(!X)return;d&&d()},[s,d]),F=$.useMemo(()=>({id:M,initial:n,isPresent:a,custom:y,onExitComplete:L,register:W=>(s.set(W,!1),()=>s.delete(W))}),v?[Math.random(),L]:[a,L]);return $.useMemo(()=>{s.forEach((W,X)=>s.set(X,!1))},[a]),$.useEffect(()=>{!a&&!s.size&&d&&d()},[a]),C==="popLayout"&&(i=h.jsx(A8,{isPresent:a,children:i})),h.jsx(uw.Provider,{value:F,children:i})};function P8(){return new Map}function cL(i=!0){const n=$.useContext(uw);if(n===null)return[!0,null];const{isPresent:a,onExitComplete:d,register:y}=n,v=$.useId();$.useEffect(()=>{i&&y(v)},[i]);const C=$.useCallback(()=>i&&d&&d(v),[v,d,i]);return!a&&d?[!1,C]:[!0]}const zb=i=>i.key||"";function tN(i){const n=[];return $.Children.forEach(i,a=>{$.isValidElement(a)&&n.push(a)}),n}const O2=typeof window<"u",uL=O2?$.useLayoutEffect:$.useEffect,dL=({children:i,custom:n,initial:a=!0,onExitComplete:d,presenceAffectsLayout:y=!0,mode:v="sync",propagate:C=!1})=>{const[s,M]=cL(C),L=$.useMemo(()=>tN(i),[i]),F=C&&!s?[]:L.map(zb),W=$.useRef(!0),X=$.useRef(L),ee=L2(()=>new Map),[he,se]=$.useState(L),[oe,ve]=$.useState(L);uL(()=>{W.current=!1,X.current=L;for(let Re=0;Re<oe.length;Re++){const Be=zb(oe[Re]);F.includes(Be)?ee.delete(Be):ee.get(Be)!==!0&&ee.set(Be,!1)}},[oe,F.length,F.join("-")]);const me=[];if(L!==he){let Re=[...L];for(let Be=0;Be<oe.length;Be++){const rt=oe[Be],We=zb(rt);F.includes(We)||(Re.splice(Be,0,rt),me.push(rt))}v==="wait"&&me.length&&(Re=me),ve(tN(Re)),se(L);return}const{forceRender:Se}=$.useContext(M2);return h.jsx(h.Fragment,{children:oe.map(Re=>{const Be=zb(Re),rt=C&&!s?!1:L===oe||F.includes(Be),We=()=>{if(ee.has(Be))ee.set(Be,!0);else return;let Ct=!0;ee.forEach(Ht=>{Ht||(Ct=!1)}),Ct&&(Se?.(),ve(X.current),C&&M?.(),d&&d())};return h.jsx(I8,{isPresent:rt,initial:!W.current||a?void 0:!1,custom:rt?void 0:n,presenceAffectsLayout:y,mode:v,onExitComplete:rt?void 0:We,children:Re},Be)})})},Xc=i=>i;let hL=Xc;function z2(i){let n;return()=>(n===void 0&&(n=i()),n)}const i_=(i,n,a)=>{const d=n-i;return d===0?1:(a-i)/d},ep=i=>i*1e3,tp=i=>i/1e3,k8={useManualTiming:!1};function N8(i){let n=new Set,a=new Set,d=!1,y=!1;const v=new WeakSet;let C={delta:0,timestamp:0,isProcessing:!1};function s(L){v.has(L)&&(M.schedule(L),i()),L(C)}const M={schedule:(L,F=!1,W=!1)=>{const ee=W&&d?n:a;return F&&v.add(L),ee.has(L)||ee.add(L),L},cancel:L=>{a.delete(L),v.delete(L)},process:L=>{if(C=L,d){y=!0;return}d=!0,[n,a]=[a,n],n.forEach(s),n.clear(),d=!1,y&&(y=!1,M.process(L))}};return M}const Fb=["read","resolveKeyframes","update","preRender","render","postRender"],j8=40;function fL(i,n){let a=!1,d=!0;const y={delta:0,timestamp:0,isProcessing:!1},v=()=>a=!0,C=Fb.reduce((ve,me)=>(ve[me]=N8(v),ve),{}),{read:s,resolveKeyframes:M,update:L,preRender:F,render:W,postRender:X}=C,ee=()=>{const ve=performance.now();a=!1,y.delta=d?1e3/60:Math.max(Math.min(ve-y.timestamp,j8),1),y.timestamp=ve,y.isProcessing=!0,s.process(y),M.process(y),L.process(y),F.process(y),W.process(y),X.process(y),y.isProcessing=!1,a&&n&&(d=!1,i(ee))},he=()=>{a=!0,d=!0,y.isProcessing||i(ee)};return{schedule:Fb.reduce((ve,me)=>{const Se=C[me];return ve[me]=(Re,Be=!1,rt=!1)=>(a||he(),Se.schedule(Re,Be,rt)),ve},{}),cancel:ve=>{for(let me=0;me<Fb.length;me++)C[Fb[me]].cancel(ve)},state:y,steps:C}}const{schedule:so,cancel:pm,state:nl,steps:CS}=fL(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xc,!0),pL=$.createContext({strict:!1}),rN={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},s_={};for(const i in rN)s_[i]={isEnabled:n=>rN[i].some(a=>!!n[a])};function R8(i){for(const n in i)s_[n]={...s_[n],...i[n]}}const M8=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function b0(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||M8.has(i)}let mL=i=>!b0(i);function L8(i){i&&(mL=n=>n.startsWith("on")?!b0(n):i(n))}try{L8(require("@emotion/is-prop-valid").default)}catch{}function D8(i,n,a){const d={};for(const y in i)y==="values"&&typeof i.values=="object"||(mL(y)||a===!0&&b0(y)||!n&&!b0(y)||i.draggable&&y.startsWith("onDrag"))&&(d[y]=i[y]);return d}function O8(i){if(typeof Proxy>"u")return i;const n=new Map,a=(...d)=>i(...d);return new Proxy(a,{get:(d,y)=>y==="create"?i:(n.has(y)||n.set(y,i(y)),n.get(y))})}const dw=$.createContext({});function $x(i){return typeof i=="string"||Array.isArray(i)}function hw(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}const F2=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],B2=["initial",...F2];function fw(i){return hw(i.animate)||B2.some(n=>$x(i[n]))}function gL(i){return!!(fw(i)||i.variants)}function z8(i,n){if(fw(i)){const{initial:a,animate:d}=i;return{initial:a===!1||$x(a)?a:void 0,animate:$x(d)?d:void 0}}return i.inherit!==!1?n:{}}function F8(i){const{initial:n,animate:a}=z8(i,$.useContext(dw));return $.useMemo(()=>({initial:n,animate:a}),[nN(n),nN(a)])}function nN(i){return Array.isArray(i)?i.join(" "):i}const B8=Symbol.for("motionComponentSymbol");function zy(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function V8(i,n,a){return $.useCallback(d=>{d&&i.onMount&&i.onMount(d),n&&(d?n.mount(d):n.unmount()),a&&(typeof a=="function"?a(d):zy(a)&&(a.current=d))},[n])}const V2=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),U8="framerAppearId",yL="data-"+V2(U8),{schedule:U2}=fL(queueMicrotask,!1),_L=$.createContext({});function $8(i,n,a,d,y){var v,C;const{visualElement:s}=$.useContext(dw),M=$.useContext(pL),L=$.useContext(uw),F=$.useContext(D2).reducedMotion,W=$.useRef(null);d=d||M.renderer,!W.current&&d&&(W.current=d(i,{visualState:n,parent:s,props:a,presenceContext:L,blockInitialAnimation:L?L.initial===!1:!1,reducedMotionConfig:F}));const X=W.current,ee=$.useContext(_L);X&&!X.projection&&y&&(X.type==="html"||X.type==="svg")&&q8(W.current,a,y,ee);const he=$.useRef(!1);$.useInsertionEffect(()=>{X&&he.current&&X.update(a,L)});const se=a[yL],oe=$.useRef(!!se&&!(!((v=window.MotionHandoffIsComplete)===null||v===void 0)&&v.call(window,se))&&((C=window.MotionHasOptimisedAnimation)===null||C===void 0?void 0:C.call(window,se)));return uL(()=>{X&&(he.current=!0,window.MotionIsMounted=!0,X.updateFeatures(),U2.render(X.render),oe.current&&X.animationState&&X.animationState.animateChanges())}),$.useEffect(()=>{X&&(!oe.current&&X.animationState&&X.animationState.animateChanges(),oe.current&&(queueMicrotask(()=>{var ve;(ve=window.MotionHandoffMarkAsComplete)===null||ve===void 0||ve.call(window,se)}),oe.current=!1))}),X}function q8(i,n,a,d){const{layoutId:y,layout:v,drag:C,dragConstraints:s,layoutScroll:M,layoutRoot:L}=n;i.projection=new a(i.latestValues,n["data-framer-portal-id"]?void 0:xL(i.parent)),i.projection.setOptions({layoutId:y,layout:v,alwaysMeasureLayout:!!C||s&&zy(s),visualElement:i,animationType:typeof v=="string"?v:"both",initialPromotionConfig:d,layoutScroll:M,layoutRoot:L})}function xL(i){if(i)return i.options.allowProjection!==!1?i.projection:xL(i.parent)}function G8({preloadedFeatures:i,createVisualElement:n,useRender:a,useVisualState:d,Component:y}){var v,C;i&&R8(i);function s(L,F){let W;const X={...$.useContext(D2),...L,layoutId:W8(L)},{isStatic:ee}=X,he=F8(L),se=d(L,ee);if(!ee&&O2){H8();const oe=Z8(X);W=oe.MeasureLayout,he.visualElement=$8(y,se,X,n,oe.ProjectionNode)}return h.jsxs(dw.Provider,{value:he,children:[W&&he.visualElement?h.jsx(W,{visualElement:he.visualElement,...X}):null,a(y,L,V8(se,he.visualElement,F),se,ee,he.visualElement)]})}s.displayName=`motion.${typeof y=="string"?y:`create(${(C=(v=y.displayName)!==null&&v!==void 0?v:y.name)!==null&&C!==void 0?C:""})`}`;const M=$.forwardRef(s);return M[B8]=y,M}function W8({layoutId:i}){const n=$.useContext(M2).id;return n&&i!==void 0?n+"-"+i:i}function H8(i,n){$.useContext(pL).strict}function Z8(i){const{drag:n,layout:a}=s_;if(!n&&!a)return{};const d={...n,...a};return{MeasureLayout:n?.isEnabled(i)||a?.isEnabled(i)?d.MeasureLayout:void 0,ProjectionNode:d.ProjectionNode}}const X8=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function $2(i){return typeof i!="string"||i.includes("-")?!1:!!(X8.indexOf(i)>-1||/[A-Z]/u.test(i))}function iN(i){const n=[{},{}];return i?.values.forEach((a,d)=>{n[0][d]=a.get(),n[1][d]=a.getVelocity()}),n}function q2(i,n,a,d){if(typeof n=="function"){const[y,v]=iN(d);n=n(a!==void 0?a:i.custom,y,v)}if(typeof n=="string"&&(n=i.variants&&i.variants[n]),typeof n=="function"){const[y,v]=iN(d);n=n(a!==void 0?a:i.custom,y,v)}return n}const CT=i=>Array.isArray(i),K8=i=>!!(i&&typeof i=="object"&&i.mix&&i.toValue),Y8=i=>CT(i)?i[i.length-1]||0:i,El=i=>!!(i&&i.getVelocity);function c0(i){const n=El(i)?i.get():i;return K8(n)?n.toValue():n}function Q8({scrapeMotionValuesFromProps:i,createRenderState:n,onUpdate:a},d,y,v){const C={latestValues:J8(d,y,v,i),renderState:n()};return a&&(C.onMount=s=>a({props:d,current:s,...C}),C.onUpdate=s=>a(s)),C}const vL=i=>(n,a)=>{const d=$.useContext(dw),y=$.useContext(uw),v=()=>Q8(i,n,d,y);return a?v():L2(v)};function J8(i,n,a,d){const y={},v=d(i,{});for(const X in v)y[X]=c0(v[X]);let{initial:C,animate:s}=i;const M=fw(i),L=gL(i);n&&L&&!M&&i.inherit!==!1&&(C===void 0&&(C=n.initial),s===void 0&&(s=n.animate));let F=a?a.initial===!1:!1;F=F||C===!1;const W=F?s:C;if(W&&typeof W!="boolean"&&!hw(W)){const X=Array.isArray(W)?W:[W];for(let ee=0;ee<X.length;ee++){const he=q2(i,X[ee]);if(he){const{transitionEnd:se,transition:oe,...ve}=he;for(const me in ve){let Se=ve[me];if(Array.isArray(Se)){const Re=F?Se.length-1:0;Se=Se[Re]}Se!==null&&(y[me]=Se)}for(const me in se)y[me]=se[me]}}}return y}const m_=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Mg=new Set(m_),bL=i=>n=>typeof n=="string"&&n.startsWith(i),wL=bL("--"),eq=bL("var(--"),G2=i=>eq(i)?tq.test(i.split("/*")[0].trim()):!1,tq=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,SL=(i,n)=>n&&typeof i=="number"?n.transform(i):i,rp=(i,n,a)=>a>n?n:a<i?i:a,g_={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},qx={...g_,transform:i=>rp(0,1,i)},Bb={...g_,default:1},wv=i=>({test:n=>typeof n=="string"&&n.endsWith(i)&&n.split(" ").length===1,parse:parseFloat,transform:n=>`${n}${i}`}),lm=wv("deg"),jh=wv("%"),pi=wv("px"),rq=wv("vh"),nq=wv("vw"),sN={...jh,parse:i=>jh.parse(i)/100,transform:i=>jh.transform(i*100)},iq={borderWidth:pi,borderTopWidth:pi,borderRightWidth:pi,borderBottomWidth:pi,borderLeftWidth:pi,borderRadius:pi,radius:pi,borderTopLeftRadius:pi,borderTopRightRadius:pi,borderBottomRightRadius:pi,borderBottomLeftRadius:pi,width:pi,maxWidth:pi,height:pi,maxHeight:pi,top:pi,right:pi,bottom:pi,left:pi,padding:pi,paddingTop:pi,paddingRight:pi,paddingBottom:pi,paddingLeft:pi,margin:pi,marginTop:pi,marginRight:pi,marginBottom:pi,marginLeft:pi,backgroundPositionX:pi,backgroundPositionY:pi},sq={rotate:lm,rotateX:lm,rotateY:lm,rotateZ:lm,scale:Bb,scaleX:Bb,scaleY:Bb,scaleZ:Bb,skew:lm,skewX:lm,skewY:lm,distance:pi,translateX:pi,translateY:pi,translateZ:pi,x:pi,y:pi,z:pi,perspective:pi,transformPerspective:pi,opacity:qx,originX:sN,originY:sN,originZ:pi},oN={...g_,transform:Math.round},W2={...iq,...sq,zIndex:oN,size:pi,fillOpacity:qx,strokeOpacity:qx,numOctaves:oN},oq={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},aq=m_.length;function lq(i,n,a){let d="",y=!0;for(let v=0;v<aq;v++){const C=m_[v],s=i[C];if(s===void 0)continue;let M=!0;if(typeof s=="number"?M=s===(C.startsWith("scale")?1:0):M=parseFloat(s)===0,!M||a){const L=SL(s,W2[C]);if(!M){y=!1;const F=oq[C]||C;d+=`${F}(${L}) `}a&&(n[C]=L)}}return d=d.trim(),a?d=a(n,y?"":d):y&&(d="none"),d}function H2(i,n,a){const{style:d,vars:y,transformOrigin:v}=i;let C=!1,s=!1;for(const M in n){const L=n[M];if(Mg.has(M)){C=!0;continue}else if(wL(M)){y[M]=L;continue}else{const F=SL(L,W2[M]);M.startsWith("origin")?(s=!0,v[M]=F):d[M]=F}}if(n.transform||(C||a?d.transform=lq(n,i.transform,a):d.transform&&(d.transform="none")),s){const{originX:M="50%",originY:L="50%",originZ:F=0}=v;d.transformOrigin=`${M} ${L} ${F}`}}const cq={offset:"stroke-dashoffset",array:"stroke-dasharray"},uq={offset:"strokeDashoffset",array:"strokeDasharray"};function dq(i,n,a=1,d=0,y=!0){i.pathLength=1;const v=y?cq:uq;i[v.offset]=pi.transform(-d);const C=pi.transform(n),s=pi.transform(a);i[v.array]=`${C} ${s}`}function aN(i,n,a){return typeof i=="string"?i:pi.transform(n+a*i)}function hq(i,n,a){const d=aN(n,i.x,i.width),y=aN(a,i.y,i.height);return`${d} ${y}`}function Z2(i,{attrX:n,attrY:a,attrScale:d,originX:y,originY:v,pathLength:C,pathSpacing:s=1,pathOffset:M=0,...L},F,W){if(H2(i,L,W),F){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:X,style:ee,dimensions:he}=i;X.transform&&(he&&(ee.transform=X.transform),delete X.transform),he&&(y!==void 0||v!==void 0||ee.transform)&&(ee.transformOrigin=hq(he,y!==void 0?y:.5,v!==void 0?v:.5)),n!==void 0&&(X.x=n),a!==void 0&&(X.y=a),d!==void 0&&(X.scale=d),C!==void 0&&dq(X,C,s,M,!1)}const X2=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),TL=()=>({...X2(),attrs:{}}),K2=i=>typeof i=="string"&&i.toLowerCase()==="svg";function EL(i,{style:n,vars:a},d,y){Object.assign(i.style,n,y&&y.getProjectionStyles(d));for(const v in a)i.style.setProperty(v,a[v])}const CL=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function AL(i,n,a,d){EL(i,n,void 0,d);for(const y in n.attrs)i.setAttribute(CL.has(y)?y:V2(y),n.attrs[y])}const w0={};function fq(i){Object.assign(w0,i)}function IL(i,{layout:n,layoutId:a}){return Mg.has(i)||i.startsWith("origin")||(n||a!==void 0)&&(!!w0[i]||i==="opacity")}function Y2(i,n,a){var d;const{style:y}=i,v={};for(const C in y)(El(y[C])||n.style&&El(n.style[C])||IL(C,i)||((d=a?.getValue(C))===null||d===void 0?void 0:d.liveStyle)!==void 0)&&(v[C]=y[C]);return v}function PL(i,n,a){const d=Y2(i,n,a);for(const y in i)if(El(i[y])||El(n[y])){const v=m_.indexOf(y)!==-1?"attr"+y.charAt(0).toUpperCase()+y.substring(1):y;d[v]=i[y]}return d}function pq(i,n){try{n.dimensions=typeof i.getBBox=="function"?i.getBBox():i.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}const lN=["x","y","width","height","cx","cy","r"],mq={useVisualState:vL({scrapeMotionValuesFromProps:PL,createRenderState:TL,onUpdate:({props:i,prevProps:n,current:a,renderState:d,latestValues:y})=>{if(!a)return;let v=!!i.drag;if(!v){for(const s in y)if(Mg.has(s)){v=!0;break}}if(!v)return;let C=!n;if(n)for(let s=0;s<lN.length;s++){const M=lN[s];i[M]!==n[M]&&(C=!0)}C&&so.read(()=>{pq(a,d),so.render(()=>{Z2(d,y,K2(a.tagName),i.transformTemplate),AL(a,d)})})}})},gq={useVisualState:vL({scrapeMotionValuesFromProps:Y2,createRenderState:X2})};function kL(i,n,a){for(const d in n)!El(n[d])&&!IL(d,a)&&(i[d]=n[d])}function yq({transformTemplate:i},n){return $.useMemo(()=>{const a=X2();return H2(a,n,i),Object.assign({},a.vars,a.style)},[n])}function _q(i,n){const a=i.style||{},d={};return kL(d,a,i),Object.assign(d,yq(i,n)),d}function xq(i,n){const a={},d=_q(i,n);return i.drag&&i.dragListener!==!1&&(a.draggable=!1,d.userSelect=d.WebkitUserSelect=d.WebkitTouchCallout="none",d.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(a.tabIndex=0),a.style=d,a}function vq(i,n,a,d){const y=$.useMemo(()=>{const v=TL();return Z2(v,n,K2(d),i.transformTemplate),{...v.attrs,style:{...v.style}}},[n]);if(i.style){const v={};kL(v,i.style,i),y.style={...v,...y.style}}return y}function bq(i=!1){return(a,d,y,{latestValues:v},C)=>{const M=($2(a)?vq:xq)(d,v,C,a),L=D8(d,typeof a=="string",i),F=a!==$.Fragment?{...L,...M,ref:y}:{},{children:W}=d,X=$.useMemo(()=>El(W)?W.get():W,[W]);return $.createElement(a,{...F,children:X})}}function wq(i,n){return function(d,{forwardMotionProps:y}={forwardMotionProps:!1}){const C={...$2(d)?mq:gq,preloadedFeatures:i,useRender:bq(y),createVisualElement:n,Component:d};return G8(C)}}function NL(i,n){if(!Array.isArray(n))return!1;const a=n.length;if(a!==i.length)return!1;for(let d=0;d<a;d++)if(n[d]!==i[d])return!1;return!0}function pw(i,n,a){const d=i.getProps();return q2(d,n,a!==void 0?a:d.custom,i)}const Sq=z2(()=>window.ScrollTimeline!==void 0);class Tq{constructor(n){this.stop=()=>this.runAll("stop"),this.animations=n.filter(Boolean)}get finished(){return Promise.all(this.animations.map(n=>"finished"in n?n.finished:n))}getAll(n){return this.animations[0][n]}setAll(n,a){for(let d=0;d<this.animations.length;d++)this.animations[d][n]=a}attachTimeline(n,a){const d=this.animations.map(y=>{if(Sq()&&y.attachTimeline)return y.attachTimeline(n);if(typeof a=="function")return a(y)});return()=>{d.forEach((y,v)=>{y&&y(),this.animations[v].stop()})}}get time(){return this.getAll("time")}set time(n){this.setAll("time",n)}get speed(){return this.getAll("speed")}set speed(n){this.setAll("speed",n)}get startTime(){return this.getAll("startTime")}get duration(){let n=0;for(let a=0;a<this.animations.length;a++)n=Math.max(n,this.animations[a].duration);return n}runAll(n){this.animations.forEach(a=>a[n]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Eq extends Tq{then(n,a){return Promise.all(this.animations).then(n).catch(a)}}function Q2(i,n){return i?i[n]||i.default||i:void 0}const AT=2e4;function jL(i){let n=0;const a=50;let d=i.next(n);for(;!d.done&&n<AT;)n+=a,d=i.next(n);return n>=AT?1/0:n}function J2(i){return typeof i=="function"}function cN(i,n){i.timeline=n,i.onfinish=null}const eE=i=>Array.isArray(i)&&typeof i[0]=="number",Cq={linearEasing:void 0};function Aq(i,n){const a=z2(i);return()=>{var d;return(d=Cq[n])!==null&&d!==void 0?d:a()}}const S0=Aq(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),RL=(i,n,a=10)=>{let d="";const y=Math.max(Math.round(n/a),2);for(let v=0;v<y;v++)d+=i(i_(0,y-1,v))+", ";return`linear(${d.substring(0,d.length-2)})`};function ML(i){return!!(typeof i=="function"&&S0()||!i||typeof i=="string"&&(i in IT||S0())||eE(i)||Array.isArray(i)&&i.every(ML))}const Sx=([i,n,a,d])=>`cubic-bezier(${i}, ${n}, ${a}, ${d})`,IT={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Sx([0,.65,.55,1]),circOut:Sx([.55,0,1,.45]),backIn:Sx([.31,.01,.66,-.59]),backOut:Sx([.33,1.53,.69,.99])};function LL(i,n){if(i)return typeof i=="function"&&S0()?RL(i,n):eE(i)?Sx(i):Array.isArray(i)?i.map(a=>LL(a,n)||IT.easeOut):IT[i]}const xd={x:!1,y:!1};function DL(){return xd.x||xd.y}function Iq(i,n,a){var d;if(i instanceof Element)return[i];if(typeof i=="string"){let y=document;const v=(d=void 0)!==null&&d!==void 0?d:y.querySelectorAll(i);return v?Array.from(v):[]}return Array.from(i)}function OL(i,n){const a=Iq(i),d=new AbortController,y={passive:!0,...n,signal:d.signal};return[a,y,()=>d.abort()]}function uN(i){return n=>{n.pointerType==="touch"||DL()||i(n)}}function Pq(i,n,a={}){const[d,y,v]=OL(i,a),C=uN(s=>{const{target:M}=s,L=n(s);if(typeof L!="function"||!M)return;const F=uN(W=>{L(W),M.removeEventListener("pointerleave",F)});M.addEventListener("pointerleave",F,y)});return d.forEach(s=>{s.addEventListener("pointerenter",C,y)}),v}const zL=(i,n)=>n?i===n?!0:zL(i,n.parentElement):!1,tE=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,kq=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Nq(i){return kq.has(i.tagName)||i.tabIndex!==-1}const Tx=new WeakSet;function dN(i){return n=>{n.key==="Enter"&&i(n)}}function AS(i,n){i.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}const jq=(i,n)=>{const a=i.currentTarget;if(!a)return;const d=dN(()=>{if(Tx.has(a))return;AS(a,"down");const y=dN(()=>{AS(a,"up")}),v=()=>AS(a,"cancel");a.addEventListener("keyup",y,n),a.addEventListener("blur",v,n)});a.addEventListener("keydown",d,n),a.addEventListener("blur",()=>a.removeEventListener("keydown",d),n)};function hN(i){return tE(i)&&!DL()}function Rq(i,n,a={}){const[d,y,v]=OL(i,a),C=s=>{const M=s.currentTarget;if(!hN(s)||Tx.has(M))return;Tx.add(M);const L=n(s),F=(ee,he)=>{window.removeEventListener("pointerup",W),window.removeEventListener("pointercancel",X),!(!hN(ee)||!Tx.has(M))&&(Tx.delete(M),typeof L=="function"&&L(ee,{success:he}))},W=ee=>{F(ee,a.useGlobalTarget||zL(M,ee.target))},X=ee=>{F(ee,!1)};window.addEventListener("pointerup",W,y),window.addEventListener("pointercancel",X,y)};return d.forEach(s=>{!Nq(s)&&s.getAttribute("tabindex")===null&&(s.tabIndex=0),(a.useGlobalTarget?window:s).addEventListener("pointerdown",C,y),s.addEventListener("focus",L=>jq(L,y),y)}),v}function Mq(i){return i==="x"||i==="y"?xd[i]?null:(xd[i]=!0,()=>{xd[i]=!1}):xd.x||xd.y?null:(xd.x=xd.y=!0,()=>{xd.x=xd.y=!1})}const FL=new Set(["width","height","top","left","right","bottom",...m_]);let u0;function Lq(){u0=void 0}const Rh={now:()=>(u0===void 0&&Rh.set(nl.isProcessing||k8.useManualTiming?nl.timestamp:performance.now()),u0),set:i=>{u0=i,queueMicrotask(Lq)}};function rE(i,n){i.indexOf(n)===-1&&i.push(n)}function nE(i,n){const a=i.indexOf(n);a>-1&&i.splice(a,1)}class iE{constructor(){this.subscriptions=[]}add(n){return rE(this.subscriptions,n),()=>nE(this.subscriptions,n)}notify(n,a,d){const y=this.subscriptions.length;if(y)if(y===1)this.subscriptions[0](n,a,d);else for(let v=0;v<y;v++){const C=this.subscriptions[v];C&&C(n,a,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function BL(i,n){return n?i*(1e3/n):0}const fN=30,Dq=i=>!isNaN(parseFloat(i));class Oq{constructor(n,a={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(d,y=!0)=>{const v=Rh.now();this.updatedAt!==v&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(d),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),y&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(n),this.owner=a.owner}setCurrent(n){this.current=n,this.updatedAt=Rh.now(),this.canTrackVelocity===null&&n!==void 0&&(this.canTrackVelocity=Dq(this.current))}setPrevFrameValue(n=this.current){this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt}onChange(n){return this.on("change",n)}on(n,a){this.events[n]||(this.events[n]=new iE);const d=this.events[n].add(a);return n==="change"?()=>{d(),so.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const n in this.events)this.events[n].clear()}attach(n,a){this.passiveEffect=n,this.stopPassiveEffect=a}set(n,a=!0){!a||!this.passiveEffect?this.updateAndNotify(n,a):this.passiveEffect(n,this.updateAndNotify)}setWithVelocity(n,a,d){this.set(a),this.prev=void 0,this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt-d}jump(n,a=!0){this.updateAndNotify(n),this.prev=n,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const n=Rh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||n-this.updatedAt>fN)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,fN);return BL(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(n){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=n(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Gx(i,n){return new Oq(i,n)}function zq(i,n,a){i.hasValue(n)?i.getValue(n).set(a):i.addValue(n,Gx(a))}function Fq(i,n){const a=pw(i,n);let{transitionEnd:d={},transition:y={},...v}=a||{};v={...v,...d};for(const C in v){const s=Y8(v[C]);zq(i,C,s)}}function Bq(i){return!!(El(i)&&i.add)}function PT(i,n){const a=i.getValue("willChange");if(Bq(a))return a.add(n)}function VL(i){return i.props[yL]}const UL=(i,n,a)=>(((1-3*a+3*n)*i+(3*a-6*n))*i+3*n)*i,Vq=1e-7,Uq=12;function $q(i,n,a,d,y){let v,C,s=0;do C=n+(a-n)/2,v=UL(C,d,y)-i,v>0?a=C:n=C;while(Math.abs(v)>Vq&&++s<Uq);return C}function Sv(i,n,a,d){if(i===n&&a===d)return Xc;const y=v=>$q(v,0,1,i,a);return v=>v===0||v===1?v:UL(y(v),n,d)}const $L=i=>n=>n<=.5?i(2*n)/2:(2-i(2*(1-n)))/2,qL=i=>n=>1-i(1-n),GL=Sv(.33,1.53,.69,.99),sE=qL(GL),WL=$L(sE),HL=i=>(i*=2)<1?.5*sE(i):.5*(2-Math.pow(2,-10*(i-1))),oE=i=>1-Math.sin(Math.acos(i)),ZL=qL(oE),XL=$L(oE),KL=i=>/^0[^.\s]+$/u.test(i);function qq(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||KL(i):!0}const Px=i=>Math.round(i*1e5)/1e5,aE=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Gq(i){return i==null}const Wq=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,lE=(i,n)=>a=>!!(typeof a=="string"&&Wq.test(a)&&a.startsWith(i)||n&&!Gq(a)&&Object.prototype.hasOwnProperty.call(a,n)),YL=(i,n,a)=>d=>{if(typeof d!="string")return d;const[y,v,C,s]=d.match(aE);return{[i]:parseFloat(y),[n]:parseFloat(v),[a]:parseFloat(C),alpha:s!==void 0?parseFloat(s):1}},Hq=i=>rp(0,255,i),IS={...g_,transform:i=>Math.round(Hq(i))},wg={test:lE("rgb","red"),parse:YL("red","green","blue"),transform:({red:i,green:n,blue:a,alpha:d=1})=>"rgba("+IS.transform(i)+", "+IS.transform(n)+", "+IS.transform(a)+", "+Px(qx.transform(d))+")"};function Zq(i){let n="",a="",d="",y="";return i.length>5?(n=i.substring(1,3),a=i.substring(3,5),d=i.substring(5,7),y=i.substring(7,9)):(n=i.substring(1,2),a=i.substring(2,3),d=i.substring(3,4),y=i.substring(4,5),n+=n,a+=a,d+=d,y+=y),{red:parseInt(n,16),green:parseInt(a,16),blue:parseInt(d,16),alpha:y?parseInt(y,16)/255:1}}const kT={test:lE("#"),parse:Zq,transform:wg.transform},Fy={test:lE("hsl","hue"),parse:YL("hue","saturation","lightness"),transform:({hue:i,saturation:n,lightness:a,alpha:d=1})=>"hsla("+Math.round(i)+", "+jh.transform(Px(n))+", "+jh.transform(Px(a))+", "+Px(qx.transform(d))+")"},Tl={test:i=>wg.test(i)||kT.test(i)||Fy.test(i),parse:i=>wg.test(i)?wg.parse(i):Fy.test(i)?Fy.parse(i):kT.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?wg.transform(i):Fy.transform(i)},Xq=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Kq(i){var n,a;return isNaN(i)&&typeof i=="string"&&(((n=i.match(aE))===null||n===void 0?void 0:n.length)||0)+(((a=i.match(Xq))===null||a===void 0?void 0:a.length)||0)>0}const QL="number",JL="color",Yq="var",Qq="var(",pN="${}",Jq=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Wx(i){const n=i.toString(),a=[],d={color:[],number:[],var:[]},y=[];let v=0;const s=n.replace(Jq,M=>(Tl.test(M)?(d.color.push(v),y.push(JL),a.push(Tl.parse(M))):M.startsWith(Qq)?(d.var.push(v),y.push(Yq),a.push(M)):(d.number.push(v),y.push(QL),a.push(parseFloat(M))),++v,pN)).split(pN);return{values:a,split:s,indexes:d,types:y}}function eD(i){return Wx(i).values}function tD(i){const{split:n,types:a}=Wx(i),d=n.length;return y=>{let v="";for(let C=0;C<d;C++)if(v+=n[C],y[C]!==void 0){const s=a[C];s===QL?v+=Px(y[C]):s===JL?v+=Tl.transform(y[C]):v+=y[C]}return v}}const eG=i=>typeof i=="number"?0:i;function tG(i){const n=eD(i);return tD(i)(n.map(eG))}const mm={test:Kq,parse:eD,createTransformer:tD,getAnimatableNone:tG},rG=new Set(["brightness","contrast","saturate","opacity"]);function nG(i){const[n,a]=i.slice(0,-1).split("(");if(n==="drop-shadow")return i;const[d]=a.match(aE)||[];if(!d)return i;const y=a.replace(d,"");let v=rG.has(n)?1:0;return d!==a&&(v*=100),n+"("+v+y+")"}const iG=/\b([a-z-]*)\(.*?\)/gu,NT={...mm,getAnimatableNone:i=>{const n=i.match(iG);return n?n.map(nG).join(" "):i}},sG={...W2,color:Tl,backgroundColor:Tl,outlineColor:Tl,fill:Tl,stroke:Tl,borderColor:Tl,borderTopColor:Tl,borderRightColor:Tl,borderBottomColor:Tl,borderLeftColor:Tl,filter:NT,WebkitFilter:NT},cE=i=>sG[i];function rD(i,n){let a=cE(i);return a!==NT&&(a=mm),a.getAnimatableNone?a.getAnimatableNone(n):void 0}const oG=new Set(["auto","none","0"]);function aG(i,n,a){let d=0,y;for(;d<i.length&&!y;){const v=i[d];typeof v=="string"&&!oG.has(v)&&Wx(v).values.length&&(y=i[d]),d++}if(y&&a)for(const v of n)i[v]=rD(a,y)}const mN=i=>i===g_||i===pi,gN=(i,n)=>parseFloat(i.split(", ")[n]),yN=(i,n)=>(a,{transform:d})=>{if(d==="none"||!d)return 0;const y=d.match(/^matrix3d\((.+)\)$/u);if(y)return gN(y[1],n);{const v=d.match(/^matrix\((.+)\)$/u);return v?gN(v[1],i):0}},lG=new Set(["x","y","z"]),cG=m_.filter(i=>!lG.has(i));function uG(i){const n=[];return cG.forEach(a=>{const d=i.getValue(a);d!==void 0&&(n.push([a,d.get()]),d.set(a.startsWith("scale")?1:0))}),n}const o_={width:({x:i},{paddingLeft:n="0",paddingRight:a="0"})=>i.max-i.min-parseFloat(n)-parseFloat(a),height:({y:i},{paddingTop:n="0",paddingBottom:a="0"})=>i.max-i.min-parseFloat(n)-parseFloat(a),top:(i,{top:n})=>parseFloat(n),left:(i,{left:n})=>parseFloat(n),bottom:({y:i},{top:n})=>parseFloat(n)+(i.max-i.min),right:({x:i},{left:n})=>parseFloat(n)+(i.max-i.min),x:yN(4,13),y:yN(5,14)};o_.translateX=o_.x;o_.translateY=o_.y;const Eg=new Set;let jT=!1,RT=!1;function nD(){if(RT){const i=Array.from(Eg).filter(d=>d.needsMeasurement),n=new Set(i.map(d=>d.element)),a=new Map;n.forEach(d=>{const y=uG(d);y.length&&(a.set(d,y),d.render())}),i.forEach(d=>d.measureInitialState()),n.forEach(d=>{d.render();const y=a.get(d);y&&y.forEach(([v,C])=>{var s;(s=d.getValue(v))===null||s===void 0||s.set(C)})}),i.forEach(d=>d.measureEndState()),i.forEach(d=>{d.suspendedScrollY!==void 0&&window.scrollTo(0,d.suspendedScrollY)})}RT=!1,jT=!1,Eg.forEach(i=>i.complete()),Eg.clear()}function iD(){Eg.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(RT=!0)})}function dG(){iD(),nD()}class uE{constructor(n,a,d,y,v,C=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...n],this.onComplete=a,this.name=d,this.motionValue=y,this.element=v,this.isAsync=C}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Eg.add(this),jT||(jT=!0,so.read(iD),so.resolveKeyframes(nD))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:n,name:a,element:d,motionValue:y}=this;for(let v=0;v<n.length;v++)if(n[v]===null)if(v===0){const C=y?.get(),s=n[n.length-1];if(C!==void 0)n[0]=C;else if(d&&a){const M=d.readValue(a,s);M!=null&&(n[0]=M)}n[0]===void 0&&(n[0]=s),y&&C===void 0&&y.set(n[0])}else n[v]=n[v-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Eg.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Eg.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const sD=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i),hG=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fG(i){const n=hG.exec(i);if(!n)return[,];const[,a,d,y]=n;return[`--${a??d}`,y]}function oD(i,n,a=1){const[d,y]=fG(i);if(!d)return;const v=window.getComputedStyle(n).getPropertyValue(d);if(v){const C=v.trim();return sD(C)?parseFloat(C):C}return G2(y)?oD(y,n,a+1):y}const aD=i=>n=>n.test(i),pG={test:i=>i==="auto",parse:i=>i},lD=[g_,pi,jh,lm,nq,rq,pG],_N=i=>lD.find(aD(i));class cD extends uE{constructor(n,a,d,y,v){super(n,a,d,y,v,!0)}readKeyframes(){const{unresolvedKeyframes:n,element:a,name:d}=this;if(!a||!a.current)return;super.readKeyframes();for(let M=0;M<n.length;M++){let L=n[M];if(typeof L=="string"&&(L=L.trim(),G2(L))){const F=oD(L,a.current);F!==void 0&&(n[M]=F),M===n.length-1&&(this.finalKeyframe=L)}}if(this.resolveNoneKeyframes(),!FL.has(d)||n.length!==2)return;const[y,v]=n,C=_N(y),s=_N(v);if(C!==s)if(mN(C)&&mN(s))for(let M=0;M<n.length;M++){const L=n[M];typeof L=="string"&&(n[M]=parseFloat(L))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:n,name:a}=this,d=[];for(let y=0;y<n.length;y++)qq(n[y])&&d.push(y);d.length&&aG(n,d,a)}measureInitialState(){const{element:n,unresolvedKeyframes:a,name:d}=this;if(!n||!n.current)return;d==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=o_[d](n.measureViewportBox(),window.getComputedStyle(n.current)),a[0]=this.measuredOrigin;const y=a[a.length-1];y!==void 0&&n.getValue(d,y).jump(y,!1)}measureEndState(){var n;const{element:a,name:d,unresolvedKeyframes:y}=this;if(!a||!a.current)return;const v=a.getValue(d);v&&v.jump(this.measuredOrigin,!1);const C=y.length-1,s=y[C];y[C]=o_[d](a.measureViewportBox(),window.getComputedStyle(a.current)),s!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=s),!((n=this.removedTransforms)===null||n===void 0)&&n.length&&this.removedTransforms.forEach(([M,L])=>{a.getValue(M).set(L)}),this.resolveNoneKeyframes()}}const xN=(i,n)=>n==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(mm.test(i)||i==="0")&&!i.startsWith("url("));function mG(i){const n=i[0];if(i.length===1)return!0;for(let a=0;a<i.length;a++)if(i[a]!==n)return!0}function gG(i,n,a,d){const y=i[0];if(y===null)return!1;if(n==="display"||n==="visibility")return!0;const v=i[i.length-1],C=xN(y,n),s=xN(v,n);return!C||!s?!1:mG(i)||(a==="spring"||J2(a))&&d}const yG=i=>i!==null;function mw(i,{repeat:n,repeatType:a="loop"},d){const y=i.filter(yG),v=n&&a!=="loop"&&n%2===1?0:y.length-1;return!v||d===void 0?y[v]:d}const _G=40;class uD{constructor({autoplay:n=!0,delay:a=0,type:d="keyframes",repeat:y=0,repeatDelay:v=0,repeatType:C="loop",...s}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Rh.now(),this.options={autoplay:n,delay:a,type:d,repeat:y,repeatDelay:v,repeatType:C,...s},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>_G?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&dG(),this._resolved}onKeyframesResolved(n,a){this.resolvedAt=Rh.now(),this.hasAttemptedResolve=!0;const{name:d,type:y,velocity:v,delay:C,onComplete:s,onUpdate:M,isGenerator:L}=this.options;if(!L&&!gG(n,d,y,v))if(C)this.options.duration=0;else{M&&M(mw(n,this.options,a)),s&&s(),this.resolveFinishedPromise();return}const F=this.initPlayback(n,a);F!==!1&&(this._resolved={keyframes:n,finalKeyframe:a,...F},this.onPostResolved())}onPostResolved(){}then(n,a){return this.currentFinishedPromise.then(n,a)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(n=>{this.resolveFinishedPromise=n})}}const ko=(i,n,a)=>i+(n-i)*a;function PS(i,n,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?i+(n-i)*6*a:a<1/2?n:a<2/3?i+(n-i)*(2/3-a)*6:i}function xG({hue:i,saturation:n,lightness:a,alpha:d}){i/=360,n/=100,a/=100;let y=0,v=0,C=0;if(!n)y=v=C=a;else{const s=a<.5?a*(1+n):a+n-a*n,M=2*a-s;y=PS(M,s,i+1/3),v=PS(M,s,i),C=PS(M,s,i-1/3)}return{red:Math.round(y*255),green:Math.round(v*255),blue:Math.round(C*255),alpha:d}}function T0(i,n){return a=>a>0?n:i}const kS=(i,n,a)=>{const d=i*i,y=a*(n*n-d)+d;return y<0?0:Math.sqrt(y)},vG=[kT,wg,Fy],bG=i=>vG.find(n=>n.test(i));function vN(i){const n=bG(i);if(!n)return!1;let a=n.parse(i);return n===Fy&&(a=xG(a)),a}const bN=(i,n)=>{const a=vN(i),d=vN(n);if(!a||!d)return T0(i,n);const y={...a};return v=>(y.red=kS(a.red,d.red,v),y.green=kS(a.green,d.green,v),y.blue=kS(a.blue,d.blue,v),y.alpha=ko(a.alpha,d.alpha,v),wg.transform(y))},wG=(i,n)=>a=>n(i(a)),Tv=(...i)=>i.reduce(wG),MT=new Set(["none","hidden"]);function SG(i,n){return MT.has(i)?a=>a<=0?i:n:a=>a>=1?n:i}function TG(i,n){return a=>ko(i,n,a)}function dE(i){return typeof i=="number"?TG:typeof i=="string"?G2(i)?T0:Tl.test(i)?bN:AG:Array.isArray(i)?dD:typeof i=="object"?Tl.test(i)?bN:EG:T0}function dD(i,n){const a=[...i],d=a.length,y=i.map((v,C)=>dE(v)(v,n[C]));return v=>{for(let C=0;C<d;C++)a[C]=y[C](v);return a}}function EG(i,n){const a={...i,...n},d={};for(const y in a)i[y]!==void 0&&n[y]!==void 0&&(d[y]=dE(i[y])(i[y],n[y]));return y=>{for(const v in d)a[v]=d[v](y);return a}}function CG(i,n){var a;const d=[],y={color:0,var:0,number:0};for(let v=0;v<n.values.length;v++){const C=n.types[v],s=i.indexes[C][y[C]],M=(a=i.values[s])!==null&&a!==void 0?a:0;d[v]=M,y[C]++}return d}const AG=(i,n)=>{const a=mm.createTransformer(n),d=Wx(i),y=Wx(n);return d.indexes.var.length===y.indexes.var.length&&d.indexes.color.length===y.indexes.color.length&&d.indexes.number.length>=y.indexes.number.length?MT.has(i)&&!y.values.length||MT.has(n)&&!d.values.length?SG(i,n):Tv(dD(CG(d,y),y.values),a):T0(i,n)};function hD(i,n,a){return typeof i=="number"&&typeof n=="number"&&typeof a=="number"?ko(i,n,a):dE(i)(i,n)}const IG=5;function fD(i,n,a){const d=Math.max(n-IG,0);return BL(a-i(d),n-d)}const Bo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},NS=.001;function PG({duration:i=Bo.duration,bounce:n=Bo.bounce,velocity:a=Bo.velocity,mass:d=Bo.mass}){let y,v,C=1-n;C=rp(Bo.minDamping,Bo.maxDamping,C),i=rp(Bo.minDuration,Bo.maxDuration,tp(i)),C<1?(y=L=>{const F=L*C,W=F*i,X=F-a,ee=LT(L,C),he=Math.exp(-W);return NS-X/ee*he},v=L=>{const W=L*C*i,X=W*a+a,ee=Math.pow(C,2)*Math.pow(L,2)*i,he=Math.exp(-W),se=LT(Math.pow(L,2),C);return(-y(L)+NS>0?-1:1)*((X-ee)*he)/se}):(y=L=>{const F=Math.exp(-L*i),W=(L-a)*i+1;return-NS+F*W},v=L=>{const F=Math.exp(-L*i),W=(a-L)*(i*i);return F*W});const s=5/i,M=NG(y,v,s);if(i=ep(i),isNaN(M))return{stiffness:Bo.stiffness,damping:Bo.damping,duration:i};{const L=Math.pow(M,2)*d;return{stiffness:L,damping:C*2*Math.sqrt(d*L),duration:i}}}const kG=12;function NG(i,n,a){let d=a;for(let y=1;y<kG;y++)d=d-i(d)/n(d);return d}function LT(i,n){return i*Math.sqrt(1-n*n)}const jG=["duration","bounce"],RG=["stiffness","damping","mass"];function wN(i,n){return n.some(a=>i[a]!==void 0)}function MG(i){let n={velocity:Bo.velocity,stiffness:Bo.stiffness,damping:Bo.damping,mass:Bo.mass,isResolvedFromDuration:!1,...i};if(!wN(i,RG)&&wN(i,jG))if(i.visualDuration){const a=i.visualDuration,d=2*Math.PI/(a*1.2),y=d*d,v=2*rp(.05,1,1-(i.bounce||0))*Math.sqrt(y);n={...n,mass:Bo.mass,stiffness:y,damping:v}}else{const a=PG(i);n={...n,...a,mass:Bo.mass},n.isResolvedFromDuration=!0}return n}function pD(i=Bo.visualDuration,n=Bo.bounce){const a=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:n}:i;let{restSpeed:d,restDelta:y}=a;const v=a.keyframes[0],C=a.keyframes[a.keyframes.length-1],s={done:!1,value:v},{stiffness:M,damping:L,mass:F,duration:W,velocity:X,isResolvedFromDuration:ee}=MG({...a,velocity:-tp(a.velocity||0)}),he=X||0,se=L/(2*Math.sqrt(M*F)),oe=C-v,ve=tp(Math.sqrt(M/F)),me=Math.abs(oe)<5;d||(d=me?Bo.restSpeed.granular:Bo.restSpeed.default),y||(y=me?Bo.restDelta.granular:Bo.restDelta.default);let Se;if(se<1){const Be=LT(ve,se);Se=rt=>{const We=Math.exp(-se*ve*rt);return C-We*((he+se*ve*oe)/Be*Math.sin(Be*rt)+oe*Math.cos(Be*rt))}}else if(se===1)Se=Be=>C-Math.exp(-ve*Be)*(oe+(he+ve*oe)*Be);else{const Be=ve*Math.sqrt(se*se-1);Se=rt=>{const We=Math.exp(-se*ve*rt),Ct=Math.min(Be*rt,300);return C-We*((he+se*ve*oe)*Math.sinh(Ct)+Be*oe*Math.cosh(Ct))/Be}}const Re={calculatedDuration:ee&&W||null,next:Be=>{const rt=Se(Be);if(ee)s.done=Be>=W;else{let We=0;se<1&&(We=Be===0?ep(he):fD(Se,Be,rt));const Ct=Math.abs(We)<=d,Ht=Math.abs(C-rt)<=y;s.done=Ct&&Ht}return s.value=s.done?C:rt,s},toString:()=>{const Be=Math.min(jL(Re),AT),rt=RL(We=>Re.next(Be*We).value,Be,30);return Be+"ms "+rt}};return Re}function SN({keyframes:i,velocity:n=0,power:a=.8,timeConstant:d=325,bounceDamping:y=10,bounceStiffness:v=500,modifyTarget:C,min:s,max:M,restDelta:L=.5,restSpeed:F}){const W=i[0],X={done:!1,value:W},ee=Ct=>s!==void 0&&Ct<s||M!==void 0&&Ct>M,he=Ct=>s===void 0?M:M===void 0||Math.abs(s-Ct)<Math.abs(M-Ct)?s:M;let se=a*n;const oe=W+se,ve=C===void 0?oe:C(oe);ve!==oe&&(se=ve-W);const me=Ct=>-se*Math.exp(-Ct/d),Se=Ct=>ve+me(Ct),Re=Ct=>{const Ht=me(Ct),Zt=Se(Ct);X.done=Math.abs(Ht)<=L,X.value=X.done?ve:Zt};let Be,rt;const We=Ct=>{ee(X.value)&&(Be=Ct,rt=pD({keyframes:[X.value,he(X.value)],velocity:fD(Se,Ct,X.value),damping:y,stiffness:v,restDelta:L,restSpeed:F}))};return We(0),{calculatedDuration:null,next:Ct=>{let Ht=!1;return!rt&&Be===void 0&&(Ht=!0,Re(Ct),We(Ct)),Be!==void 0&&Ct>=Be?rt.next(Ct-Be):(!Ht&&Re(Ct),X)}}}const LG=Sv(.42,0,1,1),DG=Sv(0,0,.58,1),mD=Sv(.42,0,.58,1),OG=i=>Array.isArray(i)&&typeof i[0]!="number",zG={linear:Xc,easeIn:LG,easeInOut:mD,easeOut:DG,circIn:oE,circInOut:XL,circOut:ZL,backIn:sE,backInOut:WL,backOut:GL,anticipate:HL},TN=i=>{if(eE(i)){hL(i.length===4);const[n,a,d,y]=i;return Sv(n,a,d,y)}else if(typeof i=="string")return zG[i];return i};function FG(i,n,a){const d=[],y=a||hD,v=i.length-1;for(let C=0;C<v;C++){let s=y(i[C],i[C+1]);if(n){const M=Array.isArray(n)?n[C]||Xc:n;s=Tv(M,s)}d.push(s)}return d}function BG(i,n,{clamp:a=!0,ease:d,mixer:y}={}){const v=i.length;if(hL(v===n.length),v===1)return()=>n[0];if(v===2&&n[0]===n[1])return()=>n[1];const C=i[0]===i[1];i[0]>i[v-1]&&(i=[...i].reverse(),n=[...n].reverse());const s=FG(n,d,y),M=s.length,L=F=>{if(C&&F<i[0])return n[0];let W=0;if(M>1)for(;W<i.length-2&&!(F<i[W+1]);W++);const X=i_(i[W],i[W+1],F);return s[W](X)};return a?F=>L(rp(i[0],i[v-1],F)):L}function VG(i,n){const a=i[i.length-1];for(let d=1;d<=n;d++){const y=i_(0,n,d);i.push(ko(a,1,y))}}function UG(i){const n=[0];return VG(n,i.length-1),n}function $G(i,n){return i.map(a=>a*n)}function qG(i,n){return i.map(()=>n||mD).splice(0,i.length-1)}function E0({duration:i=300,keyframes:n,times:a,ease:d="easeInOut"}){const y=OG(d)?d.map(TN):TN(d),v={done:!1,value:n[0]},C=$G(a&&a.length===n.length?a:UG(n),i),s=BG(C,n,{ease:Array.isArray(y)?y:qG(n,y)});return{calculatedDuration:i,next:M=>(v.value=s(M),v.done=M>=i,v)}}const GG=i=>{const n=({timestamp:a})=>i(a);return{start:()=>so.update(n,!0),stop:()=>pm(n),now:()=>nl.isProcessing?nl.timestamp:Rh.now()}},WG={decay:SN,inertia:SN,tween:E0,keyframes:E0,spring:pD},HG=i=>i/100;class hE extends uD{constructor(n){super(n),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:M}=this.options;M&&M()};const{name:a,motionValue:d,element:y,keyframes:v}=this.options,C=y?.KeyframeResolver||uE,s=(M,L)=>this.onKeyframesResolved(M,L);this.resolver=new C(v,s,a,d,y),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(n){const{type:a="keyframes",repeat:d=0,repeatDelay:y=0,repeatType:v,velocity:C=0}=this.options,s=J2(a)?a:WG[a]||E0;let M,L;s!==E0&&typeof n[0]!="number"&&(M=Tv(HG,hD(n[0],n[1])),n=[0,100]);const F=s({...this.options,keyframes:n});v==="mirror"&&(L=s({...this.options,keyframes:[...n].reverse(),velocity:-C})),F.calculatedDuration===null&&(F.calculatedDuration=jL(F));const{calculatedDuration:W}=F,X=W+y,ee=X*(d+1)-y;return{generator:F,mirroredGenerator:L,mapPercentToKeyframes:M,calculatedDuration:W,resolvedDuration:X,totalDuration:ee}}onPostResolved(){const{autoplay:n=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!n?this.pause():this.state=this.pendingPlayState}tick(n,a=!1){const{resolved:d}=this;if(!d){const{keyframes:Ct}=this.options;return{done:!0,value:Ct[Ct.length-1]}}const{finalKeyframe:y,generator:v,mirroredGenerator:C,mapPercentToKeyframes:s,keyframes:M,calculatedDuration:L,totalDuration:F,resolvedDuration:W}=d;if(this.startTime===null)return v.next(0);const{delay:X,repeat:ee,repeatType:he,repeatDelay:se,onUpdate:oe}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,n):this.speed<0&&(this.startTime=Math.min(n-F/this.speed,this.startTime)),a?this.currentTime=n:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(n-this.startTime)*this.speed;const ve=this.currentTime-X*(this.speed>=0?1:-1),me=this.speed>=0?ve<0:ve>F;this.currentTime=Math.max(ve,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=F);let Se=this.currentTime,Re=v;if(ee){const Ct=Math.min(this.currentTime,F)/W;let Ht=Math.floor(Ct),Zt=Ct%1;!Zt&&Ct>=1&&(Zt=1),Zt===1&&Ht--,Ht=Math.min(Ht,ee+1),!!(Ht%2)&&(he==="reverse"?(Zt=1-Zt,se&&(Zt-=se/W)):he==="mirror"&&(Re=C)),Se=rp(0,1,Zt)*W}const Be=me?{done:!1,value:M[0]}:Re.next(Se);s&&(Be.value=s(Be.value));let{done:rt}=Be;!me&&L!==null&&(rt=this.speed>=0?this.currentTime>=F:this.currentTime<=0);const We=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&rt);return We&&y!==void 0&&(Be.value=mw(M,this.options,y)),oe&&oe(Be.value),We&&this.finish(),Be}get duration(){const{resolved:n}=this;return n?tp(n.calculatedDuration):0}get time(){return tp(this.currentTime)}set time(n){n=ep(n),this.currentTime=n,this.holdTime!==null||this.speed===0?this.holdTime=n:this.driver&&(this.startTime=this.driver.now()-n/this.speed)}get speed(){return this.playbackSpeed}set speed(n){const a=this.playbackSpeed!==n;this.playbackSpeed=n,a&&(this.time=tp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:n=GG,onPlay:a,startTime:d}=this.options;this.driver||(this.driver=n(v=>this.tick(v))),a&&a();const y=this.driver.now();this.holdTime!==null?this.startTime=y-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=y):this.startTime=d??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var n;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(n=this.currentTime)!==null&&n!==void 0?n:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:n}=this.options;n&&n()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(n){return this.startTime=0,this.tick(n,!0)}}const ZG=new Set(["opacity","clipPath","filter","transform"]);function XG(i,n,a,{delay:d=0,duration:y=300,repeat:v=0,repeatType:C="loop",ease:s="easeInOut",times:M}={}){const L={[n]:a};M&&(L.offset=M);const F=LL(s,y);return Array.isArray(F)&&(L.easing=F),i.animate(L,{delay:d,duration:y,easing:Array.isArray(F)?"linear":F,fill:"both",iterations:v+1,direction:C==="reverse"?"alternate":"normal"})}const KG=z2(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),C0=10,YG=2e4;function QG(i){return J2(i.type)||i.type==="spring"||!ML(i.ease)}function JG(i,n){const a=new hE({...n,keyframes:i,repeat:0,delay:0,isGenerator:!0});let d={done:!1,value:i[0]};const y=[];let v=0;for(;!d.done&&v<YG;)d=a.sample(v),y.push(d.value),v+=C0;return{times:void 0,keyframes:y,duration:v-C0,ease:"linear"}}const gD={anticipate:HL,backInOut:WL,circInOut:XL};function eW(i){return i in gD}class EN extends uD{constructor(n){super(n);const{name:a,motionValue:d,element:y,keyframes:v}=this.options;this.resolver=new cD(v,(C,s)=>this.onKeyframesResolved(C,s),a,d,y),this.resolver.scheduleResolve()}initPlayback(n,a){let{duration:d=300,times:y,ease:v,type:C,motionValue:s,name:M,startTime:L}=this.options;if(!s.owner||!s.owner.current)return!1;if(typeof v=="string"&&S0()&&eW(v)&&(v=gD[v]),QG(this.options)){const{onComplete:W,onUpdate:X,motionValue:ee,element:he,...se}=this.options,oe=JG(n,se);n=oe.keyframes,n.length===1&&(n[1]=n[0]),d=oe.duration,y=oe.times,v=oe.ease,C="keyframes"}const F=XG(s.owner.current,M,n,{...this.options,duration:d,times:y,ease:v});return F.startTime=L??this.calcStartTime(),this.pendingTimeline?(cN(F,this.pendingTimeline),this.pendingTimeline=void 0):F.onfinish=()=>{const{onComplete:W}=this.options;s.set(mw(n,this.options,a)),W&&W(),this.cancel(),this.resolveFinishedPromise()},{animation:F,duration:d,times:y,type:C,ease:v,keyframes:n}}get duration(){const{resolved:n}=this;if(!n)return 0;const{duration:a}=n;return tp(a)}get time(){const{resolved:n}=this;if(!n)return 0;const{animation:a}=n;return tp(a.currentTime||0)}set time(n){const{resolved:a}=this;if(!a)return;const{animation:d}=a;d.currentTime=ep(n)}get speed(){const{resolved:n}=this;if(!n)return 1;const{animation:a}=n;return a.playbackRate}set speed(n){const{resolved:a}=this;if(!a)return;const{animation:d}=a;d.playbackRate=n}get state(){const{resolved:n}=this;if(!n)return"idle";const{animation:a}=n;return a.playState}get startTime(){const{resolved:n}=this;if(!n)return null;const{animation:a}=n;return a.startTime}attachTimeline(n){if(!this._resolved)this.pendingTimeline=n;else{const{resolved:a}=this;if(!a)return Xc;const{animation:d}=a;cN(d,n)}return Xc}play(){if(this.isStopped)return;const{resolved:n}=this;if(!n)return;const{animation:a}=n;a.playState==="finished"&&this.updateFinishedPromise(),a.play()}pause(){const{resolved:n}=this;if(!n)return;const{animation:a}=n;a.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:n}=this;if(!n)return;const{animation:a,keyframes:d,duration:y,type:v,ease:C,times:s}=n;if(a.playState==="idle"||a.playState==="finished")return;if(this.time){const{motionValue:L,onUpdate:F,onComplete:W,element:X,...ee}=this.options,he=new hE({...ee,keyframes:d,duration:y,type:v,ease:C,times:s,isGenerator:!0}),se=ep(this.time);L.setWithVelocity(he.sample(se-C0).value,he.sample(se).value,C0)}const{onStop:M}=this.options;M&&M(),this.cancel()}complete(){const{resolved:n}=this;n&&n.animation.finish()}cancel(){const{resolved:n}=this;n&&n.animation.cancel()}static supports(n){const{motionValue:a,name:d,repeatDelay:y,repeatType:v,damping:C,type:s}=n;if(!a||!a.owner||!(a.owner.current instanceof HTMLElement))return!1;const{onUpdate:M,transformTemplate:L}=a.owner.getProps();return KG()&&d&&ZG.has(d)&&!M&&!L&&!y&&v!=="mirror"&&C!==0&&s!=="inertia"}}const tW={type:"spring",stiffness:500,damping:25,restSpeed:10},rW=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),nW={type:"keyframes",duration:.8},iW={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},sW=(i,{keyframes:n})=>n.length>2?nW:Mg.has(i)?i.startsWith("scale")?rW(n[1]):tW:iW;function oW({when:i,delay:n,delayChildren:a,staggerChildren:d,staggerDirection:y,repeat:v,repeatType:C,repeatDelay:s,from:M,elapsed:L,...F}){return!!Object.keys(F).length}const fE=(i,n,a,d={},y,v)=>C=>{const s=Q2(d,i)||{},M=s.delay||d.delay||0;let{elapsed:L=0}=d;L=L-ep(M);let F={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:n.getVelocity(),...s,delay:-L,onUpdate:X=>{n.set(X),s.onUpdate&&s.onUpdate(X)},onComplete:()=>{C(),s.onComplete&&s.onComplete()},name:i,motionValue:n,element:v?void 0:y};oW(s)||(F={...F,...sW(i,F)}),F.duration&&(F.duration=ep(F.duration)),F.repeatDelay&&(F.repeatDelay=ep(F.repeatDelay)),F.from!==void 0&&(F.keyframes[0]=F.from);let W=!1;if((F.type===!1||F.duration===0&&!F.repeatDelay)&&(F.duration=0,F.delay===0&&(W=!0)),W&&!v&&n.get()!==void 0){const X=mw(F.keyframes,s);if(X!==void 0)return so.update(()=>{F.onUpdate(X),F.onComplete()}),new Eq([])}return!v&&EN.supports(F)?new EN(F):new hE(F)};function aW({protectedKeys:i,needsAnimating:n},a){const d=i.hasOwnProperty(a)&&n[a]!==!0;return n[a]=!1,d}function yD(i,n,{delay:a=0,transitionOverride:d,type:y}={}){var v;let{transition:C=i.getDefaultTransition(),transitionEnd:s,...M}=n;d&&(C=d);const L=[],F=y&&i.animationState&&i.animationState.getState()[y];for(const W in M){const X=i.getValue(W,(v=i.latestValues[W])!==null&&v!==void 0?v:null),ee=M[W];if(ee===void 0||F&&aW(F,W))continue;const he={delay:a,...Q2(C||{},W)};let se=!1;if(window.MotionHandoffAnimation){const ve=VL(i);if(ve){const me=window.MotionHandoffAnimation(ve,W,so);me!==null&&(he.startTime=me,se=!0)}}PT(i,W),X.start(fE(W,X,ee,i.shouldReduceMotion&&FL.has(W)?{type:!1}:he,i,se));const oe=X.animation;oe&&L.push(oe)}return s&&Promise.all(L).then(()=>{so.update(()=>{s&&Fq(i,s)})}),L}function DT(i,n,a={}){var d;const y=pw(i,n,a.type==="exit"?(d=i.presenceContext)===null||d===void 0?void 0:d.custom:void 0);let{transition:v=i.getDefaultTransition()||{}}=y||{};a.transitionOverride&&(v=a.transitionOverride);const C=y?()=>Promise.all(yD(i,y,a)):()=>Promise.resolve(),s=i.variantChildren&&i.variantChildren.size?(L=0)=>{const{delayChildren:F=0,staggerChildren:W,staggerDirection:X}=v;return lW(i,n,F+L,W,X,a)}:()=>Promise.resolve(),{when:M}=v;if(M){const[L,F]=M==="beforeChildren"?[C,s]:[s,C];return L().then(()=>F())}else return Promise.all([C(),s(a.delay)])}function lW(i,n,a=0,d=0,y=1,v){const C=[],s=(i.variantChildren.size-1)*d,M=y===1?(L=0)=>L*d:(L=0)=>s-L*d;return Array.from(i.variantChildren).sort(cW).forEach((L,F)=>{L.notify("AnimationStart",n),C.push(DT(L,n,{...v,delay:a+M(F)}).then(()=>L.notify("AnimationComplete",n)))}),Promise.all(C)}function cW(i,n){return i.sortNodePosition(n)}function uW(i,n,a={}){i.notify("AnimationStart",n);let d;if(Array.isArray(n)){const y=n.map(v=>DT(i,v,a));d=Promise.all(y)}else if(typeof n=="string")d=DT(i,n,a);else{const y=typeof n=="function"?pw(i,n,a.custom):n;d=Promise.all(yD(i,y,a))}return d.then(()=>{i.notify("AnimationComplete",n)})}const dW=B2.length;function _D(i){if(!i)return;if(!i.isControllingVariants){const a=i.parent?_D(i.parent)||{}:{};return i.props.initial!==void 0&&(a.initial=i.props.initial),a}const n={};for(let a=0;a<dW;a++){const d=B2[a],y=i.props[d];($x(y)||y===!1)&&(n[d]=y)}return n}const hW=[...F2].reverse(),fW=F2.length;function pW(i){return n=>Promise.all(n.map(({animation:a,options:d})=>uW(i,a,d)))}function mW(i){let n=pW(i),a=CN(),d=!0;const y=M=>(L,F)=>{var W;const X=pw(i,F,M==="exit"?(W=i.presenceContext)===null||W===void 0?void 0:W.custom:void 0);if(X){const{transition:ee,transitionEnd:he,...se}=X;L={...L,...se,...he}}return L};function v(M){n=M(i)}function C(M){const{props:L}=i,F=_D(i.parent)||{},W=[],X=new Set;let ee={},he=1/0;for(let oe=0;oe<fW;oe++){const ve=hW[oe],me=a[ve],Se=L[ve]!==void 0?L[ve]:F[ve],Re=$x(Se),Be=ve===M?me.isActive:null;Be===!1&&(he=oe);let rt=Se===F[ve]&&Se!==L[ve]&&Re;if(rt&&d&&i.manuallyAnimateOnMount&&(rt=!1),me.protectedKeys={...ee},!me.isActive&&Be===null||!Se&&!me.prevProp||hw(Se)||typeof Se=="boolean")continue;const We=gW(me.prevProp,Se);let Ct=We||ve===M&&me.isActive&&!rt&&Re||oe>he&&Re,Ht=!1;const Zt=Array.isArray(Se)?Se:[Se];let rr=Zt.reduce(y(ve),{});Be===!1&&(rr={});const{prevResolvedValues:$t={}}=me,Rt={...$t,...rr},Gt=Xt=>{Ct=!0,X.has(Xt)&&(Ht=!0,X.delete(Xt)),me.needsAnimating[Xt]=!0;const ut=i.getValue(Xt);ut&&(ut.liveStyle=!1)};for(const Xt in Rt){const ut=rr[Xt],Mt=$t[Xt];if(ee.hasOwnProperty(Xt))continue;let Qt=!1;CT(ut)&&CT(Mt)?Qt=!NL(ut,Mt):Qt=ut!==Mt,Qt?ut!=null?Gt(Xt):X.add(Xt):ut!==void 0&&X.has(Xt)?Gt(Xt):me.protectedKeys[Xt]=!0}me.prevProp=Se,me.prevResolvedValues=rr,me.isActive&&(ee={...ee,...rr}),d&&i.blockInitialAnimation&&(Ct=!1),Ct&&(!(rt&&We)||Ht)&&W.push(...Zt.map(Xt=>({animation:Xt,options:{type:ve}})))}if(X.size){const oe={};X.forEach(ve=>{const me=i.getBaseTarget(ve),Se=i.getValue(ve);Se&&(Se.liveStyle=!0),oe[ve]=me??null}),W.push({animation:oe})}let se=!!W.length;return d&&(L.initial===!1||L.initial===L.animate)&&!i.manuallyAnimateOnMount&&(se=!1),d=!1,se?n(W):Promise.resolve()}function s(M,L){var F;if(a[M].isActive===L)return Promise.resolve();(F=i.variantChildren)===null||F===void 0||F.forEach(X=>{var ee;return(ee=X.animationState)===null||ee===void 0?void 0:ee.setActive(M,L)}),a[M].isActive=L;const W=C(M);for(const X in a)a[X].protectedKeys={};return W}return{animateChanges:C,setActive:s,setAnimateFunction:v,getState:()=>a,reset:()=>{a=CN(),d=!0}}}function gW(i,n){return typeof n=="string"?n!==i:Array.isArray(n)?!NL(n,i):!1}function hg(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function CN(){return{animate:hg(!0),whileInView:hg(),whileHover:hg(),whileTap:hg(),whileDrag:hg(),whileFocus:hg(),exit:hg()}}class wm{constructor(n){this.isMounted=!1,this.node=n}update(){}}class yW extends wm{constructor(n){super(n),n.animationState||(n.animationState=mW(n))}updateAnimationControlsSubscription(){const{animate:n}=this.node.getProps();hw(n)&&(this.unmountControls=n.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:n}=this.node.getProps(),{animate:a}=this.node.prevProps||{};n!==a&&this.updateAnimationControlsSubscription()}unmount(){var n;this.node.animationState.reset(),(n=this.unmountControls)===null||n===void 0||n.call(this)}}let _W=0;class xW extends wm{constructor(){super(...arguments),this.id=_W++}update(){if(!this.node.presenceContext)return;const{isPresent:n,onExitComplete:a}=this.node.presenceContext,{isPresent:d}=this.node.prevPresenceContext||{};if(!this.node.animationState||n===d)return;const y=this.node.animationState.setActive("exit",!n);a&&!n&&y.then(()=>a(this.id))}mount(){const{register:n}=this.node.presenceContext||{};n&&(this.unmount=n(this.id))}unmount(){}}const vW={animation:{Feature:yW},exit:{Feature:xW}};function Hx(i,n,a,d={passive:!0}){return i.addEventListener(n,a,d),()=>i.removeEventListener(n,a)}function Ev(i){return{point:{x:i.pageX,y:i.pageY}}}const bW=i=>n=>tE(n)&&i(n,Ev(n));function kx(i,n,a,d){return Hx(i,n,bW(a),d)}const AN=(i,n)=>Math.abs(i-n);function wW(i,n){const a=AN(i.x,n.x),d=AN(i.y,n.y);return Math.sqrt(a**2+d**2)}class xD{constructor(n,a,{transformPagePoint:d,contextWindow:y,dragSnapToOrigin:v=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const W=RS(this.lastMoveEventInfo,this.history),X=this.startEvent!==null,ee=wW(W.offset,{x:0,y:0})>=3;if(!X&&!ee)return;const{point:he}=W,{timestamp:se}=nl;this.history.push({...he,timestamp:se});const{onStart:oe,onMove:ve}=this.handlers;X||(oe&&oe(this.lastMoveEvent,W),this.startEvent=this.lastMoveEvent),ve&&ve(this.lastMoveEvent,W)},this.handlePointerMove=(W,X)=>{this.lastMoveEvent=W,this.lastMoveEventInfo=jS(X,this.transformPagePoint),so.update(this.updatePoint,!0)},this.handlePointerUp=(W,X)=>{this.end();const{onEnd:ee,onSessionEnd:he,resumeAnimation:se}=this.handlers;if(this.dragSnapToOrigin&&se&&se(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const oe=RS(W.type==="pointercancel"?this.lastMoveEventInfo:jS(X,this.transformPagePoint),this.history);this.startEvent&&ee&&ee(W,oe),he&&he(W,oe)},!tE(n))return;this.dragSnapToOrigin=v,this.handlers=a,this.transformPagePoint=d,this.contextWindow=y||window;const C=Ev(n),s=jS(C,this.transformPagePoint),{point:M}=s,{timestamp:L}=nl;this.history=[{...M,timestamp:L}];const{onSessionStart:F}=a;F&&F(n,RS(s,this.history)),this.removeListeners=Tv(kx(this.contextWindow,"pointermove",this.handlePointerMove),kx(this.contextWindow,"pointerup",this.handlePointerUp),kx(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(n){this.handlers=n}end(){this.removeListeners&&this.removeListeners(),pm(this.updatePoint)}}function jS(i,n){return n?{point:n(i.point)}:i}function IN(i,n){return{x:i.x-n.x,y:i.y-n.y}}function RS({point:i},n){return{point:i,delta:IN(i,vD(n)),offset:IN(i,SW(n)),velocity:TW(n,.1)}}function SW(i){return i[0]}function vD(i){return i[i.length-1]}function TW(i,n){if(i.length<2)return{x:0,y:0};let a=i.length-1,d=null;const y=vD(i);for(;a>=0&&(d=i[a],!(y.timestamp-d.timestamp>ep(n)));)a--;if(!d)return{x:0,y:0};const v=tp(y.timestamp-d.timestamp);if(v===0)return{x:0,y:0};const C={x:(y.x-d.x)/v,y:(y.y-d.y)/v};return C.x===1/0&&(C.x=0),C.y===1/0&&(C.y=0),C}const bD=1e-4,EW=1-bD,CW=1+bD,wD=.01,AW=0-wD,IW=0+wD;function Jc(i){return i.max-i.min}function PW(i,n,a){return Math.abs(i-n)<=a}function PN(i,n,a,d=.5){i.origin=d,i.originPoint=ko(n.min,n.max,i.origin),i.scale=Jc(a)/Jc(n),i.translate=ko(a.min,a.max,i.origin)-i.originPoint,(i.scale>=EW&&i.scale<=CW||isNaN(i.scale))&&(i.scale=1),(i.translate>=AW&&i.translate<=IW||isNaN(i.translate))&&(i.translate=0)}function Nx(i,n,a,d){PN(i.x,n.x,a.x,d?d.originX:void 0),PN(i.y,n.y,a.y,d?d.originY:void 0)}function kN(i,n,a){i.min=a.min+n.min,i.max=i.min+Jc(n)}function kW(i,n,a){kN(i.x,n.x,a.x),kN(i.y,n.y,a.y)}function NN(i,n,a){i.min=n.min-a.min,i.max=i.min+Jc(n)}function jx(i,n,a){NN(i.x,n.x,a.x),NN(i.y,n.y,a.y)}function NW(i,{min:n,max:a},d){return n!==void 0&&i<n?i=d?ko(n,i,d.min):Math.max(i,n):a!==void 0&&i>a&&(i=d?ko(a,i,d.max):Math.min(i,a)),i}function jN(i,n,a){return{min:n!==void 0?i.min+n:void 0,max:a!==void 0?i.max+a-(i.max-i.min):void 0}}function jW(i,{top:n,left:a,bottom:d,right:y}){return{x:jN(i.x,a,y),y:jN(i.y,n,d)}}function RN(i,n){let a=n.min-i.min,d=n.max-i.max;return n.max-n.min<i.max-i.min&&([a,d]=[d,a]),{min:a,max:d}}function RW(i,n){return{x:RN(i.x,n.x),y:RN(i.y,n.y)}}function MW(i,n){let a=.5;const d=Jc(i),y=Jc(n);return y>d?a=i_(n.min,n.max-d,i.min):d>y&&(a=i_(i.min,i.max-y,n.min)),rp(0,1,a)}function LW(i,n){const a={};return n.min!==void 0&&(a.min=n.min-i.min),n.max!==void 0&&(a.max=n.max-i.min),a}const OT=.35;function DW(i=OT){return i===!1?i=0:i===!0&&(i=OT),{x:MN(i,"left","right"),y:MN(i,"top","bottom")}}function MN(i,n,a){return{min:LN(i,n),max:LN(i,a)}}function LN(i,n){return typeof i=="number"?i:i[n]||0}const DN=()=>({translate:0,scale:1,origin:0,originPoint:0}),By=()=>({x:DN(),y:DN()}),ON=()=>({min:0,max:0}),Qo=()=>({x:ON(),y:ON()});function Nu(i){return[i("x"),i("y")]}function SD({top:i,left:n,right:a,bottom:d}){return{x:{min:n,max:a},y:{min:i,max:d}}}function OW({x:i,y:n}){return{top:n.min,right:i.max,bottom:n.max,left:i.min}}function zW(i,n){if(!n)return i;const a=n({x:i.left,y:i.top}),d=n({x:i.right,y:i.bottom});return{top:a.y,left:a.x,bottom:d.y,right:d.x}}function MS(i){return i===void 0||i===1}function zT({scale:i,scaleX:n,scaleY:a}){return!MS(i)||!MS(n)||!MS(a)}function yg(i){return zT(i)||TD(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function TD(i){return zN(i.x)||zN(i.y)}function zN(i){return i&&i!=="0%"}function A0(i,n,a){const d=i-a,y=n*d;return a+y}function FN(i,n,a,d,y){return y!==void 0&&(i=A0(i,y,d)),A0(i,a,d)+n}function FT(i,n=0,a=1,d,y){i.min=FN(i.min,n,a,d,y),i.max=FN(i.max,n,a,d,y)}function ED(i,{x:n,y:a}){FT(i.x,n.translate,n.scale,n.originPoint),FT(i.y,a.translate,a.scale,a.originPoint)}const BN=.999999999999,VN=1.0000000000001;function FW(i,n,a,d=!1){const y=a.length;if(!y)return;n.x=n.y=1;let v,C;for(let s=0;s<y;s++){v=a[s],C=v.projectionDelta;const{visualElement:M}=v.options;M&&M.props.style&&M.props.style.display==="contents"||(d&&v.options.layoutScroll&&v.scroll&&v!==v.root&&Uy(i,{x:-v.scroll.offset.x,y:-v.scroll.offset.y}),C&&(n.x*=C.x.scale,n.y*=C.y.scale,ED(i,C)),d&&yg(v.latestValues)&&Uy(i,v.latestValues))}n.x<VN&&n.x>BN&&(n.x=1),n.y<VN&&n.y>BN&&(n.y=1)}function Vy(i,n){i.min=i.min+n,i.max=i.max+n}function UN(i,n,a,d,y=.5){const v=ko(i.min,i.max,y);FT(i,n,a,v,d)}function Uy(i,n){UN(i.x,n.x,n.scaleX,n.scale,n.originX),UN(i.y,n.y,n.scaleY,n.scale,n.originY)}function CD(i,n){return SD(zW(i.getBoundingClientRect(),n))}function BW(i,n,a){const d=CD(i,a),{scroll:y}=n;return y&&(Vy(d.x,y.offset.x),Vy(d.y,y.offset.y)),d}const AD=({current:i})=>i?i.ownerDocument.defaultView:null,VW=new WeakMap;class UW{constructor(n){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Qo(),this.visualElement=n}start(n,{snapToCursor:a=!1}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const y=F=>{const{dragSnapToOrigin:W}=this.getProps();W?this.pauseAnimation():this.stopAnimation(),a&&this.snapToCursor(Ev(F).point)},v=(F,W)=>{const{drag:X,dragPropagation:ee,onDragStart:he}=this.getProps();if(X&&!ee&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Mq(X),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Nu(oe=>{let ve=this.getAxisMotionValue(oe).get()||0;if(jh.test(ve)){const{projection:me}=this.visualElement;if(me&&me.layout){const Se=me.layout.layoutBox[oe];Se&&(ve=Jc(Se)*(parseFloat(ve)/100))}}this.originPoint[oe]=ve}),he&&so.postRender(()=>he(F,W)),PT(this.visualElement,"transform");const{animationState:se}=this.visualElement;se&&se.setActive("whileDrag",!0)},C=(F,W)=>{const{dragPropagation:X,dragDirectionLock:ee,onDirectionLock:he,onDrag:se}=this.getProps();if(!X&&!this.openDragLock)return;const{offset:oe}=W;if(ee&&this.currentDirection===null){this.currentDirection=$W(oe),this.currentDirection!==null&&he&&he(this.currentDirection);return}this.updateAxis("x",W.point,oe),this.updateAxis("y",W.point,oe),this.visualElement.render(),se&&se(F,W)},s=(F,W)=>this.stop(F,W),M=()=>Nu(F=>{var W;return this.getAnimationState(F)==="paused"&&((W=this.getAxisMotionValue(F).animation)===null||W===void 0?void 0:W.play())}),{dragSnapToOrigin:L}=this.getProps();this.panSession=new xD(n,{onSessionStart:y,onStart:v,onMove:C,onSessionEnd:s,resumeAnimation:M},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:L,contextWindow:AD(this.visualElement)})}stop(n,a){const d=this.isDragging;if(this.cancel(),!d)return;const{velocity:y}=a;this.startAnimation(y);const{onDragEnd:v}=this.getProps();v&&so.postRender(()=>v(n,a))}cancel(){this.isDragging=!1;const{projection:n,animationState:a}=this.visualElement;n&&(n.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:d}=this.getProps();!d&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}updateAxis(n,a,d){const{drag:y}=this.getProps();if(!d||!Vb(n,y,this.currentDirection))return;const v=this.getAxisMotionValue(n);let C=this.originPoint[n]+d[n];this.constraints&&this.constraints[n]&&(C=NW(C,this.constraints[n],this.elastic[n])),v.set(C)}resolveConstraints(){var n;const{dragConstraints:a,dragElastic:d}=this.getProps(),y=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(n=this.visualElement.projection)===null||n===void 0?void 0:n.layout,v=this.constraints;a&&zy(a)?this.constraints||(this.constraints=this.resolveRefConstraints()):a&&y?this.constraints=jW(y.layoutBox,a):this.constraints=!1,this.elastic=DW(d),v!==this.constraints&&y&&this.constraints&&!this.hasMutatedConstraints&&Nu(C=>{this.constraints!==!1&&this.getAxisMotionValue(C)&&(this.constraints[C]=LW(y.layoutBox[C],this.constraints[C]))})}resolveRefConstraints(){const{dragConstraints:n,onMeasureDragConstraints:a}=this.getProps();if(!n||!zy(n))return!1;const d=n.current,{projection:y}=this.visualElement;if(!y||!y.layout)return!1;const v=BW(d,y.root,this.visualElement.getTransformPagePoint());let C=RW(y.layout.layoutBox,v);if(a){const s=a(OW(C));this.hasMutatedConstraints=!!s,s&&(C=SD(s))}return C}startAnimation(n){const{drag:a,dragMomentum:d,dragElastic:y,dragTransition:v,dragSnapToOrigin:C,onDragTransitionEnd:s}=this.getProps(),M=this.constraints||{},L=Nu(F=>{if(!Vb(F,a,this.currentDirection))return;let W=M&&M[F]||{};C&&(W={min:0,max:0});const X=y?200:1e6,ee=y?40:1e7,he={type:"inertia",velocity:d?n[F]:0,bounceStiffness:X,bounceDamping:ee,timeConstant:750,restDelta:1,restSpeed:10,...v,...W};return this.startAxisValueAnimation(F,he)});return Promise.all(L).then(s)}startAxisValueAnimation(n,a){const d=this.getAxisMotionValue(n);return PT(this.visualElement,n),d.start(fE(n,d,0,a,this.visualElement,!1))}stopAnimation(){Nu(n=>this.getAxisMotionValue(n).stop())}pauseAnimation(){Nu(n=>{var a;return(a=this.getAxisMotionValue(n).animation)===null||a===void 0?void 0:a.pause()})}getAnimationState(n){var a;return(a=this.getAxisMotionValue(n).animation)===null||a===void 0?void 0:a.state}getAxisMotionValue(n){const a=`_drag${n.toUpperCase()}`,d=this.visualElement.getProps(),y=d[a];return y||this.visualElement.getValue(n,(d.initial?d.initial[n]:void 0)||0)}snapToCursor(n){Nu(a=>{const{drag:d}=this.getProps();if(!Vb(a,d,this.currentDirection))return;const{projection:y}=this.visualElement,v=this.getAxisMotionValue(a);if(y&&y.layout){const{min:C,max:s}=y.layout.layoutBox[a];v.set(n[a]-ko(C,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:n,dragConstraints:a}=this.getProps(),{projection:d}=this.visualElement;if(!zy(a)||!d||!this.constraints)return;this.stopAnimation();const y={x:0,y:0};Nu(C=>{const s=this.getAxisMotionValue(C);if(s&&this.constraints!==!1){const M=s.get();y[C]=MW({min:M,max:M},this.constraints[C])}});const{transformTemplate:v}=this.visualElement.getProps();this.visualElement.current.style.transform=v?v({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.resolveConstraints(),Nu(C=>{if(!Vb(C,n,null))return;const s=this.getAxisMotionValue(C),{min:M,max:L}=this.constraints[C];s.set(ko(M,L,y[C]))})}addListeners(){if(!this.visualElement.current)return;VW.set(this.visualElement,this);const n=this.visualElement.current,a=kx(n,"pointerdown",M=>{const{drag:L,dragListener:F=!0}=this.getProps();L&&F&&this.start(M)}),d=()=>{const{dragConstraints:M}=this.getProps();zy(M)&&M.current&&(this.constraints=this.resolveRefConstraints())},{projection:y}=this.visualElement,v=y.addEventListener("measure",d);y&&!y.layout&&(y.root&&y.root.updateScroll(),y.updateLayout()),so.read(d);const C=Hx(window,"resize",()=>this.scalePositionWithinConstraints()),s=y.addEventListener("didUpdate",(({delta:M,hasLayoutChanged:L})=>{this.isDragging&&L&&(Nu(F=>{const W=this.getAxisMotionValue(F);W&&(this.originPoint[F]+=M[F].translate,W.set(W.get()+M[F].translate))}),this.visualElement.render())}));return()=>{C(),a(),v(),s&&s()}}getProps(){const n=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:d=!1,dragPropagation:y=!1,dragConstraints:v=!1,dragElastic:C=OT,dragMomentum:s=!0}=n;return{...n,drag:a,dragDirectionLock:d,dragPropagation:y,dragConstraints:v,dragElastic:C,dragMomentum:s}}}function Vb(i,n,a){return(n===!0||n===i)&&(a===null||a===i)}function $W(i,n=10){let a=null;return Math.abs(i.y)>n?a="y":Math.abs(i.x)>n&&(a="x"),a}class qW extends wm{constructor(n){super(n),this.removeGroupControls=Xc,this.removeListeners=Xc,this.controls=new UW(n)}mount(){const{dragControls:n}=this.node.getProps();n&&(this.removeGroupControls=n.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xc}unmount(){this.removeGroupControls(),this.removeListeners()}}const $N=i=>(n,a)=>{i&&so.postRender(()=>i(n,a))};class GW extends wm{constructor(){super(...arguments),this.removePointerDownListener=Xc}onPointerDown(n){this.session=new xD(n,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:AD(this.node)})}createPanHandlers(){const{onPanSessionStart:n,onPanStart:a,onPan:d,onPanEnd:y}=this.node.getProps();return{onSessionStart:$N(n),onStart:$N(a),onMove:d,onEnd:(v,C)=>{delete this.session,y&&so.postRender(()=>y(v,C))}}}mount(){this.removePointerDownListener=kx(this.node.current,"pointerdown",n=>this.onPointerDown(n))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const d0={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function qN(i,n){return n.max===n.min?0:i/(n.max-n.min)*100}const vx={correct:(i,n)=>{if(!n.target)return i;if(typeof i=="string")if(pi.test(i))i=parseFloat(i);else return i;const a=qN(i,n.target.x),d=qN(i,n.target.y);return`${a}% ${d}%`}},WW={correct:(i,{treeScale:n,projectionDelta:a})=>{const d=i,y=mm.parse(i);if(y.length>5)return d;const v=mm.createTransformer(i),C=typeof y[0]!="number"?1:0,s=a.x.scale*n.x,M=a.y.scale*n.y;y[0+C]/=s,y[1+C]/=M;const L=ko(s,M,.5);return typeof y[2+C]=="number"&&(y[2+C]/=L),typeof y[3+C]=="number"&&(y[3+C]/=L),v(y)}};class HW extends $.Component{componentDidMount(){const{visualElement:n,layoutGroup:a,switchLayoutGroup:d,layoutId:y}=this.props,{projection:v}=n;fq(ZW),v&&(a.group&&a.group.add(v),d&&d.register&&y&&d.register(v),v.root.didUpdate(),v.addEventListener("animationComplete",()=>{this.safeToRemove()}),v.setOptions({...v.options,onExitComplete:()=>this.safeToRemove()})),d0.hasEverUpdated=!0}getSnapshotBeforeUpdate(n){const{layoutDependency:a,visualElement:d,drag:y,isPresent:v}=this.props,C=d.projection;return C&&(C.isPresent=v,y||n.layoutDependency!==a||a===void 0?C.willUpdate():this.safeToRemove(),n.isPresent!==v&&(v?C.promote():C.relegate()||so.postRender(()=>{const s=C.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:n}=this.props.visualElement;n&&(n.root.didUpdate(),U2.postRender(()=>{!n.currentAnimation&&n.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:n,layoutGroup:a,switchLayoutGroup:d}=this.props,{projection:y}=n;y&&(y.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(y),d&&d.deregister&&d.deregister(y))}safeToRemove(){const{safeToRemove:n}=this.props;n&&n()}render(){return null}}function ID(i){const[n,a]=cL(),d=$.useContext(M2);return h.jsx(HW,{...i,layoutGroup:d,switchLayoutGroup:$.useContext(_L),isPresent:n,safeToRemove:a})}const ZW={borderRadius:{...vx,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:vx,borderTopRightRadius:vx,borderBottomLeftRadius:vx,borderBottomRightRadius:vx,boxShadow:WW};function XW(i,n,a){const d=El(i)?i:Gx(i);return d.start(fE("",d,n,a)),d.animation}function KW(i){return i instanceof SVGElement&&i.tagName!=="svg"}const YW=(i,n)=>i.depth-n.depth;class QW{constructor(){this.children=[],this.isDirty=!1}add(n){rE(this.children,n),this.isDirty=!0}remove(n){nE(this.children,n),this.isDirty=!0}forEach(n){this.isDirty&&this.children.sort(YW),this.isDirty=!1,this.children.forEach(n)}}function JW(i,n){const a=Rh.now(),d=({timestamp:y})=>{const v=y-a;v>=n&&(pm(d),i(v-n))};return so.read(d,!0),()=>pm(d)}const PD=["TopLeft","TopRight","BottomLeft","BottomRight"],eH=PD.length,GN=i=>typeof i=="string"?parseFloat(i):i,WN=i=>typeof i=="number"||pi.test(i);function tH(i,n,a,d,y,v){y?(i.opacity=ko(0,a.opacity!==void 0?a.opacity:1,rH(d)),i.opacityExit=ko(n.opacity!==void 0?n.opacity:1,0,nH(d))):v&&(i.opacity=ko(n.opacity!==void 0?n.opacity:1,a.opacity!==void 0?a.opacity:1,d));for(let C=0;C<eH;C++){const s=`border${PD[C]}Radius`;let M=HN(n,s),L=HN(a,s);if(M===void 0&&L===void 0)continue;M||(M=0),L||(L=0),M===0||L===0||WN(M)===WN(L)?(i[s]=Math.max(ko(GN(M),GN(L),d),0),(jh.test(L)||jh.test(M))&&(i[s]+="%")):i[s]=L}(n.rotate||a.rotate)&&(i.rotate=ko(n.rotate||0,a.rotate||0,d))}function HN(i,n){return i[n]!==void 0?i[n]:i.borderRadius}const rH=kD(0,.5,ZL),nH=kD(.5,.95,Xc);function kD(i,n,a){return d=>d<i?0:d>n?1:a(i_(i,n,d))}function ZN(i,n){i.min=n.min,i.max=n.max}function Pu(i,n){ZN(i.x,n.x),ZN(i.y,n.y)}function XN(i,n){i.translate=n.translate,i.scale=n.scale,i.originPoint=n.originPoint,i.origin=n.origin}function KN(i,n,a,d,y){return i-=n,i=A0(i,1/a,d),y!==void 0&&(i=A0(i,1/y,d)),i}function iH(i,n=0,a=1,d=.5,y,v=i,C=i){if(jh.test(n)&&(n=parseFloat(n),n=ko(C.min,C.max,n/100)-C.min),typeof n!="number")return;let s=ko(v.min,v.max,d);i===v&&(s-=n),i.min=KN(i.min,n,a,s,y),i.max=KN(i.max,n,a,s,y)}function YN(i,n,[a,d,y],v,C){iH(i,n[a],n[d],n[y],n.scale,v,C)}const sH=["x","scaleX","originX"],oH=["y","scaleY","originY"];function QN(i,n,a,d){YN(i.x,n,sH,a?a.x:void 0,d?d.x:void 0),YN(i.y,n,oH,a?a.y:void 0,d?d.y:void 0)}function JN(i){return i.translate===0&&i.scale===1}function ND(i){return JN(i.x)&&JN(i.y)}function ej(i,n){return i.min===n.min&&i.max===n.max}function aH(i,n){return ej(i.x,n.x)&&ej(i.y,n.y)}function tj(i,n){return Math.round(i.min)===Math.round(n.min)&&Math.round(i.max)===Math.round(n.max)}function jD(i,n){return tj(i.x,n.x)&&tj(i.y,n.y)}function rj(i){return Jc(i.x)/Jc(i.y)}function nj(i,n){return i.translate===n.translate&&i.scale===n.scale&&i.originPoint===n.originPoint}class lH{constructor(){this.members=[]}add(n){rE(this.members,n),n.scheduleRender()}remove(n){if(nE(this.members,n),n===this.prevLead&&(this.prevLead=void 0),n===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(n){const a=this.members.findIndex(y=>n===y);if(a===0)return!1;let d;for(let y=a;y>=0;y--){const v=this.members[y];if(v.isPresent!==!1){d=v;break}}return d?(this.promote(d),!0):!1}promote(n,a){const d=this.lead;if(n!==d&&(this.prevLead=d,this.lead=n,n.show(),d)){d.instance&&d.scheduleRender(),n.scheduleRender(),n.resumeFrom=d,a&&(n.resumeFrom.preserveOpacity=!0),d.snapshot&&(n.snapshot=d.snapshot,n.snapshot.latestValues=d.animationValues||d.latestValues),n.root&&n.root.isUpdating&&(n.isLayoutDirty=!0);const{crossfade:y}=n.options;y===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(n=>{const{options:a,resumingFrom:d}=n;a.onExitComplete&&a.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(n=>{n.instance&&n.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function cH(i,n,a){let d="";const y=i.x.translate/n.x,v=i.y.translate/n.y,C=a?.z||0;if((y||v||C)&&(d=`translate3d(${y}px, ${v}px, ${C}px) `),(n.x!==1||n.y!==1)&&(d+=`scale(${1/n.x}, ${1/n.y}) `),a){const{transformPerspective:L,rotate:F,rotateX:W,rotateY:X,skewX:ee,skewY:he}=a;L&&(d=`perspective(${L}px) ${d}`),F&&(d+=`rotate(${F}deg) `),W&&(d+=`rotateX(${W}deg) `),X&&(d+=`rotateY(${X}deg) `),ee&&(d+=`skewX(${ee}deg) `),he&&(d+=`skewY(${he}deg) `)}const s=i.x.scale*n.x,M=i.y.scale*n.y;return(s!==1||M!==1)&&(d+=`scale(${s}, ${M})`),d||"none"}const _g={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Ex=typeof window<"u"&&window.MotionDebug!==void 0,LS=["","X","Y","Z"],uH={visibility:"hidden"},ij=1e3;let dH=0;function DS(i,n,a,d){const{latestValues:y}=n;y[i]&&(a[i]=y[i],n.setStaticValue(i,0),d&&(d[i]=0))}function RD(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:n}=i.options;if(!n)return;const a=VL(n);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:y,layoutId:v}=i.options;window.MotionCancelOptimisedAnimation(a,"transform",so,!(y||v))}const{parent:d}=i;d&&!d.hasCheckedOptimisedAppear&&RD(d)}function MD({attachResizeListener:i,defaultParent:n,measureScroll:a,checkIsScrollRoot:d,resetTransform:y}){return class{constructor(C={},s=n?.()){this.id=dH++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ex&&(_g.totalNodes=_g.resolvedTargetDeltas=_g.recalculatedProjection=0),this.nodes.forEach(pH),this.nodes.forEach(xH),this.nodes.forEach(vH),this.nodes.forEach(mH),Ex&&window.MotionDebug.record(_g)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=C,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let M=0;M<this.path.length;M++)this.path[M].shouldResetTransform=!0;this.root===this&&(this.nodes=new QW)}addEventListener(C,s){return this.eventHandlers.has(C)||this.eventHandlers.set(C,new iE),this.eventHandlers.get(C).add(s)}notifyListeners(C,...s){const M=this.eventHandlers.get(C);M&&M.notify(...s)}hasListeners(C){return this.eventHandlers.has(C)}mount(C,s=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=KW(C),this.instance=C;const{layoutId:M,layout:L,visualElement:F}=this.options;if(F&&!F.current&&F.mount(C),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),s&&(L||M)&&(this.isLayoutDirty=!0),i){let W;const X=()=>this.root.updateBlockedByResize=!1;i(C,()=>{this.root.updateBlockedByResize=!0,W&&W(),W=JW(X,250),d0.hasAnimatedSinceResize&&(d0.hasAnimatedSinceResize=!1,this.nodes.forEach(oj))})}M&&this.root.registerSharedNode(M,this),this.options.animate!==!1&&F&&(M||L)&&this.addEventListener("didUpdate",({delta:W,hasLayoutChanged:X,hasRelativeTargetChanged:ee,layout:he})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const se=this.options.transition||F.getDefaultTransition()||EH,{onLayoutAnimationStart:oe,onLayoutAnimationComplete:ve}=F.getProps(),me=!this.targetLayout||!jD(this.targetLayout,he)||ee,Se=!X&&ee;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Se||X&&(me||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(W,Se);const Re={...Q2(se,"layout"),onPlay:oe,onComplete:ve};(F.shouldReduceMotion||this.options.layoutRoot)&&(Re.delay=0,Re.type=!1),this.startAnimation(Re)}else X||oj(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=he})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const C=this.getStack();C&&C.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,pm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(bH),this.animationId++)}getTransformTemplate(){const{visualElement:C}=this.options;return C&&C.getProps().transformTemplate}willUpdate(C=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&RD(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let F=0;F<this.path.length;F++){const W=this.path[F];W.shouldResetTransform=!0,W.updateScroll("snapshot"),W.options.layoutRoot&&W.willUpdate(!1)}const{layoutId:s,layout:M}=this.options;if(s===void 0&&!M)return;const L=this.getTransformTemplate();this.prevTransformTemplateValue=L?L(this.latestValues,""):void 0,this.updateSnapshot(),C&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(sj);return}this.isUpdating||this.nodes.forEach(yH),this.isUpdating=!1,this.nodes.forEach(_H),this.nodes.forEach(hH),this.nodes.forEach(fH),this.clearAllSnapshots();const s=Rh.now();nl.delta=rp(0,1e3/60,s-nl.timestamp),nl.timestamp=s,nl.isProcessing=!0,CS.update.process(nl),CS.preRender.process(nl),CS.render.process(nl),nl.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,U2.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(gH),this.sharedNodes.forEach(wH)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,so.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){so.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let M=0;M<this.path.length;M++)this.path[M].updateScroll();const C=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Qo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,C?C.layoutBox:void 0)}updateScroll(C="measure"){let s=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===C&&(s=!1),s){const M=d(this.instance);this.scroll={animationId:this.root.animationId,phase:C,isRoot:M,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:M}}}resetTransform(){if(!y)return;const C=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,s=this.projectionDelta&&!ND(this.projectionDelta),M=this.getTransformTemplate(),L=M?M(this.latestValues,""):void 0,F=L!==this.prevTransformTemplateValue;C&&(s||yg(this.latestValues)||F)&&(y(this.instance,L),this.shouldResetTransform=!1,this.scheduleRender())}measure(C=!0){const s=this.measurePageBox();let M=this.removeElementScroll(s);return C&&(M=this.removeTransform(M)),CH(M),{animationId:this.root.animationId,measuredBox:s,layoutBox:M,latestValues:{},source:this.id}}measurePageBox(){var C;const{visualElement:s}=this.options;if(!s)return Qo();const M=s.measureViewportBox();if(!(((C=this.scroll)===null||C===void 0?void 0:C.wasRoot)||this.path.some(AH))){const{scroll:F}=this.root;F&&(Vy(M.x,F.offset.x),Vy(M.y,F.offset.y))}return M}removeElementScroll(C){var s;const M=Qo();if(Pu(M,C),!((s=this.scroll)===null||s===void 0)&&s.wasRoot)return M;for(let L=0;L<this.path.length;L++){const F=this.path[L],{scroll:W,options:X}=F;F!==this.root&&W&&X.layoutScroll&&(W.wasRoot&&Pu(M,C),Vy(M.x,W.offset.x),Vy(M.y,W.offset.y))}return M}applyTransform(C,s=!1){const M=Qo();Pu(M,C);for(let L=0;L<this.path.length;L++){const F=this.path[L];!s&&F.options.layoutScroll&&F.scroll&&F!==F.root&&Uy(M,{x:-F.scroll.offset.x,y:-F.scroll.offset.y}),yg(F.latestValues)&&Uy(M,F.latestValues)}return yg(this.latestValues)&&Uy(M,this.latestValues),M}removeTransform(C){const s=Qo();Pu(s,C);for(let M=0;M<this.path.length;M++){const L=this.path[M];if(!L.instance||!yg(L.latestValues))continue;zT(L.latestValues)&&L.updateSnapshot();const F=Qo(),W=L.measurePageBox();Pu(F,W),QN(s,L.latestValues,L.snapshot?L.snapshot.layoutBox:void 0,F)}return yg(this.latestValues)&&QN(s,this.latestValues),s}setTargetDelta(C){this.targetDelta=C,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(C){this.options={...this.options,...C,crossfade:C.crossfade!==void 0?C.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==nl.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(C=!1){var s;const M=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=M.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=M.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=M.isSharedProjectionDirty);const L=!!this.resumingFrom||this!==M;if(!(C||L&&this.isSharedProjectionDirty||this.isProjectionDirty||!((s=this.parent)===null||s===void 0)&&s.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:W,layoutId:X}=this.options;if(!(!this.layout||!(W||X))){if(this.resolvedRelativeTargetAt=nl.timestamp,!this.targetDelta&&!this.relativeTarget){const ee=this.getClosestProjectingParent();ee&&ee.layout&&this.animationProgress!==1?(this.relativeParent=ee,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Qo(),this.relativeTargetOrigin=Qo(),jx(this.relativeTargetOrigin,this.layout.layoutBox,ee.layout.layoutBox),Pu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Qo(),this.targetWithTransforms=Qo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),kW(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pu(this.target,this.layout.layoutBox),ED(this.target,this.targetDelta)):Pu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const ee=this.getClosestProjectingParent();ee&&!!ee.resumingFrom==!!this.resumingFrom&&!ee.options.layoutScroll&&ee.target&&this.animationProgress!==1?(this.relativeParent=ee,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Qo(),this.relativeTargetOrigin=Qo(),jx(this.relativeTargetOrigin,this.target,ee.target),Pu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ex&&_g.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||zT(this.parent.latestValues)||TD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var C;const s=this.getLead(),M=!!this.resumingFrom||this!==s;let L=!0;if((this.isProjectionDirty||!((C=this.parent)===null||C===void 0)&&C.isProjectionDirty)&&(L=!1),M&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(L=!1),this.resolvedRelativeTargetAt===nl.timestamp&&(L=!1),L)return;const{layout:F,layoutId:W}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(F||W))return;Pu(this.layoutCorrected,this.layout.layoutBox);const X=this.treeScale.x,ee=this.treeScale.y;FW(this.layoutCorrected,this.treeScale,this.path,M),s.layout&&!s.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(s.target=s.layout.layoutBox,s.targetWithTransforms=Qo());const{target:he}=s;if(!he){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(XN(this.prevProjectionDelta.x,this.projectionDelta.x),XN(this.prevProjectionDelta.y,this.projectionDelta.y)),Nx(this.projectionDelta,this.layoutCorrected,he,this.latestValues),(this.treeScale.x!==X||this.treeScale.y!==ee||!nj(this.projectionDelta.x,this.prevProjectionDelta.x)||!nj(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",he)),Ex&&_g.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(C=!0){var s;if((s=this.options.visualElement)===null||s===void 0||s.scheduleRender(),C){const M=this.getStack();M&&M.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=By(),this.projectionDelta=By(),this.projectionDeltaWithTransform=By()}setAnimationOrigin(C,s=!1){const M=this.snapshot,L=M?M.latestValues:{},F={...this.latestValues},W=By();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const X=Qo(),ee=M?M.source:void 0,he=this.layout?this.layout.source:void 0,se=ee!==he,oe=this.getStack(),ve=!oe||oe.members.length<=1,me=!!(se&&!ve&&this.options.crossfade===!0&&!this.path.some(TH));this.animationProgress=0;let Se;this.mixTargetDelta=Re=>{const Be=Re/1e3;aj(W.x,C.x,Be),aj(W.y,C.y,Be),this.setTargetDelta(W),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(jx(X,this.layout.layoutBox,this.relativeParent.layout.layoutBox),SH(this.relativeTarget,this.relativeTargetOrigin,X,Be),Se&&aH(this.relativeTarget,Se)&&(this.isProjectionDirty=!1),Se||(Se=Qo()),Pu(Se,this.relativeTarget)),se&&(this.animationValues=F,tH(F,L,this.latestValues,Be,me,ve)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Be},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(C){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(pm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=so.update(()=>{d0.hasAnimatedSinceResize=!0,this.currentAnimation=XW(0,ij,{...C,onUpdate:s=>{this.mixTargetDelta(s),C.onUpdate&&C.onUpdate(s)},onComplete:()=>{C.onComplete&&C.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const C=this.getStack();C&&C.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(ij),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const C=this.getLead();let{targetWithTransforms:s,target:M,layout:L,latestValues:F}=C;if(!(!s||!M||!L)){if(this!==C&&this.layout&&L&&LD(this.options.animationType,this.layout.layoutBox,L.layoutBox)){M=this.target||Qo();const W=Jc(this.layout.layoutBox.x);M.x.min=C.target.x.min,M.x.max=M.x.min+W;const X=Jc(this.layout.layoutBox.y);M.y.min=C.target.y.min,M.y.max=M.y.min+X}Pu(s,M),Uy(s,F),Nx(this.projectionDeltaWithTransform,this.layoutCorrected,s,F)}}registerSharedNode(C,s){this.sharedNodes.has(C)||this.sharedNodes.set(C,new lH),this.sharedNodes.get(C).add(s);const L=s.options.initialPromotionConfig;s.promote({transition:L?L.transition:void 0,preserveFollowOpacity:L&&L.shouldPreserveFollowOpacity?L.shouldPreserveFollowOpacity(s):void 0})}isLead(){const C=this.getStack();return C?C.lead===this:!0}getLead(){var C;const{layoutId:s}=this.options;return s?((C=this.getStack())===null||C===void 0?void 0:C.lead)||this:this}getPrevLead(){var C;const{layoutId:s}=this.options;return s?(C=this.getStack())===null||C===void 0?void 0:C.prevLead:void 0}getStack(){const{layoutId:C}=this.options;if(C)return this.root.sharedNodes.get(C)}promote({needsReset:C,transition:s,preserveFollowOpacity:M}={}){const L=this.getStack();L&&L.promote(this,M),C&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const C=this.getStack();return C?C.relegate(this):!1}resetSkewAndRotation(){const{visualElement:C}=this.options;if(!C)return;let s=!1;const{latestValues:M}=C;if((M.z||M.rotate||M.rotateX||M.rotateY||M.rotateZ||M.skewX||M.skewY)&&(s=!0),!s)return;const L={};M.z&&DS("z",C,L,this.animationValues);for(let F=0;F<LS.length;F++)DS(`rotate${LS[F]}`,C,L,this.animationValues),DS(`skew${LS[F]}`,C,L,this.animationValues);C.render();for(const F in L)C.setStaticValue(F,L[F]),this.animationValues&&(this.animationValues[F]=L[F]);C.scheduleRender()}getProjectionStyles(C){var s,M;if(!this.instance||this.isSVG)return;if(!this.isVisible)return uH;const L={visibility:""},F=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,L.opacity="",L.pointerEvents=c0(C?.pointerEvents)||"",L.transform=F?F(this.latestValues,""):"none",L;const W=this.getLead();if(!this.projectionDelta||!this.layout||!W.target){const se={};return this.options.layoutId&&(se.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,se.pointerEvents=c0(C?.pointerEvents)||""),this.hasProjected&&!yg(this.latestValues)&&(se.transform=F?F({},""):"none",this.hasProjected=!1),se}const X=W.animationValues||W.latestValues;this.applyTransformsToTarget(),L.transform=cH(this.projectionDeltaWithTransform,this.treeScale,X),F&&(L.transform=F(X,L.transform));const{x:ee,y:he}=this.projectionDelta;L.transformOrigin=`${ee.origin*100}% ${he.origin*100}% 0`,W.animationValues?L.opacity=W===this?(M=(s=X.opacity)!==null&&s!==void 0?s:this.latestValues.opacity)!==null&&M!==void 0?M:1:this.preserveOpacity?this.latestValues.opacity:X.opacityExit:L.opacity=W===this?X.opacity!==void 0?X.opacity:"":X.opacityExit!==void 0?X.opacityExit:0;for(const se in w0){if(X[se]===void 0)continue;const{correct:oe,applyTo:ve}=w0[se],me=L.transform==="none"?X[se]:oe(X[se],W);if(ve){const Se=ve.length;for(let Re=0;Re<Se;Re++)L[ve[Re]]=me}else L[se]=me}return this.options.layoutId&&(L.pointerEvents=W===this?c0(C?.pointerEvents)||"":"none"),L}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(C=>{var s;return(s=C.currentAnimation)===null||s===void 0?void 0:s.stop()}),this.root.nodes.forEach(sj),this.root.sharedNodes.clear()}}}function hH(i){i.updateLayout()}function fH(i){var n;const a=((n=i.resumeFrom)===null||n===void 0?void 0:n.snapshot)||i.snapshot;if(i.isLead()&&i.layout&&a&&i.hasListeners("didUpdate")){const{layoutBox:d,measuredBox:y}=i.layout,{animationType:v}=i.options,C=a.source!==i.layout.source;v==="size"?Nu(W=>{const X=C?a.measuredBox[W]:a.layoutBox[W],ee=Jc(X);X.min=d[W].min,X.max=X.min+ee}):LD(v,a.layoutBox,d)&&Nu(W=>{const X=C?a.measuredBox[W]:a.layoutBox[W],ee=Jc(d[W]);X.max=X.min+ee,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[W].max=i.relativeTarget[W].min+ee)});const s=By();Nx(s,d,a.layoutBox);const M=By();C?Nx(M,i.applyTransform(y,!0),a.measuredBox):Nx(M,d,a.layoutBox);const L=!ND(s);let F=!1;if(!i.resumeFrom){const W=i.getClosestProjectingParent();if(W&&!W.resumeFrom){const{snapshot:X,layout:ee}=W;if(X&&ee){const he=Qo();jx(he,a.layoutBox,X.layoutBox);const se=Qo();jx(se,d,ee.layoutBox),jD(he,se)||(F=!0),W.options.layoutRoot&&(i.relativeTarget=se,i.relativeTargetOrigin=he,i.relativeParent=W)}}}i.notifyListeners("didUpdate",{layout:d,snapshot:a,delta:M,layoutDelta:s,hasLayoutChanged:L,hasRelativeTargetChanged:F})}else if(i.isLead()){const{onExitComplete:d}=i.options;d&&d()}i.options.transition=void 0}function pH(i){Ex&&_g.totalNodes++,i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function mH(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function gH(i){i.clearSnapshot()}function sj(i){i.clearMeasurements()}function yH(i){i.isLayoutDirty=!1}function _H(i){const{visualElement:n}=i.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),i.resetTransform()}function oj(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function xH(i){i.resolveTargetDelta()}function vH(i){i.calcProjection()}function bH(i){i.resetSkewAndRotation()}function wH(i){i.removeLeadSnapshot()}function aj(i,n,a){i.translate=ko(n.translate,0,a),i.scale=ko(n.scale,1,a),i.origin=n.origin,i.originPoint=n.originPoint}function lj(i,n,a,d){i.min=ko(n.min,a.min,d),i.max=ko(n.max,a.max,d)}function SH(i,n,a,d){lj(i.x,n.x,a.x,d),lj(i.y,n.y,a.y,d)}function TH(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const EH={duration:.45,ease:[.4,0,.1,1]},cj=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),uj=cj("applewebkit/")&&!cj("chrome/")?Math.round:Xc;function dj(i){i.min=uj(i.min),i.max=uj(i.max)}function CH(i){dj(i.x),dj(i.y)}function LD(i,n,a){return i==="position"||i==="preserve-aspect"&&!PW(rj(n),rj(a),.2)}function AH(i){var n;return i!==i.root&&((n=i.scroll)===null||n===void 0?void 0:n.wasRoot)}const IH=MD({attachResizeListener:(i,n)=>Hx(i,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),OS={current:void 0},DD=MD({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!OS.current){const i=new IH({});i.mount(window),i.setOptions({layoutScroll:!0}),OS.current=i}return OS.current},resetTransform:(i,n)=>{i.style.transform=n!==void 0?n:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),PH={pan:{Feature:GW},drag:{Feature:qW,ProjectionNode:DD,MeasureLayout:ID}};function hj(i,n,a){const{props:d}=i;i.animationState&&d.whileHover&&i.animationState.setActive("whileHover",a==="Start");const y="onHover"+a,v=d[y];v&&so.postRender(()=>v(n,Ev(n)))}class kH extends wm{mount(){const{current:n}=this.node;n&&(this.unmount=Pq(n,a=>(hj(this.node,a,"Start"),d=>hj(this.node,d,"End"))))}unmount(){}}class NH extends wm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let n=!1;try{n=this.node.current.matches(":focus-visible")}catch{n=!0}!n||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Tv(Hx(this.node.current,"focus",()=>this.onFocus()),Hx(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function fj(i,n,a){const{props:d}=i;i.animationState&&d.whileTap&&i.animationState.setActive("whileTap",a==="Start");const y="onTap"+(a==="End"?"":a),v=d[y];v&&so.postRender(()=>v(n,Ev(n)))}class jH extends wm{mount(){const{current:n}=this.node;n&&(this.unmount=Rq(n,a=>(fj(this.node,a,"Start"),(d,{success:y})=>fj(this.node,d,y?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const BT=new WeakMap,zS=new WeakMap,RH=i=>{const n=BT.get(i.target);n&&n(i)},MH=i=>{i.forEach(RH)};function LH({root:i,...n}){const a=i||document;zS.has(a)||zS.set(a,{});const d=zS.get(a),y=JSON.stringify(n);return d[y]||(d[y]=new IntersectionObserver(MH,{root:i,...n})),d[y]}function DH(i,n,a){const d=LH(n);return BT.set(i,a),d.observe(i),()=>{BT.delete(i),d.unobserve(i)}}const OH={some:0,all:1};class zH extends wm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:n={}}=this.node.getProps(),{root:a,margin:d,amount:y="some",once:v}=n,C={root:a?a.current:void 0,rootMargin:d,threshold:typeof y=="number"?y:OH[y]},s=M=>{const{isIntersecting:L}=M;if(this.isInView===L||(this.isInView=L,v&&!L&&this.hasEnteredView))return;L&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",L);const{onViewportEnter:F,onViewportLeave:W}=this.node.getProps(),X=L?F:W;X&&X(M)};return DH(this.node.current,C,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:n,prevProps:a}=this.node;["amount","margin","root"].some(FH(n,a))&&this.startObserver()}unmount(){}}function FH({viewport:i={}},{viewport:n={}}={}){return a=>i[a]!==n[a]}const BH={inView:{Feature:zH},tap:{Feature:jH},focus:{Feature:NH},hover:{Feature:kH}},VH={layout:{ProjectionNode:DD,MeasureLayout:ID}},VT={current:null},OD={current:!1};function UH(){if(OD.current=!0,!!O2)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),n=()=>VT.current=i.matches;i.addListener(n),n()}else VT.current=!1}const $H=[...lD,Tl,mm],qH=i=>$H.find(aD(i)),pj=new WeakMap;function GH(i,n,a){for(const d in n){const y=n[d],v=a[d];if(El(y))i.addValue(d,y);else if(El(v))i.addValue(d,Gx(y,{owner:i}));else if(v!==y)if(i.hasValue(d)){const C=i.getValue(d);C.liveStyle===!0?C.jump(y):C.hasAnimated||C.set(y)}else{const C=i.getStaticValue(d);i.addValue(d,Gx(C!==void 0?C:y,{owner:i}))}}for(const d in a)n[d]===void 0&&i.removeValue(d);return n}const mj=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class WH{scrapeMotionValuesFromProps(n,a,d){return{}}constructor({parent:n,props:a,presenceContext:d,reducedMotionConfig:y,blockInitialAnimation:v,visualState:C},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=uE,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const ee=Rh.now();this.renderScheduledAt<ee&&(this.renderScheduledAt=ee,so.render(this.render,!1,!0))};const{latestValues:M,renderState:L,onUpdate:F}=C;this.onUpdate=F,this.latestValues=M,this.baseTarget={...M},this.initialValues=a.initial?{...M}:{},this.renderState=L,this.parent=n,this.props=a,this.presenceContext=d,this.depth=n?n.depth+1:0,this.reducedMotionConfig=y,this.options=s,this.blockInitialAnimation=!!v,this.isControllingVariants=fw(a),this.isVariantNode=gL(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(n&&n.current);const{willChange:W,...X}=this.scrapeMotionValuesFromProps(a,{},this);for(const ee in X){const he=X[ee];M[ee]!==void 0&&El(he)&&he.set(M[ee],!1)}}mount(n){this.current=n,pj.set(n,this),this.projection&&!this.projection.instance&&this.projection.mount(n),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,d)=>this.bindToMotionValue(d,a)),OD.current||UH(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:VT.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){pj.delete(this.current),this.projection&&this.projection.unmount(),pm(this.notifyUpdate),pm(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const a=this.features[n];a&&(a.unmount(),a.isMounted=!1)}this.current=null}bindToMotionValue(n,a){this.valueSubscriptions.has(n)&&this.valueSubscriptions.get(n)();const d=Mg.has(n),y=a.on("change",s=>{this.latestValues[n]=s,this.props.onUpdate&&so.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0)}),v=a.on("renderRequest",this.scheduleRender);let C;window.MotionCheckAppearSync&&(C=window.MotionCheckAppearSync(this,n,a)),this.valueSubscriptions.set(n,()=>{y(),v(),C&&C(),a.owner&&a.stop()})}sortNodePosition(n){return!this.current||!this.sortInstanceNodePosition||this.type!==n.type?0:this.sortInstanceNodePosition(this.current,n.current)}updateFeatures(){let n="animation";for(n in s_){const a=s_[n];if(!a)continue;const{isEnabled:d,Feature:y}=a;if(!this.features[n]&&y&&d(this.props)&&(this.features[n]=new y(this)),this.features[n]){const v=this.features[n];v.isMounted?v.update():(v.mount(),v.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Qo()}getStaticValue(n){return this.latestValues[n]}setStaticValue(n,a){this.latestValues[n]=a}update(n,a){(n.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=n,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let d=0;d<mj.length;d++){const y=mj[d];this.propEventSubscriptions[y]&&(this.propEventSubscriptions[y](),delete this.propEventSubscriptions[y]);const v="on"+y,C=n[v];C&&(this.propEventSubscriptions[y]=this.on(y,C))}this.prevMotionValues=GH(this,this.scrapeMotionValuesFromProps(n,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(n){return this.props.variants?this.props.variants[n]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(n){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(n),()=>a.variantChildren.delete(n)}addValue(n,a){const d=this.values.get(n);a!==d&&(d&&this.removeValue(n),this.bindToMotionValue(n,a),this.values.set(n,a),this.latestValues[n]=a.get())}removeValue(n){this.values.delete(n);const a=this.valueSubscriptions.get(n);a&&(a(),this.valueSubscriptions.delete(n)),delete this.latestValues[n],this.removeValueFromRenderState(n,this.renderState)}hasValue(n){return this.values.has(n)}getValue(n,a){if(this.props.values&&this.props.values[n])return this.props.values[n];let d=this.values.get(n);return d===void 0&&a!==void 0&&(d=Gx(a===null?void 0:a,{owner:this}),this.addValue(n,d)),d}readValue(n,a){var d;let y=this.latestValues[n]!==void 0||!this.current?this.latestValues[n]:(d=this.getBaseTargetFromProps(this.props,n))!==null&&d!==void 0?d:this.readValueFromInstance(this.current,n,this.options);return y!=null&&(typeof y=="string"&&(sD(y)||KL(y))?y=parseFloat(y):!qH(y)&&mm.test(a)&&(y=rD(n,a)),this.setBaseTarget(n,El(y)?y.get():y)),El(y)?y.get():y}setBaseTarget(n,a){this.baseTarget[n]=a}getBaseTarget(n){var a;const{initial:d}=this.props;let y;if(typeof d=="string"||typeof d=="object"){const C=q2(this.props,d,(a=this.presenceContext)===null||a===void 0?void 0:a.custom);C&&(y=C[n])}if(d&&y!==void 0)return y;const v=this.getBaseTargetFromProps(this.props,n);return v!==void 0&&!El(v)?v:this.initialValues[n]!==void 0&&y===void 0?void 0:this.baseTarget[n]}on(n,a){return this.events[n]||(this.events[n]=new iE),this.events[n].add(a)}notify(n,...a){this.events[n]&&this.events[n].notify(...a)}}class zD extends WH{constructor(){super(...arguments),this.KeyframeResolver=cD}sortInstanceNodePosition(n,a){return n.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(n,a){return n.style?n.style[a]:void 0}removeValueFromRenderState(n,{vars:a,style:d}){delete a[n],delete d[n]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:n}=this.props;El(n)&&(this.childSubscription=n.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function HH(i){return window.getComputedStyle(i)}class ZH extends zD{constructor(){super(...arguments),this.type="html",this.renderInstance=EL}readValueFromInstance(n,a){if(Mg.has(a)){const d=cE(a);return d&&d.default||0}else{const d=HH(n),y=(wL(a)?d.getPropertyValue(a):d[a])||0;return typeof y=="string"?y.trim():y}}measureInstanceViewportBox(n,{transformPagePoint:a}){return CD(n,a)}build(n,a,d){H2(n,a,d.transformTemplate)}scrapeMotionValuesFromProps(n,a,d){return Y2(n,a,d)}}class XH extends zD{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Qo}getBaseTargetFromProps(n,a){return n[a]}readValueFromInstance(n,a){if(Mg.has(a)){const d=cE(a);return d&&d.default||0}return a=CL.has(a)?a:V2(a),n.getAttribute(a)}scrapeMotionValuesFromProps(n,a,d){return PL(n,a,d)}build(n,a,d){Z2(n,a,this.isSVGTag,d.transformTemplate)}renderInstance(n,a,d,y){AL(n,a,d,y)}mount(n){this.isSVGTag=K2(n.tagName),super.mount(n)}}const KH=(i,n)=>$2(i)?new XH(n):new ZH(n,{allowProjection:i!==$.Fragment}),YH=wq({...vW,...BH,...PH,...VH},KH),Jn=O8(YH);var UT=function(i,n){return UT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var y in d)Object.prototype.hasOwnProperty.call(d,y)&&(a[y]=d[y])},UT(i,n)};function FD(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");UT(i,n);function a(){this.constructor=i}i.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}var Ru=function(){return Ru=Object.assign||function(n){for(var a,d=1,y=arguments.length;d<y;d++){a=arguments[d];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(n[v]=a[v])}return n},Ru.apply(this,arguments)};function Sm(i,n){var a={};for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&n.indexOf(d)<0&&(a[d]=i[d]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,d=Object.getOwnPropertySymbols(i);y<d.length;y++)n.indexOf(d[y])<0&&Object.prototype.propertyIsEnumerable.call(i,d[y])&&(a[d[y]]=i[d[y]]);return a}function BD(i,n,a,d){var y=arguments.length,v=y<3?n:d===null?d=Object.getOwnPropertyDescriptor(n,a):d,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(i,n,a,d);else for(var s=i.length-1;s>=0;s--)(C=i[s])&&(v=(y<3?C(v):y>3?C(n,a,v):C(n,a))||v);return y>3&&v&&Object.defineProperty(n,a,v),v}function VD(i,n){return function(a,d){n(a,d,i)}}function UD(i,n,a,d,y,v){function C(ve){if(ve!==void 0&&typeof ve!="function")throw new TypeError("Function expected");return ve}for(var s=d.kind,M=s==="getter"?"get":s==="setter"?"set":"value",L=!n&&i?d.static?i:i.prototype:null,F=n||(L?Object.getOwnPropertyDescriptor(L,d.name):{}),W,X=!1,ee=a.length-1;ee>=0;ee--){var he={};for(var se in d)he[se]=se==="access"?{}:d[se];for(var se in d.access)he.access[se]=d.access[se];he.addInitializer=function(ve){if(X)throw new TypeError("Cannot add initializers after decoration has completed");v.push(C(ve||null))};var oe=(0,a[ee])(s==="accessor"?{get:F.get,set:F.set}:F[M],he);if(s==="accessor"){if(oe===void 0)continue;if(oe===null||typeof oe!="object")throw new TypeError("Object expected");(W=C(oe.get))&&(F.get=W),(W=C(oe.set))&&(F.set=W),(W=C(oe.init))&&y.unshift(W)}else(W=C(oe))&&(s==="field"?y.unshift(W):F[M]=W)}L&&Object.defineProperty(L,d.name,F),X=!0}function $D(i,n,a){for(var d=arguments.length>2,y=0;y<n.length;y++)a=d?n[y].call(i,a):n[y].call(i);return d?a:void 0}function qD(i){return typeof i=="symbol"?i:"".concat(i)}function GD(i,n,a){return typeof n=="symbol"&&(n=n.description?"[".concat(n.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:a?"".concat(a," ",n):n})}function WD(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)}function Rn(i,n,a,d){function y(v){return v instanceof a?v:new a(function(C){C(v)})}return new(a||(a=Promise))(function(v,C){function s(F){try{L(d.next(F))}catch(W){C(W)}}function M(F){try{L(d.throw(F))}catch(W){C(W)}}function L(F){F.done?v(F.value):y(F.value).then(s,M)}L((d=d.apply(i,n||[])).next())})}function HD(i,n){var a={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},d,y,v,C=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return C.next=s(0),C.throw=s(1),C.return=s(2),typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function s(L){return function(F){return M([L,F])}}function M(L){if(d)throw new TypeError("Generator is already executing.");for(;C&&(C=0,L[0]&&(a=0)),a;)try{if(d=1,y&&(v=L[0]&2?y.return:L[0]?y.throw||((v=y.return)&&v.call(y),0):y.next)&&!(v=v.call(y,L[1])).done)return v;switch(y=0,v&&(L=[L[0]&2,v.value]),L[0]){case 0:case 1:v=L;break;case 4:return a.label++,{value:L[1],done:!1};case 5:a.label++,y=L[1],L=[0];continue;case 7:L=a.ops.pop(),a.trys.pop();continue;default:if(v=a.trys,!(v=v.length>0&&v[v.length-1])&&(L[0]===6||L[0]===2)){a=0;continue}if(L[0]===3&&(!v||L[1]>v[0]&&L[1]<v[3])){a.label=L[1];break}if(L[0]===6&&a.label<v[1]){a.label=v[1],v=L;break}if(v&&a.label<v[2]){a.label=v[2],a.ops.push(L);break}v[2]&&a.ops.pop(),a.trys.pop();continue}L=n.call(i,a)}catch(F){L=[6,F],y=0}finally{d=v=0}if(L[0]&5)throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}}var gw=Object.create?(function(i,n,a,d){d===void 0&&(d=a);var y=Object.getOwnPropertyDescriptor(n,a);(!y||("get"in y?!n.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return n[a]}}),Object.defineProperty(i,d,y)}):(function(i,n,a,d){d===void 0&&(d=a),i[d]=n[a]});function ZD(i,n){for(var a in i)a!=="default"&&!Object.prototype.hasOwnProperty.call(n,a)&&gw(n,i,a)}function I0(i){var n=typeof Symbol=="function"&&Symbol.iterator,a=n&&i[n],d=0;if(a)return a.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&d>=i.length&&(i=void 0),{value:i&&i[d++],done:!i}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function pE(i,n){var a=typeof Symbol=="function"&&i[Symbol.iterator];if(!a)return i;var d=a.call(i),y,v=[],C;try{for(;(n===void 0||n-- >0)&&!(y=d.next()).done;)v.push(y.value)}catch(s){C={error:s}}finally{try{y&&!y.done&&(a=d.return)&&a.call(d)}finally{if(C)throw C.error}}return v}function XD(){for(var i=[],n=0;n<arguments.length;n++)i=i.concat(pE(arguments[n]));return i}function KD(){for(var i=0,n=0,a=arguments.length;n<a;n++)i+=arguments[n].length;for(var d=Array(i),y=0,n=0;n<a;n++)for(var v=arguments[n],C=0,s=v.length;C<s;C++,y++)d[y]=v[C];return d}function mE(i,n,a){if(a||arguments.length===2)for(var d=0,y=n.length,v;d<y;d++)(v||!(d in n))&&(v||(v=Array.prototype.slice.call(n,0,d)),v[d]=n[d]);return i.concat(v||Array.prototype.slice.call(n))}function a_(i){return this instanceof a_?(this.v=i,this):new a_(i)}function YD(i,n,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=a.apply(i,n||[]),y,v=[];return y=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",C),y[Symbol.asyncIterator]=function(){return this},y;function C(ee){return function(he){return Promise.resolve(he).then(ee,W)}}function s(ee,he){d[ee]&&(y[ee]=function(se){return new Promise(function(oe,ve){v.push([ee,se,oe,ve])>1||M(ee,se)})},he&&(y[ee]=he(y[ee])))}function M(ee,he){try{L(d[ee](he))}catch(se){X(v[0][3],se)}}function L(ee){ee.value instanceof a_?Promise.resolve(ee.value.v).then(F,W):X(v[0][2],ee)}function F(ee){M("next",ee)}function W(ee){M("throw",ee)}function X(ee,he){ee(he),v.shift(),v.length&&M(v[0][0],v[0][1])}}function QD(i){var n,a;return n={},d("next"),d("throw",function(y){throw y}),d("return"),n[Symbol.iterator]=function(){return this},n;function d(y,v){n[y]=i[y]?function(C){return(a=!a)?{value:a_(i[y](C)),done:!1}:v?v(C):C}:v}}function JD(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=i[Symbol.asyncIterator],a;return n?n.call(i):(i=typeof I0=="function"?I0(i):i[Symbol.iterator](),a={},d("next"),d("throw"),d("return"),a[Symbol.asyncIterator]=function(){return this},a);function d(v){a[v]=i[v]&&function(C){return new Promise(function(s,M){C=i[v](C),y(s,M,C.done,C.value)})}}function y(v,C,s,M){Promise.resolve(M).then(function(L){v({value:L,done:s})},C)}}function eO(i,n){return Object.defineProperty?Object.defineProperty(i,"raw",{value:n}):i.raw=n,i}var QH=Object.create?(function(i,n){Object.defineProperty(i,"default",{enumerable:!0,value:n})}):function(i,n){i.default=n},$T=function(i){return $T=Object.getOwnPropertyNames||function(n){var a=[];for(var d in n)Object.prototype.hasOwnProperty.call(n,d)&&(a[a.length]=d);return a},$T(i)};function tO(i){if(i&&i.__esModule)return i;var n={};if(i!=null)for(var a=$T(i),d=0;d<a.length;d++)a[d]!=="default"&&gw(n,i,a[d]);return QH(n,i),n}function rO(i){return i&&i.__esModule?i:{default:i}}function nO(i,n,a,d){if(a==="a"&&!d)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?i!==n||!d:!n.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?d:a==="a"?d.call(i):d?d.value:n.get(i)}function iO(i,n,a,d,y){if(d==="m")throw new TypeError("Private method is not writable");if(d==="a"&&!y)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?i!==n||!y:!n.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return d==="a"?y.call(i,a):y?y.value=a:n.set(i,a),a}function sO(i,n){if(n===null||typeof n!="object"&&typeof n!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof i=="function"?n===i:i.has(n)}function oO(i,n,a){if(n!=null){if(typeof n!="object"&&typeof n!="function")throw new TypeError("Object expected.");var d,y;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");d=n[Symbol.asyncDispose]}if(d===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");d=n[Symbol.dispose],a&&(y=d)}if(typeof d!="function")throw new TypeError("Object not disposable.");y&&(d=function(){try{y.call(this)}catch(v){return Promise.reject(v)}}),i.stack.push({value:n,dispose:d,async:a})}else a&&i.stack.push({async:!0});return n}var JH=typeof SuppressedError=="function"?SuppressedError:function(i,n,a){var d=new Error(a);return d.name="SuppressedError",d.error=i,d.suppressed=n,d};function aO(i){function n(v){i.error=i.hasError?new JH(v,i.error,"An error was suppressed during disposal."):v,i.hasError=!0}var a,d=0;function y(){for(;a=i.stack.pop();)try{if(!a.async&&d===1)return d=0,i.stack.push(a),Promise.resolve().then(y);if(a.dispose){var v=a.dispose.call(a.value);if(a.async)return d|=2,Promise.resolve(v).then(y,function(C){return n(C),y()})}else d|=1}catch(C){n(C)}if(d===1)return i.hasError?Promise.reject(i.error):Promise.resolve();if(i.hasError)throw i.error}return y()}function lO(i,n){return typeof i=="string"&&/^\.\.?\//.test(i)?i.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(a,d,y,v,C){return d?n?".jsx":".js":y&&(!v||!C)?a:y+v+"."+C.toLowerCase()+"js"}):i}const e9={__extends:FD,__assign:Ru,__rest:Sm,__decorate:BD,__param:VD,__esDecorate:UD,__runInitializers:$D,__propKey:qD,__setFunctionName:GD,__metadata:WD,__awaiter:Rn,__generator:HD,__createBinding:gw,__exportStar:ZD,__values:I0,__read:pE,__spread:XD,__spreadArrays:KD,__spreadArray:mE,__await:a_,__asyncGenerator:YD,__asyncDelegator:QD,__asyncValues:JD,__makeTemplateObject:eO,__importStar:tO,__importDefault:rO,__classPrivateFieldGet:nO,__classPrivateFieldSet:iO,__classPrivateFieldIn:sO,__addDisposableResource:oO,__disposeResources:aO,__rewriteRelativeImportExtension:lO},t9=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:oO,get __assign(){return Ru},__asyncDelegator:QD,__asyncGenerator:YD,__asyncValues:JD,__await:a_,__awaiter:Rn,__classPrivateFieldGet:nO,__classPrivateFieldIn:sO,__classPrivateFieldSet:iO,__createBinding:gw,__decorate:BD,__disposeResources:aO,__esDecorate:UD,__exportStar:ZD,__extends:FD,__generator:HD,__importDefault:rO,__importStar:tO,__makeTemplateObject:eO,__metadata:WD,__param:VD,__propKey:qD,__read:pE,__rest:Sm,__rewriteRelativeImportExtension:lO,__runInitializers:$D,__setFunctionName:GD,__spread:XD,__spreadArray:mE,__spreadArrays:KD,__values:I0,default:e9},Symbol.toStringTag,{value:"Module"})),r9="modulepreload",n9=function(i){return"/"+i},gj={},y_=function(n,a,d){let y=Promise.resolve();if(a&&a.length>0){let L=function(F){return Promise.all(F.map(W=>Promise.resolve(W).then(X=>({status:"fulfilled",value:X}),X=>({status:"rejected",reason:X}))))};var C=L;document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),M=s?.nonce||s?.getAttribute("nonce");y=L(a.map(F=>{if(F=n9(F),F in gj)return;gj[F]=!0;const W=F.endsWith(".css"),X=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${F}"]${X}`))return;const ee=document.createElement("link");if(ee.rel=W?"stylesheet":r9,W||(ee.as="script"),ee.crossOrigin="",ee.href=F,M&&ee.setAttribute("nonce",M),document.head.appendChild(ee),W)return new Promise((he,se)=>{ee.addEventListener("load",he),ee.addEventListener("error",()=>se(new Error(`Unable to preload CSS for ${F}`)))})}))}function v(s){const M=new Event("vite:preloadError",{cancelable:!0});if(M.payload=s,window.dispatchEvent(M),!M.defaultPrevented)throw s}return y.then(s=>{for(const M of s||[])M.status==="rejected"&&v(M.reason);return n().catch(v)})},i9=i=>{let n;return i?n=i:typeof fetch>"u"?n=(...a)=>y_(async()=>{const{default:d}=await Promise.resolve().then(()=>Lg);return{default:d}},void 0).then(({default:d})=>d(...a)):n=fetch,(...a)=>n(...a)};class gE extends Error{constructor(n,a="FunctionsError",d){super(n),this.name=a,this.context=d}}class yj extends gE{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class _j extends gE{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class xj extends gE{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var qT;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(qT||(qT={}));class s9{constructor(n,{headers:a={},customFetch:d,region:y=qT.Any}={}){this.url=n,this.headers=a,this.region=y,this.fetch=i9(d)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n){return Rn(this,arguments,void 0,function*(a,d={}){var y;try{const{headers:v,method:C,body:s,signal:M}=d;let L={},{region:F}=d;F||(F=this.region);const W=new URL(`${this.url}/${a}`);F&&F!=="any"&&(L["x-region"]=F,W.searchParams.set("forceFunctionRegion",F));let X;s&&(v&&!Object.prototype.hasOwnProperty.call(v,"Content-Type")||!v)?typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(L["Content-Type"]="application/octet-stream",X=s):typeof s=="string"?(L["Content-Type"]="text/plain",X=s):typeof FormData<"u"&&s instanceof FormData?X=s:(L["Content-Type"]="application/json",X=JSON.stringify(s)):X=s;const ee=yield this.fetch(W.toString(),{method:C||"POST",headers:Object.assign(Object.assign(Object.assign({},L),this.headers),v),body:X,signal:M}).catch(ve=>{throw ve.name==="AbortError"?ve:new yj(ve)}),he=ee.headers.get("x-relay-error");if(he&&he==="true")throw new _j(ee);if(!ee.ok)throw new xj(ee);let se=((y=ee.headers.get("Content-Type"))!==null&&y!==void 0?y:"text/plain").split(";")[0].trim(),oe;return se==="application/json"?oe=yield ee.json():se==="application/octet-stream"||se==="application/pdf"?oe=yield ee.blob():se==="text/event-stream"?oe=ee:se==="multipart/form-data"?oe=yield ee.formData():oe=yield ee.text(),{data:oe,error:null,response:ee}}catch(v){return v instanceof Error&&v.name==="AbortError"?{data:null,error:new yj(v)}:{data:null,error:v,response:v instanceof xj||v instanceof _j?v.context:void 0}}})}}var wl={};const __=YR(t9);var Ub={},$b={},qb={},Gb={},Wb={},o9=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},l_=o9();const a9=l_.fetch,cO=l_.fetch.bind(l_),uO=l_.Headers,l9=l_.Request,c9=l_.Response,Lg=Object.freeze(Object.defineProperty({__proto__:null,Headers:uO,Request:l9,Response:c9,default:cO,fetch:a9},Symbol.toStringTag,{value:"Module"})),u9=YR(Lg);var Hb={},vj;function dO(){if(vj)return Hb;vj=1,Object.defineProperty(Hb,"__esModule",{value:!0});class i extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}return Hb.default=i,Hb}var bj;function hO(){if(bj)return Wb;bj=1,Object.defineProperty(Wb,"__esModule",{value:!0});const i=__,n=i.__importDefault(u9),a=i.__importDefault(dO());class d{constructor(v){var C,s;this.shouldThrowOnError=!1,this.method=v.method,this.url=v.url,this.headers=new Headers(v.headers),this.schema=v.schema,this.body=v.body,this.shouldThrowOnError=(C=v.shouldThrowOnError)!==null&&C!==void 0?C:!1,this.signal=v.signal,this.isMaybeSingle=(s=v.isMaybeSingle)!==null&&s!==void 0?s:!1,v.fetch?this.fetch=v.fetch:typeof fetch>"u"?this.fetch=n.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(v,C){return this.headers=new Headers(this.headers),this.headers.set(v,C),this}then(v,C){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let M=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async L=>{var F,W,X,ee;let he=null,se=null,oe=null,ve=L.status,me=L.statusText;if(L.ok){if(this.method!=="HEAD"){const rt=await L.text();rt===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((F=this.headers.get("Accept"))===null||F===void 0)&&F.includes("application/vnd.pgrst.plan+text"))?se=rt:se=JSON.parse(rt))}const Re=(W=this.headers.get("Prefer"))===null||W===void 0?void 0:W.match(/count=(exact|planned|estimated)/),Be=(X=L.headers.get("content-range"))===null||X===void 0?void 0:X.split("/");Re&&Be&&Be.length>1&&(oe=parseInt(Be[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(se)&&(se.length>1?(he={code:"PGRST116",details:`Results contain ${se.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},se=null,oe=null,ve=406,me="Not Acceptable"):se.length===1?se=se[0]:se=null)}else{const Re=await L.text();try{he=JSON.parse(Re),Array.isArray(he)&&L.status===404&&(se=[],he=null,ve=200,me="OK")}catch{L.status===404&&Re===""?(ve=204,me="No Content"):he={message:Re}}if(he&&this.isMaybeSingle&&(!((ee=he?.details)===null||ee===void 0)&&ee.includes("0 rows"))&&(he=null,ve=200,me="OK"),he&&this.shouldThrowOnError)throw new a.default(he)}return{error:he,data:se,count:oe,status:ve,statusText:me}});return this.shouldThrowOnError||(M=M.catch(L=>{var F,W,X;return{error:{message:`${(F=L?.name)!==null&&F!==void 0?F:"FetchError"}: ${L?.message}`,details:`${(W=L?.stack)!==null&&W!==void 0?W:""}`,hint:"",code:`${(X=L?.code)!==null&&X!==void 0?X:""}`},data:null,count:null,status:0,statusText:""}})),M.then(v,C)}returns(){return this}overrideTypes(){return this}}return Wb.default=d,Wb}var wj;function fO(){if(wj)return Gb;wj=1,Object.defineProperty(Gb,"__esModule",{value:!0});const n=__.__importDefault(hO());class a extends n.default{select(y){let v=!1;const C=(y??"*").split("").map(s=>/\s/.test(s)&&!v?"":(s==='"'&&(v=!v),s)).join("");return this.url.searchParams.set("select",C),this.headers.append("Prefer","return=representation"),this}order(y,{ascending:v=!0,nullsFirst:C,foreignTable:s,referencedTable:M=s}={}){const L=M?`${M}.order`:"order",F=this.url.searchParams.get(L);return this.url.searchParams.set(L,`${F?`${F},`:""}${y}.${v?"asc":"desc"}${C===void 0?"":C?".nullsfirst":".nullslast"}`),this}limit(y,{foreignTable:v,referencedTable:C=v}={}){const s=typeof C>"u"?"limit":`${C}.limit`;return this.url.searchParams.set(s,`${y}`),this}range(y,v,{foreignTable:C,referencedTable:s=C}={}){const M=typeof s>"u"?"offset":`${s}.offset`,L=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(M,`${y}`),this.url.searchParams.set(L,`${v-y+1}`),this}abortSignal(y){return this.signal=y,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:y=!1,verbose:v=!1,settings:C=!1,buffers:s=!1,wal:M=!1,format:L="text"}={}){var F;const W=[y?"analyze":null,v?"verbose":null,C?"settings":null,s?"buffers":null,M?"wal":null].filter(Boolean).join("|"),X=(F=this.headers.get("Accept"))!==null&&F!==void 0?F:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${L}; for="${X}"; options=${W};`),L==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(y){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${y}`),this}}return Gb.default=a,Gb}var Sj;function yE(){if(Sj)return qb;Sj=1,Object.defineProperty(qb,"__esModule",{value:!0});const n=__.__importDefault(fO()),a=new RegExp("[,()]");class d extends n.default{eq(v,C){return this.url.searchParams.append(v,`eq.${C}`),this}neq(v,C){return this.url.searchParams.append(v,`neq.${C}`),this}gt(v,C){return this.url.searchParams.append(v,`gt.${C}`),this}gte(v,C){return this.url.searchParams.append(v,`gte.${C}`),this}lt(v,C){return this.url.searchParams.append(v,`lt.${C}`),this}lte(v,C){return this.url.searchParams.append(v,`lte.${C}`),this}like(v,C){return this.url.searchParams.append(v,`like.${C}`),this}likeAllOf(v,C){return this.url.searchParams.append(v,`like(all).{${C.join(",")}}`),this}likeAnyOf(v,C){return this.url.searchParams.append(v,`like(any).{${C.join(",")}}`),this}ilike(v,C){return this.url.searchParams.append(v,`ilike.${C}`),this}ilikeAllOf(v,C){return this.url.searchParams.append(v,`ilike(all).{${C.join(",")}}`),this}ilikeAnyOf(v,C){return this.url.searchParams.append(v,`ilike(any).{${C.join(",")}}`),this}is(v,C){return this.url.searchParams.append(v,`is.${C}`),this}in(v,C){const s=Array.from(new Set(C)).map(M=>typeof M=="string"&&a.test(M)?`"${M}"`:`${M}`).join(",");return this.url.searchParams.append(v,`in.(${s})`),this}contains(v,C){return typeof C=="string"?this.url.searchParams.append(v,`cs.${C}`):Array.isArray(C)?this.url.searchParams.append(v,`cs.{${C.join(",")}}`):this.url.searchParams.append(v,`cs.${JSON.stringify(C)}`),this}containedBy(v,C){return typeof C=="string"?this.url.searchParams.append(v,`cd.${C}`):Array.isArray(C)?this.url.searchParams.append(v,`cd.{${C.join(",")}}`):this.url.searchParams.append(v,`cd.${JSON.stringify(C)}`),this}rangeGt(v,C){return this.url.searchParams.append(v,`sr.${C}`),this}rangeGte(v,C){return this.url.searchParams.append(v,`nxl.${C}`),this}rangeLt(v,C){return this.url.searchParams.append(v,`sl.${C}`),this}rangeLte(v,C){return this.url.searchParams.append(v,`nxr.${C}`),this}rangeAdjacent(v,C){return this.url.searchParams.append(v,`adj.${C}`),this}overlaps(v,C){return typeof C=="string"?this.url.searchParams.append(v,`ov.${C}`):this.url.searchParams.append(v,`ov.{${C.join(",")}}`),this}textSearch(v,C,{config:s,type:M}={}){let L="";M==="plain"?L="pl":M==="phrase"?L="ph":M==="websearch"&&(L="w");const F=s===void 0?"":`(${s})`;return this.url.searchParams.append(v,`${L}fts${F}.${C}`),this}match(v){return Object.entries(v).forEach(([C,s])=>{this.url.searchParams.append(C,`eq.${s}`)}),this}not(v,C,s){return this.url.searchParams.append(v,`not.${C}.${s}`),this}or(v,{foreignTable:C,referencedTable:s=C}={}){const M=s?`${s}.or`:"or";return this.url.searchParams.append(M,`(${v})`),this}filter(v,C,s){return this.url.searchParams.append(v,`${C}.${s}`),this}}return qb.default=d,qb}var Tj;function pO(){if(Tj)return $b;Tj=1,Object.defineProperty($b,"__esModule",{value:!0});const n=__.__importDefault(yE());class a{constructor(y,{headers:v={},schema:C,fetch:s}){this.url=y,this.headers=new Headers(v),this.schema=C,this.fetch=s}select(y,v){const{head:C=!1,count:s}=v??{},M=C?"HEAD":"GET";let L=!1;const F=(y??"*").split("").map(W=>/\s/.test(W)&&!L?"":(W==='"'&&(L=!L),W)).join("");return this.url.searchParams.set("select",F),s&&this.headers.append("Prefer",`count=${s}`),new n.default({method:M,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(y,{count:v,defaultToNull:C=!0}={}){var s;const M="POST";if(v&&this.headers.append("Prefer",`count=${v}`),C||this.headers.append("Prefer","missing=default"),Array.isArray(y)){const L=y.reduce((F,W)=>F.concat(Object.keys(W)),[]);if(L.length>0){const F=[...new Set(L)].map(W=>`"${W}"`);this.url.searchParams.set("columns",F.join(","))}}return new n.default({method:M,url:this.url,headers:this.headers,schema:this.schema,body:y,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(y,{onConflict:v,ignoreDuplicates:C=!1,count:s,defaultToNull:M=!0}={}){var L;const F="POST";if(this.headers.append("Prefer",`resolution=${C?"ignore":"merge"}-duplicates`),v!==void 0&&this.url.searchParams.set("on_conflict",v),s&&this.headers.append("Prefer",`count=${s}`),M||this.headers.append("Prefer","missing=default"),Array.isArray(y)){const W=y.reduce((X,ee)=>X.concat(Object.keys(ee)),[]);if(W.length>0){const X=[...new Set(W)].map(ee=>`"${ee}"`);this.url.searchParams.set("columns",X.join(","))}}return new n.default({method:F,url:this.url,headers:this.headers,schema:this.schema,body:y,fetch:(L=this.fetch)!==null&&L!==void 0?L:fetch})}update(y,{count:v}={}){var C;const s="PATCH";return v&&this.headers.append("Prefer",`count=${v}`),new n.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:y,fetch:(C=this.fetch)!==null&&C!==void 0?C:fetch})}delete({count:y}={}){var v;const C="DELETE";return y&&this.headers.append("Prefer",`count=${y}`),new n.default({method:C,url:this.url,headers:this.headers,schema:this.schema,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}}return $b.default=a,$b}var Ej;function d9(){if(Ej)return Ub;Ej=1,Object.defineProperty(Ub,"__esModule",{value:!0});const i=__,n=i.__importDefault(pO()),a=i.__importDefault(yE());class d{constructor(v,{headers:C={},schema:s,fetch:M}={}){this.url=v,this.headers=new Headers(C),this.schemaName=s,this.fetch=M}from(v){const C=new URL(`${this.url}/${v}`);return new n.default(C,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(v){return new d(this.url,{headers:this.headers,schema:v,fetch:this.fetch})}rpc(v,C={},{head:s=!1,get:M=!1,count:L}={}){var F;let W;const X=new URL(`${this.url}/rpc/${v}`);let ee;s||M?(W=s?"HEAD":"GET",Object.entries(C).filter(([se,oe])=>oe!==void 0).map(([se,oe])=>[se,Array.isArray(oe)?`{${oe.join(",")}}`:`${oe}`]).forEach(([se,oe])=>{X.searchParams.append(se,oe)})):(W="POST",ee=C);const he=new Headers(this.headers);return L&&he.set("Prefer",`count=${L}`),new a.default({method:W,url:X,headers:he,schema:this.schemaName,body:ee,fetch:(F=this.fetch)!==null&&F!==void 0?F:fetch})}}return Ub.default=d,Ub}var Cj;function h9(){if(Cj)return wl;Cj=1,Object.defineProperty(wl,"__esModule",{value:!0}),wl.PostgrestError=wl.PostgrestBuilder=wl.PostgrestTransformBuilder=wl.PostgrestFilterBuilder=wl.PostgrestQueryBuilder=wl.PostgrestClient=void 0;const i=__,n=i.__importDefault(d9());wl.PostgrestClient=n.default;const a=i.__importDefault(pO());wl.PostgrestQueryBuilder=a.default;const d=i.__importDefault(yE());wl.PostgrestFilterBuilder=d.default;const y=i.__importDefault(fO());wl.PostgrestTransformBuilder=y.default;const v=i.__importDefault(hO());wl.PostgrestBuilder=v.default;const C=i.__importDefault(dO());return wl.PostgrestError=C.default,wl.default={PostgrestClient:n.default,PostgrestQueryBuilder:a.default,PostgrestFilterBuilder:d.default,PostgrestTransformBuilder:y.default,PostgrestBuilder:v.default,PostgrestError:C.default},wl}var mO=h9();const gO=J0(mO),f9=KR({__proto__:null,default:gO},[mO]),{PostgrestClient:p9,PostgrestQueryBuilder:zie,PostgrestFilterBuilder:Fie,PostgrestTransformBuilder:Bie,PostgrestBuilder:Vie,PostgrestError:Uie}=gO||f9;class m9{static detectEnvironment(){var n;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((n=navigator.userAgent)===null||n===void 0)&&n.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const a=process.versions;if(a&&a.node){const d=a.node,y=parseInt(d.replace(/^v/,"").split(".")[0]);return y>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${y} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${y} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const n=this.detectEnvironment();if(n.constructor)return n.constructor;let a=n.error||"WebSocket not supported in this environment.";throw n.workaround&&(a+=`

Suggested solution: ${n.workaround}`),new Error(a)}static createWebSocket(n,a){const d=this.getWebSocketConstructor();return new d(n,a)}static isWebSocketSupported(){try{const n=this.detectEnvironment();return n.type==="native"||n.type==="ws"}catch{return!1}}}const g9="2.78.0",y9=`realtime-js/${g9}`,_9="1.0.0",GT=1e4,x9=1e3,v9=100;var Rx;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Rx||(Rx={}));var ja;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(ja||(ja={}));var wd;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(wd||(wd={}));var WT;(function(i){i.websocket="websocket"})(WT||(WT={}));var vg;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(vg||(vg={}));class b9{constructor(){this.HEADER_LENGTH=1}decode(n,a){return n.constructor===ArrayBuffer?a(this._binaryDecode(n)):a(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const a=new DataView(n),d=new TextDecoder;return this._decodeBroadcast(n,a,d)}_decodeBroadcast(n,a,d){const y=a.getUint8(1),v=a.getUint8(2);let C=this.HEADER_LENGTH+2;const s=d.decode(n.slice(C,C+y));C=C+y;const M=d.decode(n.slice(C,C+v));C=C+v;const L=JSON.parse(d.decode(n.slice(C,n.byteLength)));return{ref:null,topic:s,event:M,payload:L}}}class yO{constructor(n,a){this.callback=n,this.timerCalc=a,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=a}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Hs;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(Hs||(Hs={}));const Aj=(i,n,a={})=>{var d;const y=(d=a.skipTypes)!==null&&d!==void 0?d:[];return n?Object.keys(n).reduce((v,C)=>(v[C]=w9(C,i,n,y),v),{}):{}},w9=(i,n,a,d)=>{const y=n.find(s=>s.name===i),v=y?.type,C=a[i];return v&&!d.includes(v)?_O(v,C):HT(C)},_O=(i,n)=>{if(i.charAt(0)==="_"){const a=i.slice(1,i.length);return C9(n,a)}switch(i){case Hs.bool:return S9(n);case Hs.float4:case Hs.float8:case Hs.int2:case Hs.int4:case Hs.int8:case Hs.numeric:case Hs.oid:return T9(n);case Hs.json:case Hs.jsonb:return E9(n);case Hs.timestamp:return A9(n);case Hs.abstime:case Hs.date:case Hs.daterange:case Hs.int4range:case Hs.int8range:case Hs.money:case Hs.reltime:case Hs.text:case Hs.time:case Hs.timestamptz:case Hs.timetz:case Hs.tsrange:case Hs.tstzrange:return HT(n);default:return HT(n)}},HT=i=>i,S9=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},T9=i=>{if(typeof i=="string"){const n=parseFloat(i);if(!Number.isNaN(n))return n}return i},E9=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(n){return console.log(`JSON parse error: ${n}`),i}return i},C9=(i,n)=>{if(typeof i!="string")return i;const a=i.length-1,d=i[a];if(i[0]==="{"&&d==="}"){let v;const C=i.slice(1,a);try{v=JSON.parse("["+C+"]")}catch{v=C?C.split(","):[]}return v.map(s=>_O(n,s))}return i},A9=i=>typeof i=="string"?i.replace(" ","T"):i,xO=i=>{const n=new URL(i);return n.protocol=n.protocol.replace(/^ws/i,"http"),n.pathname=n.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),n.pathname===""||n.pathname==="/"?n.pathname="/api/broadcast":n.pathname=n.pathname+"/api/broadcast",n.href};class FS{constructor(n,a,d={},y=GT){this.channel=n,this.event=a,this.payload=d,this.timeout=y,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,a){var d;return this._hasReceived(n)&&a((d=this.receivedResp)===null||d===void 0?void 0:d.response),this.recHooks.push({status:n,callback:a}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,a){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:a})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:a}){this.recHooks.filter(d=>d.status===n).forEach(d=>d.callback(a))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var Ij;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(Ij||(Ij={}));class Mx{constructor(n,a){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const d=a?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(d.state,{},y=>{const{onJoin:v,onLeave:C,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Mx.syncState(this.state,y,v,C),this.pendingDiffs.forEach(M=>{this.state=Mx.syncDiff(this.state,M,v,C)}),this.pendingDiffs=[],s()}),this.channel._on(d.diff,{},y=>{const{onJoin:v,onLeave:C,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(y):(this.state=Mx.syncDiff(this.state,y,v,C),s())}),this.onJoin((y,v,C)=>{this.channel._trigger("presence",{event:"join",key:y,currentPresences:v,newPresences:C})}),this.onLeave((y,v,C)=>{this.channel._trigger("presence",{event:"leave",key:y,currentPresences:v,leftPresences:C})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,a,d,y){const v=this.cloneDeep(n),C=this.transformState(a),s={},M={};return this.map(v,(L,F)=>{C[L]||(M[L]=F)}),this.map(C,(L,F)=>{const W=v[L];if(W){const X=F.map(oe=>oe.presence_ref),ee=W.map(oe=>oe.presence_ref),he=F.filter(oe=>ee.indexOf(oe.presence_ref)<0),se=W.filter(oe=>X.indexOf(oe.presence_ref)<0);he.length>0&&(s[L]=he),se.length>0&&(M[L]=se)}else s[L]=F}),this.syncDiff(v,{joins:s,leaves:M},d,y)}static syncDiff(n,a,d,y){const{joins:v,leaves:C}={joins:this.transformState(a.joins),leaves:this.transformState(a.leaves)};return d||(d=()=>{}),y||(y=()=>{}),this.map(v,(s,M)=>{var L;const F=(L=n[s])!==null&&L!==void 0?L:[];if(n[s]=this.cloneDeep(M),F.length>0){const W=n[s].map(ee=>ee.presence_ref),X=F.filter(ee=>W.indexOf(ee.presence_ref)<0);n[s].unshift(...X)}d(s,F,M)}),this.map(C,(s,M)=>{let L=n[s];if(!L)return;const F=M.map(W=>W.presence_ref);L=L.filter(W=>F.indexOf(W.presence_ref)<0),n[s]=L,y(s,L,M),L.length===0&&delete n[s]}),n}static map(n,a){return Object.getOwnPropertyNames(n).map(d=>a(d,n[d]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((a,d)=>{const y=n[d];return"metas"in y?a[d]=y.metas.map(v=>(v.presence_ref=v.phx_ref,delete v.phx_ref,delete v.phx_ref_prev,v)):a[d]=y,a},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Pj;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(Pj||(Pj={}));var Lx;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Lx||(Lx={}));var Kf;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Kf||(Kf={}));class _E{constructor(n,a={config:{}},d){var y,v;if(this.topic=n,this.params=a,this.socket=d,this.bindings={},this.state=ja.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new FS(this,wd.join,this.params,this.timeout),this.rejoinTimer=new yO(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ja.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(C=>C.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ja.closed,this.socket._remove(this)}),this._onError(C=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,C),this.state=ja.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ja.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",C=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,C),this.state=ja.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wd.reply,{},(C,s)=>{this._trigger(this._replyEventName(s),C)}),this.presence=new Mx(this),this.broadcastEndpointURL=xO(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((v=(y=this.params.config)===null||y===void 0?void 0:y.broadcast)===null||v===void 0)&&v.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(n,a=this.timeout){var d,y,v;if(this.socket.isConnected()||this.socket.connect(),this.state==ja.closed){const{config:{broadcast:C,presence:s,private:M}}=this.params,L=(y=(d=this.bindings.postgres_changes)===null||d===void 0?void 0:d.map(ee=>ee.filter))!==null&&y!==void 0?y:[],F=!!this.bindings[Lx.PRESENCE]&&this.bindings[Lx.PRESENCE].length>0||((v=this.params.config.presence)===null||v===void 0?void 0:v.enabled)===!0,W={},X={broadcast:C,presence:Object.assign(Object.assign({},s),{enabled:F}),postgres_changes:L,private:M};this.socket.accessTokenValue&&(W.access_token=this.socket.accessTokenValue),this._onError(ee=>n?.(Kf.CHANNEL_ERROR,ee)),this._onClose(()=>n?.(Kf.CLOSED)),this.updateJoinPayload(Object.assign({config:X},W)),this.joinedOnce=!0,this._rejoin(a),this.joinPush.receive("ok",async({postgres_changes:ee})=>{var he;if(this.socket.setAuth(),ee===void 0){n?.(Kf.SUBSCRIBED);return}else{const se=this.bindings.postgres_changes,oe=(he=se?.length)!==null&&he!==void 0?he:0,ve=[];for(let me=0;me<oe;me++){const Se=se[me],{filter:{event:Re,schema:Be,table:rt,filter:We}}=Se,Ct=ee&&ee[me];if(Ct&&Ct.event===Re&&Ct.schema===Be&&Ct.table===rt&&Ct.filter===We)ve.push(Object.assign(Object.assign({},Se),{id:Ct.id}));else{this.unsubscribe(),this.state=ja.errored,n?.(Kf.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=ve,n&&n(Kf.SUBSCRIBED);return}}).receive("error",ee=>{this.state=ja.errored,n?.(Kf.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(ee).join(", ")||"error")))}).receive("timeout",()=>{n?.(Kf.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,a={}){return await this.send({type:"presence",event:"track",payload:n},a.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,a,d){return this.state===ja.joined&&n===Lx.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(n,a,d)}async httpSend(n,a,d={}){var y;const v=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(a==null)return Promise.reject("Payload is required for httpSend()");const C={method:"POST",headers:{Authorization:v,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})},s=await this._fetchWithTimeout(this.broadcastEndpointURL,C,(y=d.timeout)!==null&&y!==void 0?y:this.timeout);if(s.status===202)return{success:!0};let M=s.statusText;try{const L=await s.json();M=L.error||L.message||M}catch{}return Promise.reject(new Error(M))}async send(n,a={}){var d,y;if(!this._canPush()&&n.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:v,payload:C}=n,M={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:v,payload:C,private:this.private}]})};try{const L=await this._fetchWithTimeout(this.broadcastEndpointURL,M,(d=a.timeout)!==null&&d!==void 0?d:this.timeout);return await((y=L.body)===null||y===void 0?void 0:y.cancel()),L.ok?"ok":"error"}catch(L){return L.name==="AbortError"?"timed out":"error"}}else return new Promise(v=>{var C,s,M;const L=this._push(n.type,n,a.timeout||this.timeout);n.type==="broadcast"&&!(!((M=(s=(C=this.params)===null||C===void 0?void 0:C.config)===null||s===void 0?void 0:s.broadcast)===null||M===void 0)&&M.ack)&&v("ok"),L.receive("ok",()=>v("ok")),L.receive("error",()=>v("error")),L.receive("timeout",()=>v("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=ja.leaving;const a=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wd.close,"leave",this._joinRef())};this.joinPush.destroy();let d=null;return new Promise(y=>{d=new FS(this,wd.leave,{},n),d.receive("ok",()=>{a(),y("ok")}).receive("timeout",()=>{a(),y("timed out")}).receive("error",()=>{y("error")}),d.send(),this._canPush()||d.trigger("ok",{})}).finally(()=>{d?.destroy()})}teardown(){this.pushBuffer.forEach(n=>n.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ja.closed,this.bindings={}}async _fetchWithTimeout(n,a,d){const y=new AbortController,v=setTimeout(()=>y.abort(),d),C=await this.socket.fetch(n,Object.assign(Object.assign({},a),{signal:y.signal}));return clearTimeout(v),C}_push(n,a,d=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let y=new FS(this,n,a,d);return this._canPush()?y.send():this._addToPushBuffer(y),y}_addToPushBuffer(n){if(n.startTimeout(),this.pushBuffer.push(n),this.pushBuffer.length>v9){const a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(n,a,d){return a}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,a,d){var y,v;const C=n.toLocaleLowerCase(),{close:s,error:M,leave:L,join:F}=wd;if(d&&[s,M,L,F].indexOf(C)>=0&&d!==this._joinRef())return;let X=this._onMessage(C,a,d);if(a&&!X)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(C)?(y=this.bindings.postgres_changes)===null||y===void 0||y.filter(ee=>{var he,se,oe;return((he=ee.filter)===null||he===void 0?void 0:he.event)==="*"||((oe=(se=ee.filter)===null||se===void 0?void 0:se.event)===null||oe===void 0?void 0:oe.toLocaleLowerCase())===C}).map(ee=>ee.callback(X,d)):(v=this.bindings[C])===null||v===void 0||v.filter(ee=>{var he,se,oe,ve,me,Se;if(["broadcast","presence","postgres_changes"].includes(C))if("id"in ee){const Re=ee.id,Be=(he=ee.filter)===null||he===void 0?void 0:he.event;return Re&&((se=a.ids)===null||se===void 0?void 0:se.includes(Re))&&(Be==="*"||Be?.toLocaleLowerCase()===((oe=a.data)===null||oe===void 0?void 0:oe.type.toLocaleLowerCase()))}else{const Re=(me=(ve=ee?.filter)===null||ve===void 0?void 0:ve.event)===null||me===void 0?void 0:me.toLocaleLowerCase();return Re==="*"||Re===((Se=a?.event)===null||Se===void 0?void 0:Se.toLocaleLowerCase())}else return ee.type.toLocaleLowerCase()===C}).map(ee=>{if(typeof X=="object"&&"ids"in X){const he=X.data,{schema:se,table:oe,commit_timestamp:ve,type:me,errors:Se}=he;X=Object.assign(Object.assign({},{schema:se,table:oe,commit_timestamp:ve,eventType:me,new:{},old:{},errors:Se}),this._getPayloadRecords(he))}ee.callback(X,d)})}_isClosed(){return this.state===ja.closed}_isJoined(){return this.state===ja.joined}_isJoining(){return this.state===ja.joining}_isLeaving(){return this.state===ja.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,a,d){const y=n.toLocaleLowerCase(),v={type:y,filter:a,callback:d};return this.bindings[y]?this.bindings[y].push(v):this.bindings[y]=[v],this}_off(n,a){const d=n.toLocaleLowerCase();return this.bindings[d]&&(this.bindings[d]=this.bindings[d].filter(y=>{var v;return!(((v=y.type)===null||v===void 0?void 0:v.toLocaleLowerCase())===d&&_E.isEqual(y.filter,a))})),this}static isEqual(n,a){if(Object.keys(n).length!==Object.keys(a).length)return!1;for(const d in n)if(n[d]!==a[d])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(wd.close,{},n)}_onError(n){this._on(wd.error,{},a=>n(a))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ja.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const a={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(a.new=Aj(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(a.old=Aj(n.columns,n.old_record)),a}}const BS=()=>{},Zb={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},I9=[1e3,2e3,5e3,1e4],P9=1e4,k9=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class N9{constructor(n,a){var d;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=GT,this.transport=null,this.heartbeatIntervalMs=Zb.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=BS,this.ref=0,this.reconnectTimer=null,this.logger=BS,this.conn=null,this.sendBuffer=[],this.serializer=new b9,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=y=>{let v;return y?v=y:typeof fetch>"u"?v=(...C)=>y_(async()=>{const{default:s}=await Promise.resolve().then(()=>Lg);return{default:s}},void 0).then(({default:s})=>s(...C)).catch(s=>{throw new Error(`Failed to load @supabase/node-fetch: ${s.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):v=fetch,(...C)=>v(...C)},!(!((d=a?.params)===null||d===void 0)&&d.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=a.params.apikey,this.endPoint=`${n}/${WT.websocket}`,this.httpEndpoint=xO(n),this._initializeOptions(a),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(a?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=m9.createWebSocket(this.endpointURL())}catch(n){this._setConnectionState("disconnected");const a=n.message;throw a.includes("Node.js")?new Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:_9}))}disconnect(n,a){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const d=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(d),this._setConnectionState("disconnected")},n?this.conn.close(n,a??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(n){const a=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),a}async removeAllChannels(){const n=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),n}log(n,a,d){this.logger(n,a,d)}connectionState(){switch(this.conn&&this.conn.readyState){case Rx.connecting:return vg.Connecting;case Rx.open:return vg.Open;case Rx.closing:return vg.Closing;default:return vg.Closed}}isConnected(){return this.connectionState()===vg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(n,a={config:{}}){const d=`realtime:${n}`,y=this.getChannels().find(v=>v.topic===d);if(y)return y;{const v=new _E(`realtime:${n}`,a,this);return this.channels.push(v),v}}push(n){const{topic:a,event:d,payload:y,ref:v}=n,C=()=>{this.encode(n,s=>{var M;(M=this.conn)===null||M===void 0||M.send(s)})};this.log("push",`${a} ${d} (${v})`,y),this.isConnected()?C():this.sendBuffer.push(C)}async setAuth(n=null){this._authPromise=this._performAuth(n);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var n;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,(n=this.conn)===null||n===void 0||n.close(x9,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout()},Zb.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(n){this.heartbeatCallback=n}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let a=this.channels.find(d=>d.topic===n&&(d._isJoined()||d._isJoining()));a&&(this.log("transport",`leaving duplicate topic "${n}"`),a.unsubscribe())}_remove(n){this.channels=this.channels.filter(a=>a.topic!==n.topic)}_onConnMessage(n){this.decode(n.data,a=>{if(a.topic==="phoenix"&&a.event==="phx_reply")try{this.heartbeatCallback(a.payload.status==="ok"?"ok":"error")}catch(L){this.log("error","error in heartbeat callback",L)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:d,event:y,payload:v,ref:C}=a,s=C?`(${C})`:"",M=v.status||"";this.log("receive",`${M} ${d} ${y} ${s}`.trim(),v),this.channels.filter(L=>L._isMember(d)).forEach(L=>L._trigger(y,v,C)),this._triggerStateCallbacks("message",a)})}_clearTimer(n){var a;n==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):n==="reconnect"&&((a=this.reconnectTimer)===null||a===void 0||a.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(n=>n.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{a.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(n){var a;this._setConnectionState("disconnected"),this.log("transport","close",n),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout(),this._triggerStateCallbacks("close",n)}_onConnError(n){this._setConnectionState("disconnected"),this.log("transport",`${n}`),this._triggerChanError(),this._triggerStateCallbacks("error",n)}_triggerChanError(){this.channels.forEach(n=>n._trigger(wd.error))}_appendParams(n,a){if(Object.keys(a).length===0)return n;const d=n.match(/\?/)?"&":"?",y=new URLSearchParams(a);return`${n}${d}${y}`}_workerObjectUrl(n){let a;if(n)a=n;else{const d=new Blob([k9],{type:"application/javascript"});a=URL.createObjectURL(d)}return a}_setConnectionState(n,a=!1){this._connectionState=n,n==="connecting"?this._wasManualDisconnect=!1:n==="disconnecting"&&(this._wasManualDisconnect=a)}async _performAuth(n=null){let a;n?a=n:this.accessToken?a=await this.accessToken():a=this.accessTokenValue,this.accessTokenValue!=a&&(this.accessTokenValue=a,this.channels.forEach(d=>{const y={access_token:a,version:y9};a&&d.updateJoinPayload(y),d.joinedOnce&&d._isJoined()&&d._push(wd.access_token,{access_token:a})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(n="general"){this.setAuth().catch(a=>{this.log("error",`error setting auth in ${n}`,a)})}_triggerStateCallbacks(n,a){try{this.stateChangeCallbacks[n].forEach(d=>{try{d(a)}catch(y){this.log("error",`error in ${n} callback`,y)}})}catch(d){this.log("error",`error triggering ${n} callbacks`,d)}}_setupReconnectionTimer(){this.reconnectTimer=new yO(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Zb.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(n){var a,d,y,v,C,s,M,L,F;if(this.transport=(a=n?.transport)!==null&&a!==void 0?a:null,this.timeout=(d=n?.timeout)!==null&&d!==void 0?d:GT,this.heartbeatIntervalMs=(y=n?.heartbeatIntervalMs)!==null&&y!==void 0?y:Zb.HEARTBEAT_INTERVAL,this.worker=(v=n?.worker)!==null&&v!==void 0?v:!1,this.accessToken=(C=n?.accessToken)!==null&&C!==void 0?C:null,this.heartbeatCallback=(s=n?.heartbeatCallback)!==null&&s!==void 0?s:BS,n?.params&&(this.params=n.params),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(M=n?.reconnectAfterMs)!==null&&M!==void 0?M:(W=>I9[W-1]||P9),this.encode=(L=n?.encode)!==null&&L!==void 0?L:((W,X)=>X(JSON.stringify(W))),this.decode=(F=n?.decode)!==null&&F!==void 0?F:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=n?.workerUrl}}}class xE extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function Io(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class j9 extends xE{constructor(n,a,d){super(n),this.name="StorageApiError",this.status=a,this.statusCode=d}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ZT extends xE{constructor(n,a){super(n),this.name="StorageUnknownError",this.originalError=a}}const vE=i=>{let n;return i?n=i:typeof fetch>"u"?n=(...a)=>y_(async()=>{const{default:d}=await Promise.resolve().then(()=>Lg);return{default:d}},void 0).then(({default:d})=>d(...a)):n=fetch,(...a)=>n(...a)},R9=()=>Rn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield y_(()=>Promise.resolve().then(()=>Lg),void 0)).Response:Response}),XT=i=>{if(Array.isArray(i))return i.map(a=>XT(a));if(typeof i=="function"||i!==Object(i))return i;const n={};return Object.entries(i).forEach(([a,d])=>{const y=a.replace(/([-_][a-z])/gi,v=>v.toUpperCase().replace(/[-_]/g,""));n[y]=XT(d)}),n},M9=i=>{if(typeof i!="object"||i===null)return!1;const n=Object.getPrototypeOf(i);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},VS=i=>{var n;return i.msg||i.message||i.error_description||(typeof i.error=="string"?i.error:(n=i.error)===null||n===void 0?void 0:n.message)||JSON.stringify(i)},L9=(i,n,a)=>Rn(void 0,void 0,void 0,function*(){const d=yield R9();i instanceof d&&!a?.noResolveJson?i.json().then(y=>{const v=i.status||500,C=y?.statusCode||v+"";n(new j9(VS(y),v,C))}).catch(y=>{n(new ZT(VS(y),y))}):n(new ZT(VS(i),i))}),D9=(i,n,a,d)=>{const y={method:i,headers:n?.headers||{}};return i==="GET"||!d?y:(M9(d)?(y.headers=Object.assign({"Content-Type":"application/json"},n?.headers),y.body=JSON.stringify(d)):y.body=d,n?.duplex&&(y.duplex=n.duplex),Object.assign(Object.assign({},y),a))};function Cv(i,n,a,d,y,v){return Rn(this,void 0,void 0,function*(){return new Promise((C,s)=>{i(a,D9(n,d,y,v)).then(M=>{if(!M.ok)throw M;return d?.noResolveJson?M:M.json()}).then(M=>C(M)).catch(M=>L9(M,s,d))})})}function Zx(i,n,a,d){return Rn(this,void 0,void 0,function*(){return Cv(i,"GET",n,a,d)})}function vd(i,n,a,d,y){return Rn(this,void 0,void 0,function*(){return Cv(i,"POST",n,d,y,a)})}function KT(i,n,a,d,y){return Rn(this,void 0,void 0,function*(){return Cv(i,"PUT",n,d,y,a)})}function O9(i,n,a,d){return Rn(this,void 0,void 0,function*(){return Cv(i,"HEAD",n,Object.assign(Object.assign({},a),{noResolveJson:!0}),d)})}function bE(i,n,a,d,y){return Rn(this,void 0,void 0,function*(){return Cv(i,"DELETE",n,d,y,a)})}class z9{constructor(n,a){this.downloadFn=n,this.shouldThrowOnError=a}then(n,a){return this.execute().then(n,a)}execute(){return Rn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Io(n))return{data:null,error:n};throw n}})}}var vO;class F9{constructor(n,a){this.downloadFn=n,this.shouldThrowOnError=a,this[vO]="BlobDownloadBuilder",this.promise=null}asStream(){return new z9(this.downloadFn,this.shouldThrowOnError)}then(n,a){return this.getPromise().then(n,a)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Rn(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Io(n))return{data:null,error:n};throw n}})}}vO=Symbol.toStringTag;const B9={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kj={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class V9{constructor(n,a={},d,y){this.shouldThrowOnError=!1,this.url=n,this.headers=a,this.bucketId=d,this.fetch=vE(y)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(n,a,d,y){return Rn(this,void 0,void 0,function*(){try{let v;const C=Object.assign(Object.assign({},kj),y);let s=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(C.upsert)});const M=C.metadata;typeof Blob<"u"&&d instanceof Blob?(v=new FormData,v.append("cacheControl",C.cacheControl),M&&v.append("metadata",this.encodeMetadata(M)),v.append("",d)):typeof FormData<"u"&&d instanceof FormData?(v=d,v.append("cacheControl",C.cacheControl),M&&v.append("metadata",this.encodeMetadata(M))):(v=d,s["cache-control"]=`max-age=${C.cacheControl}`,s["content-type"]=C.contentType,M&&(s["x-metadata"]=this.toBase64(this.encodeMetadata(M)))),y?.headers&&(s=Object.assign(Object.assign({},s),y.headers));const L=this._removeEmptyFolders(a),F=this._getFinalPath(L),W=yield(n=="PUT"?KT:vd)(this.fetch,`${this.url}/object/${F}`,v,Object.assign({headers:s},C?.duplex?{duplex:C.duplex}:{}));return{data:{path:L,id:W.Id,fullPath:W.Key},error:null}}catch(v){if(this.shouldThrowOnError)throw v;if(Io(v))return{data:null,error:v};throw v}})}upload(n,a,d){return Rn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,a,d)})}uploadToSignedUrl(n,a,d,y){return Rn(this,void 0,void 0,function*(){const v=this._removeEmptyFolders(n),C=this._getFinalPath(v),s=new URL(this.url+`/object/upload/sign/${C}`);s.searchParams.set("token",a);try{let M;const L=Object.assign({upsert:kj.upsert},y),F=Object.assign(Object.assign({},this.headers),{"x-upsert":String(L.upsert)});typeof Blob<"u"&&d instanceof Blob?(M=new FormData,M.append("cacheControl",L.cacheControl),M.append("",d)):typeof FormData<"u"&&d instanceof FormData?(M=d,M.append("cacheControl",L.cacheControl)):(M=d,F["cache-control"]=`max-age=${L.cacheControl}`,F["content-type"]=L.contentType);const W=yield KT(this.fetch,s.toString(),M,{headers:F});return{data:{path:v,fullPath:W.Key},error:null}}catch(M){if(this.shouldThrowOnError)throw M;if(Io(M))return{data:null,error:M};throw M}})}createSignedUploadUrl(n,a){return Rn(this,void 0,void 0,function*(){try{let d=this._getFinalPath(n);const y=Object.assign({},this.headers);a?.upsert&&(y["x-upsert"]="true");const v=yield vd(this.fetch,`${this.url}/object/upload/sign/${d}`,{},{headers:y}),C=new URL(this.url+v.url),s=C.searchParams.get("token");if(!s)throw new xE("No token returned by API");return{data:{signedUrl:C.toString(),path:n,token:s},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Io(d))return{data:null,error:d};throw d}})}update(n,a,d){return Rn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,a,d)})}move(n,a,d){return Rn(this,void 0,void 0,function*(){try{return{data:yield vd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:a,destinationBucket:d?.destinationBucket},{headers:this.headers}),error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(Io(y))return{data:null,error:y};throw y}})}copy(n,a,d){return Rn(this,void 0,void 0,function*(){try{return{data:{path:(yield vd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:a,destinationBucket:d?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(Io(y))return{data:null,error:y};throw y}})}createSignedUrl(n,a,d){return Rn(this,void 0,void 0,function*(){try{let y=this._getFinalPath(n),v=yield vd(this.fetch,`${this.url}/object/sign/${y}`,Object.assign({expiresIn:a},d?.transform?{transform:d.transform}:{}),{headers:this.headers});const C=d?.download?`&download=${d.download===!0?"":d.download}`:"";return v={signedUrl:encodeURI(`${this.url}${v.signedURL}${C}`)},{data:v,error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(Io(y))return{data:null,error:y};throw y}})}createSignedUrls(n,a,d){return Rn(this,void 0,void 0,function*(){try{const y=yield vd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:a,paths:n},{headers:this.headers}),v=d?.download?`&download=${d.download===!0?"":d.download}`:"";return{data:y.map(C=>Object.assign(Object.assign({},C),{signedUrl:C.signedURL?encodeURI(`${this.url}${C.signedURL}${v}`):null})),error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(Io(y))return{data:null,error:y};throw y}})}download(n,a){const y=typeof a?.transform<"u"?"render/image/authenticated":"object",v=this.transformOptsToQueryString(a?.transform||{}),C=v?`?${v}`:"",s=this._getFinalPath(n),M=()=>Zx(this.fetch,`${this.url}/${y}/${s}${C}`,{headers:this.headers,noResolveJson:!0});return new F9(M,this.shouldThrowOnError)}info(n){return Rn(this,void 0,void 0,function*(){const a=this._getFinalPath(n);try{const d=yield Zx(this.fetch,`${this.url}/object/info/${a}`,{headers:this.headers});return{data:XT(d),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Io(d))return{data:null,error:d};throw d}})}exists(n){return Rn(this,void 0,void 0,function*(){const a=this._getFinalPath(n);try{return yield O9(this.fetch,`${this.url}/object/${a}`,{headers:this.headers}),{data:!0,error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Io(d)&&d instanceof ZT){const y=d.originalError;if([400,404].includes(y?.status))return{data:!1,error:d}}throw d}})}getPublicUrl(n,a){const d=this._getFinalPath(n),y=[],v=a?.download?`download=${a.download===!0?"":a.download}`:"";v!==""&&y.push(v);const s=typeof a?.transform<"u"?"render/image":"object",M=this.transformOptsToQueryString(a?.transform||{});M!==""&&y.push(M);let L=y.join("&");return L!==""&&(L=`?${L}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${d}${L}`)}}}remove(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield bE(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}list(n,a,d){return Rn(this,void 0,void 0,function*(){try{const y=Object.assign(Object.assign(Object.assign({},B9),a),{prefix:n||""});return{data:yield vd(this.fetch,`${this.url}/object/list/${this.bucketId}`,y,{headers:this.headers},d),error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(Io(y))return{data:null,error:y};throw y}})}listV2(n,a){return Rn(this,void 0,void 0,function*(){try{const d=Object.assign({},n);return{data:yield vd(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,d,{headers:this.headers},a),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Io(d))return{data:null,error:d};throw d}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const a=[];return n.width&&a.push(`width=${n.width}`),n.height&&a.push(`height=${n.height}`),n.resize&&a.push(`resize=${n.resize}`),n.format&&a.push(`format=${n.format}`),n.quality&&a.push(`quality=${n.quality}`),a.join("&")}}const bO="2.78.0",wO={"X-Client-Info":`storage-js/${bO}`};class U9{constructor(n,a={},d,y){this.shouldThrowOnError=!1;const v=new URL(n);y?.useNewHostname&&/supabase\.(co|in|red)$/.test(v.hostname)&&!v.hostname.includes("storage.supabase.")&&(v.hostname=v.hostname.replace("supabase.","storage.supabase.")),this.url=v.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wO),a),this.fetch=vE(d)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(n){return Rn(this,void 0,void 0,function*(){try{const a=this.listBucketOptionsToQueryString(n);return{data:yield Zx(this.fetch,`${this.url}/bucket${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}getBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield Zx(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}createBucket(n){return Rn(this,arguments,void 0,function*(a,d={public:!1}){try{return{data:yield vd(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:d.type,public:d.public,file_size_limit:d.fileSizeLimit,allowed_mime_types:d.allowedMimeTypes},{headers:this.headers}),error:null}}catch(y){if(this.shouldThrowOnError)throw y;if(Io(y))return{data:null,error:y};throw y}})}updateBucket(n,a){return Rn(this,void 0,void 0,function*(){try{return{data:yield KT(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:a.public,file_size_limit:a.fileSizeLimit,allowed_mime_types:a.allowedMimeTypes},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Io(d))return{data:null,error:d};throw d}})}emptyBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield vd(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}deleteBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield bE(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}listBucketOptionsToQueryString(n){const a={};return n&&("limit"in n&&(a.limit=String(n.limit)),"offset"in n&&(a.offset=String(n.offset)),n.search&&(a.search=n.search),n.sortColumn&&(a.sortColumn=n.sortColumn),n.sortOrder&&(a.sortOrder=n.sortOrder)),Object.keys(a).length>0?"?"+new URLSearchParams(a).toString():""}}class $9{constructor(n,a={},d){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wO),a),this.fetch=vE(d)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield vd(this.fetch,`${this.url}/bucket`,{name:n},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}listBuckets(n){return Rn(this,void 0,void 0,function*(){try{const a=new URLSearchParams;n?.limit!==void 0&&a.set("limit",n.limit.toString()),n?.offset!==void 0&&a.set("offset",n.offset.toString()),n?.sortColumn&&a.set("sortColumn",n.sortColumn),n?.sortOrder&&a.set("sortOrder",n.sortOrder),n?.search&&a.set("search",n.search);const d=a.toString(),y=d?`${this.url}/bucket?${d}`:`${this.url}/bucket`;return{data:yield Zx(this.fetch,y,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}deleteBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield bE(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Io(a))return{data:null,error:a};throw a}})}}const wE={"X-Client-Info":`storage-js/${bO}`,"Content-Type":"application/json"};class SO extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Wc(i){return typeof i=="object"&&i!==null&&"__isStorageVectorsError"in i}class US extends SO{constructor(n,a,d){super(n),this.name="StorageVectorsApiError",this.status=a,this.statusCode=d}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class q9 extends SO{constructor(n,a){super(n),this.name="StorageVectorsUnknownError",this.originalError=a}}var Nj;(function(i){i.InternalError="InternalError",i.S3VectorConflictException="S3VectorConflictException",i.S3VectorNotFoundException="S3VectorNotFoundException",i.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",i.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",i.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Nj||(Nj={}));const SE=i=>{let n;return i?n=i:typeof fetch>"u"?n=(...a)=>y_(async()=>{const{default:d}=await Promise.resolve().then(()=>Lg);return{default:d}},void 0).then(({default:d})=>d(...a)):n=fetch,(...a)=>n(...a)},G9=i=>{if(typeof i!="object"||i===null)return!1;const n=Object.getPrototypeOf(i);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},jj=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),W9=(i,n,a)=>Rn(void 0,void 0,void 0,function*(){if(i&&typeof i=="object"&&"status"in i&&"ok"in i&&typeof i.status=="number"&&!a?.noResolveJson){const y=i.status||500,v=i;if(typeof v.json=="function")v.json().then(C=>{const s=C?.statusCode||C?.code||y+"";n(new US(jj(C),y,s))}).catch(()=>{const C=y+"",s=v.statusText||`HTTP ${y} error`;n(new US(s,y,C))});else{const C=y+"",s=v.statusText||`HTTP ${y} error`;n(new US(s,y,C))}}else n(new q9(jj(i),i))}),H9=(i,n,a,d)=>{const y={method:i,headers:n?.headers||{}};return d?(G9(d)?(y.headers=Object.assign({"Content-Type":"application/json"},n?.headers),y.body=JSON.stringify(d)):y.body=d,Object.assign(Object.assign({},y),a)):y};function Z9(i,n,a,d,y,v){return Rn(this,void 0,void 0,function*(){return new Promise((C,s)=>{i(a,H9(n,d,y,v)).then(M=>{if(!M.ok)throw M;if(d?.noResolveJson)return M;const L=M.headers.get("content-type");return!L||!L.includes("application/json")?{}:M.json()}).then(M=>C(M)).catch(M=>W9(M,s,d))})})}function Hc(i,n,a,d,y){return Rn(this,void 0,void 0,function*(){return Z9(i,"POST",n,d,y,a)})}class X9{constructor(n,a={},d){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wE),a),this.fetch=SE(d)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(n){return Rn(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/CreateIndex`,n,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}getIndex(n,a){return Rn(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:n,indexName:a},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Wc(d))return{data:null,error:d};throw d}})}listIndexes(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/ListIndexes`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}deleteIndex(n,a){return Rn(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:n,indexName:a},{headers:this.headers}))||{},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Wc(d))return{data:null,error:d};throw d}})}}class K9{constructor(n,a={},d){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wE),a),this.fetch=SE(d)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(n){return Rn(this,void 0,void 0,function*(){try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Hc(this.fetch,`${this.url}/PutVectors`,n,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}getVectors(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/GetVectors`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}listVectors(n){return Rn(this,void 0,void 0,function*(){try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:yield Hc(this.fetch,`${this.url}/ListVectors`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}queryVectors(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/QueryVectors`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}deleteVectors(n){return Rn(this,void 0,void 0,function*(){try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Hc(this.fetch,`${this.url}/DeleteVectors`,n,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}}class Y9{constructor(n,a={},d){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wE),a),this.fetch=SE(d)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}getBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:n},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}listBuckets(){return Rn(this,arguments,void 0,function*(n={}){try{return{data:yield Hc(this.fetch,`${this.url}/ListVectorBuckets`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}deleteBucket(n){return Rn(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Wc(a))return{data:null,error:a};throw a}})}}class Q9 extends Y9{constructor(n,a={}){super(n,a.headers||{},a.fetch)}from(n){return new J9(this.url,this.headers,n,this.fetch)}}class J9 extends X9{constructor(n,a,d,y){super(n,a,y),this.vectorBucketName=d}createIndex(n){const a=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Rn(this,void 0,void 0,function*(){return a.createIndex.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const n=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Rn(this,arguments,void 0,function*(a={}){return n.listIndexes.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName}))})}getIndex(n){const a=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Rn(this,void 0,void 0,function*(){return a.getIndex.call(this,this.vectorBucketName,n)})}deleteIndex(n){const a=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Rn(this,void 0,void 0,function*(){return a.deleteIndex.call(this,this.vectorBucketName,n)})}index(n){return new e7(this.url,this.headers,this.vectorBucketName,n,this.fetch)}}class e7 extends K9{constructor(n,a,d,y,v){super(n,a,v),this.vectorBucketName=d,this.indexName=y}putVectors(n){const a=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Rn(this,void 0,void 0,function*(){return a.putVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(n){const a=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Rn(this,void 0,void 0,function*(){return a.getVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const n=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Rn(this,arguments,void 0,function*(a={}){return n.listVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(n){const a=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Rn(this,void 0,void 0,function*(){return a.queryVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(n){const a=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Rn(this,void 0,void 0,function*(){return a.deleteVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class t7 extends U9{constructor(n,a={},d,y){super(n,a,d,y)}from(n){return new V9(this.url,this.headers,n,this.fetch)}get vectors(){return new Q9(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $9(this.url+"/iceberg",this.headers,this.fetch)}}const r7="2.78.0";let Cx="";typeof Deno<"u"?Cx="deno":typeof document<"u"?Cx="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Cx="react-native":Cx="node";const n7={"X-Client-Info":`supabase-js-${Cx}/${r7}`},i7={headers:n7},s7={schema:"public"},o7={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},a7={},l7=i=>{let n;return i?n=i:typeof fetch>"u"?n=cO:n=fetch,(...a)=>n(...a)},c7=()=>typeof Headers>"u"?uO:Headers,u7=(i,n,a)=>{const d=l7(a),y=c7();return async(v,C)=>{var s;const M=(s=await n())!==null&&s!==void 0?s:i;let L=new y(C?.headers);return L.has("apikey")||L.set("apikey",i),L.has("Authorization")||L.set("Authorization",`Bearer ${M}`),d(v,Object.assign(Object.assign({},C),{headers:L}))}};function d7(i){return i.endsWith("/")?i:i+"/"}function h7(i,n){var a,d;const{db:y,auth:v,realtime:C,global:s}=i,{db:M,auth:L,realtime:F,global:W}=n,X={db:Object.assign(Object.assign({},M),y),auth:Object.assign(Object.assign({},L),v),realtime:Object.assign(Object.assign({},F),C),storage:{},global:Object.assign(Object.assign(Object.assign({},W),s),{headers:Object.assign(Object.assign({},(a=W?.headers)!==null&&a!==void 0?a:{}),(d=s?.headers)!==null&&d!==void 0?d:{})}),accessToken:async()=>""};return i.accessToken?X.accessToken=i.accessToken:delete X.accessToken,X}function f7(i){const n=i?.trim();if(!n)throw new Error("supabaseUrl is required.");if(!n.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(d7(n))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const TO="2.78.0",My=30*1e3,YT=3,$S=YT*My,p7="http://localhost:9999",m7="supabase.auth.token",g7={"X-Client-Info":`gotrue-js/${TO}`},QT="X-Supabase-Api-Version",EO={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},y7=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,_7=600*1e3;class Xx extends Error{constructor(n,a,d){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=a,this.code=d}}function qn(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class x7 extends Xx{constructor(n,a,d){super(n,a,d),this.name="AuthApiError",this.status=a,this.code=d}}function v7(i){return qn(i)&&i.name==="AuthApiError"}class bg extends Xx{constructor(n,a){super(n),this.name="AuthUnknownError",this.originalError=a}}class Tm extends Xx{constructor(n,a,d,y){super(n,d,y),this.name=a,this.status=d}}class yd extends Tm{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function b7(i){return qn(i)&&i.name==="AuthSessionMissingError"}class Ty extends Tm{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xb extends Tm{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class Kb extends Tm{constructor(n,a=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function w7(i){return qn(i)&&i.name==="AuthImplicitGrantRedirectError"}class Rj extends Tm{constructor(n,a=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class JT extends Tm{constructor(n,a){super(n,"AuthRetryableFetchError",a,void 0)}}function qS(i){return qn(i)&&i.name==="AuthRetryableFetchError"}class Mj extends Tm{constructor(n,a,d){super(n,"AuthWeakPasswordError",a,"weak_password"),this.reasons=d}}class e2 extends Tm{constructor(n){super(n,"AuthInvalidJwtError",400,"invalid_jwt")}}const P0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Lj=` 	
\r=`.split(""),S7=(()=>{const i=new Array(128);for(let n=0;n<i.length;n+=1)i[n]=-1;for(let n=0;n<Lj.length;n+=1)i[Lj[n].charCodeAt(0)]=-2;for(let n=0;n<P0.length;n+=1)i[P0[n].charCodeAt(0)]=n;return i})();function Dj(i,n,a){if(i!==null)for(n.queue=n.queue<<8|i,n.queuedBits+=8;n.queuedBits>=6;){const d=n.queue>>n.queuedBits-6&63;a(P0[d]),n.queuedBits-=6}else if(n.queuedBits>0)for(n.queue=n.queue<<6-n.queuedBits,n.queuedBits=6;n.queuedBits>=6;){const d=n.queue>>n.queuedBits-6&63;a(P0[d]),n.queuedBits-=6}}function CO(i,n,a){const d=S7[i];if(d>-1)for(n.queue=n.queue<<6|d,n.queuedBits+=6;n.queuedBits>=8;)a(n.queue>>n.queuedBits-8&255),n.queuedBits-=8;else{if(d===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function Oj(i){const n=[],a=C=>{n.push(String.fromCodePoint(C))},d={utf8seq:0,codepoint:0},y={queue:0,queuedBits:0},v=C=>{C7(C,d,a)};for(let C=0;C<i.length;C+=1)CO(i.charCodeAt(C),y,v);return n.join("")}function T7(i,n){if(i<=127){n(i);return}else if(i<=2047){n(192|i>>6),n(128|i&63);return}else if(i<=65535){n(224|i>>12),n(128|i>>6&63),n(128|i&63);return}else if(i<=1114111){n(240|i>>18),n(128|i>>12&63),n(128|i>>6&63),n(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function E7(i,n){for(let a=0;a<i.length;a+=1){let d=i.charCodeAt(a);if(d>55295&&d<=56319){const y=(d-55296)*1024&65535;d=(i.charCodeAt(a+1)-56320&65535|y)+65536,a+=1}T7(d,n)}}function C7(i,n,a){if(n.utf8seq===0){if(i<=127){a(i);return}for(let d=1;d<6;d+=1)if((i>>7-d&1)===0){n.utf8seq=d;break}if(n.utf8seq===2)n.codepoint=i&31;else if(n.utf8seq===3)n.codepoint=i&15;else if(n.utf8seq===4)n.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");n.utf8seq-=1}else if(n.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");n.codepoint=n.codepoint<<6|i&63,n.utf8seq-=1,n.utf8seq===0&&a(n.codepoint)}}function Wy(i){const n=[],a={queue:0,queuedBits:0},d=y=>{n.push(y)};for(let y=0;y<i.length;y+=1)CO(i.charCodeAt(y),a,d);return new Uint8Array(n)}function A7(i){const n=[];return E7(i,a=>n.push(a)),new Uint8Array(n)}function Sg(i){const n=[],a={queue:0,queuedBits:0},d=y=>{n.push(y)};return i.forEach(y=>Dj(y,a,d)),Dj(null,a,d),n.join("")}function I7(i){return Math.round(Date.now()/1e3)+i}function P7(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const n=Math.random()*16|0;return(i=="x"?n:n&3|8).toString(16)})}const Hl=()=>typeof window<"u"&&typeof document<"u",fg={tested:!1,writable:!1},AO=()=>{if(!Hl())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(fg.tested)return fg.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),fg.tested=!0,fg.writable=!0}catch{fg.tested=!0,fg.writable=!1}return fg.writable};function k7(i){const n={},a=new URL(i);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((y,v)=>{n[v]=y})}catch{}return a.searchParams.forEach((d,y)=>{n[y]=d}),n}const IO=i=>{let n;return i?n=i:typeof fetch>"u"?n=(...a)=>y_(async()=>{const{default:d}=await Promise.resolve().then(()=>Lg);return{default:d}},void 0).then(({default:d})=>d(...a)):n=fetch,(...a)=>n(...a)},N7=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Ly=async(i,n,a)=>{await i.setItem(n,JSON.stringify(a))},pg=async(i,n)=>{const a=await i.getItem(n);if(!a)return null;try{return JSON.parse(a)}catch{return a}},im=async(i,n)=>{await i.removeItem(n)};class yw{constructor(){this.promise=new yw.promiseConstructor((n,a)=>{this.resolve=n,this.reject=a})}}yw.promiseConstructor=Promise;function GS(i){const n=i.split(".");if(n.length!==3)throw new e2("Invalid JWT structure");for(let d=0;d<n.length;d++)if(!y7.test(n[d]))throw new e2("JWT not in base64url format");return{header:JSON.parse(Oj(n[0])),payload:JSON.parse(Oj(n[1])),signature:Wy(n[2]),raw:{header:n[0],payload:n[1]}}}async function j7(i){return await new Promise(n=>{setTimeout(()=>n(null),i)})}function R7(i,n){return new Promise((d,y)=>{(async()=>{for(let v=0;v<1/0;v++)try{const C=await i(v);if(!n(v,null,C)){d(C);return}}catch(C){if(!n(v,C)){y(C);return}}})()})}function M7(i){return("0"+i.toString(16)).substr(-2)}function L7(){const n=new Uint32Array(56);if(typeof crypto>"u"){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",d=a.length;let y="";for(let v=0;v<56;v++)y+=a.charAt(Math.floor(Math.random()*d));return y}return crypto.getRandomValues(n),Array.from(n,M7).join("")}async function D7(i){const a=new TextEncoder().encode(i),d=await crypto.subtle.digest("SHA-256",a),y=new Uint8Array(d);return Array.from(y).map(v=>String.fromCharCode(v)).join("")}async function O7(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const a=await D7(i);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ey(i,n,a=!1){const d=L7();let y=d;a&&(y+="/PASSWORD_RECOVERY"),await Ly(i,`${n}-code-verifier`,y);const v=await O7(d);return[v,d===v?"plain":"s256"]}const z7=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function F7(i){const n=i.headers.get(QT);if(!n||!n.match(z7))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}function B7(i){if(!i)throw new Error("Missing exp claim");const n=Math.floor(Date.now()/1e3);if(i<=n)throw new Error("JWT has expired")}function V7(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const U7=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Cy(i){if(!U7.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function WS(){const i={};return new Proxy(i,{get:(n,a)=>{if(a==="__isUserNotAvailableProxy")return!0;if(typeof a=="symbol"){const d=a.toString();if(d==="Symbol(Symbol.toPrimitive)"||d==="Symbol(Symbol.toStringTag)"||d==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${a}" property of the session object is not supported. Please use getUser() instead.`)},set:(n,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(n,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function $7(i,n){return new Proxy(i,{get:(a,d,y)=>{if(d==="__isInsecureUserWarningProxy")return!0;if(typeof d=="symbol"){const v=d.toString();if(v==="Symbol(Symbol.toPrimitive)"||v==="Symbol(Symbol.toStringTag)"||v==="Symbol(util.inspect.custom)"||v==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(a,d,y)}return!n.value&&typeof d=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),n.value=!0),Reflect.get(a,d,y)}})}function zj(i){return JSON.parse(JSON.stringify(i))}const xg=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),q7=[502,503,504];async function Fj(i){var n;if(!N7(i))throw new JT(xg(i),0);if(q7.includes(i.status))throw new JT(xg(i),i.status);let a;try{a=await i.json()}catch(v){throw new bg(xg(v),v)}let d;const y=F7(i);if(y&&y.getTime()>=EO["2024-01-01"].timestamp&&typeof a=="object"&&a&&typeof a.code=="string"?d=a.code:typeof a=="object"&&a&&typeof a.error_code=="string"&&(d=a.error_code),d){if(d==="weak_password")throw new Mj(xg(a),i.status,((n=a.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(d==="session_not_found")throw new yd}else if(typeof a=="object"&&a&&typeof a.weak_password=="object"&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((v,C)=>v&&typeof C=="string",!0))throw new Mj(xg(a),i.status,a.weak_password.reasons);throw new x7(xg(a),i.status||500,d)}const G7=(i,n,a,d)=>{const y={method:i,headers:n?.headers||{}};return i==="GET"?y:(y.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),y.body=JSON.stringify(d),Object.assign(Object.assign({},y),a))};async function wi(i,n,a,d){var y;const v=Object.assign({},d?.headers);v[QT]||(v[QT]=EO["2024-01-01"].name),d?.jwt&&(v.Authorization=`Bearer ${d.jwt}`);const C=(y=d?.query)!==null&&y!==void 0?y:{};d?.redirectTo&&(C.redirect_to=d.redirectTo);const s=Object.keys(C).length?"?"+new URLSearchParams(C).toString():"",M=await W7(i,n,a+s,{headers:v,noResolveJson:d?.noResolveJson},{},d?.body);return d?.xform?d?.xform(M):{data:Object.assign({},M),error:null}}async function W7(i,n,a,d,y,v){const C=G7(n,d,y,v);let s;try{s=await i(a,Object.assign({},C))}catch(M){throw console.error(M),new JT(xg(M),0)}if(s.ok||await Fj(s),d?.noResolveJson)return s;try{return await s.json()}catch(M){await Fj(M)}}function _d(i){var n;let a=null;X7(i)&&(a=Object.assign({},i),i.expires_at||(a.expires_at=I7(i.expires_in)));const d=(n=i.user)!==null&&n!==void 0?n:i;return{data:{session:a,user:d},error:null}}function Bj(i){const n=_d(i);return!n.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((a,d)=>a&&typeof d=="string",!0)&&(n.data.weak_password=i.weak_password),n}function um(i){var n;return{data:{user:(n=i.user)!==null&&n!==void 0?n:i},error:null}}function H7(i){return{data:i,error:null}}function Z7(i){const{action_link:n,email_otp:a,hashed_token:d,redirect_to:y,verification_type:v}=i,C=Sm(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),s={action_link:n,email_otp:a,hashed_token:d,redirect_to:y,verification_type:v},M=Object.assign({},C);return{data:{properties:s,user:M},error:null}}function Vj(i){return i}function X7(i){return i.access_token&&i.refresh_token&&i.expires_in}const HS=["global","local","others"];class K7{constructor({url:n="",headers:a={},fetch:d}){this.url=n,this.headers=a,this.fetch=IO(d),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(n,a=HS[0]){if(HS.indexOf(a)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${HS.join(", ")}`);try{return await wi(this.fetch,"POST",`${this.url}/logout?scope=${a}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(d){if(qn(d))return{data:null,error:d};throw d}}async inviteUserByEmail(n,a={}){try{return await wi(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:a.data},headers:this.headers,redirectTo:a.redirectTo,xform:um})}catch(d){if(qn(d))return{data:{user:null},error:d};throw d}}async generateLink(n){try{const{options:a}=n,d=Sm(n,["options"]),y=Object.assign(Object.assign({},d),a);return"newEmail"in d&&(y.new_email=d?.newEmail,delete y.newEmail),await wi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:y,headers:this.headers,xform:Z7,redirectTo:a?.redirectTo})}catch(a){if(qn(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(n){try{return await wi(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:um})}catch(a){if(qn(a))return{data:{user:null},error:a};throw a}}async listUsers(n){var a,d,y,v,C,s,M;try{const L={nextPage:null,lastPage:0,total:0},F=await wi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(d=(a=n?.page)===null||a===void 0?void 0:a.toString())!==null&&d!==void 0?d:"",per_page:(v=(y=n?.perPage)===null||y===void 0?void 0:y.toString())!==null&&v!==void 0?v:""},xform:Vj});if(F.error)throw F.error;const W=await F.json(),X=(C=F.headers.get("x-total-count"))!==null&&C!==void 0?C:0,ee=(M=(s=F.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&M!==void 0?M:[];return ee.length>0&&(ee.forEach(he=>{const se=parseInt(he.split(";")[0].split("=")[1].substring(0,1)),oe=JSON.parse(he.split(";")[1].split("=")[1]);L[`${oe}Page`]=se}),L.total=parseInt(X)),{data:Object.assign(Object.assign({},W),L),error:null}}catch(L){if(qn(L))return{data:{users:[]},error:L};throw L}}async getUserById(n){Cy(n);try{return await wi(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:um})}catch(a){if(qn(a))return{data:{user:null},error:a};throw a}}async updateUserById(n,a){Cy(n);try{return await wi(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:a,headers:this.headers,xform:um})}catch(d){if(qn(d))return{data:{user:null},error:d};throw d}}async deleteUser(n,a=!1){Cy(n);try{return await wi(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:a},xform:um})}catch(d){if(qn(d))return{data:{user:null},error:d};throw d}}async _listFactors(n){Cy(n.userId);try{const{data:a,error:d}=await wi(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:y=>({data:{factors:y},error:null})});return{data:a,error:d}}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _deleteFactor(n){Cy(n.userId),Cy(n.id);try{return{data:await wi(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _listOAuthClients(n){var a,d,y,v,C,s,M;try{const L={nextPage:null,lastPage:0,total:0},F=await wi(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(d=(a=n?.page)===null||a===void 0?void 0:a.toString())!==null&&d!==void 0?d:"",per_page:(v=(y=n?.perPage)===null||y===void 0?void 0:y.toString())!==null&&v!==void 0?v:""},xform:Vj});if(F.error)throw F.error;const W=await F.json(),X=(C=F.headers.get("x-total-count"))!==null&&C!==void 0?C:0,ee=(M=(s=F.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&M!==void 0?M:[];return ee.length>0&&(ee.forEach(he=>{const se=parseInt(he.split(";")[0].split("=")[1].substring(0,1)),oe=JSON.parse(he.split(";")[1].split("=")[1]);L[`${oe}Page`]=se}),L.total=parseInt(X)),{data:Object.assign(Object.assign({},W),L),error:null}}catch(L){if(qn(L))return{data:{clients:[]},error:L};throw L}}async _createOAuthClient(n){try{return await wi(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:n,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _getOAuthClient(n){try{return await wi(this.fetch,"GET",`${this.url}/admin/oauth/clients/${n}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _updateOAuthClient(n,a){try{return await wi(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${n}`,{body:a,headers:this.headers,xform:d=>({data:d,error:null})})}catch(d){if(qn(d))return{data:null,error:d};throw d}}async _deleteOAuthClient(n){try{return await wi(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${n}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(n){try{return await wi(this.fetch,"POST",`${this.url}/admin/oauth/clients/${n}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(qn(a))return{data:null,error:a};throw a}}}function Uj(i={}){return{getItem:n=>i[n]||null,setItem:(n,a)=>{i[n]=a},removeItem:n=>{delete i[n]}}}const Ay={debug:!!(globalThis&&AO()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class PO extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class Y7 extends PO{}async function Q7(i,n,a){Ay.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,n);const d=new globalThis.AbortController;return n>0&&setTimeout(()=>{d.abort(),Ay.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:d.signal},async y=>{if(y){Ay.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,y.name);try{return await a()}finally{Ay.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,y.name)}}else{if(n===0)throw Ay.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Y7(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Ay.debug)try{const v=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(v,null,"  "))}catch(v){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",v)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await a()}}))}function J7(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function kO(i){if(!/^0x[a-fA-F0-9]{40}$/.test(i))throw new Error(`@supabase/auth-js: Address "${i}" is invalid.`);return i.toLowerCase()}function eZ(i){return parseInt(i,16)}function tZ(i){const n=new TextEncoder().encode(i);return"0x"+Array.from(n,d=>d.toString(16).padStart(2,"0")).join("")}function rZ(i){var n;const{chainId:a,domain:d,expirationTime:y,issuedAt:v=new Date,nonce:C,notBefore:s,requestId:M,resources:L,scheme:F,uri:W,version:X}=i;{if(!Number.isInteger(a))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${a}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(C&&C.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${C}`);if(!W)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(X!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${X}`);if(!((n=i.statement)===null||n===void 0)&&n.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${i.statement}`)}const ee=kO(i.address),he=F?`${F}://${d}`:d,se=i.statement?`${i.statement}
`:"",oe=`${he} wants you to sign in with your Ethereum account:
${ee}

${se}`;let ve=`URI: ${W}
Version: ${X}
Chain ID: ${a}${C?`
Nonce: ${C}`:""}
Issued At: ${v.toISOString()}`;if(y&&(ve+=`
Expiration Time: ${y.toISOString()}`),s&&(ve+=`
Not Before: ${s.toISOString()}`),M&&(ve+=`
Request ID: ${M}`),L){let me=`
Resources:`;for(const Se of L){if(!Se||typeof Se!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Se}`);me+=`
- ${Se}`}ve+=me}return`${oe}
${ve}`}class _a extends Error{constructor({message:n,code:a,cause:d,name:y}){var v;super(n,{cause:d}),this.__isWebAuthnError=!0,this.name=(v=y??(d instanceof Error?d.name:void 0))!==null&&v!==void 0?v:"Unknown Error",this.code=a}}class k0 extends _a{constructor(n,a){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a,message:n}),this.name="WebAuthnUnknownError",this.originalError=a}}function nZ({error:i,options:n}){var a,d,y;const{publicKey:v}=n;if(!v)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(n.signal instanceof AbortSignal)return new _a({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else if(i.name==="ConstraintError"){if(((a=v.authenticatorSelection)===null||a===void 0?void 0:a.requireResidentKey)===!0)return new _a({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:i});if(n.mediation==="conditional"&&((d=v.authenticatorSelection)===null||d===void 0?void 0:d.userVerification)==="required")return new _a({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:i});if(((y=v.authenticatorSelection)===null||y===void 0?void 0:y.userVerification)==="required")return new _a({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:i})}else{if(i.name==="InvalidStateError")return new _a({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:i});if(i.name==="NotAllowedError")return new _a({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="NotSupportedError")return v.pubKeyCredParams.filter(s=>s.type==="public-key").length===0?new _a({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:i}):new _a({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:i});if(i.name==="SecurityError"){const C=window.location.hostname;if(NO(C)){if(v.rp.id!==C)return new _a({message:`The RP ID "${v.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new _a({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="TypeError"){if(v.user.id.byteLength<1||v.user.id.byteLength>64)return new _a({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:i})}else if(i.name==="UnknownError")return new _a({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new _a({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}function iZ({error:i,options:n}){const{publicKey:a}=n;if(!a)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(n.signal instanceof AbortSignal)return new _a({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else{if(i.name==="NotAllowedError")return new _a({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="SecurityError"){const d=window.location.hostname;if(NO(d)){if(a.rpId!==d)return new _a({message:`The RP ID "${a.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new _a({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="UnknownError")return new _a({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new _a({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}class sZ{createNewAbortSignal(){if(this.controller){const a=new Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}const n=new AbortController;return this.controller=n,n.signal}cancelCeremony(){if(this.controller){const n=new Error("Manually cancelling existing WebAuthn API call");n.name="AbortError",this.controller.abort(n),this.controller=void 0}}}const oZ=new sZ;function aZ(i){if(!i)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(i);const{challenge:n,user:a,excludeCredentials:d}=i,y=Sm(i,["challenge","user","excludeCredentials"]),v=Wy(n).buffer,C=Object.assign(Object.assign({},a),{id:Wy(a.id).buffer}),s=Object.assign(Object.assign({},y),{challenge:v,user:C});if(d&&d.length>0){s.excludeCredentials=new Array(d.length);for(let M=0;M<d.length;M++){const L=d[M];s.excludeCredentials[M]=Object.assign(Object.assign({},L),{id:Wy(L.id).buffer,type:L.type||"public-key",transports:L.transports})}}return s}function lZ(i){if(!i)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(i);const{challenge:n,allowCredentials:a}=i,d=Sm(i,["challenge","allowCredentials"]),y=Wy(n).buffer,v=Object.assign(Object.assign({},d),{challenge:y});if(a&&a.length>0){v.allowCredentials=new Array(a.length);for(let C=0;C<a.length;C++){const s=a[C];v.allowCredentials[C]=Object.assign(Object.assign({},s),{id:Wy(s.id).buffer,type:s.type||"public-key",transports:s.transports})}}return v}function cZ(i){var n;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const a=i;return{id:i.id,rawId:i.id,response:{attestationObject:Sg(new Uint8Array(i.response.attestationObject)),clientDataJSON:Sg(new Uint8Array(i.response.clientDataJSON))},type:"public-key",clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:(n=a.authenticatorAttachment)!==null&&n!==void 0?n:void 0}}function uZ(i){var n;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const a=i,d=i.getClientExtensionResults(),y=i.response;return{id:i.id,rawId:i.id,response:{authenticatorData:Sg(new Uint8Array(y.authenticatorData)),clientDataJSON:Sg(new Uint8Array(y.clientDataJSON)),signature:Sg(new Uint8Array(y.signature)),userHandle:y.userHandle?Sg(new Uint8Array(y.userHandle)):void 0},type:"public-key",clientExtensionResults:d,authenticatorAttachment:(n=a.authenticatorAttachment)!==null&&n!==void 0?n:void 0}}function NO(i){return i==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(i)}function $j(){var i,n;return!!(Hl()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((i=navigator?.credentials)===null||i===void 0?void 0:i.create)=="function"&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.get)=="function")}async function dZ(i){try{const n=await navigator.credentials.create(i);return n?n instanceof PublicKeyCredential?{data:n,error:null}:{data:null,error:new k0("Browser returned unexpected credential type",n)}:{data:null,error:new k0("Empty credential response",n)}}catch(n){return{data:null,error:nZ({error:n,options:i})}}}async function hZ(i){try{const n=await navigator.credentials.get(i);return n?n instanceof PublicKeyCredential?{data:n,error:null}:{data:null,error:new k0("Browser returned unexpected credential type",n)}:{data:null,error:new k0("Empty credential response",n)}}catch(n){return{data:null,error:iZ({error:n,options:i})}}}const fZ={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},pZ={userVerification:"preferred",hints:["security-key"]};function N0(...i){const n=y=>y!==null&&typeof y=="object"&&!Array.isArray(y),a=y=>y instanceof ArrayBuffer||ArrayBuffer.isView(y),d={};for(const y of i)if(y)for(const v in y){const C=y[v];if(C!==void 0)if(Array.isArray(C))d[v]=C;else if(a(C))d[v]=C;else if(n(C)){const s=d[v];n(s)?d[v]=N0(s,C):d[v]=N0(C)}else d[v]=C}return d}function mZ(i,n){return N0(fZ,i,n||{})}function gZ(i,n){return N0(pZ,i,n||{})}class yZ{constructor(n){this.client=n,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(n){return this.client.mfa.enroll(Object.assign(Object.assign({},n),{factorType:"webauthn"}))}async _challenge({factorId:n,webauthn:a,friendlyName:d,signal:y},v){try{const{data:C,error:s}=await this.client.mfa.challenge({factorId:n,webauthn:a});if(!C)return{data:null,error:s};const M=y??oZ.createNewAbortSignal();if(C.webauthn.type==="create"){const{user:L}=C.webauthn.credential_options.publicKey;L.name||(L.name=`${L.id}:${d}`),L.displayName||(L.displayName=L.name)}switch(C.webauthn.type){case"create":{const L=mZ(C.webauthn.credential_options.publicKey,v?.create),{data:F,error:W}=await dZ({publicKey:L,signal:M});return F?{data:{factorId:n,challengeId:C.id,webauthn:{type:C.webauthn.type,credential_response:F}},error:null}:{data:null,error:W}}case"request":{const L=gZ(C.webauthn.credential_options.publicKey,v?.request),{data:F,error:W}=await hZ(Object.assign(Object.assign({},C.webauthn.credential_options),{publicKey:L,signal:M}));return F?{data:{factorId:n,challengeId:C.id,webauthn:{type:C.webauthn.type,credential_response:F}},error:null}:{data:null,error:W}}}}catch(C){return qn(C)?{data:null,error:C}:{data:null,error:new bg("Unexpected error in challenge",C)}}}async _verify({challengeId:n,factorId:a,webauthn:d}){return this.client.mfa.verify({factorId:a,challengeId:n,webauthn:d})}async _authenticate({factorId:n,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:d=typeof window<"u"?[window.location.origin]:void 0,signal:y}},v){if(!a)return{data:null,error:new Xx("rpId is required for WebAuthn authentication")};try{if(!$j())return{data:null,error:new bg("Browser does not support WebAuthn",null)};const{data:C,error:s}=await this.challenge({factorId:n,webauthn:{rpId:a,rpOrigins:d},signal:y},{request:v});if(!C)return{data:null,error:s};const{webauthn:M}=C;return this._verify({factorId:n,challengeId:C.challengeId,webauthn:{type:M.type,rpId:a,rpOrigins:d,credential_response:M.credential_response}})}catch(C){return qn(C)?{data:null,error:C}:{data:null,error:new bg("Unexpected error in authenticate",C)}}}async _register({friendlyName:n,rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:d=typeof window<"u"?[window.location.origin]:void 0,signal:y},v){if(!a)return{data:null,error:new Xx("rpId is required for WebAuthn registration")};try{if(!$j())return{data:null,error:new bg("Browser does not support WebAuthn",null)};const{data:C,error:s}=await this._enroll({friendlyName:n});if(!C)return await this.client.mfa.listFactors().then(F=>{var W;return(W=F.data)===null||W===void 0?void 0:W.all.find(X=>X.factor_type==="webauthn"&&X.friendly_name===n&&X.status!=="unverified")}).then(F=>F?this.client.mfa.unenroll({factorId:F?.id}):void 0),{data:null,error:s};const{data:M,error:L}=await this._challenge({factorId:C.id,friendlyName:C.friendly_name,webauthn:{rpId:a,rpOrigins:d},signal:y},{create:v});return M?this._verify({factorId:C.id,challengeId:M.challengeId,webauthn:{rpId:a,rpOrigins:d,type:M.webauthn.type,credential_response:M.webauthn.credential_response}}):{data:null,error:L}}catch(C){return qn(C)?{data:null,error:C}:{data:null,error:new bg("Unexpected error in register",C)}}}}J7();const _Z={url:p7,storageKey:m7,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:g7,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function qj(i,n,a){return await a()}const Iy={};class Kx{get jwks(){var n,a;return(a=(n=Iy[this.storageKey])===null||n===void 0?void 0:n.jwks)!==null&&a!==void 0?a:{keys:[]}}set jwks(n){Iy[this.storageKey]=Object.assign(Object.assign({},Iy[this.storageKey]),{jwks:n})}get jwks_cached_at(){var n,a;return(a=(n=Iy[this.storageKey])===null||n===void 0?void 0:n.cachedAt)!==null&&a!==void 0?a:Number.MIN_SAFE_INTEGER}set jwks_cached_at(n){Iy[this.storageKey]=Object.assign(Object.assign({},Iy[this.storageKey]),{cachedAt:n})}constructor(n){var a,d;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Kx.nextInstanceID,Kx.nextInstanceID+=1,this.instanceID>0&&Hl()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const y=Object.assign(Object.assign({},_Z),n);if(this.logDebugMessages=!!y.debug,typeof y.debug=="function"&&(this.logger=y.debug),this.persistSession=y.persistSession,this.storageKey=y.storageKey,this.autoRefreshToken=y.autoRefreshToken,this.admin=new K7({url:y.url,headers:y.headers,fetch:y.fetch}),this.url=y.url,this.headers=y.headers,this.fetch=IO(y.fetch),this.lock=y.lock||qj,this.detectSessionInUrl=y.detectSessionInUrl,this.flowType=y.flowType,this.hasCustomAuthorizationHeader=y.hasCustomAuthorizationHeader,y.lock?this.lock=y.lock:Hl()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=Q7:this.lock=qj,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new yZ(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(y.storage?this.storage=y.storage:AO()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Uj(this.memoryStorage)),y.userStorage&&(this.userStorage=y.userStorage)):(this.memoryStorage={},this.storage=Uj(this.memoryStorage)),Hl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(v){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",v)}(d=this.broadcastChannel)===null||d===void 0||d.addEventListener("message",async v=>{this._debug("received broadcast notification from other tab or client",v),await this._notifyAllSubscribers(v.data.event,v.data.session,!1)})}this.initialize()}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${TO}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var n;try{const a=k7(window.location.href);let d="none";if(this._isImplicitGrantCallback(a)?d="implicit":await this._isPKCECallback(a)&&(d="pkce"),Hl()&&this.detectSessionInUrl&&d!=="none"){const{data:y,error:v}=await this._getSessionFromURL(a,d);if(v){if(this._debug("#_initialize()","error detecting session from URL",v),w7(v)){const M=(n=v.details)===null||n===void 0?void 0:n.code;if(M==="identity_already_exists"||M==="identity_not_found"||M==="single_identity_not_deletable")return{error:v}}return await this._removeSession(),{error:v}}const{session:C,redirectType:s}=y;return this._debug("#_initialize()","detected session in URL",C,"redirect type",s),await this._saveSession(C),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",C):await this._notifyAllSubscribers("SIGNED_IN",C)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(a){return qn(a)?{error:a}:{error:new bg("Unexpected error during initialization",a)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var a,d,y;try{const v=await wi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(d=(a=n?.options)===null||a===void 0?void 0:a.data)!==null&&d!==void 0?d:{},gotrue_meta_security:{captcha_token:(y=n?.options)===null||y===void 0?void 0:y.captchaToken}},xform:_d}),{data:C,error:s}=v;if(s||!C)return{data:{user:null,session:null},error:s};const M=C.session,L=C.user;return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",M)),{data:{user:L,session:M},error:null}}catch(v){if(qn(v))return{data:{user:null,session:null},error:v};throw v}}async signUp(n){var a,d,y;try{let v;if("email"in n){const{email:F,password:W,options:X}=n;let ee=null,he=null;this.flowType==="pkce"&&([ee,he]=await Ey(this.storage,this.storageKey)),v=await wi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:X?.emailRedirectTo,body:{email:F,password:W,data:(a=X?.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:X?.captchaToken},code_challenge:ee,code_challenge_method:he},xform:_d})}else if("phone"in n){const{phone:F,password:W,options:X}=n;v=await wi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:F,password:W,data:(d=X?.data)!==null&&d!==void 0?d:{},channel:(y=X?.channel)!==null&&y!==void 0?y:"sms",gotrue_meta_security:{captcha_token:X?.captchaToken}},xform:_d})}else throw new Xb("You must provide either an email or phone number and a password");const{data:C,error:s}=v;if(s||!C)return{data:{user:null,session:null},error:s};const M=C.session,L=C.user;return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",M)),{data:{user:L,session:M},error:null}}catch(v){if(qn(v))return{data:{user:null,session:null},error:v};throw v}}async signInWithPassword(n){try{let a;if("email"in n){const{email:v,password:C,options:s}=n;a=await wi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:v,password:C,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Bj})}else if("phone"in n){const{phone:v,password:C,options:s}=n;a=await wi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:v,password:C,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Bj})}else throw new Xb("You must provide either an email or phone number and a password");const{data:d,error:y}=a;return y?{data:{user:null,session:null},error:y}:!d||!d.session||!d.user?{data:{user:null,session:null},error:new Ty}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:Object.assign({user:d.user,session:d.session},d.weak_password?{weakPassword:d.weak_password}:null),error:y})}catch(a){if(qn(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOAuth(n){var a,d,y,v;return await this._handleProviderSignIn(n.provider,{redirectTo:(a=n.options)===null||a===void 0?void 0:a.redirectTo,scopes:(d=n.options)===null||d===void 0?void 0:d.scopes,queryParams:(y=n.options)===null||y===void 0?void 0:y.queryParams,skipBrowserRedirect:(v=n.options)===null||v===void 0?void 0:v.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async signInWithWeb3(n){const{chain:a}=n;switch(a){case"ethereum":return await this.signInWithEthereum(n);case"solana":return await this.signInWithSolana(n);default:throw new Error(`@supabase/auth-js: Unsupported chain "${a}"`)}}async signInWithEthereum(n){var a,d,y,v,C,s,M,L,F,W,X;let ee,he;if("message"in n)ee=n.message,he=n.signature;else{const{chain:se,wallet:oe,statement:ve,options:me}=n;let Se;if(Hl())if(typeof oe=="object")Se=oe;else{const Ht=window;if("ethereum"in Ht&&typeof Ht.ethereum=="object"&&"request"in Ht.ethereum&&typeof Ht.ethereum.request=="function")Se=Ht.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof oe!="object"||!me?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Se=oe}const Re=new URL((a=me?.url)!==null&&a!==void 0?a:window.location.href),Be=await Se.request({method:"eth_requestAccounts"}).then(Ht=>Ht).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Be||Be.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const rt=kO(Be[0]);let We=(d=me?.signInWithEthereum)===null||d===void 0?void 0:d.chainId;if(!We){const Ht=await Se.request({method:"eth_chainId"});We=eZ(Ht)}const Ct={domain:Re.host,address:rt,statement:ve,uri:Re.href,version:"1",chainId:We,nonce:(y=me?.signInWithEthereum)===null||y===void 0?void 0:y.nonce,issuedAt:(C=(v=me?.signInWithEthereum)===null||v===void 0?void 0:v.issuedAt)!==null&&C!==void 0?C:new Date,expirationTime:(s=me?.signInWithEthereum)===null||s===void 0?void 0:s.expirationTime,notBefore:(M=me?.signInWithEthereum)===null||M===void 0?void 0:M.notBefore,requestId:(L=me?.signInWithEthereum)===null||L===void 0?void 0:L.requestId,resources:(F=me?.signInWithEthereum)===null||F===void 0?void 0:F.resources};ee=rZ(Ct),he=await Se.request({method:"personal_sign",params:[tZ(ee),rt]})}try{const{data:se,error:oe}=await wi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:ee,signature:he},!((W=n.options)===null||W===void 0)&&W.captchaToken?{gotrue_meta_security:{captcha_token:(X=n.options)===null||X===void 0?void 0:X.captchaToken}}:null),xform:_d});if(oe)throw oe;return!se||!se.session||!se.user?{data:{user:null,session:null},error:new Ty}:(se.session&&(await this._saveSession(se.session),await this._notifyAllSubscribers("SIGNED_IN",se.session)),{data:Object.assign({},se),error:oe})}catch(se){if(qn(se))return{data:{user:null,session:null},error:se};throw se}}async signInWithSolana(n){var a,d,y,v,C,s,M,L,F,W,X,ee;let he,se;if("message"in n)he=n.message,se=n.signature;else{const{chain:oe,wallet:ve,statement:me,options:Se}=n;let Re;if(Hl())if(typeof ve=="object")Re=ve;else{const rt=window;if("solana"in rt&&typeof rt.solana=="object"&&("signIn"in rt.solana&&typeof rt.solana.signIn=="function"||"signMessage"in rt.solana&&typeof rt.solana.signMessage=="function"))Re=rt.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof ve!="object"||!Se?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Re=ve}const Be=new URL((a=Se?.url)!==null&&a!==void 0?a:window.location.href);if("signIn"in Re&&Re.signIn){const rt=await Re.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Se?.signInWithSolana),{version:"1",domain:Be.host,uri:Be.href}),me?{statement:me}:null));let We;if(Array.isArray(rt)&&rt[0]&&typeof rt[0]=="object")We=rt[0];else if(rt&&typeof rt=="object"&&"signedMessage"in rt&&"signature"in rt)We=rt;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in We&&"signature"in We&&(typeof We.signedMessage=="string"||We.signedMessage instanceof Uint8Array)&&We.signature instanceof Uint8Array)he=typeof We.signedMessage=="string"?We.signedMessage:new TextDecoder().decode(We.signedMessage),se=We.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Re)||typeof Re.signMessage!="function"||!("publicKey"in Re)||typeof Re!="object"||!Re.publicKey||!("toBase58"in Re.publicKey)||typeof Re.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");he=[`${Be.host} wants you to sign in with your Solana account:`,Re.publicKey.toBase58(),...me?["",me,""]:[""],"Version: 1",`URI: ${Be.href}`,`Issued At: ${(y=(d=Se?.signInWithSolana)===null||d===void 0?void 0:d.issuedAt)!==null&&y!==void 0?y:new Date().toISOString()}`,...!((v=Se?.signInWithSolana)===null||v===void 0)&&v.notBefore?[`Not Before: ${Se.signInWithSolana.notBefore}`]:[],...!((C=Se?.signInWithSolana)===null||C===void 0)&&C.expirationTime?[`Expiration Time: ${Se.signInWithSolana.expirationTime}`]:[],...!((s=Se?.signInWithSolana)===null||s===void 0)&&s.chainId?[`Chain ID: ${Se.signInWithSolana.chainId}`]:[],...!((M=Se?.signInWithSolana)===null||M===void 0)&&M.nonce?[`Nonce: ${Se.signInWithSolana.nonce}`]:[],...!((L=Se?.signInWithSolana)===null||L===void 0)&&L.requestId?[`Request ID: ${Se.signInWithSolana.requestId}`]:[],...!((W=(F=Se?.signInWithSolana)===null||F===void 0?void 0:F.resources)===null||W===void 0)&&W.length?["Resources",...Se.signInWithSolana.resources.map(We=>`- ${We}`)]:[]].join(`
`);const rt=await Re.signMessage(new TextEncoder().encode(he),"utf8");if(!rt||!(rt instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");se=rt}}try{const{data:oe,error:ve}=await wi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:he,signature:Sg(se)},!((X=n.options)===null||X===void 0)&&X.captchaToken?{gotrue_meta_security:{captcha_token:(ee=n.options)===null||ee===void 0?void 0:ee.captchaToken}}:null),xform:_d});if(ve)throw ve;return!oe||!oe.session||!oe.user?{data:{user:null,session:null},error:new Ty}:(oe.session&&(await this._saveSession(oe.session),await this._notifyAllSubscribers("SIGNED_IN",oe.session)),{data:Object.assign({},oe),error:ve})}catch(oe){if(qn(oe))return{data:{user:null,session:null},error:oe};throw oe}}async _exchangeCodeForSession(n){const a=await pg(this.storage,`${this.storageKey}-code-verifier`),[d,y]=(a??"").split("/");try{const{data:v,error:C}=await wi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:d},xform:_d});if(await im(this.storage,`${this.storageKey}-code-verifier`),C)throw C;return!v||!v.session||!v.user?{data:{user:null,session:null,redirectType:null},error:new Ty}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign(Object.assign({},v),{redirectType:y??null}),error:C})}catch(v){if(qn(v))return{data:{user:null,session:null,redirectType:null},error:v};throw v}}async signInWithIdToken(n){try{const{options:a,provider:d,token:y,access_token:v,nonce:C}=n,s=await wi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:d,id_token:y,access_token:v,nonce:C,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:_d}),{data:M,error:L}=s;return L?{data:{user:null,session:null},error:L}:!M||!M.session||!M.user?{data:{user:null,session:null},error:new Ty}:(M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",M.session)),{data:M,error:L})}catch(a){if(qn(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOtp(n){var a,d,y,v,C;try{if("email"in n){const{email:s,options:M}=n;let L=null,F=null;this.flowType==="pkce"&&([L,F]=await Ey(this.storage,this.storageKey));const{error:W}=await wi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:(a=M?.data)!==null&&a!==void 0?a:{},create_user:(d=M?.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:M?.captchaToken},code_challenge:L,code_challenge_method:F},redirectTo:M?.emailRedirectTo});return{data:{user:null,session:null},error:W}}if("phone"in n){const{phone:s,options:M}=n,{data:L,error:F}=await wi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:s,data:(y=M?.data)!==null&&y!==void 0?y:{},create_user:(v=M?.shouldCreateUser)!==null&&v!==void 0?v:!0,gotrue_meta_security:{captcha_token:M?.captchaToken},channel:(C=M?.channel)!==null&&C!==void 0?C:"sms"}});return{data:{user:null,session:null,messageId:L?.message_id},error:F}}throw new Xb("You must provide either an email or phone number.")}catch(s){if(qn(s))return{data:{user:null,session:null},error:s};throw s}}async verifyOtp(n){var a,d;try{let y,v;"options"in n&&(y=(a=n.options)===null||a===void 0?void 0:a.redirectTo,v=(d=n.options)===null||d===void 0?void 0:d.captchaToken);const{data:C,error:s}=await wi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:v}}),redirectTo:y,xform:_d});if(s)throw s;if(!C)throw new Error("An error occurred on token verification.");const M=C.session,L=C.user;return M?.access_token&&(await this._saveSession(M),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",M)),{data:{user:L,session:M},error:null}}catch(y){if(qn(y))return{data:{user:null,session:null},error:y};throw y}}async signInWithSSO(n){var a,d,y;try{let v=null,C=null;return this.flowType==="pkce"&&([v,C]=await Ey(this.storage,this.storageKey)),await wi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(d=(a=n.options)===null||a===void 0?void 0:a.redirectTo)!==null&&d!==void 0?d:void 0}),!((y=n?.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:v,code_challenge_method:C}),headers:this.headers,xform:H7})}catch(v){if(qn(v))return{data:null,error:v};throw v}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:a},error:d}=n;if(d)throw d;if(!a)throw new yd;const{error:y}=await wi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:a.access_token});return{data:{user:null,session:null},error:y}})}catch(n){if(qn(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const a=`${this.url}/resend`;if("email"in n){const{email:d,type:y,options:v}=n,{error:C}=await wi(this.fetch,"POST",a,{headers:this.headers,body:{email:d,type:y,gotrue_meta_security:{captcha_token:v?.captchaToken}},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:C}}else if("phone"in n){const{phone:d,type:y,options:v}=n,{data:C,error:s}=await wi(this.fetch,"POST",a,{headers:this.headers,body:{phone:d,type:y,gotrue_meta_security:{captcha_token:v?.captchaToken}}});return{data:{user:null,session:null,messageId:C?.message_id},error:s}}throw new Xb("You must provide either an email or phone number and a type")}catch(a){if(qn(a))return{data:{user:null,session:null},error:a};throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(n,a){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const d=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),y=(async()=>(await d,await a()))();return this.pendingInLock.push((async()=>{try{await y}catch{}})()),y}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const d=a();for(this.pendingInLock.push((async()=>{try{await d}catch{}})()),await d;this.pendingInLock.length;){const y=[...this.pendingInLock];await Promise.all(y),this.pendingInLock.splice(0,y.length)}return await d}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const a=await this.__loadSession();return await n(a)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const a=await pg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",a),a!==null&&(this._isValidSession(a)?n=a:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const d=n.expires_at?n.expires_at*1e3-Date.now()<$S:!1;if(this._debug("#__loadSession()",`session has${d?"":" not"} expired`,"expires_at",n.expires_at),!d){if(this.userStorage){const C=await pg(this.userStorage,this.storageKey+"-user");C?.user?n.user=C.user:n.user=WS()}if(this.storage.isServer&&n.user&&!n.user.__isUserNotAvailableProxy){const C={value:this.suppressGetSessionWarning};n.user=$7(n.user,C),C.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:n},error:null}}const{data:y,error:v}=await this._callRefreshToken(n.refresh_token);return v?{data:{session:null},error:v}:{data:{session:y},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await wi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:um}):await this._useSession(async a=>{var d,y,v;const{data:C,error:s}=a;if(s)throw s;return!(!((d=C.session)===null||d===void 0)&&d.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new yd}:await wi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(v=(y=C.session)===null||y===void 0?void 0:y.access_token)!==null&&v!==void 0?v:void 0,xform:um})})}catch(a){if(qn(a))return b7(a)&&(await this._removeSession(),await im(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:a};throw a}}async updateUser(n,a={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,a))}async _updateUser(n,a={}){try{return await this._useSession(async d=>{const{data:y,error:v}=d;if(v)throw v;if(!y.session)throw new yd;const C=y.session;let s=null,M=null;this.flowType==="pkce"&&n.email!=null&&([s,M]=await Ey(this.storage,this.storageKey));const{data:L,error:F}=await wi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:a?.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:s,code_challenge_method:M}),jwt:C.access_token,xform:um});if(F)throw F;return C.user=L.user,await this._saveSession(C),await this._notifyAllSubscribers("USER_UPDATED",C),{data:{user:C.user},error:null}})}catch(d){if(qn(d))return{data:{user:null},error:d};throw d}}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new yd;const a=Date.now()/1e3;let d=a,y=!0,v=null;const{payload:C}=GS(n.access_token);if(C.exp&&(d=C.exp,y=d<=a),y){const{data:s,error:M}=await this._callRefreshToken(n.refresh_token);if(M)return{data:{user:null,session:null},error:M};if(!s)return{data:{user:null,session:null},error:null};v=s}else{const{data:s,error:M}=await this._getUser(n.access_token);if(M)throw M;v={access_token:n.access_token,refresh_token:n.refresh_token,user:s.user,token_type:"bearer",expires_in:d-a,expires_at:d},await this._saveSession(v),await this._notifyAllSubscribers("SIGNED_IN",v)}return{data:{user:v.user,session:v},error:null}}catch(a){if(qn(a))return{data:{session:null,user:null},error:a};throw a}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async a=>{var d;if(!n){const{data:C,error:s}=a;if(s)throw s;n=(d=C.session)!==null&&d!==void 0?d:void 0}if(!n?.refresh_token)throw new yd;const{data:y,error:v}=await this._callRefreshToken(n.refresh_token);return v?{data:{user:null,session:null},error:v}:y?{data:{user:y.user,session:y},error:null}:{data:{user:null,session:null},error:null}})}catch(a){if(qn(a))return{data:{user:null,session:null},error:a};throw a}}async _getSessionFromURL(n,a){try{if(!Hl())throw new Kb("No browser detected.");if(n.error||n.error_description||n.error_code)throw new Kb(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});switch(a){case"implicit":if(this.flowType==="pkce")throw new Rj("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Kb("Not a valid implicit grant flow url.");break;default:}if(a==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!n.code)throw new Rj("No code detected.");const{data:me,error:Se}=await this._exchangeCodeForSession(n.code);if(Se)throw Se;const Re=new URL(window.location.href);return Re.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Re.toString()),{data:{session:me.session,redirectType:null},error:null}}const{provider_token:d,provider_refresh_token:y,access_token:v,refresh_token:C,expires_in:s,expires_at:M,token_type:L}=n;if(!v||!s||!C||!L)throw new Kb("No session defined in URL");const F=Math.round(Date.now()/1e3),W=parseInt(s);let X=F+W;M&&(X=parseInt(M));const ee=X-F;ee*1e3<=My&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${ee}s, should have been closer to ${W}s`);const he=X-W;F-he>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",he,X,F):F-he<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",he,X,F);const{data:se,error:oe}=await this._getUser(v);if(oe)throw oe;const ve={provider_token:d,provider_refresh_token:y,access_token:v,expires_in:W,expires_at:X,refresh_token:C,token_type:L,user:se.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ve,redirectType:n.type},error:null}}catch(d){if(qn(d))return{data:{session:null,redirectType:null},error:d};throw d}}_isImplicitGrantCallback(n){return!!(n.access_token||n.error_description)}async _isPKCECallback(n){const a=await pg(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&a)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async a=>{var d;const{data:y,error:v}=a;if(v)return{error:v};const C=(d=y.session)===null||d===void 0?void 0:d.access_token;if(C){const{error:s}=await this.admin.signOut(C,n);if(s&&!(v7(s)&&(s.status===404||s.status===401||s.status===403)))return{error:s}}return n!=="others"&&(await this._removeSession(),await im(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(n){const a=P7(),d={id:a,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",a),this.stateChangeEmitters.delete(a)}};return this._debug("#onAuthStateChange()","registered callback with id",a),this.stateChangeEmitters.set(a,d),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(a)})))(),{data:{subscription:d}}}async _emitInitialSession(n){return await this._useSession(async a=>{var d,y;try{const{data:{session:v},error:C}=a;if(C)throw C;await((d=this.stateChangeEmitters.get(n))===null||d===void 0?void 0:d.callback("INITIAL_SESSION",v)),this._debug("INITIAL_SESSION","callback id",n,"session",v)}catch(v){await((y=this.stateChangeEmitters.get(n))===null||y===void 0?void 0:y.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",v),console.error(v)}})}async resetPasswordForEmail(n,a={}){let d=null,y=null;this.flowType==="pkce"&&([d,y]=await Ey(this.storage,this.storageKey,!0));try{return await wi(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:d,code_challenge_method:y,gotrue_meta_security:{captcha_token:a.captchaToken}},headers:this.headers,redirectTo:a.redirectTo})}catch(v){if(qn(v))return{data:null,error:v};throw v}}async getUserIdentities(){var n;try{const{data:a,error:d}=await this.getUser();if(d)throw d;return{data:{identities:(n=a.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(a){if(qn(a))return{data:null,error:a};throw a}}async linkIdentity(n){return"token"in n?this.linkIdentityIdToken(n):this.linkIdentityOAuth(n)}async linkIdentityOAuth(n){var a;try{const{data:d,error:y}=await this._useSession(async v=>{var C,s,M,L,F;const{data:W,error:X}=v;if(X)throw X;const ee=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(C=n.options)===null||C===void 0?void 0:C.redirectTo,scopes:(s=n.options)===null||s===void 0?void 0:s.scopes,queryParams:(M=n.options)===null||M===void 0?void 0:M.queryParams,skipBrowserRedirect:!0});return await wi(this.fetch,"GET",ee,{headers:this.headers,jwt:(F=(L=W.session)===null||L===void 0?void 0:L.access_token)!==null&&F!==void 0?F:void 0})});if(y)throw y;return Hl()&&!(!((a=n.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(d?.url),{data:{provider:n.provider,url:d?.url},error:null}}catch(d){if(qn(d))return{data:{provider:n.provider,url:null},error:d};throw d}}async linkIdentityIdToken(n){return await this._useSession(async a=>{var d;try{const{error:y,data:{session:v}}=a;if(y)throw y;const{options:C,provider:s,token:M,access_token:L,nonce:F}=n,W=await wi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(d=v?.access_token)!==null&&d!==void 0?d:void 0,body:{provider:s,id_token:M,access_token:L,nonce:F,link_identity:!0,gotrue_meta_security:{captcha_token:C?.captchaToken}},xform:_d}),{data:X,error:ee}=W;return ee?{data:{user:null,session:null},error:ee}:!X||!X.session||!X.user?{data:{user:null,session:null},error:new Ty}:(X.session&&(await this._saveSession(X.session),await this._notifyAllSubscribers("USER_UPDATED",X.session)),{data:X,error:ee})}catch(y){if(qn(y))return{data:{user:null,session:null},error:y};throw y}})}async unlinkIdentity(n){try{return await this._useSession(async a=>{var d,y;const{data:v,error:C}=a;if(C)throw C;return await wi(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(y=(d=v.session)===null||d===void 0?void 0:d.access_token)!==null&&y!==void 0?y:void 0})})}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _refreshAccessToken(n){const a=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(a,"begin");try{const d=Date.now();return await R7(async y=>(y>0&&await j7(200*Math.pow(2,y-1)),this._debug(a,"refreshing attempt",y),await wi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:_d})),(y,v)=>{const C=200*Math.pow(2,y);return v&&qS(v)&&Date.now()+C-d<My})}catch(d){if(this._debug(a,"error",d),qn(d))return{data:{session:null,user:null},error:d};throw d}finally{this._debug(a,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,a){const d=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",a,"url",d),Hl()&&!a.skipBrowserRedirect&&window.location.assign(d),{data:{provider:n,url:d},error:null}}async _recoverAndRefresh(){var n,a;const d="#_recoverAndRefresh()";this._debug(d,"begin");try{const y=await pg(this.storage,this.storageKey);if(y&&this.userStorage){let C=await pg(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!C&&(C={user:y.user},await Ly(this.userStorage,this.storageKey+"-user",C)),y.user=(n=C?.user)!==null&&n!==void 0?n:WS()}else if(y&&!y.user&&!y.user){const C=await pg(this.storage,this.storageKey+"-user");C&&C?.user?(y.user=C.user,await im(this.storage,this.storageKey+"-user"),await Ly(this.storage,this.storageKey,y)):y.user=WS()}if(this._debug(d,"session from storage",y),!this._isValidSession(y)){this._debug(d,"session is not valid"),y!==null&&await this._removeSession();return}const v=((a=y.expires_at)!==null&&a!==void 0?a:1/0)*1e3-Date.now()<$S;if(this._debug(d,`session has${v?"":" not"} expired with margin of ${$S}s`),v){if(this.autoRefreshToken&&y.refresh_token){const{error:C}=await this._callRefreshToken(y.refresh_token);C&&(console.error(C),qS(C)||(this._debug(d,"refresh failed with a non-retryable error, removing the session",C),await this._removeSession()))}}else if(y.user&&y.user.__isUserNotAvailableProxy===!0)try{const{data:C,error:s}=await this._getUser(y.access_token);!s&&C?.user?(y.user=C.user,await this._saveSession(y),await this._notifyAllSubscribers("SIGNED_IN",y)):this._debug(d,"could not get user data, skipping SIGNED_IN notification")}catch(C){console.error("Error getting user data:",C),this._debug(d,"error getting user data, skipping SIGNED_IN notification",C)}else await this._notifyAllSubscribers("SIGNED_IN",y)}catch(y){this._debug(d,"error",y),console.error(y);return}finally{this._debug(d,"end")}}async _callRefreshToken(n){var a,d;if(!n)throw new yd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const y=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(y,"begin");try{this.refreshingDeferred=new yw;const{data:v,error:C}=await this._refreshAccessToken(n);if(C)throw C;if(!v.session)throw new yd;await this._saveSession(v.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",v.session);const s={data:v.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(v){if(this._debug(y,"error",v),qn(v)){const C={data:null,error:v};return qS(v)||await this._removeSession(),(a=this.refreshingDeferred)===null||a===void 0||a.resolve(C),C}throw(d=this.refreshingDeferred)===null||d===void 0||d.reject(v),v}finally{this.refreshingDeferred=null,this._debug(y,"end")}}async _notifyAllSubscribers(n,a,d=!0){const y=`#_notifyAllSubscribers(${n})`;this._debug(y,"begin",a,`broadcast = ${d}`);try{this.broadcastChannel&&d&&this.broadcastChannel.postMessage({event:n,session:a});const v=[],C=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(n,a)}catch(M){v.push(M)}});if(await Promise.all(C),v.length>0){for(let s=0;s<v.length;s+=1)console.error(v[s]);throw v[0]}}finally{this._debug(y,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0;const a=Object.assign({},n),d=a.user&&a.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!d&&a.user&&await Ly(this.userStorage,this.storageKey+"-user",{user:a.user});const y=Object.assign({},a);delete y.user;const v=zj(y);await Ly(this.storage,this.storageKey,v)}else{const y=zj(a);await Ly(this.storage,this.storageKey,y)}}async _removeSession(){this._debug("#_removeSession()"),await im(this.storage,this.storageKey),await im(this.storage,this.storageKey+"-code-verifier"),await im(this.storage,this.storageKey+"-user"),this.userStorage&&await im(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&Hl()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",n)}catch(a){console.error("removing visibilitychange callback failed",a)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),My);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async a=>{const{data:{session:d}}=a;if(!d||!d.refresh_token||!d.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const y=Math.floor((d.expires_at*1e3-n)/My);this._debug("#_autoRefreshTokenTick()",`access token expires in ${y} ticks, a tick lasts ${My}ms, refresh threshold is ${YT} ticks`),y<=YT&&await this._callRefreshToken(d.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof PO)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Hl()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const a=`#_onVisibilityChanged(${n})`;this._debug(a,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(a,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,a,d){const y=[`provider=${encodeURIComponent(a)}`];if(d?.redirectTo&&y.push(`redirect_to=${encodeURIComponent(d.redirectTo)}`),d?.scopes&&y.push(`scopes=${encodeURIComponent(d.scopes)}`),this.flowType==="pkce"){const[v,C]=await Ey(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(v)}`,code_challenge_method:`${encodeURIComponent(C)}`});y.push(s.toString())}if(d?.queryParams){const v=new URLSearchParams(d.queryParams);y.push(v.toString())}return d?.skipBrowserRedirect&&y.push(`skip_http_redirect=${d.skipBrowserRedirect}`),`${n}?${y.join("&")}`}async _unenroll(n){try{return await this._useSession(async a=>{var d;const{data:y,error:v}=a;return v?{data:null,error:v}:await wi(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(d=y?.session)===null||d===void 0?void 0:d.access_token})})}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _enroll(n){try{return await this._useSession(async a=>{var d,y;const{data:v,error:C}=a;if(C)return{data:null,error:C};const s=Object.assign({friendly_name:n.friendlyName,factor_type:n.factorType},n.factorType==="phone"?{phone:n.phone}:n.factorType==="totp"?{issuer:n.issuer}:{}),{data:M,error:L}=await wi(this.fetch,"POST",`${this.url}/factors`,{body:s,headers:this.headers,jwt:(d=v?.session)===null||d===void 0?void 0:d.access_token});return L?{data:null,error:L}:(n.factorType==="totp"&&M.type==="totp"&&(!((y=M?.totp)===null||y===void 0)&&y.qr_code)&&(M.totp.qr_code=`data:image/svg+xml;utf-8,${M.totp.qr_code}`),{data:M,error:null})})}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var d;const{data:y,error:v}=a;if(v)return{data:null,error:v};const C=Object.assign({challenge_id:n.challengeId},"webauthn"in n?{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_response:n.webauthn.type==="create"?cZ(n.webauthn.credential_response):uZ(n.webauthn.credential_response)})}:{code:n.code}),{data:s,error:M}=await wi(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:C,headers:this.headers,jwt:(d=y?.session)===null||d===void 0?void 0:d.access_token});return M?{data:null,error:M}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:M})})}catch(a){if(qn(a))return{data:null,error:a};throw a}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var d;const{data:y,error:v}=a;if(v)return{data:null,error:v};const C=await wi(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{body:n,headers:this.headers,jwt:(d=y?.session)===null||d===void 0?void 0:d.access_token});if(C.error)return C;const{data:s}=C;if(s.type!=="webauthn")return{data:s,error:null};switch(s.webauthn.type){case"create":return{data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:aZ(s.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:lZ(s.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(qn(a))return{data:null,error:a};throw a}})}async _challengeAndVerify(n){const{data:a,error:d}=await this._challenge({factorId:n.factorId});return d?{data:null,error:d}:await this._verify({factorId:n.factorId,challengeId:a.id,code:n.code})}async _listFactors(){var n;const{data:{user:a},error:d}=await this.getUser();if(d)return{data:null,error:d};const y={all:[],phone:[],totp:[],webauthn:[]};for(const v of(n=a?.factors)!==null&&n!==void 0?n:[])y.all.push(v),v.status==="verified"&&y[v.factor_type].push(v);return{data:y,error:null}}async _getAuthenticatorAssuranceLevel(){var n,a;const{data:{session:d},error:y}=await this.getSession();if(y)return{data:null,error:y};if(!d)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:v}=GS(d.access_token);let C=null;v.aal&&(C=v.aal);let s=C;((a=(n=d.user.factors)===null||n===void 0?void 0:n.filter(F=>F.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(s="aal2");const L=v.amr||[];return{data:{currentLevel:C,nextLevel:s,currentAuthenticationMethods:L},error:null}}async _getAuthorizationDetails(n){try{return await this._useSession(async a=>{const{data:{session:d},error:y}=a;return y?{data:null,error:y}:d?await wi(this.fetch,"GET",`${this.url}/oauth/authorizations/${n}`,{headers:this.headers,jwt:d.access_token,xform:v=>({data:v,error:null})}):{data:null,error:new yd}})}catch(a){if(qn(a))return{data:null,error:a};throw a}}async _approveAuthorization(n,a){try{return await this._useSession(async d=>{const{data:{session:y},error:v}=d;if(v)return{data:null,error:v};if(!y)return{data:null,error:new yd};const C=await wi(this.fetch,"POST",`${this.url}/oauth/authorizations/${n}/consent`,{headers:this.headers,jwt:y.access_token,body:{action:"approve"},xform:s=>({data:s,error:null})});return C.data&&C.data.redirect_url&&Hl()&&!a?.skipBrowserRedirect&&window.location.assign(C.data.redirect_url),C})}catch(d){if(qn(d))return{data:null,error:d};throw d}}async _denyAuthorization(n,a){try{return await this._useSession(async d=>{const{data:{session:y},error:v}=d;if(v)return{data:null,error:v};if(!y)return{data:null,error:new yd};const C=await wi(this.fetch,"POST",`${this.url}/oauth/authorizations/${n}/consent`,{headers:this.headers,jwt:y.access_token,body:{action:"deny"},xform:s=>({data:s,error:null})});return C.data&&C.data.redirect_url&&Hl()&&!a?.skipBrowserRedirect&&window.location.assign(C.data.redirect_url),C})}catch(d){if(qn(d))return{data:null,error:d};throw d}}async fetchJwk(n,a={keys:[]}){let d=a.keys.find(s=>s.kid===n);if(d)return d;const y=Date.now();if(d=this.jwks.keys.find(s=>s.kid===n),d&&this.jwks_cached_at+_7>y)return d;const{data:v,error:C}=await wi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(C)throw C;return!v.keys||v.keys.length===0||(this.jwks=v,this.jwks_cached_at=y,d=v.keys.find(s=>s.kid===n),!d)?null:d}async getClaims(n,a={}){try{let d=n;if(!d){const{data:ee,error:he}=await this.getSession();if(he||!ee.session)return{data:null,error:he};d=ee.session.access_token}const{header:y,payload:v,signature:C,raw:{header:s,payload:M}}=GS(d);a?.allowExpired||B7(v.exp);const L=!y.alg||y.alg.startsWith("HS")||!y.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(y.kid,a?.keys?{keys:a.keys}:a?.jwks);if(!L){const{error:ee}=await this.getUser(d);if(ee)throw ee;return{data:{claims:v,header:y,signature:C},error:null}}const F=V7(y.alg),W=await crypto.subtle.importKey("jwk",L,F,!0,["verify"]);if(!await crypto.subtle.verify(F,W,C,A7(`${s}.${M}`)))throw new e2("Invalid JWT signature");return{data:{claims:v,header:y,signature:C},error:null}}catch(d){if(qn(d))return{data:null,error:d};throw d}}}Kx.nextInstanceID=0;const xZ=Kx;class vZ extends xZ{constructor(n){super(n)}}class bZ{constructor(n,a,d){var y,v,C;this.supabaseUrl=n,this.supabaseKey=a;const s=f7(n);if(!a)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",s),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",s),this.storageUrl=new URL("storage/v1",s),this.functionsUrl=new URL("functions/v1",s);const M=`sb-${s.hostname.split(".")[0]}-auth-token`,L={db:s7,realtime:a7,auth:Object.assign(Object.assign({},o7),{storageKey:M}),global:i7},F=h7(d??{},L);this.storageKey=(y=F.auth.storageKey)!==null&&y!==void 0?y:"",this.headers=(v=F.global.headers)!==null&&v!==void 0?v:{},F.accessToken?(this.accessToken=F.accessToken,this.auth=new Proxy({},{get:(W,X)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(X)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((C=F.auth)!==null&&C!==void 0?C:{},this.headers,F.global.fetch),this.fetch=u7(a,this._getAccessToken.bind(this),F.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},F.realtime)),this.rest=new p9(new URL("rest/v1",s).href,{headers:this.headers,schema:F.db.schema,fetch:this.fetch}),this.storage=new t7(this.storageUrl.href,this.headers,this.fetch,d?.storage),F.accessToken||this._listenForAuthEvents()}get functions(){return new s9(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,a={},d={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,a,d)}channel(n,a={config:{}}){return this.realtime.channel(n,a)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n,a;if(this.accessToken)return await this.accessToken();const{data:d}=await this.auth.getSession();return(a=(n=d.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:a,detectSessionInUrl:d,storage:y,userStorage:v,storageKey:C,flowType:s,lock:M,debug:L},F,W){const X={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vZ({url:this.authUrl.href,headers:Object.assign(Object.assign({},X),F),storageKey:C,autoRefreshToken:n,persistSession:a,detectSessionInUrl:d,storage:y,userStorage:v,flowType:s,lock:M,debug:L,fetch:W,hasCustomAuthorizationHeader:Object.keys(this.headers).some(ee=>ee.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new N9(this.realtimeUrl.href,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,d)=>{this._handleTokenChanged(a,"CLIENT",d?.access_token)})}_handleTokenChanged(n,a,d){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==d?(this.changedAccessToken=d,this.realtime.setAuth(d)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),a=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const wZ=(i,n,a)=>new bZ(i,n,a);function SZ(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const n=i.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}SZ()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const TZ="https://irugmulvyqbhajkfrpmg.supabase.co",EZ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlydWdtdWx2eXFiaGFqa2ZycG1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzODU1NDAsImV4cCI6MjA3Njk2MTU0MH0.PufMRgRQ__c5zxCzhO3n90laj1sY7HSTIIfLOzTh-hE",fn=wZ(TZ,EZ,{auth:{persistSession:!0,autoRefreshToken:!0}}),jO=$.createContext(void 0);function CZ({children:i}){const[n,a]=$.useState(null),[d,y]=$.useState(!0);$.useEffect(()=>{let C=!0;async function s(){const{data:L}=await fn.auth.getSession();C&&(a(L.session?.user??null),y(!1))}s();const{data:M}=fn.auth.onAuthStateChange((L,F)=>{a(F?.user??null)});return()=>{try{M?.subscription?.unsubscribe?.(),M?.unsubscribe?.()}catch{}C=!1}},[]);const v=async()=>{await fn.auth.signOut()};return h.jsx(jO.Provider,{value:{user:n,loading:d,signOut:v},children:i})}function Ma(){const i=$.useContext(jO);if(!i)throw new Error("useAuth must be used within AuthProvider");return i}function AZ(){const[i,n]=$.useState(!1),[a]=Al(),d=[{href:"/",label:"Home"},{href:"/labs",label:"Labs"},{href:"/teams",label:"Teams"},{href:"/contact",label:"Contact"}],y=()=>n(W=>!W),v=()=>n(!1),{user:C,signOut:s}=Ma(),M=W=>W==="/"?a==="/":a===W||a.startsWith(`${W}/`),L=W=>`text-sm font-medium transition-colors ${M(W)?"text-primary":"text-muted-foreground hover:text-primary"}`,F=W=>`rounded-md px-3 py-2 text-lg font-medium transition focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background ${M(W)?"text-primary bg-primary/10":"text-muted-foreground hover:bg-muted hover:text-primary"}`;return h.jsxs(Jn.nav,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"fixed top-0 left-0 right-0 z-40 bg-background/80 backdrop-blur-sm border-b",children:[h.jsx("div",{className:"container mx-auto px-4",children:h.jsxs("div",{className:"flex items-center justify-between h-16",children:[h.jsx("div",{className:"flex items-center",children:h.jsx(xn,{href:"/",children:h.jsx("img",{src:"/GlassLogo5.png",alt:"Glass",className:"h-12 w-auto"})})}),h.jsx("div",{className:"md:hidden",children:h.jsxs("button",{type:"button",onClick:y,className:"inline-flex h-10 w-10 items-center justify-center rounded-md border text-muted-foreground transition hover:border-primary/40 hover:text-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-expanded":i,"aria-controls":"mobile-nav",children:[h.jsx("span",{className:"sr-only",children:"Toggle navigation menu"}),h.jsxs("div",{className:"flex flex-col items-center justify-center gap-1.5",children:[h.jsx("span",{className:"block h-0.5 w-6 rounded bg-current"}),h.jsx("span",{className:"block h-0.5 w-6 rounded bg-current"}),h.jsx("span",{className:"block h-0.5 w-6 rounded bg-current"})]})]})}),h.jsxs("div",{className:"hidden md:flex items-center space-x-6",children:[d.map(W=>h.jsx(xn,{href:W.href,className:L(W.href),children:W.label},W.href)),C?h.jsxs(h.Fragment,{children:[h.jsx(xn,{href:"/account",className:L("/account"),children:"My profile"}),h.jsx("button",{onClick:()=>s(),className:"inline-flex items-center rounded-full border px-4 py-2 text-sm font-semibold text-muted-foreground transition hover:border-primary hover:text-primary",children:"Sign out"})]}):h.jsxs(h.Fragment,{children:[h.jsx(xn,{href:"/login",className:L("/login"),children:"Sign in"}),h.jsx(xn,{href:"/signup",className:"inline-flex items-center rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-primary/90",children:"Create account"})]})]})]})}),h.jsx(dL,{children:i&&h.jsxs(h.Fragment,{children:[h.jsx(Jn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-40 bg-black/40 backdrop-blur-sm md:hidden",onClick:v},"overlay"),h.jsxs(Jn.aside,{id:"mobile-nav",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween",duration:.3},className:"fixed top-0 right-0 z-50 flex h-screen w-64 flex-col bg-background shadow-lg md:hidden",children:[h.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[h.jsx(xn,{href:"/",onClick:v,children:h.jsx("img",{src:"/GlassLogo5.png",alt:"Glass",className:"h-10 w-auto"})}),h.jsxs("button",{type:"button",onClick:v,className:"inline-flex h-9 w-9 items-center justify-center rounded-md border text-muted-foreground transition hover:border-primary/40 hover:text-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[h.jsx("span",{className:"sr-only",children:"Close navigation menu"}),h.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5","aria-hidden":"true",children:h.jsx("path",{d:"M6 6l12 12M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]})]}),h.jsxs("nav",{className:"flex flex-1 flex-col gap-2 px-4 py-6",children:[[...d,...C?[{href:"/account",label:"My profile"}]:[{href:"/login",label:"Sign in"},{href:"/signup",label:"Create account"}]].map(W=>h.jsx(xn,{href:W.href,onClick:v,className:F(W.href),children:W.label},W.href)),C&&h.jsx("button",{onClick:()=>{s(),v()},className:"rounded-md px-3 py-2 text-lg font-medium text-muted-foreground transition hover:bg-muted hover:text-primary text-left",children:"Sign out"})]})]},"panel")]})})]})}const IZ=P2("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Hy=$.forwardRef(({className:i,variant:n,size:a,asChild:d=!1,...y},v)=>{const C=d?_M:"button";return h.jsx(C,{className:Ki(IZ({variant:n,size:a,className:i})),ref:v,...y})});Hy.displayName="Button";function PZ(){const i=()=>{const n=document.querySelector("#about-section");n&&n.scrollIntoView({behavior:"smooth"})};return h.jsxs("section",{className:"relative min-h-screen flex items-center justify-center px-4 py-20",children:[h.jsx("div",{className:"absolute inset-0 z-0 opacity-10 bg-gradient-to-br from-blue-400 to-pink-400"}),h.jsx("div",{className:"container mx-auto relative z-10",children:h.jsxs(Jn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"max-w-3xl mx-auto text-center",children:[h.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-8 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-pink-600",children:"Infrastructure for scientific collaboration."}),h.jsx("p",{className:"text-lg md:text-xl text-muted-foreground mb-12",children:"GLASS-Connect gives labs a standard profile, trusted verification, and direct routing so innovation moves faster."}),h.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[h.jsx(Hy,{size:"lg",className:"text-lg px-8",asChild:!0,children:h.jsx(xn,{href:"/admin/labs",children:"List your lab"})}),h.jsx(Hy,{size:"lg",variant:"outline",className:"text-lg px-8",asChild:!0,children:h.jsx(xn,{href:"/labs",children:"Browse labs"})}),h.jsx(Hy,{size:"lg",variant:"outline",className:"text-lg px-8 bg-pink-500 text-white border-none hover:bg-pink-500/90",onClick:i,children:"How it works"})]})]})})]})}const RO=$.forwardRef(({className:i,...n},a)=>h.jsx("div",{ref:a,className:Ki("rounded-lg border bg-card text-card-foreground shadow-sm",i),...n}));RO.displayName="Card";const kZ=$.forwardRef(({className:i,...n},a)=>h.jsx("div",{ref:a,className:Ki("flex flex-col space-y-1.5 p-6",i),...n}));kZ.displayName="CardHeader";const NZ=$.forwardRef(({className:i,...n},a)=>h.jsx("h3",{ref:a,className:Ki("text-2xl font-semibold leading-none tracking-tight",i),...n}));NZ.displayName="CardTitle";const jZ=$.forwardRef(({className:i,...n},a)=>h.jsx("p",{ref:a,className:Ki("text-sm text-muted-foreground",i),...n}));jZ.displayName="CardDescription";const MO=$.forwardRef(({className:i,...n},a)=>h.jsx("div",{ref:a,className:Ki("p-6 pt-0",i),...n}));MO.displayName="CardContent";const RZ=$.forwardRef(({className:i,...n},a)=>h.jsx("div",{ref:a,className:Ki("flex items-center p-6 pt-0",i),...n}));RZ.displayName="CardFooter";function MZ(){return h.jsx("section",{id:"about-section",className:"py-20 bg-muted/30",children:h.jsxs("div",{className:"container mx-auto px-4",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},className:"text-center mb-12",children:[h.jsx("h2",{className:"text-3xl font-bold mb-4",children:"About GLASS-Connect"}),h.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"GLASS-Connect is the structured directory for research labs. We standardise how teams present capabilities, verify key details once, and route collaboration requests to real humans without endless back-and-forth."})]}),h.jsx("div",{className:"grid md:grid-cols-3 gap-8 mt-12",children:[{icon:h.jsx(T$,{className:"h-10 w-10 text-primary"}),title:"Trusted details",description:"Light remote/on-site verification so partners know the information and equipment are current."},{icon:h.jsx($$,{className:"h-10 w-10 text-primary"}),title:"Structured profiles",description:"Clear capabilities, equipment, and collaboration preferences in a consistent, comparable format."},{icon:h.jsx(M$,{className:"h-10 w-10 text-primary"}),title:"Fast routing",description:"Qualified requests go straight to the right contact so labs spend more time collaborating."}].map((i,n)=>h.jsx(Jn.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6,delay:n*.2},children:h.jsx(RO,{children:h.jsxs(MO,{className:"pt-6 text-center",children:[h.jsx("div",{className:"mb-4 flex justify-center",children:i.icon}),h.jsx("h3",{className:"text-xl font-semibold mb-2",children:i.title}),h.jsx("p",{className:"text-muted-foreground",children:i.description})]})})},n))})]})})}var Av=i=>i.type==="checkbox",Tg=i=>i instanceof Date,Xl=i=>i==null;const LO=i=>typeof i=="object";var xa=i=>!Xl(i)&&!Array.isArray(i)&&LO(i)&&!Tg(i),DO=i=>xa(i)&&i.target?Av(i.target)?i.target.checked:i.target.value:i,LZ=i=>i.substring(0,i.search(/\.\d+(\.|$)/))||i,OO=(i,n)=>i.has(LZ(n)),DZ=i=>{const n=i.constructor&&i.constructor.prototype;return xa(n)&&n.hasOwnProperty("isPrototypeOf")},TE=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ra(i){let n;const a=Array.isArray(i),d=typeof FileList<"u"?i instanceof FileList:!1;if(i instanceof Date)n=new Date(i);else if(!(TE&&(i instanceof Blob||d))&&(a||xa(i)))if(n=a?[]:Object.create(Object.getPrototypeOf(i)),!a&&!DZ(i))n=i;else for(const y in i)i.hasOwnProperty(y)&&(n[y]=Ra(i[y]));else return i;return n}var _w=i=>/^\w*$/.test(i),ea=i=>i===void 0,EE=i=>Array.isArray(i)?i.filter(Boolean):[],CE=i=>EE(i.replace(/["|']|\]/g,"").split(/\.|\[/)),ln=(i,n,a)=>{if(!n||!xa(i))return a;const d=(_w(n)?[n]:CE(n)).reduce((y,v)=>Xl(y)?y:y[v],i);return ea(d)||d===i?ea(i[n])?a:i[n]:d},$c=i=>typeof i=="boolean",Ns=(i,n,a)=>{let d=-1;const y=_w(n)?[n]:CE(n),v=y.length,C=v-1;for(;++d<v;){const s=y[d];let M=a;if(d!==C){const L=i[s];M=xa(L)||Array.isArray(L)?L:isNaN(+y[d+1])?{}:[]}if(s==="__proto__"||s==="constructor"||s==="prototype")return;i[s]=M,i=i[s]}};const j0={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Sd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Hf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},AE=Un.createContext(null);AE.displayName="HookFormContext";const xw=()=>Un.useContext(AE),OZ=i=>{const{children:n,...a}=i;return Un.createElement(AE.Provider,{value:a},n)};var zO=(i,n,a,d=!0)=>{const y={defaultValues:n._defaultValues};for(const v in i)Object.defineProperty(y,v,{get:()=>{const C=v;return n._proxyFormState[C]!==Sd.all&&(n._proxyFormState[C]=!d||Sd.all),a&&(a[C]=!0),i[C]}});return y};const IE=typeof window<"u"?Un.useLayoutEffect:Un.useEffect;function zZ(i){const n=xw(),{control:a=n.control,disabled:d,name:y,exact:v}=i||{},[C,s]=Un.useState(a._formState),M=Un.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return IE(()=>a._subscribe({name:y,formState:M.current,exact:v,callback:L=>{!d&&s({...a._formState,...L})}}),[y,d,v]),Un.useEffect(()=>{M.current.isValid&&a._setValid(!0)},[a]),Un.useMemo(()=>zO(C,a,M.current,!1),[C,a])}var Zc=i=>typeof i=="string",FO=(i,n,a,d,y)=>Zc(i)?(d&&n.watch.add(i),ln(a,i,y)):Array.isArray(i)?i.map(v=>(d&&n.watch.add(v),ln(a,v))):(d&&(n.watchAll=!0),a),t2=i=>Xl(i)||!LO(i);function Qf(i,n,a=new WeakSet){if(t2(i)||t2(n))return i===n;if(Tg(i)&&Tg(n))return i.getTime()===n.getTime();const d=Object.keys(i),y=Object.keys(n);if(d.length!==y.length)return!1;if(a.has(i)||a.has(n))return!0;a.add(i),a.add(n);for(const v of d){const C=i[v];if(!y.includes(v))return!1;if(v!=="ref"){const s=n[v];if(Tg(C)&&Tg(s)||xa(C)&&xa(s)||Array.isArray(C)&&Array.isArray(s)?!Qf(C,s,a):C!==s)return!1}}return!0}function FZ(i){const n=xw(),{control:a=n.control,name:d,defaultValue:y,disabled:v,exact:C,compute:s}=i||{},M=Un.useRef(y),L=Un.useRef(s),F=Un.useRef(void 0);L.current=s;const W=Un.useMemo(()=>a._getWatch(d,M.current),[a,d]),[X,ee]=Un.useState(L.current?L.current(W):W);return IE(()=>a._subscribe({name:d,formState:{values:!0},exact:C,callback:he=>{if(!v){const se=FO(d,a._names,he.values||a._formValues,!1,M.current);if(L.current){const oe=L.current(se);Qf(oe,F.current)||(ee(oe),F.current=oe)}else ee(se)}}}),[a,v,d,C]),Un.useEffect(()=>a._removeUnmounted()),X}function BZ(i){const n=xw(),{name:a,disabled:d,control:y=n.control,shouldUnregister:v,defaultValue:C}=i,s=OO(y._names.array,a),M=Un.useMemo(()=>ln(y._formValues,a,ln(y._defaultValues,a,C)),[y,a,C]),L=FZ({control:y,name:a,defaultValue:M,exact:!0}),F=zZ({control:y,name:a,exact:!0}),W=Un.useRef(i),X=Un.useRef(void 0),ee=Un.useRef(y.register(a,{...i.rules,value:L,...$c(i.disabled)?{disabled:i.disabled}:{}}));W.current=i;const he=Un.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!ln(F.errors,a)},isDirty:{enumerable:!0,get:()=>!!ln(F.dirtyFields,a)},isTouched:{enumerable:!0,get:()=>!!ln(F.touchedFields,a)},isValidating:{enumerable:!0,get:()=>!!ln(F.validatingFields,a)},error:{enumerable:!0,get:()=>ln(F.errors,a)}}),[F,a]),se=Un.useCallback(Se=>ee.current.onChange({target:{value:DO(Se),name:a},type:j0.CHANGE}),[a]),oe=Un.useCallback(()=>ee.current.onBlur({target:{value:ln(y._formValues,a),name:a},type:j0.BLUR}),[a,y._formValues]),ve=Un.useCallback(Se=>{const Re=ln(y._fields,a);Re&&Se&&(Re._f.ref={focus:()=>Se.focus&&Se.focus(),select:()=>Se.select&&Se.select(),setCustomValidity:Be=>Se.setCustomValidity(Be),reportValidity:()=>Se.reportValidity()})},[y._fields,a]),me=Un.useMemo(()=>({name:a,value:L,...$c(d)||F.disabled?{disabled:F.disabled||d}:{},onChange:se,onBlur:oe,ref:ve}),[a,d,F.disabled,se,oe,ve,L]);return Un.useEffect(()=>{const Se=y._options.shouldUnregister||v,Re=X.current;Re&&Re!==a&&!s&&y.unregister(Re),y.register(a,{...W.current.rules,...$c(W.current.disabled)?{disabled:W.current.disabled}:{}});const Be=(rt,We)=>{const Ct=ln(y._fields,rt);Ct&&Ct._f&&(Ct._f.mount=We)};if(Be(a,!0),Se){const rt=Ra(ln(y._options.defaultValues,a));Ns(y._defaultValues,a,rt),ea(ln(y._formValues,a))&&Ns(y._formValues,a,rt)}return!s&&y.register(a),X.current=a,()=>{(s?Se&&!y._state.action:Se)?y.unregister(a):Be(a,!1)}},[a,y,s,v]),Un.useEffect(()=>{y._setDisabledField({disabled:d,name:a})},[d,a,y]),Un.useMemo(()=>({field:me,formState:F,fieldState:he}),[me,F,he])}const VZ=i=>i.render(BZ(i));var BO=(i,n,a,d,y)=>n?{...a[i],types:{...a[i]&&a[i].types?a[i].types:{},[d]:y||!0}}:{},Dx=i=>Array.isArray(i)?i:[i],Gj=()=>{let i=[];return{get observers(){return i},next:y=>{for(const v of i)v.next&&v.next(y)},subscribe:y=>(i.push(y),{unsubscribe:()=>{i=i.filter(v=>v!==y)}}),unsubscribe:()=>{i=[]}}};function VO(i,n){const a={};for(const d in i)if(i.hasOwnProperty(d)){const y=i[d],v=n[d];if(y&&xa(y)&&v){const C=VO(y,v);xa(C)&&(a[d]=C)}else i[d]&&(a[d]=v)}return a}var _c=i=>xa(i)&&!Object.keys(i).length,PE=i=>i.type==="file",Td=i=>typeof i=="function",R0=i=>{if(!TE)return!1;const n=i?i.ownerDocument:0;return i instanceof(n&&n.defaultView?n.defaultView.HTMLElement:HTMLElement)},UO=i=>i.type==="select-multiple",kE=i=>i.type==="radio",UZ=i=>kE(i)||Av(i),ZS=i=>R0(i)&&i.isConnected;function $Z(i,n){const a=n.slice(0,-1).length;let d=0;for(;d<a;)i=ea(i)?d++:i[n[d++]];return i}function qZ(i){for(const n in i)if(i.hasOwnProperty(n)&&!ea(i[n]))return!1;return!0}function ya(i,n){const a=Array.isArray(n)?n:_w(n)?[n]:CE(n),d=a.length===1?i:$Z(i,a),y=a.length-1,v=a[y];return d&&delete d[v],y!==0&&(xa(d)&&_c(d)||Array.isArray(d)&&qZ(d))&&ya(i,a.slice(0,-1)),i}var GZ=i=>{for(const n in i)if(Td(i[n]))return!0;return!1};function $O(i){return Array.isArray(i)||xa(i)&&!GZ(i)}function r2(i,n={}){for(const a in i)$O(i[a])?(n[a]=Array.isArray(i[a])?[]:{},r2(i[a],n[a])):Xl(i[a])||(n[a]=!0);return n}function Dy(i,n,a){a||(a=r2(n));for(const d in i)$O(i[d])?ea(n)||t2(a[d])?a[d]=r2(i[d],Array.isArray(i[d])?[]:{}):Dy(i[d],Xl(n)?{}:n[d],a[d]):a[d]=!Qf(i[d],n[d]);return a}const Wj={value:!1,isValid:!1},Hj={value:!0,isValid:!0};var qO=i=>{if(Array.isArray(i)){if(i.length>1){const n=i.filter(a=>a&&a.checked&&!a.disabled).map(a=>a.value);return{value:n,isValid:!!n.length}}return i[0].checked&&!i[0].disabled?i[0].attributes&&!ea(i[0].attributes.value)?ea(i[0].value)||i[0].value===""?Hj:{value:i[0].value,isValid:!0}:Hj:Wj}return Wj},GO=(i,{valueAsNumber:n,valueAsDate:a,setValueAs:d})=>ea(i)?i:n?i===""?NaN:i&&+i:a&&Zc(i)?new Date(i):d?d(i):i;const Zj={isValid:!1,value:null};var WO=i=>Array.isArray(i)?i.reduce((n,a)=>a&&a.checked&&!a.disabled?{isValid:!0,value:a.value}:n,Zj):Zj;function Xj(i){const n=i.ref;return PE(n)?n.files:kE(n)?WO(i.refs).value:UO(n)?[...n.selectedOptions].map(({value:a})=>a):Av(n)?qO(i.refs).value:GO(ea(n.value)?i.ref.value:n.value,i)}var WZ=(i,n,a,d)=>{const y={};for(const v of i){const C=ln(n,v);C&&Ns(y,v,C._f)}return{criteriaMode:a,names:[...i],fields:y,shouldUseNativeValidation:d}},M0=i=>i instanceof RegExp,bx=i=>ea(i)?i:M0(i)?i.source:xa(i)?M0(i.value)?i.value.source:i.value:i,Kj=i=>({isOnSubmit:!i||i===Sd.onSubmit,isOnBlur:i===Sd.onBlur,isOnChange:i===Sd.onChange,isOnAll:i===Sd.all,isOnTouch:i===Sd.onTouched});const Yj="AsyncFunction";var HZ=i=>!!i&&!!i.validate&&!!(Td(i.validate)&&i.validate.constructor.name===Yj||xa(i.validate)&&Object.values(i.validate).find(n=>n.constructor.name===Yj)),ZZ=i=>i.mount&&(i.required||i.min||i.max||i.maxLength||i.minLength||i.pattern||i.validate),Qj=(i,n,a)=>!a&&(n.watchAll||n.watch.has(i)||[...n.watch].some(d=>i.startsWith(d)&&/^\.\w+/.test(i.slice(d.length))));const Ox=(i,n,a,d)=>{for(const y of a||Object.keys(i)){const v=ln(i,y);if(v){const{_f:C,...s}=v;if(C){if(C.refs&&C.refs[0]&&n(C.refs[0],y)&&!d)return!0;if(C.ref&&n(C.ref,C.name)&&!d)return!0;if(Ox(s,n))break}else if(xa(s)&&Ox(s,n))break}}};function Jj(i,n,a){const d=ln(i,a);if(d||_w(a))return{error:d,name:a};const y=a.split(".");for(;y.length;){const v=y.join("."),C=ln(n,v),s=ln(i,v);if(C&&!Array.isArray(C)&&a!==v)return{name:a};if(s&&s.type)return{name:v,error:s};if(s&&s.root&&s.root.type)return{name:`${v}.root`,error:s.root};y.pop()}return{name:a}}var XZ=(i,n,a,d)=>{a(i);const{name:y,...v}=i;return _c(v)||Object.keys(v).length>=Object.keys(n).length||Object.keys(v).find(C=>n[C]===(!d||Sd.all))},KZ=(i,n,a)=>!i||!n||i===n||Dx(i).some(d=>d&&(a?d===n:d.startsWith(n)||n.startsWith(d))),YZ=(i,n,a,d,y)=>y.isOnAll?!1:!a&&y.isOnTouch?!(n||i):(a?d.isOnBlur:y.isOnBlur)?!i:(a?d.isOnChange:y.isOnChange)?i:!0,QZ=(i,n)=>!EE(ln(i,n)).length&&ya(i,n),JZ=(i,n,a)=>{const d=Dx(ln(i,a));return Ns(d,"root",n[a]),Ns(i,a,d),i};function eR(i,n,a="validate"){if(Zc(i)||Array.isArray(i)&&i.every(Zc)||$c(i)&&!i)return{type:a,message:Zc(i)?i:"",ref:n}}var Py=i=>xa(i)&&!M0(i)?i:{value:i,message:""},tR=async(i,n,a,d,y,v)=>{const{ref:C,refs:s,required:M,maxLength:L,minLength:F,min:W,max:X,pattern:ee,validate:he,name:se,valueAsNumber:oe,mount:ve}=i._f,me=ln(a,se);if(!ve||n.has(se))return{};const Se=s?s[0]:C,Re=$t=>{y&&Se.reportValidity&&(Se.setCustomValidity($c($t)?"":$t||""),Se.reportValidity())},Be={},rt=kE(C),We=Av(C),Ct=rt||We,Ht=(oe||PE(C))&&ea(C.value)&&ea(me)||R0(C)&&C.value===""||me===""||Array.isArray(me)&&!me.length,Zt=BO.bind(null,se,d,Be),rr=($t,Rt,Gt,Ar=Hf.maxLength,Ut=Hf.minLength)=>{const Xt=$t?Rt:Gt;Be[se]={type:$t?Ar:Ut,message:Xt,ref:C,...Zt($t?Ar:Ut,Xt)}};if(v?!Array.isArray(me)||!me.length:M&&(!Ct&&(Ht||Xl(me))||$c(me)&&!me||We&&!qO(s).isValid||rt&&!WO(s).isValid)){const{value:$t,message:Rt}=Zc(M)?{value:!!M,message:M}:Py(M);if($t&&(Be[se]={type:Hf.required,message:Rt,ref:Se,...Zt(Hf.required,Rt)},!d))return Re(Rt),Be}if(!Ht&&(!Xl(W)||!Xl(X))){let $t,Rt;const Gt=Py(X),Ar=Py(W);if(!Xl(me)&&!isNaN(me)){const Ut=C.valueAsNumber||me&&+me;Xl(Gt.value)||($t=Ut>Gt.value),Xl(Ar.value)||(Rt=Ut<Ar.value)}else{const Ut=C.valueAsDate||new Date(me),Xt=Qt=>new Date(new Date().toDateString()+" "+Qt),ut=C.type=="time",Mt=C.type=="week";Zc(Gt.value)&&me&&($t=ut?Xt(me)>Xt(Gt.value):Mt?me>Gt.value:Ut>new Date(Gt.value)),Zc(Ar.value)&&me&&(Rt=ut?Xt(me)<Xt(Ar.value):Mt?me<Ar.value:Ut<new Date(Ar.value))}if(($t||Rt)&&(rr(!!$t,Gt.message,Ar.message,Hf.max,Hf.min),!d))return Re(Be[se].message),Be}if((L||F)&&!Ht&&(Zc(me)||v&&Array.isArray(me))){const $t=Py(L),Rt=Py(F),Gt=!Xl($t.value)&&me.length>+$t.value,Ar=!Xl(Rt.value)&&me.length<+Rt.value;if((Gt||Ar)&&(rr(Gt,$t.message,Rt.message),!d))return Re(Be[se].message),Be}if(ee&&!Ht&&Zc(me)){const{value:$t,message:Rt}=Py(ee);if(M0($t)&&!me.match($t)&&(Be[se]={type:Hf.pattern,message:Rt,ref:C,...Zt(Hf.pattern,Rt)},!d))return Re(Rt),Be}if(he){if(Td(he)){const $t=await he(me,a),Rt=eR($t,Se);if(Rt&&(Be[se]={...Rt,...Zt(Hf.validate,Rt.message)},!d))return Re(Rt.message),Be}else if(xa(he)){let $t={};for(const Rt in he){if(!_c($t)&&!d)break;const Gt=eR(await he[Rt](me,a),Se,Rt);Gt&&($t={...Gt,...Zt(Rt,Gt.message)},Re(Gt.message),d&&(Be[se]=$t))}if(!_c($t)&&(Be[se]={ref:Se,...$t},!d))return Be}}return Re(!0),Be};const eX={mode:Sd.onSubmit,reValidateMode:Sd.onChange,shouldFocusError:!0};function tX(i={}){let n={...eX,...i},a={submitCount:0,isDirty:!1,isReady:!1,isLoading:Td(n.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1},d={},y=xa(n.defaultValues)||xa(n.values)?Ra(n.defaultValues||n.values)||{}:{},v=n.shouldUnregister?{}:Ra(y),C={action:!1,mount:!1,watch:!1},s={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},M,L=0;const F={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let W={...F};const X={array:Gj(),state:Gj()},ee=n.criteriaMode===Sd.all,he=Ke=>Je=>{clearTimeout(L),L=setTimeout(Ke,Je)},se=async Ke=>{if(!n.disabled&&(F.isValid||W.isValid||Ke)){const Je=n.resolver?_c((await We()).errors):await Ht(d,!0);Je!==a.isValid&&X.state.next({isValid:Je})}},oe=(Ke,Je)=>{!n.disabled&&(F.isValidating||F.validatingFields||W.isValidating||W.validatingFields)&&((Ke||Array.from(s.mount)).forEach(jt=>{jt&&(Je?Ns(a.validatingFields,jt,Je):ya(a.validatingFields,jt))}),X.state.next({validatingFields:a.validatingFields,isValidating:!_c(a.validatingFields)}))},ve=(Ke,Je=[],jt,yr,pr=!0,Jt=!0)=>{if(yr&&jt&&!n.disabled){if(C.action=!0,Jt&&Array.isArray(ln(d,Ke))){const Or=jt(ln(d,Ke),yr.argA,yr.argB);pr&&Ns(d,Ke,Or)}if(Jt&&Array.isArray(ln(a.errors,Ke))){const Or=jt(ln(a.errors,Ke),yr.argA,yr.argB);pr&&Ns(a.errors,Ke,Or),QZ(a.errors,Ke)}if((F.touchedFields||W.touchedFields)&&Jt&&Array.isArray(ln(a.touchedFields,Ke))){const Or=jt(ln(a.touchedFields,Ke),yr.argA,yr.argB);pr&&Ns(a.touchedFields,Ke,Or)}(F.dirtyFields||W.dirtyFields)&&(a.dirtyFields=Dy(y,v)),X.state.next({name:Ke,isDirty:rr(Ke,Je),dirtyFields:a.dirtyFields,errors:a.errors,isValid:a.isValid})}else Ns(v,Ke,Je)},me=(Ke,Je)=>{Ns(a.errors,Ke,Je),X.state.next({errors:a.errors})},Se=Ke=>{a.errors=Ke,X.state.next({errors:a.errors,isValid:!1})},Re=(Ke,Je,jt,yr)=>{const pr=ln(d,Ke);if(pr){const Jt=ln(v,Ke,ea(jt)?ln(y,Ke):jt);ea(Jt)||yr&&yr.defaultChecked||Je?Ns(v,Ke,Je?Jt:Xj(pr._f)):Gt(Ke,Jt),C.mount&&se()}},Be=(Ke,Je,jt,yr,pr)=>{let Jt=!1,Or=!1;const sn={name:Ke};if(!n.disabled){if(!jt||yr){(F.isDirty||W.isDirty)&&(Or=a.isDirty,a.isDirty=sn.isDirty=rr(),Jt=Or!==sn.isDirty);const Mn=Qf(ln(y,Ke),Je);Or=!!ln(a.dirtyFields,Ke),Mn?ya(a.dirtyFields,Ke):Ns(a.dirtyFields,Ke,!0),sn.dirtyFields=a.dirtyFields,Jt=Jt||(F.dirtyFields||W.dirtyFields)&&Or!==!Mn}if(jt){const Mn=ln(a.touchedFields,Ke);Mn||(Ns(a.touchedFields,Ke,jt),sn.touchedFields=a.touchedFields,Jt=Jt||(F.touchedFields||W.touchedFields)&&Mn!==jt)}Jt&&pr&&X.state.next(sn)}return Jt?sn:{}},rt=(Ke,Je,jt,yr)=>{const pr=ln(a.errors,Ke),Jt=(F.isValid||W.isValid)&&$c(Je)&&a.isValid!==Je;if(n.delayError&&jt?(M=he(()=>me(Ke,jt)),M(n.delayError)):(clearTimeout(L),M=null,jt?Ns(a.errors,Ke,jt):ya(a.errors,Ke)),(jt?!Qf(pr,jt):pr)||!_c(yr)||Jt){const Or={...yr,...Jt&&$c(Je)?{isValid:Je}:{},errors:a.errors,name:Ke};a={...a,...Or},X.state.next(Or)}},We=async Ke=>{oe(Ke,!0);const Je=await n.resolver(v,n.context,WZ(Ke||s.mount,d,n.criteriaMode,n.shouldUseNativeValidation));return oe(Ke),Je},Ct=async Ke=>{const{errors:Je}=await We(Ke);if(Ke)for(const jt of Ke){const yr=ln(Je,jt);yr?Ns(a.errors,jt,yr):ya(a.errors,jt)}else a.errors=Je;return Je},Ht=async(Ke,Je,jt={valid:!0})=>{for(const yr in Ke){const pr=Ke[yr];if(pr){const{_f:Jt,...Or}=pr;if(Jt){const sn=s.array.has(Jt.name),Mn=pr._f&&HZ(pr._f);Mn&&F.validatingFields&&oe([Jt.name],!0);const Gi=await tR(pr,s.disabled,v,ee,n.shouldUseNativeValidation&&!Je,sn);if(Mn&&F.validatingFields&&oe([Jt.name]),Gi[Jt.name]&&(jt.valid=!1,Je))break;!Je&&(ln(Gi,Jt.name)?sn?JZ(a.errors,Gi,Jt.name):Ns(a.errors,Jt.name,Gi[Jt.name]):ya(a.errors,Jt.name))}!_c(Or)&&await Ht(Or,Je,jt)}}return jt.valid},Zt=()=>{for(const Ke of s.unMount){const Je=ln(d,Ke);Je&&(Je._f.refs?Je._f.refs.every(jt=>!ZS(jt)):!ZS(Je._f.ref))&&Zr(Ke)}s.unMount=new Set},rr=(Ke,Je)=>!n.disabled&&(Ke&&Je&&Ns(v,Ke,Je),!Qf(Qt(),y)),$t=(Ke,Je,jt)=>FO(Ke,s,{...C.mount?v:ea(Je)?y:Zc(Ke)?{[Ke]:Je}:Je},jt,Je),Rt=Ke=>EE(ln(C.mount?v:y,Ke,n.shouldUnregister?ln(y,Ke,[]):[])),Gt=(Ke,Je,jt={})=>{const yr=ln(d,Ke);let pr=Je;if(yr){const Jt=yr._f;Jt&&(!Jt.disabled&&Ns(v,Ke,GO(Je,Jt)),pr=R0(Jt.ref)&&Xl(Je)?"":Je,UO(Jt.ref)?[...Jt.ref.options].forEach(Or=>Or.selected=pr.includes(Or.value)):Jt.refs?Av(Jt.ref)?Jt.refs.forEach(Or=>{(!Or.defaultChecked||!Or.disabled)&&(Array.isArray(pr)?Or.checked=!!pr.find(sn=>sn===Or.value):Or.checked=pr===Or.value||!!pr)}):Jt.refs.forEach(Or=>Or.checked=Or.value===pr):PE(Jt.ref)?Jt.ref.value="":(Jt.ref.value=pr,Jt.ref.type||X.state.next({name:Ke,values:Ra(v)})))}(jt.shouldDirty||jt.shouldTouch)&&Be(Ke,pr,jt.shouldTouch,jt.shouldDirty,!0),jt.shouldValidate&&Mt(Ke)},Ar=(Ke,Je,jt)=>{for(const yr in Je){if(!Je.hasOwnProperty(yr))return;const pr=Je[yr],Jt=Ke+"."+yr,Or=ln(d,Jt);(s.array.has(Ke)||xa(pr)||Or&&!Or._f)&&!Tg(pr)?Ar(Jt,pr,jt):Gt(Jt,pr,jt)}},Ut=(Ke,Je,jt={})=>{const yr=ln(d,Ke),pr=s.array.has(Ke),Jt=Ra(Je);Ns(v,Ke,Jt),pr?(X.array.next({name:Ke,values:Ra(v)}),(F.isDirty||F.dirtyFields||W.isDirty||W.dirtyFields)&&jt.shouldDirty&&X.state.next({name:Ke,dirtyFields:Dy(y,v),isDirty:rr(Ke,Jt)})):yr&&!yr._f&&!Xl(Jt)?Ar(Ke,Jt,jt):Gt(Ke,Jt,jt),Qj(Ke,s)&&X.state.next({...a,name:Ke}),X.state.next({name:C.mount?Ke:void 0,values:Ra(v)})},Xt=async Ke=>{C.mount=!0;const Je=Ke.target;let jt=Je.name,yr=!0;const pr=ln(d,jt),Jt=Mn=>{yr=Number.isNaN(Mn)||Tg(Mn)&&isNaN(Mn.getTime())||Qf(Mn,ln(v,jt,Mn))},Or=Kj(n.mode),sn=Kj(n.reValidateMode);if(pr){let Mn,Gi;const yi=Je.type?Xj(pr._f):DO(Ke),vt=Ke.type===j0.BLUR||Ke.type===j0.FOCUS_OUT,or=!ZZ(pr._f)&&!n.resolver&&!ln(a.errors,jt)&&!pr._f.deps||YZ(vt,ln(a.touchedFields,jt),a.isSubmitted,sn,Or),dn=Qj(jt,s,vt);Ns(v,jt,yi),vt?(!Je||!Je.readOnly)&&(pr._f.onBlur&&pr._f.onBlur(Ke),M&&M(0)):pr._f.onChange&&pr._f.onChange(Ke);const Ln=Be(jt,yi,vt),Bn=!_c(Ln)||dn;if(!vt&&X.state.next({name:jt,type:Ke.type,values:Ra(v)}),or)return(F.isValid||W.isValid)&&(n.mode==="onBlur"?vt&&se():vt||se()),Bn&&X.state.next({name:jt,...dn?{}:Ln});if(!vt&&dn&&X.state.next({...a}),n.resolver){const{errors:Ze}=await We([jt]);if(Jt(yi),yr){const ur=Jj(a.errors,d,jt),kr=Jj(Ze,d,ur.name||jt);Mn=kr.error,jt=kr.name,Gi=_c(Ze)}}else oe([jt],!0),Mn=(await tR(pr,s.disabled,v,ee,n.shouldUseNativeValidation))[jt],oe([jt]),Jt(yi),yr&&(Mn?Gi=!1:(F.isValid||W.isValid)&&(Gi=await Ht(d,!0)));yr&&(pr._f.deps&&(!Array.isArray(pr._f.deps)||pr._f.deps.length>0)&&Mt(pr._f.deps),rt(jt,Gi,Mn,Ln))}},ut=(Ke,Je)=>{if(ln(a.errors,Je)&&Ke.focus)return Ke.focus(),1},Mt=async(Ke,Je={})=>{let jt,yr;const pr=Dx(Ke);if(n.resolver){const Jt=await Ct(ea(Ke)?Ke:pr);jt=_c(Jt),yr=Ke?!pr.some(Or=>ln(Jt,Or)):jt}else Ke?(yr=(await Promise.all(pr.map(async Jt=>{const Or=ln(d,Jt);return await Ht(Or&&Or._f?{[Jt]:Or}:Or)}))).every(Boolean),!(!yr&&!a.isValid)&&se()):yr=jt=await Ht(d);return X.state.next({...!Zc(Ke)||(F.isValid||W.isValid)&&jt!==a.isValid?{}:{name:Ke},...n.resolver||!Ke?{isValid:jt}:{},errors:a.errors}),Je.shouldFocus&&!yr&&Ox(d,ut,Ke?pr:s.mount),yr},Qt=(Ke,Je)=>{let jt={...C.mount?v:y};return Je&&(jt=VO(Je.dirtyFields?a.dirtyFields:a.touchedFields,jt)),ea(Ke)?jt:Zc(Ke)?ln(jt,Ke):Ke.map(yr=>ln(jt,yr))},ze=(Ke,Je)=>({invalid:!!ln((Je||a).errors,Ke),isDirty:!!ln((Je||a).dirtyFields,Ke),error:ln((Je||a).errors,Ke),isValidating:!!ln(a.validatingFields,Ke),isTouched:!!ln((Je||a).touchedFields,Ke)}),It=Ke=>{Ke&&Dx(Ke).forEach(Je=>ya(a.errors,Je)),X.state.next({errors:Ke?a.errors:{}})},xr=(Ke,Je,jt)=>{const yr=(ln(d,Ke,{_f:{}})._f||{}).ref,pr=ln(a.errors,Ke)||{},{ref:Jt,message:Or,type:sn,...Mn}=pr;Ns(a.errors,Ke,{...Mn,...Je,ref:yr}),X.state.next({name:Ke,errors:a.errors,isValid:!1}),jt&&jt.shouldFocus&&yr&&yr.focus&&yr.focus()},Lr=(Ke,Je)=>Td(Ke)?X.state.subscribe({next:jt=>"values"in jt&&Ke($t(void 0,Je),jt)}):$t(Ke,Je,!0),yn=Ke=>X.state.subscribe({next:Je=>{KZ(Ke.name,Je.name,Ke.exact)&&XZ(Je,Ke.formState||F,Sr,Ke.reRenderRoot)&&Ke.callback({values:{...v},...a,...Je,defaultValues:y})}}).unsubscribe,Yr=Ke=>(C.mount=!0,W={...W,...Ke.formState},yn({...Ke,formState:W})),Zr=(Ke,Je={})=>{for(const jt of Ke?Dx(Ke):s.mount)s.mount.delete(jt),s.array.delete(jt),Je.keepValue||(ya(d,jt),ya(v,jt)),!Je.keepError&&ya(a.errors,jt),!Je.keepDirty&&ya(a.dirtyFields,jt),!Je.keepTouched&&ya(a.touchedFields,jt),!Je.keepIsValidating&&ya(a.validatingFields,jt),!n.shouldUnregister&&!Je.keepDefaultValue&&ya(y,jt);X.state.next({values:Ra(v)}),X.state.next({...a,...Je.keepDirty?{isDirty:rr()}:{}}),!Je.keepIsValid&&se()},Qr=({disabled:Ke,name:Je})=>{($c(Ke)&&C.mount||Ke||s.disabled.has(Je))&&(Ke?s.disabled.add(Je):s.disabled.delete(Je))},ir=(Ke,Je={})=>{let jt=ln(d,Ke);const yr=$c(Je.disabled)||$c(n.disabled);return Ns(d,Ke,{...jt||{},_f:{...jt&&jt._f?jt._f:{ref:{name:Ke}},name:Ke,mount:!0,...Je}}),s.mount.add(Ke),jt?Qr({disabled:$c(Je.disabled)?Je.disabled:n.disabled,name:Ke}):Re(Ke,!0,Je.value),{...yr?{disabled:Je.disabled||n.disabled}:{},...n.progressive?{required:!!Je.required,min:bx(Je.min),max:bx(Je.max),minLength:bx(Je.minLength),maxLength:bx(Je.maxLength),pattern:bx(Je.pattern)}:{},name:Ke,onChange:Xt,onBlur:Xt,ref:pr=>{if(pr){ir(Ke,Je),jt=ln(d,Ke);const Jt=ea(pr.value)&&pr.querySelectorAll&&pr.querySelectorAll("input,select,textarea")[0]||pr,Or=UZ(Jt),sn=jt._f.refs||[];if(Or?sn.find(Mn=>Mn===Jt):Jt===jt._f.ref)return;Ns(d,Ke,{_f:{...jt._f,...Or?{refs:[...sn.filter(ZS),Jt,...Array.isArray(ln(y,Ke))?[{}]:[]],ref:{type:Jt.type,name:Ke}}:{ref:Jt}}}),Re(Ke,!1,void 0,Jt)}else jt=ln(d,Ke,{}),jt._f&&(jt._f.mount=!1),(n.shouldUnregister||Je.shouldUnregister)&&!(OO(s.array,Ke)&&C.action)&&s.unMount.add(Ke)}}},Hr=()=>n.shouldFocusError&&Ox(d,ut,s.mount),Ur=Ke=>{$c(Ke)&&(X.state.next({disabled:Ke}),Ox(d,(Je,jt)=>{const yr=ln(d,jt);yr&&(Je.disabled=yr._f.disabled||Ke,Array.isArray(yr._f.refs)&&yr._f.refs.forEach(pr=>{pr.disabled=yr._f.disabled||Ke}))},0,!1))},Ti=(Ke,Je)=>async jt=>{let yr;jt&&(jt.preventDefault&&jt.preventDefault(),jt.persist&&jt.persist());let pr=Ra(v);if(X.state.next({isSubmitting:!0}),n.resolver){const{errors:Jt,values:Or}=await We();a.errors=Jt,pr=Ra(Or)}else await Ht(d);if(s.disabled.size)for(const Jt of s.disabled)ya(pr,Jt);if(ya(a.errors,"root"),_c(a.errors)){X.state.next({errors:{}});try{await Ke(pr,jt)}catch(Jt){yr=Jt}}else Je&&await Je({...a.errors},jt),Hr(),setTimeout(Hr);if(X.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:_c(a.errors)&&!yr,submitCount:a.submitCount+1,errors:a.errors}),yr)throw yr},Sn=(Ke,Je={})=>{ln(d,Ke)&&(ea(Je.defaultValue)?Ut(Ke,Ra(ln(y,Ke))):(Ut(Ke,Je.defaultValue),Ns(y,Ke,Ra(Je.defaultValue))),Je.keepTouched||ya(a.touchedFields,Ke),Je.keepDirty||(ya(a.dirtyFields,Ke),a.isDirty=Je.defaultValue?rr(Ke,Ra(ln(y,Ke))):rr()),Je.keepError||(ya(a.errors,Ke),F.isValid&&se()),X.state.next({...a}))},Ci=(Ke,Je={})=>{const jt=Ke?Ra(Ke):y,yr=Ra(jt),pr=_c(Ke),Jt=pr?y:yr;if(Je.keepDefaultValues||(y=jt),!Je.keepValues){if(Je.keepDirtyValues){const Or=new Set([...s.mount,...Object.keys(Dy(y,v))]);for(const sn of Array.from(Or))ln(a.dirtyFields,sn)?Ns(Jt,sn,ln(v,sn)):Ut(sn,ln(Jt,sn))}else{if(TE&&ea(Ke))for(const Or of s.mount){const sn=ln(d,Or);if(sn&&sn._f){const Mn=Array.isArray(sn._f.refs)?sn._f.refs[0]:sn._f.ref;if(R0(Mn)){const Gi=Mn.closest("form");if(Gi){Gi.reset();break}}}}if(Je.keepFieldsRef)for(const Or of s.mount)Ut(Or,ln(Jt,Or));else d={}}v=n.shouldUnregister?Je.keepDefaultValues?Ra(y):{}:Ra(Jt),X.array.next({values:{...Jt}}),X.state.next({values:{...Jt}})}s={mount:Je.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},C.mount=!F.isValid||!!Je.keepIsValid||!!Je.keepDirtyValues,C.watch=!!n.shouldUnregister,X.state.next({submitCount:Je.keepSubmitCount?a.submitCount:0,isDirty:pr?!1:Je.keepDirty?a.isDirty:!!(Je.keepDefaultValues&&!Qf(Ke,y)),isSubmitted:Je.keepIsSubmitted?a.isSubmitted:!1,dirtyFields:pr?{}:Je.keepDirtyValues?Je.keepDefaultValues&&v?Dy(y,v):a.dirtyFields:Je.keepDefaultValues&&Ke?Dy(y,Ke):Je.keepDirty?a.dirtyFields:{},touchedFields:Je.keepTouched?a.touchedFields:{},errors:Je.keepErrors?a.errors:{},isSubmitSuccessful:Je.keepIsSubmitSuccessful?a.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:y})},At=(Ke,Je)=>Ci(Td(Ke)?Ke(v):Ke,Je),pt=(Ke,Je={})=>{const jt=ln(d,Ke),yr=jt&&jt._f;if(yr){const pr=yr.refs?yr.refs[0]:yr.ref;pr.focus&&(pr.focus(),Je.shouldSelect&&Td(pr.select)&&pr.select())}},Sr=Ke=>{a={...a,...Ke}},Vr={control:{register:ir,unregister:Zr,getFieldState:ze,handleSubmit:Ti,setError:xr,_subscribe:yn,_runSchema:We,_focusError:Hr,_getWatch:$t,_getDirty:rr,_setValid:se,_setFieldArray:ve,_setDisabledField:Qr,_setErrors:Se,_getFieldArray:Rt,_reset:Ci,_resetDefaultValues:()=>Td(n.defaultValues)&&n.defaultValues().then(Ke=>{At(Ke,n.resetOptions),X.state.next({isLoading:!1})}),_removeUnmounted:Zt,_disableForm:Ur,_subjects:X,_proxyFormState:F,get _fields(){return d},get _formValues(){return v},get _state(){return C},set _state(Ke){C=Ke},get _defaultValues(){return y},get _names(){return s},set _names(Ke){s=Ke},get _formState(){return a},get _options(){return n},set _options(Ke){n={...n,...Ke}}},subscribe:Yr,trigger:Mt,register:ir,handleSubmit:Ti,watch:Lr,setValue:Ut,getValues:Qt,reset:At,resetField:Sn,clearErrors:It,unregister:Zr,setError:xr,setFocus:pt,getFieldState:ze};return{...Vr,formControl:Vr}}function HO(i={}){const n=Un.useRef(void 0),a=Un.useRef(void 0),[d,y]=Un.useState({isDirty:!1,isValidating:!1,isLoading:Td(i.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:i.errors||{},disabled:i.disabled||!1,isReady:!1,defaultValues:Td(i.defaultValues)?void 0:i.defaultValues});if(!n.current)if(i.formControl)n.current={...i.formControl,formState:d},i.defaultValues&&!Td(i.defaultValues)&&i.formControl.reset(i.defaultValues,i.resetOptions);else{const{formControl:C,...s}=tX(i);n.current={...s,formState:d}}const v=n.current.control;return v._options=i,IE(()=>{const C=v._subscribe({formState:v._proxyFormState,callback:()=>y({...v._formState}),reRenderRoot:!0});return y(s=>({...s,isReady:!0})),v._formState.isReady=!0,C},[v]),Un.useEffect(()=>v._disableForm(i.disabled),[v,i.disabled]),Un.useEffect(()=>{i.mode&&(v._options.mode=i.mode),i.reValidateMode&&(v._options.reValidateMode=i.reValidateMode)},[v,i.mode,i.reValidateMode]),Un.useEffect(()=>{i.errors&&(v._setErrors(i.errors),v._focusError())},[v,i.errors]),Un.useEffect(()=>{i.shouldUnregister&&v._subjects.state.next({values:v._getWatch()})},[v,i.shouldUnregister]),Un.useEffect(()=>{if(v._proxyFormState.isDirty){const C=v._getDirty();C!==d.isDirty&&v._subjects.state.next({isDirty:C})}},[v,d.isDirty]),Un.useEffect(()=>{i.values&&!Qf(i.values,a.current)?(v._reset(i.values,{keepFieldsRef:!0,...v._options.resetOptions}),a.current=i.values,y(C=>({...C}))):v._resetDefaultValues()},[v,i.values]),Un.useEffect(()=>{v._state.mount||(v._setValid(),v._state.mount=!0),v._state.watch&&(v._state.watch=!1,v._subjects.state.next({...v._formState})),v._removeUnmounted()}),n.current.formState=zO(d,v),n.current}const rR=(i,n,a)=>{if(i&&"reportValidity"in i){const d=ln(a,n);i.setCustomValidity(d&&d.message||""),i.reportValidity()}},ZO=(i,n)=>{for(const a in n.fields){const d=n.fields[a];d&&d.ref&&"reportValidity"in d.ref?rR(d.ref,a,i):d.refs&&d.refs.forEach(y=>rR(y,a,i))}},rX=(i,n)=>{n.shouldUseNativeValidation&&ZO(i,n);const a={};for(const d in i){const y=ln(n.fields,d),v=Object.assign(i[d]||{},{ref:y&&y.ref});if(nX(n.names||Object.keys(i),d)){const C=Object.assign({},ln(a,d));Ns(C,"root",v),Ns(a,d,C)}else Ns(a,d,v)}return a},nX=(i,n)=>i.some(a=>a.startsWith(n+"."));var iX=function(i,n){for(var a={};i.length;){var d=i[0],y=d.code,v=d.message,C=d.path.join(".");if(!a[C])if("unionErrors"in d){var s=d.unionErrors[0].errors[0];a[C]={message:s.message,type:s.code}}else a[C]={message:v,type:y};if("unionErrors"in d&&d.unionErrors.forEach(function(F){return F.errors.forEach(function(W){return i.push(W)})}),n){var M=a[C].types,L=M&&M[d.code];a[C]=BO(C,n,a,y,L?[].concat(L,d.message):d.message)}i.shift()}return a},XO=function(i,n,a){return a===void 0&&(a={}),function(d,y,v){try{return Promise.resolve((function(C,s){try{var M=Promise.resolve(i[a.mode==="sync"?"parse":"parseAsync"](d,n)).then(function(L){return v.shouldUseNativeValidation&&ZO({},v),{errors:{},values:a.raw?d:L}})}catch(L){return s(L)}return M&&M.then?M.then(void 0,s):M})(0,function(C){if((function(s){return Array.isArray(s?.errors)})(C))return{values:{},errors:rX(iX(C.errors,!v.shouldUseNativeValidation&&v.criteriaMode==="all"),v)};throw C}))}catch(C){return Promise.reject(C)}}};const Pr=Symbol.for("drizzle:entityKind");function rl(i,n){if(!i||typeof i!="object")return!1;if(i instanceof n)return!0;if(!Object.prototype.hasOwnProperty.call(n,Pr))throw new Error(`Class "${n.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let a=Object.getPrototypeOf(i).constructor;if(a)for(;a;){if(Pr in a&&a[Pr]===n[Pr])return!0;a=Object.getPrototypeOf(a)}return!1}class Yx{constructor(n,a){this.table=n,this.config=a,this.name=a.name,this.keyAsName=a.keyAsName,this.notNull=a.notNull,this.default=a.default,this.defaultFn=a.defaultFn,this.onUpdateFn=a.onUpdateFn,this.hasDefault=a.hasDefault,this.primary=a.primaryKey,this.isUnique=a.isUnique,this.uniqueName=a.uniqueName,this.uniqueType=a.uniqueType,this.dataType=a.dataType,this.columnType=a.columnType,this.generated=a.generated,this.generatedIdentity=a.generatedIdentity}static[Pr]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(n){return n}mapToDriverValue(n){return n}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class sX{static[Pr]="ColumnBuilder";config;constructor(n,a,d){this.config={name:n,keyAsName:n==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:a,columnType:d,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(n){return this.config.default=n,this.config.hasDefault=!0,this}$defaultFn(n){return this.config.defaultFn=n,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(n){return this.config.onUpdateFn=n,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(n){this.config.name===""&&(this.config.name=n)}}const Zy=Symbol.for("drizzle:Name");class oX{static[Pr]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(n,a){this.reference=()=>{const{name:d,columns:y,foreignColumns:v}=n();return{name:d,columns:y,foreignTable:v[0].table,foreignColumns:v}},a&&(this._onUpdate=a.onUpdate,this._onDelete=a.onDelete)}onUpdate(n){return this._onUpdate=n===void 0?"no action":n,this}onDelete(n){return this._onDelete=n===void 0?"no action":n,this}build(n){return new aX(n,this)}}class aX{constructor(n,a){this.table=n,this.reference=a.reference,this.onUpdate=a._onUpdate,this.onDelete=a._onDelete}static[Pr]="PgForeignKey";reference;onUpdate;onDelete;getName(){const{name:n,columns:a,foreignColumns:d}=this.reference(),y=a.map(s=>s.name),v=d.map(s=>s.name),C=[this.table[Zy],...y,d[0].table[Zy],...v];return n??`${C.join("_")}_fk`}}function lX(i,...n){return i(...n)}function cX(i,n){return`${i[Zy]}_${n.join("_")}_unique`}function nR(i,n,a){for(let d=n;d<i.length;d++){const y=i[d];if(y==="\\"){d++;continue}if(y==='"')return[i.slice(n,d).replace(/\\/g,""),d+1];if(!a&&(y===","||y==="}"))return[i.slice(n,d).replace(/\\/g,""),d]}return[i.slice(n).replace(/\\/g,""),i.length]}function KO(i,n=0){const a=[];let d=n,y=!1;for(;d<i.length;){const v=i[d];if(v===","){(y||d===n)&&a.push(""),y=!0,d++;continue}if(y=!1,v==="\\"){d+=2;continue}if(v==='"'){const[M,L]=nR(i,d+1,!0);a.push(M),d=L;continue}if(v==="}")return[a,d+1];if(v==="{"){const[M,L]=KO(i,d+1);a.push(M),d=L;continue}const[C,s]=nR(i,d,!1);a.push(C),d=s}return[a,d]}function uX(i){const[n]=KO(i,1);return n}function YO(i){return`{${i.map(n=>Array.isArray(n)?YO(n):typeof n=="string"?`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${n}`).join(",")}}`}class ys extends sX{foreignKeyConfigs=[];static[Pr]="PgColumnBuilder";array(n){return new hX(this.config.name,this,n)}references(n,a={}){return this.foreignKeyConfigs.push({ref:n,actions:a}),this}unique(n,a){return this.config.isUnique=!0,this.config.uniqueName=n,this.config.uniqueType=a?.nulls,this}generatedAlwaysAs(n){return this.config.generated={as:n,type:"always",mode:"stored"},this}buildForeignKeys(n,a){return this.foreignKeyConfigs.map(({ref:d,actions:y})=>lX((v,C)=>{const s=new oX(()=>{const M=v();return{columns:[n],foreignColumns:[M]}});return C.onUpdate&&s.onUpdate(C.onUpdate),C.onDelete&&s.onDelete(C.onDelete),s.build(a)},d,y))}buildExtraConfigColumn(n){return new dX(n,this.config)}}class Ui extends Yx{constructor(n,a){a.uniqueName||(a.uniqueName=cX(n,[a.name])),super(n,a),this.table=n}static[Pr]="PgColumn"}class dX extends Ui{static[Pr]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(n){return this.indexConfig.opClass=n,this}}class hX extends ys{static[Pr]="PgArrayBuilder";constructor(n,a,d){super(n,"array","PgArray"),this.config.baseBuilder=a,this.config.size=d}build(n){const a=this.config.baseBuilder.build(n);return new NE(n,this.config,a)}}class NE extends Ui{constructor(n,a,d,y){super(n,a),this.baseColumn=d,this.range=y,this.size=a.size}size;static[Pr]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(n){return typeof n=="string"&&(n=uX(n)),n.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(n,a=!1){const d=n.map(y=>y===null?null:rl(this.baseColumn,NE)?this.baseColumn.mapToDriverValue(y,!0):this.baseColumn.mapToDriverValue(y));return a?d:YO(d)}}const iR=Symbol.for("drizzle:isPgEnum");function fX(i){return!!i&&typeof i=="function"&&iR in i&&i[iR]===!0}class QO{static[Pr]="Subquery";constructor(n,a,d,y=!1){this._={brand:"Subquery",sql:n,selectedFields:a,alias:d,isWith:y}}}const pX={startActiveSpan(i,n){return n()}},Xy=Symbol.for("drizzle:ViewBaseConfig"),XS=Symbol.for("drizzle:Schema"),sR=Symbol.for("drizzle:Columns"),oR=Symbol.for("drizzle:ExtraConfigColumns"),KS=Symbol.for("drizzle:OriginalName"),YS=Symbol.for("drizzle:BaseName"),L0=Symbol.for("drizzle:IsAlias"),aR=Symbol.for("drizzle:ExtraConfigBuilder"),JO=Symbol.for("drizzle:IsDrizzleTable");class qc{static[Pr]="Table";static Symbol={Name:Zy,Schema:XS,OriginalName:KS,Columns:sR,ExtraConfigColumns:oR,BaseName:YS,IsAlias:L0,ExtraConfigBuilder:aR};[Zy];[KS];[XS];[sR];[oR];[YS];[L0]=!1;[JO]=!0;[aR]=void 0;constructor(n,a,d){this[Zy]=this[KS]=n,this[XS]=a,this[YS]=d}}function e3(i){return typeof i=="object"&&i!==null&&JO in i}function mX(i){return i!=null&&typeof i.getSQL=="function"}function gX(i){const n={sql:"",params:[]};for(const a of i)n.sql+=a.sql,n.params.push(...a.params),a.typings?.length&&(n.typings||(n.typings=[]),n.typings.push(...a.typings));return n}class bd{static[Pr]="StringChunk";value;constructor(n){this.value=Array.isArray(n)?n:[n]}getSQL(){return new Vo([this])}}class Vo{constructor(n){this.queryChunks=n}static[Pr]="SQL";decoder=t3;shouldInlineParams=!1;append(n){return this.queryChunks.push(...n.queryChunks),this}toQuery(n){return pX.startActiveSpan("drizzle.buildSQL",a=>{const d=this.buildQueryFromSourceParams(this.queryChunks,n);return a?.setAttributes({"drizzle.query.text":d.sql,"drizzle.query.params":JSON.stringify(d.params)}),d})}buildQueryFromSourceParams(n,a){const d=Object.assign({},a,{inlineParams:a.inlineParams||this.shouldInlineParams,paramStartIndex:a.paramStartIndex||{value:0}}),{casing:y,escapeName:v,escapeParam:C,prepareTyping:s,inlineParams:M,paramStartIndex:L}=d;return gX(n.map(F=>{if(rl(F,bd))return{sql:F.value.join(""),params:[]};if(rl(F,n2))return{sql:v(F.value),params:[]};if(F===void 0)return{sql:"",params:[]};if(Array.isArray(F)){const W=[new bd("(")];for(const[X,ee]of F.entries())W.push(ee),X<F.length-1&&W.push(new bd(", "));return W.push(new bd(")")),this.buildQueryFromSourceParams(W,d)}if(rl(F,Vo))return this.buildQueryFromSourceParams(F.queryChunks,{...d,inlineParams:M||F.shouldInlineParams});if(rl(F,qc)){const W=F[qc.Symbol.Schema],X=F[qc.Symbol.Name];return{sql:W===void 0||F[L0]?v(X):v(W)+"."+v(X),params:[]}}if(rl(F,Yx)){const W=y.getColumnCasing(F);if(a.invokeSource==="indexes")return{sql:v(W),params:[]};const X=F.table[qc.Symbol.Schema];return{sql:F.table[L0]||X===void 0?v(F.table[qc.Symbol.Name])+"."+v(W):v(X)+"."+v(F.table[qc.Symbol.Name])+"."+v(W),params:[]}}if(rl(F,yX)){const W=F[Xy].schema,X=F[Xy].name;return{sql:W===void 0||F[Xy].isAlias?v(X):v(W)+"."+v(X),params:[]}}if(rl(F,n3)){if(rl(F.value,i2))return{sql:C(L.value++,F),params:[F],typings:["none"]};const W=F.value===null?null:F.encoder.mapToDriverValue(F.value);if(rl(W,Vo))return this.buildQueryFromSourceParams([W],d);if(M)return{sql:this.mapInlineParam(W,d),params:[]};let X=["none"];return s&&(X=[s(F.encoder)]),{sql:C(L.value++,W),params:[W],typings:X}}return rl(F,i2)?{sql:C(L.value++,F),params:[F],typings:["none"]}:rl(F,Vo.Aliased)&&F.fieldAlias!==void 0?{sql:v(F.fieldAlias),params:[]}:rl(F,QO)?F._.isWith?{sql:v(F._.alias),params:[]}:this.buildQueryFromSourceParams([new bd("("),F._.sql,new bd(") "),new n2(F._.alias)],d):fX(F)?F.schema?{sql:v(F.schema)+"."+v(F.enumName),params:[]}:{sql:v(F.enumName),params:[]}:mX(F)?F.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([F.getSQL()],d):this.buildQueryFromSourceParams([new bd("("),F.getSQL(),new bd(")")],d):M?{sql:this.mapInlineParam(F,d),params:[]}:{sql:C(L.value++,F),params:[F],typings:["none"]}}))}mapInlineParam(n,{escapeString:a}){if(n===null)return"null";if(typeof n=="number"||typeof n=="boolean")return n.toString();if(typeof n=="string")return a(n);if(typeof n=="object"){const d=n.toString();return a(d==="[object Object]"?JSON.stringify(n):d)}throw new Error("Unexpected param value: "+n)}getSQL(){return this}as(n){return n===void 0?this:new Vo.Aliased(this,n)}mapWith(n){return this.decoder=typeof n=="function"?{mapFromDriverValue:n}:n,this}inlineParams(){return this.shouldInlineParams=!0,this}if(n){return n?this:void 0}}class n2{constructor(n){this.value=n}static[Pr]="Name";brand;getSQL(){return new Vo([this])}}const t3={mapFromDriverValue:i=>i},r3={mapToDriverValue:i=>i};({...t3,...r3});class n3{constructor(n,a=r3){this.value=n,this.encoder=a}static[Pr]="Param";brand;getSQL(){return new Vo([this])}}function D0(i,...n){const a=[];(n.length>0||i.length>0&&i[0]!=="")&&a.push(new bd(i[0]));for(const[d,y]of n.entries())a.push(y,new bd(i[d+1]));return new Vo(a)}(i=>{function n(){return new Vo([])}i.empty=n;function a(M){return new Vo(M)}i.fromList=a;function d(M){return new Vo([new bd(M)])}i.raw=d;function y(M,L){const F=[];for(const[W,X]of M.entries())W>0&&L!==void 0&&F.push(L),F.push(X);return new Vo(F)}i.join=y;function v(M){return new n2(M)}i.identifier=v;function C(M){return new i2(M)}i.placeholder=C;function s(M,L){return new n3(M,L)}i.param=s})(D0||(D0={}));(i=>{class n{constructor(d,y){this.sql=d,this.fieldAlias=y}static[Pr]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}}i.Aliased=n})(Vo||(Vo={}));class i2{constructor(n){this.name=n}static[Pr]="Placeholder";getSQL(){return new Vo([this])}}const i3=Symbol.for("drizzle:IsDrizzleView");class yX{static[Pr]="View";[Xy];[i3]=!0;constructor({name:n,schema:a,selectedFields:d,query:y}){this[Xy]={name:n,originalName:n,schema:a,selectedFields:d,query:y,isExisting:!y,isAlias:!1}}getSQL(){return new Vo([this])}}function _X(i){return typeof i=="object"&&i!==null&&i3 in i}Yx.prototype.getSQL=function(){return new Vo([this])};qc.prototype.getSQL=function(){return new Vo([this])};QO.prototype.getSQL=function(){return new Vo([this])};function xX(i){return i[qc.Symbol.Columns]}function vX(i){return i[Xy].selectedFields}function Wa(i,n){return{name:typeof i=="string"&&i.length>0?i:"",config:typeof i=="object"?i:n}}class vw extends ys{static[Pr]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(n){if(n){const{name:a,...d}=n;this.config.generatedIdentity={type:"always",sequenceName:a,sequenceOptions:d}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(n){if(n){const{name:a,...d}=n;this.config.generatedIdentity={type:"byDefault",sequenceName:a,sequenceOptions:d}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class bX extends vw{static[Pr]="PgBigInt53Builder";constructor(n){super(n,"number","PgBigInt53")}build(n){return new wX(n,this.config)}}class wX extends Ui{static[Pr]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(n){return typeof n=="number"?n:Number(n)}}class SX extends vw{static[Pr]="PgBigInt64Builder";constructor(n){super(n,"bigint","PgBigInt64")}build(n){return new TX(n,this.config)}}class TX extends Ui{static[Pr]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(n){return BigInt(n)}}function EX(i,n){const{name:a,config:d}=Wa(i,n);return d.mode==="number"?new bX(a):new SX(a)}class CX extends ys{static[Pr]="PgBigSerial53Builder";constructor(n){super(n,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(n){return new AX(n,this.config)}}class AX extends Ui{static[Pr]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(n){return typeof n=="number"?n:Number(n)}}class IX extends ys{static[Pr]="PgBigSerial64Builder";constructor(n){super(n,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(n){return new PX(n,this.config)}}class PX extends Ui{static[Pr]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(n){return BigInt(n)}}function kX(i,n){const{name:a,config:d}=Wa(i,n);return d.mode==="number"?new CX(a):new IX(a)}class NX extends ys{static[Pr]="PgBooleanBuilder";constructor(n){super(n,"boolean","PgBoolean")}build(n){return new jX(n,this.config)}}class jX extends Ui{static[Pr]="PgBoolean";getSQLType(){return"boolean"}}function RX(i){return new NX(i??"")}class MX extends ys{static[Pr]="PgCharBuilder";constructor(n,a){super(n,"string","PgChar"),this.config.length=a.length,this.config.enumValues=a.enum}build(n){return new LX(n,this.config)}}class LX extends Ui{static[Pr]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}function DX(i,n={}){const{name:a,config:d}=Wa(i,n);return new MX(a,d)}class OX extends ys{static[Pr]="PgCidrBuilder";constructor(n){super(n,"string","PgCidr")}build(n){return new zX(n,this.config)}}class zX extends Ui{static[Pr]="PgCidr";getSQLType(){return"cidr"}}function FX(i){return new OX(i??"")}class BX extends ys{static[Pr]="PgCustomColumnBuilder";constructor(n,a,d){super(n,"custom","PgCustomColumn"),this.config.fieldConfig=a,this.config.customTypeParams=d}build(n){return new VX(n,this.config)}}class VX extends Ui{static[Pr]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(n,a){super(n,a),this.sqlName=a.customTypeParams.dataType(a.fieldConfig),this.mapTo=a.customTypeParams.toDriver,this.mapFrom=a.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(n){return typeof this.mapFrom=="function"?this.mapFrom(n):n}mapToDriverValue(n){return typeof this.mapTo=="function"?this.mapTo(n):n}}function UX(i){return(n,a)=>{const{name:d,config:y}=Wa(n,a);return new BX(d,y,i)}}class Iv extends ys{static[Pr]="PgDateColumnBaseBuilder";defaultNow(){return this.default(D0`now()`)}}class $X extends Iv{static[Pr]="PgDateBuilder";constructor(n){super(n,"date","PgDate")}build(n){return new qX(n,this.config)}}class qX extends Ui{static[Pr]="PgDate";getSQLType(){return"date"}mapFromDriverValue(n){return new Date(n)}mapToDriverValue(n){return n.toISOString()}}class GX extends Iv{static[Pr]="PgDateStringBuilder";constructor(n){super(n,"string","PgDateString")}build(n){return new WX(n,this.config)}}class WX extends Ui{static[Pr]="PgDateString";getSQLType(){return"date"}}function HX(i,n){const{name:a,config:d}=Wa(i,n);return d?.mode==="date"?new $X(a):new GX(a)}class ZX extends ys{static[Pr]="PgDoublePrecisionBuilder";constructor(n){super(n,"number","PgDoublePrecision")}build(n){return new XX(n,this.config)}}class XX extends Ui{static[Pr]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(n){return typeof n=="string"?Number.parseFloat(n):n}}function KX(i){return new ZX(i??"")}class YX extends ys{static[Pr]="PgInetBuilder";constructor(n){super(n,"string","PgInet")}build(n){return new QX(n,this.config)}}class QX extends Ui{static[Pr]="PgInet";getSQLType(){return"inet"}}function JX(i){return new YX(i??"")}class eK extends vw{static[Pr]="PgIntegerBuilder";constructor(n){super(n,"number","PgInteger")}build(n){return new tK(n,this.config)}}class tK extends Ui{static[Pr]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(n){return typeof n=="string"?Number.parseInt(n):n}}function rK(i){return new eK(i??"")}class nK extends ys{static[Pr]="PgIntervalBuilder";constructor(n,a){super(n,"string","PgInterval"),this.config.intervalConfig=a}build(n){return new iK(n,this.config)}}class iK extends Ui{static[Pr]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){const n=this.fields?` ${this.fields}`:"",a=this.precision?`(${this.precision})`:"";return`interval${n}${a}`}}function sK(i,n={}){const{name:a,config:d}=Wa(i,n);return new nK(a,d)}class oK extends ys{static[Pr]="PgJsonBuilder";constructor(n){super(n,"json","PgJson")}build(n){return new aK(n,this.config)}}class aK extends Ui{static[Pr]="PgJson";constructor(n,a){super(n,a)}getSQLType(){return"json"}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n}}function lK(i){return new oK(i??"")}class cK extends ys{static[Pr]="PgJsonbBuilder";constructor(n){super(n,"json","PgJsonb")}build(n){return new uK(n,this.config)}}class uK extends Ui{static[Pr]="PgJsonb";constructor(n,a){super(n,a)}getSQLType(){return"jsonb"}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n}}function dK(i){return new cK(i??"")}class hK extends ys{static[Pr]="PgLineBuilder";constructor(n){super(n,"array","PgLine")}build(n){return new fK(n,this.config)}}class fK extends Ui{static[Pr]="PgLine";getSQLType(){return"line"}mapFromDriverValue(n){const[a,d,y]=n.slice(1,-1).split(",");return[Number.parseFloat(a),Number.parseFloat(d),Number.parseFloat(y)]}mapToDriverValue(n){return`{${n[0]},${n[1]},${n[2]}}`}}class pK extends ys{static[Pr]="PgLineABCBuilder";constructor(n){super(n,"json","PgLineABC")}build(n){return new mK(n,this.config)}}class mK extends Ui{static[Pr]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(n){const[a,d,y]=n.slice(1,-1).split(",");return{a:Number.parseFloat(a),b:Number.parseFloat(d),c:Number.parseFloat(y)}}mapToDriverValue(n){return`{${n.a},${n.b},${n.c}}`}}function gK(i,n){const{name:a,config:d}=Wa(i,n);return!d?.mode||d.mode==="tuple"?new hK(a):new pK(a)}class yK extends ys{static[Pr]="PgMacaddrBuilder";constructor(n){super(n,"string","PgMacaddr")}build(n){return new _K(n,this.config)}}class _K extends Ui{static[Pr]="PgMacaddr";getSQLType(){return"macaddr"}}function xK(i){return new yK(i??"")}class vK extends ys{static[Pr]="PgMacaddr8Builder";constructor(n){super(n,"string","PgMacaddr8")}build(n){return new bK(n,this.config)}}class bK extends Ui{static[Pr]="PgMacaddr8";getSQLType(){return"macaddr8"}}function wK(i){return new vK(i??"")}class SK extends ys{static[Pr]="PgNumericBuilder";constructor(n,a,d){super(n,"string","PgNumeric"),this.config.precision=a,this.config.scale=d}build(n){return new TK(n,this.config)}}class TK extends Ui{static[Pr]="PgNumeric";precision;scale;constructor(n,a){super(n,a),this.precision=a.precision,this.scale=a.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}function EK(i,n){const{name:a,config:d}=Wa(i,n);return new SK(a,d?.precision,d?.scale)}class CK extends ys{static[Pr]="PgPointTupleBuilder";constructor(n){super(n,"array","PgPointTuple")}build(n){return new AK(n,this.config)}}class AK extends Ui{static[Pr]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(n){if(typeof n=="string"){const[a,d]=n.slice(1,-1).split(",");return[Number.parseFloat(a),Number.parseFloat(d)]}return[n.x,n.y]}mapToDriverValue(n){return`(${n[0]},${n[1]})`}}class IK extends ys{static[Pr]="PgPointObjectBuilder";constructor(n){super(n,"json","PgPointObject")}build(n){return new PK(n,this.config)}}class PK extends Ui{static[Pr]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(n){if(typeof n=="string"){const[a,d]=n.slice(1,-1).split(",");return{x:Number.parseFloat(a),y:Number.parseFloat(d)}}return n}mapToDriverValue(n){return`(${n.x},${n.y})`}}function kK(i,n){const{name:a,config:d}=Wa(i,n);return!d?.mode||d.mode==="tuple"?new CK(a):new IK(a)}function NK(i){const n=[];for(let a=0;a<i.length;a+=2)n.push(Number.parseInt(i.slice(a,a+2),16));return new Uint8Array(n)}function lR(i,n){const a=new ArrayBuffer(8),d=new DataView(a);for(let y=0;y<8;y++)d.setUint8(y,i[n+y]);return d.getFloat64(0,!0)}function s3(i){const n=NK(i);let a=0;const d=n[a];a+=1;const y=new DataView(n.buffer),v=y.getUint32(a,d===1);if(a+=4,v&536870912&&(y.getUint32(a,d===1),a+=4),(v&65535)===1){const C=lR(n,a);a+=8;const s=lR(n,a);return a+=8,[C,s]}throw new Error("Unsupported geometry type")}class jK extends ys{static[Pr]="PgGeometryBuilder";constructor(n){super(n,"array","PgGeometry")}build(n){return new RK(n,this.config)}}class RK extends Ui{static[Pr]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(n){return s3(n)}mapToDriverValue(n){return`point(${n[0]} ${n[1]})`}}class MK extends ys{static[Pr]="PgGeometryObjectBuilder";constructor(n){super(n,"json","PgGeometryObject")}build(n){return new LK(n,this.config)}}class LK extends Ui{static[Pr]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(n){const a=s3(n);return{x:a[0],y:a[1]}}mapToDriverValue(n){return`point(${n.x} ${n.y})`}}function DK(i,n){const{name:a,config:d}=Wa(i,n);return!d?.mode||d.mode==="tuple"?new jK(a):new MK(a)}class OK extends ys{static[Pr]="PgRealBuilder";constructor(n,a){super(n,"number","PgReal"),this.config.length=a}build(n){return new zK(n,this.config)}}class zK extends Ui{static[Pr]="PgReal";constructor(n,a){super(n,a)}getSQLType(){return"real"}mapFromDriverValue=n=>typeof n=="string"?Number.parseFloat(n):n}function FK(i){return new OK(i??"")}class BK extends ys{static[Pr]="PgSerialBuilder";constructor(n){super(n,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(n){return new VK(n,this.config)}}class VK extends Ui{static[Pr]="PgSerial";getSQLType(){return"serial"}}function jE(i){return new BK(i??"")}class UK extends vw{static[Pr]="PgSmallIntBuilder";constructor(n){super(n,"number","PgSmallInt")}build(n){return new $K(n,this.config)}}class $K extends Ui{static[Pr]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=n=>typeof n=="string"?Number(n):n}function qK(i){return new UK(i??"")}class GK extends ys{static[Pr]="PgSmallSerialBuilder";constructor(n){super(n,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(n){return new WK(n,this.config)}}class WK extends Ui{static[Pr]="PgSmallSerial";getSQLType(){return"smallserial"}}function HK(i){return new GK(i??"")}class ZK extends ys{static[Pr]="PgTextBuilder";constructor(n,a){super(n,"string","PgText"),this.config.enumValues=a.enum}build(n){return new XK(n,this.config)}}class XK extends Ui{static[Pr]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function o3(i,n={}){const{name:a,config:d}=Wa(i,n);return new ZK(a,d)}class KK extends Iv{constructor(n,a,d){super(n,"string","PgTime"),this.withTimezone=a,this.precision=d,this.config.withTimezone=a,this.config.precision=d}static[Pr]="PgTimeBuilder";build(n){return new YK(n,this.config)}}class YK extends Ui{static[Pr]="PgTime";withTimezone;precision;constructor(n,a){super(n,a),this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function QK(i,n={}){const{name:a,config:d}=Wa(i,n);return new KK(a,d.withTimezone??!1,d.precision)}class JK extends Iv{static[Pr]="PgTimestampBuilder";constructor(n,a,d){super(n,"date","PgTimestamp"),this.config.withTimezone=a,this.config.precision=d}build(n){return new eY(n,this.config)}}class eY extends Ui{static[Pr]="PgTimestamp";withTimezone;precision;constructor(n,a){super(n,a),this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=n=>new Date(this.withTimezone?n:n+"+0000");mapToDriverValue=n=>n.toISOString()}class tY extends Iv{static[Pr]="PgTimestampStringBuilder";constructor(n,a,d){super(n,"string","PgTimestampString"),this.config.withTimezone=a,this.config.precision=d}build(n){return new rY(n,this.config)}}class rY extends Ui{static[Pr]="PgTimestampString";withTimezone;precision;constructor(n,a){super(n,a),this.withTimezone=a.withTimezone,this.precision=a.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function nY(i,n={}){const{name:a,config:d}=Wa(i,n);return d?.mode==="string"?new tY(a,d.withTimezone??!1,d.precision):new JK(a,d?.withTimezone??!1,d?.precision)}class iY extends ys{static[Pr]="PgUUIDBuilder";constructor(n){super(n,"string","PgUUID")}defaultRandom(){return this.default(D0`gen_random_uuid()`)}build(n){return new sY(n,this.config)}}class sY extends Ui{static[Pr]="PgUUID";getSQLType(){return"uuid"}}function oY(i){return new iY(i??"")}class aY extends ys{static[Pr]="PgVarcharBuilder";constructor(n,a){super(n,"string","PgVarchar"),this.config.length=a.length,this.config.enumValues=a.enum}build(n){return new lY(n,this.config)}}class lY extends Ui{static[Pr]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}function Qx(i,n={}){const{name:a,config:d}=Wa(i,n);return new aY(a,d)}class cY extends ys{static[Pr]="PgBinaryVectorBuilder";constructor(n,a){super(n,"string","PgBinaryVector"),this.config.dimensions=a.dimensions}build(n){return new uY(n,this.config)}}class uY extends Ui{static[Pr]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function dY(i,n){const{name:a,config:d}=Wa(i,n);return new cY(a,d)}class hY extends ys{static[Pr]="PgHalfVectorBuilder";constructor(n,a){super(n,"array","PgHalfVector"),this.config.dimensions=a.dimensions}build(n){return new fY(n,this.config)}}class fY extends Ui{static[Pr]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function pY(i,n){const{name:a,config:d}=Wa(i,n);return new hY(a,d)}class mY extends ys{static[Pr]="PgSparseVectorBuilder";constructor(n,a){super(n,"string","PgSparseVector"),this.config.dimensions=a.dimensions}build(n){return new gY(n,this.config)}}class gY extends Ui{static[Pr]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function yY(i,n){const{name:a,config:d}=Wa(i,n);return new mY(a,d)}class _Y extends ys{static[Pr]="PgVectorBuilder";constructor(n,a){super(n,"array","PgVector"),this.config.dimensions=a.dimensions}build(n){return new xY(n,this.config)}}class xY extends Ui{static[Pr]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function vY(i,n){const{name:a,config:d}=Wa(i,n);return new _Y(a,d)}function bY(){return{bigint:EX,bigserial:kX,boolean:RX,char:DX,cidr:FX,customType:UX,date:HX,doublePrecision:KX,inet:JX,integer:rK,interval:sK,json:lK,jsonb:dK,line:gK,macaddr:xK,macaddr8:wK,numeric:EK,point:kK,geometry:DK,real:FK,serial:jE,smallint:qK,smallserial:HK,text:o3,time:QK,timestamp:nY,uuid:oY,varchar:Qx,bit:dY,halfvec:pY,sparsevec:yY,vector:vY}}const s2=Symbol.for("drizzle:PgInlineForeignKeys"),cR=Symbol.for("drizzle:EnableRLS");class uR extends qc{static[Pr]="PgTable";static Symbol=Object.assign({},qc.Symbol,{InlineForeignKeys:s2,EnableRLS:cR});[s2]=[];[cR]=!1;[qc.Symbol.ExtraConfigBuilder]=void 0}function wY(i,n,a,d,y=i){const v=new uR(i,d,y),C=typeof n=="function"?n(bY()):n,s=Object.fromEntries(Object.entries(C).map(([F,W])=>{const X=W;X.setName(F);const ee=X.build(v);return v[s2].push(...X.buildForeignKeys(ee,v)),[F,ee]})),M=Object.fromEntries(Object.entries(C).map(([F,W])=>{const X=W;X.setName(F);const ee=X.buildExtraConfigColumn(v);return[F,ee]})),L=Object.assign(v,s);return L[qc.Symbol.Columns]=s,L[qc.Symbol.ExtraConfigColumns]=M,Object.assign(L,{enableRLS:()=>(L[uR.Symbol.EnableRLS]=!0,L)})}const a3=(i,n,a)=>wY(i,n,a,void 0);var fs;(function(i){i.assertEqual=y=>{};function n(y){}i.assertIs=n;function a(y){throw new Error}i.assertNever=a,i.arrayToEnum=y=>{const v={};for(const C of y)v[C]=C;return v},i.getValidEnumValues=y=>{const v=i.objectKeys(y).filter(s=>typeof y[y[s]]!="number"),C={};for(const s of v)C[s]=y[s];return i.objectValues(C)},i.objectValues=y=>i.objectKeys(y).map(function(v){return y[v]}),i.objectKeys=typeof Object.keys=="function"?y=>Object.keys(y):y=>{const v=[];for(const C in y)Object.prototype.hasOwnProperty.call(y,C)&&v.push(C);return v},i.find=(y,v)=>{for(const C of y)if(v(C))return C},i.isInteger=typeof Number.isInteger=="function"?y=>Number.isInteger(y):y=>typeof y=="number"&&Number.isFinite(y)&&Math.floor(y)===y;function d(y,v=" | "){return y.map(C=>typeof C=="string"?`'${C}'`:C).join(v)}i.joinValues=d,i.jsonStringifyReplacer=(y,v)=>typeof v=="bigint"?v.toString():v})(fs||(fs={}));var o2;(function(i){i.mergeShapes=(n,a)=>({...n,...a})})(o2||(o2={}));const _n=fs.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Yf=i=>{switch(typeof i){case"undefined":return _n.undefined;case"string":return _n.string;case"number":return Number.isNaN(i)?_n.nan:_n.number;case"boolean":return _n.boolean;case"function":return _n.function;case"bigint":return _n.bigint;case"symbol":return _n.symbol;case"object":return Array.isArray(i)?_n.array:i===null?_n.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?_n.promise:typeof Map<"u"&&i instanceof Map?_n.map:typeof Set<"u"&&i instanceof Set?_n.set:typeof Date<"u"&&i instanceof Date?_n.date:_n.object;default:return _n.unknown}},zr=fs.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),SY=i=>JSON.stringify(i,null,2).replace(/"([^"]+)":/g,"$1:");class Kc extends Error{get errors(){return this.issues}constructor(n){super(),this.issues=[],this.addIssue=d=>{this.issues=[...this.issues,d]},this.addIssues=(d=[])=>{this.issues=[...this.issues,...d]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=n}format(n){const a=n||function(v){return v.message},d={_errors:[]},y=v=>{for(const C of v.issues)if(C.code==="invalid_union")C.unionErrors.map(y);else if(C.code==="invalid_return_type")y(C.returnTypeError);else if(C.code==="invalid_arguments")y(C.argumentsError);else if(C.path.length===0)d._errors.push(a(C));else{let s=d,M=0;for(;M<C.path.length;){const L=C.path[M];M===C.path.length-1?(s[L]=s[L]||{_errors:[]},s[L]._errors.push(a(C))):s[L]=s[L]||{_errors:[]},s=s[L],M++}}};return y(this),d}static assert(n){if(!(n instanceof Kc))throw new Error(`Not a ZodError: ${n}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,fs.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(n=a=>a.message){const a={},d=[];for(const y of this.issues)if(y.path.length>0){const v=y.path[0];a[v]=a[v]||[],a[v].push(n(y))}else d.push(n(y));return{formErrors:d,fieldErrors:a}}get formErrors(){return this.flatten()}}Kc.create=i=>new Kc(i);const c_=(i,n)=>{let a;switch(i.code){case zr.invalid_type:i.received===_n.undefined?a="Required":a=`Expected ${i.expected}, received ${i.received}`;break;case zr.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(i.expected,fs.jsonStringifyReplacer)}`;break;case zr.unrecognized_keys:a=`Unrecognized key(s) in object: ${fs.joinValues(i.keys,", ")}`;break;case zr.invalid_union:a="Invalid input";break;case zr.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${fs.joinValues(i.options)}`;break;case zr.invalid_enum_value:a=`Invalid enum value. Expected ${fs.joinValues(i.options)}, received '${i.received}'`;break;case zr.invalid_arguments:a="Invalid function arguments";break;case zr.invalid_return_type:a="Invalid function return type";break;case zr.invalid_date:a="Invalid date";break;case zr.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(a=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?a=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?a=`Invalid input: must end with "${i.validation.endsWith}"`:fs.assertNever(i.validation):i.validation!=="regex"?a=`Invalid ${i.validation}`:a="Invalid";break;case zr.too_small:i.type==="array"?a=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?a=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?a=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="bigint"?a=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?a=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:a="Invalid input";break;case zr.too_big:i.type==="array"?a=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?a=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?a=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?a=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?a=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:a="Invalid input";break;case zr.custom:a="Invalid input";break;case zr.invalid_intersection_types:a="Intersection results could not be merged";break;case zr.not_multiple_of:a=`Number must be a multiple of ${i.multipleOf}`;break;case zr.not_finite:a="Number must be finite";break;default:a=n.defaultError,fs.assertNever(i)}return{message:a}};let l3=c_;function TY(i){l3=i}function O0(){return l3}const z0=i=>{const{data:n,path:a,errorMaps:d,issueData:y}=i,v=[...a,...y.path||[]],C={...y,path:v};if(y.message!==void 0)return{...y,path:v,message:y.message};let s="";const M=d.filter(L=>!!L).slice().reverse();for(const L of M)s=L(C,{data:n,defaultError:s}).message;return{...y,path:v,message:s}},EY=[];function cn(i,n){const a=O0(),d=z0({issueData:n,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,a,a===c_?void 0:c_].filter(y=>!!y)});i.common.issues.push(d)}class Cl{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(n,a){const d=[];for(const y of a){if(y.status==="aborted")return mi;y.status==="dirty"&&n.dirty(),d.push(y.value)}return{status:n.value,value:d}}static async mergeObjectAsync(n,a){const d=[];for(const y of a){const v=await y.key,C=await y.value;d.push({key:v,value:C})}return Cl.mergeObjectSync(n,d)}static mergeObjectSync(n,a){const d={};for(const y of a){const{key:v,value:C}=y;if(v.status==="aborted"||C.status==="aborted")return mi;v.status==="dirty"&&n.dirty(),C.status==="dirty"&&n.dirty(),v.value!=="__proto__"&&(typeof C.value<"u"||y.alwaysSet)&&(d[v.value]=C.value)}return{status:n.value,value:d}}}const mi=Object.freeze({status:"aborted"}),$y=i=>({status:"dirty",value:i}),Kl=i=>({status:"valid",value:i}),a2=i=>i.status==="aborted",l2=i=>i.status==="dirty",Ig=i=>i.status==="valid",Jx=i=>typeof Promise<"u"&&i instanceof Promise;var zn;(function(i){i.errToObj=n=>typeof n=="string"?{message:n}:n||{},i.toString=n=>typeof n=="string"?n:n?.message})(zn||(zn={}));class Dh{constructor(n,a,d,y){this._cachedPath=[],this.parent=n,this.data=a,this._path=d,this._key=y}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const dR=(i,n)=>{if(Ig(n))return{success:!0,data:n.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new Kc(i.common.issues);return this._error=a,this._error}}};function Di(i){if(!i)return{};const{errorMap:n,invalid_type_error:a,required_error:d,description:y}=i;if(n&&(a||d))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return n?{errorMap:n,description:y}:{errorMap:(C,s)=>{const{message:M}=i;return C.code==="invalid_enum_value"?{message:M??s.defaultError}:typeof s.data>"u"?{message:M??d??s.defaultError}:C.code!=="invalid_type"?{message:s.defaultError}:{message:M??a??s.defaultError}},description:y}}class qi{get description(){return this._def.description}_getType(n){return Yf(n.data)}_getOrReturnCtx(n,a){return a||{common:n.parent.common,data:n.data,parsedType:Yf(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}_processInputParams(n){return{status:new Cl,ctx:{common:n.parent.common,data:n.data,parsedType:Yf(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}}_parseSync(n){const a=this._parse(n);if(Jx(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(n){const a=this._parse(n);return Promise.resolve(a)}parse(n,a){const d=this.safeParse(n,a);if(d.success)return d.data;throw d.error}safeParse(n,a){const d={common:{issues:[],async:a?.async??!1,contextualErrorMap:a?.errorMap},path:a?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:Yf(n)},y=this._parseSync({data:n,path:d.path,parent:d});return dR(d,y)}"~validate"(n){const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:Yf(n)};if(!this["~standard"].async)try{const d=this._parseSync({data:n,path:[],parent:a});return Ig(d)?{value:d.value}:{issues:a.common.issues}}catch(d){d?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:n,path:[],parent:a}).then(d=>Ig(d)?{value:d.value}:{issues:a.common.issues})}async parseAsync(n,a){const d=await this.safeParseAsync(n,a);if(d.success)return d.data;throw d.error}async safeParseAsync(n,a){const d={common:{issues:[],contextualErrorMap:a?.errorMap,async:!0},path:a?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:Yf(n)},y=this._parse({data:n,path:d.path,parent:d}),v=await(Jx(y)?y:Promise.resolve(y));return dR(d,v)}refine(n,a){const d=y=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(y):a;return this._refinement((y,v)=>{const C=n(y),s=()=>v.addIssue({code:zr.custom,...d(y)});return typeof Promise<"u"&&C instanceof Promise?C.then(M=>M?!0:(s(),!1)):C?!0:(s(),!1)})}refinement(n,a){return this._refinement((d,y)=>n(d)?!0:(y.addIssue(typeof a=="function"?a(d,y):a),!1))}_refinement(n){return new Id({schema:this,typeName:vi.ZodEffects,effect:{type:"refinement",refinement:n}})}superRefine(n){return this._refinement(n)}constructor(n){this.spa=this.safeParseAsync,this._def=n,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return Mh.create(this,this._def)}nullable(){return xm.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Cd.create(this)}promise(){return d_.create(this,this._def)}or(n){return nv.create([this,n],this._def)}and(n){return iv.create(this,n,this._def)}transform(n){return new Id({...Di(this._def),schema:this,typeName:vi.ZodEffects,effect:{type:"transform",transform:n}})}default(n){const a=typeof n=="function"?n:()=>n;return new cv({...Di(this._def),innerType:this,defaultValue:a,typeName:vi.ZodDefault})}brand(){return new RE({typeName:vi.ZodBranded,type:this,...Di(this._def)})}catch(n){const a=typeof n=="function"?n:()=>n;return new uv({...Di(this._def),innerType:this,catchValue:a,typeName:vi.ZodCatch})}describe(n){const a=this.constructor;return new a({...this._def,description:n})}pipe(n){return Pv.create(this,n)}readonly(){return dv.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const CY=/^c[^\s-]{8,}$/i,AY=/^[0-9a-z]+$/,IY=/^[0-9A-HJKMNP-TV-Z]{26}$/i,PY=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kY=/^[a-z0-9_-]{21}$/i,NY=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,jY=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,RY=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,MY="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let QS;const LY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,DY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,OY=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,zY=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,FY=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,BY=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,c3="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",VY=new RegExp(`^${c3}$`);function u3(i){let n="[0-5]\\d";i.precision?n=`${n}\\.\\d{${i.precision}}`:i.precision==null&&(n=`${n}(\\.\\d+)?`);const a=i.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${n})${a}`}function UY(i){return new RegExp(`^${u3(i)}$`)}function d3(i){let n=`${c3}T${u3(i)}`;const a=[];return a.push(i.local?"Z?":"Z"),i.offset&&a.push("([+-]\\d{2}:?\\d{2})"),n=`${n}(${a.join("|")})`,new RegExp(`^${n}$`)}function $Y(i,n){return!!((n==="v4"||!n)&&LY.test(i)||(n==="v6"||!n)&&OY.test(i))}function qY(i,n){if(!NY.test(i))return!1;try{const[a]=i.split(".");if(!a)return!1;const d=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),y=JSON.parse(atob(d));return!(typeof y!="object"||y===null||"typ"in y&&y?.typ!=="JWT"||!y.alg||n&&y.alg!==n)}catch{return!1}}function GY(i,n){return!!((n==="v4"||!n)&&DY.test(i)||(n==="v6"||!n)&&zY.test(i))}class Ed extends qi{_parse(n){if(this._def.coerce&&(n.data=String(n.data)),this._getType(n)!==_n.string){const v=this._getOrReturnCtx(n);return cn(v,{code:zr.invalid_type,expected:_n.string,received:v.parsedType}),mi}const d=new Cl;let y;for(const v of this._def.checks)if(v.kind==="min")n.data.length<v.value&&(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),d.dirty());else if(v.kind==="max")n.data.length>v.value&&(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),d.dirty());else if(v.kind==="length"){const C=n.data.length>v.value,s=n.data.length<v.value;(C||s)&&(y=this._getOrReturnCtx(n,y),C?cn(y,{code:zr.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}):s&&cn(y,{code:zr.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}),d.dirty())}else if(v.kind==="email")RY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"email",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="emoji")QS||(QS=new RegExp(MY,"u")),QS.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"emoji",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="uuid")PY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"uuid",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="nanoid")kY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"nanoid",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="cuid")CY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"cuid",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="cuid2")AY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"cuid2",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="ulid")IY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"ulid",code:zr.invalid_string,message:v.message}),d.dirty());else if(v.kind==="url")try{new URL(n.data)}catch{y=this._getOrReturnCtx(n,y),cn(y,{validation:"url",code:zr.invalid_string,message:v.message}),d.dirty()}else v.kind==="regex"?(v.regex.lastIndex=0,v.regex.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"regex",code:zr.invalid_string,message:v.message}),d.dirty())):v.kind==="trim"?n.data=n.data.trim():v.kind==="includes"?n.data.includes(v.value,v.position)||(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.invalid_string,validation:{includes:v.value,position:v.position},message:v.message}),d.dirty()):v.kind==="toLowerCase"?n.data=n.data.toLowerCase():v.kind==="toUpperCase"?n.data=n.data.toUpperCase():v.kind==="startsWith"?n.data.startsWith(v.value)||(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.invalid_string,validation:{startsWith:v.value},message:v.message}),d.dirty()):v.kind==="endsWith"?n.data.endsWith(v.value)||(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.invalid_string,validation:{endsWith:v.value},message:v.message}),d.dirty()):v.kind==="datetime"?d3(v).test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.invalid_string,validation:"datetime",message:v.message}),d.dirty()):v.kind==="date"?VY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.invalid_string,validation:"date",message:v.message}),d.dirty()):v.kind==="time"?UY(v).test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.invalid_string,validation:"time",message:v.message}),d.dirty()):v.kind==="duration"?jY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"duration",code:zr.invalid_string,message:v.message}),d.dirty()):v.kind==="ip"?$Y(n.data,v.version)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"ip",code:zr.invalid_string,message:v.message}),d.dirty()):v.kind==="jwt"?qY(n.data,v.alg)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"jwt",code:zr.invalid_string,message:v.message}),d.dirty()):v.kind==="cidr"?GY(n.data,v.version)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"cidr",code:zr.invalid_string,message:v.message}),d.dirty()):v.kind==="base64"?FY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"base64",code:zr.invalid_string,message:v.message}),d.dirty()):v.kind==="base64url"?BY.test(n.data)||(y=this._getOrReturnCtx(n,y),cn(y,{validation:"base64url",code:zr.invalid_string,message:v.message}),d.dirty()):fs.assertNever(v);return{status:d.value,value:n.data}}_regex(n,a,d){return this.refinement(y=>n.test(y),{validation:a,code:zr.invalid_string,...zn.errToObj(d)})}_addCheck(n){return new Ed({...this._def,checks:[...this._def.checks,n]})}email(n){return this._addCheck({kind:"email",...zn.errToObj(n)})}url(n){return this._addCheck({kind:"url",...zn.errToObj(n)})}emoji(n){return this._addCheck({kind:"emoji",...zn.errToObj(n)})}uuid(n){return this._addCheck({kind:"uuid",...zn.errToObj(n)})}nanoid(n){return this._addCheck({kind:"nanoid",...zn.errToObj(n)})}cuid(n){return this._addCheck({kind:"cuid",...zn.errToObj(n)})}cuid2(n){return this._addCheck({kind:"cuid2",...zn.errToObj(n)})}ulid(n){return this._addCheck({kind:"ulid",...zn.errToObj(n)})}base64(n){return this._addCheck({kind:"base64",...zn.errToObj(n)})}base64url(n){return this._addCheck({kind:"base64url",...zn.errToObj(n)})}jwt(n){return this._addCheck({kind:"jwt",...zn.errToObj(n)})}ip(n){return this._addCheck({kind:"ip",...zn.errToObj(n)})}cidr(n){return this._addCheck({kind:"cidr",...zn.errToObj(n)})}datetime(n){return typeof n=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:n}):this._addCheck({kind:"datetime",precision:typeof n?.precision>"u"?null:n?.precision,offset:n?.offset??!1,local:n?.local??!1,...zn.errToObj(n?.message)})}date(n){return this._addCheck({kind:"date",message:n})}time(n){return typeof n=="string"?this._addCheck({kind:"time",precision:null,message:n}):this._addCheck({kind:"time",precision:typeof n?.precision>"u"?null:n?.precision,...zn.errToObj(n?.message)})}duration(n){return this._addCheck({kind:"duration",...zn.errToObj(n)})}regex(n,a){return this._addCheck({kind:"regex",regex:n,...zn.errToObj(a)})}includes(n,a){return this._addCheck({kind:"includes",value:n,position:a?.position,...zn.errToObj(a?.message)})}startsWith(n,a){return this._addCheck({kind:"startsWith",value:n,...zn.errToObj(a)})}endsWith(n,a){return this._addCheck({kind:"endsWith",value:n,...zn.errToObj(a)})}min(n,a){return this._addCheck({kind:"min",value:n,...zn.errToObj(a)})}max(n,a){return this._addCheck({kind:"max",value:n,...zn.errToObj(a)})}length(n,a){return this._addCheck({kind:"length",value:n,...zn.errToObj(a)})}nonempty(n){return this.min(1,zn.errToObj(n))}trim(){return new Ed({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ed({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ed({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(n=>n.kind==="datetime")}get isDate(){return!!this._def.checks.find(n=>n.kind==="date")}get isTime(){return!!this._def.checks.find(n=>n.kind==="time")}get isDuration(){return!!this._def.checks.find(n=>n.kind==="duration")}get isEmail(){return!!this._def.checks.find(n=>n.kind==="email")}get isURL(){return!!this._def.checks.find(n=>n.kind==="url")}get isEmoji(){return!!this._def.checks.find(n=>n.kind==="emoji")}get isUUID(){return!!this._def.checks.find(n=>n.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(n=>n.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(n=>n.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(n=>n.kind==="cuid2")}get isULID(){return!!this._def.checks.find(n=>n.kind==="ulid")}get isIP(){return!!this._def.checks.find(n=>n.kind==="ip")}get isCIDR(){return!!this._def.checks.find(n=>n.kind==="cidr")}get isBase64(){return!!this._def.checks.find(n=>n.kind==="base64")}get isBase64url(){return!!this._def.checks.find(n=>n.kind==="base64url")}get minLength(){let n=null;for(const a of this._def.checks)a.kind==="min"&&(n===null||a.value>n)&&(n=a.value);return n}get maxLength(){let n=null;for(const a of this._def.checks)a.kind==="max"&&(n===null||a.value<n)&&(n=a.value);return n}}Ed.create=i=>new Ed({checks:[],typeName:vi.ZodString,coerce:i?.coerce??!1,...Di(i)});function WY(i,n){const a=(i.toString().split(".")[1]||"").length,d=(n.toString().split(".")[1]||"").length,y=a>d?a:d,v=Number.parseInt(i.toFixed(y).replace(".","")),C=Number.parseInt(n.toFixed(y).replace(".",""));return v%C/10**y}class gm extends qi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(n){if(this._def.coerce&&(n.data=Number(n.data)),this._getType(n)!==_n.number){const v=this._getOrReturnCtx(n);return cn(v,{code:zr.invalid_type,expected:_n.number,received:v.parsedType}),mi}let d;const y=new Cl;for(const v of this._def.checks)v.kind==="int"?fs.isInteger(n.data)||(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.invalid_type,expected:"integer",received:"float",message:v.message}),y.dirty()):v.kind==="min"?(v.inclusive?n.data<v.value:n.data<=v.value)&&(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.too_small,minimum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),y.dirty()):v.kind==="max"?(v.inclusive?n.data>v.value:n.data>=v.value)&&(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.too_big,maximum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),y.dirty()):v.kind==="multipleOf"?WY(n.data,v.value)!==0&&(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.not_multiple_of,multipleOf:v.value,message:v.message}),y.dirty()):v.kind==="finite"?Number.isFinite(n.data)||(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.not_finite,message:v.message}),y.dirty()):fs.assertNever(v);return{status:y.value,value:n.data}}gte(n,a){return this.setLimit("min",n,!0,zn.toString(a))}gt(n,a){return this.setLimit("min",n,!1,zn.toString(a))}lte(n,a){return this.setLimit("max",n,!0,zn.toString(a))}lt(n,a){return this.setLimit("max",n,!1,zn.toString(a))}setLimit(n,a,d,y){return new gm({...this._def,checks:[...this._def.checks,{kind:n,value:a,inclusive:d,message:zn.toString(y)}]})}_addCheck(n){return new gm({...this._def,checks:[...this._def.checks,n]})}int(n){return this._addCheck({kind:"int",message:zn.toString(n)})}positive(n){return this._addCheck({kind:"min",value:0,inclusive:!1,message:zn.toString(n)})}negative(n){return this._addCheck({kind:"max",value:0,inclusive:!1,message:zn.toString(n)})}nonpositive(n){return this._addCheck({kind:"max",value:0,inclusive:!0,message:zn.toString(n)})}nonnegative(n){return this._addCheck({kind:"min",value:0,inclusive:!0,message:zn.toString(n)})}multipleOf(n,a){return this._addCheck({kind:"multipleOf",value:n,message:zn.toString(a)})}finite(n){return this._addCheck({kind:"finite",message:zn.toString(n)})}safe(n){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:zn.toString(n)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:zn.toString(n)})}get minValue(){let n=null;for(const a of this._def.checks)a.kind==="min"&&(n===null||a.value>n)&&(n=a.value);return n}get maxValue(){let n=null;for(const a of this._def.checks)a.kind==="max"&&(n===null||a.value<n)&&(n=a.value);return n}get isInt(){return!!this._def.checks.find(n=>n.kind==="int"||n.kind==="multipleOf"&&fs.isInteger(n.value))}get isFinite(){let n=null,a=null;for(const d of this._def.checks){if(d.kind==="finite"||d.kind==="int"||d.kind==="multipleOf")return!0;d.kind==="min"?(a===null||d.value>a)&&(a=d.value):d.kind==="max"&&(n===null||d.value<n)&&(n=d.value)}return Number.isFinite(a)&&Number.isFinite(n)}}gm.create=i=>new gm({checks:[],typeName:vi.ZodNumber,coerce:i?.coerce||!1,...Di(i)});class ym extends qi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(n){if(this._def.coerce)try{n.data=BigInt(n.data)}catch{return this._getInvalidInput(n)}if(this._getType(n)!==_n.bigint)return this._getInvalidInput(n);let d;const y=new Cl;for(const v of this._def.checks)v.kind==="min"?(v.inclusive?n.data<v.value:n.data<=v.value)&&(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.too_small,type:"bigint",minimum:v.value,inclusive:v.inclusive,message:v.message}),y.dirty()):v.kind==="max"?(v.inclusive?n.data>v.value:n.data>=v.value)&&(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.too_big,type:"bigint",maximum:v.value,inclusive:v.inclusive,message:v.message}),y.dirty()):v.kind==="multipleOf"?n.data%v.value!==BigInt(0)&&(d=this._getOrReturnCtx(n,d),cn(d,{code:zr.not_multiple_of,multipleOf:v.value,message:v.message}),y.dirty()):fs.assertNever(v);return{status:y.value,value:n.data}}_getInvalidInput(n){const a=this._getOrReturnCtx(n);return cn(a,{code:zr.invalid_type,expected:_n.bigint,received:a.parsedType}),mi}gte(n,a){return this.setLimit("min",n,!0,zn.toString(a))}gt(n,a){return this.setLimit("min",n,!1,zn.toString(a))}lte(n,a){return this.setLimit("max",n,!0,zn.toString(a))}lt(n,a){return this.setLimit("max",n,!1,zn.toString(a))}setLimit(n,a,d,y){return new ym({...this._def,checks:[...this._def.checks,{kind:n,value:a,inclusive:d,message:zn.toString(y)}]})}_addCheck(n){return new ym({...this._def,checks:[...this._def.checks,n]})}positive(n){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:zn.toString(n)})}negative(n){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:zn.toString(n)})}nonpositive(n){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:zn.toString(n)})}nonnegative(n){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:zn.toString(n)})}multipleOf(n,a){return this._addCheck({kind:"multipleOf",value:n,message:zn.toString(a)})}get minValue(){let n=null;for(const a of this._def.checks)a.kind==="min"&&(n===null||a.value>n)&&(n=a.value);return n}get maxValue(){let n=null;for(const a of this._def.checks)a.kind==="max"&&(n===null||a.value<n)&&(n=a.value);return n}}ym.create=i=>new ym({checks:[],typeName:vi.ZodBigInt,coerce:i?.coerce??!1,...Di(i)});class ev extends qi{_parse(n){if(this._def.coerce&&(n.data=!!n.data),this._getType(n)!==_n.boolean){const d=this._getOrReturnCtx(n);return cn(d,{code:zr.invalid_type,expected:_n.boolean,received:d.parsedType}),mi}return Kl(n.data)}}ev.create=i=>new ev({typeName:vi.ZodBoolean,coerce:i?.coerce||!1,...Di(i)});class Pg extends qi{_parse(n){if(this._def.coerce&&(n.data=new Date(n.data)),this._getType(n)!==_n.date){const v=this._getOrReturnCtx(n);return cn(v,{code:zr.invalid_type,expected:_n.date,received:v.parsedType}),mi}if(Number.isNaN(n.data.getTime())){const v=this._getOrReturnCtx(n);return cn(v,{code:zr.invalid_date}),mi}const d=new Cl;let y;for(const v of this._def.checks)v.kind==="min"?n.data.getTime()<v.value&&(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.too_small,message:v.message,inclusive:!0,exact:!1,minimum:v.value,type:"date"}),d.dirty()):v.kind==="max"?n.data.getTime()>v.value&&(y=this._getOrReturnCtx(n,y),cn(y,{code:zr.too_big,message:v.message,inclusive:!0,exact:!1,maximum:v.value,type:"date"}),d.dirty()):fs.assertNever(v);return{status:d.value,value:new Date(n.data.getTime())}}_addCheck(n){return new Pg({...this._def,checks:[...this._def.checks,n]})}min(n,a){return this._addCheck({kind:"min",value:n.getTime(),message:zn.toString(a)})}max(n,a){return this._addCheck({kind:"max",value:n.getTime(),message:zn.toString(a)})}get minDate(){let n=null;for(const a of this._def.checks)a.kind==="min"&&(n===null||a.value>n)&&(n=a.value);return n!=null?new Date(n):null}get maxDate(){let n=null;for(const a of this._def.checks)a.kind==="max"&&(n===null||a.value<n)&&(n=a.value);return n!=null?new Date(n):null}}Pg.create=i=>new Pg({checks:[],coerce:i?.coerce||!1,typeName:vi.ZodDate,...Di(i)});class F0 extends qi{_parse(n){if(this._getType(n)!==_n.symbol){const d=this._getOrReturnCtx(n);return cn(d,{code:zr.invalid_type,expected:_n.symbol,received:d.parsedType}),mi}return Kl(n.data)}}F0.create=i=>new F0({typeName:vi.ZodSymbol,...Di(i)});class tv extends qi{_parse(n){if(this._getType(n)!==_n.undefined){const d=this._getOrReturnCtx(n);return cn(d,{code:zr.invalid_type,expected:_n.undefined,received:d.parsedType}),mi}return Kl(n.data)}}tv.create=i=>new tv({typeName:vi.ZodUndefined,...Di(i)});class rv extends qi{_parse(n){if(this._getType(n)!==_n.null){const d=this._getOrReturnCtx(n);return cn(d,{code:zr.invalid_type,expected:_n.null,received:d.parsedType}),mi}return Kl(n.data)}}rv.create=i=>new rv({typeName:vi.ZodNull,...Di(i)});class u_ extends qi{constructor(){super(...arguments),this._any=!0}_parse(n){return Kl(n.data)}}u_.create=i=>new u_({typeName:vi.ZodAny,...Di(i)});class Cg extends qi{constructor(){super(...arguments),this._unknown=!0}_parse(n){return Kl(n.data)}}Cg.create=i=>new Cg({typeName:vi.ZodUnknown,...Di(i)});class np extends qi{_parse(n){const a=this._getOrReturnCtx(n);return cn(a,{code:zr.invalid_type,expected:_n.never,received:a.parsedType}),mi}}np.create=i=>new np({typeName:vi.ZodNever,...Di(i)});class B0 extends qi{_parse(n){if(this._getType(n)!==_n.undefined){const d=this._getOrReturnCtx(n);return cn(d,{code:zr.invalid_type,expected:_n.void,received:d.parsedType}),mi}return Kl(n.data)}}B0.create=i=>new B0({typeName:vi.ZodVoid,...Di(i)});class Cd extends qi{_parse(n){const{ctx:a,status:d}=this._processInputParams(n),y=this._def;if(a.parsedType!==_n.array)return cn(a,{code:zr.invalid_type,expected:_n.array,received:a.parsedType}),mi;if(y.exactLength!==null){const C=a.data.length>y.exactLength.value,s=a.data.length<y.exactLength.value;(C||s)&&(cn(a,{code:C?zr.too_big:zr.too_small,minimum:s?y.exactLength.value:void 0,maximum:C?y.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:y.exactLength.message}),d.dirty())}if(y.minLength!==null&&a.data.length<y.minLength.value&&(cn(a,{code:zr.too_small,minimum:y.minLength.value,type:"array",inclusive:!0,exact:!1,message:y.minLength.message}),d.dirty()),y.maxLength!==null&&a.data.length>y.maxLength.value&&(cn(a,{code:zr.too_big,maximum:y.maxLength.value,type:"array",inclusive:!0,exact:!1,message:y.maxLength.message}),d.dirty()),a.common.async)return Promise.all([...a.data].map((C,s)=>y.type._parseAsync(new Dh(a,C,a.path,s)))).then(C=>Cl.mergeArray(d,C));const v=[...a.data].map((C,s)=>y.type._parseSync(new Dh(a,C,a.path,s)));return Cl.mergeArray(d,v)}get element(){return this._def.type}min(n,a){return new Cd({...this._def,minLength:{value:n,message:zn.toString(a)}})}max(n,a){return new Cd({...this._def,maxLength:{value:n,message:zn.toString(a)}})}length(n,a){return new Cd({...this._def,exactLength:{value:n,message:zn.toString(a)}})}nonempty(n){return this.min(1,n)}}Cd.create=(i,n)=>new Cd({type:i,minLength:null,maxLength:null,exactLength:null,typeName:vi.ZodArray,...Di(n)});function Oy(i){if(i instanceof Po){const n={};for(const a in i.shape){const d=i.shape[a];n[a]=Mh.create(Oy(d))}return new Po({...i._def,shape:()=>n})}else return i instanceof Cd?new Cd({...i._def,type:Oy(i.element)}):i instanceof Mh?Mh.create(Oy(i.unwrap())):i instanceof xm?xm.create(Oy(i.unwrap())):i instanceof Oh?Oh.create(i.items.map(n=>Oy(n))):i}class Po extends qi{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const n=this._def.shape(),a=fs.objectKeys(n);return this._cached={shape:n,keys:a},this._cached}_parse(n){if(this._getType(n)!==_n.object){const L=this._getOrReturnCtx(n);return cn(L,{code:zr.invalid_type,expected:_n.object,received:L.parsedType}),mi}const{status:d,ctx:y}=this._processInputParams(n),{shape:v,keys:C}=this._getCached(),s=[];if(!(this._def.catchall instanceof np&&this._def.unknownKeys==="strip"))for(const L in y.data)C.includes(L)||s.push(L);const M=[];for(const L of C){const F=v[L],W=y.data[L];M.push({key:{status:"valid",value:L},value:F._parse(new Dh(y,W,y.path,L)),alwaysSet:L in y.data})}if(this._def.catchall instanceof np){const L=this._def.unknownKeys;if(L==="passthrough")for(const F of s)M.push({key:{status:"valid",value:F},value:{status:"valid",value:y.data[F]}});else if(L==="strict")s.length>0&&(cn(y,{code:zr.unrecognized_keys,keys:s}),d.dirty());else if(L!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const L=this._def.catchall;for(const F of s){const W=y.data[F];M.push({key:{status:"valid",value:F},value:L._parse(new Dh(y,W,y.path,F)),alwaysSet:F in y.data})}}return y.common.async?Promise.resolve().then(async()=>{const L=[];for(const F of M){const W=await F.key,X=await F.value;L.push({key:W,value:X,alwaysSet:F.alwaysSet})}return L}).then(L=>Cl.mergeObjectSync(d,L)):Cl.mergeObjectSync(d,M)}get shape(){return this._def.shape()}strict(n){return zn.errToObj,new Po({...this._def,unknownKeys:"strict",...n!==void 0?{errorMap:(a,d)=>{const y=this._def.errorMap?.(a,d).message??d.defaultError;return a.code==="unrecognized_keys"?{message:zn.errToObj(n).message??y}:{message:y}}}:{}})}strip(){return new Po({...this._def,unknownKeys:"strip"})}passthrough(){return new Po({...this._def,unknownKeys:"passthrough"})}extend(n){return new Po({...this._def,shape:()=>({...this._def.shape(),...n})})}merge(n){return new Po({unknownKeys:n._def.unknownKeys,catchall:n._def.catchall,shape:()=>({...this._def.shape(),...n._def.shape()}),typeName:vi.ZodObject})}setKey(n,a){return this.augment({[n]:a})}catchall(n){return new Po({...this._def,catchall:n})}pick(n){const a={};for(const d of fs.objectKeys(n))n[d]&&this.shape[d]&&(a[d]=this.shape[d]);return new Po({...this._def,shape:()=>a})}omit(n){const a={};for(const d of fs.objectKeys(this.shape))n[d]||(a[d]=this.shape[d]);return new Po({...this._def,shape:()=>a})}deepPartial(){return Oy(this)}partial(n){const a={};for(const d of fs.objectKeys(this.shape)){const y=this.shape[d];n&&!n[d]?a[d]=y:a[d]=y.optional()}return new Po({...this._def,shape:()=>a})}required(n){const a={};for(const d of fs.objectKeys(this.shape))if(n&&!n[d])a[d]=this.shape[d];else{let v=this.shape[d];for(;v instanceof Mh;)v=v._def.innerType;a[d]=v}return new Po({...this._def,shape:()=>a})}keyof(){return h3(fs.objectKeys(this.shape))}}Po.create=(i,n)=>new Po({shape:()=>i,unknownKeys:"strip",catchall:np.create(),typeName:vi.ZodObject,...Di(n)});Po.strictCreate=(i,n)=>new Po({shape:()=>i,unknownKeys:"strict",catchall:np.create(),typeName:vi.ZodObject,...Di(n)});Po.lazycreate=(i,n)=>new Po({shape:i,unknownKeys:"strip",catchall:np.create(),typeName:vi.ZodObject,...Di(n)});class nv extends qi{_parse(n){const{ctx:a}=this._processInputParams(n),d=this._def.options;function y(v){for(const s of v)if(s.result.status==="valid")return s.result;for(const s of v)if(s.result.status==="dirty")return a.common.issues.push(...s.ctx.common.issues),s.result;const C=v.map(s=>new Kc(s.ctx.common.issues));return cn(a,{code:zr.invalid_union,unionErrors:C}),mi}if(a.common.async)return Promise.all(d.map(async v=>{const C={...a,common:{...a.common,issues:[]},parent:null};return{result:await v._parseAsync({data:a.data,path:a.path,parent:C}),ctx:C}})).then(y);{let v;const C=[];for(const M of d){const L={...a,common:{...a.common,issues:[]},parent:null},F=M._parseSync({data:a.data,path:a.path,parent:L});if(F.status==="valid")return F;F.status==="dirty"&&!v&&(v={result:F,ctx:L}),L.common.issues.length&&C.push(L.common.issues)}if(v)return a.common.issues.push(...v.ctx.common.issues),v.result;const s=C.map(M=>new Kc(M));return cn(a,{code:zr.invalid_union,unionErrors:s}),mi}}get options(){return this._def.options}}nv.create=(i,n)=>new nv({options:i,typeName:vi.ZodUnion,...Di(n)});const Xf=i=>i instanceof ov?Xf(i.schema):i instanceof Id?Xf(i.innerType()):i instanceof av?[i.value]:i instanceof _m?i.options:i instanceof lv?fs.objectValues(i.enum):i instanceof cv?Xf(i._def.innerType):i instanceof tv?[void 0]:i instanceof rv?[null]:i instanceof Mh?[void 0,...Xf(i.unwrap())]:i instanceof xm?[null,...Xf(i.unwrap())]:i instanceof RE||i instanceof dv?Xf(i.unwrap()):i instanceof uv?Xf(i._def.innerType):[];class bw extends qi{_parse(n){const{ctx:a}=this._processInputParams(n);if(a.parsedType!==_n.object)return cn(a,{code:zr.invalid_type,expected:_n.object,received:a.parsedType}),mi;const d=this.discriminator,y=a.data[d],v=this.optionsMap.get(y);return v?a.common.async?v._parseAsync({data:a.data,path:a.path,parent:a}):v._parseSync({data:a.data,path:a.path,parent:a}):(cn(a,{code:zr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[d]}),mi)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(n,a,d){const y=new Map;for(const v of a){const C=Xf(v.shape[n]);if(!C.length)throw new Error(`A discriminator value for key \`${n}\` could not be extracted from all schema options`);for(const s of C){if(y.has(s))throw new Error(`Discriminator property ${String(n)} has duplicate value ${String(s)}`);y.set(s,v)}}return new bw({typeName:vi.ZodDiscriminatedUnion,discriminator:n,options:a,optionsMap:y,...Di(d)})}}function c2(i,n){const a=Yf(i),d=Yf(n);if(i===n)return{valid:!0,data:i};if(a===_n.object&&d===_n.object){const y=fs.objectKeys(n),v=fs.objectKeys(i).filter(s=>y.indexOf(s)!==-1),C={...i,...n};for(const s of v){const M=c2(i[s],n[s]);if(!M.valid)return{valid:!1};C[s]=M.data}return{valid:!0,data:C}}else if(a===_n.array&&d===_n.array){if(i.length!==n.length)return{valid:!1};const y=[];for(let v=0;v<i.length;v++){const C=i[v],s=n[v],M=c2(C,s);if(!M.valid)return{valid:!1};y.push(M.data)}return{valid:!0,data:y}}else return a===_n.date&&d===_n.date&&+i==+n?{valid:!0,data:i}:{valid:!1}}class iv extends qi{_parse(n){const{status:a,ctx:d}=this._processInputParams(n),y=(v,C)=>{if(a2(v)||a2(C))return mi;const s=c2(v.value,C.value);return s.valid?((l2(v)||l2(C))&&a.dirty(),{status:a.value,value:s.data}):(cn(d,{code:zr.invalid_intersection_types}),mi)};return d.common.async?Promise.all([this._def.left._parseAsync({data:d.data,path:d.path,parent:d}),this._def.right._parseAsync({data:d.data,path:d.path,parent:d})]).then(([v,C])=>y(v,C)):y(this._def.left._parseSync({data:d.data,path:d.path,parent:d}),this._def.right._parseSync({data:d.data,path:d.path,parent:d}))}}iv.create=(i,n,a)=>new iv({left:i,right:n,typeName:vi.ZodIntersection,...Di(a)});class Oh extends qi{_parse(n){const{status:a,ctx:d}=this._processInputParams(n);if(d.parsedType!==_n.array)return cn(d,{code:zr.invalid_type,expected:_n.array,received:d.parsedType}),mi;if(d.data.length<this._def.items.length)return cn(d,{code:zr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),mi;!this._def.rest&&d.data.length>this._def.items.length&&(cn(d,{code:zr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const v=[...d.data].map((C,s)=>{const M=this._def.items[s]||this._def.rest;return M?M._parse(new Dh(d,C,d.path,s)):null}).filter(C=>!!C);return d.common.async?Promise.all(v).then(C=>Cl.mergeArray(a,C)):Cl.mergeArray(a,v)}get items(){return this._def.items}rest(n){return new Oh({...this._def,rest:n})}}Oh.create=(i,n)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Oh({items:i,typeName:vi.ZodTuple,rest:null,...Di(n)})};class sv extends qi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(n){const{status:a,ctx:d}=this._processInputParams(n);if(d.parsedType!==_n.object)return cn(d,{code:zr.invalid_type,expected:_n.object,received:d.parsedType}),mi;const y=[],v=this._def.keyType,C=this._def.valueType;for(const s in d.data)y.push({key:v._parse(new Dh(d,s,d.path,s)),value:C._parse(new Dh(d,d.data[s],d.path,s)),alwaysSet:s in d.data});return d.common.async?Cl.mergeObjectAsync(a,y):Cl.mergeObjectSync(a,y)}get element(){return this._def.valueType}static create(n,a,d){return a instanceof qi?new sv({keyType:n,valueType:a,typeName:vi.ZodRecord,...Di(d)}):new sv({keyType:Ed.create(),valueType:n,typeName:vi.ZodRecord,...Di(a)})}}class V0 extends qi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(n){const{status:a,ctx:d}=this._processInputParams(n);if(d.parsedType!==_n.map)return cn(d,{code:zr.invalid_type,expected:_n.map,received:d.parsedType}),mi;const y=this._def.keyType,v=this._def.valueType,C=[...d.data.entries()].map(([s,M],L)=>({key:y._parse(new Dh(d,s,d.path,[L,"key"])),value:v._parse(new Dh(d,M,d.path,[L,"value"]))}));if(d.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const M of C){const L=await M.key,F=await M.value;if(L.status==="aborted"||F.status==="aborted")return mi;(L.status==="dirty"||F.status==="dirty")&&a.dirty(),s.set(L.value,F.value)}return{status:a.value,value:s}})}else{const s=new Map;for(const M of C){const L=M.key,F=M.value;if(L.status==="aborted"||F.status==="aborted")return mi;(L.status==="dirty"||F.status==="dirty")&&a.dirty(),s.set(L.value,F.value)}return{status:a.value,value:s}}}}V0.create=(i,n,a)=>new V0({valueType:n,keyType:i,typeName:vi.ZodMap,...Di(a)});class kg extends qi{_parse(n){const{status:a,ctx:d}=this._processInputParams(n);if(d.parsedType!==_n.set)return cn(d,{code:zr.invalid_type,expected:_n.set,received:d.parsedType}),mi;const y=this._def;y.minSize!==null&&d.data.size<y.minSize.value&&(cn(d,{code:zr.too_small,minimum:y.minSize.value,type:"set",inclusive:!0,exact:!1,message:y.minSize.message}),a.dirty()),y.maxSize!==null&&d.data.size>y.maxSize.value&&(cn(d,{code:zr.too_big,maximum:y.maxSize.value,type:"set",inclusive:!0,exact:!1,message:y.maxSize.message}),a.dirty());const v=this._def.valueType;function C(M){const L=new Set;for(const F of M){if(F.status==="aborted")return mi;F.status==="dirty"&&a.dirty(),L.add(F.value)}return{status:a.value,value:L}}const s=[...d.data.values()].map((M,L)=>v._parse(new Dh(d,M,d.path,L)));return d.common.async?Promise.all(s).then(M=>C(M)):C(s)}min(n,a){return new kg({...this._def,minSize:{value:n,message:zn.toString(a)}})}max(n,a){return new kg({...this._def,maxSize:{value:n,message:zn.toString(a)}})}size(n,a){return this.min(n,a).max(n,a)}nonempty(n){return this.min(1,n)}}kg.create=(i,n)=>new kg({valueType:i,minSize:null,maxSize:null,typeName:vi.ZodSet,...Di(n)});class Ky extends qi{constructor(){super(...arguments),this.validate=this.implement}_parse(n){const{ctx:a}=this._processInputParams(n);if(a.parsedType!==_n.function)return cn(a,{code:zr.invalid_type,expected:_n.function,received:a.parsedType}),mi;function d(s,M){return z0({data:s,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,O0(),c_].filter(L=>!!L),issueData:{code:zr.invalid_arguments,argumentsError:M}})}function y(s,M){return z0({data:s,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,O0(),c_].filter(L=>!!L),issueData:{code:zr.invalid_return_type,returnTypeError:M}})}const v={errorMap:a.common.contextualErrorMap},C=a.data;if(this._def.returns instanceof d_){const s=this;return Kl(async function(...M){const L=new Kc([]),F=await s._def.args.parseAsync(M,v).catch(ee=>{throw L.addIssue(d(M,ee)),L}),W=await Reflect.apply(C,this,F);return await s._def.returns._def.type.parseAsync(W,v).catch(ee=>{throw L.addIssue(y(W,ee)),L})})}else{const s=this;return Kl(function(...M){const L=s._def.args.safeParse(M,v);if(!L.success)throw new Kc([d(M,L.error)]);const F=Reflect.apply(C,this,L.data),W=s._def.returns.safeParse(F,v);if(!W.success)throw new Kc([y(F,W.error)]);return W.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...n){return new Ky({...this._def,args:Oh.create(n).rest(Cg.create())})}returns(n){return new Ky({...this._def,returns:n})}implement(n){return this.parse(n)}strictImplement(n){return this.parse(n)}static create(n,a,d){return new Ky({args:n||Oh.create([]).rest(Cg.create()),returns:a||Cg.create(),typeName:vi.ZodFunction,...Di(d)})}}class ov extends qi{get schema(){return this._def.getter()}_parse(n){const{ctx:a}=this._processInputParams(n);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}}ov.create=(i,n)=>new ov({getter:i,typeName:vi.ZodLazy,...Di(n)});class av extends qi{_parse(n){if(n.data!==this._def.value){const a=this._getOrReturnCtx(n);return cn(a,{received:a.data,code:zr.invalid_literal,expected:this._def.value}),mi}return{status:"valid",value:n.data}}get value(){return this._def.value}}av.create=(i,n)=>new av({value:i,typeName:vi.ZodLiteral,...Di(n)});function h3(i,n){return new _m({values:i,typeName:vi.ZodEnum,...Di(n)})}class _m extends qi{_parse(n){if(typeof n.data!="string"){const a=this._getOrReturnCtx(n),d=this._def.values;return cn(a,{expected:fs.joinValues(d),received:a.parsedType,code:zr.invalid_type}),mi}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(n.data)){const a=this._getOrReturnCtx(n),d=this._def.values;return cn(a,{received:a.data,code:zr.invalid_enum_value,options:d}),mi}return Kl(n.data)}get options(){return this._def.values}get enum(){const n={};for(const a of this._def.values)n[a]=a;return n}get Values(){const n={};for(const a of this._def.values)n[a]=a;return n}get Enum(){const n={};for(const a of this._def.values)n[a]=a;return n}extract(n,a=this._def){return _m.create(n,{...this._def,...a})}exclude(n,a=this._def){return _m.create(this.options.filter(d=>!n.includes(d)),{...this._def,...a})}}_m.create=h3;class lv extends qi{_parse(n){const a=fs.getValidEnumValues(this._def.values),d=this._getOrReturnCtx(n);if(d.parsedType!==_n.string&&d.parsedType!==_n.number){const y=fs.objectValues(a);return cn(d,{expected:fs.joinValues(y),received:d.parsedType,code:zr.invalid_type}),mi}if(this._cache||(this._cache=new Set(fs.getValidEnumValues(this._def.values))),!this._cache.has(n.data)){const y=fs.objectValues(a);return cn(d,{received:d.data,code:zr.invalid_enum_value,options:y}),mi}return Kl(n.data)}get enum(){return this._def.values}}lv.create=(i,n)=>new lv({values:i,typeName:vi.ZodNativeEnum,...Di(n)});class d_ extends qi{unwrap(){return this._def.type}_parse(n){const{ctx:a}=this._processInputParams(n);if(a.parsedType!==_n.promise&&a.common.async===!1)return cn(a,{code:zr.invalid_type,expected:_n.promise,received:a.parsedType}),mi;const d=a.parsedType===_n.promise?a.data:Promise.resolve(a.data);return Kl(d.then(y=>this._def.type.parseAsync(y,{path:a.path,errorMap:a.common.contextualErrorMap})))}}d_.create=(i,n)=>new d_({type:i,typeName:vi.ZodPromise,...Di(n)});class Id extends qi{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===vi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(n){const{status:a,ctx:d}=this._processInputParams(n),y=this._def.effect||null,v={addIssue:C=>{cn(d,C),C.fatal?a.abort():a.dirty()},get path(){return d.path}};if(v.addIssue=v.addIssue.bind(v),y.type==="preprocess"){const C=y.transform(d.data,v);if(d.common.async)return Promise.resolve(C).then(async s=>{if(a.value==="aborted")return mi;const M=await this._def.schema._parseAsync({data:s,path:d.path,parent:d});return M.status==="aborted"?mi:M.status==="dirty"||a.value==="dirty"?$y(M.value):M});{if(a.value==="aborted")return mi;const s=this._def.schema._parseSync({data:C,path:d.path,parent:d});return s.status==="aborted"?mi:s.status==="dirty"||a.value==="dirty"?$y(s.value):s}}if(y.type==="refinement"){const C=s=>{const M=y.refinement(s,v);if(d.common.async)return Promise.resolve(M);if(M instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(d.common.async===!1){const s=this._def.schema._parseSync({data:d.data,path:d.path,parent:d});return s.status==="aborted"?mi:(s.status==="dirty"&&a.dirty(),C(s.value),{status:a.value,value:s.value})}else return this._def.schema._parseAsync({data:d.data,path:d.path,parent:d}).then(s=>s.status==="aborted"?mi:(s.status==="dirty"&&a.dirty(),C(s.value).then(()=>({status:a.value,value:s.value}))))}if(y.type==="transform")if(d.common.async===!1){const C=this._def.schema._parseSync({data:d.data,path:d.path,parent:d});if(!Ig(C))return mi;const s=y.transform(C.value,v);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:s}}else return this._def.schema._parseAsync({data:d.data,path:d.path,parent:d}).then(C=>Ig(C)?Promise.resolve(y.transform(C.value,v)).then(s=>({status:a.value,value:s})):mi);fs.assertNever(y)}}Id.create=(i,n,a)=>new Id({schema:i,typeName:vi.ZodEffects,effect:n,...Di(a)});Id.createWithPreprocess=(i,n,a)=>new Id({schema:n,effect:{type:"preprocess",transform:i},typeName:vi.ZodEffects,...Di(a)});class Mh extends qi{_parse(n){return this._getType(n)===_n.undefined?Kl(void 0):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}}Mh.create=(i,n)=>new Mh({innerType:i,typeName:vi.ZodOptional,...Di(n)});class xm extends qi{_parse(n){return this._getType(n)===_n.null?Kl(null):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}}xm.create=(i,n)=>new xm({innerType:i,typeName:vi.ZodNullable,...Di(n)});class cv extends qi{_parse(n){const{ctx:a}=this._processInputParams(n);let d=a.data;return a.parsedType===_n.undefined&&(d=this._def.defaultValue()),this._def.innerType._parse({data:d,path:a.path,parent:a})}removeDefault(){return this._def.innerType}}cv.create=(i,n)=>new cv({innerType:i,typeName:vi.ZodDefault,defaultValue:typeof n.default=="function"?n.default:()=>n.default,...Di(n)});class uv extends qi{_parse(n){const{ctx:a}=this._processInputParams(n),d={...a,common:{...a.common,issues:[]}},y=this._def.innerType._parse({data:d.data,path:d.path,parent:{...d}});return Jx(y)?y.then(v=>({status:"valid",value:v.status==="valid"?v.value:this._def.catchValue({get error(){return new Kc(d.common.issues)},input:d.data})})):{status:"valid",value:y.status==="valid"?y.value:this._def.catchValue({get error(){return new Kc(d.common.issues)},input:d.data})}}removeCatch(){return this._def.innerType}}uv.create=(i,n)=>new uv({innerType:i,typeName:vi.ZodCatch,catchValue:typeof n.catch=="function"?n.catch:()=>n.catch,...Di(n)});class U0 extends qi{_parse(n){if(this._getType(n)!==_n.nan){const d=this._getOrReturnCtx(n);return cn(d,{code:zr.invalid_type,expected:_n.nan,received:d.parsedType}),mi}return{status:"valid",value:n.data}}}U0.create=i=>new U0({typeName:vi.ZodNaN,...Di(i)});const HY=Symbol("zod_brand");class RE extends qi{_parse(n){const{ctx:a}=this._processInputParams(n),d=a.data;return this._def.type._parse({data:d,path:a.path,parent:a})}unwrap(){return this._def.type}}class Pv extends qi{_parse(n){const{status:a,ctx:d}=this._processInputParams(n);if(d.common.async)return(async()=>{const v=await this._def.in._parseAsync({data:d.data,path:d.path,parent:d});return v.status==="aborted"?mi:v.status==="dirty"?(a.dirty(),$y(v.value)):this._def.out._parseAsync({data:v.value,path:d.path,parent:d})})();{const y=this._def.in._parseSync({data:d.data,path:d.path,parent:d});return y.status==="aborted"?mi:y.status==="dirty"?(a.dirty(),{status:"dirty",value:y.value}):this._def.out._parseSync({data:y.value,path:d.path,parent:d})}}static create(n,a){return new Pv({in:n,out:a,typeName:vi.ZodPipeline})}}class dv extends qi{_parse(n){const a=this._def.innerType._parse(n),d=y=>(Ig(y)&&(y.value=Object.freeze(y.value)),y);return Jx(a)?a.then(y=>d(y)):d(a)}unwrap(){return this._def.innerType}}dv.create=(i,n)=>new dv({innerType:i,typeName:vi.ZodReadonly,...Di(n)});function hR(i,n){const a=typeof i=="function"?i(n):typeof i=="string"?{message:i}:i;return typeof a=="string"?{message:a}:a}function ME(i,n={},a){return i?u_.create().superRefine((d,y)=>{const v=i(d);if(v instanceof Promise)return v.then(C=>{if(!C){const s=hR(n,d),M=s.fatal??a??!0;y.addIssue({code:"custom",...s,fatal:M})}});if(!v){const C=hR(n,d),s=C.fatal??a??!0;y.addIssue({code:"custom",...C,fatal:s})}}):u_.create()}const ZY={object:Po.lazycreate};var vi;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(vi||(vi={}));const XY=(i,n={message:`Input not instance of ${i.name}`})=>ME(a=>a instanceof i,n),Wi=Ed.create,kv=gm.create,KY=U0.create,YY=ym.create,dm=ev.create,QY=Pg.create,JY=F0.create,eQ=tv.create,f3=rv.create,$0=u_.create,tQ=Cg.create,rQ=np.create,nQ=B0.create,Zl=Cd.create,x_=Po.create,iQ=Po.strictCreate,LE=nv.create,sQ=bw.create,oQ=iv.create,aQ=Oh.create,p3=sv.create,lQ=V0.create,cQ=kg.create,uQ=Ky.create,dQ=ov.create,hQ=av.create,h0=_m.create,fQ=lv.create,pQ=d_.create,fR=Id.create,mQ=Mh.create,gQ=xm.create,qy=Id.createWithPreprocess,yQ=Pv.create,_Q=()=>Wi().optional(),xQ=()=>kv().optional(),vQ=()=>dm().optional(),bQ={string:(i=>Ed.create({...i,coerce:!0})),number:(i=>gm.create({...i,coerce:!0})),boolean:(i=>ev.create({...i,coerce:!0})),bigint:(i=>ym.create({...i,coerce:!0})),date:(i=>Pg.create({...i,coerce:!0}))},wQ=mi,SQ=Object.freeze(Object.defineProperty({__proto__:null,BRAND:HY,DIRTY:$y,EMPTY_PATH:EY,INVALID:mi,NEVER:wQ,OK:Kl,ParseStatus:Cl,Schema:qi,ZodAny:u_,ZodArray:Cd,ZodBigInt:ym,ZodBoolean:ev,ZodBranded:RE,ZodCatch:uv,ZodDate:Pg,ZodDefault:cv,ZodDiscriminatedUnion:bw,ZodEffects:Id,ZodEnum:_m,ZodError:Kc,get ZodFirstPartyTypeKind(){return vi},ZodFunction:Ky,ZodIntersection:iv,ZodIssueCode:zr,ZodLazy:ov,ZodLiteral:av,ZodMap:V0,ZodNaN:U0,ZodNativeEnum:lv,ZodNever:np,ZodNull:rv,ZodNullable:xm,ZodNumber:gm,ZodObject:Po,ZodOptional:Mh,ZodParsedType:_n,ZodPipeline:Pv,ZodPromise:d_,ZodReadonly:dv,ZodRecord:sv,ZodSchema:qi,ZodSet:kg,ZodString:Ed,ZodSymbol:F0,ZodTransformer:Id,ZodTuple:Oh,ZodType:qi,ZodUndefined:tv,ZodUnion:nv,ZodUnknown:Cg,ZodVoid:B0,addIssueToContext:cn,any:$0,array:Zl,bigint:YY,boolean:dm,coerce:bQ,custom:ME,date:QY,datetimeRegex:d3,defaultErrorMap:c_,discriminatedUnion:sQ,effect:fR,enum:h0,function:uQ,getErrorMap:O0,getParsedType:Yf,instanceof:XY,intersection:oQ,isAborted:a2,isAsync:Jx,isDirty:l2,isValid:Ig,late:ZY,lazy:dQ,literal:hQ,makeIssue:z0,map:lQ,nan:KY,nativeEnum:fQ,never:rQ,null:f3,nullable:gQ,number:kv,object:x_,get objectUtil(){return o2},oboolean:vQ,onumber:xQ,optional:mQ,ostring:_Q,pipeline:yQ,preprocess:qy,promise:pQ,quotelessJson:SY,record:p3,set:cQ,setErrorMap:TY,strictObject:iQ,string:Wi,symbol:JY,transformer:fR,tuple:aQ,undefined:eQ,union:LE,unknown:tQ,get util(){return fs},void:nQ},Symbol.toStringTag,{value:"Module"})),Ao={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Jo(i,n){return n.includes(i.columnType)}function TQ(i){return"enumValues"in i&&Array.isArray(i.enumValues)&&i.enumValues.length>0}const EQ=LE([Wi(),kv(),dm(),f3()]),CQ=LE([EQ,p3($0()),Zl($0())]),AQ=ME(i=>i instanceof Buffer);function m3(i,n){const a=n?.zodInstance??SQ,d=n?.coerce??{};let y;return TQ(i)&&(y=i.enumValues.length?a.enum(i.enumValues):a.string()),y||(Jo(i,["PgGeometry","PgPointTuple"])?y=a.tuple([a.number(),a.number()]):Jo(i,["PgGeometryObject","PgPointObject"])?y=a.object({x:a.number(),y:a.number()}):Jo(i,["PgHalfVector","PgVector"])?(y=a.array(a.number()),y=i.dimensions?y.length(i.dimensions):y):Jo(i,["PgLine"])?y=a.tuple([a.number(),a.number(),a.number()]):Jo(i,["PgLineABC"])?y=a.object({a:a.number(),b:a.number(),c:a.number()}):Jo(i,["PgArray"])?(y=a.array(m3(i.baseColumn,a)),y=i.size?y.length(i.size):y):i.dataType==="array"?y=a.array(a.any()):i.dataType==="number"?y=IQ(i,a,d):i.dataType==="bigint"?y=PQ(i,a,d):i.dataType==="boolean"?y=d===!0||d.boolean?a.coerce.boolean():a.boolean():i.dataType==="date"?y=d===!0||d.date?a.coerce.date():a.date():i.dataType==="string"?y=kQ(i,a,d):i.dataType==="json"?y=CQ:i.dataType==="custom"?y=a.any():i.dataType==="buffer"&&(y=AQ)),y||(y=a.any()),y}function IQ(i,n,a){let d=i.getSQLType().includes("unsigned"),y,v,C=!1;Jo(i,["MySqlTinyInt","SingleStoreTinyInt"])?(y=d?0:Ao.INT8_MIN,v=d?Ao.INT8_UNSIGNED_MAX:Ao.INT8_MAX,C=!0):Jo(i,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(y=d?0:Ao.INT16_MIN,v=d?Ao.INT16_UNSIGNED_MAX:Ao.INT16_MAX,C=!0):Jo(i,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(y=d?0:Ao.INT24_MIN,v=d?Ao.INT24_UNSIGNED_MAX:Ao.INT24_MAX,C=Jo(i,["MySqlMediumInt","SingleStoreMediumInt"])):Jo(i,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(y=d?0:Ao.INT32_MIN,v=d?Ao.INT32_UNSIGNED_MAX:Ao.INT32_MAX,C=!0):Jo(i,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(y=d?0:Ao.INT48_MIN,v=d?Ao.INT48_UNSIGNED_MAX:Ao.INT48_MAX):Jo(i,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(d=d||Jo(i,["MySqlSerial","SingleStoreSerial"]),y=d?0:Number.MIN_SAFE_INTEGER,v=Number.MAX_SAFE_INTEGER,C=!0):Jo(i,["MySqlYear","SingleStoreYear"])?(y=1901,v=2155,C=!0):(y=Number.MIN_SAFE_INTEGER,v=Number.MAX_SAFE_INTEGER);let s=a===!0||a?.number?n.coerce.number():n.number();return s=s.min(y).max(v),C?s.int():s}function PQ(i,n,a){const d=i.getSQLType().includes("unsigned"),y=d?0n:Ao.INT64_MIN,v=d?Ao.INT64_UNSIGNED_MAX:Ao.INT64_MAX;return(a===!0||a?.bigint?n.coerce.bigint():n.bigint()).min(y).max(v)}function kQ(i,n,a){if(Jo(i,["PgUUID"]))return n.string().uuid();let d,y,v=!1;Jo(i,["PgVarchar","SQLiteText"])?d=i.length:Jo(i,["MySqlVarChar","SingleStoreVarChar"])?d=i.length??Ao.INT16_UNSIGNED_MAX:Jo(i,["MySqlText","SingleStoreText"])&&(i.textType==="longtext"?d=Ao.INT32_UNSIGNED_MAX:i.textType==="mediumtext"?d=Ao.INT24_UNSIGNED_MAX:i.textType==="text"?d=Ao.INT16_UNSIGNED_MAX:d=Ao.INT8_UNSIGNED_MAX),Jo(i,["PgChar","MySqlChar","SingleStoreChar"])&&(d=i.length,v=!0),Jo(i,["PgBinaryVector"])&&(y=/^[01]+$/,d=i.dimensions);let C=a===!0||a?.string?n.coerce.string():n.string();return C=y?C.regex(y):C,d&&v?C.length(d):d?C.max(d):C}function g3(i){return e3(i)?xX(i):vX(i)}function y3(i,n,a,d){const y={};for(const[v,C]of Object.entries(i)){if(!rl(C,Yx)&&!rl(C,Vo)&&!rl(C,Vo.Aliased)&&typeof C=="object"){const W=e3(C)||_X(C)?g3(C):C;y[v]=y3(W,n[v]??{},a,d);continue}const s=n[v];if(s!==void 0&&typeof s!="function"){y[v]=s;continue}const M=rl(C,Yx)?C:void 0,L=M?m3(M,d):$0(),F=typeof s=="function"?s(L):L;a.never(M)||(y[v]=F,M&&(a.nullable(M)&&(y[v]=y[v].nullable()),a.optional(M)&&(y[v]=y[v].optional())))}return x_(y)}const NQ={never:i=>i?.generated?.type==="always"||i?.generatedIdentity?.type==="always",optional:i=>!i.notNull||i.notNull&&i.hasDefault,nullable:i=>!i.notNull},_3=(i,n)=>{const a=g3(i);return y3(a,{},NQ)},jQ=a3("waitlist",{id:jE("id").primaryKey(),name:Qx("name",{length:100}).notNull(),email:Qx("email",{length:255}).notNull().unique()}),RQ=a3("contact",{id:jE("id").primaryKey(),name:Qx("name",{length:100}).notNull(),email:Qx("email",{length:255}).notNull(),message:o3("message").notNull()}),MQ=_3(jQ).pick({name:!0,email:!0}),LQ=_3(RQ).pick({name:!0,email:!0,message:!0});var DQ="Label",x3=$.forwardRef((i,n)=>h.jsx(ss.label,{...i,ref:n,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(i.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));x3.displayName=DQ;var v3=x3;const OQ=P2("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),b3=$.forwardRef(({className:i,...n},a)=>h.jsx(v3,{ref:a,className:Ki(OQ(),i),...n}));b3.displayName=v3.displayName;const w3=OZ,S3=$.createContext({}),zx=({...i})=>h.jsx(S3.Provider,{value:{name:i.name},children:h.jsx(VZ,{...i})}),ww=()=>{const i=$.useContext(S3),n=$.useContext(T3),{getFieldState:a,formState:d}=xw(),y=a(i.name,d);if(!i)throw new Error("useFormField should be used within <FormField>");const{id:v}=n;return{id:v,name:i.name,formItemId:`${v}-form-item`,formDescriptionId:`${v}-form-item-description`,formMessageId:`${v}-form-item-message`,...y}},T3=$.createContext({}),Yy=$.forwardRef(({className:i,...n},a)=>{const d=$.useId();return h.jsx(T3.Provider,{value:{id:d},children:h.jsx("div",{ref:a,className:Ki("space-y-2",i),...n})})});Yy.displayName="FormItem";const zQ=$.forwardRef(({className:i,...n},a)=>{const{error:d,formItemId:y}=ww();return h.jsx(b3,{ref:a,className:Ki(d&&"text-destructive",i),htmlFor:y,...n})});zQ.displayName="FormLabel";const Qy=$.forwardRef(({...i},n)=>{const{error:a,formItemId:d,formDescriptionId:y,formMessageId:v}=ww();return h.jsx(_M,{ref:n,id:d,"aria-describedby":a?`${y} ${v}`:`${y}`,"aria-invalid":!!a,...i})});Qy.displayName="FormControl";const FQ=$.forwardRef(({className:i,...n},a)=>{const{formDescriptionId:d}=ww();return h.jsx("p",{ref:a,id:d,className:Ki("text-sm text-muted-foreground",i),...n})});FQ.displayName="FormDescription";const Jy=$.forwardRef(({className:i,children:n,...a},d)=>{const{error:y,formMessageId:v}=ww(),C=y?String(y?.message):n;return C?h.jsx("p",{ref:d,id:v,className:Ki("text-sm font-medium text-destructive",i),...a,children:C}):null});Jy.displayName="FormMessage";const hv=$.forwardRef(({className:i,type:n,...a},d)=>h.jsx("input",{type:n,className:Ki("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:d,...a}));hv.displayName="Input";function Sw({embedded:i=!1}){const{toast:n}=xv(),[a,d]=$.useState(!1),y=HO({resolver:XO(MQ),defaultValues:{name:"",email:""}}),v=yM({mutationFn:async M=>{try{console.log("Submitting:",M);const L=await fetch("/.netlify/functions/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:M.email,name:M.name})});if(!L.ok)throw new Error("Failed to add to waitlist");return await L.json()}catch(L){throw console.error("Error:",L),L}},onSuccess:()=>{d(!0),n({title:"Success!",description:"You've been added to the waitlist."})},onError:()=>{n({variant:"destructive",title:"Error",description:"Something went wrong. Please try again."})}}),C=M=>{v.mutate(M)},s=h.jsxs(h.Fragment,{children:[h.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Join the Waitlist"}),h.jsx("p",{className:"text-muted-foreground mb-8",children:"Be the first to know when GLASS-Connect ships new features for listing, verification, and collaboration routing."}),a?h.jsxs("div",{className:"text-center p-6 bg-primary/10 rounded-lg",children:[h.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Thank you for joining!"}),h.jsx("p",{className:"text-muted-foreground",children:"We'll keep you updated on our progress."})]}):h.jsx(w3,{...y,children:h.jsxs("form",{onSubmit:y.handleSubmit(C),className:"space-y-4",children:[h.jsx(zx,{control:y.control,name:"name",render:({field:M})=>h.jsxs(Yy,{children:[h.jsx(Qy,{children:h.jsx(hv,{placeholder:"Your name",...M})}),h.jsx(Jy,{})]})}),h.jsx(zx,{control:y.control,name:"email",render:({field:M})=>h.jsxs(Yy,{children:[h.jsx(Qy,{children:h.jsx(hv,{type:"email",placeholder:"Your email",...M})}),h.jsx(Jy,{})]})}),h.jsx(Hy,{type:"submit",className:"w-full",disabled:v.isPending,children:v.isPending?"Joining...":"Join Now"})]})})]});return i?h.jsx("div",{className:"w-full",children:h.jsx(Jn.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.4},className:"w-full",children:s})}):h.jsx("section",{id:"waitlist-section",className:"py-20 bg-background",children:h.jsx("div",{className:"container mx-auto px-4",children:h.jsx(Jn.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},className:"max-w-lg mx-auto text-center",children:s})})})}const E3=$.forwardRef(({className:i,...n},a)=>h.jsx("textarea",{className:Ki("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:a,...n}));E3.displayName="Textarea";function BQ(){const{toast:i}=xv(),n=HO({resolver:XO(LQ),defaultValues:{name:"",email:"",message:""}}),a=yM({mutationFn:async y=>(await fetch("/.netlify/functions/sendContact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).json(),onSuccess:()=>{n.reset(),i({title:"Message sent!",description:"We'll get back to you as soon as possible."})},onError:()=>{i({variant:"destructive",title:"Error",description:"Failed to send message. Please try again."})}}),d=y=>{a.mutate(y)};return h.jsx("section",{className:"py-20 bg-muted/30",children:h.jsx("div",{className:"container mx-auto px-4",children:h.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-start",children:[h.jsxs(Jn.div,{initial:{opacity:0,x:-20},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{duration:.6},children:[h.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Contact Us"}),h.jsx("p",{className:"text-muted-foreground mb-8",children:"Have questions about GLASS-Connect? We're here to help labs list, verify, and handle inbound requests."}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx(bv,{className:"h-5 w-5 text-primary"}),h.jsx("span",{children:"contact@glass-funding.com"})]})," "]})]}),h.jsx(Jn.div,{initial:{opacity:0,x:20},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{duration:.6},children:h.jsx(w3,{...n,children:h.jsxs("form",{onSubmit:n.handleSubmit(d),className:"space-y-4",children:[h.jsx(zx,{control:n.control,name:"name",render:({field:y})=>h.jsxs(Yy,{children:[h.jsx(Qy,{children:h.jsx(hv,{placeholder:"Your name",...y})}),h.jsx(Jy,{})]})}),h.jsx(zx,{control:n.control,name:"email",render:({field:y})=>h.jsxs(Yy,{children:[h.jsx(Qy,{children:h.jsx(hv,{type:"email",placeholder:"Your email",...y})}),h.jsx(Jy,{})]})}),h.jsx(zx,{control:n.control,name:"message",render:({field:y})=>h.jsxs(Yy,{children:[h.jsx(Qy,{children:h.jsx(E3,{placeholder:"Your message",className:"min-h-[120px]",...y})}),h.jsx(Jy,{})]})}),h.jsx(Hy,{type:"submit",className:"w-full",disabled:a.isPending,children:a.isPending?"Sending...":"Send Message"})]})})})]})})})}const JS=[{src:"/logos/logo-unistra.png",alt:"Unistra",href:"https://www.unistra.fr",className:"scale-125"},{src:"/logos/logo-EMStrasbourg.png",alt:"EM Strasbourg",href:"https://www.em-strasbourg.com/fr",className:"scale-[1.7]"},{src:"/logos/GrandEst.png",alt:"Grand Est",href:"https://www.grandest.fr/en/",className:"scale-[1.9]"},{src:"/logos/logo-etena.png",alt:"Ppite Etna",href:"https://etena.unistra.fr/",className:"scale-[1.2]"},{src:"/logos/logo-LaRucheAProjets.png",alt:"La Ruche a projets",href:"https://www.em-strasbourg.com/fr/etudiant/vie-etudiante-et-services/centre-entrepreneurial-la-ruche/incubateur-la-ruche-a-projets",className:"scale-[1.2]"}];function C3(){const i=$.useRef(null),n=$.useMemo(()=>[...JS,...JS,...JS],[]);$.useEffect(()=>{const d=i.current;if(!d)return;const y=()=>{const C=d.scrollWidth/3;C>0&&(d.scrollLeft=C)},v=()=>{const C=d.scrollWidth/3;C!==0&&(d.scrollLeft<=0?d.scrollLeft+=C:d.scrollLeft>=C*2&&(d.scrollLeft-=C))};return y(),d.addEventListener("scroll",v,{passive:!0}),window.addEventListener("resize",y),()=>{d.removeEventListener("scroll",v),window.removeEventListener("resize",y)}},[]),$.useEffect(()=>{const d=i.current;if(!d)return;let y;const v=()=>{const C=d.scrollWidth/3;C!==0&&(d.scrollLeft+=.4,d.scrollLeft>=C*2&&(d.scrollLeft-=C),y=window.requestAnimationFrame(v))};return y=window.requestAnimationFrame(v),()=>{window.cancelAnimationFrame(y)}},[]);const a=d=>{const y=i.current;if(!y)return;const v=y.scrollWidth/3;if(v===0)return;const C=y.clientWidth*.8;let s=d==="left"?y.scrollLeft-C:y.scrollLeft+C;d==="left"&&s<=0?s+=v:d==="right"&&s>=v*2&&(s-=v),y.scrollTo({left:s,behavior:"smooth"})};return h.jsx("section",{id:"partners",className:"py-20 bg-muted/30",children:h.jsxs("div",{className:"container mx-auto px-4",children:[h.jsx(Jn.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},className:"text-center mb-12",children:h.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Our Partners"})}),h.jsxs(Jn.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6,delay:.1},className:"relative",children:[h.jsx("button",{type:"button",onClick:()=>a("left"),className:"hidden md:flex absolute left-0 top-1/2 -translate-y-1/2 z-10 h-12 w-12 items-center justify-center rounded-full bg-background/80 border border-border text-muted-foreground hover:bg-background transition shadow-sm","aria-label":"Scroll partners left",children:h.jsx(I$,{className:"h-5 w-5"})}),h.jsx("button",{type:"button",onClick:()=>a("right"),className:"hidden md:flex absolute right-0 top-1/2 -translate-y-1/2 z-10 h-12 w-12 items-center justify-center rounded-full bg-background/80 border border-border text-muted-foreground hover:bg-background transition shadow-sm","aria-label":"Scroll partners right",children:h.jsx(GM,{className:"h-5 w-5"})}),h.jsx("div",{ref:i,className:"overflow-x-auto scroll-smooth no-scrollbar",children:h.jsx("div",{className:"flex gap-6 md:gap-8 min-w-max pb-2",children:n.map((d,y)=>h.jsx("a",{href:d.href,target:"_blank",rel:"noopener noreferrer",className:"relative block w-[160px] md:w-[180px] shrink-0",children:h.jsx(Jn.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25,delay:y*.04},children:h.jsx("div",{className:"bg-white border border-border rounded-xl px-6 py-5 h-28 flex items-center justify-center shadow-sm hover:shadow-md transition",children:h.jsx("img",{src:d.src,alt:d.alt,className:`max-h-12 object-contain opacity-80 hover:opacity-100 transition duration-300 ${d.className}`})})})},`${d.alt}-${y}`))})})]})]})})}function VQ({title:i="Latest news",description:n,limit:a=20,className:d=""}){const[y,v]=$.useState([]),[C,s]=$.useState(!0),[M,L]=$.useState(null);return $.useEffect(()=>{let F=!0;async function W(){s(!0),L(null);try{const X=await fetch(`/api/news/public?limit=${a}`),ee=X.headers.get("content-type")||"";if(!X.ok||!ee.includes("application/json"))throw await X.text(),new Error("Unable to load news");const he=await X.json();F&&v(Array.isArray(he?.news)?he.news:[])}catch(X){F&&L(X?.message||"Unable to load news")}finally{F&&s(!1)}}return W(),()=>{F=!1}},[a]),h.jsxs("section",{className:`rounded-3xl border border-border bg-card/80 p-6 shadow-sm ${d}`,children:[h.jsx("div",{className:"mb-4 flex items-center justify-between gap-3",children:h.jsxs("div",{children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"News"}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:i}),n?h.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]})}),C&&h.jsx("div",{className:"rounded-2xl border border-border bg-background/70 px-4 py-3 text-sm text-muted-foreground",children:"Loading news"}),M&&h.jsx("div",{className:"rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:M}),!C&&!M&&h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("div",{className:"flex gap-4 min-w-full",children:[y.length===0&&h.jsx("div",{className:"min-w-[260px] rounded-2xl border border-dashed border-border bg-background/60 px-4 py-4 text-sm text-muted-foreground",children:"No news yet. Check back soon."}),y.map(F=>{const W=F.labs?.name||`Lab ${F.lab_id}`,X=F.created_at?new Date(F.created_at).toLocaleDateString():"";return h.jsxs("div",{className:"min-w-[260px] max-w-[280px] rounded-2xl border border-border bg-background/70 p-4 flex flex-col gap-3",children:[h.jsx("div",{className:"flex items-center text-xs text-muted-foreground",children:h.jsx("span",{className:"rounded-full bg-muted/60 px-2 py-1 text-[11px] capitalize",children:F.category||"update"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground line-clamp-2",children:F.title}),h.jsx("p",{className:"mt-1 text-xs text-muted-foreground line-clamp-3",children:F.summary})]}),h.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[h.jsx("span",{className:"truncate",children:W}),h.jsx("span",{className:"text-[11px]",children:X})]}),h.jsx("div",{className:"flex items-center gap-2",children:F.images?.slice(0,2).map(ee=>h.jsx("img",{src:ee.url,alt:ee.name||"news",className:"h-14 w-14 rounded-lg object-cover border border-border"},ee.url))})]},F.id)})]})})]})}function UQ({title:i="Featured labs",description:n,className:a=""}){const[d,y]=$.useState([]),[v,C]=$.useState(!0),[s,M]=$.useState(null);$.useEffect(()=>{let F=!0;async function W(){C(!0),M(null);try{const X=await fetch("/api/labs"),ee=X.headers.get("content-type")||"";if(!X.ok||!ee.includes("application/json"))throw await X.text(),new Error("Unable to load labs");const he=await X.json();F&&y(Array.isArray(he)?he:[])}catch(X){F&&M(X?.message||"Unable to load labs")}finally{F&&C(!1)}}return W(),()=>{F=!1}},[]);const L=$.useMemo(()=>d.filter(F=>((F.labStatus??F.lab_status??"listed")?.toLowerCase?.()||"listed")==="premier"&&F.isVisible!==!1),[d]);return h.jsxs("section",{className:`rounded-3xl border border-border bg-card/80 p-6 shadow-sm ${a}`,children:[h.jsx("div",{className:"mb-4 flex items-center justify-between gap-3",children:h.jsxs("div",{children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Featured"}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:i}),n?h.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]})}),v&&h.jsx("div",{className:"rounded-2xl border border-border bg-background/70 px-4 py-3 text-sm text-muted-foreground",children:"Loading featured labs"}),s&&h.jsx("div",{className:"rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:s}),!v&&!s&&h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("div",{className:"flex gap-4 min-w-full",children:[L.length===0&&h.jsx("div",{className:"min-w-[260px] rounded-2xl border border-dashed border-border bg-background/60 px-4 py-4 text-sm text-muted-foreground",children:"No featured labs yet. Check back soon."}),L.map(F=>{const W=(F.labStatus??F.lab_status??"listed")?.toLowerCase?.()||"listed",X=F.logoUrl||F.photos?.[0]?.url;return h.jsxs("div",{className:"min-w-[260px] max-w-[280px] rounded-2xl border border-border bg-background/70 p-4 flex flex-col gap-3",children:[h.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[h.jsx("span",{className:"rounded-full bg-primary/10 px-2 py-1 text-[11px] font-medium text-primary capitalize",children:W.replace("_"," ")}),h.jsxs("span",{className:"text-[11px] text-muted-foreground flex items-center gap-1",children:[h.jsx(KM,{className:"h-3 w-3"}),"Featured"]})]}),X&&h.jsx("div",{className:"overflow-hidden rounded-xl border border-border/60 bg-muted/20",children:h.jsx("img",{src:X,alt:F.name,className:"h-32 w-full object-cover",loading:"lazy"})}),h.jsxs("div",{className:"space-y-1",children:[h.jsx("p",{className:"text-sm font-semibold text-foreground line-clamp-2",children:F.name}),h.jsxs("p",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[h.jsx(Ad,{className:"h-3 w-3"}),[F.city,F.country].filter(Boolean).join(", ")||"Location not set"]}),h.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-muted-foreground",children:[h.jsx(xc,{className:"h-3 w-3 text-emerald-600"}),"Premier tier placement"]})]}),h.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:"Premium listing with GLASS support and top placement."}),h.jsx(xn,{href:`/labs/${F.id}`,className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"View lab"})]},F.id)})]})})]})}function $Q(){return h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx(PZ,{}),h.jsx(UQ,{title:"Featured labs",description:"Premier partners highlighted this week"}),h.jsx(MZ,{}),h.jsx(VQ,{title:"Lab news",description:"Latest updates across all labs",limit:30}),h.jsx(Sw,{}),h.jsx(BQ,{}),h.jsx(C3,{})]})}var qQ=x2[" useId ".trim().toString()]||(()=>{}),GQ=0;function hm(i){const[n,a]=$.useState(qQ());return Qc(()=>{a(d=>d??String(GQ++))},[i]),n?`radix-${n}`:""}var eT="focusScope.autoFocusOnMount",tT="focusScope.autoFocusOnUnmount",pR={bubbles:!1,cancelable:!0},WQ="FocusScope",DE=$.forwardRef((i,n)=>{const{loop:a=!1,trapped:d=!1,onMountAutoFocus:y,onUnmountAutoFocus:v,...C}=i,[s,M]=$.useState(null),L=vc(y),F=vc(v),W=$.useRef(null),X=ta(n,se=>M(se)),ee=$.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;$.useEffect(()=>{if(d){let se=function(Se){if(ee.paused||!s)return;const Re=Se.target;s.contains(Re)?W.current=Re:cm(W.current,{select:!0})},oe=function(Se){if(ee.paused||!s)return;const Re=Se.relatedTarget;Re!==null&&(s.contains(Re)||cm(W.current,{select:!0}))},ve=function(Se){if(document.activeElement===document.body)for(const Be of Se)Be.removedNodes.length>0&&cm(s)};document.addEventListener("focusin",se),document.addEventListener("focusout",oe);const me=new MutationObserver(ve);return s&&me.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",se),document.removeEventListener("focusout",oe),me.disconnect()}}},[d,s,ee.paused]),$.useEffect(()=>{if(s){gR.add(ee);const se=document.activeElement;if(!s.contains(se)){const ve=new CustomEvent(eT,pR);s.addEventListener(eT,L),s.dispatchEvent(ve),ve.defaultPrevented||(HQ(QQ(A3(s)),{select:!0}),document.activeElement===se&&cm(s))}return()=>{s.removeEventListener(eT,L),setTimeout(()=>{const ve=new CustomEvent(tT,pR);s.addEventListener(tT,F),s.dispatchEvent(ve),ve.defaultPrevented||cm(se??document.body,{select:!0}),s.removeEventListener(tT,F),gR.remove(ee)},0)}}},[s,L,F,ee]);const he=$.useCallback(se=>{if(!a&&!d||ee.paused)return;const oe=se.key==="Tab"&&!se.altKey&&!se.ctrlKey&&!se.metaKey,ve=document.activeElement;if(oe&&ve){const me=se.currentTarget,[Se,Re]=ZQ(me);Se&&Re?!se.shiftKey&&ve===Re?(se.preventDefault(),a&&cm(Se,{select:!0})):se.shiftKey&&ve===Se&&(se.preventDefault(),a&&cm(Re,{select:!0})):ve===me&&se.preventDefault()}},[a,d,ee.paused]);return h.jsx(ss.div,{tabIndex:-1,...C,ref:X,onKeyDown:he})});DE.displayName=WQ;function HQ(i,{select:n=!1}={}){const a=document.activeElement;for(const d of i)if(cm(d,{select:n}),document.activeElement!==a)return}function ZQ(i){const n=A3(i),a=mR(n,i),d=mR(n.reverse(),i);return[a,d]}function A3(i){const n=[],a=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const y=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||y?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)n.push(a.currentNode);return n}function mR(i,n){for(const a of i)if(!XQ(a,{upTo:n}))return a}function XQ(i,{upTo:n}){if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(n!==void 0&&i===n)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1}function KQ(i){return i instanceof HTMLInputElement&&"select"in i}function cm(i,{select:n=!1}={}){if(i&&i.focus){const a=document.activeElement;i.focus({preventScroll:!0}),i!==a&&KQ(i)&&n&&i.select()}}var gR=YQ();function YQ(){let i=[];return{add(n){const a=i[0];n!==a&&a?.pause(),i=yR(i,n),i.unshift(n)},remove(n){i=yR(i,n),i[0]?.resume()}}}function yR(i,n){const a=[...i],d=a.indexOf(n);return d!==-1&&a.splice(d,1),a}function QQ(i){return i.filter(n=>n.tagName!=="A")}var rT=0;function I3(){$.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??_R()),document.body.insertAdjacentElement("beforeend",i[1]??_R()),rT++,()=>{rT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(n=>n.remove()),rT--}},[])}function _R(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var f0="right-scroll-bar-position",p0="width-before-scroll-bar",JQ="with-scroll-bars-hidden",eJ="--removed-body-scroll-bar-size";function nT(i,n){return typeof i=="function"?i(n):i&&(i.current=n),i}function tJ(i,n){var a=$.useState(function(){return{value:i,callback:n,facade:{get current(){return a.value},set current(d){var y=a.value;y!==d&&(a.value=d,a.callback(d,y))}}}})[0];return a.callback=n,a.facade}var rJ=typeof window<"u"?$.useLayoutEffect:$.useEffect,xR=new WeakMap;function nJ(i,n){var a=tJ(null,function(d){return i.forEach(function(y){return nT(y,d)})});return rJ(function(){var d=xR.get(a);if(d){var y=new Set(d),v=new Set(i),C=a.current;y.forEach(function(s){v.has(s)||nT(s,null)}),v.forEach(function(s){y.has(s)||nT(s,C)})}xR.set(a,i)},[i]),a}function iJ(i){return i}function sJ(i,n){n===void 0&&(n=iJ);var a=[],d=!1,y={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return a.length?a[a.length-1]:i},useMedium:function(v){var C=n(v,d);return a.push(C),function(){a=a.filter(function(s){return s!==C})}},assignSyncMedium:function(v){for(d=!0;a.length;){var C=a;a=[],C.forEach(v)}a={push:function(s){return v(s)},filter:function(){return a}}},assignMedium:function(v){d=!0;var C=[];if(a.length){var s=a;a=[],s.forEach(v),C=a}var M=function(){var F=C;C=[],F.forEach(v)},L=function(){return Promise.resolve().then(M)};L(),a={push:function(F){C.push(F),L()},filter:function(F){return C=C.filter(F),a}}}};return y}function oJ(i){i===void 0&&(i={});var n=sJ(null);return n.options=Ru({async:!0,ssr:!1},i),n}var P3=function(i){var n=i.sideCar,a=Sm(i,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=n.read();if(!d)throw new Error("Sidecar medium not found");return $.createElement(d,Ru({},a))};P3.isSideCarExport=!0;function aJ(i,n){return i.useMedium(n),P3}var k3=oJ(),iT=function(){},Tw=$.forwardRef(function(i,n){var a=$.useRef(null),d=$.useState({onScrollCapture:iT,onWheelCapture:iT,onTouchMoveCapture:iT}),y=d[0],v=d[1],C=i.forwardProps,s=i.children,M=i.className,L=i.removeScrollBar,F=i.enabled,W=i.shards,X=i.sideCar,ee=i.noRelative,he=i.noIsolation,se=i.inert,oe=i.allowPinchZoom,ve=i.as,me=ve===void 0?"div":ve,Se=i.gapMode,Re=Sm(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Be=X,rt=nJ([a,n]),We=Ru(Ru({},Re),y);return $.createElement($.Fragment,null,F&&$.createElement(Be,{sideCar:k3,removeScrollBar:L,shards:W,noRelative:ee,noIsolation:he,inert:se,setCallbacks:v,allowPinchZoom:!!oe,lockRef:a,gapMode:Se}),C?$.cloneElement($.Children.only(s),Ru(Ru({},We),{ref:rt})):$.createElement(me,Ru({},We,{className:M,ref:rt}),s))});Tw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Tw.classNames={fullWidth:p0,zeroRight:f0};var lJ=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function cJ(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var n=lJ();return n&&i.setAttribute("nonce",n),i}function uJ(i,n){i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}function dJ(i){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(i)}var hJ=function(){var i=0,n=null;return{add:function(a){i==0&&(n=cJ())&&(uJ(n,a),dJ(n)),i++},remove:function(){i--,!i&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},fJ=function(){var i=hJ();return function(n,a){$.useEffect(function(){return i.add(n),function(){i.remove()}},[n&&a])}},N3=function(){var i=fJ(),n=function(a){var d=a.styles,y=a.dynamic;return i(d,y),null};return n},pJ={left:0,top:0,right:0,gap:0},sT=function(i){return parseInt(i||"",10)||0},mJ=function(i){var n=window.getComputedStyle(document.body),a=n[i==="padding"?"paddingLeft":"marginLeft"],d=n[i==="padding"?"paddingTop":"marginTop"],y=n[i==="padding"?"paddingRight":"marginRight"];return[sT(a),sT(d),sT(y)]},gJ=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return pJ;var n=mJ(i),a=document.documentElement.clientWidth,d=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,d-a+n[2]-n[0])}},yJ=N3(),e_="data-scroll-locked",_J=function(i,n,a,d){var y=i.left,v=i.top,C=i.right,s=i.gap;return a===void 0&&(a="margin"),`
  .`.concat(JQ,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(s,"px ").concat(d,`;
  }
  body[`).concat(e_,`] {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(d,";"),a==="margin"&&`
    padding-left: `.concat(y,`px;
    padding-top: `).concat(v,`px;
    padding-right: `).concat(C,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(d,`;
    `),a==="padding"&&"padding-right: ".concat(s,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(f0,` {
    right: `).concat(s,"px ").concat(d,`;
  }
  
  .`).concat(p0,` {
    margin-right: `).concat(s,"px ").concat(d,`;
  }
  
  .`).concat(f0," .").concat(f0,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(p0," .").concat(p0,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body[`).concat(e_,`] {
    `).concat(eJ,": ").concat(s,`px;
  }
`)},vR=function(){var i=parseInt(document.body.getAttribute(e_)||"0",10);return isFinite(i)?i:0},xJ=function(){$.useEffect(function(){return document.body.setAttribute(e_,(vR()+1).toString()),function(){var i=vR()-1;i<=0?document.body.removeAttribute(e_):document.body.setAttribute(e_,i.toString())}},[])},vJ=function(i){var n=i.noRelative,a=i.noImportant,d=i.gapMode,y=d===void 0?"margin":d;xJ();var v=$.useMemo(function(){return gJ(y)},[y]);return $.createElement(yJ,{styles:_J(v,!n,y,a?"":"!important")})},u2=!1;if(typeof window<"u")try{var Yb=Object.defineProperty({},"passive",{get:function(){return u2=!0,!0}});window.addEventListener("test",Yb,Yb),window.removeEventListener("test",Yb,Yb)}catch{u2=!1}var ky=u2?{passive:!1}:!1,bJ=function(i){return i.tagName==="TEXTAREA"},j3=function(i,n){if(!(i instanceof Element))return!1;var a=window.getComputedStyle(i);return a[n]!=="hidden"&&!(a.overflowY===a.overflowX&&!bJ(i)&&a[n]==="visible")},wJ=function(i){return j3(i,"overflowY")},SJ=function(i){return j3(i,"overflowX")},bR=function(i,n){var a=n.ownerDocument,d=n;do{typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&(d=d.host);var y=R3(i,d);if(y){var v=M3(i,d),C=v[1],s=v[2];if(C>s)return!0}d=d.parentNode}while(d&&d!==a.body);return!1},TJ=function(i){var n=i.scrollTop,a=i.scrollHeight,d=i.clientHeight;return[n,a,d]},EJ=function(i){var n=i.scrollLeft,a=i.scrollWidth,d=i.clientWidth;return[n,a,d]},R3=function(i,n){return i==="v"?wJ(n):SJ(n)},M3=function(i,n){return i==="v"?TJ(n):EJ(n)},CJ=function(i,n){return i==="h"&&n==="rtl"?-1:1},AJ=function(i,n,a,d,y){var v=CJ(i,window.getComputedStyle(n).direction),C=v*d,s=a.target,M=n.contains(s),L=!1,F=C>0,W=0,X=0;do{if(!s)break;var ee=M3(i,s),he=ee[0],se=ee[1],oe=ee[2],ve=se-oe-v*he;(he||ve)&&R3(i,s)&&(W+=ve,X+=he);var me=s.parentNode;s=me&&me.nodeType===Node.DOCUMENT_FRAGMENT_NODE?me.host:me}while(!M&&s!==document.body||M&&(n.contains(s)||n===s));return(F&&Math.abs(W)<1||!F&&Math.abs(X)<1)&&(L=!0),L},Qb=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},wR=function(i){return[i.deltaX,i.deltaY]},SR=function(i){return i&&"current"in i?i.current:i},IJ=function(i,n){return i[0]===n[0]&&i[1]===n[1]},PJ=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},kJ=0,Ny=[];function NJ(i){var n=$.useRef([]),a=$.useRef([0,0]),d=$.useRef(),y=$.useState(kJ++)[0],v=$.useState(N3)[0],C=$.useRef(i);$.useEffect(function(){C.current=i},[i]),$.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(y));var se=mE([i.lockRef.current],(i.shards||[]).map(SR),!0).filter(Boolean);return se.forEach(function(oe){return oe.classList.add("allow-interactivity-".concat(y))}),function(){document.body.classList.remove("block-interactivity-".concat(y)),se.forEach(function(oe){return oe.classList.remove("allow-interactivity-".concat(y))})}}},[i.inert,i.lockRef.current,i.shards]);var s=$.useCallback(function(se,oe){if("touches"in se&&se.touches.length===2||se.type==="wheel"&&se.ctrlKey)return!C.current.allowPinchZoom;var ve=Qb(se),me=a.current,Se="deltaX"in se?se.deltaX:me[0]-ve[0],Re="deltaY"in se?se.deltaY:me[1]-ve[1],Be,rt=se.target,We=Math.abs(Se)>Math.abs(Re)?"h":"v";if("touches"in se&&We==="h"&&rt.type==="range")return!1;var Ct=bR(We,rt);if(!Ct)return!0;if(Ct?Be=We:(Be=We==="v"?"h":"v",Ct=bR(We,rt)),!Ct)return!1;if(!d.current&&"changedTouches"in se&&(Se||Re)&&(d.current=Be),!Be)return!0;var Ht=d.current||Be;return AJ(Ht,oe,se,Ht==="h"?Se:Re)},[]),M=$.useCallback(function(se){var oe=se;if(!(!Ny.length||Ny[Ny.length-1]!==v)){var ve="deltaY"in oe?wR(oe):Qb(oe),me=n.current.filter(function(Be){return Be.name===oe.type&&(Be.target===oe.target||oe.target===Be.shadowParent)&&IJ(Be.delta,ve)})[0];if(me&&me.should){oe.cancelable&&oe.preventDefault();return}if(!me){var Se=(C.current.shards||[]).map(SR).filter(Boolean).filter(function(Be){return Be.contains(oe.target)}),Re=Se.length>0?s(oe,Se[0]):!C.current.noIsolation;Re&&oe.cancelable&&oe.preventDefault()}}},[]),L=$.useCallback(function(se,oe,ve,me){var Se={name:se,delta:oe,target:ve,should:me,shadowParent:jJ(ve)};n.current.push(Se),setTimeout(function(){n.current=n.current.filter(function(Re){return Re!==Se})},1)},[]),F=$.useCallback(function(se){a.current=Qb(se),d.current=void 0},[]),W=$.useCallback(function(se){L(se.type,wR(se),se.target,s(se,i.lockRef.current))},[]),X=$.useCallback(function(se){L(se.type,Qb(se),se.target,s(se,i.lockRef.current))},[]);$.useEffect(function(){return Ny.push(v),i.setCallbacks({onScrollCapture:W,onWheelCapture:W,onTouchMoveCapture:X}),document.addEventListener("wheel",M,ky),document.addEventListener("touchmove",M,ky),document.addEventListener("touchstart",F,ky),function(){Ny=Ny.filter(function(se){return se!==v}),document.removeEventListener("wheel",M,ky),document.removeEventListener("touchmove",M,ky),document.removeEventListener("touchstart",F,ky)}},[]);var ee=i.removeScrollBar,he=i.inert;return $.createElement($.Fragment,null,he?$.createElement(v,{styles:PJ(y)}):null,ee?$.createElement(vJ,{noRelative:i.noRelative,gapMode:i.gapMode}):null)}function jJ(i){for(var n=null;i!==null;)i instanceof ShadowRoot&&(n=i.host,i=i.host),i=i.parentNode;return n}const RJ=aJ(k3,NJ);var OE=$.forwardRef(function(i,n){return $.createElement(Tw,Ru({},i,{ref:n,sideCar:RJ}))});OE.classNames=Tw.classNames;var MJ=function(i){if(typeof document>"u")return null;var n=Array.isArray(i)?i[0]:i;return n.ownerDocument.body},jy=new WeakMap,Jb=new WeakMap,e0={},oT=0,L3=function(i){return i&&(i.host||L3(i.parentNode))},LJ=function(i,n){return n.map(function(a){if(i.contains(a))return a;var d=L3(a);return d&&i.contains(d)?d:(console.error("aria-hidden",a,"in not contained inside",i,". Doing nothing"),null)}).filter(function(a){return!!a})},DJ=function(i,n,a,d){var y=LJ(n,Array.isArray(i)?i:[i]);e0[a]||(e0[a]=new WeakMap);var v=e0[a],C=[],s=new Set,M=new Set(y),L=function(W){!W||s.has(W)||(s.add(W),L(W.parentNode))};y.forEach(L);var F=function(W){!W||M.has(W)||Array.prototype.forEach.call(W.children,function(X){if(s.has(X))F(X);else try{var ee=X.getAttribute(d),he=ee!==null&&ee!=="false",se=(jy.get(X)||0)+1,oe=(v.get(X)||0)+1;jy.set(X,se),v.set(X,oe),C.push(X),se===1&&he&&Jb.set(X,!0),oe===1&&X.setAttribute(a,"true"),he||X.setAttribute(d,"true")}catch(ve){console.error("aria-hidden: cannot operate on ",X,ve)}})};return F(n),s.clear(),oT++,function(){C.forEach(function(W){var X=jy.get(W)-1,ee=v.get(W)-1;jy.set(W,X),v.set(W,ee),X||(Jb.has(W)||W.removeAttribute(d),Jb.delete(W)),ee||W.removeAttribute(a)}),oT--,oT||(jy=new WeakMap,jy=new WeakMap,Jb=new WeakMap,e0={})}},D3=function(i,n,a){a===void 0&&(a="data-aria-hidden");var d=Array.from(Array.isArray(i)?i:[i]),y=MJ(i);return y?(d.push.apply(d,Array.from(y.querySelectorAll("[aria-live], script"))),DJ(d,y,a,"aria-hidden")):function(){return null}},Ew="Dialog",[O3]=Fh(Ew),[OJ,Nd]=O3(Ew),z3=i=>{const{__scopeDialog:n,children:a,open:d,defaultOpen:y,onOpenChange:v,modal:C=!0}=i,s=$.useRef(null),M=$.useRef(null),[L,F]=Rg({prop:d,defaultProp:y??!1,onChange:v,caller:Ew});return h.jsx(OJ,{scope:n,triggerRef:s,contentRef:M,contentId:hm(),titleId:hm(),descriptionId:hm(),open:L,onOpenChange:F,onOpenToggle:$.useCallback(()=>F(W=>!W),[F]),modal:C,children:a})};z3.displayName=Ew;var F3="DialogTrigger",zJ=$.forwardRef((i,n)=>{const{__scopeDialog:a,...d}=i,y=Nd(F3,a),v=ta(n,y.triggerRef);return h.jsx(ss.button,{type:"button","aria-haspopup":"dialog","aria-expanded":y.open,"aria-controls":y.contentId,"data-state":BE(y.open),...d,ref:v,onClick:ci(i.onClick,y.onOpenToggle)})});zJ.displayName=F3;var zE="DialogPortal",[FJ,B3]=O3(zE,{forceMount:void 0}),V3=i=>{const{__scopeDialog:n,forceMount:a,children:d,container:y}=i,v=Nd(zE,n);return h.jsx(FJ,{scope:n,forceMount:a,children:$.Children.map(d,C=>h.jsx(Bh,{present:a||v.open,children:h.jsx(aw,{asChild:!0,container:y,children:C})}))})};V3.displayName=zE;var q0="DialogOverlay",U3=$.forwardRef((i,n)=>{const a=B3(q0,i.__scopeDialog),{forceMount:d=a.forceMount,...y}=i,v=Nd(q0,i.__scopeDialog);return v.modal?h.jsx(Bh,{present:d||v.open,children:h.jsx(VJ,{...y,ref:n})}):null});U3.displayName=q0;var BJ=r_("DialogOverlay.RemoveScroll"),VJ=$.forwardRef((i,n)=>{const{__scopeDialog:a,...d}=i,y=Nd(q0,a);return h.jsx(OE,{as:BJ,allowPinchZoom:!0,shards:[y.contentRef],children:h.jsx(ss.div,{"data-state":BE(y.open),...d,ref:n,style:{pointerEvents:"auto",...d.style}})})}),Ng="DialogContent",$3=$.forwardRef((i,n)=>{const a=B3(Ng,i.__scopeDialog),{forceMount:d=a.forceMount,...y}=i,v=Nd(Ng,i.__scopeDialog);return h.jsx(Bh,{present:d||v.open,children:v.modal?h.jsx(UJ,{...y,ref:n}):h.jsx($J,{...y,ref:n})})});$3.displayName=Ng;var UJ=$.forwardRef((i,n)=>{const a=Nd(Ng,i.__scopeDialog),d=$.useRef(null),y=ta(n,a.contentRef,d);return $.useEffect(()=>{const v=d.current;if(v)return D3(v)},[]),h.jsx(q3,{...i,ref:y,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ci(i.onCloseAutoFocus,v=>{v.preventDefault(),a.triggerRef.current?.focus()}),onPointerDownOutside:ci(i.onPointerDownOutside,v=>{const C=v.detail.originalEvent,s=C.button===0&&C.ctrlKey===!0;(C.button===2||s)&&v.preventDefault()}),onFocusOutside:ci(i.onFocusOutside,v=>v.preventDefault())})}),$J=$.forwardRef((i,n)=>{const a=Nd(Ng,i.__scopeDialog),d=$.useRef(!1),y=$.useRef(!1);return h.jsx(q3,{...i,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:v=>{i.onCloseAutoFocus?.(v),v.defaultPrevented||(d.current||a.triggerRef.current?.focus(),v.preventDefault()),d.current=!1,y.current=!1},onInteractOutside:v=>{i.onInteractOutside?.(v),v.defaultPrevented||(d.current=!0,v.detail.originalEvent.type==="pointerdown"&&(y.current=!0));const C=v.target;a.triggerRef.current?.contains(C)&&v.preventDefault(),v.detail.originalEvent.type==="focusin"&&y.current&&v.preventDefault()}})}),q3=$.forwardRef((i,n)=>{const{__scopeDialog:a,trapFocus:d,onOpenAutoFocus:y,onCloseAutoFocus:v,...C}=i,s=Nd(Ng,a),M=$.useRef(null),L=ta(n,M);return I3(),h.jsxs(h.Fragment,{children:[h.jsx(DE,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:y,onUnmountAutoFocus:v,children:h.jsx(ow,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":BE(s.open),...C,ref:L,onDismiss:()=>s.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(qJ,{titleId:s.titleId}),h.jsx(WJ,{contentRef:M,descriptionId:s.descriptionId})]})]})}),FE="DialogTitle",G3=$.forwardRef((i,n)=>{const{__scopeDialog:a,...d}=i,y=Nd(FE,a);return h.jsx(ss.h2,{id:y.titleId,...d,ref:n})});G3.displayName=FE;var W3="DialogDescription",H3=$.forwardRef((i,n)=>{const{__scopeDialog:a,...d}=i,y=Nd(W3,a);return h.jsx(ss.p,{id:y.descriptionId,...d,ref:n})});H3.displayName=W3;var Z3="DialogClose",X3=$.forwardRef((i,n)=>{const{__scopeDialog:a,...d}=i,y=Nd(Z3,a);return h.jsx(ss.button,{type:"button",...d,ref:n,onClick:ci(i.onClick,()=>y.onOpenChange(!1))})});X3.displayName=Z3;function BE(i){return i?"open":"closed"}var K3="DialogTitleWarning",[$ie,Y3]=N6(K3,{contentName:Ng,titleName:FE,docsSlug:"dialog"}),qJ=({titleId:i})=>{const n=Y3(K3),a=`\`${n.contentName}\` requires a \`${n.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${n.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${n.docsSlug}`;return $.useEffect(()=>{i&&(document.getElementById(i)||console.error(a))},[a,i]),null},GJ="DialogDescriptionWarning",WJ=({contentRef:i,descriptionId:n})=>{const d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Y3(GJ).contentName}}.`;return $.useEffect(()=>{const y=i.current?.getAttribute("aria-describedby");n&&y&&(document.getElementById(n)||console.warn(d))},[d,i,n]),null},HJ=z3,ZJ=V3,Q3=U3,J3=$3,ez=G3,tz=H3,XJ=X3;const KJ=HJ,YJ=ZJ,rz=$.forwardRef(({className:i,...n},a)=>h.jsx(Q3,{ref:a,className:Ki("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...n}));rz.displayName=Q3.displayName;const nz=$.forwardRef(({className:i,children:n,...a},d)=>h.jsxs(YJ,{children:[h.jsx(rz,{}),h.jsxs(J3,{ref:d,className:Ki("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...a,children:[n,h.jsxs(XJ,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[h.jsx(Jf,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));nz.displayName=J3.displayName;const iz=$.forwardRef(({className:i,...n},a)=>h.jsx(ez,{ref:a,className:Ki("text-lg font-semibold leading-none tracking-tight",i),...n}));iz.displayName=ez.displayName;const QJ=$.forwardRef(({className:i,...n},a)=>h.jsx(tz,{ref:a,className:Ki("text-sm text-muted-foreground",i),...n}));QJ.displayName=tz.displayName;function JJ({open:i,onOpenChange:n}){const[a,d]=$.useState(0);return h.jsx(KJ,{open:i,onOpenChange:y=>{n(y),y||d(v=>v+1)},children:h.jsxs(nz,{className:"max-w-3xl p-0 overflow-hidden",children:[h.jsx(iz,{className:"sr-only",children:"Join the waitlist"}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1.05fr_1.15fr]",children:[h.jsx("div",{className:"p-8",children:h.jsx(Sw,{embedded:!0})},a),h.jsxs("div",{className:"hidden md:flex flex-col justify-center gap-4 border-l border-border bg-card/60 px-10 py-12",children:[h.jsx("p",{className:"text-base font-medium text-foreground uppercase tracking-[0.25em]",children:"Why it matters"}),h.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:"Every name on the waitlist is proof that science can belong to everyone. Well only reach out when theres meaningful progressno spam, just breakthroughs the community helps bring to life."})]})]})]})})}const eee=[{title:"1. Publish your lab",description:"Share your capabilities, equipment, and collaboration preferences in a structured profile built for scientists."},{title:"2. Verify once",description:"We run a light remote/on-site verification so partners know the details are accurate and trusted."},{title:"3. Connect quickly",description:"Inbound requests are routed straight to your team. Share availability, manage intros, and stay visible to the network."}],tee=[{title:"Labs & Core Facilities",description:"List your capabilities, surface underused equipment, and make it easy for peers and partners to collaborate."},{title:"Network Operators",description:"Manage multiple labs with consistent profiles, verification, and routing that respects each sites preferences."},{title:"Industry & Partners",description:"Find trusted collaborators faster, with clear capabilities, contact paths, and lightweight governance."}],ree=[{title:"Standardised discovery",description:"Profiles use the same structure across labs, so partners can compare expertise, equipment, and availability quickly."},{title:"Trusted details",description:"Verification checks make it clear whats real, whats available, and who to reach without endless back-and-forth."},{title:"Less time chasing",description:"GLASS-Connect routes qualified requests to the right people, helping teams spend more time collaborating."}];function nee(){const[i,n]=$.useState(!1);return h.jsxs("div",{className:"bg-background text-foreground",children:[h.jsx("section",{className:"border-b border-border bg-muted/30",children:h.jsx("div",{className:"container mx-auto px-4 py-20 lg:py-24",children:h.jsxs("div",{className:"max-w-3xl",children:[h.jsx("p",{className:"text-sm uppercase tracking-[0.35em] text-muted-foreground",children:"Why we started GLASS-Connect"}),h.jsx("h1",{className:"mt-4 text-4xl font-semibold leading-tight md:text-5xl",children:"Science deserves collaboration thats fast, clear, and trusted."}),h.jsx("p",{className:"mt-6 text-lg text-muted-foreground leading-relaxed",children:"Labs have incredible capabilities, but no simple way to share them or filter serious collaboration requests from noise. GLASS-Connect is a directory and routing layer for labs: structured profiles, light verification, and direct introductions so teams can work together fasterwithout adding bureaucracy."}),h.jsxs("div",{className:"mt-8 flex flex-col gap-3 sm:flex-row sm:items-center",children:[h.jsx(xn,{href:"/roadmap",children:h.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full bg-primary px-6 py-3 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:["Explore the roadmap",h.jsx(Yk,{className:"h-4 w-4"})]})}),h.jsx("button",{onClick:()=>n(!0),className:"inline-flex items-center justify-center gap-2 rounded-full border border-border px-6 py-3 text-sm font-medium text-muted-foreground transition hover:text-foreground",children:"Join the waitlist"})]})]})})}),h.jsx("section",{className:"border-b border-border",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 lg:py-20",children:[h.jsx("h2",{className:"text-2xl font-semibold text-center",children:"Why a lab network matters"}),h.jsx("p",{className:"mt-3 max-w-3xl mx-auto text-center text-muted-foreground leading-relaxed",children:"We built GLASS-Connect to make it effortless for partners to find, trust, and contact the right labwithout long chains of introductions or hidden spreadsheets."}),h.jsx("div",{className:"mt-12 grid gap-6 md:grid-cols-3",children:ree.map(a=>h.jsxs("div",{className:"h-full rounded-3xl border border-border bg-background p-6 shadow-sm",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a.title}),h.jsx("p",{className:"mt-3 text-sm text-muted-foreground leading-relaxed",children:a.description})]},a.title))})]})}),h.jsx("section",{className:"border-b border-border",children:h.jsx("div",{className:"container mx-auto px-4 py-16 lg:py-20",children:h.jsxs("div",{className:"grid gap-10 lg:grid-cols-[minmax(0,1.4fr)_minmax(0,1fr)] lg:items-start",children:[h.jsxs("article",{children:[h.jsx("h2",{className:"text-2xl font-semibold",children:"What is GLASS-Connect?"}),h.jsx("p",{className:"mt-4 text-muted-foreground leading-relaxed",children:"GLASS-Connect is a directory and routing layer for research labs. We standardise how labs present their capabilities, verify key details, and connect inbound collaborations without burying teams in admin."})]}),h.jsxs("article",{children:[h.jsx("h2",{className:"text-2xl font-semibold",children:"Why GLASS-Connect matters"}),h.jsx("p",{className:"mt-4 text-muted-foreground leading-relaxed",children:"Today, capabilities are scattered across PDFs, cold emails, and outdated directories. GLASS-Connect gives every lab a clear presence and makes it simple for serious partners to reach the right people without chasing inboxes."})]})]})})}),h.jsx("section",{className:"border-b border-border",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 lg:py-20",children:[h.jsx("h2",{className:"text-2xl font-semibold text-center",children:"How Glass works"}),h.jsx("p",{className:"mt-3 max-w-3xl mx-auto text-center text-muted-foreground leading-relaxed",children:"We combine structured profiles with light verification and direct routing so collaborators can move from first contact to scoped work quickly."}),h.jsx("div",{className:"mt-12 grid gap-6 md:grid-cols-3",children:eee.map(a=>h.jsxs("div",{className:"h-full rounded-3xl border border-border bg-card p-6 shadow-sm",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a.title}),h.jsx("p",{className:"mt-3 text-sm text-muted-foreground leading-relaxed",children:a.description})]},a.title))})]})}),h.jsx("section",{className:"border-b border-border bg-muted/30",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 lg:py-20",children:[h.jsx("h2",{className:"text-2xl font-semibold text-center",children:"Who we build for"}),h.jsx("p",{className:"mt-3 max-w-3xl mx-auto text-center text-muted-foreground leading-relaxed",children:"GLASS-Connect gives labs and partners a shared surface to collaboratewithout forcing them into new workflows."}),h.jsx("div",{className:"mt-12 grid gap-6 md:grid-cols-3",children:tee.map(a=>h.jsxs("div",{className:"h-full rounded-3xl border border-border bg-background p-6 shadow-sm",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a.title}),h.jsx("p",{className:"mt-3 text-sm text-muted-foreground leading-relaxed",children:a.description})]},a.title))})]})}),h.jsx(C3,{}),h.jsx("section",{className:"border-b border-border",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 lg:py-20",children:[h.jsx("h2",{className:"text-2xl font-semibold text-center",children:"Lets connect labs faster"}),h.jsx("p",{className:"mt-3 max-w-3xl mx-auto text-center text-muted-foreground leading-relaxed",children:"Whether you manage a single lab or a network of facilities, GLASS-Connect gives you a clear, trusted place to showcase your work and meet collaborators."}),h.jsxs("div",{className:"mt-8 flex flex-col justify-center gap-3 sm:flex-row",children:[h.jsx(xn,{href:"/roadmap",children:h.jsxs("a",{className:"inline-flex items-center gap-2 rounded-full bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:["See whats next",h.jsx(Yk,{className:"h-4 w-4"})]})}),h.jsx("button",{onClick:()=>n(!0),className:"inline-flex items-center justify-center gap-2 rounded-full border border-border px-5 py-2.5 text-sm font-medium text-muted-foreground transition hover:text-foreground",children:"Join the waitlist"})]})]})}),h.jsx(JJ,{open:i,onOpenChange:n})]})}var Cw="Collapsible",[iee,sz]=Fh(Cw),[see,VE]=iee(Cw),oz=$.forwardRef((i,n)=>{const{__scopeCollapsible:a,open:d,defaultOpen:y,disabled:v,onOpenChange:C,...s}=i,[M,L]=Rg({prop:d,defaultProp:y??!1,onChange:C,caller:Cw});return h.jsx(see,{scope:a,disabled:v,contentId:hm(),open:M,onOpenToggle:$.useCallback(()=>L(F=>!F),[L]),children:h.jsx(ss.div,{"data-state":$E(M),"data-disabled":v?"":void 0,...s,ref:n})})});oz.displayName=Cw;var az="CollapsibleTrigger",lz=$.forwardRef((i,n)=>{const{__scopeCollapsible:a,...d}=i,y=VE(az,a);return h.jsx(ss.button,{type:"button","aria-controls":y.contentId,"aria-expanded":y.open||!1,"data-state":$E(y.open),"data-disabled":y.disabled?"":void 0,disabled:y.disabled,...d,ref:n,onClick:ci(i.onClick,y.onOpenToggle)})});lz.displayName=az;var UE="CollapsibleContent",cz=$.forwardRef((i,n)=>{const{forceMount:a,...d}=i,y=VE(UE,i.__scopeCollapsible);return h.jsx(Bh,{present:a||y.open,children:({present:v})=>h.jsx(oee,{...d,ref:n,present:v})})});cz.displayName=UE;var oee=$.forwardRef((i,n)=>{const{__scopeCollapsible:a,present:d,children:y,...v}=i,C=VE(UE,a),[s,M]=$.useState(d),L=$.useRef(null),F=ta(n,L),W=$.useRef(0),X=W.current,ee=$.useRef(0),he=ee.current,se=C.open||s,oe=$.useRef(se),ve=$.useRef(void 0);return $.useEffect(()=>{const me=requestAnimationFrame(()=>oe.current=!1);return()=>cancelAnimationFrame(me)},[]),Qc(()=>{const me=L.current;if(me){ve.current=ve.current||{transitionDuration:me.style.transitionDuration,animationName:me.style.animationName},me.style.transitionDuration="0s",me.style.animationName="none";const Se=me.getBoundingClientRect();W.current=Se.height,ee.current=Se.width,oe.current||(me.style.transitionDuration=ve.current.transitionDuration,me.style.animationName=ve.current.animationName),M(d)}},[C.open,d]),h.jsx(ss.div,{"data-state":$E(C.open),"data-disabled":C.disabled?"":void 0,id:C.contentId,hidden:!se,...v,ref:F,style:{"--radix-collapsible-content-height":X?`${X}px`:void 0,"--radix-collapsible-content-width":he?`${he}px`:void 0,...i.style},children:se&&y})});function $E(i){return i?"open":"closed"}var aee=oz,lee=lz,cee=cz,uee=$.createContext(void 0);function qE(i){const n=$.useContext(uee);return i||n||"ltr"}var jd="Accordion",dee=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[GE,hee,fee]=sw(jd),[Aw]=Fh(jd,[fee,sz]),WE=sz(),uz=Un.forwardRef((i,n)=>{const{type:a,...d}=i,y=d,v=d;return h.jsx(GE.Provider,{scope:i.__scopeAccordion,children:a==="multiple"?h.jsx(yee,{...v,ref:n}):h.jsx(gee,{...y,ref:n})})});uz.displayName=jd;var[dz,pee]=Aw(jd),[hz,mee]=Aw(jd,{collapsible:!1}),gee=Un.forwardRef((i,n)=>{const{value:a,defaultValue:d,onValueChange:y=()=>{},collapsible:v=!1,...C}=i,[s,M]=Rg({prop:a,defaultProp:d??"",onChange:y,caller:jd});return h.jsx(dz,{scope:i.__scopeAccordion,value:Un.useMemo(()=>s?[s]:[],[s]),onItemOpen:M,onItemClose:Un.useCallback(()=>v&&M(""),[v,M]),children:h.jsx(hz,{scope:i.__scopeAccordion,collapsible:v,children:h.jsx(fz,{...C,ref:n})})})}),yee=Un.forwardRef((i,n)=>{const{value:a,defaultValue:d,onValueChange:y=()=>{},...v}=i,[C,s]=Rg({prop:a,defaultProp:d??[],onChange:y,caller:jd}),M=Un.useCallback(F=>s((W=[])=>[...W,F]),[s]),L=Un.useCallback(F=>s((W=[])=>W.filter(X=>X!==F)),[s]);return h.jsx(dz,{scope:i.__scopeAccordion,value:C,onItemOpen:M,onItemClose:L,children:h.jsx(hz,{scope:i.__scopeAccordion,collapsible:!0,children:h.jsx(fz,{...v,ref:n})})})}),[_ee,Iw]=Aw(jd),fz=Un.forwardRef((i,n)=>{const{__scopeAccordion:a,disabled:d,dir:y,orientation:v="vertical",...C}=i,s=Un.useRef(null),M=ta(s,n),L=hee(a),W=qE(y)==="ltr",X=ci(i.onKeyDown,ee=>{if(!dee.includes(ee.key))return;const he=ee.target,se=L().filter(Ct=>!Ct.ref.current?.disabled),oe=se.findIndex(Ct=>Ct.ref.current===he),ve=se.length;if(oe===-1)return;ee.preventDefault();let me=oe;const Se=0,Re=ve-1,Be=()=>{me=oe+1,me>Re&&(me=Se)},rt=()=>{me=oe-1,me<Se&&(me=Re)};switch(ee.key){case"Home":me=Se;break;case"End":me=Re;break;case"ArrowRight":v==="horizontal"&&(W?Be():rt());break;case"ArrowDown":v==="vertical"&&Be();break;case"ArrowLeft":v==="horizontal"&&(W?rt():Be());break;case"ArrowUp":v==="vertical"&&rt();break}const We=me%ve;se[We].ref.current?.focus()});return h.jsx(_ee,{scope:a,disabled:d,direction:y,orientation:v,children:h.jsx(GE.Slot,{scope:a,children:h.jsx(ss.div,{...C,"data-orientation":v,ref:M,onKeyDown:d?void 0:X})})})}),G0="AccordionItem",[xee,HE]=Aw(G0),pz=Un.forwardRef((i,n)=>{const{__scopeAccordion:a,value:d,...y}=i,v=Iw(G0,a),C=pee(G0,a),s=WE(a),M=hm(),L=d&&C.value.includes(d)||!1,F=v.disabled||i.disabled;return h.jsx(xee,{scope:a,open:L,disabled:F,triggerId:M,children:h.jsx(aee,{"data-orientation":v.orientation,"data-state":vz(L),...s,...y,ref:n,disabled:F,open:L,onOpenChange:W=>{W?C.onItemOpen(d):C.onItemClose(d)}})})});pz.displayName=G0;var mz="AccordionHeader",gz=Un.forwardRef((i,n)=>{const{__scopeAccordion:a,...d}=i,y=Iw(jd,a),v=HE(mz,a);return h.jsx(ss.h3,{"data-orientation":y.orientation,"data-state":vz(v.open),"data-disabled":v.disabled?"":void 0,...d,ref:n})});gz.displayName=mz;var d2="AccordionTrigger",yz=Un.forwardRef((i,n)=>{const{__scopeAccordion:a,...d}=i,y=Iw(jd,a),v=HE(d2,a),C=mee(d2,a),s=WE(a);return h.jsx(GE.ItemSlot,{scope:a,children:h.jsx(lee,{"aria-disabled":v.open&&!C.collapsible||void 0,"data-orientation":y.orientation,id:v.triggerId,...s,...d,ref:n})})});yz.displayName=d2;var _z="AccordionContent",xz=Un.forwardRef((i,n)=>{const{__scopeAccordion:a,...d}=i,y=Iw(jd,a),v=HE(_z,a),C=WE(a);return h.jsx(cee,{role:"region","aria-labelledby":v.triggerId,"data-orientation":y.orientation,...C,...d,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...i.style}})});xz.displayName=_z;function vz(i){return i?"open":"closed"}var vee=uz,bee=pz,wee=gz,bz=yz,wz=xz;const See=vee,m0=$.forwardRef(({className:i,...n},a)=>h.jsx(bee,{ref:a,className:Ki("border-b",i),...n}));m0.displayName="AccordionItem";const g0=$.forwardRef(({className:i,children:n,...a},d)=>h.jsx(wee,{className:"flex",children:h.jsxs(bz,{ref:d,className:Ki("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",i),...a,children:[n,h.jsx(qM,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));g0.displayName=bz.displayName;const y0=$.forwardRef(({className:i,children:n,...a},d)=>h.jsx(wz,{ref:d,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:h.jsx("div",{className:Ki("pb-4 pt-0",i),children:n})}));y0.displayName=wz.displayName;function Tee(){return h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx("div",{className:"container mx-auto px-4 py-20",children:h.jsxs("div",{className:"max-w-4xl mx-auto",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-14",children:[h.jsx("h1",{className:"text-4xl md:text-5xl font-bold",children:"Contact Glass"}),h.jsxs("p",{className:"mt-4 text-lg text-muted-foreground leading-relaxed",children:["Every question, partnership idea, or introduction helps labs collaborate faster. Whether you are a researcher, operator, journalist, or partneryou can reach the GLASS-Connect team at"," ",h.jsx("a",{href:"mailto:support@glass.demo",className:"font-medium text-primary hover:underline",children:"contact@glass-funding.com"}),"."]})]}),h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"grid gap-10 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)] items-start",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 shadow-sm p-8 space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 text-primary flex items-center justify-center",children:h.jsx(bv,{className:"h-5 w-5"})}),h.jsxs("div",{className:"text-left",children:[h.jsx("p",{className:"text-sm uppercase tracking-[0.25em] text-muted-foreground",children:"Write to us"}),h.jsx("a",{href:"mailto:contact@glass-funding.com",className:"text-lg font-medium text-foreground hover:text-primary",children:"contact@glass-funding.com"})]})]}),h.jsxs("div",{className:"grid gap-4 text-sm text-muted-foreground leading-relaxed",children:[h.jsxs("div",{className:"rounded-2xl bg-background border border-border/80 p-4",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Researchers & Labs"}),h.jsx("p",{className:"mt-2",children:"Share your lab profile, ask about verification, or get help with listing updates and inbound requests."})]}),h.jsxs("div",{className:"rounded-2xl bg-background border border-border/80 p-4",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Network Operators"}),h.jsx("p",{className:"mt-2",children:"Manage multiple labs, set routing rules, and keep data fresh across your networkwe can help."})]}),h.jsxs("div",{className:"rounded-2xl bg-background border border-border/80 p-4",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Media & Partners"}),h.jsx("p",{className:"mt-2",children:"Request interviews, press kits, or collaboration details. Were happy to share what GLASS-Connect is building."})]})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/60 shadow-sm p-8",children:[h.jsx("h2",{className:"text-xl font-semibold text-foreground text-left",children:"FAQs"}),h.jsxs(See,{type:"single",collapsible:!0,className:"mt-4 space-y-1",children:[h.jsxs(m0,{value:"faq-1",children:[h.jsx(g0,{className:"text-left text-sm",children:"How soon will someone reply?"}),h.jsx(y0,{children:h.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:"We aim to respond within 2 business days. Research submissions may take a little longer while we loop in advisors for review."})})]}),h.jsxs(m0,{value:"faq-2",children:[h.jsx(g0,{className:"text-left text-sm",children:"Do I need verification to list a lab?"}),h.jsx(y0,{children:h.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:"We recommend verification to improve trust and placement. You can publish a profile without it and schedule verification when you are ready."})})]}),h.jsxs(m0,{value:"faq-3",children:[h.jsx(g0,{className:"text-left text-sm",children:"Can I demo the platform before launch?"}),h.jsx(y0,{children:h.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:"Yesdrop us a note at contact@glass-funding.com and well share the latest demo environment and roadmap update."})})]})]}),h.jsxs("div",{className:"mt-8",children:[h.jsx("p",{className:"text-sm uppercase tracking-[0.25em] text-muted-foreground text-left",children:"Social"}),h.jsxs("div",{className:"mt-4 flex gap-3 text-muted-foreground",children:[h.jsx("a",{href:"https://x.com/GlassFunding",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border hover:text-primary transition","aria-label":"Glass on X",children:h.jsx(Jf,{className:"h-4 w-4"})}),h.jsx("a",{href:"lab s",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border hover:text-primary transition","aria-label":"Glass on LinkedIn",children:h.jsx(N2,{className:"h-4 w-4"})}),h.jsx("a",{href:"https://www.instagram.com/glass_funding/",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border hover:text-primary transition","aria-label":"Glass on Instagram",children:h.jsx(ZM,{className:"h-4 w-4"})})]})]})]})]})]})}),h.jsx(Sw,{})]})}function Eee(){return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 pb-20 flex flex-col items-center text-center",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"404 error"}),h.jsx("h1",{className:"mt-6 text-4xl md:text-5xl font-semibold text-foreground max-w-3xl",children:"Looks like this page drifted off the map."}),h.jsx("p",{className:"mt-4 max-w-2xl text-lg text-muted-foreground leading-relaxed",children:"The link you followed might be broken or the content may have been moved. Try returning to the homepage or browse our available lab partners."}),h.jsxs("div",{className:"mt-10 flex flex-col gap-3 sm:flex-row",children:[h.jsx(xn,{href:"/",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Back to homepage"})}),h.jsx(xn,{href:"/labs",children:h.jsxs("a",{className:"inline-flex items-center justify-center gap-2 rounded-full border border-border bg-background px-5 py-2 text-sm font-medium text-foreground hover:text-primary transition",children:[h.jsx(XM,{className:"h-4 w-4"}),"Browse labs"]})})]}),h.jsxs("p",{className:"mt-8 text-sm text-muted-foreground",children:["Believe this is a mistake?"," ",h.jsx("a",{className:"text-primary hover:text-primary/80 transition",href:"mailto:support@glass.org",children:"Let us know"}),"."]})]})})}function Cee(){const{user:i,loading:n}=Ma(),{toast:a}=xv(),[d,y]=$.useState(""),[v,C]=$.useState(""),[s,M]=$.useState(null),[L,F]=Al(),[W,X]=$.useState(!1),{next:ee,confirmed:he}=$.useMemo(()=>{try{const oe=new URLSearchParams(window.location.search);return{next:oe.get("next")||"/account",confirmed:oe.get("confirmed")==="1"||oe.get("confirmed")==="true"}}catch{return{next:"/account",confirmed:!1}}},[]);$.useEffect(()=>{if(he){a({title:"Email confirmed",description:"You can sign in now."});try{const oe=new URLSearchParams(window.location.search);oe.delete("confirmed");const ve=oe.toString(),me=ve?`/login?${ve}`:"/login";me!==L&&F(me,{replace:!0})}catch{F("/login",{replace:!0})}}},[he,a,F,L]),$.useEffect(()=>{!n&&i&&F(ee,{replace:!0})},[n,i,F,ee]);const se=async oe=>{if(oe.preventDefault(),!d||!v){M("Enter your email and password to continue.");return}M(null),X(!0);try{const{data:ve,error:me}=await fn.auth.signInWithPassword({email:d,password:v});me?M(me.message):ve.session&&F(ee,{replace:!0})}catch(ve){console.error(ve),M("Unexpected error occurred. Please try again.")}finally{X(!1)}};return h.jsx("section",{className:"bg-background min-h-screen pt-11",children:h.jsx("div",{className:"container mx-auto px-4 pb-20",children:h.jsxs("div",{className:"mx-auto max-w-4xl grid gap-12 items-center lg:grid-cols-[1.1fr_0.9fr]",children:[h.jsxs("div",{className:"space-y-6",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Welcome back"}),h.jsx("h1",{className:"text-3xl md:text-4xl font-semibold leading-tight text-foreground",children:"Sign in to keep backing the science that matters to you."}),h.jsx("p",{className:"text-sm md:text-base text-muted-foreground leading-relaxed",children:"Access your portfolio, track donations, and stay close to the research teams you support."}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground shadow-sm",children:[h.jsx("p",{className:"font-medium text-foreground",children:"New to Glass?"}),h.jsx("p",{className:"mt-1",children:"Create an account in minutes and start directing capital to world-class labs."}),h.jsx(xn,{href:"/signup",children:h.jsx("a",{className:"mt-4 inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Create your profile"})})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/90 p-8 shadow-lg",children:[h.jsxs("form",{className:"space-y-5",onSubmit:se,children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:d,onChange:oe=>y(oe.target.value),placeholder:"you@example.org",required:!0})]}),h.jsxs("div",{children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Password"}),h.jsx(xn,{href:"/forgot-password",children:h.jsx("a",{className:"text-xs font-medium text-muted-foreground hover:text-foreground transition",children:"Forgot?"})})]}),h.jsx("input",{type:"password",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:v,onChange:oe=>C(oe.target.value),placeholder:"Enter your password",required:!0})]}),s&&h.jsx("p",{className:"text-sm text-destructive",children:s}),h.jsx("button",{type:"submit",className:"w-full rounded-full bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",disabled:W,children:W?"Signing in...":"Log in"})]}),h.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Need to get set up?"," ",h.jsx(xn,{href:"/signup",children:h.jsx("a",{className:"font-medium text-primary hover:text-primary/80 transition",children:"Create an account"})})]})]})]})})})}function Aee(){const[i,n]=$.useState(""),[a,d]=$.useState(""),[y,v]=$.useState(""),[C,s]=$.useState(null),[M,L]=$.useState(!1),[,F]=Al(),W=async X=>{if(X.preventDefault(),!a.includes("@")||y.length<6){s("Use a valid email address and a password with at least 6 characters.");return}s(null),L(!0);try{const{data:ee,error:he}=await fn.auth.signUp({email:a,password:y,options:{emailRedirectTo:`${window.location.origin}/confirm-email`}});if(he){s(he.message),L(!1);return}F("/login")}catch(ee){console.error(ee),s("Unexpected error occurred. Please try again.")}finally{L(!1)}};return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 pb-20",children:h.jsxs("div",{className:"mx-auto max-w-4xl grid gap-12 items-center lg:grid-cols-[1.05fr_0.95fr]",children:[h.jsxs("div",{className:"space-y-6",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Join the community"}),h.jsx("h1",{className:"text-3xl md:text-4xl font-semibold leading-tight text-foreground",children:"Build your Glass profile and direct capital where breakthroughs happen."}),h.jsx("p",{className:"text-sm md:text-base text-muted-foreground leading-relaxed",children:"Tell us a little about you and well surface handpicked projects, personalized reports, and donation workflows."}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground shadow-sm",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Already supporting teams?"}),h.jsx("p",{className:"mt-1",children:"Sign in to continue tracking milestones and managing your follow-ups."}),h.jsx(xn,{href:"/login",children:h.jsx("a",{className:"mt-4 inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Log in instead"})})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/90 p-8 shadow-lg",children:[h.jsxs("form",{className:"space-y-5",onSubmit:W,children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Name"}),h.jsx("input",{type:"text",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:i,onChange:X=>n(X.target.value),placeholder:"Your full name",required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:a,onChange:X=>d(X.target.value),placeholder:"you@example.org",required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Password"}),h.jsx("input",{type:"password",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:y,onChange:X=>v(X.target.value),placeholder:"Minimum 6 characters",required:!0,minLength:6})]}),C&&h.jsx("p",{className:"text-sm text-destructive",children:C}),h.jsx("button",{type:"submit",className:"w-full rounded-full bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",disabled:M,children:M?"Creating account...":"Create account"})]}),h.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Already have an account?"," ",h.jsx(xn,{href:"/login",children:h.jsx("a",{className:"font-medium text-primary hover:text-primary/80 transition",children:"Log in"})})]})]})]})})})}function Iee(i){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)}function Pee(){const[i,n]=$.useState(""),[a,d]=$.useState(null),[y,v]=$.useState(!1),[,C]=Al(),s=async M=>{if(M.preventDefault(),!Iee(i)){d("Enter the email address linked to your account.");return}d(null),v(!0);try{const{error:L}=await fn.auth.resetPasswordForEmail(i,{redirectTo:`${window.location.origin}/reset-password`});if(L)throw L;C("/forgot-password/confirmation")}catch(L){d(L?.message||"Unable to send reset email. Please try again.")}finally{v(!1)}};return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 pb-20",children:h.jsxs("div",{className:"mx-auto max-w-4xl grid gap-12 items-center lg:grid-cols-[1.05fr_0.95fr]",children:[h.jsxs("div",{className:"space-y-6",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Reset access"}),h.jsx("h1",{className:"text-3xl md:text-4xl font-semibold leading-tight text-foreground",children:"Forgotten your password? Let's get you back to your projects."}),h.jsx("p",{className:"text-sm md:text-base text-muted-foreground leading-relaxed",children:"Enter the email you use for Glass and we'll send a reset link. You'll see confirmation details on the next screen."}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground shadow-sm",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Remembered it?"}),h.jsx("p",{className:"mt-1",children:"Jump back to sign in and continue exploring the portfolio."}),h.jsx(xn,{href:"/login",children:h.jsx("a",{className:"mt-4 inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Return to login"})})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/90 p-8 shadow-lg",children:[h.jsxs("form",{className:"space-y-5",onSubmit:s,noValidate:!0,children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:`mt-2 w-full rounded-full border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary ${a?"border-destructive":"border-border"}`,value:i,onChange:M=>n(M.target.value),placeholder:"you@example.org","aria-invalid":!!a,"aria-describedby":a?"reset-email-error":void 0}),a?h.jsx("p",{id:"reset-email-error",className:"mt-2 text-sm text-destructive",children:a}):null]}),h.jsx("button",{type:"submit",className:"w-full rounded-full bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition disabled:opacity-60",disabled:y,children:y?"Sending...":"Send reset link"})]}),h.jsxs("p",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Prefer to try again later?"," ",h.jsx(xn,{href:"/login",children:h.jsx("a",{className:"font-medium text-primary hover:text-primary/80 transition",children:"Back to login"})})]})]})]})})})}function kee(){return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 pb-20",children:h.jsxs("div",{className:"mx-auto max-w-3xl rounded-3xl border border-border bg-card/90 p-10 text-center shadow-lg",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Check your inbox"}),h.jsx("h1",{className:"mt-6 text-3xl md:text-4xl font-semibold text-foreground",children:"Reset instructions are on their way."}),h.jsx("p",{className:"mt-4 text-sm md:text-base text-muted-foreground leading-relaxed",children:"If an account exists for the email you provided, you'll receive a message in the next few minutes. Follow the secure link to choose a new password and jump back into your Glass workspace."}),h.jsx("div",{className:"mt-8 grid gap-4",children:h.jsxs("div",{className:"rounded-2xl border border-border bg-muted/20 px-6 py-4 text-sm text-muted-foreground text-left",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Didn't see the email?"}),h.jsxs("ul",{className:"mt-2 list-disc space-y-1 pl-5",children:[h.jsx("li",{children:"Check your spam or promotions folder."}),h.jsx("li",{children:"Make sure you entered the correct address."}),h.jsx("li",{children:"Still stuck? Request another link or reach out to our team."})]})]})}),h.jsxs("div",{className:"mt-8 flex flex-col items-center gap-3",children:[h.jsx(xn,{href:"/login",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Return to login"})}),h.jsx(xn,{href:"/forgot-password",children:h.jsx("a",{className:"text-sm font-medium text-muted-foreground hover:text-foreground transition",children:"Send another reset link"})})]})]})})})}function Nee(){const[i,n]=$.useState(""),[a,d]=$.useState(""),[y,v]=$.useState(!1),[C,s]=$.useState(!1),[M,L]=$.useState(!1),[F,W]=$.useState(null);$.useEffect(()=>{let ee=!0;return(async()=>{if(!(typeof window>"u"))try{const{error:se}=await fn.auth.exchangeCodeForSession(window.location.href);if(se)throw se;ee&&s(!0)}catch(se){ee&&(W(se?.message||"Invalid or expired reset link."),s(!1))}})(),()=>{ee=!1}},[]);const X=async ee=>{if(ee.preventDefault(),i.length<8){W("Use at least 8 characters for your new password.");return}if(i!==a){W("Passwords do not match.");return}v(!0),W(null);try{const{error:he}=await fn.auth.updateUser({password:i});if(he)throw he;L(!0)}catch(he){W(he?.message||"Unable to update password.")}finally{v(!1)}};return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 pb-20",children:h.jsxs("div",{className:"mx-auto max-w-3xl rounded-3xl border border-border bg-card/90 p-10 shadow-lg",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Reset password"}),h.jsx("h1",{className:"mt-6 text-3xl md:text-4xl font-semibold text-foreground",children:"Set a new password."}),h.jsx("p",{className:"mt-4 text-sm md:text-base text-muted-foreground leading-relaxed",children:"Choose a new password to keep your account secure."}),F&&h.jsx("div",{className:"mt-6 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:F}),!C&&!F&&h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Validating your reset link..."}),C&&!M&&h.jsxs("form",{className:"mt-6 space-y-4",onSubmit:X,children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"New password"}),h.jsx("input",{type:"password",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:i,onChange:ee=>n(ee.target.value),placeholder:"At least 8 characters",autoComplete:"new-password"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Confirm password"}),h.jsx("input",{type:"password",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",value:a,onChange:ee=>d(ee.target.value),autoComplete:"new-password"})]}),h.jsx("button",{type:"submit",className:"w-full rounded-full bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition disabled:opacity-60",disabled:y,children:y?"Updating...":"Update password"})]}),M&&h.jsx("div",{className:"mt-6 rounded-2xl border border-emerald-300 bg-emerald-50 px-4 py-3 text-sm text-emerald-900",children:"Password updated. You can now sign in again."}),h.jsx("div",{className:"mt-8 flex flex-col items-center gap-3",children:h.jsx(xn,{href:"/login",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary transition",children:"Back to login"})})})]})})})}function jee(){const[,i]=Al(),[n,a]=$.useState("loading"),[d,y]=$.useState(null);$.useEffect(()=>{let M=!0,L=null;return(async()=>{if(!(typeof window>"u"))try{const{error:W}=await fn.auth.exchangeCodeForSession(window.location.href);if(W)throw W;if(!M)return;a("success"),L=setTimeout(()=>{i("/login?confirmed=1",{replace:!0})},1800)}catch(W){if(!M)return;y(W?.message||"Invalid or expired confirmation link."),a("error")}})(),()=>{M=!1,L&&clearTimeout(L)}},[i]);const v=n==="loading",C=n==="success",s=n==="error";return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 pb-20",children:h.jsxs("div",{className:"mx-auto max-w-3xl rounded-3xl border border-border bg-card/90 p-10 text-center shadow-lg",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:C?"Email confirmed":s?"Confirmation failed":"Confirming email"}),h.jsx("h1",{className:"mt-6 text-3xl md:text-4xl font-semibold text-foreground",children:C?"Your account is ready to go.":s?"We could not confirm your email.":"Hang tight while we verify your link."}),h.jsx("p",{className:"mt-4 text-sm md:text-base text-muted-foreground leading-relaxed",children:C?"Thanks for confirming your email. You can now sign in to finish setting up your Glass profile and explore labs.":s?"The link might have expired or already been used. You can request a new confirmation email or contact support.":"This usually takes just a few seconds. Please keep this page open."}),v&&h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Validating your confirmation link..."}),s&&d&&h.jsx("div",{className:"mt-6 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:d}),C&&h.jsx("div",{className:"mt-6 rounded-2xl border border-emerald-300 bg-emerald-50 px-4 py-3 text-sm text-emerald-900",children:"Confirmation successful. Redirecting you to login..."}),h.jsx("div",{className:"mt-8 grid gap-4",children:h.jsxs("div",{className:"rounded-2xl border border-border bg-muted/20 px-6 py-4 text-sm text-muted-foreground text-left",children:[h.jsx("p",{className:"font-medium text-foreground",children:"Having trouble?"}),h.jsxs("ul",{className:"mt-2 list-disc space-y-1 pl-5",children:[h.jsx("li",{children:"If the link expired, request a new confirmation email."}),h.jsx("li",{children:"Make sure you confirmed the same address you used to sign up."}),h.jsx("li",{children:"Need help? Reach out and we'll sort it quickly."})]})]})}),h.jsxs("div",{className:"mt-8 flex flex-col items-center gap-3",children:[h.jsx(xn,{href:C?"/login?confirmed=1":"/login",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Continue to login"})}),h.jsx(xn,{href:"/contact",children:h.jsx("a",{className:"text-sm font-medium text-muted-foreground hover:text-foreground transition",children:"Contact support"})})]})]})})})}const Sz=$.createContext(void 0);async function t0(i,n){const{headers:a,...d}=n??{},y=await fetch(i,{...d,headers:{"Content-Type":"application/json",...a??{}}});if(!y.ok){let v="Request failed";try{const C=await y.json();C?.message&&(v=C.message)}catch{}throw new Error(v)}if(y.status!==204)return await y.json()}function Ree({children:i}){const[n,a]=$.useState([]),[d,y]=$.useState(!0),[v,C]=$.useState(null),[s,M]=$.useState(!1),L=$.useCallback(async(se=!1)=>{y(!0);try{M(se);const oe=await t0(se?"/api/labs?includeHidden=true":"/api/labs"),ve=se?oe:oe.filter(me=>me.isVisible!==!1);a(ve),C(null)}catch(oe){const ve=oe instanceof Error?oe.message:"Unable to load labs";C(ve)}finally{y(!1)}},[]);$.useEffect(()=>{L(s)},[L,s]);const F=$.useCallback(async se=>{const oe=await t0("/api/labs",{method:"POST",body:JSON.stringify(se)});return a(ve=>{const me=[...ve,oe];return s?me:me.filter(Se=>Se.isVisible!==!1)}),oe},[s]),W=$.useCallback(async(se,oe)=>{const ve=await t0(`/api/labs/${se}`,{method:"PUT",body:JSON.stringify(oe)});return a(me=>{const Se=me.map(Re=>Re.id===se?ve:Re);return s?Se:Se.filter(Re=>Re.isVisible!==!1)}),ve},[s]),X=$.useCallback(async se=>{await t0(`/api/labs/${se}`,{method:"DELETE"}),a(oe=>oe.filter(ve=>ve.id!==se))},[]),ee=$.useCallback(async(se=s)=>{await L(se)},[L,s]),he=$.useMemo(()=>({labs:n,isLoading:d,error:v,refresh:ee,addLab:F,updateLab:W,removeLab:X}),[n,d,v,ee,F,W,X]);return h.jsx(Sz.Provider,{value:he,children:i})}function Em(){const i=$.useContext(Sz);if(!i)throw new Error("useLabs must be used within a LabsProvider");return i}var _0={exports:{}},Mee=_0.exports,TR;function Lee(){return TR||(TR=1,(function(i,n){(function(a,d){i.exports=d()})(Mee,(function(){var a,d,y;function v(s,M){if(!a)a=M;else if(!d)d=M;else{var L="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",F={};a(F),y=M(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}v(["exports"],function(s){var M=1e-6,L=typeof Float32Array<"u"?Float32Array:Array;function F(o,e){var r=e[0],l=e[1],u=e[2],m=e[3],g=r*m-u*l;return g?(o[0]=m*(g=1/g),o[1]=-l*g,o[2]=-u*g,o[3]=r*g,o):null}function W(){var o=new L(9);return L!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function X(o,e){var r=e[0],l=e[1],u=e[2],m=e[3],g=e[4],b=e[5],E=e[6],A=e[7],N=e[8];return o[0]=g*N-b*A,o[1]=u*A-l*N,o[2]=l*b-u*g,o[3]=b*E-m*N,o[4]=r*N-u*E,o[5]=u*m-r*b,o[6]=m*A-g*E,o[7]=l*E-r*A,o[8]=r*g-l*m,o}function ee(o,e,r){var l=e[0],u=e[1],m=e[2],g=e[3],b=e[4],E=e[5],A=e[6],N=e[7],j=e[8],R=r[0],B=r[1],V=r[2],H=r[3],Q=r[4],K=r[5],re=r[6],ae=r[7],ue=r[8];return o[0]=R*l+B*g+V*A,o[1]=R*u+B*b+V*N,o[2]=R*m+B*E+V*j,o[3]=H*l+Q*g+K*A,o[4]=H*u+Q*b+K*N,o[5]=H*m+Q*E+K*j,o[6]=re*l+ae*g+ue*A,o[7]=re*u+ae*b+ue*N,o[8]=re*m+ae*E+ue*j,o}function he(){var o=new L(16);return L!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function se(o){var e=new L(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e}function oe(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ve(o,e){var r=e[0],l=e[1],u=e[2],m=e[3],g=e[4],b=e[5],E=e[6],A=e[7],N=e[8],j=e[9],R=e[10],B=e[11],V=e[12],H=e[13],Q=e[14],K=e[15],re=r*b-l*g,ae=r*E-u*g,ue=r*A-m*g,xe=l*E-u*b,ye=l*A-m*b,Ie=u*A-m*E,Pe=N*H-j*V,Ae=N*Q-R*V,je=N*K-B*V,Oe=j*Q-R*H,ht=j*K-B*H,at=R*K-B*Q,lt=re*at-ae*ht+ue*Oe+xe*je-ye*Ae+Ie*Pe;return lt?(o[0]=(b*at-E*ht+A*Oe)*(lt=1/lt),o[1]=(u*ht-l*at-m*Oe)*lt,o[2]=(H*Ie-Q*ye+K*xe)*lt,o[3]=(R*ye-j*Ie-B*xe)*lt,o[4]=(E*je-g*at-A*Ae)*lt,o[5]=(r*at-u*je+m*Ae)*lt,o[6]=(Q*ue-V*Ie-K*ae)*lt,o[7]=(N*Ie-R*ue+B*ae)*lt,o[8]=(g*ht-b*je+A*Pe)*lt,o[9]=(l*je-r*ht-m*Pe)*lt,o[10]=(V*ye-H*ue+K*re)*lt,o[11]=(j*ue-N*ye-B*re)*lt,o[12]=(b*Ae-g*Oe-E*Pe)*lt,o[13]=(r*Oe-l*Ae+u*Pe)*lt,o[14]=(H*ae-V*xe-Q*re)*lt,o[15]=(N*xe-j*ae+R*re)*lt,o):null}function me(o,e,r){var l=e[0],u=e[1],m=e[2],g=e[3],b=e[4],E=e[5],A=e[6],N=e[7],j=e[8],R=e[9],B=e[10],V=e[11],H=e[12],Q=e[13],K=e[14],re=e[15],ae=r[0],ue=r[1],xe=r[2],ye=r[3];return o[0]=ae*l+ue*b+xe*j+ye*H,o[1]=ae*u+ue*E+xe*R+ye*Q,o[2]=ae*m+ue*A+xe*B+ye*K,o[3]=ae*g+ue*N+xe*V+ye*re,o[4]=(ae=r[4])*l+(ue=r[5])*b+(xe=r[6])*j+(ye=r[7])*H,o[5]=ae*u+ue*E+xe*R+ye*Q,o[6]=ae*m+ue*A+xe*B+ye*K,o[7]=ae*g+ue*N+xe*V+ye*re,o[8]=(ae=r[8])*l+(ue=r[9])*b+(xe=r[10])*j+(ye=r[11])*H,o[9]=ae*u+ue*E+xe*R+ye*Q,o[10]=ae*m+ue*A+xe*B+ye*K,o[11]=ae*g+ue*N+xe*V+ye*re,o[12]=(ae=r[12])*l+(ue=r[13])*b+(xe=r[14])*j+(ye=r[15])*H,o[13]=ae*u+ue*E+xe*R+ye*Q,o[14]=ae*m+ue*A+xe*B+ye*K,o[15]=ae*g+ue*N+xe*V+ye*re,o}function Se(o,e,r){var l,u,m,g,b,E,A,N,j,R,B,V,H=r[0],Q=r[1],K=r[2];return e===o?(o[12]=e[0]*H+e[4]*Q+e[8]*K+e[12],o[13]=e[1]*H+e[5]*Q+e[9]*K+e[13],o[14]=e[2]*H+e[6]*Q+e[10]*K+e[14],o[15]=e[3]*H+e[7]*Q+e[11]*K+e[15]):(u=e[1],m=e[2],g=e[3],b=e[4],E=e[5],A=e[6],N=e[7],j=e[8],R=e[9],B=e[10],V=e[11],o[0]=l=e[0],o[1]=u,o[2]=m,o[3]=g,o[4]=b,o[5]=E,o[6]=A,o[7]=N,o[8]=j,o[9]=R,o[10]=B,o[11]=V,o[12]=l*H+b*Q+j*K+e[12],o[13]=u*H+E*Q+R*K+e[13],o[14]=m*H+A*Q+B*K+e[14],o[15]=g*H+N*Q+V*K+e[15]),o}function Re(o,e,r){var l=r[0],u=r[1],m=r[2];return o[0]=e[0]*l,o[1]=e[1]*l,o[2]=e[2]*l,o[3]=e[3]*l,o[4]=e[4]*u,o[5]=e[5]*u,o[6]=e[6]*u,o[7]=e[7]*u,o[8]=e[8]*m,o[9]=e[9]*m,o[10]=e[10]*m,o[11]=e[11]*m,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function Be(o,e,r){var l=Math.sin(r),u=Math.cos(r),m=e[4],g=e[5],b=e[6],E=e[7],A=e[8],N=e[9],j=e[10],R=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=m*u+A*l,o[5]=g*u+N*l,o[6]=b*u+j*l,o[7]=E*u+R*l,o[8]=A*u-m*l,o[9]=N*u-g*l,o[10]=j*u-b*l,o[11]=R*u-E*l,o}function rt(o,e,r){var l=Math.sin(r),u=Math.cos(r),m=e[0],g=e[1],b=e[2],E=e[3],A=e[8],N=e[9],j=e[10],R=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=m*u-A*l,o[1]=g*u-N*l,o[2]=b*u-j*l,o[3]=E*u-R*l,o[8]=m*l+A*u,o[9]=g*l+N*u,o[10]=b*l+j*u,o[11]=E*l+R*u,o}function We(o,e,r){var l=Math.sin(r),u=Math.cos(r),m=e[0],g=e[1],b=e[2],E=e[3],A=e[4],N=e[5],j=e[6],R=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=m*u+A*l,o[1]=g*u+N*l,o[2]=b*u+j*l,o[3]=E*u+R*l,o[4]=A*u-m*l,o[5]=N*u-g*l,o[6]=j*u-b*l,o[7]=R*u-E*l,o}function Ct(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ht(o,e,r){var l,u,m,g=r[0],b=r[1],E=r[2],A=Math.sqrt(g*g+b*b+E*E);return A<M?null:(g*=A=1/A,b*=A,E*=A,l=Math.sin(e),u=Math.cos(e),o[0]=g*g*(m=1-u)+u,o[1]=b*g*m+E*l,o[2]=E*g*m-b*l,o[3]=0,o[4]=g*b*m-E*l,o[5]=b*b*m+u,o[6]=E*b*m+g*l,o[7]=0,o[8]=g*E*m+b*l,o[9]=b*E*m-g*l,o[10]=E*E*m+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function Zt(o,e){var r=e[0],l=e[1],u=e[2],m=e[4],g=e[5],b=e[6],E=e[8],A=e[9],N=e[10];return o[0]=Math.sqrt(r*r+l*l+u*u),o[1]=Math.sqrt(m*m+g*g+b*b),o[2]=Math.sqrt(E*E+A*A+N*N),o}function rr(o,e){var r=e[0],l=e[1],u=e[2],m=e[3],g=r+r,b=l+l,E=u+u,A=r*g,N=l*g,j=l*b,R=u*g,B=u*b,V=u*E,H=m*g,Q=m*b,K=m*E;return o[0]=1-j-V,o[1]=N+K,o[2]=R-Q,o[3]=0,o[4]=N-K,o[5]=1-A-V,o[6]=B+H,o[7]=0,o[8]=R+Q,o[9]=B-H,o[10]=1-A-j,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var $t=me;function Rt(){var o=new L(3);return L!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Gt(o){var e=new L(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function Ar(o){var e=o[0],r=o[1],l=o[2];return Math.sqrt(e*e+r*r+l*l)}function Ut(o,e,r){var l=new L(3);return l[0]=o,l[1]=e,l[2]=r,l}function Xt(o,e,r,l){return o[0]=e,o[1]=r,o[2]=l,o}function ut(o,e,r){return o[0]=e[0]+r[0],o[1]=e[1]+r[1],o[2]=e[2]+r[2],o}function Mt(o,e,r){return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],o}function Qt(o,e,r){return o[0]=e[0]*r[0],o[1]=e[1]*r[1],o[2]=e[2]*r[2],o}function ze(o,e,r){return o[0]=Math.min(e[0],r[0]),o[1]=Math.min(e[1],r[1]),o[2]=Math.min(e[2],r[2]),o}function It(o,e,r){return o[0]=Math.max(e[0],r[0]),o[1]=Math.max(e[1],r[1]),o[2]=Math.max(e[2],r[2]),o}function xr(o,e,r){return o[0]=e[0]*r,o[1]=e[1]*r,o[2]=e[2]*r,o}function Lr(o,e,r,l){return o[0]=e[0]+r[0]*l,o[1]=e[1]+r[1]*l,o[2]=e[2]+r[2]*l,o}function yn(o,e){var r=e[0]-o[0],l=e[1]-o[1],u=e[2]-o[2];return Math.sqrt(r*r+l*l+u*u)}function Yr(o,e){var r=e[0]-o[0],l=e[1]-o[1],u=e[2]-o[2];return r*r+l*l+u*u}function Zr(o){var e=o[0],r=o[1],l=o[2];return e*e+r*r+l*l}function Qr(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function ir(o,e){var r=e[0],l=e[1],u=e[2],m=r*r+l*l+u*u;return m>0&&(m=1/Math.sqrt(m)),o[0]=e[0]*m,o[1]=e[1]*m,o[2]=e[2]*m,o}function Hr(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function Ur(o,e,r){var l=e[0],u=e[1],m=e[2],g=r[0],b=r[1],E=r[2];return o[0]=u*E-m*b,o[1]=m*g-l*E,o[2]=l*b-u*g,o}function Ti(o,e,r,l){var u=e[0],m=e[1],g=e[2];return o[0]=u+l*(r[0]-u),o[1]=m+l*(r[1]-m),o[2]=g+l*(r[2]-g),o}function Sn(o,e,r){var l=e[0],u=e[1],m=e[2],g=r[3]*l+r[7]*u+r[11]*m+r[15];return o[0]=(r[0]*l+r[4]*u+r[8]*m+r[12])/(g=g||1),o[1]=(r[1]*l+r[5]*u+r[9]*m+r[13])/g,o[2]=(r[2]*l+r[6]*u+r[10]*m+r[14])/g,o}function Ci(o,e,r){var l=e[0],u=e[1],m=e[2];return o[0]=l*r[0]+u*r[3]+m*r[6],o[1]=l*r[1]+u*r[4]+m*r[7],o[2]=l*r[2]+u*r[5]+m*r[8],o}function At(o,e,r){var l=r[0],u=r[1],m=r[2],g=r[3],b=e[0],E=e[1],A=e[2],N=u*A-m*E,j=m*b-l*A,R=l*E-u*b;return o[0]=b+g*(N+=N)+u*(R+=R)-m*(j+=j),o[1]=E+g*j+m*N-l*R,o[2]=A+g*R+l*j-u*N,o}function pt(o){return o[0]=0,o[1]=0,o[2]=0,o}function Sr(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var Dr=Mt,Vr=Qt,Ke=Ar;function Je(){var o=new L(4);return L!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function jt(o,e,r){return o[0]=e[0]*r,o[1]=e[1]*r,o[2]=e[2]*r,o[3]=e[3]*r,o}function yr(o,e){var r=e[0],l=e[1],u=e[2],m=e[3],g=r*r+l*l+u*u+m*m;return g>0&&(g=1/Math.sqrt(g)),o[0]=r*g,o[1]=l*g,o[2]=u*g,o[3]=m*g,o}function pr(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]*e[3]}function Jt(o,e,r){var l=e[0],u=e[1],m=e[2],g=e[3];return o[0]=r[0]*l+r[4]*u+r[8]*m+r[12]*g,o[1]=r[1]*l+r[5]*u+r[9]*m+r[13]*g,o[2]=r[2]*l+r[6]*u+r[10]*m+r[14]*g,o[3]=r[3]*l+r[7]*u+r[11]*m+r[15]*g,o}function Or(){var o=new L(4);return L!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function sn(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Mn(o,e,r){r*=.5;var l=e[0],u=e[1],m=e[2],g=e[3],b=Math.sin(r),E=Math.cos(r);return o[0]=l*E+g*b,o[1]=u*E+m*b,o[2]=m*E-u*b,o[3]=g*E-l*b,o}function Gi(o,e,r){r*=.5;var l=e[0],u=e[1],m=e[2],g=e[3],b=Math.sin(r),E=Math.cos(r);return o[0]=l*E-m*b,o[1]=u*E+g*b,o[2]=m*E+l*b,o[3]=g*E-u*b,o}Rt(),Je();var yi,vt,or,dn=yr,Ln=(yi=Rt(),vt=Ut(1,0,0),or=Ut(0,1,0),function(o,e,r){var l=Hr(e,r);return l<-.999999?(Ur(yi,vt,e),Ke(yi)<1e-6&&Ur(yi,or,e),ir(yi,yi),(function(u,m,g){g*=.5;var b=Math.sin(g);u[0]=b*m[0],u[1]=b*m[1],u[2]=b*m[2],u[3]=Math.cos(g)})(o,yi,Math.PI),o):l>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Ur(yi,e,r),o[0]=yi[0],o[1]=yi[1],o[2]=yi[2],o[3]=1+l,dn(o,o))});function Bn(){var o=new L(2);return L!=Float32Array&&(o[0]=0,o[1]=0),o}function Ze(o,e){var r=new L(2);return r[0]=o,r[1]=e,r}function ur(o,e,r){return o[0]=e,o[1]=r,o}function kr(o,e,r){return o[0]=e[0]+r[0],o[1]=e[1]+r[1],o}function An(o,e,r){return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o}function ki(o,e,r){return o[0]=e[0]*r,o[1]=e[1]*r,o}function Yn(o){var e=o[0],r=o[1];return Math.sqrt(e*e+r*r)}function Ri(o,e){var r=e[0],l=e[1],u=r*r+l*l;return u>0&&(u=1/Math.sqrt(u)),o[0]=e[0]*u,o[1]=e[1]*u,o}function ui(o,e){return o[0]*e[0]+o[1]*e[1]}Or(),Or(),W();var _i,Ds,oo=An;function Is(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}Bn();var ao=(function(){if(Ds)return _i;function o(e,r,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=u}return Ds=1,_i=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<r)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=m/g}var b=0,E=1;for(l=e,u=0;u<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<r));u++)e>m?b=l:E=l,l=.5*(E-b)+b;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},_i})(),No=Is(ao);function Nt(o,e){this.x=o,this.y=e}function us(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(!us(o[r],e[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const r in o)if(!us(o[r],e[r]))return!1;return!0}return o===e}Nt.prototype={clone(){return new Nt(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,r=o.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),r=Math.sin(o),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround(o,e){const r=Math.cos(o),l=Math.sin(o),u=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Nt},Nt.convert=function(o){if(o instanceof Nt)return o;if(Array.isArray(o))return new Nt(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Nt(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const ks=Math.PI/180,fo=180/Math.PI;function vn(o){return o*ks}function $e(o){return o*fo}const ne=[[0,0],[1,0],[1,1],[0,1]];function ce(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,r=e*o;return 4*(o<.5?r:3*(o-e)+r-.75)}function be(o,e,r,l){const u=new No(o,e,r,l);return function(m){return u.solve(m)}}const De=be(.25,.1,.25,1);function Ee(o,e,r){return Math.min(r,Math.max(e,o))}function Fe(o,e,r){return(r=Ee((r-o)/(e-o),0,1))*r*(3-2*r)}function et(o,e,r){const l=r-e,u=((o-e)%l+l)%l+e;return u===e?r:u}function qe(o,e,r){if(!o.length)return r(null,[]);let l=o.length;const u=new Array(o.length);let m=null;o.forEach((g,b)=>{e(g,(E,A)=>{E&&(m=E),u[b]=A,--l===0&&r(m,u)})})}let fe=1;function Ve(){return fe++}function Xe(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function ct(o,e){o.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function tr(o,e,r){const l={};for(const u in o)l[u]=e.call(this,o[u],u,o);return l}function cr(o,e,r){const l={};for(const u in o)e.call(this,o[u],u,o)&&(l[u]=o[u]);return l}function Nr(o){return Array.isArray(o)?o.map(Nr):typeof o=="object"&&o?tr(o,Nr):o}function Ir(o,e){for(let r=0;r<o.length;r++)if(e.indexOf(o[r])>=0)return!0;return!1}const jr={};function Rr(o){jr[o]||(typeof console<"u"&&console.warn(o),jr[o]=!0)}function ni(o,e,r){return(r.y-o.y)*(e.x-o.x)>(e.y-o.y)*(r.x-o.x)}function $i(o){let e=0;for(let r,l,u=0,m=o.length,g=m-1;u<m;g=u++)r=o[u],l=o[g],e+=(l.x-r.x)*(r.y+l.y);return e}function rs([o,e,r]){const l=vn(e+90),u=vn(r);return{x:o*Math.cos(l)*Math.sin(u),y:o*Math.sin(l)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:r}}function Yi(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function Ii(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,u,m)=>{const g=u||m;return e[l]=!g||g.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let gn=null;function Ni(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function In(o,e,r,l){for(;e<r;){const u=e+r>>1;o[u]<l?e=u+1:r=u}return e}function di(o,e,r,l){for(;e<r;){const u=e+r>>1;o[u]<=l?e=u+1:r=u}return e}function Oi(o){return o>0?1/(1.001-o):1+o}function js(o){return o>0?1-1/(1.001-o):-o}function bs(o,e,r){return(o-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const Qi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Qi.API_URL)return null;try{const o=new URL(Qi.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function po(o){return Qi.API_URL_REGEX.test(o)}function Hi(o){return Qi.API_SPRITE_REGEX.test(o)}let ws,ra,Uo,lo,ot,br;function pn(){return ws==null&&(ws=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ws}const Vn={now:()=>lo!==void 0?lo:performance.now(),setNow(o){lo=o},restoreNow(){lo=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:r,height:l}=o;ot||(ot=document.createElement("canvas"));const u=ot.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>ot.width||l>ot.height)&&(ot.width=r,ot.height=l),u.clearRect(-e,-e,r+2*e,l+2*e),u.drawImage(o,0,0,r,l),u.getImageData(-e,-e,r+2*e,l+2*e)},resolveURL:o=>(ra||(ra=document.createElement("a")),ra.href=o,ra.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Uo==null&&(Uo=window.matchMedia("(prefers-reduced-motion: reduce)")),Uo.matches)},hasCanvasFingerprintNoise(){if(br!==void 0)return br;if(!pn())return br=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,o.width,o.height);r=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&r++!==l.data[u])return br=!0,!0;return br=!1,!1}};function $n(o,e){const r=o.indexOf("?");if(r<0)return`${o}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(o.slice(r));for(const u in e)l.set(u,e[u]);return`${o.slice(0,r)}?${l.toString()}`}function jo(o,e={persistentParams:[]}){const r=o.indexOf("?");if(r<0)return o;const l=new URLSearchParams,u=new URLSearchParams(o.slice(r));for(const g of e.persistentParams){const b=u.get(g);b&&l.set(g,b)}const m=l.toString();return`${o.slice(0,r)}${m.length>0?`?${m}`:""}`}const Il="mapbox-tiles";let eu=500,Rd=50;const Lu=["language","worldview","jobid"];let Rs,$o;function La(){try{return caches}catch{}}function Fs(){const o=La();o&&Rs==null&&(Rs=o.open(Il))}let _t=1/0;const Tr={supported:!1,testSupport:function(o){!Ei&&Gn&&(_s?Zs(o):an=o)}};let an,Gn,Ei=!1,_s=!1;const na=typeof self<"u"?self:{};function Zs(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Gn),o.isContextLost())return;Tr.supported=!0}catch{}o.deleteTexture(e),Ei=!0}na.document&&(Gn=na.document.createElement("img"),Gn.onload=function(){an&&Zs(an),an=null,_s=!0},Gn.onerror=function(){Ei=!0,an=null},Gn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qo);class Ql extends Error{constructor(e,r,l){r===401&&po(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const tu=Yi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Jl=function(o,e){if(!(/^file:/.test(r=o.url)||/^file:/.test(tu())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,u){const m=new AbortController,g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:tu(),referrerPolicy:l.referrerPolicy,signal:m.signal});let b=!1,E=!1;const A=(N=g.url).indexOf("sku=")>0&&po(N);var N;l.type==="json"&&g.headers.set("Accept","application/json");const j=(B,V,H)=>{if(E)return;if(B&&B.message!=="SecurityError"&&Rr(B.toString()),V&&H)return R(V);const Q=Date.now();fetch(g).then(K=>{if(K.ok){const re=A?K.clone():null;return R(K,re,Q)}return u(new Ql(K.statusText,K.status,l.url))}).catch(K=>{K.name!=="AbortError"&&u(new Error(`${K.message} ${l.url}`))})},R=(B,V,H)=>{(l.type==="arrayBuffer"?B.arrayBuffer():l.type==="json"?B.json():B.text()).then(Q=>{E||(V&&H&&(function(K,re,ae){if(Fs(),Rs==null)return;const ue=Ii(re.headers.get("Cache-Control")||"");if(ue["no-store"])return;const xe={status:re.status,statusText:re.statusText,headers:new Headers};re.headers.forEach((Pe,Ae)=>xe.headers.set(Ae,Pe)),ue["max-age"]&&xe.headers.set("Expires",new Date(ae+1e3*ue["max-age"]).toUTCString());const ye=xe.headers.get("Expires");if(!ye||new Date(ye).getTime()-ae<42e4)return;let Ie=jo(K.url,{persistentParams:Lu});if(re.status===206){const Pe=K.headers.get("Range");if(!Pe)return;xe.status=200,Ie=$n(Ie,{range:Pe})}(function(Pe,Ae){if($o===void 0)try{new Response(new ReadableStream),$o=!0}catch{$o=!1}$o?Ae(Pe.body):Pe.blob().then(Ae).catch(je=>Rr(je.message))})(re,Pe=>{const Ae=new Response((je=re.status)!==200&&je!==404&&[101,103,204,205,304].includes(je)?null:Pe,xe);var je;Fs(),Rs?.then(Oe=>Oe.put(Ie,Ae)).catch(Oe=>Rr(Oe.message))})})(g,V,H),b=!0,u(null,Q,B.headers))}).catch(Q=>{E||u(new Error(Q.message))})};return A?(function(B,V){if(Fs(),Rs==null)return V(null);Rs.then(H=>{let Q=jo(B.url,{persistentParams:Lu});const K=B.headers.get("Range");K&&(Q=$n(Q,{range:K})),H.match(Q).then(re=>{const ae=(function(ue){if(!ue)return!1;const xe=new Date(ue.headers.get("Expires")||0),ye=Ii(ue.headers.get("Cache-Control")||"");return Number(xe)>Date.now()&&!ye["no-cache"]})(re);H.delete(Q).catch(V),ae&&H.put(Q,re.clone()).catch(V),V(null,re,ae)}).catch(V)}).catch(V)})(g,j):j(null,null),{cancel:()=>{E=!0,b||m.abort()}}})(o,e);if(Yi(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var r;return(function(l,u){const m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const g in l.headers)m.setRequestHeader(g,l.headers[g]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{u(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(l.type==="json")try{g=JSON.parse(m.response)}catch(E){return u(E)}const b=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(E=>{const A=E.split(": "),N=A.shift(),j=A.join(": ");b.append(N,j)}),u(null,g,b)}else u(new Ql(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}})(o,e)},Uh=function(o,e){return Jl(Object.assign(o,{type:"arrayBuffer"}),e)};function $h(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const Du="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Dn,bc;Dn=[],bc=0;const op=function(o,e){if(Tr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),bc>=Qi.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Dn.push(m),m}bc++;let r=!1;const l=()=>{if(!r)for(r=!0,bc--;Dn.length&&bc<Qi.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Dn.shift(),{requestParameters:g,callback:b,cancelled:E}=m;E||(m.cancel=op(g,b).cancel)}},u=Uh(o,(m,g,b)=>{l(),m?e(m):g&&(self.createImageBitmap?(function(E,A){const N=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(N).then(j=>{A(null,j)}).catch(j=>{A(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(g,(E,A)=>e(E,A,b)):(function(E,A){const N=new Image;N.onload=()=>{A(null,N),URL.revokeObjectURL(N.src),N.onload=null,requestAnimationFrame(()=>{N.src=Du})},N.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(E)],{type:"image/png"});N.src=E.byteLength?URL.createObjectURL(j):Du})(g,(E,A)=>e(E,A,b)))});return{cancel:()=>{u.cancel(),l()}}};var zg,ap,ru,ec={exports:{}},Md={exports:{}},Pl={exports:{}},Cm=(function(){if(ru)return ec.exports;ru=1;var o=(zg||(zg=1,Md.exports=function(r,l){var u,m,g,b,E,A,N,j;for(m=r.length-(u=3&r.length),g=l,E=3432918353,A=461845907,j=0;j<m;)N=255&r.charCodeAt(j)|(255&r.charCodeAt(++j))<<8|(255&r.charCodeAt(++j))<<16|(255&r.charCodeAt(++j))<<24,++j,g=27492+(65535&(b=5*(65535&(g=(g^=N=(65535&(N=(N=(65535&N)*E+(((N>>>16)*E&65535)<<16)&4294967295)<<15|N>>>17))*A+(((N>>>16)*A&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+(((b>>>16)+58964&65535)<<16);switch(N=0,u){case 3:N^=(255&r.charCodeAt(j+2))<<16;case 2:N^=(255&r.charCodeAt(j+1))<<8;case 1:g^=N=(65535&(N=(N=(65535&(N^=255&r.charCodeAt(j)))*E+(((N>>>16)*E&65535)<<16)&4294967295)<<15|N>>>17))*A+(((N>>>16)*A&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Md.exports),e=(ap||(ap=1,Pl.exports=function(r,l){for(var u,m=r.length,g=l^m,b=0;m>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(b)|(255&r.charCodeAt(++b))<<8|(255&r.charCodeAt(++b))<<16|(255&r.charCodeAt(++b))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),m-=4,++b;switch(m){case 3:g^=(255&r.charCodeAt(b+2))<<16;case 2:g^=(255&r.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Pl.exports);return ec.exports=o,ec.exports.murmur3=o,ec.exports.murmur2=e,ec.exports})(),wc=Is(Cm);class tc{constructor(e,...r){Object.assign(this,r[0]||{}),this.type=e}}class nu extends tc{constructor(e,r={}){super("error",Object.assign({error:e},r))}}function qh(o,e,r){r[o]&&r[o].indexOf(e)!==-1||(r[o]=r[o]||[],r[o].push(e))}function iu(o,e,r){if(r&&r[o]){const l=r[o].indexOf(e);l!==-1&&r[o].splice(l,1)}}class Xs{on(e,r){return this._listeners=this._listeners||{},qh(e,r,this._listeners),this}off(e,r){return iu(e,r,this._listeners),iu(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},qh(e,r,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,r){const l=typeof e=="string"?new tc(e,r):e,u=l.type;if(this.listens(u)){l.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const E of m)E.call(this,l);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const E of g)iu(u,E,this._oneTimeListeners),E.call(this,l);const b=this._eventedParent;if(b){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,E),b.fire(l)}}else l instanceof nu&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class co{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new co(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,l]=e.split("");return new co({name:r,iconsetId:l})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return co.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Da,su={},Fg=(function(){if(Da)return su;Da=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function r(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function l(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function u(m,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?m+(g-m)*b*6:2*b<1?g:3*b<2?m+(g-m)*(2/3-b)*6:m}try{su.parseCSSColor=function(m){var g,b=m.replace(/ /g,"").toLowerCase();if(b in o)return o[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=b.indexOf("("),A=b.indexOf(")");if(E!==-1&&A+1===b.length){var N=b.substr(0,E),j=b.substr(E+1,A-(E+1)).split(","),R=1;switch(N){case"rgba":if(j.length!==4)return null;R=l(j.pop());case"rgb":return j.length!==3?null:[r(j[0]),r(j[1]),r(j[2]),R];case"hsla":if(j.length!==4)return null;R=l(j.pop());case"hsl":if(j.length!==3)return null;var B=(parseFloat(j[0])%360+360)%360/360,V=l(j[1]),H=l(j[2]),Q=H<=.5?H*(V+1):H+V-H*V,K=2*H-Q;return[e(255*u(K,Q,B+1/3)),e(255*u(K,Q,B)),e(255*u(K,Q,B-1/3)),R];default:return null}}return null}}catch{}return su})();class ii{constructor(e,r,l,u=1){this.r=e,this.g=r,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof ii)return e;if(typeof e!="string")return;const r=Fg.parseCSSColor(e);return r?new ii(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[e,r,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*l)},${u})`}toNonPremultipliedRenderColor(e){const{r,g:l,b:u,a:m}=this;return new Ld(e,r,l,u,m)}toPremultipliedRenderColor(e){const{r,g:l,b:u,a:m}=this;return new Wh(e,r*m,l*m,u*m,m)}clone(){return new ii(this.r,this.g,this.b,this.a)}}class Gh{constructor(e,r,l,u,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const b=e.image.height,E=b*b;this.premultiplied?(r=m===0?0:r/m*(b-1),l=m===0?0:l/m*(b-1),u=m===0?0:u/m*(b-1)):(r*=b-1,l*=b-1,u*=b-1),r=Math.max(0,Math.min(b-1,r)),l=Math.max(0,Math.min(b-1,l)),u=Math.max(0,Math.min(b-1,u));const A=Math.floor(r),N=Math.floor(l),j=Math.floor(u),R=Math.ceil(r),B=Math.ceil(l),V=Math.ceil(u),H=r-A,Q=l-N,K=u-j,re=e.image.data,ae=4*(A+N*E+j*b),ue=4*(A+N*E+V*b),xe=4*(A+B*E+j*b),ye=4*(A+B*E+V*b),Ie=4*(R+N*E+j*b),Pe=4*(R+N*E+V*b),Ae=4*(R+B*E+j*b),je=4*(R+B*E+V*b);this.r=$r($r($r(re[ae],re[ue],K),$r(re[xe],re[ye],K),Q),$r($r(re[Ie],re[Pe],K),$r(re[Ae],re[je],K),Q),H)/255*(this.premultiplied?m:1),this.g=$r($r($r(re[ae+1],re[ue+1],K),$r(re[xe+1],re[ye+1],K),Q),$r($r(re[Ie+1],re[Pe+1],K),$r(re[Ae+1],re[je+1],K),Q),H)/255*(this.premultiplied?m:1),this.b=$r($r($r(re[ae+2],re[ue+2],K),$r(re[xe+2],re[ye+2],K),Q),$r($r(re[Ie+2],re[Pe+2],K),$r(re[Ae+2],re[je+2],K),Q),H)/255*(this.premultiplied?m:1),this.a=m}else this.r=r,this.g=l,this.b=u,this.a=m}toArray(){const{r:e,g:r,b:l,a:u}=this;return[255*e,255*r,255*l,u]}toHslaArray(){let{r:e,g:r,b:l,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const V=1/u;e*=V,r*=V,l*=V}const m=Math.min(Math.max(e,0),1),g=Math.min(Math.max(r,0),1),b=Math.min(Math.max(l,0),1),E=Math.min(m,g,b),A=Math.max(m,g,b),N=A-E,j=.5*(E+A);if(N===0)return[0,0,100*j,u];const R=j>.5?N/(2-A-E):N/(A+E);let B;switch(A){case m:B=60*((g-b)/N+(g<b?6:0));break;case g:B=60*((b-m)/N+2);break;default:B=60*((m-g)/N+4)}return[B,100*R,100*j,u]}toArray01(){const{r:e,g:r,b:l,a:u}=this;return[e,r,l,u]}toArray01Scaled(e){const{r,g:l,b:u}=this;return[r*e,l*e,u*e]}toArray01Linear(){const{r:e,g:r,b:l,a:u}=this;return[Math.pow(e,2.2),Math.pow(r,2.2),Math.pow(l,2.2),u]}}class Ld extends Gh{constructor(e,r,l,u,m){super(e,r,l,u,m,!1)}}class Wh extends Gh{constructor(e,r,l,u,m){super(e,r,l,u,m,!0)}}function $r(o,e,r){return o*(1-r)+e*r}function Am(o,e,r){return o.map((l,u)=>$r(l,e[u],r))}ii.black=new ii(0,0,0,1),ii.white=new ii(1,1,1,1),ii.transparent=new ii(0,0,0,0),ii.red=new ii(1,0,0,1),ii.blue=new ii(0,0,1,1);var Ou=Object.freeze({__proto__:null,array:Am,color:function(o,e,r){return new ii($r(o.r,e.r,r),$r(o.g,e.g,r),$r(o.b,e.b,r),$r(o.a,e.a,r))},number:$r});class ia extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Dd{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,u]of r)this.bindings[l]=u}concat(e){return new Dd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const va={kind:"null"},Er={kind:"number"},si={kind:"string"},ei={kind:"boolean"},sa={kind:"color"},zu={kind:"object"},xi={kind:"value"},lp={kind:"collator"},Od={kind:"formatted"},Fu={kind:"resolvedImage"};function mo(o,e){return{kind:"array",itemType:o,N:e}}function Ss(o){if(o.kind==="array"){const e=Ss(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const S_=[va,Er,si,ei,sa,Od,zu,mo(xi),Fu];function Hh(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Hh(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const r of S_)if(!Hh(r,e))return null}}return`Expected ${Ss(o)} but found ${Ss(e)} instead.`}function cp(o,e){return e.some(r=>r.kind===o.kind)}function Zh(o,e){return e.some(r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o)}function up(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&up(o.itemType,e.itemType):o.kind===e.kind}class Im{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dp{constructor(e,r,l,u,m){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=l,this.fontStack=u,this.textColor=m}}class Go{constructor(e){this.sections=e}static fromString(e){return new Go([new dp(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Go?e:Go.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const u=r.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(r.text);const l={};r.fontStack&&(l["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(l["font-scale"]=r.scale),r.textColor&&(l["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class ba{constructor(e,r={}){this.id=co.from(e),this.params=r.params,this.sx=r.sx||1,this.sy=r.sy||1}toString(){return JSON.stringify(this)}static parse(e){let r,l,u,m;try{({id:r,params:l,sx:u,sy:m}=JSON.parse(e)||{})}catch{return null}return r?new ba(r,{params:l,sx:u,sy:m}):null}scaleSelf(e,r=e){return this.sx*=e,this.sy*=r,this}}class wa{constructor(e,r,l,u,m=!1){this.primaryId=co.from(e),this.primaryOptions=r,l&&(this.secondaryId=co.from(l)),this.secondaryOptions=u,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ba(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ba(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?wa.build({name:e}):e}static build(e,r,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new wa(e,l,r,u)}}function Xh(o,e,r,l){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,e,r,l]:[o,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sl(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof ii||o instanceof Im||o instanceof Go||o instanceof wa)return!0;if(Array.isArray(o)){for(const e of o)if(!sl(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!sl(o[e]))return!1;return!0}return!1}function Bs(o){if(o===null)return va;if(typeof o=="string")return si;if(typeof o=="boolean")return ei;if(typeof o=="number")return Er;if(o instanceof ii)return sa;if(o instanceof Im)return lp;if(o instanceof Go)return Od;if(o instanceof wa)return Fu;if(Array.isArray(o)){const e=o.length;let r;for(const l of o){const u=Bs(l);if(r){if(r===u)continue;r=xi;break}r=u}return mo(r||xi,e)}return zu}function kl(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Go||o instanceof wa||o instanceof ii?o.toString():JSON.stringify(o)}class rc{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!sl(e[1]))return r.error("invalid value");const l=e[1];let u=Bs(l);const m=r.expectedType;return u.kind!=="array"||u.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(u=m),new rc(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ii?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Go?this.value.serialize():this.value}}class Ms{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Sc={string:si,number:Er,boolean:ei,object:zu};class Jr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,u=1;const m=e[0];if(m==="array"){let b,E;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in Sc)||A==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);b=Sc[A],u++}else b=xi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],u++}l=mo(b,E)}else l=Sc[m];const g=[];for(;u<e.length;u++){const b=r.parse(e[u],u,xi);if(!b)return null;g.push(b)}return new Jr(l,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Hh(this.type,Bs(l)))return l;if(r===this.args.length-1)throw new Ms(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Ss(Bs(l))} but was expected to be of type ${Ss(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){r.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(l=>l.serialize()))}}class _r{constructor(e){this.type=Od,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const u=[];let m=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let E=null;if(b["font-scale"]&&(E=r.parseObjectValue(b["font-scale"],g,"font-scale",Er),!E))return null;let A=null;if(b["text-font"]&&(A=r.parseObjectValue(b["text-font"],g,"text-font",mo(si)),!A))return null;let N=null;if(b["text-color"]&&(N=r.parseObjectValue(b["text-color"],g,"text-color",sa),!N))return null;const j=u[u.length-1];j.scale=E,j.font=A,j.textColor=N}else{const E=r.parse(e[g],g,xi);if(!E)return null;const A=E.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:E,scale:null,font:null,textColor:null})}}return new _r(u)}evaluate(e){return new Go(this.sections.map(r=>{const l=r.content.evaluate(e);return up(Bs(l),Fu)?new dp("",l,null,null,null):new dp(kl(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const l={};r.scale&&(l["font-scale"]=r.scale.serialize()),r.font&&(l["text-font"]=r.font.serialize()),r.textColor&&(l["text-color"]=r.textColor.serialize()),e.push(l)}return e}}class zd{constructor(e,r,l,u){this._imageWarnHistory={},this.type=Fu,this.namePrimary=e,this.nameSecondary=r,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let l=1;const u=[];function m(){if(l<e.length){const b=r.parse(e[l],l++,si);return b?(u.push({image:b,options:{}}),!0):(r.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(l<e.length){const E=e[l];if((b=E)===null||typeof b!="object"||Array.isArray(b))return!0;const A=E.params,N=E.iconset,j=r.concat(l);if(!A&&!N)return l++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return j.error('Image options "params" should be an object'),!1;const R={},B=j.concat(void 0,"params");for(const V in A){if(!V)return B.error("Image parameter name should be non-empty"),!1;const H=B.concat(void 0,V).parse(A[V],void 0,sa,void 0,{typeAnnotation:"coerce"});if(!H)return!1;R[V]=H}u[u.length-1].options.params=R}if(N){if(typeof N!="object"||N.constructor!==Object)return j.error('Image options "iconset" should be an object'),!1;if(!N.id)return j.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=N}return l++,!0}var b;return!0}for(let b=0;b<2;b++)if(!m()||!g())return;return new zd(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,r){const l={};if(r){for(const u in r)if(r[u])try{l[u]=r[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=wa.build(r,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const m=u.getPrimary().id;if(u.available=e.availableImages.some(g=>co.isEqual(g,m)),u.available){const g=u.getSecondary()?u.getSecondary().id:null;g&&(u.available=e.availableImages.some(b=>co.isEqual(b,g)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const l={};if(r&&(l.iconset={id:r}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function Xr(o){return Fd(o)?"string":qr(o)?"number":Bu(o)?"boolean":Array.isArray(o)?"array":o===null?"null":hp(o)?"object":typeof o}function hp(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function Fd(o){return typeof o=="string"||o instanceof String}function qr(o){return typeof o=="number"||o instanceof Number}function Bu(o){return typeof o=="boolean"||o instanceof Boolean}const Vu={"to-boolean":ei,"to-color":sa,"to-number":Er,"to-string":si};class nc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0],u=[];let m=va;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);m=mo(r.expectedType.itemType,g)}else{if(!(g>0&&sl(e[1][0])))return null;m=mo(Bs(e[1][0]),g)}for(let b=0;b<g;b++){const E=e[1][b];let A;if(Array.isArray(E))A=r.parse(E,void 0,m.itemType);else{const N=Xr(E);if(N!==m.itemType.kind)return r.error(`Expected ${m.itemType.kind} but found ${N}.`);A=r.registry.literal.parse(["literal",E===void 0?null:E],r)}if(!A)return null;u.push(A)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");m=Vu[l];for(let g=1;g<e.length;g++){const b=r.parse(e[g],g,xi);if(!b)return null;u.push(b)}}return new nc(m,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,l;for(const u of this.args){if(r=u.evaluate(e),l=null,r instanceof ii)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Xh(r[0],r[1],r[2],r[3]),!l))return new ii(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ms(l||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Ms(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Go.fromString(kl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?wa.build(kl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):kl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new _r([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zd(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Kh=["Unknown","Point","LineString","Polygon"];class Bd{constructor(e,r,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Kh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ii.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class oa{constructor(e,r,l,u,m){this.name=e,this.type=r,this._evaluate=l,this.args=u,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const r=oa.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const l=e[0],u=oa.definitions[l];if(!u)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=[];let E=null,A=-1;for(const[N,j]of g){if(Array.isArray(N)&&N.length!==e.length-1)continue;b.push(N),A++,E=new au(r.registry,r.path,null,r.scope,void 0,r._scope,r.options,r.iconImageUseTheme);const R=[];let B=!1;for(let V=1;V<e.length;V++){const H=e[V],Q=Array.isArray(N)?N[V-1]:N.type,K=E.parse(H,1+R.length,Q);if(!K){B=!0;break}R.push(K)}if(!B)if(Array.isArray(N)&&N.length!==R.length)E.error(`Expected ${N.length} arguments, but found ${R.length} instead.`);else{for(let V=0;V<R.length;V++){const H=Array.isArray(N)?N[V]:N.type,Q=R[V];E.concat(V+1).checkSubtype(H,Q.type)}if(E.errors.length===0)return new oa(l,m,j,R,A)}}if(b.length===1)r.errors.push(...E.errors);else{const N=(b.length?b:g.map(([R])=>R)).map(Yh).join(" | "),j=[];for(let R=1;R<e.length;R++){const B=r.parse(e[R],1+j.length);if(!B)return null;j.push(Ss(B.type))}r.error(`Expected arguments of type ${N}, but found (${j.join(", ")}) instead.`)}return null}static register(e,r){oa.definitions=r;for(const l in r)e[l]=oa}}function Yh(o){return Array.isArray(o)?`(${o.map(Ss).join(", ")})`:`(${Ss(o.type)}...)`}class ol{constructor(e,r,l){this.type=lp,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?r.parse(!1,1,ei):r.parseObjectValue(l["case-sensitive"],1,"case-sensitive",ei);if(!u)return null;const m=l["diacritic-sensitive"]===void 0?r.parse(!1,1,ei):r.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",ei);if(!m)return null;let g=null;return l.locale&&(g=r.parseObjectValue(l.locale,1,"locale",si),!g)?null:new ol(u,m,g)}evaluate(e){return new Im(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Qh(o,e,r=0,l=o.length-1,u=Tc){for(;l>r;){if(l-r>600){const E=l-r+1,A=e-r+1,N=Math.log(E),j=.5*Math.exp(2*N/3),R=.5*Math.sqrt(N*j*(E-j)/E)*(A-E/2<0?-1:1);Qh(o,e,Math.max(r,Math.floor(e-A*j/E+R)),Math.min(l,Math.floor(e+(E-A)*j/E+R)),u)}const m=o[e];let g=r,b=l;for(Ha(o,r,e),u(o[l],m)>0&&Ha(o,r,l);g<b;){for(Ha(o,g,b),g++,b--;u(o[g],m)<0;)g++;for(;u(o[b],m)>0;)b--}u(o[r],m)===0?Ha(o,r,b):(b++,Ha(o,b,l)),b<=e&&(r=b+1),e<=b&&(l=b-1)}}function Ha(o,e,r){const l=o[e];o[e]=o[r],o[r]=l}function Tc(o,e){return o<e?-1:o>e?1:0}function T_(o){let e=0;for(let r,l,u=0,m=o.length,g=m-1;u<m;g=u++)r=o[u],l=o[g],e+=(l.x-r.x)*(r.y+l.y);return e}function Jh(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function ef(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function fp(o,e,r){const l=o[0]-e[0],u=o[1]-e[1],m=o[0]-r[0],g=o[1]-r[1];return l*g-m*u===0&&l*m<=0&&u*g<=0}function Bg(o,e,r){return e[1]>o[1]!=r[1]>o[1]&&o[0]<(r[0]-e[0])*(o[1]-e[1])/(r[1]-e[1])+e[0]}function Vs(o,e,r=!1){let l=!1;for(let u=0,m=e.length;u<m;u++){const g=e[u];for(let b=0,E=g.length,A=E-1;b<E;A=b++){const N=g[A],j=g[b];if(fp(o,N,j))return r;Bg(o,N,j)&&(l=!l)}}return l}function Vd(o,e,r,l){const u=l[0]-r[0],m=l[1]-r[1],g=(o[0]-r[0])*m-u*(o[1]-r[1]),b=(e[0]-r[0])*m-u*(e[1]-r[1]);return g>0&&b<0||g<0&&b>0}function tf(o,e,r,l){return(u=[l[0]-r[0],l[1]-r[1]])[0]*(m=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*m[0]!==0&&!(!Vd(o,e,r,l)||!Vd(r,l,o,e));var u,m}function Ud(o){const e=new Nt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Nt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of o[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),r.x<l.x&&(r.x=l.x),r.y<l.y&&(r.y=l.y);return{min:e,max:r}}const Ec=8192;function Vg(o,e){const r=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Ec),Math.round(l*u*Ec)]}function pp(o,e){for(let r=0;r<e.length;r++)if(Vs(o,e[r]))return!0;return!1}function E_(o,e,r){for(const l of r)for(let u=0,m=l.length,g=m-1;u<m;g=u++)if(tf(o,e,l[g],l[u]))return!0;return!1}function Pm(o,e){for(let r=0;r<o.length;++r)if(!Vs(o[r],e))return!1;for(let r=0;r<o.length-1;++r)if(E_(o[r],o[r+1],e))return!1;return!0}function $d(o,e){for(let r=0;r<e.length;r++)if(Pm(o,e[r]))return!0;return!1}function Nl(o,e,r){const l=[];for(let u=0;u<o.length;u++){const m=[];for(let g=0;g<o[u].length;g++){const b=Vg(o[u][g],r);Jh(e,b),m.push(b)}l.push(m)}return l}function qd(o,e,r){const l=[];for(let u=0;u<o.length;u++){const m=Nl(o[u],e,r);l.push(m)}return l}function mp(o,e,r,l){if(o[0]<r[0]||o[0]>r[2]){const u=.5*l;let m=o[0]-r[0]>u?-l:r[0]-o[0]>u?l:0;m===0&&(m=o[0]-r[2]>u?-l:r[2]-o[0]>u?l:0),o[0]+=m}Jh(e,o)}function rf(o,e,r,l){const u=Math.pow(2,l.z)*Ec,m=[l.x*Ec,l.y*Ec],g=[];if(!o)return g;for(const b of o)for(const E of b){const A=[E.x+m[0],E.y+m[1]];mp(A,e,r,u),g.push(A)}return g}function Gd(o,e,r,l){const u=Math.pow(2,l.z)*Ec,m=[l.x*Ec,l.y*Ec],g=[];if(!o)return g;for(const E of o){const A=[];for(const N of E){const j=[N.x+m[0],N.y+m[1]];Jh(e,j),A.push(j)}g.push(A)}if(e[2]-e[0]<=u/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of g)for(const A of E)mp(A,e,r,u)}var b;return g}class Za{constructor(e,r){this.type=ei,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(sl(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const m=l.features[u].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Za(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Za(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Za(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,l){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const b=Nl(l.coordinates,m,g),E=rf(r.geometry(),u,m,g);if(!ef(u,m))return!1;for(const A of E)if(!Vs(A,b))return!1}if(l.type==="MultiPolygon"){const b=qd(l.coordinates,m,g),E=rf(r.geometry(),u,m,g);if(!ef(u,m))return!1;for(const A of E)if(!pp(A,b))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,l){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const b=Nl(l.coordinates,m,g),E=Gd(r.geometry(),u,m,g);if(!ef(u,m))return!1;for(const A of E)if(!Pm(A,b))return!1}if(l.type==="MultiPolygon"){const b=qd(l.coordinates,m,g),E=Gd(r.geometry(),u,m,g);if(!ef(u,m))return!1;for(const A of E)if(!$d(A,b))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const aa={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},gp=1/298.257223563,Wd=gp*(2-gp),Uu=Math.PI/180;class $u{static fromTile(e,r,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),m=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Uu;return new $u(m,l)}static get units(){return aa}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!aa[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(aa).join(", ")}`);const l=6378.137*Uu*(r?aa[r]:1),u=Math.cos(e*Uu),m=1/(1-Wd*(1-u*u)),g=Math.sqrt(m);this.kx=l*g*u,this.ky=l*g*m*(1-Wd)}distance(e,r){const l=Oa(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,r){const l=Oa(r[0]-e[0])*this.kx;return Math.atan2(l,(r[1]-e[1])*this.ky)/Uu}destination(e,r,l){const u=l*Uu;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,l){return[e[0]+r/this.kx,e[1]+l/this.ky]}lineDistance(e){let r=0;for(let l=0;l<e.length-1;l++)r+=this.distance(e[l],e[l+1]);return r}area(e){let r=0;for(let l=0;l<e.length;l++){const u=e[l];for(let m=0,g=u.length,b=g-1;m<g;b=m++)r+=Oa(u[m][0]-u[b][0])*(u[m][1]+u[b][1])*(l?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let l=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){const m=e[u],g=e[u+1],b=this.distance(m,g);if(l+=b,l>r)return nf(m,g,(r-(l-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,r,l){let[u,m]=r,g=Oa(l[0]-u)*this.kx,b=(l[1]-m)*this.ky;if(g!==0||b!==0){const E=(Oa(e[0]-u)*this.kx*g+(e[1]-m)*this.ky*b)/(g*g+b*b);E>1?(u=l[0],m=l[1]):E>0&&(u+=g/this.kx*E,m+=b/this.ky*E)}return g=Oa(e[0]-u)*this.kx,b=(e[1]-m)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(e,r){let l=1/0,u=e[0][0],m=e[0][1],g=0,b=0;for(let E=0;E<e.length-1;E++){let A=e[E][0],N=e[E][1],j=Oa(e[E+1][0]-A)*this.kx,R=(e[E+1][1]-N)*this.ky,B=0;j===0&&R===0||(B=(Oa(r[0]-A)*this.kx*j+(r[1]-N)*this.ky*R)/(j*j+R*R),B>1?(A=e[E+1][0],N=e[E+1][1]):B>0&&(A+=j/this.kx*B,N+=R/this.ky*B)),j=Oa(r[0]-A)*this.kx,R=(r[1]-N)*this.ky;const V=j*j+R*R;V<l&&(l=V,u=A,m=N,g=E,b=B)}return{point:[u,m],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(e,r,l){let u=this.pointOnLine(l,e),m=this.pointOnLine(l,r);if(u.index>m.index||u.index===m.index&&u.t>m.t){const A=u;u=m,m=A}const g=[u.point],b=u.index+1,E=m.index;!yp(l[b],g[0])&&b<=E&&g.push(l[b]);for(let A=b+1;A<=E;A++)g.push(l[A]);return yp(l[E],m.point)||g.push(m.point),g}lineSliceAlong(e,r,l){let u=0;const m=[];for(let g=0;g<l.length-1;g++){const b=l[g],E=l[g+1],A=this.distance(b,E);if(u+=A,u>e&&m.length===0&&m.push(nf(b,E,(e-(u-A))/A)),u>=r)return m.push(nf(b,E,(r-(u-A))/A)),m;u>e&&m.push(E)}return m}bufferPoint(e,r){const l=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,r){const l=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,r){return Oa(e[0]-r[0])>=0&&Oa(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function yp(o,e){return o[0]===e[0]&&o[1]===e[1]}function nf(o,e,r){const l=Oa(e[0]-o[0]);return[o[0]+l*r,o[1]+(e[1]-o[1])*r]}function Oa(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Hd{constructor(e=[],r=(l,u)=>l<u?-1:l>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,u=r[e];for(;e>0;){const m=e-1>>1,g=r[m];if(l(u,g)>=0)break;r[e]=g,e=m}r[e]=u}_down(e){const{data:r,compare:l}=this,u=this.length>>1,m=r[e];for(;e<u;){let g=1+(e<<1);const b=g+1;if(b<this.length&&l(r[b],r[g])<0&&(g=b),l(r[g],m)>=0)break;r[e]=r[g],e=g}r[e]=m}}var qt=8192;function sf(o,e){return e.dist-o.dist}function of(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==o[r])return!1;return!0}function af(o){return o[1]-o[0]+1}function ic(o,e){const r=o[1]>=o[0]&&o[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function qu(o,e){if(o[0]>o[1])return[null,null];const r=af(o);if(e){if(r===2)return[o,null];const l=Math.floor(r/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}{if(r===1)return[o,null];const l=Math.floor(r/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}}function Gu(o,e){const r=[1/0,1/0,-1/0,-1/0];if(!ic(e,o.length))return r;for(let l=e[0];l<=e[1];++l)Jh(r,o[l]);return r}function ou(o){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<o.length;++r)for(let l=0;l<o[r].length;++l)Jh(e,o[r][l]);return e}function Cc(o,e,r){if(of(o)||of(e))return NaN;let l=0,u=0;return o[2]<e[0]&&(l=e[0]-o[2]),o[0]>e[2]&&(l=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),r.distance([0,0],[l,u])}function xs(o){return 360*o-180}function _p(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Wu(o,e){const r=Math.pow(2,e.z),l=(o.y/qt+e.y)/r;return[xs((o.x/qt+e.x)/r),_p(l)]}function lf(o,e){const r=[];for(let l=0;l<o.length;++l)r.push(Wu(o[l],e));return r}function km(o,e,r){const l=r.pointOnLine(e,o).point;return r.distance(o,l)}function cf(o,e,r,l,u){const m=r.slice(l[0],l[1]+1);let g=1/0;for(let b=e[0];b<=e[1];++b)if((g=Math.min(g,km(o[b],m,u)))===0)return 0;return g}function al(o,e,r,l,u){const m=Math.min(u.pointToSegmentDistance(o,r,l),u.pointToSegmentDistance(e,r,l)),g=Math.min(u.pointToSegmentDistance(r,o,e),u.pointToSegmentDistance(l,o,e));return Math.min(m,g)}function jn(o,e,r,l,u){if(!ic(e,o.length)||!ic(l,r.length))return NaN;let m=1/0;for(let g=e[0];g<e[1];++g)for(let b=l[0];b<l[1];++b){if(tf(o[g],o[g+1],r[b],r[b+1]))return 0;m=Math.min(m,al(o[g],o[g+1],r[b],r[b+1],u))}return m}function Zd(o,e,r,l,u){if(!ic(e,o.length)||!ic(l,r.length))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let b=l[0];b<=l[1];++b)if((m=Math.min(m,u.distance(o[g],r[b])))===0)return m;return m}function Ug(o,e,r){if(Vs(o,e,!0))return 0;let l=1/0;for(const u of e){const m=u.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[m-1]&&(l=Math.min(l,r.pointToSegmentDistance(o,u[m-1],u[0])))===0||(l=Math.min(l,km(o,u,r)))===0)return l}return l}function C_(o,e,r,l){if(!ic(e,o.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Vs(o[m],r,!0))return 0;let u=1/0;for(let m=e[0];m<e[1];++m)for(const g of r)for(let b=0,E=g.length,A=E-1;b<E;A=b++){if(tf(o[m],o[m+1],g[A],g[b]))return 0;u=Math.min(u,al(o[m],o[m+1],g[A],g[b],l))}return u}function Nm(o,e){for(const r of o)for(let l=0;l<=r.length-1;++l)if(Vs(r[l],e,!0))return!0;return!1}function $g(o,e,r,l=1/0){const u=ou(o),m=ou(e);if(l!==1/0&&Cc(u,m,r)>=l)return l;if(ef(u,m)){if(Nm(o,e))return 0}else if(Nm(e,o))return 0;let g=l;for(const b of o)for(let E=0,A=b.length,N=A-1;E<A;N=E++)for(const j of e)for(let R=0,B=j.length,V=B-1;R<B;V=R++){if(tf(b[N],b[E],j[V],j[R]))return 0;g=Math.min(g,al(b[N],b[E],j[V],j[R],r))}return g}function Mi(o,e,r,l,u,m,g){if(m===null||g===null)return;const b=Cc(Gu(l,m),Gu(u,g),r);b<e&&o.push({dist:b,range1:m,range2:g})}function xp(o,e,r,l,u=1/0){let m=Math.min(l.distance(o[0],r[0][0]),u);if(m===0)return m;const g=new Hd([{dist:0,range1:[0,o.length-1],range2:[0,0]}],sf),b=e?50:100,E=ou(r);for(;g.length;){const A=g.pop();if(A.dist>=m)continue;const N=A.range1;if(af(N)<=b){if(!ic(N,o.length))return NaN;if(e){const j=C_(o,N,r,l);if((m=Math.min(m,j))===0)return m}else for(let j=N[0];j<=N[1];++j){const R=Ug(o[j],r,l);if((m=Math.min(m,R))===0)return m}}else{const j=qu(N,e);if(j[0]!==null){const R=Cc(Gu(o,j[0]),E,l);R<m&&g.push({dist:R,range1:j[0],range2:[0,0]})}if(j[1]!==null){const R=Cc(Gu(o,j[1]),E,l);R<m&&g.push({dist:R,range1:j[1],range2:[0,0]})}}}return m}function vp(o,e,r,l,u,m=1/0){let g=Math.min(m,u.distance(o[0],r[0]));if(g===0)return g;const b=new Hd([{dist:0,range1:[0,o.length-1],range2:[0,r.length-1]}],sf),E=e?50:100,A=l?50:100;for(;b.length;){const N=b.pop();if(N.dist>=g)continue;const j=N.range1,R=N.range2;if(af(j)<=E&&af(R)<=A){if(!ic(j,o.length)||!ic(R,r.length))return NaN;if(e&&l?g=Math.min(g,jn(o,j,r,R,u)):e||l?e&&!l?g=Math.min(g,cf(r,R,o,j,u)):!e&&l&&(g=Math.min(g,cf(o,j,r,R,u))):g=Math.min(g,Zd(o,j,r,R,u)),g===0)return g}else{const B=qu(j,e),V=qu(R,l);Mi(b,g,u,o,r,B[0],V[0]),Mi(b,g,u,o,r,B[0],V[1]),Mi(b,g,u,o,r,B[1],V[0]),Mi(b,g,u,o,r,B[1],V[1])}}return g}function uf(o,e,r,l,u=1/0){let m=u;const g=Gu(o,[0,o.length-1]);for(const b of r)if(!(m!==1/0&&Cc(g,Gu(b,[0,b.length-1]),l)>=m)&&(m=Math.min(m,vp(o,e,b,!0,l,m)),m===0))return m;return m}function Xd(o,e,r,l,u=1/0){let m=u;const g=Gu(o,[0,o.length-1]);for(const b of r){if(m!==1/0&&Cc(g,ou(b),l)>=m)continue;const E=xp(o,e,b,l,m);if(isNaN(E))return E;if((m=Math.min(m,E))===0)return m}return m}function df(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Hu{constructor(e,r){this.type=Er,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(sl(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(df(l.features[u].geometry.type))return new Hu(l,l.features[u].geometry)}else if(l.type==="Feature"){if(df(l.geometry.type))return new Hu(l,l.geometry)}else if(df(l.type))return new Hu(l,l)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),l=e.canonicalID();if(r!=null&&l!=null){if(e.geometryType()==="Point")return(function(u,m,g){const b=[];for(const A of u)for(const N of A)b.push(Wu(N,m));const E=new $u(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?vp(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",E):g.type==="MultiLineString"?uf(b,!1,g.coordinates,E):g.type==="Polygon"||g.type==="MultiPolygon"?Xd(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,E):null})(r,l,this.geometries);if(e.geometryType()==="LineString")return(function(u,m,g){const b=[];for(const A of u){const N=[];for(const j of A)N.push(Wu(j,m));b.push(N)}const E=new $u(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return uf(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,E);if(g.type==="MultiLineString"){let A=1/0;for(let N=0;N<g.coordinates.length;N++){const j=uf(g.coordinates[N],!0,b,E,A);if(isNaN(j))return j;if((A=Math.min(A,j))===0)return A}return A}if(g.type==="Polygon"||g.type==="MultiPolygon"){let A=1/0;for(let N=0;N<b.length;N++){const j=Xd(b[N],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,E,A);if(isNaN(j))return j;if((A=Math.min(A,j))===0)return A}return A}return null})(r,l,this.geometries);if(e.geometryType()==="Polygon")return(function(u,m,g){const b=[];for(const A of(function(N){const j=N.length;if(j<=1)return[N];const R=[];let B,V;for(let H=0;H<j;H++){const Q=T_(N[H]);Q!==0&&(N[H].area=Math.abs(Q),V===void 0&&(V=Q<0),V===Q<0?(B&&R.push(B),B=[N[H]]):B.push(N[H]))}return B&&R.push(B),R})(u)){const N=[];for(let j=0;j<A.length;++j)N.push(lf(A[j],m));b.push(N)}const E=new $u(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Xd(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,E);if(g.type==="MultiLineString"){let A=1/0;for(let N=0;N<g.coordinates.length;N++){const j=Xd(g.coordinates[N],!0,b,E,A);if(isNaN(j))return j;if((A=Math.min(A,j))===0)return A}return A}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(A,N,j){let R=1/0;for(const B of A)for(const V of N){const H=$g(B,V,j,R);if(isNaN(H))return H;if((R=Math.min(R,H))===0)return R}return R})(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,E):null})(r,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Zu(o){if(o instanceof oa&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Za||o instanceof Hu)return!1;if(o instanceof jl)return o.featureConstant;let e=!0;return o.eachChild(r=>{e&&!Zu(r)&&(e=!1)}),e}function hf(o){if(o instanceof oa&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(r=>{e&&!hf(r)&&(e=!1)}),e}function Kd(o,e){if(o instanceof oa&&e.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild(l=>{r&&!Kd(l,e)&&(r=!1)}),r}function bp(o,e,r){return[o,e,r].filter(Boolean).join("")}function sc(o,e){switch(o){case"string":return kl(e);case"number":return+e;case"boolean":return!!e;case"color":return ii.parse(e);case"formatted":return Go.fromString(kl(e));case"resolvedImage":return wa.build(kl(e))}return e}function jm(o,e,r,l){return l!==void 0&&(o=l*Math.round(o/l)),e!==void 0&&o<e&&(o=e),r!==void 0&&o>r&&(o=r),o}class jl{constructor(e,r,l,u=!1){this.type=e,this.key=r,this.scope=l,this.featureConstant=u}static parse(e,r){let l=r.expectedType;if(l==null&&(l=xi),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const u=r.parse(e[1],1);if(!(u instanceof rc))return r.error("Key name of 'config' expression must be a string literal.");let m,g=!0;const b=kl(u.value);if(e.length>=3){const E=r.parse(e[2],2);if(!(E instanceof rc))return r.error("Scope of 'config' expression must be a string literal.");m=kl(E.value)}if(r.options){const E=bp(b,m,r._scope),A=r.options.get(E);A&&(g=Zu(A.value||A.default))}return new jl(l,b,m,g)}evaluate(e){const r=bp(this.key,this.scope,e.scope),l=e.getConfig(r);if(!l)return null;const{type:u,value:m,values:g,minValue:b,maxValue:E,stepValue:A}=l,N=l.default.evaluate(e);let j=N;if(m){const R=e.scope;e.scope=(R||"").split("").slice(1).join(""),j=m.evaluate(e),e.scope=R}return u&&(j=sc(u,j)),j===void 0||b===void 0&&E===void 0&&A===void 0||(typeof j=="number"?j=jm(j,b,E,A):Array.isArray(j)&&(j=j.map(R=>typeof R=="number"?jm(R,b,E,A):R))),m!==void 0&&j!==void 0&&g&&!g.includes(j)&&(j=N,u&&(j=sc(u,j))),(u&&u!==this.type||j!==void 0&&!up(Bs(j),this.type))&&(j=sc(this.type.kind,j)),j}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Xa{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new Xa(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class au{constructor(e,r=[],l,u=new Dd,m=[],g,b,E){this.registry=e,this.path=r,this.key=r.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=u,this.errors=m,this.expectedType=l,this._scope=g,this.options=b,this.iconImageUseTheme=E}parse(e,r,l,u,m={}){return r||l?this.concat(r,null,l,u)._parse(e,m):this._parse(e,m)}parseObjectValue(e,r,l,u,m,g={}){return this.concat(r,l,u,m)._parse(e,g)}_parse(e,r){function l(u,m,g){return g==="assert"?new Jr(m,[u]):g==="coerce"?new nc(m,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let m=u.parse(e,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,b=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else m=l(m,g,r.typeAnnotation||"coerce");else m=l(m,g,r.typeAnnotation||"assert")}if(!(m instanceof rc)&&m.type.kind!=="resolvedImage"&&Rl(m)){const g=new Bd(this._scope,this.options,this.iconImageUseTheme);try{m=new rc(m.type,m.evaluate(g))}catch(b){return this.error(b.message),null}}return m}return nc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l,u){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof r=="string"?m.concat(r):m;const g=u?this.scope.concat(u):this.scope;return new au(this.registry,m,l||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...r){const l=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new ia(l,e))}checkSubtype(e,r){const l=Hh(e,r);return l&&this.error(l),l}}function Rl(o){if(o instanceof Xa)return Rl(o.boundExpression);if(o instanceof oa&&o.name==="error"||o instanceof ol||o instanceof Za||o instanceof Hu||o instanceof jl)return!1;const e=o instanceof nc||o instanceof Jr;let r=!0;return o.eachChild(l=>{r=e?r&&Rl(l):r&&l instanceof rc}),!!r&&Zu(o)&&Kd(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Yd(o,e){const r=o.length-1;let l,u,m=0,g=r,b=0;for(;m<=g;)if(b=Math.floor((m+g)/2),l=o[b],u=o[b+1],l<=e){if(b===r||e<u)return b;m=b+1}else{if(!(l>e))throw new Ms("Input is not a number.");g=b-1}return 0}class ff{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,m]of l)this.labels.push(u),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,Er);if(!l)return null;const u=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],E=e[g+1],A=g,N=g+1;if(typeof b!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(u.length&&u[u.length-1][0]>=b)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const j=r.parse(E,N,m);if(!j)return null;m=m||j.type,u.push([b,j])}return new ff(m,l,u)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return l[0].evaluate(e);const m=r.length;return u>=r[m-1]?l[m-1].evaluate(e):l[Yd(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const qg=.95047,lu=1.08883,Qd=4/29,Ml=6/29,pf=3*Ml*Ml,Rm=Ml*Ml*Ml,Jd=Math.PI/180,cu=180/Math.PI;function Ts(o){return o>Rm?Math.pow(o,1/3):o/pf+Qd}function vs(o){return o>Ml?o*o*o:pf*(o-Qd)}function oc(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Ro(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Sa(o){const e=Ro(o.r),r=Ro(o.g),l=Ro(o.b),u=Ts((.4124564*e+.3575761*r+.1804375*l)/qg),m=Ts((.2126729*e+.7151522*r+.072175*l)/1);return{l:116*m-16,a:500*(u-m),b:200*(m-Ts((.0193339*e+.119192*r+.9503041*l)/lu)),alpha:o.a}}function ac(o){let e=(o.l+16)/116,r=isNaN(o.a)?e:e+o.a/500,l=isNaN(o.b)?e:e-o.b/200;return e=1*vs(e),r=qg*vs(r),l=lu*vs(l),new ii(oc(3.2404542*r-1.5371385*e-.4985314*l),oc(-.969266*r+1.8760108*e+.041556*l),oc(.0556434*r-.2040259*e+1.0572252*l),o.alpha)}function Ac(o,e,r){const l=e-o;return o+r*(l>180||l<-180?l-360*Math.round(l/360):l)}const go={forward:Sa,reverse:ac,interpolate:function(o,e,r){return{l:$r(o.l,e.l,r),a:$r(o.a,e.a,r),b:$r(o.b,e.b,r),alpha:$r(o.alpha,e.alpha,r)}}},uu={forward:function(o){const{l:e,a:r,b:l}=Sa(o),u=Math.atan2(l,r)*cu;return{h:u<0?u+360:u,c:Math.sqrt(r*r+l*l),l:e,alpha:o.a}},reverse:function(o){const e=o.h*Jd,r=o.c;return ac({l:o.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:o.alpha})},interpolate:function(o,e,r){return{h:Ac(o.h,e.h,r),c:$r(o.c,e.c,r),l:$r(o.l,e.l,r),alpha:$r(o.alpha,e.alpha,r)}}};var Mm=Object.freeze({__proto__:null,hcl:uu,lab:go});class za{constructor(e,r,l,u,m){this.type=e,this.operator=r,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[g,b]of m)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,r,l,u){let m=0;if(e.name==="exponential")m=Xu(r,e.base,l,u);else if(e.name==="linear")m=Xu(r,1,l,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new No(g[0],g[1],g[2],g[3]).solve(Xu(r,1,l,u))}return m}static parse(e,r){let[l,u,m,...g]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const A=u[1];if(typeof A!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:A}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const A=u.slice(1);if(A.length!==4||A.some(N=>typeof N!="number"||N<0||N>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,Er),!m)return null;const b=[];let E=null;l==="interpolate-hcl"||l==="interpolate-lab"?E=sa:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let A=0;A<g.length;A+=2){const N=g[A],j=g[A+1],R=A+3,B=A+4;if(typeof N!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(b.length&&b[b.length-1][0]>=N)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=r.parse(j,B,E);if(!V)return null;E=E||V.type,b.push([N,V])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new za(E,l,u,m,b):r.error(`Type ${Ss(E)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return l[0].evaluate(e);const m=r.length;if(u>=r[m-1])return l[m-1].evaluate(e);const g=Yd(r,u),b=za.interpolationFactor(this.interpolation,u,r[g],r[g+1]),E=l[g].evaluate(e),A=l[g+1].evaluate(e);return this.operator==="interpolate"?Ou[this.type.kind.toLowerCase()](E,A,b):this.operator==="interpolate-hcl"?uu.reverse(uu.interpolate(uu.forward(E),uu.forward(A),b)):go.reverse(go.interpolate(go.forward(E),go.forward(A),b))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)r.push(this.labels[l],this.outputs[l].serialize());return r}}function Xu(o,e,r,l){const u=l-r,m=o-r;return u===0?0:e===1?m/u:(Math.pow(e,m)-1)/(Math.pow(e,u)-1)}class eh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const u=r.expectedType;u&&u.kind!=="value"&&(l=u);const m=[];for(const b of e.slice(1)){const E=r.parse(b,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,m.push(E)}const g=u&&m.some(b=>Hh(u,b.type));return new eh(g?xi:l,m)}evaluate(e){let r,l=null,u=0;for(const m of this.args){if(u++,l=m.evaluate(e),l&&l instanceof wa&&!l.available&&(r||(r=l),l=null,u===this.args.length))return r;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Wo{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=r.parse(e[m+1],m+1);if(!b)return null;l.push([g,b])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return u?new Wo(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,l]of this.bindings)e.push(r,l.serialize());return e.push(this.result.serialize()),e}}class Ku{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Er),u=r.parse(e[2],2,mo(r.expectedType||xi));return l&&u?new Ku(u.type.itemType,l,u):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Ms("Array index out of bounds: negative index");if(r>=l.length)throw new Ms("Array index out of bounds: index exceeds array size");if(r!==Math.floor(r))throw new Ms("Array index must be an integer. Use at-interpolated for fractional indices");return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class th{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Er),u=r.parse(e[2],2,mo(r.expectedType||xi));return l&&u?new th(u.type.itemType,l,u):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Ms(`Array index out of bounds: ${r} < 0.`);if(r>l.length-1)throw new Ms(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r===Math.floor(r))return l[r];const u=Math.floor(r),m=Math.ceil(r),g=l[u],b=l[m];if(typeof g!="number"||typeof b!="number")throw new Ms(`Cannot interpolate between non-number values at index ${r}.`);const E=r-u;return g*(1-E)+b*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class wp{constructor(e,r){this.type=ei,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,xi),u=r.parse(e[2],2,xi);return l&&u?cp(l.type,[ei,si,Er,va,xi])?new wp(l,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ss(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Zh(r,["boolean","string","number","null"]))throw new Ms(`Expected first argument to be of type boolean, string, number or null, but found ${Ss(Bs(r))} instead.`);if(!Zh(l,["string","array"]))throw new Ms(`Expected second argument to be of type array or string, but found ${Ss(Bs(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class rh{constructor(e,r,l){this.type=Er,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,xi),u=r.parse(e[2],2,xi);if(!l||!u)return null;if(!cp(l.type,[ei,si,Er,va,xi]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ss(l.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Er);return m?new rh(l,u,m):null}return new rh(l,u)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Zh(r,["boolean","string","number","null"]))throw new Ms(`Expected first argument to be of type boolean, string, number or null, but found ${Ss(Bs(r))} instead.`);if(!Zh(l,["string","array"]))throw new Ms(`Expected second argument to be of type array or string, but found ${Ss(Bs(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(r,u)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ll{constructor(e,r,l,u,m,g){this.inputType=e,this.type=r,this.input=l,this.cases=u,this.outputs=m,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const m={},g=[];for(let A=2;A<e.length-1;A+=2){let N=e[A];const j=e[A+1];Array.isArray(N)||(N=[N]);const R=r.concat(A);if(N.length===0)return R.error("Expected at least one branch label.");for(const V of N){if(typeof V!="number"&&typeof V!="string")return R.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(l){if(R.checkSubtype(l,Bs(V)))return null}else l=Bs(V);if(m[String(V)]!==void 0)return R.error("Branch labels must be unique.");m[String(V)]=g.length}const B=r.parse(j,A,u);if(!B)return null;u=u||B.type,g.push(B)}const b=r.parse(e[1],1,xi);if(!b)return null;const E=r.parse(e[e.length-1],e.length-1,u);return E?b.type.kind!=="value"&&r.concat(1).checkSubtype(l,b.type)?null:new ll(l,u,b,m,g,E):null}evaluate(e){const r=this.input.evaluate(e);return(up(Bs(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),l=[],u={};for(const g of r){const b=u[this.cases[g]];b===void 0?(u[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[b][1].push(g)}const m=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of l)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class lc{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const b=r.parse(e[g],g,ei);if(!b)return null;const E=r.parse(e[g+1],g+1,l);if(!E)return null;u.push([b,E]),l=l||E.type}const m=r.parse(e[e.length-1],e.length-1,l);return m?new lc(l,u,m):null}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ic{constructor(e,r,l,u){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,xi),u=r.parse(e[2],2,Er);if(!l||!u)return null;if(!cp(l.type,[mo(xi),si,xi]))return r.error(`Expected first argument to be of type array or string, but found ${Ss(l.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Er);return m?new Ic(l.type,l,u,m):null}return new Ic(l.type,l,u)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Zh(r,["string","array"]))throw new Ms(`Expected first argument to be of type array or string, but found ${Ss(Bs(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(l,u)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class nh{constructor(e,r){this.type=mo(si),this.str=e,this.delimiter=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,si),u=r.parse(e[2],2,si);return l&&u?new nh(l,u):void 0}evaluate(e){const r=this.str.evaluate(e),l=this.delimiter.evaluate(e);return r.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function ih(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Fa(o,e,r,l){return l.compare(e,r)===0}function Ho(o,e,r){const l=o!=="=="&&o!=="!=";return class Tz{constructor(m,g,b){this.type=ei,this.lhs=m,this.rhs=g,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const b=m[0];let E=g.parse(m[1],1,xi);if(!E)return null;if(!ih(b,E.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Ss(E.type)}'.`);let A=g.parse(m[2],2,xi);if(!A)return null;if(!ih(b,A.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Ss(A.type)}'.`);if(E.type.kind!==A.type.kind&&E.type.kind!=="value"&&A.type.kind!=="value")return g.error(`Cannot compare types '${Ss(E.type)}' and '${Ss(A.type)}'.`);l&&(E.type.kind==="value"&&A.type.kind!=="value"?E=new Jr(A.type,[E]):E.type.kind!=="value"&&A.type.kind==="value"&&(A=new Jr(E.type,[A])));let N=null;if(m.length===4){if(E.type.kind!=="string"&&A.type.kind!=="string"&&E.type.kind!=="value"&&A.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(N=g.parse(m[3],3,lp),!N)return null}return new Tz(E,A,N)}evaluate(m){const g=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const E=Bs(g),A=Bs(b);if(E.kind!==A.kind||E.kind!=="string"&&E.kind!=="number")throw new Ms(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${A.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=Bs(g),A=Bs(b);if(E.kind!=="string"||A.kind!=="string")return e(m,g,b)}return this.collator?r(m,g,b,this.collator.evaluate(m)):e(m,g,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const Yu=Ho("==",function(o,e,r){return e===r},Fa),Pc=Ho("!=",function(o,e,r){return e!==r},function(o,e,r,l){return!Fa(0,e,r,l)}),cc=Ho("<",function(o,e,r){return e<r},function(o,e,r,l){return l.compare(e,r)<0}),du=Ho(">",function(o,e,r){return e>r},function(o,e,r,l){return l.compare(e,r)>0}),mf=Ho("<=",function(o,e,r){return e<=r},function(o,e,r,l){return l.compare(e,r)<=0}),Lm=Ho(">=",function(o,e,r){return e>=r},function(o,e,r,l){return l.compare(e,r)>=0});class sh{constructor(e,r,l,u,m,g){this.type=si,this.number=e,this.locale=r,this.currency=l,this.unit=u,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,Er);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=r.parseObjectValue(u.locale,2,"locale",si),!m))return null;let g=null;if(u.currency&&(g=r.parseObjectValue(u.currency,2,"currency",si),!g))return null;let b=null;if(u.unit&&(b=r.parseObjectValue(u.unit,2,"unit",si),!b))return null;let E=null;if(u["min-fraction-digits"]&&(E=r.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Er),!E))return null;let A=null;return u["max-fraction-digits"]&&(A=r.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Er),!A)?null:new sh(l,m,g,b,E,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ta{constructor(e){this.type=Er,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ss(l.type)} instead.`):new Ta(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ms(`Expected value to be of type string or array, but found ${Ss(Bs(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Ba(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ds={"==":Yu,"!=":Pc,">":du,"<":cc,">=":Lm,"<=":mf,array:Jr,at:Ku,"at-interpolated":th,boolean:Jr,case:lc,coalesce:eh,collator:ol,format:_r,image:zd,in:wp,"index-of":rh,interpolate:za,"interpolate-hcl":za,"interpolate-lab":za,length:Ta,let:Wo,literal:rc,match:ll,number:Jr,"number-format":sh,object:Jr,slice:Ic,step:ff,string:Jr,"to-boolean":nc,"to-color":nc,"to-number":nc,"to-string":nc,var:Xa,within:Za,distance:Hu,config:jl,split:nh};function Ka(o,[e,r,l,u]){e=e.evaluate(o),r=r.evaluate(o),l=l.evaluate(o);const m=u?u.evaluate(o):1,g=Xh(e,r,l,m);if(g)throw new Ms(g);return new ii(e/255,r/255,l/255,m)}function Dm(o,[e,r,l,u]){e=e.evaluate(o),r=r.evaluate(o),l=l.evaluate(o);const m=u?u.evaluate(o):1,g=(function(A,N,j,R){return typeof A=="number"&&A>=0&&A<=360?typeof N=="number"&&N>=0&&N<=100&&typeof j=="number"&&j>=0&&j<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[A,N,j,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[A,N,j,R]:[A,N,j]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[A,N,j,R]:[A,N,j]).join(", ")}]: 'h' must be between 0 and 360.`})(e,r,l,m);if(g)throw new Ms(g);const b=`hsla(${e}, ${r}%, ${l}%, ${m})`,E=ii.parse(b);if(!E)throw new Ms(`Failed to parse HSLA color: ${b}`);return E}function Om(o,e){return o in e}function gf(o,e){const r=e[o];return r===void 0?null:r}function uc(o){return{type:o}}function hu(o){if(o instanceof jl)return new Set([o.key]);let e=new Set;return o.eachChild(r=>{e=new Set([...e,...hu(r)])}),e}function Qu(o){if(o instanceof oa&&o.name==="is-active-floor")return!0;let e=!1;return o.eachChild(r=>{!e&&Qu(r)&&(e=!0)}),e}function zm(o){return{result:"success",value:o}}function Ya(o){return{result:"error",value:o}}function yf(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Sp(o){return o["property-type"]==="data-driven"}function Ju(o){return yf(o.expression,"measure-light")}function _f(o){return yf(o.expression,"zoom")}function Tp(o){return!!o.expression&&o.expression.interpolated}function xf(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function ed(o){return o}function Ep(o,e){const r=e.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",u=l||!(l||o.property!==void 0),m=o.type||(Tp(e)?"exponential":"interval");if(r&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map(A=>[A[0],ii.parse(A[1])])),o.default=ii.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Mm[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let g,b,E;if(m==="exponential")g=Cp;else if(m==="interval")g=oh;else if(m==="categorical"){g=kc,b=Object.create(null);for(const A of o.stops)b[A[0]]=A[1];E=typeof o.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=Fm}if(l){const A={},N=[];for(let B=0;B<o.stops.length;B++){const V=o.stops[B],H=V[0].zoom;A[H]===void 0&&(A[H]={zoom:H,type:o.type,property:o.property,default:o.default,stops:[]},N.push(H)),A[H].stops.push([V[0].value,V[1]])}const j=[];for(const B of N)j.push([A[B].zoom,Ep(A[B],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:za.interpolationFactor.bind(void 0,R),zoomStops:j.map(B=>B[0]),evaluate:({zoom:B},V)=>Cp({stops:j,base:o.base},e,B).evaluate(B,V)}}if(u){const A=m==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:za.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map(N=>N[0]),evaluate:({zoom:N})=>g(o,e,N,b,E)}}return{kind:"source",evaluate(A,N){const j=N&&N.properties?N.properties[o.property]:void 0;return j===void 0?fu(o.default,e.default):g(o,e,j,b,E)}}}function fu(o,e,r){return o!==void 0?o:e!==void 0?e:r!==void 0?r:void 0}function kc(o,e,r,l,u){return fu(typeof r===u?l[r]:void 0,o.default,e.default)}function oh(o,e,r){if(!qr(r))return fu(o.default,e.default);const l=o.stops.length;if(l===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[l-1][0])return o.stops[l-1][1];const u=Yd(o.stops.map(m=>m[0]),r);return o.stops[u][1]}function Cp(o,e,r){const l=o.base!==void 0?o.base:1;if(!qr(r))return fu(o.default,e.default);const u=o.stops.length;if(u===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[u-1][0])return o.stops[u-1][1];const m=Yd(o.stops.map(N=>N[0]),r),g=(function(N,j,R,B){const V=B-R,H=N-R;return V===0?0:j===1?H/V:(Math.pow(j,H)-1)/(Math.pow(j,V)-1)})(r,l,o.stops[m][0],o.stops[m+1][0]),b=o.stops[m][1],E=o.stops[m+1][1];let A=Ou[e.type]||ed;if(o.colorSpace&&o.colorSpace!=="rgb"){const N=Mm[o.colorSpace];A=(j,R)=>N.reverse(N.interpolate(N.forward(j),N.forward(R),g))}return typeof b.evaluate=="function"?{evaluate(...N){const j=b.evaluate.apply(void 0,N),R=E.evaluate.apply(void 0,N);if(j!==void 0&&R!==void 0)return A(j,R,g)}}:A(b,E,g)}function Fm(o,e,r){return e.type==="color"?r=ii.parse(r):e.type==="formatted"?r=Go.fromString(r.toString()):e.type==="resolvedImage"?r=wa.build(r.toString()):Xr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),fu(r,o.default,e.default)}oa.register(ds,{error:[{kind:"error"},[si],(o,[e])=>{throw new Ms(e.evaluate(o))}],typeof:[si,[xi],(o,[e])=>Ss(Bs(e.evaluate(o)))],"to-rgba":[mo(Er,4),[sa],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[mo(Er,4),[sa],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[sa,[Er,Er,Er],Ka],rgba:[sa,[Er,Er,Er,Er],Ka],hsl:[sa,[Er,Er,Er],Dm],hsla:[sa,[Er,Er,Er,Er],Dm],has:{type:ei,overloads:[[[si],(o,[e])=>Om(e.evaluate(o),o.properties())],[[si,zu],(o,[e,r])=>Om(e.evaluate(o),r.evaluate(o))]]},get:{type:xi,overloads:[[[si],(o,[e])=>gf(e.evaluate(o),o.properties())],[[si,zu],(o,[e,r])=>gf(e.evaluate(o),r.evaluate(o))]]},"feature-state":[xi,[si],(o,[e])=>gf(e.evaluate(o),o.featureState||{})],properties:[zu,[],o=>o.properties()],"geometry-type":[si,[],o=>o.geometryType()],worldview:[si,[],o=>o.globals.worldview||""],"is-active-floor":[ei,uc(si),(o,e)=>{if(!(o.globals.activeFloors&&o.globals.activeFloors.size>0))return!1;const r=o.globals.activeFloors;return e.some(l=>{const u=l.evaluate(o);return r.has(u)})}],id:[xi,[],o=>o.id()],zoom:[Er,[],o=>o.globals.zoom],pitch:[Er,[],o=>o.globals.pitch||0],"distance-from-center":[Er,[],o=>o.distanceFromCenter()],"measure-light":[Er,[si],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[Er,[],o=>o.globals.heatmapDensity||0],"line-progress":[Er,[],o=>o.globals.lineProgress||0],"raster-value":[Er,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[Er,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[Er,[],o=>o.globals.skyRadialProgress||0],accumulated:[xi,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Er,uc(Er),(o,e)=>{let r=0;for(const l of e)r+=l.evaluate(o);return r}],"*":[Er,uc(Er),(o,e)=>{let r=1;for(const l of e)r*=l.evaluate(o);return r}],"-":{type:Er,overloads:[[[Er,Er],(o,[e,r])=>e.evaluate(o)-r.evaluate(o)],[[Er],(o,[e])=>-e.evaluate(o)]]},"/":[Er,[Er,Er],(o,[e,r])=>e.evaluate(o)/r.evaluate(o)],"%":[Er,[Er,Er],(o,[e,r])=>e.evaluate(o)%r.evaluate(o)],ln2:[Er,[],()=>Math.LN2],pi:[Er,[],()=>Math.PI],e:[Er,[],()=>Math.E],"^":[Er,[Er,Er],(o,[e,r])=>Math.pow(e.evaluate(o),r.evaluate(o))],sqrt:[Er,[Er],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Er,[Er],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Er,[Er],(o,[e])=>Math.log(e.evaluate(o))],log2:[Er,[Er],(o,[e])=>Math.log2(e.evaluate(o))],sin:[Er,[Er],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Er,[Er],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Er,[Er],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Er,[Er],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Er,[Er],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Er,[Er],(o,[e])=>Math.atan(e.evaluate(o))],min:[Er,uc(Er),(o,e)=>Math.min(...e.map(r=>r.evaluate(o)))],max:[Er,uc(Er),(o,e)=>Math.max(...e.map(r=>r.evaluate(o)))],abs:[Er,[Er],(o,[e])=>Math.abs(e.evaluate(o))],round:[Er,[Er],(o,[e])=>{const r=e.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[Er,[Er],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Er,[Er],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[ei,[si,xi],(o,[e,r])=>o.properties()[e.value]===r.value],"filter-id-==":[ei,[xi],(o,[e])=>o.id()===e.value],"filter-type-==":[ei,[si],(o,[e])=>o.geometryType()===e.value],"filter-<":[ei,[si,xi],(o,[e,r])=>{const l=o.properties()[e.value],u=r.value;return typeof l==typeof u&&l<u}],"filter-id-<":[ei,[xi],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[ei,[si,xi],(o,[e,r])=>{const l=o.properties()[e.value],u=r.value;return typeof l==typeof u&&l>u}],"filter-id->":[ei,[xi],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[ei,[si,xi],(o,[e,r])=>{const l=o.properties()[e.value],u=r.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[ei,[xi],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[ei,[si,xi],(o,[e,r])=>{const l=o.properties()[e.value],u=r.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[ei,[xi],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[ei,[xi],(o,[e])=>e.value in o.properties()],"filter-has-id":[ei,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[ei,[mo(si)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[ei,[mo(xi)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[ei,[si,mo(xi)],(o,[e,r])=>r.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[ei,[si,mo(xi)],(o,[e,r])=>(function(l,u,m,g){for(;m<=g;){const b=m+g>>1;if(u[b]===l)return!0;u[b]>l?g=b-1:m=b+1}return!1})(o.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(o,[e,r])=>e.evaluate(o)&&r.evaluate(o)],[uc(ei),(o,e)=>{for(const r of e)if(!r.evaluate(o))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(o,[e,r])=>e.evaluate(o)||r.evaluate(o)],[uc(ei),(o,e)=>{for(const r of e)if(r.evaluate(o))return!0;return!1}]]},"!":[ei,[ei],(o,[e])=>!e.evaluate(o)],"is-supported-script":[ei,[si],(o,[e])=>{const r=o.globals&&o.globals.isSupportedScript;return!r||r(e.evaluate(o))}],upcase:[si,[si],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[si,[si],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[si,uc(xi),(o,e)=>e.map(r=>kl(r.evaluate(o))).join("")],"resolved-locale":[si,[lp],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[Er,[Er,Er,xi],(o,e)=>{const[r,l,u]=e.map(g=>g.evaluate(o));if(r>l||r===l)return r;let m;if(typeof u=="string")m=(function(g){let b=0;if(g.length===0)return b;for(let E=0;E<g.length;E++)b=(b<<5)-b+g.charCodeAt(E),b&=b;return b})(u);else{if(typeof u!="number")throw new Ms(`Invalid seed input: ${u}`);m=u}return r+Ba(m)()*(l-r)}]});class ah{constructor(e,r,l,u,m){this.expression=e,this._warningHistory={},this._scope=l,this._options=u,this._iconImageUseTheme=m,this._evaluator=new Bd(l,u,m),this._defaultValue=r?(function(g){return g.type==="color"&&(xf(g.default)||Array.isArray(g.default))?new ii(0,0,0,0):g.type==="color"?ii.parse(g.default)||null:g.default===void 0?null:g.default})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=hu(e),this.isIndoorDependent=Qu(e)}evaluateWithoutErrorHandling(e,r,l,u,m,g,b,E){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,u,m,g,b,E,A){this._evaluator||(this._evaluator=new Bd(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=A||null;try{const N=this.expression.evaluate(this._evaluator);if(N==null||typeof N=="number"&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new Ms(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(N)} instead.`);return N}catch(N){const j=N;return this._warningHistory[j.message]||(this._warningHistory[j.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${j.message}`)),this._defaultValue}}}function td(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in ds}function Qa(o,e,r,l,u){const m=new au(ds,[],e?(function(b){const E={color:sa,string:si,number:Er,enum:si,boolean:ei,formatted:Od,resolvedImage:Fu};return b.type==="array"?mo(E[b.value]||xi,b.length):E[b.type]})(e):void 0,void 0,void 0,r,l,u),g=m.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?zm(new ah(g,e,r,l,u)):Ya(m.errors)}class la{constructor(e,r,l,u){this.kind=e,this._styleExpression=r,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!hf(r.expression),this.configDependencies=hu(r.expression),this.isIndoorDependent=Qu(r.expression)}evaluateWithoutErrorHandling(e,r,l,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,u,m,g)}evaluate(e,r,l,u,m,g,b){return this._styleExpression.evaluate(e,r,l,u,m,g,void 0,void 0,b)}}class Ja{constructor(e,r,l,u,m,g){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!hf(r.expression),this.isIndoorDependent=Qu(r.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=hu(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,l,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,u,m,g)}evaluate(e,r,l,u,m,g){return this._styleExpression.evaluate(e,r,l,u,m,g)}interpolationFactor(e,r,l){return this.interpolationType?za.interpolationFactor(this.interpolationType,e,r,l):0}}function lh(o,e,r,l,u){if((o=Qa(o,e,r,l,u)).result==="error")return o;const m=o.value.expression,g=Zu(m);if(!g&&!Sp(e))return Ya([new ia("","data expressions not supported")]);const b=Kd(m,["zoom","pitch","distance-from-center"]);if(!b&&!_f(e))return Ya([new ia("","zoom expressions not supported")]);const E=Kd(m,["measure-light"]);if(!E&&!Ju(e))return Ya([new ia("","measure-light expression not supported")]);const A=Kd(m,["line-progress"]);if(!A&&!(function(R){return yf(R.expression,"line-progress")})(e))return Ya([new ia("","line-progress expression not supported")]);const N=e.expression&&e.expression.relaxZoomRestriction,j=cl(m);return j||b||N?j instanceof ia?Ya([j]):j instanceof za&&!Tp(e)?Ya([new ia("",'"interpolate" expressions cannot be used with this property')]):zm(j?new Ja(g&&A?"camera":"composite",o.value,j.labels,j instanceof za?j.interpolation:void 0,E,A):new la(g&&A?"constant":"source",o.value,E,A)):Ya([new ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ch{constructor(e,r){this._parameters=e,this._specification=r,Object.assign(this,Ep(this._parameters,this._specification))}static deserialize(e){return new ch(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function cl(o){let e=null;if(o instanceof Wo)e=cl(o.result);else if(o instanceof eh){for(const r of o.args)if(e=cl(r),e)break}else(o instanceof ff||o instanceof za)&&o.input instanceof oa&&o.input.name==="zoom"&&(e=o);return e instanceof ia||o.eachChild(r=>{const l=cl(r);l instanceof ia?e=l:e&&l&&e!==l&&(e=new ia("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Zo,Ap,Gg=(function(){if(Ap)return Zo;Ap=1,Zo=e;var o=3;function e(r,l,u){var m=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var g=new Int32Array(this.arrayBuffer);r=g[0],this.d=(l=g[1])+2*(u=g[2]);for(var b=0;b<this.d*this.d;b++){var E=g[o+b],A=g[o+b+1];m.push(E===A?null:g.subarray(E,A))}var N=g[o+m.length+1];this.keys=g.subarray(g[o+m.length],N),this.bboxes=g.subarray(N),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var j=0;j<this.d*this.d;j++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=u,this.scale=l/r,this.uid=0;var R=u/l*r;this.min=-R,this.max=r+R}return e.prototype.insert=function(r,l,u,m,g){this._forEachCell(l,u,m,g,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,l,u,m,g,b){this.cells[g].push(b)},e.prototype.query=function(r,l,u,m,g){var b=this.min,E=this.max;if(r<=b&&l<=b&&E<=u&&E<=m&&!g)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(r,l,u,m,this._queryCell,A,{},g),A},e.prototype._queryCell=function(r,l,u,m,g,b,E,A){var N=this.cells[g];if(N!==null)for(var j=this.keys,R=this.bboxes,B=0;B<N.length;B++){var V=N[B];if(E[V]===void 0){var H=4*V;(A?A(R[H+0],R[H+1],R[H+2],R[H+3]):r<=R[H+2]&&l<=R[H+3]&&u>=R[H+0]&&m>=R[H+1])?(E[V]=!0,b.push(j[V])):E[V]=!1}}},e.prototype._forEachCell=function(r,l,u,m,g,b,E,A){for(var N=this._convertToCellCoord(r),j=this._convertToCellCoord(l),R=this._convertToCellCoord(u),B=this._convertToCellCoord(m),V=N;V<=R;V++)for(var H=j;H<=B;H++){var Q=this.d*H+V;if((!A||A(this._convertFromCellCoord(V),this._convertFromCellCoord(H),this._convertFromCellCoord(V+1),this._convertFromCellCoord(H+1)))&&g.call(this,r,l,u,m,Q,b,E,A))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,l=o+this.cells.length+1+1,u=0,m=0;m<this.cells.length;m++)u+=this.cells[m].length;var g=new Int32Array(l+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=l,E=0;E<r.length;E++){var A=r[E];g[o+E]=b,g.set(A,b),b+=A.length}return g[o+r.length]=b,g.set(this.keys,b),g[o+r.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},Zo})(),Ea=Is(Gg);const Ll={};function hr(o,e,r={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),Ll[e]={klass:o,omit:r.omit||[]}}hr(Object,"Object"),Ea.serialize=function(o,e){const r=o.toArrayBuffer();return e&&e.add(r),{buffer:r}},Ea.deserialize=function(o){return new Ea(o.buffer)},Object.defineProperty(Ea,"name",{value:"Grid"}),hr(Ea,"Grid"),delete Nt.prototype.constructor,hr(ii,"Color"),hr(Error,"Error"),hr(Go,"Formatted"),hr(dp,"FormattedSection"),hr(Ql,"AJAXError"),hr(wa,"ResolvedImage"),hr(ch,"StylePropertyFunction"),hr(ah,"StyleExpression",{omit:["_evaluator"]}),hr(co,"ImageId"),hr(ba,"ImageVariant"),hr(Ja,"ZoomDependentExpression"),hr(la,"ZoomConstantExpression"),hr(oa,"CompoundExpression",{omit:["_evaluate"]});for(const o in ds)Ll[ds[o]._classRegistryKey]||hr(ds[o],`Expression${o}`);function Ip(o){return o&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Va(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Ip(o)||o instanceof ImageBitmap)return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const r=[];for(const l of o)r.push(Va(l,e));return r}if(o instanceof Map){const r={$name:"Map",entries:[]};for(const[l,u]of o.entries())r.entries.push(Va(l),Va(u,e));return r}if(o instanceof Set){const r={$name:"Set"};let l=0;for(const u of o.values())r[++l]=Va(u);return r}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const r=o.constructor,l=r._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const u=r.serialize?r.serialize(o,e):{};if(!r.serialize){for(const m in o)o.hasOwnProperty(m)&&(Ll[l].omit.indexOf(m)>=0||(u[m]=Va(o[m],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof o)}function dc(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Ip(o)||o instanceof ImageBitmap||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(dc);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],m=new Map;for(let g=0;g<u.length;g+=2)m.set(dc(u[g]),dc(u[g+1]));return m}if(e==="Set"){const u=new Set;for(const m of Object.keys(o))m!=="$name"&&u.add(dc(o[m]));return u}if(e==="BigInt")return BigInt(o.value);const{klass:r}=Ll[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(o);const l=Object.create(r.prototype);for(const u of Object.keys(o))u!=="$name"&&(l[u]=dc(o[u]));return l}throw new Error("can't deserialize object of type "+typeof o)}const uh=o=>o>=1536&&o<=1791,Dl=o=>o>=1872&&o<=1919,pu=o=>o>=2208&&o<=2303,mu=o=>o>=11904&&o<=12031,Nc=o=>o>=12032&&o<=12255,vf=o=>o>=12272&&o<=12287,Ol=o=>o>=12288&&o<=12351,rd=o=>o>=12352&&o<=12447,nd=o=>o>=12448&&o<=12543,ns=o=>o>=12544&&o<=12591,bf=o=>o>=12704&&o<=12735,Pp=o=>o>=12736&&o<=12783,kp=o=>o>=12784&&o<=12799,wf=o=>o>=12800&&o<=13055,Sf=o=>o>=13056&&o<=13311,ul=o=>o>=13312&&o<=19903,Ps=o=>o>=19968&&o<=40959,Ks=o=>o>=40960&&o<=42127,Ys=o=>o>=42128&&o<=42191,Tf=o=>o>=44032&&o<=55215,dh=o=>o>=63744&&o<=64255,id=o=>o>=64336&&o<=65023,Wg=o=>o>=65040&&o<=65055,Mo=o=>o>=65072&&o<=65103,Np=o=>o>=65104&&o<=65135,Ef=o=>o>=65136&&o<=65279,Cf=o=>o>=65280&&o<=65519;function dl(o){for(const e of o)if(hc(e.charCodeAt(0)))return!0;return!1}function hl(o){for(const e of o)if(!Af(e.charCodeAt(0)))return!1;return!0}function Af(o){return!(uh(o)||Dl(o)||pu(o)||id(o)||Ef(o))}function jp(o){return!(o<11904||!(bf(o)||ns(o)||Mo(o)||dh(o)||Sf(o)||mu(o)||Pp(o)||Ol(o)||ul(o)||Ps(o)||wf(o)||Cf(o)||rd(o)||vf(o)||Nc(o)||kp(o)||nd(o)||Wg(o)||Ys(o)||Ks(o)))}function hc(o){return!(o!==746&&o!==747&&(o<4352||!(bf(o)||ns(o)||Mo(o)&&!(o>=65097&&o<=65103)||dh(o)||Sf(o)||mu(o)||Pp(o)||!(!Ol(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||ul(o)||Ps(o)||wf(o)||(e=>e>=12592&&e<=12687)(o)||(e=>e>=43360&&e<=43391)(o)||(e=>e>=55216&&e<=55295)(o)||(e=>e>=4352&&e<=4607)(o)||Tf(o)||rd(o)||vf(o)||(e=>e>=12688&&e<=12703)(o)||Nc(o)||kp(o)||nd(o)&&o!==12540||!(!Cf(o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Np(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(e=>e>=5120&&e<=5759)(o)||(e=>e>=6320&&e<=6399)(o)||Wg(o)||(e=>e>=19904&&e<=19967)(o)||Ks(o)||Ys(o))))}function Bm(o){return o===12312||o===12313||o===12316||o===12540||o===12448}function Rp(o){return!(hc(o)||(function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ol(e)||nd(e)||(r=>r>=57344&&r<=63743)(e)||Mo(e)||Np(e)||Cf(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(o))}function If(o){return uh(o)||Dl(o)||pu(o)||id(o)||Ef(o)}function Vm(o){return o>=1424&&o<=2303||id(o)||Ef(o)}function Hg(o,e){return!(!e&&Vm(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(r=>r>=6016&&r<=6143)(o))}function jc(o){for(const e of o)if(Vm(e.charCodeAt(0)))return!0;return!1}const ca={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Rc=null,uo=ca.unavailable,Mc=null;const Pf=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(uo=ca.error),Rc&&Rc(o)};function hh(){Mp.fire(new tc("pluginStateChange",{pluginStatus:uo,pluginURL:Mc}))}const Mp=new Xs,kf=function(){return uo},Lp=function(){if(uo!==ca.deferred||!Mc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");uo=ca.loading,hh(),Mc&&Uh({url:Mc},o=>{o?Pf(o):(uo=ca.loaded,hh())})},fl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>uo===ca.loaded||fl.applyArabicShaping!=null,isLoading:()=>uo===ca.loading,setState(o){uo=o.pluginStatus,Mc=o.pluginURL},isParsing:()=>uo===ca.parsing,isParsed:()=>uo===ca.parsed,getPluginURL:()=>Mc};class bi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview,this.activeFloors=r.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(r,l){for(const u of r)if(!Hg(u.charCodeAt(0),l))return!1;return!0})(e,fl.isLoaded())}}class fh{constructor(e,r,l,u,m){this.property=e,this.value=r,this.expression=(function(g,b,E,A,N){if(xf(g))return new ch(g,b);if(td(g)||Array.isArray(g)&&g.length>0){const j=lh(g,b,E,A,N);if(j.result==="error")throw new Error(j.value.map(R=>`${R.key}: ${R.message}`).join(", "));return j.value}{let j=g;return typeof g=="string"&&b.type==="color"&&(j=ii.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>j}}})(r===void 0?e.specification.default:r,e.specification,l,u,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l,u){return this.property.possiblyEvaluate(this,e,r,l,u)}}class sd{constructor(e,r,l,u){this.property=e,this.value=new fh(e,void 0,r,l,u)}transitioned(e,r){return new Um(this.property,this.value,r,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Um(this.property,this.value,null,{},0)}}class od{constructor(e,r,l,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=l,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Nr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new sd(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new fh(this._values[e].property,r===null?void 0:Nr(r),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,r){r&&(this._options=r);const l=this._properties.properties;if(e)for(const u in e){const m=e[u];if(u.endsWith("-transition")){const g=u.slice(0,-11);l[g]&&this.setTransition(g,m)}else l.hasOwnProperty(u)&&this.setValue(u,m)}}getTransition(e){return Nr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new sd(this._values[e].property)),this._values[e].transition=Nr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const l=new $m(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,r._values[u]);return l}untransitioned(){const e=new $m(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Um{constructor(e,r,l,u,m){const g=u.delay||0,b=u.duration||0;m=m||0,this.property=e,this.value=r,this.begin=m+g,this.end=this.begin+b,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const u=e.now||0,m=this.value.possiblyEvaluate(e,r,l),g=this.prior;if(g){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return g.possiblyEvaluate(e,r,l);{const b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,l),m,ce(b))}}return m}}class $m{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const u=new ua(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,r,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class qm{constructor(e,r,l,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=l,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Nr(this._values[e].value)}setValue(e,r){this._values[e]=new fh(this._values[e].property,r===null?void 0:Nr(r),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l,u){const m=new ua(this._properties);for(const g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(e,r,l,u);return m}isIndoorDependent(){return this._isIndoorDependent}}class gu{constructor(e,r,l,u){this.property=e,this.value=r,this.parameters=l,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,u){return this.property.evaluate(this.value,this.parameters,e,r,l,u,this.iconImageUseTheme)}}class ua{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class zt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,l){const u=Ou[this.specification.type];return u?u(e,r,l):e}}class er{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,u,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new gu(this,{kind:"constant",value:e.expression.evaluate(r,null,{},l,u,void 0,m)},r):new gu(this,e.expression,r,m)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new gu(this,{kind:"constant",value:void 0},e.parameters);const u=Ou[this.specification.type];return u?new gu(this,{kind:"constant",value:u(e.value.value,r.value.value,l)},e.parameters):e}evaluate(e,r,l,u,m,g,b){return e.kind==="constant"?e.value:e.evaluate(r,l,u,m,g,void 0,b)}}class ad{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,u){return!!e.expression.evaluate(r,null,{},l,u)}interpolate(){return!1}}class is{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new bi(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new fh(u,void 0),g=this.defaultTransitionablePropertyValues[l]=new sd(u);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(r)}}}hr(er,"DataDrivenProperty"),hr(zt,"DataConstantProperty"),hr(ad,"ColorRampProperty");var He=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Zg(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Dp(o){if(Array.isArray(o))return o.map(Dp);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const r in o)e[r]=Dp(o[r]);return e}return Zg(o)}function Gm(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Gm(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function el(o,e="",r=null,l="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gm(o)||(o=fc(o));const u=o;let m=!0;try{m=(function(N){if(!ld(N))return N;let j=Dp(N);return ph(j),j=Op(j),j})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let g=null,b=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){b=He[`filter_${l}`];const N=Qa(m,b,e,r);if(N.result==="error")throw new Error(N.value.map(j=>`${j.key}: ${j.message}`).join(", "));g=(j,R,B)=>N.value.evaluate(j,R,{},B)}let E=null,A=null;if(m!==u){const N=Qa(u,b,e,r);if(N.result==="error")throw new Error(N.value.map(j=>`${j.key}: ${j.message}`).join(", "));E=(j,R,B,V,H)=>N.value.evaluate(j,R,{},B,void 0,void 0,V,H),A=!Zu(N.value.expression)}return{filter:g,dynamicFilter:E||void 0,needGeometry:Nf(m),needFeature:!!A}}function Op(o){if(!Array.isArray(o))return o;const e=(function(r){if(Xg.has(r[0])){for(let l=1;l<r.length;l++)if(ld(r[l]))return!0}return r})(o);return e===!0?e:e.map(r=>Op(r))}function ph(o){let e=!1;const r=[];if(o[0]==="case"){for(let l=1;l<o.length-1;l+=2)e=e||ld(o[l]),r.push(o[l+1]);r.push(o[o.length-1])}else if(o[0]==="match"){e=e||ld(o[1]);for(let l=2;l<o.length-1;l+=2)r.push(o[l+1]);r.push(o[o.length-1])}else if(o[0]==="step"){e=e||ld(o[1]);for(let l=1;l<o.length-1;l+=2)r.push(o[l+1])}e&&(o.length=0,o.push("any",...r));for(let l=1;l<o.length;l++)ph(o[l])}function ld(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<o.length;r++)if(ld(o[r]))return!0;return!1}const Xg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Kg(o,e){return o<e?-1:o>e?1:0}function Nf(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(Nf(o[e]))return!0;return!1}function fc(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?pl(o[1],o[2],"=="):e==="!="?Rf(pl(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?pl(o[1],o[2],e):e==="any"?(r=o.slice(1),["any"].concat(r.map(fc))):e==="all"?["all"].concat(o.slice(1).map(fc)):e==="none"?["all"].concat(o.slice(1).map(fc).map(Rf)):e==="in"?jf(o[1],o.slice(2)):e==="!in"?Rf(jf(o[1],o.slice(2))):e==="has"?Yg(o[1]):e!=="!has"||Rf(Yg(o[1]));var r}function pl(o,e,r){switch(o){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,o,e]}}function jf(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",o,["literal",e.sort(Kg)]]:["filter-in-small",o,["literal",e]]}}function Yg(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Rf(o){return["!",o]}const mh="";function yu(o,e){return e?`${o}${mh}${e}`:o}let zp;const Fp=()=>zp||(zp=new is({"icon-size":new er(He.layout_symbol["icon-size"]),"icon-image":new er(He.layout_symbol["icon-image"]),"icon-rotate":new er(He.layout_symbol["icon-rotate"]),"icon-offset":new er(He.layout_symbol["icon-offset"]),"text-size":new er(He.layout_symbol["text-size"]),"text-rotate":new er(He.layout_symbol["text-rotate"]),"text-offset":new er(He.layout_symbol["text-offset"])}));class Qg{constructor(e,r,l,u,m,g){const b=Qa(e,He.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=r,l){this.properties=new ua(Fp()),this.unevaluatedLayout=new qm(Fp(),u,m,g);for(const E in l)this.unevaluatedLayout.setValue(E,l[E])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,r,l){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,r,l))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),r=this.hasProperty("icon-size"),l=this.hasProperty("icon-offset"),u=this.hasProperty("icon-rotate");return e||r||l||u}hasTextProperties(){const e=this.hasProperty("text-size"),r=this.hasProperty("text-offset"),l=this.hasProperty("text-rotate");return e||r||l}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Ca="-transition",da=new Set(["fill","line","background","hillshade","raster"]);class Xo extends Xs{constructor(e,r,l,u,m,g){if(super(),this.id=e.id,this.fqid=yu(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const b=Qa(this.filter,He[`filter_${e.type}`]);b.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),r.layout&&(this._unevaluatedLayout=new qm(r.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),r.paint){this._transitionablePaint=new od(r.paint,this.scope,m);for(const b in e.paint)this.setPaintProperty(b,e.paint[b]);for(const b in e.layout)this.setLayoutProperty(b,e.layout[b]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ua(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&da.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(r=>{this.appearances.push(new Qg(r.condition,r.name,r.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Ca)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,r){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(Ca)){const j=e.slice(0,-11);return u[j]&&l.setTransition(j,r||void 0),!1}if(!u[e])return!1;const m=l._values[e],g=m.value.isDataDriven(),b=m.value;l.setValue(e,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const E=l._values[e].value,A=E.isDataDriven(),N=e.endsWith("pattern")||e==="line-dasharray";return A||g||N||this._handleOverridablePaintPropertyUpdate(e,b,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,l){return null}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(r=>r.serialize())),cr(e,(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof gu&&Sp(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}for(const e of this.appearances)if(!hf(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=el(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,r,l){return{}}queryRadius(e){}queryIntersectsFeature(e,r,l,u,m,g,b,E,A,N){}}const Wm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Jg=new ArrayBuffer(0);class zi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,r){return e._trim(),r&&e.arrayBuffer&&r.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,e.arrayBuffer?r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement:(r.capacity=0,r.arrayBuffer=Jg),r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Tn(o,e=1){let r=0,l=0;return{members:o.map(u=>{const m=Wm[u.type].BYTES_PER_ELEMENT,g=r=Hm(r,Math.max(e,m)),b=u.components||1;return l=Math.max(l,m),r+=m*b,{name:u.name,type:u.type,components:b,offset:g}}),size:Hm(r,Math.max(l,e)),alignment:e}}function Hm(o,e){return Math.ceil(o/e)*e}class pc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=l,e}}pc.prototype.bytesPerElement=4,hr(pc,"StructArrayLayout2i4");class mc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=u,e}}mc.prototype.bytesPerElement=6,hr(mc,"StructArrayLayout3i6");class gc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u)}emplace(e,r,l,u,m){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=l,this.int16[g+2]=u,this.int16[g+3]=m,e}}gc.prototype.bytesPerElement=8,hr(gc,"StructArrayLayout4i8");class Us extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Us.prototype.bytesPerElement=4,hr(Us,"StructArrayLayout1f4");class _u extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const m=4*e,g=2*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.float32[g+1]=u,e}}_u.prototype.bytesPerElement=8,hr(_u,"StructArrayLayout2i1f8");class Bp extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=u,e}}Bp.prototype.bytesPerElement=8,hr(Bp,"StructArrayLayout3i8");class Mf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,l,u,m)}emplace(e,r,l,u,m,g){const b=5*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=u,this.int16[b+3]=m,this.int16[b+4]=g,e}}Mf.prototype.bytesPerElement=10,hr(Mf,"StructArrayLayout5i10");class gh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,l,u,m,g,b)}emplace(e,r,l,u,m,g,b,E){const A=6*e,N=12*e,j=3*e;return this.int16[A+0]=r,this.int16[A+1]=l,this.uint8[N+4]=u,this.uint8[N+5]=m,this.uint8[N+6]=g,this.uint8[N+7]=b,this.float32[j+2]=E,e}}gh.prototype.bytesPerElement=12,hr(gh,"StructArrayLayout2i4ub1f12");class ml extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=l,this.float32[m+2]=u,e}}ml.prototype.bytesPerElement=12,hr(ml,"StructArrayLayout3f12");class zl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,l,u,m)}emplace(e,r,l,u,m,g){const b=6*e,E=3*e;return this.uint16[b+0]=r,this.uint16[b+1]=l,this.uint16[b+2]=u,this.uint16[b+3]=m,this.float32[E+2]=g,e}}zl.prototype.bytesPerElement=12,hr(zl,"StructArrayLayout4ui1f12");class xu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u)}emplace(e,r,l,u,m){const g=4*e;return this.uint16[g+0]=r,this.uint16[g+1]=l,this.uint16[g+2]=u,this.uint16[g+3]=m,e}}xu.prototype.bytesPerElement=8,hr(xu,"StructArrayLayout4ui8");class cd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,m,g)}emplace(e,r,l,u,m,g,b){const E=6*e;return this.int16[E+0]=r,this.int16[E+1]=l,this.int16[E+2]=u,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=b,e}}cd.prototype.bytesPerElement=12,hr(cd,"StructArrayLayout6i12");class yh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A,N,j,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,l,u,m,g,b,E,A,N,j,R)}emplace(e,r,l,u,m,g,b,E,A,N,j,R,B){const V=12*e;return this.int16[V+0]=r,this.int16[V+1]=l,this.int16[V+2]=u,this.int16[V+3]=m,this.uint16[V+4]=g,this.uint16[V+5]=b,this.uint16[V+6]=E,this.uint16[V+7]=A,this.int16[V+8]=N,this.int16[V+9]=j,this.int16[V+10]=R,this.int16[V+11]=B,e}}yh.prototype.bytesPerElement=24,hr(yh,"StructArrayLayout4i4ui4i24");class Fl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,m,g)}emplace(e,r,l,u,m,g,b){const E=10*e,A=5*e;return this.int16[E+0]=r,this.int16[E+1]=l,this.int16[E+2]=u,this.float32[A+2]=m,this.float32[A+3]=g,this.float32[A+4]=b,e}}Fl.prototype.bytesPerElement=20,hr(Fl,"StructArrayLayout3i3f20");class vu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u)}emplace(e,r,l,u,m){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=l,this.float32[g+2]=u,this.float32[g+3]=m,e}}vu.prototype.bytesPerElement=16,hr(vu,"StructArrayLayout4f16");class Vp extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Vp.prototype.bytesPerElement=4,hr(Vp,"StructArrayLayout1ul4");class Aa extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=l,e}}Aa.prototype.bytesPerElement=4,hr(Aa,"StructArrayLayout2ui4");class _h extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A,N,j,R,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,r,l,u,m,g,b,E,A,N,j,R,B)}emplace(e,r,l,u,m,g,b,E,A,N,j,R,B,V){const H=20*e,Q=10*e;return this.int16[H+0]=r,this.int16[H+1]=l,this.int16[H+2]=u,this.int16[H+3]=m,this.int16[H+4]=g,this.float32[Q+3]=b,this.float32[Q+4]=E,this.float32[Q+5]=A,this.float32[Q+6]=N,this.int16[H+14]=j,this.uint32[Q+8]=R,this.uint16[H+18]=B,this.uint16[H+19]=V,e}}_h.prototype.bytesPerElement=40,hr(_h,"StructArrayLayout5i4f1i1ul2ui40");class Lf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,l,u,m,g,b)}emplace(e,r,l,u,m,g,b,E){const A=8*e;return this.int16[A+0]=r,this.int16[A+1]=l,this.int16[A+2]=u,this.int16[A+4]=m,this.int16[A+5]=g,this.int16[A+6]=b,this.int16[A+7]=E,e}}Lf.prototype.bytesPerElement=16,hr(Lf,"StructArrayLayout3i2i2i16");class bu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,l,u,m)}emplace(e,r,l,u,m,g){const b=4*e,E=8*e;return this.float32[b+0]=r,this.float32[b+1]=l,this.float32[b+2]=u,this.int16[E+6]=m,this.int16[E+7]=g,e}}bu.prototype.bytesPerElement=16,hr(bu,"StructArrayLayout2f1f2i16");class yo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,m,g)}emplace(e,r,l,u,m,g,b){const E=20*e,A=5*e;return this.uint8[E+0]=r,this.uint8[E+1]=l,this.float32[A+1]=u,this.float32[A+2]=m,this.float32[A+3]=g,this.float32[A+4]=b,e}}yo.prototype.bytesPerElement=20,hr(yo,"StructArrayLayout2ub4f20");class Os extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=l,this.uint16[m+2]=u,e}}Os.prototype.bytesPerElement=6,hr(Os,"StructArrayLayout3ui6");class Df extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe)}emplace(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe,ye){const Ie=30*e,Pe=15*e,Ae=60*e;return this.int16[Ie+0]=r,this.int16[Ie+1]=l,this.int16[Ie+2]=u,this.float32[Pe+2]=m,this.float32[Pe+3]=g,this.uint16[Ie+8]=b,this.uint16[Ie+9]=E,this.uint32[Pe+5]=A,this.uint32[Pe+6]=N,this.uint32[Pe+7]=j,this.uint16[Ie+16]=R,this.uint16[Ie+17]=B,this.uint16[Ie+18]=V,this.float32[Pe+10]=H,this.float32[Pe+11]=Q,this.uint8[Ae+48]=K,this.uint8[Ae+49]=re,this.uint8[Ae+50]=ae,this.uint32[Pe+13]=ue,this.int16[Ie+28]=xe,this.uint8[Ae+58]=ye,e}}Df.prototype.bytesPerElement=60,hr(Df,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Dc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe,ye,Ie,Pe,Ae,je,Oe,ht,at,lt,St,bt,wt){const st=this.length;return this.resize(st+1),this.emplace(st,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe,ye,Ie,Pe,Ae,je,Oe,ht,at,lt,St,bt,wt)}emplace(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe,ye,Ie,Pe,Ae,je,Oe,ht,at,lt,St,bt,wt,st){const Et=20*e,gt=40*e,kt=80*e;return this.float32[Et+0]=r,this.float32[Et+1]=l,this.int16[gt+4]=u,this.int16[gt+5]=m,this.int16[gt+6]=g,this.int16[gt+7]=b,this.int16[gt+8]=E,this.int16[gt+9]=A,this.int16[gt+10]=N,this.int16[gt+11]=j,this.int16[gt+12]=R,this.uint16[gt+13]=B,this.uint16[gt+14]=V,this.uint16[gt+15]=H,this.uint16[gt+16]=Q,this.uint16[gt+17]=K,this.uint16[gt+18]=re,this.uint16[gt+19]=ae,this.uint16[gt+20]=ue,this.uint16[gt+21]=xe,this.uint16[gt+22]=ye,this.uint16[gt+23]=Ie,this.uint16[gt+24]=Pe,this.uint16[gt+25]=Ae,this.uint16[gt+26]=je,this.uint16[gt+27]=Oe,this.uint32[Et+14]=ht,this.float32[Et+15]=at,this.float32[Et+16]=lt,this.float32[Et+17]=St,this.float32[Et+18]=bt,this.uint8[kt+76]=wt,this.uint16[gt+39]=st,e}}Dc.prototype.bytesPerElement=80,hr(Dc,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class _o extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,m,g)}emplace(e,r,l,u,m,g,b){const E=6*e;return this.float32[E+0]=r,this.float32[E+1]=l,this.float32[E+2]=u,this.float32[E+3]=m,this.float32[E+4]=g,this.float32[E+5]=b,e}}_o.prototype.bytesPerElement=24,hr(_o,"StructArrayLayout6f24");class ud extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,l,u,m)}emplace(e,r,l,u,m,g){const b=5*e;return this.float32[b+0]=r,this.float32[b+1]=l,this.float32[b+2]=u,this.float32[b+3]=m,this.float32[b+4]=g,e}}ud.prototype.bytesPerElement=20,hr(ud,"StructArrayLayout5f20");class hn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,l,u,m,g,b)}emplace(e,r,l,u,m,g,b,E){const A=7*e;return this.float32[A+0]=r,this.float32[A+1]=l,this.float32[A+2]=u,this.float32[A+3]=m,this.float32[A+4]=g,this.float32[A+5]=b,this.float32[A+6]=E,e}}hn.prototype.bytesPerElement=28,hr(hn,"StructArrayLayout7f28");class wu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A,N,j){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,l,u,m,g,b,E,A,N,j)}emplace(e,r,l,u,m,g,b,E,A,N,j,R){const B=11*e;return this.float32[B+0]=r,this.float32[B+1]=l,this.float32[B+2]=u,this.float32[B+3]=m,this.float32[B+4]=g,this.float32[B+5]=b,this.float32[B+6]=E,this.float32[B+7]=A,this.float32[B+8]=N,this.float32[B+9]=j,this.float32[B+10]=R,e}}wu.prototype.bytesPerElement=44,hr(wu,"StructArrayLayout11f44");class dd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,l,u,m,g,b,E,A)}emplace(e,r,l,u,m,g,b,E,A,N){const j=9*e;return this.float32[j+0]=r,this.float32[j+1]=l,this.float32[j+2]=u,this.float32[j+3]=m,this.float32[j+4]=g,this.float32[j+5]=b,this.float32[j+6]=E,this.float32[j+7]=A,this.float32[j+8]=N,e}}dd.prototype.bytesPerElement=36,hr(dd,"StructArrayLayout9f36");class Su extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=l,e}}Su.prototype.bytesPerElement=8,hr(Su,"StructArrayLayout2f8");class Zm extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u)}emplace(e,r,l,u,m){const g=6*e;return this.uint32[3*e+0]=r,this.uint16[g+2]=l,this.uint16[g+3]=u,this.uint16[g+4]=m,e}}Zm.prototype.bytesPerElement=12,hr(Zm,"StructArrayLayout1ul3ui12");class Oc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Oc.prototype.bytesPerElement=2,hr(Oc,"StructArrayLayout1ui2");class xh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q){const K=this.length;return this.resize(K+1),this.emplace(K,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q)}emplace(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K){const re=16*e;return this.float32[re+0]=r,this.float32[re+1]=l,this.float32[re+2]=u,this.float32[re+3]=m,this.float32[re+4]=g,this.float32[re+5]=b,this.float32[re+6]=E,this.float32[re+7]=A,this.float32[re+8]=N,this.float32[re+9]=j,this.float32[re+10]=R,this.float32[re+11]=B,this.float32[re+12]=V,this.float32[re+13]=H,this.float32[re+14]=Q,this.float32[re+15]=K,e}}xh.prototype.bytesPerElement=64,hr(xh,"StructArrayLayout16f64");class hd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,m,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,l,u,m,g,b)}emplace(e,r,l,u,m,g,b,E){const A=10*e,N=5*e;return this.uint16[A+0]=r,this.uint16[A+1]=l,this.uint16[A+2]=u,this.uint16[A+3]=m,this.float32[N+2]=g,this.float32[N+3]=b,this.float32[N+4]=E,e}}hd.prototype.bytesPerElement=20,hr(hd,"StructArrayLayout4ui3f20");class Up extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Up.prototype.bytesPerElement=2,hr(Up,"StructArrayLayout1i2");class Of extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Of.prototype.bytesPerElement=1,hr(Of,"StructArrayLayout1ub1");class Xm extends Lc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xm.prototype.size=40;class $p extends _h{get(e){return new Xm(this,e)}}hr($p,"CollisionBoxArray");class qp extends Lc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qp.prototype.size=60;class Lo extends Df{get(e){return new qp(this,e)}}hr(Lo,"PlacedSymbolArray");class gl extends Lc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}gl.prototype.size=80;class zc extends Dc{get(e){return new gl(this,e)}}hr(zc,"SymbolInstanceArray");class vh extends Us{getoffsetX(e){return this.float32[1*e+0]}}hr(vh,"GlyphOffsetArray");class Km extends pc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}hr(Km,"SymbolLineVertexArray");class yl extends Lc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}yl.prototype.size=12;class bh extends Zm{get(e){return new yl(this,e)}}hr(bh,"FeatureIndexArray");class Bl extends Aa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}hr(Bl,"FillExtrusionCentroidArray");class Ym extends Lc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ym.prototype.size=6;class Qm extends mc{get(e){return new Ym(this,e)}}hr(Qm,"FillExtrusionWallArray");const Jm=Tn([{name:"a_pos",components:2,type:"Int16"}],4),eg=Tn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),tg=Tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Zi{constructor(e=[]){this.segments=e}_prepareSegment(e,r,l,u){let m=this.segments[this.segments.length-1];return e>Zi.MAX_VERTEX_ARRAY_LENGTH&&Rr(`Max vertices per segment is ${Zi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Zi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u)&&(m={vertexOffset:r,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(m.sortKey=u),this.segments.push(m)),m}prepareSegment(e,r,l,u){return this._prepareSegment(e,r.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,u){return new Zi([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function zf(o,e){return 256*(o=Ee(Math.floor(o),0,255))+Ee(Math.floor(e),0,255)}Zi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hr(Zi,"SegmentVector");const Gp=Tn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),_l=Tn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Ji=Tn([{name:"a_dash",components:4,type:"Uint16"}]);class $s{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,l,u){this.ids.push(Qs(e)),this.positions.push(r,l,u)}eachPosition(e,r){const l=Qs(e);let u=0,m=this.ids.length-1;for(;u<m;){const g=u+m>>1;this.ids[g]>=l?m=g:u=g+1}for(;this.ids[u]===l;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return xo(l,u,0,l.length-1),r&&(r.add(l.buffer),r.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const r=new $s;let l;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==l&&r.uniqueIds.push(u),l=u;return r.indexed=!0,r}}function Qs(o){const e=+o;return Number.isSafeInteger(e)?e:wc(String(o))}function xo(o,e,r,l){for(;r<l;){const u=o[r+l>>1];let m=r-1,g=l+1;for(;;){do m++;while(o[m]<u);do g--;while(o[g]>u);if(m>=g)break;Ko(o,m,g),Ko(e,3*m,3*g),Ko(e,3*m+1,3*g+1),Ko(e,3*m+2,3*g+2)}g-r<l-g?(xo(o,e,r,g),r=g+1):(xo(o,e,g+1,l),l=g)}}function Ko(o,e,r){const l=o[e];o[e]=o[r],o[r]=l}hr($s,"FeaturePositionMap");class ha{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class os extends ha{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class hs extends ha{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class vo extends ha{constructor(e){super(e),this.current=[0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Tu extends ha{constructor(e){super(e),this.current=[0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class wh extends ha{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Sh extends ha{constructor(e){super(e),this.current=ii.transparent.toPremultipliedRenderColor(null)}set(e,r,l){this.fetchUniformLocation(e,r)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Ua=new Float32Array(16);class Eu extends ha{constructor(e){super(e),this.current=Ua}set(e,r,l){if(this.fetchUniformLocation(e,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Ff=new Float32Array(9),f=new Float32Array(4);class t extends ha{constructor(e){super(e),this.current=f}set(e,r,l){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function c(o){return[zf(255*o.r,255*o.g),zf(255*o.b,255*o.a)]}function p(o,e,r,l,u,m,g,b){return!!o&&(o.kind==="composite"||o.kind==="source"?o.evaluate(new bi(0,{brightness:m,worldview:b}),e,r,u,l,g)==="none":o.value==="none")}class x{constructor(e,r,l,u){this.value=e,this.uniformNames=r.map(m=>`u_${m}`),this.type=l,this.context=u}setUniform(e,r,l,u,m){const g=u.constantOr(this.value);r.set(e,m,g instanceof ii?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,r){return this.type==="color"?new Sh(e):new hs(e)}}class S{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,r){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(e,r,l,u,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&r.set(e,m,g)}getBinding(e,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new wh(e):new hs(e)}}class T{constructor(e,r,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,l,u,m,g,b,E){const A=this.paintVertexArray.length,N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bi(0,{brightness:g,worldview:E}),r,{},m,u,b):this.expression.kind==="constant"&&this.expression.value,j=p(this.lutExpression,r,{},u,m,g,b,E);this.paintVertexArray.resize(e),this._setPaintValue(A,e,N,j?null:this.context.lut)}updatePaintArray(e,r,l,u,m,g,b,E){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:E},l,u,void 0,m):this.expression.kind==="constant"&&this.expression.value,N=p(this.lutExpression,l,u,m,void 0,b,void 0,E);this._setPaintValue(e,r,A,N?null:this.context.lut)}_setPaintValue(e,r,l,u){if(this.type==="color"){const m=c(l.toPremultipliedRenderColor(u));for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class I{constructor(e,r,l,u,m,g){this.expression=e,this.uniformNames=r.map(b=>`u_${b}_t`),this.type=l,this.useIntegerZoom=u,this.context=m,this.maxValue=0,this.paintVertexAttributes=r.map(b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,l,u,m,g,b,E){const A=this.expression.evaluate(new bi(this.context.zoom,{brightness:g,worldview:E}),r,{},m,u,b),N=this.expression.evaluate(new bi(this.context.zoom+1,{brightness:g,worldview:E}),r,{},m,u,b),j=p(this.lutExpression,r,{},u,m,g,b,E),R=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(R,e,A,N,j?null:this.context.lut)}updatePaintArray(e,r,l,u,m,g,b,E){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:E},l,u,void 0,m),N=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:E},l,u,void 0,m),j=p(this.lutExpression,l,u,m,void 0,b,void 0,E);this._setPaintValue(e,r,A,N,j?null:this.context.lut)}_setPaintValue(e,r,l,u,m){if(this.type==="color"){const g=c(l.toPremultipliedRenderColor(m)),b=c(u.toPremultipliedRenderColor(m));for(let E=e;E<r;E++)this.paintVertexArray.emplace(E,g[0],g[1],b[0],b[1])}else{for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,l,u,m){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,b=Ee(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);r.set(e,m,b)}getBinding(e,r){return new hs(e)}}class k{constructor(e,r,l,u,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(l==="array"?Ji:Gp).members;for(let g=0;g<r.length;++g);this.paintVertexArray=new u,this.paintTransitionVertexArray=new xu}populatePaintArray(e,r,l,u){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,u,m,g,b){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(e,r,l,u){if(!u||!l)return;const m=u[l[0]],g=u[l[1]];if(m){if(m){const{tl:b,br:E,pixelRatio:A}=m;for(let N=e;N<r;N++)this.paintVertexArray.emplace(N,b[0],b[1],E[0],E[1],A)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:E}=g;for(let A=e;A<r;A++)this.paintTransitionVertexArray.emplace(A,b[0],b[1],E[0],E[1])}}}upload(e){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,_l.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class D{constructor(e,r,l=()=>!0){this.binders={},this._buffers=[],this.context=r;const u=[];for(const m in e.paint._values){const g=e.paint.get(m);if(m.endsWith("-use-theme")||!l(m)||!(g instanceof gu&&Sp(g.property.specification)))continue;const b=U(m,e.type),E=g.value,A=g.property.specification.type,N=!!g.property.useIntegerZoom,j=m==="line-dasharray"||m.endsWith("pattern"),R=e.paint.get(`${m}-use-theme`),B=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(E.kind!=="constant"||B)if(E.kind==="source"||B||j){const V=Y(m,A,"source");this.binders[m]=j?new k(E,b,A,V,e.id):new T(E,b,A,V),u.push(`/a_${m}`)}else{const V=Y(m,A,"composite");this.binders[m]=new I(E,b,A,N,r,V),u.push(`/z_${m}`)}else this.binders[m]=j?new S(E.value,b):new x(E.value,b,A,r),u.push(`/u_${m}`);R&&(this.binders[m].lutExpression=R.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof T||r instanceof I?r.maxValue:0}populatePaintArrays(e,r,l,u,m,g,b,E){for(const A in this.binders){const N=this.binders[A];N.context=this.context,(N instanceof T||N instanceof I||N instanceof k)&&N.populatePaintArray(e,r,l,u,m,g,b,E)}}setConstantPatternPositions(e,r){for(const l in this.binders){const u=this.binders[l];u instanceof S&&u.setConstantPatternPositions(e,r)}}getPatternTransitionVertexBuffer(e){const r=this.binders[e];return r instanceof k?r.paintTransitionVertexBuffer:null}updatePaintArrays(e,r,l,u,m,g,b,E,A,N){let j=!1;const R=Object.keys(e),B=R.length!==0&&!E,V=B?R:r.uniqueIds;this.context.lut=m.lut;for(const H in this.binders){const Q=this.binders[H];if(Q.context=this.context,(Q instanceof T||Q instanceof I||Q instanceof k)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const K=m.paint.get(H);Q.expression=K.value;for(const re of V){const ae=e[re.toString()];r.eachPosition(re,(ue,xe,ye)=>{const Ie=u.feature(ue);Q.updatePaintArray(xe,ye,Ie,ae,g,b,A,N)})}if(!B)for(const re of l.uniqueIds){const ae=e[re.toString()];l.eachPosition(re,(ue,xe,ye)=>{const Ie=u.feature(ue);Q.updatePaintArray(xe,ye,Ie,ae,g,b,A,N)})}j=!0}}return j}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof x||l instanceof S)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof x||u instanceof S||u instanceof I)for(const m of u.uniformNames)r.push({name:m,property:l,binding:u.getBinding(e,m)})}return r}setUniforms(e,r,l,u,m){for(const{name:g,property:b,binding:E}of l)this.binders[b].setUniform(e,E,m,u.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof T||r instanceof I||r instanceof k)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof k&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof T||l instanceof I||l instanceof k)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof T||r instanceof I||r instanceof k)&&r.destroy()}}}class O{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new D(u,r,l);this.needsUpload=!1,this._featureMap=new $s,this._featureMapWithoutIds=new $s,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,l,u,m,g,b,E,A){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(e,r,u,m,g,b,E,A);r.id!==void 0?this._featureMap.add(r.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,u,m,g,b,E){for(const A of l)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,A,u,m,g,b||0,E)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const q={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function U(o,e){return q[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const G={"line-pattern":{source:zl,composite:zl},"fill-pattern":{source:zl,composite:zl},"fill-extrusion-pattern":{source:zl,composite:zl},"line-dasharray":{source:xu,composite:xu}},J={color:{source:Su,composite:vu},number:{source:Us,composite:Su}};function Y(o,e,r){const l=G[o];return l&&l[r]||J[e][r]}hr(x,"ConstantBinder"),hr(S,"PatternConstantBinder"),hr(T,"SourceExpressionBinder"),hr(k,"PatternCompositeBinder"),hr(I,"CompositeExpressionBinder"),hr(D,"ProgramConfiguration",{omit:["_buffers"]}),hr(O,"ProgramConfigurationSet");const te=qt/Math.PI/2,le=64,ge=[le,32,16],pe=-te,de=te;function Ne(o,e,r,l=te){return r=vn(r),[o*Math.sin(r)*l,-e*l,o*Math.cos(r)*l]}function Ce(o,e,r){return Ne(Math.cos(vn(o)),Math.sin(vn(o)),e,r)}const ke=63710088e-1,Te=2*Math.PI*ke;class _e{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _e(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,u=e.lat*r,m=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return ke*Math.acos(Math.min(m,1))}toBounds(e=0){const r=360*e/40075017,l=r/Math.cos(Math.PI/180*this.lat);return new Me({lng:this.lng-l,lat:this.lat-r},{lng:this.lng+l,lat:this.lat+r})}toEcef(e){return Ce(this.lat,this.lng,te+e*te/ke)}static convert(e){if(e instanceof _e)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new _e(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new _e(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Me{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof _e?new _e(e.lng,e.lat):_e.convert(e),this}setSouthWest(e){return this._sw=e instanceof _e?new _e(e.lng,e.lat):_e.convert(e),this}extend(e){const r=this._sw,l=this._ne;let u,m;if(e instanceof _e)u=e,m=e;else{if(!(e instanceof Me))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Me.convert(e)):this.extend(_e.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(_e.convert(e)):this;if(u=e._sw,m=e._ne,!u||!m)return this}return r||l?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new _e(u.lng,u.lat),this._ne=new _e(m.lng,m.lat)),this}getCenter(){return new _e((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _e(this.getWest(),this.getNorth())}getSouthEast(){return new _e(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=_e.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Me?e:new Me(e)}}function Ue(o){return Te*Math.cos(o*Math.PI/180)}function Ge(o){return(180+o)/360}function it(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function tt(o,e){return o/Ue(e)}function mt(o){return 360*o-180}function Pt(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Qe(o,e){return o*Ue(Pt(e))}const Le=85.051129;function dt(o){return Math.cos(vn(Ee(o,-85.051129,Le)))}function nt(o,e){const r=Ee(e,0,25.5),l=Math.pow(2,r);return dt(o)*Te/(512*l)}function yt(o){return 1/Math.cos(o*Math.PI/180)}function Dt(o,e=0){const r=Math.exp(Math.PI*(1-(o.y+e/qt)/(1<<o.z)*2));return 80150034*r/(r*r+1)/qt/(1<<o.z)}class Kt{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=_e.convert(e);return new Kt(Ge(l.lng),it(l.lat),tt(r,l.lat))}toLngLat(){return new _e(mt(this.x),Pt(this.y))}toAltitude(){return Qe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Te*yt(Pt(this.y))}}function Ot(o,e,r,l,u,m,g,b,E){const A=(e+l)/2,N=(r+u)/2,j=new Nt(A,N);b(j),(function(R,B,V,H,Q,K){const re=V-Q,ae=H-K;return Math.abs((H-B)*re-(V-R)*ae)/Math.hypot(re,ae)})(j.x,j.y,m.x,m.y,g.x,g.y)>=E?(Ot(o,e,r,A,N,m,j,b,E),Ot(o,A,N,l,u,j,g,b,E)):o.push(g)}function Ft(o,e,r){let l=o[0],u=l.x,m=l.y;e(l);const g=[l];for(let b=1;b<o.length;b++){const E=o[b],{x:A,y:N}=E;e(E),Ot(g,u,m,A,N,l,E,e,r),u=A,m=N,l=E}return g}function gr(o,e,r,l){if(l(e,r)){const u=e.add(r)._mult(.5);gr(o,e,u,l),gr(o,u,r,l)}else o.push(r)}function fr(o,e){let r=o[0];const l=[r];for(let u=1;u<o.length;u++){const m=o[u];gr(l,r,m,e),r=m}return l}const sr=Math.pow(2,14)-1,ar=-sr-1;function Mr(o,e){const r=Math.round(o.x*e),l=Math.round(o.y*e);return o.x=Ee(r,ar,sr),o.y=Ee(l,ar,sr),(r<o.x||r>o.x+1||l<o.y||l>o.y+1)&&Rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Gr(o,e,r){const l=o.loadGeometry(),u=o.extent,m=qt/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:b,x:E,y:A,projection:N}=r,j=R=>{const B=mt((e.x+R.x/u)/g),V=Pt((e.y+R.y/u)/g),H=N.project(B,V);R.x=(H.x*b-E)*u,R.y=(H.y*b-A)*u};for(let R=0;R<l.length;R++)if(o.type!==1)l[R]=Ft(l[R],j,1);else{const B=[];for(const V of l[R])V.x<0||V.x>=u||V.y<0||V.y>=u||(j(V),B.push(V));l[R]=B}}for(const g of l)for(const b of g)Mr(b,m);return l}function tn(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Gr(o):[]}}class Pn{constructor(e,r,l,u,m){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=m,e.readFields(Wr,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,l=[];let u,m=1,g=0,b=0,E=0;for(;e.pos<r;){if(g<=0){const A=e.readVarint();m=7&A,g=A>>3}if(g--,m===1||m===2)b+=e.readSVarint(),E+=e.readSVarint(),m===1&&(u&&l.push(u),u=[]),u&&u.push(new Nt(b,E));else{if(m!==7)throw new Error(`unknown command ${m}`);u&&u.push(u[0].clone())}}return u&&l.push(u),l}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let l=1,u=0,m=0,g=0,b=1/0,E=-1/0,A=1/0,N=-1/0;for(;e.pos<r;){if(u<=0){const j=e.readVarint();l=7&j,u=j>>3}if(u--,l===1||l===2)m+=e.readSVarint(),g+=e.readSVarint(),m<b&&(b=m),m>E&&(E=m),g<A&&(A=g),g>N&&(N=g);else if(l!==7)throw new Error(`unknown command ${l}`)}return[b,A,E,N]}toGeoJSON(e,r,l){const u=this.extent*Math.pow(2,l),m=this.extent*e,g=this.extent*r,b=this.loadGeometry();function E(R){return[360*(R.x+m)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(R.y+g)/u)*Math.PI))-90]}function A(R){return R.map(E)}let N;if(this.type===1){const R=[];for(const V of b)R.push(V[0]);const B=A(R);N=R.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const R=b.map(A);N=R.length===1?{type:"LineString",coordinates:R[0]}:{type:"MultiLineString",coordinates:R}}else{if(this.type!==3)throw new Error("unknown feature type");{const R=(function(V){const H=V.length;if(H<=1)return[V];const Q=[];let K,re;for(let ae=0;ae<H;ae++){const ue=Fn(V[ae]);ue!==0&&(re===void 0&&(re=ue<0),re===ue<0?(K&&Q.push(K),K=[V[ae]]):K&&K.push(V[ae]))}return K&&Q.push(K),Q})(b),B=[];for(const V of R)B.push(V.map(A));N=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const j={type:"Feature",geometry:N,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function Wr(o,e,r){o===1?e.id=r.readVarint():o===2?(function(l,u){const m=l.readVarint()+l.pos;for(;l.pos<m;){const g=u._keys[l.readVarint()],b=u._values[l.readVarint()];u.properties[g]=b}})(r,e):o===3?e.type=r.readVarint():o===4&&(e._geometry=r.pos)}function Fn(o){let e=0;for(let r,l,u=0,m=o.length,g=m-1;u<m;g=u++)r=o[u],l=o[g],e+=(l.x-r.x)*(r.y+l.y);return e}Pn.types=["Unknown","Point","LineString","Polygon"];class rn{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(oi,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Pn(this._pbf,r,this.extent,this._keys,this._values)}}function oi(o,e,r){o===15?e.version=r.readVarint():o===1?e.name=r.readString():o===5?e.extent=r.readVarint():o===2?e._features.push(r.pos):o===3?e._keys.push(r.readString()):o===4&&e._values.push((function(l){let u=null;const m=l.readVarint()+l.pos;for(;l.pos<m;){const g=l.readVarint()>>3;u=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(r))}class hi{constructor(e,r){this.layers=e.readFields(fi,{},r)}}function fi(o,e,r){if(o===3){const l=new rn(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}const On="3d_elevation_id",un="level";class ti{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,l){return this.get(e,!0,r,l)}optional(e,r,l){return this.get(e,!1,r,l)}success(){return this._valid}get(e,r,l,u){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?l(u?u(m):m):r&&(this._valid=!1),this}}class Fi{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,l){return this.featureFunc(e,r,l)}parseVertex(e,r,l){return this.vertexFunc(e,r,l)}}const Bi=new Fi((o,e,r)=>o.reset(e).require(On,l=>{r.id=l}).optional("fixed_height_relative",l=>{r.constantHeight=l},wn.decodeRelativeHeight).geometry(l=>{r.bounds=l},Ud).success(),(o,e,r)=>o.reset(e).require(On,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height_relative",l=>{r.height=l},wn.decodeRelativeHeight).geometry(l=>{r.position=l},wn.getPoint).success()),ri=new Fi((o,e,r)=>o.reset(e).require(On,l=>{r.id=l}).optional("fixed_height",l=>{r.constantHeight=l},wn.decodeMetricHeight).geometry(l=>{r.bounds=l},Ud).success(),(o,e,r)=>o.reset(e).require(On,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height",l=>{r.height=l},wn.decodeMetricHeight).geometry(l=>{r.position=l},wn.getPoint).success());class wn{static getPoint(e){return Ze(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?ri:void 0:Bi}static parse(e){const r=[],l=[],u=e.length,m=new ti;for(let g=0;g<u;g++){const b=e.feature(g),E=b.properties.version,A=wn.getVersionSchema(E);if(A===void 0){Rr(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const N=b.properties.type;if(!N)continue;const j=Pn.types[b.type];if(j==="Point"&&N==="curve_point"){const R={};A.parseVertex(m,b,R)&&r.push(R)}else if(j==="Polygon"&&N==="curve_meta"){const R={};A.parseFeature(m,b,R)&&l.push(R)}}return{vertices:r,features:l}}}class mn{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const u=ui(r,this.dir);if(Math.abs(u)<1e-6)return!1;const m=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/u;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,!0}}class ji{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const u=Hr(r,this.dir);if(Math.abs(u)<1e-6)return!1;const m=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,r,l){if((function(B,V){var H=B[0],Q=B[1],K=B[2],re=V[0],ae=V[1],ue=V[2];return Math.abs(H-re)<=M*Math.max(1,Math.abs(H),Math.abs(re))&&Math.abs(Q-ae)<=M*Math.max(1,Math.abs(Q),Math.abs(ae))&&Math.abs(K-ue)<=M*Math.max(1,Math.abs(K),Math.abs(ue))})(this.pos,e)||r===0)return l[0]=l[1]=l[2]=0,!1;const[u,m,g]=this.dir,b=this.pos[0]-e[0],E=this.pos[1]-e[1],A=this.pos[2]-e[2],N=u*u+m*m+g*g,j=2*(b*u+E*m+A*g),R=j*j-4*N*(b*b+E*E+A*A-r*r);if(R<0){const B=Math.max(-j/2,0),V=b+u*B,H=E+m*B,Q=A+g*B,K=Math.hypot(V,H,Q);return l[0]=V*r/K,l[1]=H*r/K,l[2]=Q*r/K,!1}{const B=(-j-Math.sqrt(R))/(2*N);if(B<0){const V=Math.hypot(b,E,A);return l[0]=b*r/V,l[1]=E*r/V,l[2]=A*r/V,!1}return l[0]=b+u*B,l[1]=E+m*B,l[2]=A+g*B,!0}}}class es{constructor(e,r,l,u,m){this.TL=e,this.TR=r,this.BR=l,this.BL=u,this.horizon=m}static fromInvProjectionMatrix(e,r,l){const u=[-1,1,1],m=[1,1,1],g=[1,-1,1],b=[-1,-1,1],E=Sn(u,u,e),A=Sn(m,m,e),N=Sn(g,g,e),j=Sn(b,b,e);return new es(E,A,N,j,r/l)}}function Pi(o,e,r){let l=1/0,u=-1/0;const m=[];for(const g of o){Dr(m,g,e);const b=Hr(m,r);l=Math.min(l,b),u=Math.max(u,b)}return[l,u]}function Li(o,e){let r=!0;for(let l=0;l<o.planes.length;l++){const u=o.planes[l];let m=0;for(let g=0;g<e.length;g++)m+=+(Hr(u,e[g])+u[3]>=0);if(m===0)return 0;m!==e.length&&(r=!1)}return r?2:1}function bo(o,e){for(const r of o.projections){const l=Pi(e,o.points[0],r.axis);if(r.projection[1]<l[0]||r.projection[0]>l[1])return 0}return 1}function fa(o,e){let r=0;const l=[0,0,0,0];for(let u=0;u<o.length;u++)l[0]=o[u][0],l[1]=o[u][1],l[2]=o[u][2],l[3]=1,pr(l,e)>=0&&r++;return r}class Js{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Wn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Dr([],this.points[2],this.points[3]),Dr([],this.points[0],this.points[3]),Dr([],this.points[4],this.points[0]),Dr([],this.points[5],this.points[1]),Dr([],this.points[6],this.points[2]),Dr([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],m=[l[2],0,-l[0]];this.projections.push({axis:u,projection:Pi(this.points,this.points[0],u)}),this.projections.push({axis:m,projection:Pi(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,r,l,u){const m=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const N=Jt([],A,e),j=1/N[3]/r*m;return(R=N)[0]=(B=N)[0]*(V=[j,j,u?1/N[3]:j,j])[0],R[1]=B[1]*V[1],R[2]=B[2]*V[2],R[3]=B[3]*V[3],R;var R,B,V}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const N=ir([],Ur([],Dr([],g[A[0]],g[A[1]]),Dr([],g[A[2]],g[A[1]]))),j=-Hr(N,g[A[1]]);return N.concat(j)}),E=[];for(let A=0;A<g.length;A++)E.push([g[A][0],g[A][1],g[A][2]]);return new Js(E,b)}intersectsPrecise(e,r,l){for(let u=0;u<r.length;u++)if(!fa(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!fa(e,this.planes[u]))return 0;for(const u of l)for(const m of this.frustumEdges){const g=Ur([],u,m),b=Ar(g);if(b===0)continue;xr(g,g,1/b);const E=Pi(this.points,this.points[0],g),A=Pi(e,this.points[0],g);if(E[0]>A[1]||A[0]>E[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const l=r[3];if(Hr([r[0],r[1],r[2]],e)+l<0)return!1}return!0}}class Wn{static fromPoints(e){const r=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)ze(r,r,u),It(l,l,u);return new Wn(r,l)}static fromTileIdAndHeight(e,r,l){const u=1<<e.canonical.z,m=e.canonical.x,g=e.canonical.y;return new Wn([m/u,g/u,r],[(m+1)/u,(g+1)/u,l])}static applyTransform(e,r){const l=e.getCorners();for(let u=0;u<l.length;++u)Sn(l[u],l[u],r);return Wn.fromPoints(l)}static applyTransformFast(e,r){const l=[r[12],r[13],r[14]],u=[...l];for(let m=0;m<3;m++)for(let g=0;g<3;g++){const b=r[4*g+m],E=b*e.min[g],A=b*e.max[g];l[m]+=Math.min(E,A),u[m]+=Math.max(E,A)}return new Wn(l,u)}static projectAabbCorners(e,r){const l=e.getCorners();for(let u=0;u<l.length;++u)Sn(l[u],l[u],r);return l}constructor(e,r){this.min=e,this.max=r,this.center=xr([],ut([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=Gt(this.min),u=Gt(this.max);for(let m=0;m<r.length;m++)l[m]=r[m]?this.min[m]:this.center[m],u[m]=r[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new Wn(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Li(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Li(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?bo(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?bo(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}hr(Wn,"Aabb");class $a{constructor(e,r){this.feature=e,this.metersToTile=r,this.index=0}get(){const e=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,l=r[1],u=-r[0],m=(e.extent+1)*this.metersToTile;return[new Nt(Math.trunc(e.position[0]+l*m),Math.trunc(e.position[1]+u*m)),new Nt(Math.trunc(e.position[0]-l*m),Math.trunc(e.position[1]-u*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class zs{constructor(e,r,l,u,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Bn(),Bn(),Bn(),Bn(),Bn(),Bn(),Bn()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=r,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=m,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((E=this.vertices[b.a].position)[0]===(A=this.vertices[b.b].position)[0]&&E[1]===A[1]);var E,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:Ze(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const E=this.vertices[b.a].position,A=this.vertices[b.b].position,N=An(Bn(),A,E),j=Yn(N),R=ki(Bn(),N,1/j);this.edgeProps.push({vec:N,dir:R,len:j});const B=this.vertexProps[b.a].dir,V=this.vertexProps[b.b].dir;kr(B,B,R),kr(V,V,R)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||Ri(b.dir,b.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[l,u]=r;return $r(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}computeSlopeNormal(e,r){const l=this.getClosestEdge(e);if(!l)return Ut(0,0,1);const u=l[0],m=this.edges[u],g=this.edgeProps[u].vec,b=Ut(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*r),E=Ut(b[1],-b[0],0);Ur(E,E,b);const A=Ar(E);return A>0?xr(E,E,1/A):Xt(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,l=Number.POSITIVE_INFINITY,u=0;const[m,g,b,E,A,N,j]=this._tmpVec2;ur(j,e.x,e.y);const R=new mn(j,null);for(let B=0;B<this.edges.length;B++){const V=this.edges[B],H=this.edgeProps[B].dir;R.dir=H;const Q=this.vertices[V.a].position,K=this.vertices[V.b].position,re=R.intersectsPlane(Q,this.vertexProps[V.a].dir,m),ae=R.intersectsPlane(K,this.vertexProps[V.b].dir,g);if(!re||!ae)continue;An(b,g,m),An(E,j,m);const ue=ui(b,b),xe=ue>0?ui(E,b)/ue:0,ye=Ee(xe,0,1),Ie=Math.abs((xe-ye)*this.edgeProps[B].len);An(A,j,Q),ur(N,H[1],-H[0]);const Pe=Ie+Math.abs(ui(A,N));Pe<l&&(r=B,l=Pe,u=ye)}return[r,u]}tessellate(e){const r=Rt(),l=Rt(),u=Rt(),m=Rt();for(let g=this.edges.length-1;g>=0;--g){const b=this.edges[g].a,E=this.edges[g].b,{position:A,height:N,extent:j}=this.vertices[b],{position:R,height:B,extent:V}=this.vertices[E],H=this.vertexProps[b].dir,Q=this.vertexProps[E].dir;if(Xt(r,A[0]/e,A[1]/e,N),Xt(l,R[0]/e,R[1]/e,B),Xt(u,H[1],-H[0],0),xr(u,u,j),Xt(m,Q[1],-Q[0],0),xr(m,m,V),this.distSqLines(Ut(r[0]+.5*u[0],r[1]+.5*u[1],r[2]+.5*u[2]),Ut(l[0]-.5*m[0],l[1]-.5*m[1],l[2]-.5*m[2]),Ut(r[0]-.5*u[0],r[1]-.5*u[1],r[2]-.5*u[2]),Ut(l[0]+.5*m[0],l[1]+.5*m[1],l[2]+.5*m[2]))<=.0025000000000000005)continue;const K=this.vertices.length,re=kr(Bn(),A,R);this.vertices.push({position:ki(re,re,.5),height:.5*(N+B),extent:.5*(j+V)});const ae=kr(Bn(),H,Q);this.vertexProps.push({dir:Ri(ae,ae)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:b,b:K}),this.edges.push({a:K,b:E});const ue=An(Bn(),this.vertices[K].position,A),xe=Yn(ue),ye={vec:ue,dir:ki(Bn(),ue,1/xe),len:xe};this.edgeProps.push(ye),this.edgeProps.push(ye)}}distSqLines(e,r,l,u){const m=Mt(Rt(),r,e),g=Mt(Rt(),u,l),b=Mt(Rt(),e,l),E=Hr(m,m),A=Hr(m,g),N=Hr(m,b),j=Hr(g,g),R=Hr(g,b),B=E*j-A*A;if(B===0)return Yr(Ti(m,l,u,Hr(b,g)/Hr(g,g)),e);const V=(E*R-A*N)/B;return Yr(Ti(m,e,r,(A*R-N*j)/B),Ti(g,l,u,V))}}class pa{static parseFrom(e,r){const l=wn.parse(e);if(!l)return[];let{vertices:u,features:m}=l;const g=1/Dt(r);m.sort((N,j)=>N.id-j.id),u.sort((N,j)=>N.id-j.id||N.idx-j.idx),u=u.filter((N,j,R)=>j===R.findIndex(B=>B.id===N.id&&B.idx===N.idx));const b=new Array;let E=0;const A=u.length;for(const N of m){if(N.constantHeight){b.push(new zs(N.id,N.bounds,N.constantHeight));continue}for(;E!==A&&u[E].id<N.id;)E++;if(E===A||u[E].id!==N.id)continue;const j=new Array,R=new Array,B=E;for(;E!==A&&u[E].id===N.id;){const V=u[E];if(j.push({position:V.position,height:V.height,extent:V.extent}),E!==B&&u[E-1].idx===V.idx-1){const H=E-B;R.push({a:H-1,b:H})}E++}b.push(new zs(N.id,N.bounds,void 0,j,R,g))}return b}static getElevationFeature(e,r){if(!r)return;const l=+e.properties[On];return Number.isNaN(l)?void 0:r.find(u=>u.id===l)}}class Ia{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*qt,this.yOffset=(e.y*this.zScale-r.y)*qt)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,l){const u=this.constantElevation(r,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),l))}computeBiasedHeight(e,r){return r<=0?e:e+r*Fe(0,r,e>=0?e:Math.abs(.5*e))}}hr(zs,"ElevationFeature");class _{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new pc,this.indexArray=new Os,this.segments=new Zi,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Us),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,u){}populate(e,r,l,u){const m=this.layers[0],g=[];let b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(const{feature:A,id:N,index:j,sourceLayerIndex:R}of e){const B=this.layers[0]._featureFilter.needGeometry,V=tn(A,B);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),V,l))continue;const H=b?b.evaluate(V,{},l):void 0,Q={id:N,properties:A.properties,type:A.type,sourceLayerIndex:R,index:j,geometry:B?V.geometry:Gr(A,l,u),patterns:{},sortKey:H};g.push(Q)}b&&g.sort((A,N)=>A.sortKey-N.sortKey);let E=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new cd,E=u.projection);for(const A of g){const{geometry:N,index:j,sourceLayerIndex:R}=A,B=e[j].feature;this.addFeature(A,N,j,r.availableImages,l,E,r.brightness,r.elevationFeatures),r.featureIndex.insert(B,N,j,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,r,l,u,m,g,b){this.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,tg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,eg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,r,l,u,m,g,b,E){let A;this.elevationMode!=="none"&&(A=pa.getElevationFeature(e,E));for(const N of r)for(const j of N){const R=j.x,B=j.y;if(R<0||R>=qt||B<0||B>=qt)continue;if(g){const Q=g.projectTilePoint(R,B,m),K=g.upVector(m,R,B);this.addGlobeExtVertex(Q,K),this.addGlobeExtVertex(Q,K),this.addGlobeExtVertex(Q,K),this.addGlobeExtVertex(Q,K)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),H=V.vertexLength;if(this.addCircleVertex(R,B,-1,-1),this.addCircleVertex(R,B,1,-1),this.addCircleVertex(R,B,1,1),this.addCircleVertex(R,B,-1,1),this.elevationMode!=="none"){const Q=A?A.pointElevation(new Nt(R,B)):0;this.hasElevation=this.hasElevation||Q!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,m,b,void 0,this.worldview)}addCircleVertex(e,r,l,u){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*r+(u+1)/2)}addGlobeExtVertex(e,r){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function w(o,e){for(let r=0;r<o.length;r++)if(mr(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(mr(o,e[r]))return!0;return!!ie(o,e)}function P(o,e,r){return!!mr(o,e)||!!Bt(e,o,r)}function z(o,e){if(o.length===1)return Cr(e,o[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let u=0;u<l.length;u++)if(mr(o,l[u]))return!0}for(let r=0;r<o.length;r++)if(Cr(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(ie(o,e[r]))return!0;return!1}function Z(o,e,r){if(o.length>1){if(ie(o,e))return!0;for(let l=0;l<e.length;l++)if(Bt(e[l],o,r))return!0}for(let l=0;l<o.length;l++)if(Bt(o[l],e,r))return!0;return!1}function ie(o,e){if(o.length===0||e.length===0)return!1;for(let r=0;r<o.length-1;r++){const l=o[r],u=o[r+1];for(let m=0;m<e.length-1;m++)if(we(l,u,e[m],e[m+1]))return!0}return!1}function we(o,e,r,l){return ni(o,r,l)!==ni(e,r,l)&&ni(o,e,r)!==ni(o,e,l)}function Ye(o,e,r){return(o.x-r.x)*(e.y-r.y)-(o.y-r.y)*(e.x-r.x)}function ft(o,e,r,l){const u=Ye(o,e,l),m=Ye(o,e,r);if(Math.sign(u)===Math.sign(m))return;const g=Ye(r,l,o),b=g+m-u;return Math.sign(g)!==Math.sign(b)?[g/(g-b),m/(m-u)]:void 0}function Bt(o,e,r){const l=r*r;if(e.length===1)return o.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(vr(o,e[u-1],e[u])<l)return!0;return!1}function vr(o,e,r){const l=e.distSqr(r);if(l===0)return o.distSqr(e);const u=((o.x-e.x)*(r.x-e.x)+(o.y-e.y)*(r.y-e.y))/l;return o.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function Cr(o,e){let r,l,u,m=!1;for(let g=0;g<o.length;g++){r=o[g];for(let b=0,E=r.length-1;b<r.length;E=b++)l=r[b],u=r[E],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(m=!m)}return m}function mr(o,e){let r=!1;for(let l=0,u=o.length-1;l<o.length;u=l++){const m=o[l],g=o[u];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(r=!r)}return r}function Kr(o,e,r,l,u){for(const g of o)if(e<=g.x&&r<=g.y&&l>=g.x&&u>=g.y)return!0;const m=[new Nt(e,r),new Nt(e,u),new Nt(l,u),new Nt(l,r)];if(o.length>2){for(const g of m)if(mr(o,g))return!0}for(let g=0;g<o.length-1;g++)if(on(o[g],o[g+1],m))return!0;return!1}function on(o,e,r){const l=r[0],u=r[2];if(o.x<l.x&&e.x<l.x||o.x>u.x&&e.x>u.x||o.y<l.y&&e.y<l.y||o.y>u.y&&e.y>u.y)return!1;const m=ni(o,e,r[0]);return m!==ni(o,e,r[1])||m!==ni(o,e,r[2])||m!==ni(o,e,r[3])}function nn(o,e,r,l,u,m){let g=e.y-o.y,b=o.x-e.x;if(m=m||0){const E=g*g+b*b;if(E===0)return!0;const A=Math.sqrt(E);g/=A,b/=A}return!((r.x-o.x)*g+(r.y-o.y)*b-m<0||(l.x-o.x)*g+(l.y-o.y)*b-m<0||(u.x-o.x)*g+(u.y-o.y)*b-m<0)}function ps(o,e,r,l,u,m,g){return!(nn(o,e,l,u,m,g)||nn(e,r,l,u,m,g)||nn(r,o,l,u,m,g)||nn(l,u,o,e,r,g)||nn(u,m,o,e,r,g)||nn(m,l,o,e,r,g))}function Lt(o,e,r){const l=e.paint.get(o).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(o)}function xt(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Vt(o,e,r,l,u){if(!e[0]&&!e[1])return o;const m=Nt.convert(e)._mult(u);r==="viewport"&&m._rotate(-l);const g=[];for(let b=0;b<o.length;b++)g.push(o[b].sub(m));return g}function Br(o,e,r,l){const u=Nt.convert(o)._mult(l);return e==="viewport"&&u._rotate(-r),u}let Nn,Hn;function Zn(o,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[o*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}hr(_,"CircleBucket",{omit:["layers"]});class Xn{constructor(e,r,l){this.z=e,this.x=r,this.y=l,this.key=Vl(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const r=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>r&&e.y===this.y>>r}url(e,r){const l=(function(m,g,b){var E=Zn(256*m,256*(g=Math.pow(2,b)-g-1),b),A=Zn(256*(m+1),256*(g+1),b);return E[0]+","+E[1]+","+A[0]+","+A[1]})(this.x,this.y,this.z),u=(function(m,g,b){let E,A="";for(let N=m;N>0;N--)E=1<<N-1,A+=(g&E?1:0)+(b&E?2:0);return A})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yo{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Vl(e,r.z,r.z,r.x,r.y)}}class ai{constructor(e,r,l,u,m){this.overscaledZ=e,this.wrap=r,this.canonical=new Xn(l,+u,+m),this.key=r===0&&e===l?this.canonical.key:Vl(r,e,l,u,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ai(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ai(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Vl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Vl(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ai(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new ai(r,this.wrap,r,l,u),new ai(r,this.wrap,r,l+1,u),new ai(r,this.wrap,r,l,u+1),new ai(r,this.wrap,r,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ai(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ai(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yo(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vl(o,e,r,l,u){const m=1<<Math.min(r,22);let g=m*(u%m)+l%m;return o&&r<22&&(g+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-r)))),16*(32*g+r)+(e-r)}const Ow=[o=>{let e=o.canonical.x-1,r=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,r--),new ai(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,r=o.wrap;return e===1<<o.canonical.z&&(e=0,r++),new ai(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>new ai(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new ai(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];hr(Xn,"CanonicalTileID"),hr(ai,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const _B=Tn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Lv}=_B,xB=Tn([{name:"a_pos_3",components:3,type:"Int16"}]);var fC=Tn([{name:"a_pos",type:"Int16",components:2}]);function Dv(o){return o*te/ke}const vB=[new Wn([pe,pe,pe],[de,de,de]),new Wn([pe,pe,pe],[0,0,de]),new Wn([0,pe,pe],[de,0,de]),new Wn([pe,0,pe],[0,de,de]),new Wn([0,0,pe],[de,de,de])];function pC(o,e,r,l=!0){const u=xr([],o._camera.position,o.worldSize),m=[e,r,1,1];Jt(m,m,o.pixelMatrixInverse),jt(m,m,1/m[3]);const g=ir([],Dr([],m,u)),b=o.globeMatrix,E=[b[12],b[13],b[14]],A=Dr([],E,u),N=Ar(A),j=ir([],A),R=o.worldSize/(2*Math.PI),B=Hr(j,g),V=Math.asin(R/N);if(V<Math.acos(B)){if(!l)return null;const je=[],Oe=[];xr(je,g,N/B),ir(Oe,Dr(Oe,je,A)),ir(g,ut(g,A,xr(g,Oe,Math.tan(V)*N)))}const H=[];new ji(u,g).closestPointOnSphere(E,R,H);const Q=ir([],Ni(b,0)),K=ir([],Ni(b,1)),re=ir([],Ni(b,2)),ae=Hr(Q,H),ue=Hr(K,H),xe=Hr(re,H),ye=$e(Math.asin(-ue/R));let Ie=$e(Math.atan2(ae,xe));Ie=o.center.lng+(function(je,Oe){const ht=(Oe-je+180)%360-180;return ht<-180?ht+360:ht})(o.center.lng,Ie);const Pe=Ge(Ie),Ae=Ee(it(ye),0,1);return new Kt(Pe,Ae)}class bB{constructor(e,r,l){this.a=Dr([],e,l),this.b=Dr([],r,l),this.center=l;const u=ir([],this.a),m=ir([],this.b);this.angle=Math.acos(Hr(u,m))}}function zw(o,e){if(o.angle===0)return null;let r;return r=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),r<0||r>1?null:(function(l,u,m,g){const b=Math.sin(m);return l*(Math.sin((1-g)*m)/b)+u*(Math.sin(g*m)/b)})(o.a[e],o.b[e],o.angle,Ee(r,0,1))+o.center[e]}function Th(o){if(o.z<=1)return vB[o.z+2*o.y+o.x];const e=Fw(Ov(o));return Wn.fromPoints(e)}function Bf(o,e,r){return xr(o,o,1-r),Lr(o,o,e,r)}function mC(o,e,r){for(const l of o)Sn(l,l,e),xr(l,l,r)}function gC(o,e,r,l){const u=e/o.worldSize,m=o.globeMatrix;if(r.z<=1){const Ae=Th(r).getCorners();return mC(Ae,m,u),Wn.fromPoints(Ae)}const g=Ov(r,l),b=Fw(g,te+Dv(o._tileCoverLift));mC(b,m,u);const E=Number.MAX_VALUE,A=[-E,-E,-E],N=[E,E,E];if(g.contains(o.center)){for(const Oe of b)ze(N,N,Oe),It(A,A,Oe);A[2]=0;const Ae=o.point,je=[Ae.x*u,Ae.y*u,0];return ze(N,N,je),It(A,A,je),new Wn(N,A)}if(o._tileCoverLift>0){for(const Ae of b)ze(N,N,Ae),It(A,A,Ae);return new Wn(N,A)}const j=[m[12]*u,m[13]*u,m[14]*u],R=g.getCenter(),B=Ee(o.center.lat,-85.051129,Le),V=Ee(R.lat,-85.051129,Le),H=Ge(o.center.lng),Q=it(B);let K=H-Ge(R.lng);const re=Q-it(V);K>.5?K-=1:K<-.5&&(K+=1);let ae=0;Math.abs(K)>Math.abs(re)?ae=K>=0?1:3:(ae=re>=0?0:2,Lr(j,j,[m[4]*u,m[5]*u,m[6]*u],-Math.sin(vn(re>=0?g.getSouth():g.getNorth()))*te));const ue=b[ae],xe=b[(ae+1)%4],ye=new bB(ue,xe,j),Ie=[zw(ye,0)||ue[0],zw(ye,1)||ue[1],zw(ye,2)||ue[2]],Pe=Wp(o.zoom);if(Pe>0){const Ae=(function({x:Oe,y:ht,z:at},lt,St,bt,wt){const st=1/(1<<at);let Et=Oe*st,gt=Et+st,kt=ht*st,Tt=kt+st,lr=0;const dr=(Et+gt)/2-bt;return dr>.5?lr=-1:dr<-.5&&(lr=1),Et=((Et+lr)*lt-(bt*=lt))*St+bt,gt=((gt+lr)*lt-bt)*St+bt,kt=(kt*lt-(wt*=lt))*St+wt,Tt=(Tt*lt-wt)*St+wt,[[Et,Tt,0],[gt,Tt,0],[gt,kt,0],[Et,kt,0]]})(r,e,o._pixelsPerMercatorPixel,H,Q);for(let Oe=0;Oe<b.length;Oe++)Bf(b[Oe],Ae[Oe],Pe);const je=ut([],Ae[ae],Ae[(ae+1)%4]);xr(je,je,.5),Bf(Ie,je,Pe)}for(const Ae of b)ze(N,N,Ae),It(A,A,Ae);return N[2]=Math.min(ue[2],xe[2]),ze(N,N,Ie),It(A,A,Ie),new Wn(N,A)}function Ov({x:o,y:e,z:r},l=!1){const u=1/(1<<r),m=new _e(mt(o*u),e===(1<<r)-1&&l?-90:Pt((e+1)*u)),g=new _e(mt((o+1)*u),e===0&&l?90:Pt(e*u));return new Me(m,g)}function Fw(o,e=te){const r=vn(o.getNorth()),l=vn(o.getSouth()),u=Math.cos(r),m=Math.cos(l),g=Math.sin(r),b=Math.sin(l),E=o.getWest(),A=o.getEast();return[Ne(m,b,E,e),Ne(m,b,A,e),Ne(u,g,A,e),Ne(u,g,E,e)]}function A_(o,e,r,l){const u=1<<r.z,m=(o/qt+r.x)/u;return Ce(Pt((e/qt+r.y)/u),mt(m),l)}function zv({min:o,max:e}){return 16383/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const yC=new Float64Array(16);function Fv(o){const e=zv(o),r=Ct(yC,[e,e,e]);return Se(r,r,Qr([],o.min))}function Bw(o){const e=(function(l,u){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l})(yC,o.min),r=1/zv(o);return Re(e,e,[r,r,r])}function Vw(o){const e=qt/(2*Math.PI);return o/(2*Math.PI)/e}function _C(o,e){return qt/(512*Math.pow(2,o))*zv(Th(e))}function xC(o,e,r,l,u){const m=Vw(r),g=[o,e,-r/(2*Math.PI)],b=oe(new Float64Array(16));return Se(b,b,g),Re(b,b,[m,m,m]),Be(b,b,vn(-u)),rt(b,b,vn(-l)),b}function Wp(o){return Fe(5,6,o)}function vC(o,e){const r=Ce(e.lat,e.lng),l=(function(V){const H=Ce(V._center.lat,V._center.lng);let Q=Ur([],Ut(0,1,0),H);const K=Ht([],-V.angle,H);Q=Sn(Q,Q,K),Ht(K,-V._pitch,Q);const re=ir([],H);return xr(re,re,Dv(V.cameraToCenterDistance/V.pixelsPerMeter)),Sn(re,re,K),ut([],H,re)})(o);return g=(u=Mt([],l,r))[0],b=u[1],E=u[2],A=(m=r)[0],N=m[1],j=m[2],B=(R=Math.sqrt((g*g+b*b+E*E)*(A*A+N*N+j*j)))&&Hr(u,m)/R,Math.acos(Math.min(Math.max(B,-1),1));var u,m,g,b,E,A,N,j,R,B}function Uw(o,e){return vC(o,e)>Math.PI/2*1.01}const bC=vn(85),wB=Math.cos(bC),SB=Math.sin(bC),TB=he(),wC=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function SC(o,e,r,l,u,m,g,b,E){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(E*=o.pixelToTileUnitsFactor);const A=o.tileID.canonical,N=r.projection.upVectorScale(A,r.center.lat,r.worldSize).metersToTile;for(const j of e)for(const R of j){const B=R.add(b),V=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(B.x,B.y,!0):0,H=r.projection.projectTilePoint(B.x,B.y,A);if(V>0){const ae=r.projection.upVector(A,B.x,B.y);H.x+=ae[0]*N*V,H.y+=ae[1]*N*V,H.z+=ae[2]*N*V}const Q=m?B:EB(H.x,H.y,H.z,l),K=m?o.tilespaceRays.map(ae=>AB(ae,V)):o.queryGeometry.screenGeometry,re=Jt([],[H.x,H.y,H.z,1],l);if(!g&&m?E*=re[3]/r.cameraToCenterDistance:g&&!m&&(E*=r.cameraToCenterDistance/re[3]),m){const ae=Pt((R.y/qt+A.y)/(1<<A.z));E/=r.projection.pixelsPerMeter(ae,1)/tt(1,ae)}if(P(K,Q,E))return!0}return!1}function EB(o,e,r,l){const u=Jt([],[o,e,r,1],l);return new Nt(u[0]/u[3],u[1]/u[3])}const TC=Ut(0,0,0),CB=Ut(0,0,1);function AB(o,e){const r=Rt();return TC[2]=e,o.intersectsPlane(TC,CB,r),new Nt(r[0],r[1])}class EC extends _{}let CC,AC,IC,PC;function kC(o,{width:e,height:r},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*l);return o.width=e,o.height=r,o.data=u,o}function NC(o,e,r){const{width:l,height:u}=e;l===o.width&&u===o.height||($w(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,u)},r,null),o.width=l,o.height=u,o.data=e.data)}function $w(o,e,r,l,u,m,g,b){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||r.x>o.width-u.width||r.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const E=o.data,A=e.data,N=m===4&&b;for(let j=0;j<u.height;j++){const R=((r.y+j)*o.width+r.x)*m,B=((l.y+j)*e.width+l.x)*m;if(N)for(let V=0;V<u.width;V++){const H=R+V*m+3,Q=B+V*m;A[Q+0]=255,A[Q+1]=255,A[Q+2]=255,A[Q+3]=E[H]}else if(g)for(let V=0;V<u.width;V++){const H=R+V*m,Q=B+V*m,K=new ii(E[H+0]/255,E[H+1]/255,E[H+2]/255,E[H+3]).toNonPremultipliedRenderColor(g).toArray();A[Q+0]=K[0],A[Q+1]=K[1],A[Q+2]=K[2],A[Q+3]=K[3]}else for(let V=0;V<u.width*m;V++)A[B+V]=E[R+V]}return e}hr(EC,"HeatmapBucket",{omit:["layers"]});class Hp{constructor(e,r){kC(this,e,1,r)}resize(e){NC(this,new Hp(e),1)}clone(){return new Hp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,u,m){$w(e,r,l,u,m,1,null)}}class ma{constructor(e,r){kC(this,e,4,r)}resize(e){NC(this,new ma(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,u,m,g,b){$w(e,r,l,u,m,4,g,b)}}class jC{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function I_(o){const e={},r=o.resolution||256,l=o.clips?o.clips.length:1,u=o.image||new ma({width:r,height:l}),m=(g,b,E)=>{e[o.evaluationKey]=E;const A=o.expression.evaluate(e),N=A?A.toNonPremultipliedRenderColor(null):null;N&&(u.data[g+b+0]=Math.floor(255*N.r),u.data[g+b+1]=Math.floor(255*N.g),u.data[g+b+2]=Math.floor(255*N.b),u.data[g+b+3]=Math.floor(255*N.a))};if(o.clips)for(let g=0,b=0;g<l;++g,b+=4*r)for(let E=0,A=0;E<r;E++,A+=4){const N=E/(r-1),{start:j,end:R}=o.clips[g];m(b,A,j*(1-N)+R*N)}else for(let g=0,b=0;g<r;g++,b+=4)m(0,b,g/(r-1));return u}hr(Hp,"AlphaImage"),hr(ma,"RGBAImage");const IB=Tn([{name:"a_pos",components:2,type:"Int16"}],4),PB=Tn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),kB=Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),NB=Tn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function ey(o,e,r=2){const l=e&&e.length,u=l?e[0]*r:o.length;let m=RC(o,0,u,r,!0);const g=[];if(!m||m.next===m.prev)return g;let b,E,A;if(l&&(m=(function(N,j,R,B){const V=[];for(let H=0,Q=j.length;H<Q;H++){const K=RC(N,j[H]*B,H<Q-1?j[H+1]*B:N.length,B,!1);K===K.next&&(K.steiner=!0),V.push(FB(K))}V.sort(DB);for(let H=0;H<V.length;H++)R=OB(V[H],R);return R})(o,e,m,r)),o.length>80*r){b=o[0],E=o[1];let N=b,j=E;for(let R=r;R<u;R+=r){const B=o[R],V=o[R+1];B<b&&(b=B),V<E&&(E=V),B>N&&(N=B),V>j&&(j=V)}A=Math.max(N-b,j-E),A=A!==0?32767/A:0}return P_(m,g,r,b,E,A,0),g}function RC(o,e,r,l,u){let m;if(u===(function(g,b,E,A){let N=0;for(let j=b,R=E-A;j<E;j+=A)N+=(g[R]-g[j])*(g[j+1]+g[R+1]),R=j;return N})(o,e,r,l)>0)for(let g=e;g<r;g+=l)m=OC(g/l|0,o[g],o[g+1],m);else for(let g=r-l;g>=e;g-=l)m=OC(g/l|0,o[g],o[g+1],m);return m&&ty(m,m.next)&&(j_(m),m=m.next),m}function rg(o,e){if(!o)return o;e||(e=o);let r,l=o;do if(r=!1,l.steiner||!ty(l,l.next)&&wo(l.prev,l,l.next)!==0)l=l.next;else{if(j_(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function P_(o,e,r,l,u,m,g){if(!o)return;!g&&m&&(function(E,A,N,j){let R=E;do R.z===0&&(R.z=qw(R.x,R.y,A,N,j)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,(function(B){let V,H=1;do{let Q,K=B;B=null;let re=null;for(V=0;K;){V++;let ae=K,ue=0;for(let ye=0;ye<H&&(ue++,ae=ae.nextZ,ae);ye++);let xe=H;for(;ue>0||xe>0&&ae;)ue!==0&&(xe===0||!ae||K.z<=ae.z)?(Q=K,K=K.nextZ,ue--):(Q=ae,ae=ae.nextZ,xe--),re?re.nextZ=Q:B=Q,Q.prevZ=re,re=Q;K=ae}re.nextZ=null,H*=2}while(V>1)})(R)})(o,l,u,m);let b=o;for(;o.prev!==o.next;){const E=o.prev,A=o.next;if(m?RB(o,l,u,m):jB(o))e.push(E.i,o.i,A.i),j_(o),o=A.next,b=A.next;else if((o=A)===b){g?g===1?P_(o=MB(rg(o),e),e,r,l,u,m,2):g===2&&LB(o,e,r,l,u,m):P_(rg(o),e,r,l,u,m,1);break}}}function jB(o){const e=o.prev,r=o,l=o.next;if(wo(e,r,l)>=0)return!1;const u=e.x,m=r.x,g=l.x,b=e.y,E=r.y,A=l.y,N=Math.min(u,m,g),j=Math.min(b,E,A),R=Math.max(u,m,g),B=Math.max(b,E,A);let V=l.next;for(;V!==e;){if(V.x>=N&&V.x<=R&&V.y>=j&&V.y<=B&&k_(u,b,m,E,g,A,V.x,V.y)&&wo(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function RB(o,e,r,l){const u=o.prev,m=o,g=o.next;if(wo(u,m,g)>=0)return!1;const b=u.x,E=m.x,A=g.x,N=u.y,j=m.y,R=g.y,B=Math.min(b,E,A),V=Math.min(N,j,R),H=Math.max(b,E,A),Q=Math.max(N,j,R),K=qw(B,V,e,r,l),re=qw(H,Q,e,r,l);let ae=o.prevZ,ue=o.nextZ;for(;ae&&ae.z>=K&&ue&&ue.z<=re;){if(ae.x>=B&&ae.x<=H&&ae.y>=V&&ae.y<=Q&&ae!==u&&ae!==g&&k_(b,N,E,j,A,R,ae.x,ae.y)&&wo(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,ue.x>=B&&ue.x<=H&&ue.y>=V&&ue.y<=Q&&ue!==u&&ue!==g&&k_(b,N,E,j,A,R,ue.x,ue.y)&&wo(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ae&&ae.z>=K;){if(ae.x>=B&&ae.x<=H&&ae.y>=V&&ae.y<=Q&&ae!==u&&ae!==g&&k_(b,N,E,j,A,R,ae.x,ae.y)&&wo(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;ue&&ue.z<=re;){if(ue.x>=B&&ue.x<=H&&ue.y>=V&&ue.y<=Q&&ue!==u&&ue!==g&&k_(b,N,E,j,A,R,ue.x,ue.y)&&wo(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function MB(o,e){let r=o;do{const l=r.prev,u=r.next.next;!ty(l,u)&&LC(l,r,r.next,u)&&N_(l,u)&&N_(u,l)&&(e.push(l.i,r.i,u.i),j_(r),j_(r.next),r=o=u),r=r.next}while(r!==o);return rg(r)}function LB(o,e,r,l,u,m){let g=o;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&BB(g,b)){let E=DC(g,b);return g=rg(g,g.next),E=rg(E,E.next),P_(g,e,r,l,u,m,0),void P_(E,e,r,l,u,m,0)}b=b.next}g=g.next}while(g!==o)}function DB(o,e){let r=o.x-e.x;return r===0&&(r=o.y-e.y,r===0)&&(r=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function OB(o,e){const r=(function(u,m){let g=m;const b=u.x,E=u.y;let A,N=-1/0;if(ty(u,g))return g;do{if(ty(u,g.next))return g.next;if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const H=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(H<=b&&H>N&&(N=H,A=g.x<g.next.x?g:g.next,H===b))return A}g=g.next}while(g!==m);if(!A)return null;const j=A,R=A.x,B=A.y;let V=1/0;g=A;do{if(b>=g.x&&g.x>=R&&b!==g.x&&MC(E<B?b:N,E,R,B,E<B?N:b,E,g.x,g.y)){const H=Math.abs(E-g.y)/(b-g.x);N_(g,u)&&(H<V||H===V&&(g.x>A.x||g.x===A.x&&zB(A,g)))&&(A=g,V=H)}g=g.next}while(g!==j);return A})(o,e);if(!r)return e;const l=DC(r,o);return rg(l,l.next),rg(r,r.next)}function zB(o,e){return wo(o.prev,o,e.prev)<0&&wo(e.next,o,o.next)<0}function qw(o,e,r,l,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function FB(o){let e=o,r=o;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==o);return r}function MC(o,e,r,l,u,m,g,b){return(u-g)*(e-b)>=(o-g)*(m-b)&&(o-g)*(l-b)>=(r-g)*(e-b)&&(r-g)*(m-b)>=(u-g)*(l-b)}function k_(o,e,r,l,u,m,g,b){return!(o===g&&e===b)&&MC(o,e,r,l,u,m,g,b)}function BB(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!(function(r,l){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==l.i&&u.next.i!==l.i&&LC(u,u.next,r,l))return!0;u=u.next}while(u!==r);return!1})(o,e)&&(N_(o,e)&&N_(e,o)&&(function(r,l){let u=r,m=!1;const g=(r.x+l.x)/2,b=(r.y+l.y)/2;do u.y>b!=u.next.y>b&&u.next.y!==u.y&&g<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next;while(u!==r);return m})(o,e)&&(wo(o.prev,o,e.prev)||wo(o,e.prev,e))||ty(o,e)&&wo(o.prev,o,o.next)>0&&wo(e.prev,e,e.next)>0)}function wo(o,e,r){return(e.y-o.y)*(r.x-e.x)-(e.x-o.x)*(r.y-e.y)}function ty(o,e){return o.x===e.x&&o.y===e.y}function LC(o,e,r,l){const u=Vv(wo(o,e,r)),m=Vv(wo(o,e,l)),g=Vv(wo(r,l,o)),b=Vv(wo(r,l,e));return u!==m&&g!==b||!(u!==0||!Bv(o,r,e))||!(m!==0||!Bv(o,l,e))||!(g!==0||!Bv(r,o,l))||!(b!==0||!Bv(r,e,l))}function Bv(o,e,r){return e.x<=Math.max(o.x,r.x)&&e.x>=Math.min(o.x,r.x)&&e.y<=Math.max(o.y,r.y)&&e.y>=Math.min(o.y,r.y)}function Vv(o){return o>0?1:o<0?-1:0}function N_(o,e){return wo(o.prev,o,o.next)<0?wo(o,e,o.next)>=0&&wo(o,o.prev,e)>=0:wo(o,e,o.prev)<0||wo(o,o.next,e)<0}function DC(o,e){const r=Gw(o.i,o.x,o.y),l=Gw(e.i,e.x,e.y),u=o.next,m=e.prev;return o.next=e,e.prev=o,r.next=u,u.prev=r,l.next=r,r.prev=l,m.next=l,l.prev=m,l}function OC(o,e,r,l){const u=Gw(o,e,r);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function j_(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Gw(o,e,r){return{i:o,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function R_(o,e){const r=o.length;if(r<=1)return[o];const l=[];let u,m;for(let g=0;g<r;g++){const b=$i(o[g]);b!==0&&(o[g].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(u&&l.push(u),u=[o[g]]):u.push(o[g]))}if(u&&l.push(u),e>1)for(let g=0;g<l.length;g++)l[g].length<=e||(Qh(l[g],e,1,l[g].length-1,VB),l[g]=l[g].slice(0,e));return l}function VB(o,e){return e.area-o.area}function zC(o,e,r=1){if(!o)return null;const l=typeof o=="string"?wa.from(o).getPrimary():o.getPrimary(),u=typeof o=="string"?null:o.getSecondary();for(const m of[l,u]){if(!m)continue;const g=m.id.toString();e.has(g)||e.set(g,[]),m.scaleSelf(r),e.get(g).push(m)}return{primary:l.toString(),secondary:u?u.toString():null}}function Ww(o,e,r,l){const u=l.patternDependencies;let m=!1;for(const g of e){const b=g.paint.get(`${o}-pattern`);b.isConstant()||(m=!0),zC(b.constantOr(null),u,r)&&(m=!0)}return m}function Hw(o,e,r,l,u,m){const g=m.patternDependencies;for(const b of e){const E=b.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let A=E.evaluate({zoom:l},r,{},m.availableImages);A=A&&A.name?A.name:A;const N=zC(A,g,u);if(!N)continue;const{primary:j,secondary:R}=N;j&&(r.patterns[b.id]=[j,R].filter(Boolean))}}return r}class Vf{constructor(){this.portals=[]}static isOnBorder(e,r){return e<=0&&r<=0||e>=qt&&r>=qt}static evaluate(e){if(e.length===0)return new Vf;let r=[];for(const E of e)r.push(...E.portals);if(r.length===0)return new Vf;for(const E of r){const A=E.va,N=E.vb;(Vf.isOnBorder(A.x,N.x)||Vf.isOnBorder(A.y,N.y))&&(E.type="border")}const l=r.filter(E=>E.type!=="unevaluated"),u=r.filter(E=>E.type==="unevaluated");if(u.length===0)return new Vf;u.sort((E,A)=>E.hash===A.hash?E.isTunnel===A.isTunnel?0:E.isTunnel?-1:1:E.hash<A.hash?1:-1),r=l.concat(u);let m=l.length,g=m,b=m;do if(g++,g===r.length||r[m].hash!==r[g].hash){if(g-m===2){b<m&&(r[b]=r[m],r[m]=null);const E=r[b],A=r[g-1];E.type=E.isTunnel!==A.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:A.connection.a},b++}m=g}while(m!==r.length);return r.splice(b),r.sort((E,A)=>E.hash<A.hash?1:-1),{portals:r}}}hr(Vf,"ElevationPortalGraph");class UB{constructor(e,r,l){this.outPositions=e,this.outNormals=r,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,r,l){let u=e[2];l!=null&&(u*=l);const m=`${e[0]},${e[1]},${e[2]},${r[0]},${r[1]},${r[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;const b=this.outPositions.length;this.vertexLookup.set(m,b);const E=Math.trunc(16384*r[0]),A=Math.trunc(16384*r[1]),N=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(E,A,N),b}addTriangle(e,r,l){this.outIndices.emplaceBack(e,r,l)}addTriangles(e,r,l){if(e.length===0)return;const u=l.length===1,m=Rt(),g=Rt();for(let b=0;b<e.length;b+=3){const E=r[e[b+0]],A=r[e[b+1]],N=r[e[b+2]],j=u?l[0]:l[e[b+1]],R=u?l[0]:l[e[b+2]];Xt(m,E.x,E.y,u?l[0]:l[e[b+0]]);const B=this.addVertex(m,g);Xt(m,A.x,A.y,j);const V=this.addVertex(m,g);Xt(m,N.x,N.y,R);const H=this.addVertex(m,g);this.outIndices.emplaceBack(B,V,H)}}addQuad(e,r,l,u,m,g){const b=this.addVertex(e,m,g),E=this.addVertex(r,m,g),A=this.addVertex(l,m,g),N=this.addVertex(u,m,g);this.addTriangle(b,E,A),this.addTriangle(A,N,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ul{constructor(e,r,l,u){this.unevaluatedPortals=new Vf,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new _u,this.vertexNormals=new Bp,this.indexArray=new Os,this.tileToMeters=Dt(e),this.bridgeProgramConfigurations=new O(r,{zoom:l,lut:u},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new O(r,{zoom:l,lut:u},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,r){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(r[u]);return l}addTriangles(e,r,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)u.push(m+r)}addRenderableRing(e,r,l,u,m,g){const b=[new Nt(m.min.x,m.min.y),new Nt(m.max.x,m.min.y),new Nt(m.max.x,m.max.y),new Nt(m.min.x,m.max.y)];for(let E=0;E<l-1;E++){const A=r+E,N=A+1,j=this.unevalVertices[A],R=this.unevalVertices[N];if(!(j.x>=m.min.x&&j.x<=m.max.x&&j.y>=m.min.y&&j.y<=m.max.y||R.x>=m.min.x&&R.x<=m.max.x&&R.y>=m.min.y&&R.y<=m.max.y||on(j,R,b))||this.isOnBorder(j.x,R.x)||this.isOnBorder(j.y,R.y))continue;const B=Ul.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[N]);let V,H=this.vertexHashLookup.get(Ul.computePosHash(j));H!=null?V=H.next:(H=this.vertexHashLookup.get(Ul.computePosHash(R)),V=H!=null?H.prev:B),this.unevalEdges.push({polygonIdx:e,a:A,b:N,hash:B,portalHash:V,isTunnel:u,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,r,l,u,m){if(r.length!==0){this.vertexHashLookup.clear();for(const g of r){if(g.length===0)continue;const b=g[0];let E=Ul.computeEdgeHash(b[b.length-2],b[b.length-1]);for(let A=0;A<b.length-1;A++){const N=b[A+0],j=b[A+1],R=Ze(j.x-N.x,j.y-N.y),B=Yn(R);if(B===0)continue;let V="unevaluated";const H=u.pointElevation(N),Q=u.pointElevation(j);Math.abs(H)<.01&&Math.abs(Q)<.01?V="entrance":(this.isOnBorder(N.x,j.x)||this.isOnBorder(N.y,j.y))&&(V="border");const K=Ul.computeEdgeHash(N,j);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:N,vb:j,vab:R,length:B,hash:K,isTunnel:l,type:V});const re=Ul.computePosHash(N);this.vertexHashLookup.set(re,{prev:E,next:K}),E=K}}}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},u=new UB(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=r(),g=r(),b=r(),E=(R,B)=>{R.sort((H,Q)=>H.type===B&&Q.type!==B?-1:H.type!==B&&Q.type===B?1:0);const V=R.findIndex(H=>H.type!==B);return V>=0?V:R.length};let A=0;this.unevalEdges.length>0&&(A=E(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),l(b);const N=r(),j=r();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(A),B=E(R,"tunnel")+A;this.unevalEdges.push(...R),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:B})}l(N),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(j),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(g),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(m),this.maskSegments=Zi.simpleSegment(0,j.primitiveOffset,0,j.primitiveLength),this.depthSegments=Zi.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=Zi.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=Zi.simpleSegment(0,N.primitiveOffset,0,N.primitiveLength),this.shadowCasterSegments=Zi.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,r,l,u,m,g,b,E){this.bridgeProgramConfigurations.updatePaintArrays(e,r,m,l,u,g,b,E),this.tunnelProgramConfigurations.updatePaintArrays(e,r,m,l,u,g,b,E)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,kB.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,NB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,r,l,u,m){const g=(b,E)=>{for(let A=0;A<E.length-1;A++){const N=E[A].featureIndex,j=E[A+1].vertexStart,R=e.feature(N);b.populatePaintArrays(j,R,N,{},l,r,u,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,r,l,u,m){const g=new Map;for(let b=u;b<m;b++){const E=l[b],A=E.a,N=E.b,j=Ul.computePosHash(e[A]),R=Ul.computePosHash(e[N]);let B=g.get(j);B||(B={},g.set(j,B));let V=g.get(R);V||(V={},g.set(R,V)),r[A]<=0&&r[N]<=0||(B.to=N,V.from=A)}return g}isTerminalVertex(e,r){const l=Ul.computePosHash(this.unevalVertices[e]),u=r.get(l);return!u||!u.from||!u.to}constructBridgeStructures(e,r,l,u,m,g){e.clearVertexLookup();const b=this.computeVertexConnections(r,l,u,m.min,m.max),E=1/g,A=.5*E,N=(St,bt)=>Xt(St,r[bt].x,r[bt].y,l[bt]*E),j=Rt(),R=Rt(),B=Rt(),V=Rt(),H=Rt(),Q=(St,bt)=>{const wt=b.get(Ul.computePosHash(r[bt])),st=wt.from,Et=wt.to;if(!st||!Et)return;N(j,st),N(R,bt),N(B,Et),pt(V),Sr(j,R)||(Dr(H,R,j),ir(V,H)),Sr(B,R)||(Dr(H,B,R),ut(V,V,ir(H,H)));const gt=Ke(V);return gt>0?xr(St,V,1/gt):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(u,m.min,m.max,(St,bt)=>St.featureInfo.featureIndex-bt.featureInfo.featureIndex);const re=Rt(),ae=Rt(),ue=Rt(),xe=Rt(),ye=Rt(),Ie=Rt(),Pe=Rt(),Ae=Rt(),je=Rt(),Oe=[Rt(),Rt(),Rt(),Rt()],ht=[Rt(),Rt(),Rt(),Rt()],at=[{coord:new Nt(0,0),height:0},{coord:new Nt(0,0),height:0}],lt=(St,bt)=>St>bt;for(let St=m.min;St<m.max;St++){const bt=u[St];if(!bt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(at,r,l,bt,lt))continue;const[wt,st]=at;if(Xt(re,wt.coord.x,wt.coord.y,E*wt.height),Xt(ae,st.coord.x,st.coord.y,E*st.height),Sr(re,ae))continue;Dr(ue,ae,re),ir(ue,ue);const Et=Q(Ae,bt.a)||ue,gt=Q(je,bt.b)||ue;Xt(xe,Et[1],-Et[0],0),ir(xe,xe),Xt(ye,gt[1],-gt[0],0),ir(ye,ye),Ur(Ae,xe,Et),ir(Ie,Ae),Ur(Ae,ye,gt),ir(Pe,Ae),ut(Oe[0],re,xr(Ae,Dr(Ae,xe,Ie),A)),ut(Oe[1],re,xr(Ae,ut(Ae,xe,Ie),A)),ut(Oe[2],re,xr(Ae,Ie,A)),Oe[3]=re,ut(ht[0],ae,xr(Ae,Dr(Ae,ye,Pe),A)),ut(ht[1],ae,xr(Ae,ut(Ae,ye,Pe),A)),ut(ht[2],ae,xr(Ae,Pe,A)),ht[3]=ae,K=this.addFeatureSection(bt.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const kt=e.addVertex(Oe[0],xe,g),Tt=e.addVertex(Oe[1],xe,g),lr=e.addVertex(ht[0],ye,g),dr=e.addVertex(ht[1],ye,g);e.addTriangle(kt,Tt,lr),e.addTriangle(Tt,dr,lr);const Wt=e.addVertex(Oe[1],Ie,g),Yt=e.addVertex(Oe[2],Ie,g),Fr=e.addVertex(ht[1],Pe,g),wr=e.addVertex(ht[2],Pe,g);e.addTriangle(Wt,Yt,Fr),e.addTriangle(Yt,wr,Fr),Qr(xe,xe),Qr(ye,ye);const nr=e.addVertex(Oe[2],xe,g),en=e.addVertex(Oe[3],xe,g),kn=e.addVertex(ht[2],ye,g),li=e.addVertex(ht[3],ye,g);e.addTriangle(nr,en,kn),e.addTriangle(en,li,kn);const En=this.isTerminalVertex(bt.a,b),Ai=this.isTerminalVertex(bt.b,b);wt.height<.01&&En&&e.addQuad(Oe[3],Oe[2],Oe[1],Oe[0],Qr(Et,Et),g),st.height<.01&&Ai&&e.addQuad(ht[0],ht[1],ht[2],ht[3],gt,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,r,l,u,m,g){e.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const E=(K,re)=>K.featureInfo.featureIndex-re.featureInfo.featureIndex;this.sortSubarray(u,m.min,m.max,E),this.sortSubarray(u,g.min,g.max,E);const A=K=>ir(K,K),N=[{coord:new Nt(0,0),height:0},{coord:new Nt(0,0),height:0}],j=(K,re)=>K<re,R=Rt(),B=Rt(),V=Rt(),H=Rt(),Q=Rt();for(let K=m.min;K<m.max;K++){if(!this.prepareEdgePoints(N,r,l,u[K],j))continue;const[re,ae]=N,ue=A(Xt(Q,-(ae.coord.y-re.coord.y),ae.coord.x-re.coord.x,0));b=this.addFeatureSection(u[K].featureInfo.featureIndex,b,this.tunnelFeatureSections,e),e.addQuad(Xt(R,re.coord.x,re.coord.y,re.height),Xt(B,ae.coord.x,ae.coord.y,ae.height),Xt(V,ae.coord.x,ae.coord.y,u[K].isTunnel?-.1:0),Xt(H,re.coord.x,re.coord.y,u[K].isTunnel?-.1:0),ue)}for(let K=g.min;K<g.max;K++){const re=u[K];re.isTunnel&&([re.a,re.b]=[re.b,re.a]);const ae=r[re.a],ue=r[re.b],xe=A(Xt(Q,-(ue.y-ae.y),ue.x-ae.x,0));b=this.addFeatureSection(re.featureInfo.featureIndex,b,this.tunnelFeatureSections,e),e.addQuad(Xt(R,ue.x,ue.y,0),Xt(B,ae.x,ae.y,0),Xt(V,ae.x,ae.y,l[re.a]+4),Xt(H,ue.x,ue.y,l[re.b]+4),xe),e.addQuad(Xt(R,ae.x,ae.y,0),Xt(B,ue.x,ue.y,0),Xt(V,ue.x,ue.y,l[re.b]+4),Xt(H,ae.x,ae.y,l[re.a]+4),xe)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,r,l,u){e.coord.x=r,e.coord.y=l,e.height=u}prepareEdgePoints(e,r,l,u,m){let g=r[u.a].x,b=r[u.a].y,E=r[u.b].x,A=r[u.b].y,N=l[u.a],j=l[u.b];const R=m(N,0),B=m(j,0);if(R&&B)return this.setElevatedPoint(e[0],g,b,N),this.setElevatedPoint(e[1],E,A,j),!0;if(!R&&!B)return!1;if(R){if(!B){const V=j/(j-N);E=$r(E,g,V),A=$r(A,b,V),j=$r(j,N,V)}}else{const V=N/(N-j);g=$r(g,E,V),b=$r(b,A,V),N=$r(N,j,V)}return this.setElevatedPoint(e[0],g,b,N),this.setElevatedPoint(e[1],E,A,j),!0}prepareEdges(e,r){if(r.length===0)return;r.sort((b,E)=>b.hash===E.hash?E.polygonIdx-b.polygonIdx:E.hash>b.hash?1:-1);let l=0,u=0,m=0,g=r[l].polygonIdx;do u++,(u===r.length||r[l].hash!==r[u].hash)&&((u-l===1||r[u-1].polygonIdx!==g)&&(m<l&&(r[m]=r[l],r[l]=null),r[m].type="none",m++),l=u,l!==r.length&&(g=r[l].polygonIdx));while(l!==r.length);if(r.splice(m),r.length!==0&&e.length!==0){r.sort((A,N)=>A.portalHash<N.portalHash?1:-1);let b=0,E=0;for(;b!==r.length&&E!==e.length;){const A=r[b],N=e[E];A.portalHash>N.hash?b++:N.hash>A.portalHash?E++:(A.type=N.type,b++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=qt&&r>=qt}addFeatureSection(e,r,l,u){return e!==r&&(r=e,l.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),r}sortSubarray(e,r,l,u){const m=e.slice(r,l);m.sort(u),e.splice(r,m.length,...m)}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(Ul.computePosHash(e))<<32n|BigInt(Ul.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}function $B(o,e){return o>e?1:o<e?-1:0}class Zw{constructor(e=$B,r=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!r}rotateLeft(e){var r=e.right;r&&(e.right=r.left,r.left&&(r.left.parent=e),r.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=r:e.parent.right=r:this._root=r,r&&(r.left=e),e.parent=r}rotateRight(e){var r=e.left;r&&(e.left=r.right,r.right&&(r.right.parent=e),r.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=r:e.parent.right=r:this._root=r,r&&(r.right=e),e.parent=r}_splay(e){for(;e.parent;){var r=e.parent;r.parent?r.left===e&&r.parent.left===r?(this.rotateRight(r.parent),this.rotateRight(r)):r.right===e&&r.parent.right===r?(this.rotateLeft(r.parent),this.rotateLeft(r)):r.left===e&&r.parent.right===r?(this.rotateRight(r),this.rotateLeft(r)):(this.rotateLeft(r),this.rotateRight(r)):r.left===e?this.rotateRight(r):this.rotateLeft(r)}}splay(e){for(var r,l,u,m,g;e.parent;)(l=(r=e.parent).parent)&&l.parent?((u=l.parent).left===l?u.left=e:u.right=e,e.parent=u):(e.parent=null,this._root=e),m=e.left,g=e.right,e===r.left?(l&&(l.left===r?(r.right?(l.left=r.right,l.left.parent=l):l.left=null,r.right=l,l.parent=r):(m?(l.right=m,m.parent=l):l.right=null,e.left=l,l.parent=e)),g?(r.left=g,g.parent=r):r.left=null,e.right=r,r.parent=e):(l&&(l.right===r?(r.left?(l.right=r.left,l.right.parent=l):l.right=null,r.left=l,l.parent=r):(g?(l.left=g,g.parent=l):l.left=null,e.right=l,l.parent=e)),m?(r.right=m,m.parent=r):r.right=null,e.left=r,r.parent=e)}replace(e,r){e.parent?e===e.parent.left?e.parent.left=r:e.parent.right=r:this._root=r,r&&(r.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,r){var l=this._root,u=null,m=this._compare;if(this._noDuplicates)for(;l;){if(u=l,m(l.key,e)===0)return;l=m(l.key,e)<0?l.right:l.left}else for(;l;)u=l,l=m(l.key,e)<0?l.right:l.left;return l={key:e,data:r,left:null,right:null,parent:u},u?m(u.key,l.key)<0?u.right=l:u.left=l:this._root=l,this.splay(l),this._size++,l}find(e){for(var r=this._root,l=this._compare;r;){var u=l(r.key,e);if(u<0)r=r.right;else{if(!(u>0))return r;r=r.left}}return null}contains(e){for(var r=this._root,l=this._compare;r;){var u=l(e,r.key);if(u===0)return!0;r=u<0?r.left:r.right}return!1}remove(e){var r=this.find(e);if(!r)return!1;if(this.splay(r),r.left)if(r.right){var l=this.minNode(r.right);l.parent!==r&&(this.replace(l,l.right),l.right=r.right,l.right.parent=l),this.replace(r,l),l.left=r.left,l.left.parent=l}else this.replace(r,r.left);else this.replace(r,r.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var r=this.find(e);if(r){this.splay(r);var l=r.left,u=r.right,m=null;l&&(l.parent=null,m=this.maxNode(l),this.splay(m),this._root=m),u&&(l?m.right=u:this._root=u,u.parent=m),this._size--}}pop(){var e=this._root,r=null;if(e){for(;e.left;)e=e.left;r={key:e.key,data:e.data},this.remove(e.key)}return r}next(e){var r=e;if(r)if(r.right)for(r=r.right;r&&r.left;)r=r.left;else for(r=e.parent;r&&r.right===e;)e=r,r=r.parent;return r}prev(e){var r=e;if(r)if(r.left)for(r=r.left;r&&r.right;)r=r.right;else for(r=e.parent;r&&r.left===e;)e=r,r=r.parent;return r}forEach(e){for(var r=this._root,l=[],u=!1,m=0;!u;)r?(l.push(r),r=r.left):l.length>0?(e(r=l.pop(),m++),r=r.right):u=!0;return this}range(e,r,l,u){const m=[],g=this._compare;let b,E=this._root;for(;m.length!==0||E;)if(E)m.push(E),E=E.left;else{if(E=m.pop(),b=g(E.key,r),b>0)break;if(g(E.key,e)>=0&&l.call(u,E))return this;E=E.right}return this}keys(){for(var e=this._root,r=[],l=[],u=!1;!u;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),l.push(e.key),e=e.right):u=!0;return l}values(){for(var e=this._root,r=[],l=[],u=!1;!u;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),l.push(e.data),e=e.right):u=!0;return l}at(e){for(var r=this._root,l=[],u=!1,m=0;!u;)if(r)l.push(r),r=r.left;else if(l.length>0){if(r=l.pop(),m===e)return r;m++,r=r.right}else u=!0;return null}load(e=[],r=[],l=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const u=e.length;return l&&Kw(e,r,0,u-1,this._compare),this._root=Xw(null,e,r,0,u),this._size=u,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,r,l,u,m){return new Zw(l,m).load(e,r,u)}}function Xw(o,e,r,l,u){const m=u-l;if(m>0){const g=l+Math.floor(m/2),b={key:e[g],data:r[g],parent:o};return b.left=Xw(b,e,r,l,g),b.right=Xw(b,e,r,g+1,u),b}return null}function Kw(o,e,r,l,u){if(r>=l)return;const m=o[r+l>>1];let g=r-1,b=l+1;for(;;){do g++;while(u(o[g],m)<0);do b--;while(u(o[b],m)>0);if(g>=b)break;let E=o[g];o[g]=o[b],o[b]=E,E=e[g],e[g]=e[b],e[b]=E}Kw(o,e,r,b,u),Kw(o,e,b+1,l,u)}const FC=11102230246251565e-32,xl=134217729,qB=(3+8*FC)*FC;function Yw(o,e,r,l,u){let m,g,b,E,A=e[0],N=l[0],j=0,R=0;N>A==N>-A?(m=A,A=e[++j]):(m=N,N=l[++R]);let B=0;if(j<o&&R<r)for(N>A==N>-A?(g=A+m,b=m-(g-A),A=e[++j]):(g=N+m,b=m-(g-N),N=l[++R]),m=g,b!==0&&(u[B++]=b);j<o&&R<r;)N>A==N>-A?(g=m+A,E=g-m,b=m-(g-E)+(A-E),A=e[++j]):(g=m+N,E=g-m,b=m-(g-E)+(N-E),N=l[++R]),m=g,b!==0&&(u[B++]=b);for(;j<o;)g=m+A,E=g-m,b=m-(g-E)+(A-E),A=e[++j],m=g,b!==0&&(u[B++]=b);for(;R<r;)g=m+N,E=g-m,b=m-(g-E)+(N-E),N=l[++R],m=g,b!==0&&(u[B++]=b);return m===0&&B!==0||(u[B++]=m),B}function M_(o){return new Float64Array(o)}const ry=M_(4),BC=M_(8),VC=M_(12),UC=M_(16),$l=M_(4);function L_(o,e,r){e===null?(o.inOut=!1,o.otherInOut=!0):(o.isSubject===e.isSubject?(o.inOut=!e.inOut,o.otherInOut=e.otherInOut):(o.inOut=!e.otherInOut,o.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(o.prevInResult=!$C(e,r)||e.isVertical()?e.prevInResult:e)),o.resultTransition=$C(o,r)?(function(l,u){let m,g=!l.inOut,b=!l.otherInOut;switch(u){case 0:m=g&&b;break;case 1:m=g||b;break;case 3:m=g!==b;break;case 2:m=l.isSubject?g&&!b:b&&!g}return m?1:-1})(o,r):0}function $C(o,e){switch(o.type){case 0:switch(e){case 0:return!o.otherInOut;case 1:return o.otherInOut;case 2:return o.isSubject&&o.otherInOut||!o.isSubject&&!o.otherInOut;case 3:return!0}break;case 2:return e===0||e===1;case 3:return e===2;case 1:return!1}return!1}class ny{constructor(e,r,l,u,m){this.left=r,this.point=e,this.otherEvent=l,this.isSubject=u??!1,this.type=m||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const r=this.point,l=this.otherEvent.point;return this.left?(r[0]-e[0])*(l[1]-e[1])-(l[0]-e[0])*(r[1]-e[1])>0:(l[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(l[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new ny(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function Eh(o,e){return o[0]===e[0]&&o[1]===e[1]}function Qw(o,e,r){const l=(function(u,m,g,b,E,A){const N=(m-A)*(g-E),j=(u-E)*(b-A),R=N-j;if(N===0||j===0||N>0!=j>0)return R;const B=Math.abs(N+j);return Math.abs(R)>=33306690738754716e-32*B?R:-(function(V,H,Q,K,re,ae,ue){let xe,ye,Ie,Pe,Ae,je,Oe,ht,at,lt,St,bt,wt,st,Et,gt,kt,Tt;const lr=V-re,dr=Q-re,Wt=H-ae,Yt=K-ae;st=lr*Yt,je=xl*lr,Oe=je-(je-lr),ht=lr-Oe,je=xl*Yt,at=je-(je-Yt),lt=Yt-at,Et=ht*lt-(st-Oe*at-ht*at-Oe*lt),gt=Wt*dr,je=xl*Wt,Oe=je-(je-Wt),ht=Wt-Oe,je=xl*dr,at=je-(je-dr),lt=dr-at,kt=ht*lt-(gt-Oe*at-ht*at-Oe*lt),St=Et-kt,Ae=Et-St,ry[0]=Et-(St+Ae)+(Ae-kt),bt=st+St,Ae=bt-st,wt=st-(bt-Ae)+(St-Ae),St=wt-gt,Ae=wt-St,ry[1]=wt-(St+Ae)+(Ae-gt),Tt=bt+St,Ae=Tt-bt,ry[2]=bt-(Tt-Ae)+(St-Ae),ry[3]=Tt;let Fr=(function(li,En){let Ai=En[0];for(let Kn=1;Kn<4;Kn++)Ai+=En[Kn];return Ai})(0,ry),wr=22204460492503146e-32*ue;if(Fr>=wr||-Fr>=wr||(Ae=V-lr,xe=V-(lr+Ae)+(Ae-re),Ae=Q-dr,Ie=Q-(dr+Ae)+(Ae-re),Ae=H-Wt,ye=H-(Wt+Ae)+(Ae-ae),Ae=K-Yt,Pe=K-(Yt+Ae)+(Ae-ae),xe===0&&ye===0&&Ie===0&&Pe===0)||(wr=11093356479670487e-47*ue+qB*Math.abs(Fr),Fr+=lr*Pe+Yt*xe-(Wt*Ie+dr*ye),Fr>=wr||-Fr>=wr))return Fr;st=xe*Yt,je=xl*xe,Oe=je-(je-xe),ht=xe-Oe,je=xl*Yt,at=je-(je-Yt),lt=Yt-at,Et=ht*lt-(st-Oe*at-ht*at-Oe*lt),gt=ye*dr,je=xl*ye,Oe=je-(je-ye),ht=ye-Oe,je=xl*dr,at=je-(je-dr),lt=dr-at,kt=ht*lt-(gt-Oe*at-ht*at-Oe*lt),St=Et-kt,Ae=Et-St,$l[0]=Et-(St+Ae)+(Ae-kt),bt=st+St,Ae=bt-st,wt=st-(bt-Ae)+(St-Ae),St=wt-gt,Ae=wt-St,$l[1]=wt-(St+Ae)+(Ae-gt),Tt=bt+St,Ae=Tt-bt,$l[2]=bt-(Tt-Ae)+(St-Ae),$l[3]=Tt;const nr=Yw(4,ry,4,$l,BC);st=lr*Pe,je=xl*lr,Oe=je-(je-lr),ht=lr-Oe,je=xl*Pe,at=je-(je-Pe),lt=Pe-at,Et=ht*lt-(st-Oe*at-ht*at-Oe*lt),gt=Wt*Ie,je=xl*Wt,Oe=je-(je-Wt),ht=Wt-Oe,je=xl*Ie,at=je-(je-Ie),lt=Ie-at,kt=ht*lt-(gt-Oe*at-ht*at-Oe*lt),St=Et-kt,Ae=Et-St,$l[0]=Et-(St+Ae)+(Ae-kt),bt=st+St,Ae=bt-st,wt=st-(bt-Ae)+(St-Ae),St=wt-gt,Ae=wt-St,$l[1]=wt-(St+Ae)+(Ae-gt),Tt=bt+St,Ae=Tt-bt,$l[2]=bt-(Tt-Ae)+(St-Ae),$l[3]=Tt;const en=Yw(nr,BC,4,$l,VC);st=xe*Pe,je=xl*xe,Oe=je-(je-xe),ht=xe-Oe,je=xl*Pe,at=je-(je-Pe),lt=Pe-at,Et=ht*lt-(st-Oe*at-ht*at-Oe*lt),gt=ye*Ie,je=xl*ye,Oe=je-(je-ye),ht=ye-Oe,je=xl*Ie,at=je-(je-Ie),lt=Ie-at,kt=ht*lt-(gt-Oe*at-ht*at-Oe*lt),St=Et-kt,Ae=Et-St,$l[0]=Et-(St+Ae)+(Ae-kt),bt=st+St,Ae=bt-st,wt=st-(bt-Ae)+(St-Ae),St=wt-gt,Ae=wt-St,$l[1]=wt-(St+Ae)+(Ae-gt),Tt=bt+St,Ae=Tt-bt,$l[2]=bt-(Tt-Ae)+(St-Ae),$l[3]=Tt;const kn=Yw(en,VC,4,$l,UC);return UC[kn-1]})(u,m,g,b,E,A,B)})(o[0],o[1],e[0],e[1],r[0],r[1]);return l>0?-1:l<0?1:0}function Zp(o,e){const r=o.point,l=e.point;return r[0]>l[0]?1:r[0]<l[0]?-1:r[1]!==l[1]?r[1]>l[1]?1:-1:(function(u,m,g){return u.left!==m.left?u.left?1:-1:Qw(g,u.otherEvent.point,m.otherEvent.point)!==0?u.isBelow(m.otherEvent.point)?-1:1:!u.isSubject&&m.isSubject?1:-1})(o,e,r)}function Xp(o,e,r){const l=new ny(e,!1,o,o.isSubject),u=new ny(e,!0,o.otherEvent,o.isSubject);return Eh(o.point,o.otherEvent.point)&&console.warn("what is that, a collapsed segment?",o),l.contourId=u.contourId=o.contourId,Zp(u,o.otherEvent)>0&&(o.otherEvent.left=!0,u.left=!1),o.otherEvent.otherEvent=u,o.otherEvent=l,r.push(u),r.push(l),r}function Uv(o,e){return o[0]*e[1]-o[1]*e[0]}function Jw(o,e){return o[0]*e[0]+o[1]*e[1]}function e1(o,e,r){const l=(function(E,A,N,j){const R=[A[0]-E[0],A[1]-E[1]],B=[j[0]-N[0],j[1]-N[1]];function V(Ie,Pe,Ae){return[Ie[0]+Pe*Ae[0],Ie[1]+Pe*Ae[1]]}const H=[N[0]-E[0],N[1]-E[1]];let Q=Uv(R,B),K=Q*Q;const re=Jw(R,R);if(K>0){const Ie=Uv(H,B)/Q;if(Ie<0||Ie>1)return null;const Pe=Uv(H,R)/Q;return Pe<0||Pe>1?null:Ie===0||Ie===1?[V(E,Ie,R)]:Pe===0||Pe===1?[V(N,Pe,B)]:[V(E,Ie,R)]}if(Q=Uv(H,R),K=Q*Q,K>0)return null;const ae=Jw(R,H)/re,ue=ae+Jw(R,B)/re,xe=Math.min(ae,ue),ye=Math.max(ae,ue);return xe<=1&&ye>=0?xe===1?[V(E,xe>0?xe:0,R)]:ye===0?[V(E,ye<1?ye:1,R)]:[V(E,xe>0?xe:0,R),V(E,ye<1?ye:1,R)]:null})(o.point,o.otherEvent.point,e.point,e.otherEvent.point),u=l?l.length:0;if(u===0||u===1&&(Eh(o.point,e.point)||Eh(o.otherEvent.point,e.otherEvent.point))||u===2&&o.isSubject===e.isSubject)return 0;if(u===1)return!Eh(o.point,l[0])&&!Eh(o.otherEvent.point,l[0])&&Xp(o,l[0],r),!Eh(e.point,l[0])&&!Eh(e.otherEvent.point,l[0])&&Xp(e,l[0],r),1;const m=[];let g=!1,b=!1;return Eh(o.point,e.point)?g=!0:Zp(o,e)===1?m.push(e,o):m.push(o,e),Eh(o.otherEvent.point,e.otherEvent.point)?b=!0:Zp(o.otherEvent,e.otherEvent)===1?m.push(e.otherEvent,o.otherEvent):m.push(o.otherEvent,e.otherEvent),g&&b||g?(e.type=1,o.type=e.inOut===o.inOut?2:3,g&&!b&&Xp(m[1].otherEvent,m[0].point,r),2):b?(Xp(m[0],m[1].point,r),3):m[0]!==m[3].otherEvent?(Xp(m[0],m[1].point,r),Xp(m[1],m[2].point,r),3):(Xp(m[0],m[1].point,r),Xp(m[3].otherEvent,m[2].point,r),3)}function GB(o,e){if(o===e)return 0;if(Qw(o.point,o.otherEvent.point,e.point)!==0||Qw(o.point,o.otherEvent.point,e.otherEvent.point)!==0)return Eh(o.point,e.point)?o.isBelow(e.otherEvent.point)?-1:1:o.point[0]===e.point[0]?o.point[1]<e.point[1]?-1:1:Zp(o,e)===1?e.isAbove(o.point)?-1:1:o.isBelow(e.point)?-1:1;if(o.isSubject!==e.isSubject)return o.isSubject?-1:1;{let r=o.point,l=e.point;if(r[0]===l[0]&&r[1]===l[1])return r=o.otherEvent.point,l=e.otherEvent.point,r[0]===l[0]&&r[1]===l[1]?0:(o.contourId??0)>(e.contourId??0)?1:-1}return Zp(o,e)===1?1:-1}class WB{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function HB(o,e,r,l){let u,m=o+1,g=e[o].point;const b=e.length;for(m<b&&(u=e[m].point);m<b&&u[0]===g[0]&&u[1]===g[1];){if(!r[m])return m;m++,m<b&&(u=e[m].point)}for(m=o-1;r[m]&&m>l;)m--;return m}function ZB(o,e,r){const l=new WB;if(o.prevInResult!=null){const u=o.prevInResult,m=u.outputContourId;if(u.resultTransition>0){const g=e[m];if(g.holeOf!=null){const b=g.holeOf;e[b].holeIds.push(r),l.holeOf=b,l.depth=e[m].depth}else e[m].holeIds.push(r),l.holeOf=m,l.depth=e[m].depth+1}else l.holeOf=null,l.depth=e[m].depth}else l.holeOf=null,l.depth=0;return l}const qC=Math.max,GC=Math.min;let $v=0;function WC(o,e,r,l,u,m){let g,b,E,A,N,j;for(g=0,b=o.length-1;g<b;g++){if(E=o[g],A=o[g+1],N=new ny(E,!1,void 0,e),j=new ny(A,!1,N,e),N.otherEvent=j,E[0]===A[0]&&E[1]===A[1])continue;N.contourId=j.contourId=r,m||(N.isExteriorRing=!1,j.isExteriorRing=!1),Zp(N,j)>0?j.left=!0:N.left=!0;const R=E[0],B=E[1];u[0]=GC(u[0],R),u[1]=GC(u[1],B),u[2]=qC(u[2],R),u[3]=qC(u[3],B),l.push(N),l.push(j)}}const qv=[];function HC(o,e,r){let l=o,u=e;typeof o[0][0][0]=="number"&&(l=[o]),typeof e[0][0][0]=="number"&&(u=[e]);let m=(function(R,B,V){let H=null;return R.length*B.length===0&&(V===0?H=qv:V===2?H=R:(V===1||V===3)&&(H=R.length===0?B:R)),H})(l,u,r);if(m)return m===qv?null:m;const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=(function(R,B,V,H,Q){const K=new Hd(void 0,Zp);let re,ae,ue,xe,ye,Ie;for(ue=0,xe=R.length;ue<xe;ue++)for(re=R[ue],ye=0,Ie=re.length;ye<Ie;ye++)ae=ye===0,ae&&$v++,WC(re[ye],!0,$v,K,V,ae);for(ue=0,xe=B.length;ue<xe;ue++)for(re=B[ue],ye=0,Ie=re.length;ye<Ie;ye++)ae=ye===0,Q===2&&(ae=!1),ae&&$v++,WC(re[ye],!1,$v,K,H,ae);return K})(l,u,g,b,r);if(m=(function(R,B,V,H,Q){let K=null;return(V[0]>H[2]||H[0]>V[2]||V[1]>H[3]||H[1]>V[3])&&(Q===0?K=qv:Q===2?K=R:(Q===1||Q===3)&&(K=R.concat(B))),K})(l,u,g,b,r),m)return m===qv?null:m;const A=(function(R,B,V,H,Q,K){const re=new Zw(GB),ae=[],ue=Math.min(H[2],Q[2]);let xe,ye,Ie;for(;R.length!==0;){let Pe=R.pop();if(ae.push(Pe),K===0&&Pe.point[0]>ue||K===2&&Pe.point[0]>H[2])break;if(Pe.left){ye=xe=re.insert(Pe),Ie=re.minNode(),xe=xe!==Ie?re.prev(xe):null,ye=re.next(ye);const Ae=xe?xe.key:null;let je;if(L_(Pe,Ae,K),ye&&e1(Pe,ye.key,R)===2&&(L_(Pe,Ae,K),L_(ye.key,Pe,K)),xe&&e1(xe.key,Pe,R)===2){let Oe=xe;Oe=Oe!==Ie?re.prev(Oe):null,je=Oe?Oe.key:null,L_(Ae,je,K),L_(Pe,Ae,K)}}else Pe=Pe.otherEvent,ye=xe=re.find(Pe),xe&&ye&&(xe=xe!==Ie?re.prev(xe):null,ye=re.next(ye),re.remove(Pe),ye&&xe&&e1(xe.key,ye.key,R))}return ae})(E,0,0,g,b,r),N=(function(R){let B,V;const H=(function(re){let ae,ue,xe,ye,Ie;const Pe=[];for(ue=0,xe=re.length;ue<xe;ue++)ae=re[ue],(ae.left&&ae.inResult||!ae.left&&ae.otherEvent.inResult)&&Pe.push(ae);let Ae=!1;for(;!Ae;)for(Ae=!0,ue=0,xe=Pe.length;ue<xe;ue++)ue+1<xe&&Zp(Pe[ue],Pe[ue+1])===1&&(ye=Pe[ue],Pe[ue]=Pe[ue+1],Pe[ue+1]=ye,Ae=!1);for(ue=0,xe=Pe.length;ue<xe;ue++)ae=Pe[ue],ae.otherPos=ue;for(ue=0,xe=Pe.length;ue<xe;ue++)ae=Pe[ue],ae.left||(Ie=ae.otherPos,ae.otherPos=ae.otherEvent.otherPos,ae.otherEvent.otherPos=Ie);return Pe})(R),Q={},K=[];for(B=0,V=H.length;B<V;B++){if(Q[B])continue;const re=K.length,ae=ZB(H[B],K,re),ue=Ie=>{Q[Ie]=!0,Ie<H.length&&H[Ie]&&(H[Ie].outputContourId=re)};let xe=B,ye=B;for(ae.points.push(H[B].point);ue(xe),xe=H[xe].otherPos,ue(xe),ae.points.push(H[xe].point),xe=HB(xe,H,Q,ye),!(xe==ye||xe>=H.length)&&H[xe];);K.push(ae)}return K})(A),j=[];for(let R=0;R<N.length;R++){let B=N[R];if(B.isExterior()){let V=[B.points];for(let H=0;H<B.holeIds.length;H++)V.push(N[B.holeIds[H]].points);j.push(V)}}return j}function Gv(o,e,r,l){const u=[],m=l===0?(g,b,E,A,N,j)=>{g.push(new Nt(j,E+(j-b)/(A-b)*(N-E)))}:(g,b,E,A,N,j)=>{g.push(new Nt(b+(j-E)/(N-E)*(A-b),j))};for(const g of o){const b=[];for(const E of g){if(E.length<=2)continue;const A=[];for(let R=0;R<E.length-1;R++){const B=E[R].x,V=E[R].y,H=E[R+1].x,Q=E[R+1].y,K=l===0?B:V,re=l===0?H:Q;K<e?re>e&&m(A,B,V,H,Q,e):K>r?re<r&&m(A,B,V,H,Q,r):A.push(E[R]),re<e&&K>=e&&m(A,B,V,H,Q,e),re>r&&K<=r&&m(A,B,V,H,Q,r)}let N=E[E.length-1];const j=l===0?N.x:N.y;j>=e&&j<=r&&A.push(N),A.length&&(N=A[A.length-1],A[0].x===N.x&&A[0].y===N.y||A.push(A[0]),b.push(A))}b.length&&u.push(b)}return u}function XB(o,e){const r=HC(t1(o),t1([e]),0);return r==null?[]:ZC(r)}function KB(o,e){let l=t1(o,65536);const u=[];for(;e.valid();e.next()){const[m,g]=e.get(),b=m.x*65536,E=m.y*65536,A=g.x*65536,N=g.y*65536,j=A-b,R=N-E,B=Math.hypot(j,R);if(B===0)continue;const V=Math.trunc(R/B*3),H=-Math.trunc(j/B*3);u.push([[[b,E],[A,N],[A+V,N+H],[b+V,E+H],[b,E]]])}return u.length>0&&(l=HC(l,u,2)),ZC(l,1/65536,128)}function t1(o,e=1){return[o.map(r=>r.map(l=>[l.x*e,l.y*e]))]}function ZC(o,e=1,r){return o.map(l=>l.map((u,m)=>{const g=u.map(b=>{let E=b[0],A=b[1];return r&&(E=Math.round(E/r)*r,A=Math.round(A/r)*r),new Nt(E*e,A*e)._round()});return m>0&&g.reverse(),g}))}class r1{constructor(e,r){this.layoutVertexArray=new pc,this.indexArray=new Os,this.lineIndexArray=new Aa,this.triangleSegments=new Zi,this.lineSegments=new Zi,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Us)}update(e,r,l,u,m,g,b,E){this.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,IB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,PB.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,l,u,m,g,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,l,u,m,g,void 0,b)}}class n1{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new r1(e,!1),this.elevationBufferData=new r1(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,u){}populate(e,r,l,u){this.hasPattern=Ww("fill",this.layers,this.pixelRatio,r);const m=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:E,index:A,sourceLayerIndex:N}of e){const j=this.layers[0]._featureFilter.needGeometry,R=tn(b,j);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),R,l))continue;const B=m?m.evaluate(R,{},l,r.availableImages):void 0,V={id:E,properties:b.properties,type:b.type,sourceLayerIndex:N,index:A,geometry:j?R.geometry:Gr(b,l,u),patterns:{},sortKey:B};g.push(V)}m&&g.sort((b,E)=>b.sortKey-E.sortKey);for(const b of g){const{geometry:E,index:A,sourceLayerIndex:N}=b;if(this.hasPattern){const j=Hw("fill",this.layers,b,this.zoom,this.pixelRatio,r);this.patternFeatures.push(j)}else this.addFeature(b,E,A,l,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[A].feature,E,A,N,this.index)}}update(e,r,l,u,m,g,b){this.bufferData.update(e,r,l,u,m,g,b,this.worldview),this.elevationBufferData.update(e,r,l,u,m,g,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,r,l,u,m,g,b,this.worldview)}addFeatures(e,r,l,u,m,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,r,l,u,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,l,u,m,g=[],b,E){const A=R_(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,u,l,E):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,l,m,g,u,b,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,m,g,u,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(e,r,l,u,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(r,l,u,m,this.worldview))}addElevatedRoadFeature(e,r,l,u,m){const g=new Array,b=pa.getElevationFeature(e,m);if(!b)return void this.addGeometry(r,this.bufferData);{const A=this.clipPolygonsToTile(r,1);A.length>0&&g.push({polygons:A,elevationFeature:b,elevationTileID:l})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:u};for(const A of g)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ul(A.elevationTileID,this.layers,this.zoom,this.lut));const j=A.elevationFeature.isTunnel();let R=0;e.properties.hasOwnProperty(un)&&(R=+e.properties[un]),this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,A.polygons,j,A.elevationFeature,R)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const N=new Ia(l,A.elevationTileID);this.addElevatedGeometry(A.polygons,N,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,E)}}addElevatedGeometry(e,r,l,u,m,g){const b={elevation:l,elevationSampler:r,bias:u,index:m,featureInfo:g},[E,A]=this.addGeometry(e,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,r,l){let u=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;l&&(g=l.elevationSampler.constantElevation(l.elevation,l.bias),g!=null&&(u=g,m=g));const b=(E,A,N)=>{if(l!=null)if(A.push(E),g!=null)r.elevatedLayoutVertexArray.emplaceBack(g),N.push(g);else{const j=l.elevationSampler.pointElevation(E,l.elevation,l.bias);r.elevatedLayoutVertexArray.emplaceBack(j),N.push(j),u=Math.min(u,j),m=Math.max(m,j)}};for(const E of e){let A=0;for(const ae of E)A+=ae.length;const N=r.triangleSegments.prepareSegment(A,r.layoutVertexArray,r.indexArray),j=N.vertexLength,R=[],B=[],V=[],H=[],Q=[],K=r.layoutVertexArray.length;for(const ae of E){if(ae.length===0)continue;ae!==E[0]&&B.push(R.length/2);const ue=r.lineSegments.prepareSegment(ae.length,r.layoutVertexArray,r.lineIndexArray),xe=ue.vertexLength;l&&Q.push(r.layoutVertexArray.length-K),b(ae[0],V,H),r.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),r.lineIndexArray.emplaceBack(xe+ae.length-1,xe),R.push(ae[0].x),R.push(ae[0].y);for(let ye=1;ye<ae.length;ye++)b(ae[ye],V,H),r.layoutVertexArray.emplaceBack(ae[ye].x,ae[ye].y),r.lineIndexArray.emplaceBack(xe+ye-1,xe+ye),R.push(ae[ye].x),R.push(ae[ye].y);ue.vertexLength+=ae.length,ue.primitiveLength+=ae.length}const re=ey(R,B);for(let ae=0;ae<re.length;ae+=3)r.indexArray.emplaceBack(j+re[ae],j+re[ae+1],j+re[ae+2]);if(re.length>0&&l&&this.elevationMode==="hd-road-base"){const ae=l.elevation.isTunnel(),ue=l.elevation.safeArea,xe=this.elevatedStructures.addVertices(V,H);this.elevatedStructures.addTriangles(re,xe,ae);const ye=Q.length;if(ye>0){for(let Ie=0;Ie<ye-1;Ie++)this.elevatedStructures.addRenderableRing(l.index,Q[Ie]+xe,Q[Ie+1]-Q[Ie],ae,ue,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,Q[ye-1]+xe,V.length-Q[ye-1],ae,ue,l.featureInfo)}}N.vertexLength+=A,N.primitiveLength+=re.length/3}return[u,m]}prepareElevatedPolygons(e,r,l){const u=1/Dt(l),m=[];for(const g of e){const b=KB(g,new $a(r,u));m.push(...b)}return m}clipPolygonsToTile(e,r){const l=-r,u=-r,m=qt+r,g=qt+r;let b=0;const E=[],A=[];for(;b<e.length;b++){const R=e[b],B=Ud(R);(B.min.x>=l&&B.max.x<=m&&B.min.y>=u&&B.max.y<=g?E:A).push(R)}if(E.length===e.length)return e;const N=[new Nt(l,u),new Nt(m,u),new Nt(m,g),new Nt(l,g),new Nt(l,u)],j=E;for(const R of A)j.push(...XB(R,N));return j}}let XC,KC,YC,QC;hr(n1,"FillBucket",{omit:["layers","patternFeatures"]}),hr(r1,"FillBufferData"),hr(Ul,"ElevatedStructures");class Wv{constructor(e,r,l,u){if(this.triangleCount=r.length/3,this.min=new Nt(0,0),this.max=new Nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,g]=[e[0].clone(),e[0].clone()];for(let j=1;j<e.length;++j){const R=e[j];m.x=Math.min(m.x,R.x),m.y=Math.min(m.y,R.y),g.x=Math.max(g.x,R.x),g.y=Math.max(g.y,R.y)}if(u){const j=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/u);l=Math.max(l,j)}if(l===0)return;this.min=m,this.max=g;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const E=Math.max(b.x,b.y)/l;this.cellsX=Math.max(1,Math.ceil(b.x/E)),this.cellsY=Math.max(1,Math.ceil(b.y/E)),this.xScale=1/E,this.yScale=1/E;const A=[];for(let j=0;j<this.triangleCount;j++){const R=e[r[3*j+0]].sub(this.min),B=e[r[3*j+1]].sub(this.min),V=e[r[3*j+2]].sub(this.min),H=Ch(Math.floor(Math.min(R.x,B.x,V.x)),this.xScale,this.cellsX),Q=Ch(Math.floor(Math.max(R.x,B.x,V.x)),this.xScale,this.cellsX),K=Ch(Math.floor(Math.min(R.y,B.y,V.y)),this.yScale,this.cellsY),re=Ch(Math.floor(Math.max(R.y,B.y,V.y)),this.yScale,this.cellsY),ae=new Nt(0,0),ue=new Nt(0,0),xe=new Nt(0,0),ye=new Nt(0,0);for(let Ie=K;Ie<=re;++Ie){ae.y=ue.y=Ie*E,xe.y=ye.y=(Ie+1)*E;for(let Pe=H;Pe<=Q;++Pe)ae.x=xe.x=Pe*E,ue.x=ye.x=(Pe+1)*E,(ps(R,B,V,ae,ue,ye)||ps(R,B,V,ae,ye,xe))&&A.push({cellIdx:Ie*this.cellsX+Pe,triIdx:j})}}if(A.length===0)return;A.sort((j,R)=>j.cellIdx-R.cellIdx||j.triIdx-R.triIdx);let N=0;for(;N<A.length;){const j=A[N].cellIdx,R={start:this.payload.length,len:0};for(;N<A.length&&A[N].cellIdx===j;)++R.len,this.payload.push(A[N++].triIdx);this.cells[j]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Ch(e.x-this.min.x,this.xScale,this.cellsX),u=Ch(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[u*this.cellsX+l];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){const b=this.payload[m.start+g],E=Math.floor(b/8),A=1<<b%8;if(!(this.lookup[E]&A)&&(this.lookup[E]|=A,r.push(b),r.length===this.triangleCount))return}}}query(e,r,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const u=Ch(e.x-this.min.x,this.xScale,this.cellsX),m=Ch(r.x-this.min.x,this.xScale,this.cellsX),g=Ch(e.y-this.min.y,this.yScale,this.cellsY),b=Ch(r.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=b;E++)for(let A=u;A<=m;A++){const N=this.cells[E*this.cellsX+A];if(N)for(let j=0;j<N.len;j++){const R=this.payload[N.start+j],B=Math.floor(R/8),V=1<<R%8;if(!(this.lookup[B]&V)&&(this.lookup[B]|=V,l.push(R),l.length===this.triangleCount))return}}}}function Ch(o,e,r){return Math.max(0,Math.min(r-1,Math.floor(o*e)))}hr(Wv,"TriangleGridIndex");class JC{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}updateAppearances(e,r,l,u){}populate(e,r,l,u){const m=[];for(const{feature:g,id:b,index:E,sourceLayerIndex:A}of e){const N=this.layers[0]._featureFilter.needGeometry,j=tn(g,N);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),j,l))continue;const R={id:b,properties:g.properties,type:g.type,sourceLayerIndex:A,index:E,geometry:N?j.geometry:Gr(g,l,u),patterns:{}};m.push(R)}for(const g of m){const{geometry:b,index:E,sourceLayerIndex:A}=g;this.addFeature(g,b,E,l,{},r.availableImages,r.brightness),r.featureIndex.insert(e[E].feature,b,E,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,l,u,m,g,b){}destroy(){}addFeature(e,r,l,u,m,g=[],b){for(const E of R_(r,2)){const A=[],N=[],j=[],R=new Nt(1/0,1/0),B=new Nt(-1/0,-1/0);for(const Q of E)if(Q.length!==0){Q!==E[0]&&j.push(N.length/2);for(let K=0;K<Q.length;K++)N.push(Q[K].x),N.push(Q[K].y),A.push(Q[K]),R.x=Math.min(R.x,Q[K].x),R.y=Math.min(R.y,Q[K].y),B.x=Math.max(B.x,Q[K].x),B.y=Math.max(B.y,Q[K].y)}const V=ey(N,j),H=new Wv(A,V,8,256);this.footprints.push({vertices:A,indices:V,grid:H,min:R,max:B})}}}hr(JC,"ClipBucket",{omit:["layers"]});const YB=Tn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),QB=Tn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),JB=Tn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),e4=Tn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),t4=Tn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),r4=Tn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),n4=Tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:i4}=YB,D_=Number.MAX_SAFE_INTEGER,s4=D_-1;function eA(o,e,r,l){return o.order<e||o.order===D_||!(o.clipMask&r)||(function(u,m){return m.length!==0&&m.find(g=>g===u)===void 0})(l,o.clipScope)}function Hv(o,e){return o.x-e.x||o.y-e.y}function tA(o,e){return Hv(o.min,e.min)===0&&Hv(o.max,e.max)===0}function i1(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Zv(o,e){if(o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(o[r].sourceId!==e[r].sourceId||!tA(o[r],e[r])||o[r].order!==e[r].order||o[r].clipMask!==e[r].clipMask||!us(o[r].clipScope,e[r].clipScope))return!1;return!0}function rA(o,e,r){const l=1/qt,u=1/(1<<r.canonical.z),m=(e.x*l+r.canonical.x)*u+r.wrap,g=(e.y*l+r.canonical.y)*u;return{min:new Nt((o.x*l+r.canonical.x)*u+r.wrap,(o.y*l+r.canonical.y)*u),max:new Nt(m,g)}}function o4(o,e,r){const l=1<<r.canonical.z,u=((e.x-r.wrap)*l-r.canonical.x)*qt,m=(e.y*l-r.canonical.y)*qt;return{min:new Nt(((o.x-r.wrap)*l-r.canonical.x)*qt,(o.y*l-r.canonical.y)*qt),max:new Nt(u,m)}}function s1(o,e,r,l,u,m,g){const b=o.indices,E=o.vertices,A=[];for(let N=l;N<l+u;N+=3){const j=e[r[N+0]+m],R=e[r[N+1]+m],B=e[r[N+2]+m],V=Math.min(j.x,R.x,B.x),H=Math.max(j.x,R.x,B.x),Q=Math.min(j.y,R.y,B.y),K=Math.max(j.y,R.y,B.y);A.length=0,o.grid.query(new Nt(V,Q),new Nt(H,K),A);for(let re=0;re<A.length;re++){const ae=A[re];if(ps(E[b[3*ae+0]],E[b[3*ae+1]],E[b[3*ae+2]],j,R,B,g))return!0}}return!1}function nA(o,e,r,l){if(!o||!r)return!1;let u=o.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(r.vertices.length<o.vertices.length)return nA(r,l,o,e);const m=e.canonical,g=l.canonical,b=Math.pow(2,g.z-m.z);u=o.vertices.map(E=>new Nt((E.x+m.x*qt)*b-g.x*qt,(E.y+m.y*qt)*b-g.y*qt))}return s1(r,u,o.indices,0,o.indices.length,0,0)}function iA(o,e,r,l){const u=Math.pow(2,l.z-r.z);return new Nt((o+r.x*qt)*u-l.x*qt,(e+r.y*qt)*u-l.y*qt)}function sA(o,e){const r=[];e.grid.queryPoint(o,r);const l=e.indices,u=e.vertices;for(let m=0;m<r.length;m++){const g=r[m];if(mr([u[l[3*g+0]],u[l[3*g+1]],u[l[3*g+2]]],o))return!0}return!1}const o1=[new Nt(0,0),new Nt(qt,0),new Nt(qt,qt),new Nt(0,qt)];function oA(o,e){const r=[];let l=[];if(!e||o.length<2)return[o];if(o.length===2)return on(o[0],o[1],o1)?[o]:[];for(let u=0;u<o.length+2;u++){const m=o[u%o.length],g=o[(u+1)%o.length],b=on(u===0?o[o.length-1]:o[(u-1)%o.length],m,o1),E=on(m,g,o1),A=b||E;A&&l.push(m),A&&E||l.length>0&&(l.length>1&&r.push(l),l=[])}return l.length>1&&r.push(l),r}const a1=Pn.types,a4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],l4=["fill-extrusion-flood-light-ground-radius"],c4=Math.pow(2,13),u4=Math.pow(2,15)-1,aA=new Nt(0,1),Uf=2147483648;function O_(o,e,r,l,u,m,g,b){o.emplaceBack((e<<1)+g,(r<<1)+m,(Math.floor(l*c4)<<1)+u,Math.round(b))}function z_(o,e,r){o.emplaceBack(e.x*qt,e.y*qt,r?1:0)}function Xv(o,e,r,l,u,m){o.emplaceBack(e.x,e.y,(r.x<<1)+l,(r.y<<1)+u,m)}function F_(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class lA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cA{constructor(){this.centroidXY=new Nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class uA{constructor(){this.acc=new Nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,l){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===qt)&&r.x===l.x)!=((r.y===0||r.y===qt)&&r.y===l.y)&&this.processBorderOverlap(r,l),u&&this.checkBorderIntersection(r,l)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,$r(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>qt!=e.x>qt&&this.addBorderIntersection(1,$r(r.y,e.y,(qt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,$r(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>qt!=e.y>qt&&this.addBorderIntersection(3,$r(r.x,e.x,(qt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];r<l[0]&&(l[0]=r),r>l[1]&&(l[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,r.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,r.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Nt(0,0):new Nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function dA(o,e){const r=o.add(e)._unit(),l=Ee(o.x*r.x+o.y*r.y,-1,1);var u,m,g;return g=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(g)))/4*u4*((u=o).x*(m=e).y-u.y*m.x<0?-1:1)}const d4=[o=>o.x<0,o=>o.x>qt,o=>o.y<0,o=>o.y>qt];function h4(o,e,r,l){const u=[4];if(l===0)return u;r._mult(l);const m=o.sub(r),g=e.sub(r),b=[o,e,m,g];for(let E=0;E<4;E++)for(const A of b)if(d4[E](A)){u.push(E);break}return u}class l1{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Mf,this.indexArray=new Os,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut},r=>l4.includes(r)),this._segments=new Zi,this.hiddenByLandmarkVertexArray=new Of,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Zi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,l,u=!1){const m=e.length;if(m>2){let g=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const A=e[0],N=e[1];E=dA(A.sub(e[m-1])._perp()._unit(),N.sub(A)._perp()._unit())}for(let A=0;A<m;A++){const N=A===m-1?0:A+1,j=e[A],R=e[N],B=e[N===m-1?0:N+1],V=R.sub(j)._perp()._unit(),H=dA(V,B.sub(R)._perp()._unit()),Q=E,K=H;if(c1(j,R,r)||u&&pA(j,r)&&pA(R,r)){E=H;continue}const re=b.vertexLength;Xv(this.vertexArray,j,R,1,1,Q),Xv(this.vertexArray,j,R,1,0,Q),Xv(this.vertexArray,j,R,0,1,K),Xv(this.vertexArray,j,R,0,0,K),b.vertexLength+=4;const ae=h4(j,R,V,l);for(const ue of ae)this._segmentToGroundQuads[g].push({id:re,region:ue}),this._segmentToRegionTriCounts[g][ue]+=2,b.primitiveLength+=2;E=H}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let l=0;l<r;l++)this._segmentToGroundQuads[l].sort((u,m)=>u.region-m.region);for(let l=0;l<r;l++){const u=this._segmentToGroundQuads[l],m=e[l],g=this._segmentToRegionTriCounts[l];g.reduce((E,A)=>E+A,0);let b=0;for(let E=0;E<=4;E++){const A=g[E];if(A!==0){let N=this.regionSegments[E];N||(N=this.regionSegments[E]=new Zi);const j={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:A};N.get().push(j)}b+=A}for(let E=0;E<u.length;E++){const A=u[E].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,l,u,m,g,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,l,u,m,g,void 0,b)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,QB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,JB.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,l,u,m,g,b,E){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,l,u,m,g,b,E)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Uf))}updateHiddenByLandmarkRange(e,r,l){if(!this.hasData())return;const u=r+e;if(r!==0){for(let m=e;m<u;++m)this.hiddenByLandmarkVertexArray.emplace(m,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,r4.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class Kv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Os,this.footprintVertices=new pc,this.footprintSegments=[],this.layoutVertexArray=new gc,this.centroidVertexArray=new Bl,this.wallVertexArray=new Qm,this.indexArray=new Os,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut},r=>a4.includes(r)),this.segments=new Zi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new l1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,u){}populate(e,r,l,u){this.features=[],this.hasPattern=Ww("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Dt(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:g,index:b,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,N=tn(m,A);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),N,l))continue;const j={id:g,sourceLayerIndex:E,index:b,geometry:A?N.geometry:Gr(m,l,u),properties:m.properties,type:m.type,patterns:{}},R=this.layoutVertexArray.length,B=a1[j.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:Hw("fill-extrusion",this.layers,j,this.zoom,this.pixelRatio,r)});else if(this.wallMode)for(const V of j.geometry)for(const H of oA(V,B))this.addFeature(m.id,j,[H],b,l,{},r.availableImages,u,r.brightness);else this.addFeature(m.id,j,j.geometry,b,l,{},r.availableImages,u,r.brightness);r.featureIndex.insert(m,j.geometry,b,E,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,l,u,m,g){for(const{featureId:b,feature:E}of this.features){const A=a1[E.type]==="Polygon",{geometry:N}=E;if(this.wallMode)for(const j of N)for(const R of oA(j,A))this.addFeature(b,E,[R],E.index,r,l,u,m,g);else this.addFeature(b,E,N,E.index,r,l,u,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,l,u,m,g,b){this.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b,this.worldview),this.groundEffect.update(e,r,m,l,u,g,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i4),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,t4.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,n4.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,e4.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,u,m,g,b,E,A){const N=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,j=[new Nt(0,0),new Nt(qt,qt)],R=E.projection,B=R.name==="globe",V=this.wallMode||a1[r.type]==="Polygon",H=new uA;H.centroidDataIndex=this.centroidData.length;const Q=new cA;Q.buildingId=e,r.properties&&r.properties.hasOwnProperty("building_id")&&(Q.buildingId=Number(r.properties.building_id));const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},m)<=0,re=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},m);let ae;if(Q.height=re,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new cd),this.wallMode){if(B)return void Rr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;ae=(function(je){const Oe=je[0].x===je[je.length-1].x&&je[0].y===je[je.length-1].y;(function(Wt){let Yt=0;const Fr=Wt.length;for(let wr=0;wr<Fr;wr++)Yt+=(Wt[(wr+1)%Fr].x-Wt[wr].x)*(Wt[(wr+1)%Fr].y+Wt[wr].y);return Yt>=0})(je)||(je=je.reverse());const at={geometry:[],joinNormals:[],indices:[]},lt=[],St=[],bt=[];let wt=je.length;for(;wt>=2&&je[wt-1].equals(je[wt-2]);)wt--;if(wt<(Oe?3:2))return at;let st,Et,gt,kt,Tt,lr=0;for(;lr<wt-1&&je[lr].equals(je[lr+1]);)lr++;Oe&&(st=je[wt-2],Tt=je[lr].sub(st)._unit()._perp());for(let Wt=lr;Wt<wt;Wt++){if(gt=Wt===wt-1?Oe?je[lr+1]:void 0:je[Wt+1],gt&&je[Wt].equals(gt))continue;Tt&&(kt=Tt),st&&(Et=st),st=je[Wt],Tt=gt?gt.sub(st)._unit()._perp():kt,kt=kt||Tt;let Yt=kt.add(Tt);Yt.x===0&&Yt.y===0||Yt._unit();const Fr=Yt.x*Tt.x+Yt.y*Tt.y,wr=Fr!==0?1/Fr:1/0,nr=kt.x*Tt.y-kt.y*Tt.x>0;let en="miter";const kn=2;en==="miter"&&wr>kn&&(en="bevel"),en==="bevel"&&(wr>100&&(en="flipbevel"),wr<kn&&(en="miter"));const li=(En,Ai,Kn,Es)=>{const Qn=new Nt(En.x,En.y),Si=new Nt(En.x,En.y);Qn.x+=Ai.x*Es,Qn.y+=Ai.y*Es,Si.x-=Ai.x*Math.max(Kn,1),Si.y-=Ai.y*Math.max(Kn,1),bt.push(Ai),lt.push(Qn),St.push(Si)};if(en==="miter")Yt._mult(wr),li(st,Yt,0,0);else if(en==="flipbevel")Yt=Tt.mult(-1),li(st,Yt,0,0),li(st,Yt.mult(-1),0,0);else{const En=-Math.sqrt(wr*wr-1),Ai=nr?En:0,Kn=nr?0:En;Et&&li(st,kt,Ai,Kn),gt&&li(st,Tt,Ai,Kn)}}at.geometry=[...lt,...St.reverse(),lt[0]],at.joinNormals=[...bt,...bt.reverse(),bt[bt.length-1]];const dr=at.geometry.length-1;for(let Wt=0;Wt<dr/2;Wt++)if(Wt+1<dr/2){let Yt=Wt,Fr=Wt+1,wr=dr-1-Wt,nr=dr-2-Wt;Yt=Yt===0?dr-1:Yt-1,Fr=Fr===0?dr-1:Fr-1,wr=wr===0?dr-1:wr-1,nr=nr===0?dr-1:nr-1,at.indices.push(wr),at.indices.push(Fr),at.indices.push(Yt),at.indices.push(wr),at.indices.push(nr),at.indices.push(Fr)}return at})(l[0]),l=[ae.geometry]}const ue=(je,Oe)=>je<(Oe.length-1)/2||je===Oe.length-1,xe=this.wallMode?[l]:R_(l,500);for(let je=xe.length-1;je>=0;je--){const Oe=xe[je];(Oe.length===0||p4(Oe[0]))&&xe.splice(je,1)}let ye;if(B)ye=_A(xe,j,m);else{ye=[];for(const je of xe)ye.push({polygon:je,bounds:j})}const Ie=V?this.edgeRadius:0,Pe=Ie>0&&this.zoom<17,Ae=(je,Oe)=>{if(je.length===0)return!1;const ht=je[je.length-1];return Oe.x===ht.x&&Oe.y===ht.y};for(const{polygon:je,bounds:Oe}of ye){let ht=0,at=0;for(const wt of je)V&&!wt[0].equals(wt[wt.length-1])&&wt.push(wt[0]),at+=V?wt.length-1:wt.length;const lt=this.segments.prepareSegment((V?5:4)*at,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const St={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},bt=new lA;if(bt.vertexOffset=this.footprintVertices.length,bt.indexOffset=3*this.footprintIndices.length,bt.ringIndices=[],V){const wt=[],st=[];ht=lt.vertexLength;for(let gt=0;gt<je.length;gt++){const kt=je[gt];kt.length&&gt!==0&&st.push(wt.length/2);const Tt=[];let lr,dr;lr=kt[1].sub(kt[0])._perp()._unit(),bt.ringIndices.push(kt.length-1);for(let Wt=1;Wt<kt.length;Wt++){const Yt=kt[Wt],Fr=kt[Wt===kt.length-1?1:Wt+1],wr=Yt.clone();if(Ie){dr=Fr.sub(Yt)._perp()._unit();const nr=lr.add(dr)._unit(),en=Ie*Math.min(4,1/(lr.x*nr.x+lr.y*nr.y));wr.x+=en*nr.x,wr.y+=en*nr.y,wr.x=Math.round(wr.x),wr.y=Math.round(wr.y),lr=dr}if(!K||Ie!==0&&!Pe||Ae(Tt,wr)||Tt.push(wr),O_(this.layoutVertexArray,wr.x,wr.y,0,0,1,1,0),this.wallMode){const nr=ue(Wt,kt);z_(this.wallVertexArray,ae.joinNormals[Wt],!nr)}lt.vertexLength++,this.footprintVertices.emplaceBack(Yt.x,Yt.y),wt.push(Yt.x,Yt.y),B&&F_(this.layoutVertexExtArray,R.projectTilePoint(wr.x,wr.y,m),R.upVector(m,wr.x,wr.y))}K&&(Ie===0||Pe)&&(Tt.length!==0&&Ae(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,Oe,N))}const Et=this.wallMode?ae.indices:ey(wt,st);for(let gt=0;gt<Et.length;gt+=3)this.footprintIndices.emplaceBack(bt.vertexOffset+Et[gt+0],bt.vertexOffset+Et[gt+1],bt.vertexOffset+Et[gt+2]),this.indexArray.emplaceBack(ht+Et[gt],ht+Et[gt+2],ht+Et[gt+1]),lt.primitiveLength++;bt.indexCount+=Et.length,bt.vertexCount+=this.footprintVertices.length-bt.vertexOffset}for(let wt=0;wt<je.length;wt++){const st=je[wt];H.startRing(Q,st[0]);let Et=st.length>4&&mA(st[st.length-2],st[0],st[1]),gt=Ie?f4(st[st.length-2],st[0],st[1],Ie):0;const kt=[];let Tt,lr,dr;lr=st[1].sub(st[0])._perp()._unit();let Wt=!0;for(let Yt=1,Fr=0;Yt<st.length;Yt++){let wr=st[Yt-1],nr=st[Yt];const en=st[Yt===st.length-1?1:Yt+1];if(H.appendEdge(Q,nr,wr),c1(nr,wr,Oe)){Ie&&(lr=en.sub(nr)._perp()._unit(),Wt=!Wt);continue}const kn=nr.sub(wr)._perp(),li=kn.x/(Math.abs(kn.x)+Math.abs(kn.y)),En=kn.y>0?1:0,Ai=wr.dist(nr);if(Fr+Ai>32768&&(Fr=0),Ie){dr=en.sub(nr)._perp()._unit();let Si=fA(wr,nr,en,hA(lr,dr),Ie);isNaN(Si)&&(Si=0);const ts=nr.sub(wr)._unit();wr=wr.add(ts.mult(gt))._round(),nr=nr.add(ts.mult(-Si))._round(),gt=Si,lr=dr,K&&this.zoom>=17&&(Ae(kt,wr)||kt.push(wr),Ae(kt,nr)||kt.push(nr))}const Kn=lt.vertexLength,Es=st.length>4&&mA(wr,nr,en);let Qn=gA(Fr,Et,Wt);if(O_(this.layoutVertexArray,wr.x,wr.y,li,En,0,0,Qn),O_(this.layoutVertexArray,wr.x,wr.y,li,En,0,1,Qn),this.wallMode){const Si=ue(Yt-1,st),ts=ae.joinNormals[Yt-1];z_(this.wallVertexArray,ts,Si),z_(this.wallVertexArray,ts,Si)}if(Fr+=Ai,Qn=gA(Fr,Es,!Wt),Et=Es,O_(this.layoutVertexArray,nr.x,nr.y,li,En,0,0,Qn),O_(this.layoutVertexArray,nr.x,nr.y,li,En,0,1,Qn),this.wallMode){const Si=ue(Yt,st),ts=ae.joinNormals[Yt];z_(this.wallVertexArray,ts,Si),z_(this.wallVertexArray,ts,Si)}if(lt.vertexLength+=4,this.indexArray.emplaceBack(Kn+0,Kn+1,Kn+2),this.indexArray.emplaceBack(Kn+1,Kn+3,Kn+2),lt.primitiveLength+=2,Ie){const Si=ht+(Yt===1?st.length-2:Yt-2),ts=Yt===1?ht:Si+1;if(this.indexArray.emplaceBack(Kn+1,Si,Kn+3),this.indexArray.emplaceBack(Si,ts,Kn+3),lt.primitiveLength+=2,Tt===void 0&&(Tt=Kn),!c1(en,st[Yt],Oe)){const as=Yt===st.length-1?Tt:lt.vertexLength;this.indexArray.emplaceBack(Kn+2,Kn+3,as),this.indexArray.emplaceBack(Kn+3,as+1,as),this.indexArray.emplaceBack(Kn+3,ts,as+1),lt.primitiveLength+=3}Wt=!Wt}if(B){const Si=this.layoutVertexExtArray,ts=R.projectTilePoint(wr.x,wr.y,m),as=R.projectTilePoint(nr.x,nr.y,m),ls=R.upVector(m,wr.x,wr.y),Cs=R.upVector(m,nr.x,nr.y);F_(Si,ts,ls),F_(Si,ts,ls),F_(Si,as,Cs),F_(Si,as,Cs)}}V&&(ht+=st.length-1),K&&Ie&&this.zoom>=17&&(kt.length!==0&&Ae(kt,kt[0])&&kt.pop(),this.groundEffect.addData(kt,Oe,N,Ie>0))}this.footprintSegments.push(bt),St.triangleCount=this.indexArray.length-St.triangleArrayOffset,this.polygonSegments.push(St),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=H.borders?aA:this.encodeCentroid(H,Q),this.centroidData.push(Q),H.borders){this.featuresOnBorder.push(H);const je=this.featuresOnBorder.length-1;for(let Oe=0;Oe<H.borders.length;Oe++)H.borders[Oe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Oe].push(je)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,b,m,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(r,u,g,b,m,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,re)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,l)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let b=0;b<this.centroidData.length;b++){const E=this.centroidData[b],A=+(E.min.y+E.max.y>qt),N=2*A+(+(E.min.x+E.max.x>qt)^A);for(let j=0;j<E.polygonSegLen;j++){const R=E.polygonSegIdx+j;e.push({centroidIdx:b,subtile:N,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const r=new Os;e.sort((b,E)=>b.triangleSegmentIdx===E.triangleSegmentIdx?b.subtile-E.subtile:b.triangleSegmentIdx-E.triangleSegmentIdx);let l=0,u=0,m=0;for(const b of e){if(b.triangleSegmentIdx!==l)break;m++}const g=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let b=0,E=u,A=u;for(let N=E;N<m&&e[N].subtile===b;N++)A++;for(;E!==m;){const N=e[E];b=N.subtile;const j=this.centroidData[N.centroidIdx].min.clone(),R=this.centroidData[N.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=E;V<A;V++){const H=e[V],Q=this.polygonSegments[H.polygonSegmentIdx],K=this.centroidData[H.centroidIdx].min,re=this.centroidData[H.centroidIdx].max,ae=this.indexArray.uint16;for(let ue=Q.triangleArrayOffset;ue<Q.triangleArrayOffset+Q.triangleCount;ue++)r.emplaceBack(ae[3*ue],ae[3*ue+1],ae[3*ue+2]);B.primitiveLength+=Q.triangleCount,j.x=Math.min(j.x,K.x),j.y=Math.min(j.y,K.y),R.x=Math.max(R.x,re.x),R.y=Math.max(R.y,re.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:j,max:R}),E=A;for(let V=E;V<m&&e[V].subtile===e[E].subtile;V++)A++}u=m;for(let N=u;N<g&&e[N].triangleSegmentIdx===e[u].triangleSegmentIdx;N++)m++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,l){const u=new Zi;if(this.wallMode){for(const H of this.triangleSubSegments)u.segments.push(H.segment);return u}let m=0,g=0;const b=1<<e.canonical.z;if(r){const H=r.getMinMaxForTile(e);H&&(m=H.min,g=H.max)}g+=this.maxHeight;const E=e.toUnwrapped();let A;const N=[E.canonical.x/b+E.wrap,E.canonical.y/b],j=[(E.canonical.x+1)/b+E.wrap,(E.canonical.y+1)/b],R=(H,Q,K)=>[H[0]*(1-K[0])+Q[0]*K[0],H[1]*(1-K[1])+Q[1]*K[1]],B=[],V=[];for(const H of this.triangleSubSegments){B[0]=H.min.x/qt,B[1]=H.min.y/qt,V[0]=H.max.x/qt,V[1]=H.max.y/qt;const Q=R(N,j,B),K=R(N,j,V);if(new Wn([Q[0],Q[1],m],[K[0],K[1],g]).intersectsPrecise(l)===0){A&&(u.segments.push(A),A=void 0);continue}const re=H.segment;A&&A.vertexOffset!==re.vertexOffset&&(u.segments.push(A),A=void 0),A?(A.vertexLength+=re.vertexLength,A.primitiveLength+=re.primitiveLength):A={vertexOffset:re.vertexOffset,primitiveLength:re.primitiveLength,vertexLength:re.vertexLength,primitiveOffset:re.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&u.segments.push(A),u}encodeCentroid(e,r){const l=e.centroid(),u=r.span(),m=Math.min(7,Math.round(u.x*this.tileToMeter/10)),g=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Nt(Ee(l.x,1,8191)<<3|m,Ee(l.y,1,8191)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new Nt(0,0);const r=e.borders,l=Number.MAX_VALUE;if(r[0][0]!==l||r[1][0]!==l){const u=r[0][0]!==l?0:1;return new Nt(6|(r[0][0]!==l?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{const u=r[2][0]!==l?2:3;return new Nt((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==l?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=2147483647,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&Uf?aA:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||m!==u.x){for(let g=r;g<l;++g)this.centroidVertexArray.emplace(g,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(Zv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const m=[];for(const g of this.activeReplacements){if(g.order<l)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingIds)for(const E of this.centroidData)E.flags&Uf||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y||g.footprint.buildingIds.has(E.buildingId)&&(E.flags|=Uf);else for(const E of this.centroidData)if(!(E.flags&Uf||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let A=0;A<E.footprintSegLen;A++){const N=this.footprintSegments[E.footprintSegIdx+A];if(m.length=0,m4(this.footprintVertices,N.vertexOffset,N.vertexCount,g.footprintTileId.canonical,e.canonical,m),s1(g.footprint,m,this.footprintIndices.uint16,N.indexOffset,N.indexCount,-N.vertexOffset,-b)){E.flags|=Uf;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,l){let u=!1;for(let m=0;m<l.footprintSegLen;m++){const g=this.footprintSegments[l.footprintSegIdx+m];let b=0;for(const E of g.ringIndices){for(let A=b,N=E+b-1;A<E+b;N=A++){const j=this.footprintVertices.int16[2*(A+g.vertexOffset)+0],R=this.footprintVertices.int16[2*(A+g.vertexOffset)+1],B=this.footprintVertices.int16[2*(N+g.vertexOffset)+1];R>r!=B>r&&e<(this.footprintVertices.int16[2*(N+g.vertexOffset)+0]-j)*(r-R)/(B-R)+j&&(u=!u)}b=E}}return u}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,u=!0;const m=4*(e+qt)*qt+(r+qt);if(this.partLookup.hasOwnProperty(m)){const g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&Uf)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||r>g.max.y||g.min.y>r||g.height<=l||this.footprintContainsPoint(e,r,g)&&(l=g.height,this.partLookup[m]=g,u=!!(g.flags&Uf));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[m]=void 0}}function hA(o,e){const r=o.add(e)._unit();return o.x*r.x+o.y*r.y}function f4(o,e,r,l){const u=e.sub(o)._perp()._unit(),m=r.sub(e)._perp()._unit();return fA(o,e,r,hA(u,m),l)}function fA(o,e,r,l,u){const m=Math.sqrt(1-l*l);return Math.min(o.dist(e)/3,e.dist(r)/3,u*m/l)}function c1(o,e,r){return o.x<r[0].x&&e.x<r[0].x||o.x>r[1].x&&e.x>r[1].x||o.y<r[0].y&&e.y<r[0].y||o.y>r[1].y&&e.y>r[1].y}function pA(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function p4(o){return o.every(e=>e.x<=0)||o.every(e=>e.x>=qt)||o.every(e=>e.y<=0)||o.every(e=>e.y>=qt)}function mA(o,e,r){if(o.x<0||o.x>=qt||e.x<0||e.x>=qt||r.x<0||r.x>=qt)return!1;const l=r.sub(e),u=l.perp(),m=o.sub(e);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&u.x*m.x+u.y*m.y<0}function gA(o,e,r){const l=e?2|o:-3&o;return r?1|l:-2&l}function yA(){const o=Math.PI/32,e=Math.tan(o),r=ke;return r*Math.sqrt(1+2*e*e)-r}function _A(o,e,r){const l=1<<r.z,u=mt(r.x/l),m=mt((r.x+1)/l),g=Pt(r.y/l),b=Pt((r.y+1)/l);return(function(E,A,N,j,R=0,B){const V=[];if(!E.length||!N||!j)return V;const H=(ye,Ie)=>{for(const Pe of ye)V.push({polygon:Pe,bounds:Ie})},Q=Math.ceil(Math.log2(N)),K=Math.ceil(Math.log2(j)),re=Q-K,ae=[];for(let ye=0;ye<Math.abs(re);ye++)ae.push(re>0?0:1);for(let ye=0;ye<Math.min(Q,K);ye++)ae.push(0),ae.push(1);let ue=E;if(ue=Gv(ue,A[0].y-R,A[1].y+R,1),ue=Gv(ue,A[0].x-R,A[1].x+R,0),!ue.length)return V;const xe=[];for(ae.length?xe.push({polygons:ue,bounds:A,depth:0}):H(ue,A);xe.length;){const ye=xe.pop(),Ie=ye.depth,Pe=ae[Ie],Ae=ye.bounds[0],je=ye.bounds[1],Oe=Pe===0?Ae.x:Ae.y,ht=Pe===0?je.x:je.y,at=B?B(Pe,Oe,ht):.5*(Oe+ht),lt=Gv(ye.polygons,Oe-R,at+R,Pe),St=Gv(ye.polygons,at-R,ht+R,Pe);if(lt.length){const bt=[Ae,new Nt(Pe===0?at:je.x,Pe===1?at:je.y)];ae.length>Ie+1?xe.push({polygons:lt,bounds:bt,depth:Ie+1}):H(lt,bt)}if(St.length){const bt=[new Nt(Pe===0?at:Ae.x,Pe===1?at:Ae.y),je];ae.length>Ie+1?xe.push({polygons:St,bounds:bt,depth:Ie+1}):H(St,bt)}}return V})(o,e,Math.ceil((m-u)/11.25),Math.ceil((g-b)/11.25),1,(E,A,N)=>{if(E===0)return .5*(A+N);{const j=Pt((r.y+A/qt)/l);return(it(.5*(Pt((r.y+N/qt)/l)+j))*l-r.y)*qt}})}function m4(o,e,r,l,u,m){const g=Math.pow(2,l.z-u.z);for(let b=0;b<r;b++){let E=o.int16[2*(b+e)+0],A=o.int16[2*(b+e)+1];E=(E+u.x*qt)*g-l.x*qt,A=(A+u.y*qt)*g-l.y*qt,m.push(new Nt(E,A))}}let xA,vA;hr(Kv,"FillExtrusionBucket",{omit:["layers","features"]}),hr(cA,"PartData"),hr(lA,"FootprintSegment"),hr(uA,"BorderCentroidData"),hr(l1,"GroundEffect");class ng extends Nt{constructor(e,r,l){super(e,r),this.z=l}}class bA extends ng{constructor(e,r,l,u){super(e,r,l),this.w=u}}function wA(o,e,r,l){const u=r==="x"?"y":"x",m=(l-o[r])/(e[r]-o[r]);o[u]=Math.round(o[u]+(e[u]-o[u])*m),o[r]=l,o.hasOwnProperty("z")&&(o.z=$r(o.z,e.z,m)),o.hasOwnProperty("w")&&(o.w=$r(o.w,e.w,m))}function SA(o,e,r,l){const u=r,m=l;for(const g of["x","y"]){let b=o,E=e;b[g]>=E[g]&&(b=e,E=o),b[g]<u&&E[g]>u&&wA(b,E,g,u),b[g]<m&&E[g]>m&&wA(E,b,g,m)}}function Yv(o,e,r,l,u,m){const g=[];for(let b=0;b<o.length;b++){const E=o[b];let A;const N=g.length;let j=0;for(let R=0;R<E.length-1;R++){let B=E[R],V=E[R+1],H=0;const Q=j;let K,re;m&&(H=Math.hypot(V.x-B.x,V.y-B.y),j+=H,K=B,re=V),B.x<e&&V.x<e||(B.x<e?B=new Nt(e,B.y+(e-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x<e&&(V=new Nt(e,B.y+(e-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y<r&&V.y<r||(B.y<r?B=new Nt(B.x+(r-B.y)/(V.y-B.y)*(V.x-B.x),r)._round():V.y<r&&(V=new Nt(B.x+(r-B.y)/(V.y-B.y)*(V.x-B.x),r)._round()),B.x>=l&&V.x>=l||(B.x>=l?B=new Nt(l,B.y+(l-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x>=l&&(V=new Nt(l,B.y+(l-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y>=u&&V.y>=u||(B.y>=u?B=new Nt(B.x+(u-B.y)/(V.y-B.y)*(V.x-B.x),u)._round():V.y>=u&&(V=new Nt(B.x+(u-B.y)/(V.y-B.y)*(V.x-B.x),u)._round()),A&&B.equals(A[A.length-1])||(A=[B],g.push(A),m&&m.push({progress:{min:Q+TA(K,re,B)*H,max:1},parentIndex:b,prevPoint:K,nextPoint:re})),A.push(V),m&&(m[m.length-1].progress.max=Q+TA(K,re,V)*H,m[m.length-1].nextPoint=re)))))}if(m&&j>0)for(let R=N;R<g.length;R++)m[R].progress.min/=j,m[R].progress.max/=j}return g}function g4(o,e,r,l,u){if(o.length<2)return void l.push(o);const m=[];for(;e.valid();){const[A,N]=e.get();for(let j=0;j<o.length-1;j++){const R=o[j],B=o[j+1],V=ft(R,B,A,N);if(V){const[H]=V,Q=new Nt($r(R.x,B.x,H),$r(R.y,B.y,H));m.push({t:j+H,distance:0,point:Q})}}e.next()}if(m.length===0)return void l.push(o);m.sort((A,N)=>A.t-N.t);let g=0,b=0,E=[];for(l.push(E);g!==o.length;){if(b===m.length){for(;g!==o.length;)E.length!==0&&E[E.length-1].equals(o[g])||E.push(o[g]),g++;break}m[b].t<=g?(E.length!==0&&E[E.length-1].equals(m[b].point)||E.push(m[b].point),Math.trunc(m[b].t),b++):(E.length!==0&&E[E.length-1].equals(o[g])||E.push(o[g]),g++)}}function TA(o,e,r){return o.x!==e.x?(r.x-o.x)/(e.x-o.x):o.y!==e.y?(r.y-o.y)/(e.y-o.y):0}function B_(o,e){return o.x*e.x+o.y*e.y}function EA(o,e){if(o.length===1){let r=0;const l=e[r++];let u;for(;!u||l.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const m=e[r],g=o[0],b=u.sub(l),E=m.sub(l),A=g.sub(l),N=B_(b,b),j=B_(b,E),R=B_(E,E),B=B_(A,b),V=B_(A,E),H=N*R-j*j,Q=(R*B-j*V)/H,K=(N*V-j*B)/H,re=l.z*(1-Q-K)+u.z*Q+m.z*K;if(isFinite(re))return re}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}function CA(o,e,r){let l=1/0;z(r,e)&&(l=EA(r,e[0]));for(let u=0;u<e.length;u++){const m=e[u],g=o[u];for(let b=0;b<m.length-1;b++){const E=m[b],A=[E,m[b+1],g[b+1],g[b],E];w(r,A)&&(l=Math.min(l,EA(r,A)))}}return l!==1/0&&l}function AA(o,e,r,l,u,m,g,b,E,A,N){return o.projection.name==="globe"?(function(j,R,B,V,H,Q,K,re,ae,ue,xe){const ye=[],Ie=[],Pe=j.projection.upVectorScale(xe,j.center.lat,j.worldSize).metersToTile,Ae=[0,0,0,1],je=[0,0,0,1],Oe=(at,lt,St,bt)=>{at[0]=lt,at[1]=St,at[2]=bt,at[3]=1},ht=yA();B>0&&(B+=ht),V+=ht;for(const at of R){const lt=[],St=[];for(const bt of at){const wt=bt.x+H.x,st=bt.y+H.y,Et=j.projection.projectTilePoint(wt,st,xe),gt=j.projection.upVector(xe,bt.x,bt.y);let kt=B,Tt=V;if(K){const lr=IA(wt,st,B,V,K,re,ae,ue);kt+=lr.base,Tt+=lr.top}B!==0?Oe(Ae,Et.x+gt[0]*Pe*kt,Et.y+gt[1]*Pe*kt,Et.z+gt[2]*Pe*kt):Oe(Ae,Et.x,Et.y,Et.z),Oe(je,Et.x+gt[0]*Pe*Tt,Et.y+gt[1]*Pe*Tt,Et.z+gt[2]*Pe*Tt),Sn(Ae,Ae,Q),Sn(je,je,Q),lt.push(new ng(Ae[0],Ae[1],Ae[2])),St.push(new ng(je[0],je[1],je[2]))}ye.push(lt),Ie.push(St)}return[ye,Ie]})(o,e,r,l,u,m,g,b,E,A,N):g?(function(j,R,B,V,H,Q,K,re,ae){const ue=[],xe=[],ye=[0,0,0,1];for(const Ie of j){const Pe=[],Ae=[];for(const je of Ie){const Oe=je.x+V.x,ht=je.y+V.y,at=IA(Oe,ht,R,B,Q,K,re,ae);ye[0]=Oe,ye[1]=ht,ye[2]=at.base,ye[3]=1,Jt(ye,ye,H),ye[3]=Math.max(ye[3],1e-5);const lt=new ng(ye[0]/ye[3],ye[1]/ye[3],ye[2]/ye[3]);ye[0]=Oe,ye[1]=ht,ye[2]=at.top,ye[3]=1,Jt(ye,ye,H),ye[3]=Math.max(ye[3],1e-5);const St=new ng(ye[0]/ye[3],ye[1]/ye[3],ye[2]/ye[3]);Pe.push(lt),Ae.push(St)}ue.push(Pe),xe.push(Ae)}return[ue,xe]})(e,r,l,u,m,g,b,E,A):(function(j,R,B,V,H){const Q=[],K=[],re=H[8]*R,ae=H[9]*R,ue=H[10]*R,xe=H[11]*R,ye=H[8]*B,Ie=H[9]*B,Pe=H[10]*B,Ae=H[11]*B;for(const je of j){const Oe=[],ht=[];for(const at of je){const lt=at.x+V.x,St=at.y+V.y,bt=H[0]*lt+H[4]*St+H[12],wt=H[1]*lt+H[5]*St+H[13],st=H[2]*lt+H[6]*St+H[14],Et=H[3]*lt+H[7]*St+H[15],gt=bt+re,kt=wt+ae,Tt=st+ue,lr=Math.max(Et+xe,1e-5),dr=bt+ye,Wt=wt+Ie,Yt=st+Pe,Fr=Math.max(Et+Ae,1e-5);Oe.push(new ng(gt/lr,kt/lr,Tt/lr)),ht.push(new ng(dr/Fr,Wt/Fr,Yt/Fr))}Q.push(Oe),K.push(ht)}return[Q,K]})(e,r,l,u,m)}function IA(o,e,r,l,u,m,g,b){const E=g*u.getElevationAt(o,e,!0,!0),A=m[0]!==0,N=A?m[1]===0?g*(m[0]/7-450):g*(function(j,R,B){const V=Math.floor(R[0]/8),H=Math.floor(R[1]/8),Q=10*(R[0]-8*V),K=10*(R[1]-8*H),re=j.getElevationAt(V,H,!0,!0),ae=j.getMeterToDEM(B),ue=Math.floor(.5*(Q*ae-1)),xe=Math.floor(.5*(K*ae-1)),ye=j.tileCoordToPixel(V,H),Ie=2*ue+1,Pe=2*xe+1,Ae=(function(St,bt,wt,st,Et){return[St.getElevationAtPixel(bt,wt,!0),St.getElevationAtPixel(bt+Et,wt,!0),St.getElevationAtPixel(bt,wt+Et,!0),St.getElevationAtPixel(bt+st,wt+Et,!0)]})(j,ye.x-ue,ye.y-xe,Ie,Pe),je=Math.abs(Ae[0]-Ae[1]),Oe=Math.abs(Ae[2]-Ae[3]),ht=Math.abs(Ae[0]-Ae[2])+Math.abs(Ae[1]-Ae[3]),at=Math.min(.25,.5*ae*(je+Oe)/Ie),lt=Math.min(.25,.5*ae*ht/Pe);return re+Math.max(at*Q,lt*K)})(u,m,b):E;return{base:E+(r===0?-1:r),top:A?Math.max(N+l,E+r+2):E+l}}class y4{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class _4{constructor(){this.tasks={},this.taskQueue=[],ct(["process"],this),this.invoker=new y4(this.process),this.nextId=0}add(e,r){const l=this.nextId++,u=(function({type:m,isSymbolTile:g,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-b:m==="maybePrepare"&&g?400-b:500:200-b:100-b})(r);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:r,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const m=this.tasks[this.taskQueue[u]];m.priority<r&&(r=m.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class PA{constructor(e,r,l){this.target=e,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},ct(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new _4}send(e,r,l,u,m=!1,g){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[b]=l);const E=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!l,targetMapId:u,mustQueue:m,sourceMapId:this.mapId,data:Va(r,E)},E),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(r.mustQueue||Yi(self)){const u=this.callbacks[l],m=this.scheduler.add(()=>this.processTask(l,r),u&&u.metadata||{type:"message"});m&&(this.cancelCallbacks[l]=m)}else this.processTask(l,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(r.error?l(dc(r.error)):l(null,dc(r.data)))}else{const l=new Set,u=r.hasCallback?(g,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Va(g):null,data:Va(b,l)},l)}:()=>{},m=dc(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,m,u);else if(this.parent.getWorkerSource){const g=r.type.split("."),{source:b,scope:E}=m;this.parent.getWorkerSource(r.sourceMapId,g[0],b,E)[g[1]](m,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var V_={workerUrl:"",workerClass:null,workerParams:void 0};function x4(o){return V_.workerClass!=null?new V_.workerClass:new self.Worker(V_.workerUrl,Object.assign({name:o},V_.workerParams))}const u1="mapboxgl_preloaded_worker_pool";class ig{constructor(e){this.active={},this.name=e}acquire(e,r=ig.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;){const l=x4(`${this.name||""}WorkerPool: ${e}-${this.workers.length}`);this.workers.push(l)}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[u1]}numActive(){return Object.keys(this.active).length}}ig.workerCount=2;class iy{constructor(e,r,l="Worker",u=ig.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ve();const m=this.workerPool.acquire(this.id,u);for(let g=0;g<m.length;g++){const b=new iy.Actor(m[g],r,this.id);b.name=`${l} ${g}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,l){qe(this.actors,(u,m)=>{u.send(e,r,m)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let U_,d1;function Qv(){return U_||(U_=new ig),U_}iy.Actor=PA;const h1=4096;class v4{constructor(e){this.module=e,this.memoryStack=this.module.malloc(h1),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const r=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>h1?-1:(new Int32Array(this.module.heap32.buffer,r,e.length).set(e),r)}createFloatArray(e){const r=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>h1?-1:(new Float32Array(this.module.heapF32.buffer,r,e.length).set(e),r)}readStringBuffer(e){let r="";for(;this.module.heapU8[e]!==0;)r+=String.fromCharCode(this.module.heapU8[e]),++e;return r}setStyle(e){const r=e.normalScale;this.module.setStyle(r[0],r[1],r[2],e.tileToMeters)}setAOOptions(e,r){this.module.setAOOptions(e?1:0,r)}setMetricOptions(e,r){this.module.setMetricOptions(e?1:0,r)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,r){this.module.setFacadeOptions(e,r?1:0)}setFauxFacadeOptions(e,r,l){this.module.setFauxFacadeOptions(e?1:0,r?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,r){this.memoryStackNextFree=this.memoryStack;for(const b of e){const E=this.createIntArray(b.ringIndices),A=this.createFloatArray(b.coordinates);if(E===-1||A===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,b.roofType,A,E,b.ringIndices.length-1)}for(const b of r){let E;E=b.entrances?JSON.parse(b.entrances):[];const A=this.createFloatArray(E),N=this.createFloatArray(b.coordinates);if(A===-1||N===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,A,E.length,N,b.coordinates.length)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const l=this.module.getMeshCount(),u=new Array(l);for(let b=0;b<l;b++){const E=this.module.getPositionsPtr(b),A=this.module.getPositionsLength(b),N=new Float32Array(this.module.heapF32.buffer,E,A),j=this.module.getNormalsPtr(b),R=this.module.getNormalsLength(b),B=new Float32Array(this.module.heapF32.buffer,j,R),V=this.module.getAOPtr(b),H=this.module.getAOLength(b),Q=new Float32Array(this.module.heapF32.buffer,V,H),K=this.module.getUVPtr(b),re=this.module.getUVLength(b),ae=new Float32Array(this.module.heapF32.buffer,K,re),ue=this.module.getFauxFacadePtr(b),xe=this.module.getFauxFacadeLength(b),ye=new Uint8Array(this.module.heapU8.buffer,ue,xe),Ie=this.module.getIndicesPtr(b),Pe=this.module.getIndicesLength(b),Ae=new Int16Array(this.module.heap16.buffer,Ie,Pe),je=this.module.getBuildingPart(b);u[b]={positions:N,normals:B,ao:Q,uv:ae,isFauxFacade:ye,indices:Ae,buildingPart:je}}const m=this.module.getRingCount(),g=[];for(let b=0;b<m;b++){const E=this.module.getRingPtr(b),A=this.module.getRingLength(b),N=new Float32Array(this.module.heapF32.buffer,E,A);g.push(N)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let $_,f1,fd,sy,p1,oy=null,ay=null,kA=null,Jv=null;function NA(){return Yi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:f1||Qi.DRACO_URL}function jA(){if(Yi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(sy)return sy;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return sy=WebAssembly.validate(o)?Qi.MESHOPT_SIMD_URL:Qi.MESHOPT_URL,sy}function b4(){return Jv}const RA=5120,MA=5121,LA=5122,DA=5123,OA=5125,zA=5126,eb={[RA]:Int8Array,[MA]:Uint8Array,[LA]:Int16Array,[DA]:Uint16Array,[OA]:Uint32Array,[zA]:Float32Array},w4={[RA]:"DT_INT8",[MA]:"DT_UINT8",[LA]:"DT_INT16",[DA]:"DT_UINT16",[OA]:"DT_UINT32",[zA]:"DT_FLOAT32"},q_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function FA(o,e,r){const l=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=l,r.json.bufferViews[l]={buffer:u,byteLength:o.byteLength},r.buffers[u]=o}const m1="KHR_draco_mesh_compression";function S4(o,e){const r=o.extensions&&o.extensions[m1];if(!r)return;const l=new fd.Decoder,u=$A(e,r.bufferView),m=new fd.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,m))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[o.indices],b=eb[g.componentType],E=g.count*b.BYTES_PER_ELEMENT,A=fd._malloc(E);b===Uint16Array?l.GetTrianglesUInt16Array(m,E,A):l.GetTrianglesUInt32Array(m,E,A),FA(fd.memory.buffer.slice(A,A+E),g,e),fd._free(A);for(const N of Object.keys(r.attributes)){const j=l.GetAttributeByUniqueId(m,r.attributes[N]),R=e.json.accessors[o.attributes[N]],B=w4[R.componentType],V=R.count*q_[R.type]*eb[R.componentType].BYTES_PER_ELEMENT,H=fd._malloc(V);l.GetAttributeDataArrayForAllPoints(m,j,fd[B],V,H),FA(fd.memory.buffer.slice(H,H+V),R,e),fd._free(H)}l.destroy(),m.destroy(),delete o.extensions[m1]}const tb="EXT_meshopt_compression";function T4(o,e){if(!o.extensions||!o.extensions[tb])return;const r=o.extensions[tb],l=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);p1.decodeGltfBuffer(u,r.count,r.byteStride,l,r.mode,r.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[tb]}const BA=1179937895,VA=new TextDecoder("utf8");function UA(o,e){return new URL(o,e).href}function E4(o,e,r,l){return fetch(UA(o.uri,l)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function $A(o,e){const r=o.json.bufferViews[e];return new Uint8Array(o.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function C4(o,e,r,l){if(o.uri){const u=UA(o.uri,l);return fetch(u).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[r]=m})}if(o.bufferView!==void 0){const u=$A(e,o.bufferView),m=new Blob([u],{type:o.mimeType});return createImageBitmap(m).then(g=>{e.images[r]=g})}}function qA(o,e=0,r){const l={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===BA){const N=new Uint32Array(o,e);let j=2;const R=(N[j++]>>2)-3,B=N[j++]>>2;if(j++,l.json=JSON.parse(VA.decode(N.subarray(j,j+B))),j+=B,j<R){const V=N[j++];j++;const H=e+(j<<2);l.buffers[0]=o.slice(H,H+V)}}else l.json=JSON.parse(VA.decode(new Uint8Array(o,e)));const{buffers:u,images:m,meshes:g,extensionsUsed:b,bufferViews:E}=l.json;let A=Promise.resolve();if(u){const N=[];for(let j=0;j<u.length;j++){const R=u[j];R.uri?N.push(E4(R,l,j,r)):l.buffers[j]||(l.buffers[j]=null)}A=Promise.all(N)}return A.then(()=>{const N=[],j=b&&b.includes(m1),R=b&&b.includes(tb);if(j&&N.push((function(){if(!fd)return $_??($_=(function(B){let V,H=null;function Q(){V=new Uint8Array(H.buffer)}function K(){throw new Error("Unexpected Draco error.")}const re={a:{a:K,d:function(ae,ue,xe){return V.copyWithin(ae,ue,ue+xe)},c:function(ae){const ue=V.length,xe=Math.max(ae>>>0,Math.ceil(1.2*ue)),ye=Math.ceil((xe-ue)/65536);try{return H.grow(ye),Q(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,re):B.then(ae=>ae.arrayBuffer()).then(ae=>WebAssembly.instantiate(ae,re))).then(ae=>{const{Rb:ue,Qb:xe,P:ye,T:Ie,X:Pe,Ja:Ae,La:je,Qa:Oe,Va:ht,Wa:at,eb:lt,jb:St,f:bt,e:wt,yb:st,zb:Et,Ab:gt,Bb:kt,Db:Tt,Gb:lr}=ae.instance.exports;H=wt;const dr=(()=>{let Wt=0,Yt=0,Fr=0,wr=0;return nr=>{Fr&&(ue(wr),ue(Wt),Yt+=Fr,Fr=Wt=0),Wt||(Yt+=128,Wt=xe(Yt));const en=nr.length+7&-8;let kn=Wt;en>=Yt&&(Fr=en,kn=wr=xe(en));for(let li=0;li<nr.length;li++)V[kn+li]=nr[li];return kn}})();return Q(),bt(),{memory:wt,_free:ue,_malloc:xe,Mesh:class{constructor(){this.ptr=ye()}destroy(){Ie(this.ptr)}},Decoder:class{constructor(){this.ptr=Ae()}destroy(){St(this.ptr)}DecodeArrayToMesh(Wt,Yt,Fr){const wr=dr(Wt),nr=je(this.ptr,wr,Yt,Fr.ptr);return!!Pe(nr)}GetAttributeByUniqueId(Wt,Yt){return{ptr:Oe(this.ptr,Wt.ptr,Yt)}}GetTrianglesUInt16Array(Wt,Yt,Fr){ht(this.ptr,Wt.ptr,Yt,Fr)}GetTrianglesUInt32Array(Wt,Yt,Fr){at(this.ptr,Wt.ptr,Yt,Fr)}GetAttributeDataArrayForAllPoints(Wt,Yt,Fr,wr,nr){lt(this.ptr,Wt.ptr,Yt.ptr,Fr,wr,nr)}},DT_INT8:st(),DT_UINT8:Et(),DT_INT16:gt(),DT_UINT16:kt(),DT_UINT32:Tt(),DT_FLOAT32:lr()}})})(fetch(NA())),$_.then(B=>{fd=B,$_=void 0}))})()),R&&N.push((function(){if(p1)return;const B=(function(V){let H;const Q=WebAssembly.instantiateStreaming(V,{}).then(ae=>{H=ae.instance,H.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},re={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(ae,ue,xe,ye,Ie,Pe){(function(Ae,je,Oe,ht,at,lt,St){const bt=Ae.exports.sbrk,wt=ht+3&-4,st=bt(wt*at),Et=bt(lt.length),gt=new Uint8Array(Ae.exports.memory.buffer);gt.set(lt,Et);const kt=je(st,ht,at,Et,lt.length);if(kt===0&&St&&St(st,wt,at),Oe.set(gt.subarray(st,st+ht*at)),bt(st-bt(0)),kt!==0)throw new Error(`Malformed buffer data: ${kt}`)})(H,H.exports[re[Ie]],ae,ue,xe,ye,H.exports[K[Pe]])}}})(fetch(jA()));return B.ready.then(()=>{p1=B})})()),m)for(let B=0;B<m.length;B++)N.push(C4(m[B],l,B,r));return(N.length?Promise.all(N):Promise.resolve()).then(()=>{if(j&&g)for(const{primitives:B}of g)for(const V of B)S4(V,l);if(R&&g&&E)for(const B of E)T4(B,l);return l})})}function GA(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>qA(e,0,o))}function g1(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function y1(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class _1{constructor(e,r,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:u&&u.premultiply})}update(e,r){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:g}=m,{x:b,y:E}=r&&r.position?r.position:{x:0,y:0},A=b+l,N=E+u;!this.size||this.size[0]===A&&this.size[1]===N||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!r||r.premultiply!==!1));const j=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&N>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(A,N)))+1:1;g.texStorage2D(g.TEXTURE_2D,R,this.format,A,N),this.size=[A,N]}this.size&&(j?g.texSubImage2D(g.TEXTURE_2D,0,b,E,g1(this.format),y1(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,b,E,l,u,g1(this.format),y1(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,r,l=!1){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,l,u,m){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),r!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?e===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,u),this.wrapT=u),m!==this.compareMode&&(m?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,m)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class G_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}const A4=Tn([{name:"a_pos_3f",components:3,type:"Float32"}]),I4=Tn([{name:"a_color_3f",components:3,type:"Float32"}]),P4=Tn([{name:"a_color_4f",components:4,type:"Float32"}]),k4=Tn([{name:"a_uv_2f",components:2,type:"Float32"}]),N4=Tn([{name:"a_normal_3f",components:3,type:"Float32"}]),j4=Tn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),R4=Tn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function WA(o,e){const r=rb(o.projection,o.zoom,o.width,o.height),l=(function(m,g,b,E,A){const N=new _e(b.lng-180*Kp,b.lat),j=new _e(b.lng+180*Kp,b.lat),R=m.project(N.lng,N.lat),B=m.project(j.lng,j.lat),V=-Math.atan2(B.y-R.y,B.x-R.x),H=Kt.fromLngLat(b);H.y=Ee(H.y,-1+Kp,1-Kp);const Q=H.toLngLat(),K=m.project(Q.lng,Q.lat),re=Kt.fromLngLat(Q);re.x+=Kp;const ae=re.toLngLat(),ue=m.project(ae.lng,ae.lat),xe=ZA(ue.x-K.x,ue.y-K.y,V),ye=Kt.fromLngLat(Q);ye.y+=Kp;const Ie=ye.toLngLat(),Pe=m.project(Ie.lng,Ie.lat),Ae=ZA(Pe.x-K.x,Pe.y-K.y,V),je=Math.abs(xe.x)/Math.abs(Ae.y),Oe=oe([]);We(Oe,Oe,-V*(1-(A?0:E)));const ht=oe([]);return Re(ht,ht,[1,1-(1-je)*E,1]),ht[4]=-Ae.x/Ae.y*E,We(ht,ht,V),me(ht,Oe,ht),ht})(o.projection,0,o.center,r,e),u=HA(o);return Re(l,l,[u,u,1]),l}function HA(o){const e=o.projection,r=rb(o.projection,o.zoom,o.width,o.height),l=x1(e,o.center),u=x1(e,_e.convert(e.center));return Math.pow(2,l*r+(1-r)*u)}function rb(o,e,r,l,u=1/0){const m=o.range;if(!m)return 0;const g=Math.min(u,Math.max(r,l)),b=Math.log2(g/1024);return Fe(m[0]+b,m[1]+b,e)}const Kp=1/4e4;function x1(o,e){const r=Ee(e.lat,-85.051129,Le),l=new _e(e.lng-180*Kp,r),u=new _e(e.lng+180*Kp,r),m=o.project(l.lng,r),g=o.project(u.lng,r),b=Kt.fromLngLat(l),E=Kt.fromLngLat(u),A=g.x-m.x,N=g.y-m.y,j=E.x-b.x,R=E.y-b.y,B=Math.sqrt((j*j+R*R)/(A*A+N*N));return Math.log2(B)}function ZA(o,e,r){const l=Math.cos(r),u=Math.sin(r);return{x:o*l-e*u,y:o*u+e*l}}function XA(o,e,r){oe(o),We(o,o,vn(e[2])),Be(o,o,vn(e[0])),rt(o,o,vn(e[1])),Re(o,o,r),me(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function nb(o,e,r,l,u,m,g,b){const E=[r[0]-e[0],r[1]-e[1],0],A=[l[0]-e[0],l[1]-e[1],0];if(Ar(E)<1e-12||Ar(A)<1e-12)return sn(o);const N=Ur([],E,A);ir(N,N),Mt(A,l,e),E[2]=(m-u)*b,A[2]=(g-u)*b;const j=E;return Ur(j,E,A),ir(j,j),Ln(o,N,j)}function ib(o,e,r=!1){const l=Wp(e.zoom),u=(function(m,g,b){const E=g.worldSize,A=[m[12],m[13],m[14]],N=Pt(A[1]/E),j=mt(A[0]/E),R=oe([]),B=tt(1,N)*E,V=tt(1,0)*E*nt(N,g.zoom),H=1/Vw(E);let Q=V*H;if(b){const ue=rb(g.projection,g.zoom,g.width,g.height,1024);Q=H*g.projection.pixelSpaceConversion(g.center.lat,E,ue)}const K=Ce(N,j);ut(K,K,xr([],ir([],K),B*Q*A[2]));const re=(function(ue){const xe=[ue[0],ue[1],ue[2]];let ye=[0,1,0];const Ie=Ur([],ye,xe);return Ur(ye,xe,Ie),Zr(ye)===0&&(ye=[0,1,0],Ur(Ie,xe,ye)),ir(Ie,Ie),ir(ye,ye),ir(xe,xe),[Ie[0],Ie[1],Ie[2],0,ye[0],ye[1],ye[2],0,xe[0],xe[1],xe[2],0,ue[0],ue[1],ue[2],1]})(K);Re(R,R,[Q,Q,Q*B]),Se(R,R,[-A[0],-A[1],-A[2]]);const ae=me([],g.globeMatrix,re);return me(ae,ae,R),me(ae,ae,m),ae})(o,e,r);if(l>0){const m=(function(g,b){const E=b.worldSize,A=tt(1,0)*E*nt(b.center.lat,b.zoom)/Vw(E),N=tt(1,b.center.lat)*E,j=oe([]);rt(j,j,vn(b.center.lng)),Be(j,j,vn(b.center.lat)),Se(j,j,[0,0,te]),Re(j,j,[A,A,A*N]);const R=b.point;return Se(j,j,[-R.x,-R.y,0]),me(j,j,g),me(j,b.globeMatrix,j)})(o,e);return(function(g,b,E){const A=(V,H,Q)=>{const K=Ar(V),re=Ar(H),ae=Bf(V,H,Q);return xr(ae,ae,1/Ar(ae)*$r(K,re,Q))},N=A([g[0],g[1],g[2]],[b[0],b[1],b[2]],E),j=A([g[4],g[5],g[6]],[b[4],b[5],b[6]],E),R=A([g[8],g[9],g[10]],[b[8],b[9],b[10]],E),B=Bf([g[12],g[13],g[14]],[b[12],b[13],b[14]],E);return[N[0],N[1],N[2],0,j[0],j[1],j[2],0,R[0],R[1],R[2],0,B[0],B[1],B[2],1]})(u,m,l)}return u}function v1(o,e,r,l){const u=Wn.projectAabbCorners(l,r);let m=Number.MAX_VALUE;for(let b=0;b<u.length;++b){const E=u[b];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<m&&(m=E[2])}const g=(function(b){const E=[];let A=0;for(let B=1;B<b.length;B++)(b[B][0]<b[A][0]||b[B][0]===b[A][0]&&b[B][1]<b[A][1])&&(A=B);let N,j=A;const R=new Uint8Array(b.length);do{if(R[j])break;E.push(new Nt(b[j][0],b[j][1])),R[j]=1,N=(j+1)%b.length;for(let B=0;B<b.length;B++){if(b[B][0]===b[N][0]&&b[B][1]===b[N][1]||b[B][0]===b[j][0]&&b[B][1]===b[j][1])continue;const V=[b[B][0]-b[j][0],b[B][1]-b[j][1]],H=[b[N][0]-b[j][0],b[N][1]-b[j][1]],Q=V[0]*H[1]-V[1]*H[0];(Q>0||Q===0&&V[0]*H[0]+V[1]*H[1]>=0&&V[0]*V[0]+V[1]*V[1]>H[0]*H[0]+H[1]*H[1])&&(N=B)}j=N}while(j!==A);return E.length>0&&E.push(E[0]),E})(u);if(w(o,g))return m}const sg=64,ly={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function sb(o,e,r,l,u,m,g,b,E,A=!1){const N=r.zoom,j=r.project(l),R=nt(l.lat,N),B=1/R;oe(o),Se(o,o,[j.x+g[0]*B,j.y+g[1]*B,g[2]]);let V=1,H=1;const Q=r.worldSize;if(A){if(r.projection.name==="mercator"){let ue=0;r.elevation&&(ue=r.elevation.getAtPointOrZero(new Kt(j.x/Q,j.y/Q),0));const xe=Jt([],[j.x,j.y,ue,1],r.projMatrix)[3]/r.cameraToCenterDistance;V=xe,H=xe*nt(r.center.lat,N)}else if(r.projection.name==="globe"){const ue=ib(o,r),xe=[0,0,0,1];Jt(xe,xe,me([],r.projMatrix,ue));const ye=xe[3]/r.cameraToCenterDistance,Ie=Wp(N),Pe=r.projection.pixelsPerMeter(l.lat,Q)*nt(l.lat,N),Ae=r.projection.pixelsPerMeter(r.center.lat,Q)*nt(r.center.lat,N);V=ye/$r(Pe,dt(r.center.lat),Ie),H=ye*R/Pe,V*=Ae,H*=Ae}}else V=B;Re(o,o,[V,V,H]);const K=[...o],re=e.orientation,ae=[];if(XA(ae,[re[0]+(u?u[0]:0),re[1]+(u?u[1]:0),re[2]+(u?u[2]:0)],m),me(o,K,ae),b&&r.elevation){let ue=0;const xe=[];if(E&&r.elevation){ue=(function(Ie,Pe,Ae,je,Oe){const ht=Pe.elevation;if(!ht)return 0;const at=Wn.projectAabbCorners(Ae,je),lt=tt(1,Oe.lat)*Pe.worldSize,St=(function(Yt,Fr){const wr=[0,0,1],nr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const en of nr){const kn=Yt[en.corners[0]],li=Yt[en.corners[1]],En=Yt[en.corners[2]],Ai=[li[0]-kn[0],li[1]-kn[1],Fr*(li[2]-kn[2])],Kn=Ur(Ai,Ai,[En[0]-kn[0],En[1]-kn[1],Fr*(En[2]-kn[2])]);ir(Kn,Kn),en.dotProductWithUp=Hr(Kn,wr)}return nr.sort((en,kn)=>en.dotProductWithUp-kn.dotProductWithUp),nr[0].corners})(at,lt),bt=at[St[0]],wt=at[St[1]],st=at[St[2]],Et=at[St[3]],gt=ht.getAtPointOrZero(new Kt(bt[0]/Pe.worldSize,bt[1]/Pe.worldSize),0),kt=ht.getAtPointOrZero(new Kt(wt[0]/Pe.worldSize,wt[1]/Pe.worldSize),0),Tt=ht.getAtPointOrZero(new Kt(st[0]/Pe.worldSize,st[1]/Pe.worldSize),0),lr=ht.getAtPointOrZero(new Kt(Et[0]/Pe.worldSize,Et[1]/Pe.worldSize),0),dr=(gt+lr)/2,Wt=(kt+Tt)/2;return dr>Wt?kt<Tt?nb(Ie,wt,Et,bt,kt,lr,gt,lt):nb(Ie,st,bt,Et,Tt,gt,lr,lt):gt<lr?nb(Ie,bt,wt,st,gt,kt,Tt,lt):nb(Ie,Et,st,wt,lr,Tt,kt,lt),Math.max(dr,Wt)})(xe,r,e.aabb,o,l);const ye=me([],rr([],xe),ae);me(o,K,ye)}else ue=r.elevation.getAtPointOrZero(new Kt(j.x/Q,j.y/Q),0);ue!==0&&(o[14]+=ue)}}class KA{constructor(e,r,l,u,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=r,this.position=l!=null?new _e(l[0],l[1]):new _e(0,0),this.orientation=u??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,r){me(e.globalMatrix,r,e.localMatrix);const l=this.nodeOverrides.get(e.name);if(l!==void 0){const g=[];m=l.orientation,oe(u=g),rt(u,u,vn(m[1])),We(u,u,vn(m[2])),Be(u,u,vn(m[0])),me(e.globalMatrix,e.globalMatrix,g)}var u,m;if(e.meshes)for(const g of e.meshes){const b=Wn.applyTransformFast(g.aabb,e.globalMatrix);this.aabb.encapsulate(b)}if(e.children)for(const g of e.children)this._applyTransformations(g,e.globalMatrix)}computeBoundsAndApplyParent(){const e=oe([]);this.aabb=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.nodes)this._applyTransformations(r,e)}computeModelMatrix(e,r,l,u,m,g,b=!1){sb(this.matrix,this,e.transform,this.position,r,l,u,m,g,b)}upload(e){if(!this.uploaded){for(const r of this.nodes)b1(r,e);for(const r of this.nodes)ob(r);this.uploaded=!0}}destroy(){for(const e of this.nodes)w1(e)}}function W_(o,e,r=!1){o.uploaded||(o.gfxTexture=new _1(e,o.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function M4(o,e,r){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,A4.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,N4.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,k4.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?I4:P4).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,R4.members,!0)),o.segments=Zi.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const l=o.material;l.pbrMetallicRoughness.baseColorTexture&&W_(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&W_(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&W_(l.normalTexture,e),l.occlusionTexture&&W_(l.occlusionTexture,e,r),l.emissionTexture&&W_(l.emissionTexture,e)}function b1(o,e,r){if(o.meshes)for(const l of o.meshes)M4(l,e,r);if(o.children)for(const l of o.children)b1(l,e,r)}function ob(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)ob(e)}function L4(o){o.pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()}function w1(o){if(o.meshes)for(const e of o.meshes)e.vertexBuffer&&(e.vertexBuffer.destroy(),e.indexBuffer.destroy(),e.normalBuffer&&e.normalBuffer.destroy(),e.texcoordBuffer&&e.texcoordBuffer.destroy(),e.colorBuffer&&e.colorBuffer.destroy(),e.pbrBuffer&&e.pbrBuffer.destroy(),e.segments.destroy(),e.material&&L4(e.material));if(o.children)for(const e of o.children)w1(e)}function og(o,e){const r=o.json.bufferViews[e.bufferView],l=eb[e.componentType];return new l(o.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==q_[e.type]*l.BYTES_PER_ELEMENT?r.byteStride/l.BYTES_PER_ELEMENT:q_[e.type]))}function S1(o,e,r,l){const u=eb[e.componentType],m=(function(N){switch(N){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(u),g=o.json.bufferViews[e.bufferView],b=g.byteStride?g.byteStride/u.BYTES_PER_ELEMENT:q_[e.type],E=r.float32,A=E.length/r.capacity;for(let N=0,j=0;N<e.count*b;N+=b,j+=A)for(let R=0;R<A;R++)E[j+R]=l[N+R]*m;r._trim()}function D4(o,e,r){const l=o.indices,u=o.attributes,m={};m.indexArray=new Os;const g=e.json.accessors[l],b=g.count/3;m.indexArray.reserve(b);const E=og(e,g);for(let R=0;R<b;R++)m.indexArray.emplaceBack(E[3*R],E[3*R+1],E[3*R+2]);m.indexArray._trim(),m.vertexArray=new ml;const A=e.json.accessors[u.POSITION];m.vertexArray.reserve(A.count);const N=og(e,A);for(let R=0;R<A.count;R++)m.vertexArray.emplaceBack(N[3*R],N[3*R+1],N[3*R+2]);if(m.vertexArray._trim(),m.aabb=new Wn(A.min,A.max),m.centroid=(function(R,B){const V=[0,0,0],H=R.length;if(H>0){for(let Q=0;Q<H;Q++){const K=3*R[Q];V[0]+=B[K],V[1]+=B[K+1],V[2]+=B[K+2]}V[0]/=H,V[1]/=H,V[2]/=H}return V})(E,N),u.COLOR_0!==void 0){const R=e.json.accessors[u.COLOR_0],B=q_[R.type],V=og(e,R);m.colorArray=B===3?new ml:new vu,m.colorArray.resize(R.count),S1(e,R,m.colorArray,V)}if(u.NORMAL!==void 0){m.normalArray=new ml;const R=e.json.accessors[u.NORMAL];m.normalArray.resize(R.count);const B=og(e,R);S1(e,R,m.normalArray,B)}if(u.TEXCOORD_0!==void 0&&r.length>0){m.texcoordArray=new Su;const R=e.json.accessors[u.TEXCOORD_0];m.texcoordArray.resize(R.count);const B=og(e,R);S1(e,R,m.texcoordArray,B)}if(u._FEATURE_ID_RGBA4444!==void 0){const R=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=og(e,R))}u._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(og(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const j=o.material;return m.material=(function(R,B){const{emissiveFactor:V=[0,0,0],alphaMode:H="OPAQUE",alphaCutoff:Q=.5,normalTexture:K,occlusionTexture:re,emissiveTexture:ae,doubleSided:ue,name:xe}=R,{baseColorFactor:ye=[1,1,1,1],metallicFactor:Ie=1,roughnessFactor:Pe=1,baseColorTexture:Ae,metallicRoughnessTexture:je}=R.pbrMetallicRoughness||{},Oe=re?B[re.index]:void 0;if(re&&re.extensions&&re.extensions.KHR_texture_transform&&Oe){const ht=re.extensions.KHR_texture_transform;Oe.offsetScale=[ht.offset[0],ht.offset[1],ht.scale[0],ht.scale[1]]}return{name:xe,pbrMetallicRoughness:{baseColorFactor:new ii(...ye),metallicFactor:Ie,roughnessFactor:Pe,baseColorTexture:Ae?B[Ae.index]:void 0,metallicRoughnessTexture:je?B[je.index]:void 0},doubleSided:ue,emissiveFactor:new ii(...V),alphaMode:H,alphaCutoff:Q,normalTexture:K?B[K.index]:void 0,occlusionTexture:Oe,emissionTexture:ae?B[ae.index]:void 0,defined:R.defined===void 0}})(j!==void 0?e.json.materials[j]:{defined:!1},r),m}function YA(o,e,r){const{matrix:l,rotation:u,translation:m,scale:g,mesh:b,extras:E,children:A,name:N}=o,j={};if(j.name=N,j.localMatrix=l||(function(R,B,V,H){var Q=B[0],K=B[1],re=B[2],ae=B[3],ue=Q+Q,xe=K+K,ye=re+re,Ie=Q*ue,Pe=Q*xe,Ae=Q*ye,je=K*xe,Oe=K*ye,ht=re*ye,at=ae*ue,lt=ae*xe,St=ae*ye,bt=H[0],wt=H[1],st=H[2];return R[0]=(1-(je+ht))*bt,R[1]=(Pe+St)*bt,R[2]=(Ae-lt)*bt,R[3]=0,R[4]=(Pe-St)*wt,R[5]=(1-(Ie+ht))*wt,R[6]=(Oe+at)*wt,R[7]=0,R[8]=(Ae+lt)*st,R[9]=(Oe-at)*st,R[10]=(1-(Ie+je))*st,R[11]=0,R[12]=V[0],R[13]=V[1],R[14]=V[2],R[15]=1,R})([],u||[0,0,0,1],m||[0,0,0],g||[1,1,1]),j.globalMatrix=se(j.localMatrix),b!==void 0){j.meshes=r[b];const R=j.anchor=[0,0];for(const B of j.meshes){const{min:V,max:H}=B.aabb;R[0]+=V[0]+H[0],R[1]+=V[1]+H[1]}R[0]=Math.floor(R[0]/j.meshes.length/2),R[1]=Math.floor(R[1]/j.meshes.length/2)}if(E&&(E.id&&(j.id=E.id),E.lights&&(j.lights=(function(R){if(!R.length)return[];const B=(function(re){const ae=atob(re),ue=new Uint8Array(ae.length);for(let xe=0;xe<ae.length;xe++)ue[xe]=ae.codePointAt(xe);return ue})(R),V=[],H=B.length/24,Q=new Uint16Array(B.buffer),K=new Float32Array(B.buffer);for(let re=0;re<H;re++){const ae=Q[2*re*6]/30,ue=Q[2*re*6+1]/30,xe=Q[2*re*6+10]/100,ye=K[6*re+1],Ie=K[6*re+2],Pe=K[6*re+3],Ae=K[6*re+4],je=Pe-ye,Oe=Ae-Ie,ht=Math.hypot(je,Oe);V.push({pos:[ye+.5*je,Ie+.5*Oe,ue],normal:[Oe/ht,-je/ht,0],width:ht,height:ae,depth:xe,points:[ye,Ie,Pe,Ae]})}return V})(E.lights)),E.MAPBOX_geometry_bloom&&(j.isGeometryBloom=E.MAPBOX_geometry_bloom)),A){const R=[];for(const B of A)R.push(YA(e.json.nodes[B],e,r));j.children=R}return j}function O4(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new Wv(o.vertices,o.indices,8,256),[r,l]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:r,max:l}}function z4(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const l=[];for(const g of r){if(!Array.isArray(g)||g.length!==2)continue;const b=g[0],E=g[1];typeof b=="number"&&typeof E=="number"&&l.push(new Nt(b,E))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let g=0;g<l.length;g++){const b=l[g],E=l[(g+1)%l.length],A=l[(g+2)%l.length];u+=(b.x-E.x)*(A.y-E.y)-(A.x-E.x)*(b.y-E.y)}u>0&&l.reverse();const m=ey(l.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:l,indices:m}}function F4(o,e){const r=[],l=[];let u=0;const m=[];for(const g of o){u=r.length;const b=g.vertexArray.float32,E=g.indexArray.uint16;for(let A=0;A<g.vertexArray.length;A++)m[0]=b[3*A+0],m[1]=b[3*A+1],m[2]=b[3*A+2],Sn(m,m,e),r.push(new Nt(m[0],m[1]));for(let A=0;A<3*g.indexArray.length;A++)l.push(E[A]+u)}if(l.length%3!=0)return null;for(let g=0;g<l.length;g+=3){const b=r[l[g+0]],E=r[l[g+1]],A=r[l[g+2]];(b.x-E.x)*(A.y-E.y)-(A.x-E.x)*(b.y-E.y)>0&&([l[g+1],l[g+2]]=[l[g+2],l[g+1]])}return{vertices:r,indices:l}}function T1(o){const e=(function(E,A){const N=[],j=WebGL2RenderingContext;if(E.json.textures)for(const R of E.json.textures){const B={magFilter:j.LINEAR,minFilter:j.NEAREST,wrapS:j.REPEAT,wrapT:j.REPEAT};R.sampler!==void 0&&Object.assign(B,E.json.samplers[R.sampler]),N.push({image:A[R.source],sampler:B,uploaded:!1})}return N})(o,o.images),r=(function(E,A){const N=[];for(const j of E.json.meshes){const R=[];for(const B of j.primitives)R.push(D4(B,E,A));N.push(R)}return N})(o,e),{scenes:l,scene:u,nodes:m}=o.json,g=l?l[u||0].nodes:[...m.keys()],b=[];for(const E of g)b.push(YA(m[E],o,r));return(function(E,A,N){const j={},R=new Set;for(let B=0;B<E.length;B++){const V=N[A[B]];if(!V.extras)continue;const H=V.extras["mapbox:footprint:version"],Q=V.extras["mapbox:footprint:id"];(H||Q)&&R.add(B),H==="1.0.0"&&Q&&(j[Q]=B)}for(let B=0;B<E.length;B++){if(R.has(B))continue;const V=E[B],H=N[A[B]];if(!H.extras)continue;let Q=null;V.id in j&&(Q=F4(E[j[V.id]].meshes,V.localMatrix)),Q||(Q=z4(H)),Q&&(V.footprint=O4(Q))}if(R.size>0){const B=Array.from(R.values()).sort((V,H)=>V-H);for(let V=B.length-1;V>=0;V--)E.splice(B[V],1)}})(b,g,o.json.nodes),b}function B4(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,r=o.aabb.min[0]-1,l=o.aabb.min[1]-1,u=sg/(o.aabb.max[0]-r+2),m=sg/(o.aabb.max[1]-l+2);for(let g=0;g<e.length;g+=3){const b=e[g+2],E=(e[g+0]-r)*u|0,A=(e[g+1]-l)*m|0;b>o.heightmap[A*sg+E]&&(o.heightmap[A*sg+E]=b)}}function QA(o,e,r,l,u){r.reserve(r.length+4*o.length),l.reserve(l.length+10*o.length),u.reserve(u.length+10*o.length);let m=l.length;for(const g of o){const b=Math.min(10,Math.max(4,1.3*g.height))*e,E=[-g.normal[1],g.normal[0],0],A=Math.min(.29,.1*g.width/g.depth),N=g.width-2*g.depth*e*(A+.01),j=Lr([],g.pos,E,N/2),R=Lr([],g.pos,E,-N/2),B=[j[0],j[1],j[2]+g.height],V=[R[0],R[1],R[2]+g.height],H=Lr([],g.normal,E,A);xr(H,H,b);const Q=Lr([],g.normal,E,-A);xr(Q,Q,b),ut(H,j,H),ut(Q,R,Q),j[2]+=.1,R[2]+=.1,l.emplaceBack(H[0],H[1],H[2]),l.emplaceBack(Q[0],Q[1],Q[2]),l.emplaceBack(j[0],j[1],j[2]),l.emplaceBack(R[0],R[1],R[2]),l.emplaceBack(B[0],B[1],B[2]),l.emplaceBack(V[0],V[1],V[2]),l.emplaceBack(j[0],j[1],j[2]),l.emplaceBack(R[0],R[1],R[2]),l.emplaceBack(H[0],H[1],H[2]),l.emplaceBack(Q[0],Q[1],Q[2]);const K=N/b/2;u.emplaceBack(-K-A,-1,K,.8),u.emplaceBack(K+A,-1,K,.8),u.emplaceBack(-K,0,K,1.3),u.emplaceBack(K,0,K,1.3),u.emplaceBack(K+A,-.8,K,.7),u.emplaceBack(K+A,-.8,K,.7),u.emplaceBack(0,0,K,1.3),u.emplaceBack(0,0,K,1.3),u.emplaceBack(K+A,-1.2,K,.8),u.emplaceBack(K+A,-1.2,K,.8),r.emplaceBack(6+m,4+m,8+m),r.emplaceBack(7+m,9+m,5+m),r.emplaceBack(0+m,1+m,2+m),r.emplaceBack(1+m,3+m,2+m),m+=10}}function V4(o,e){const r={};r.indexArray=new Os,r.vertexArray=new ml,r.colorArray=new vu,QA(o,e,r.indexArray,r.vertexArray,r.colorArray);const l={defined:!0};l.emissiveFactor=ii.black;const u={};return u.baseColorFactor=ii.white,l.pbrMetallicRoughness=u,r.material=l,r.aabb=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const JA=Tn([{name:"a_pos_3f",components:3,type:"Float32"}]),U4=Tn([{name:"a_normal_3",components:3,type:"Int16"}]),$4=Tn([{name:"a_centroid_3",components:3,type:"Int16"}]),eI=Tn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),q4=Tn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),G4=Tn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),W4=Tn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),H4=Tn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Z4=Tn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),tI=Pn.types,ab=32767;function X4(o,e){const r=qt+e;for(const l of o)for(const u of l)if(u.x<-e||u.x>r||u.y<-e||u.y>r)return!1;return!0}function K4(o){switch(o){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${o}`)}}class E1{constructor(){this.layoutVertexArray=new ml,this.layoutAttenuationArray=new vu,this.layoutColorArray=new Aa,this.indexArray=new Os,this.indexArrayForConflation=new Os,this.segmentsBucket=new Zi}}class C1{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Zi,this.entranceBloom=new E1;const r=66560;this.layoutVertexArray=new ml,this.layoutVertexArray.reserve(r),this.layoutNormalArray=new mc,this.layoutNormalArray.reserve(r),this.layoutCentroidArray=new mc,this.layoutCentroidArray.reserve(r),this.layoutColorArray=new Aa,this.layoutColorArray.reserve(r),this.layoutFloodLightDataArray=new Oc,this.layoutFloodLightDataArray.reserve(r),this.layoutAOArray=new Of,this.layoutAOArray.reserve(r),this.indexArray=new Os,this.indexArray.reserve(66560),this.indexArrayForConflation=new Os,this.segmentsBucket=new Zi,this.entranceBloom=new E1,e&&(this.layoutFacadePaintArray=new Aa,this.layoutFacadeDataArray=new xu,this.layoutFacadeVerticalRangeArray=new Aa)}reserve(e,r,l){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(r),l&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class rI{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Su,this.footprintsIndices=new Oc,this.footprintsMin=new Nt(1/0,1/0),this.footprintsMax=new Nt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new C1(!1),this.buildingWithFacade=new C1(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.groundEffect=new l1(e),this.groundEffect.groundRadiusArray=new Us,this.hasAppearances=null}updateFootprints(e,r){const l=new Wv([],[],1),u={vertices:[],indices:new Uint32Array(0),grid:l,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};r.push({footprint:u,id:e})}updateAppearances(e,r,l,u){}prepare(){return(function(){if(Jv!=null||kA!=null)return null;if(ay!=null)return ay;const e=fetch(Qi.BUILDING_GEN_URL);return ay=(function(r){let l,u,m,g,b;function E(){l=new Uint8Array(b.buffer),u=new Int16Array(b.buffer),m=new Int32Array(b.buffer),g=new Float32Array(b.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const N=()=>{},j={a:{a:A,f:function(R){const B=l.length,V=Math.max(R>>>0,Math.ceil(1.2*B)),H=Math.ceil((V-B)/65536);try{return b.grow(H),E(),!0}catch{return!1}},g:A,b:N,c:N,d:N,e:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,j):r.then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,j))).then(R=>{const B=R.instance.exports;return(0,B.g)(),b=B.f,E(),new v4({setStyle:B.h,setAOOptions:B.i,setMetricOptions:B.j,setStructuralOptions:B.k,setFacadeOptions:B.l,setFauxFacadeOptions:B.m,setFacadeClassifierOptions:B.n,addFeature:B.o,addFacade:B.p,generateMesh:B.q,getLastError:B.r,getOuterRingLength:B.s,getMeshCount:B.t,getPositionsPtr:B.u,getPositionsLength:B.v,getNormalsPtr:B.w,getNormalsLength:B.x,getAOPtr:B.y,getAOLength:B.z,getUVPtr:B.A,getUVLength:B.B,getFauxFacadePtr:B.C,getFauxFacadeLength:B.D,getIndicesPtr:B.E,getIndicesLength:B.F,getBuildingPart:B.G,getRingCount:B.H,getRingPtr:B.I,getRingLength:B.J,malloc:B.K,free:B.L,heapU8:l,heap16:u,heap32:m,heapF32:g})})})(e).then(r=>(ay=null,Jv=r,Jv)).catch(r=>{Rr("Could not load building-gen"),ay=null,kA=r}),ay})()}populate(e,r,l,u){const m=b4();if(!m)return;const g=Dt(l);this.tileToMeter=g,this.brightness=r.brightness,m.setStyle({normalScale:[1,-1,g],tileToMeters:g}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const b=new Map,E=new Map;let A=0;for(const{feature:K}of e){if(tI[K.type]!=="LineString"){b.set(K.id,K.properties.source_id);continue}const re=this.layers[0]._featureFilter.needGeometry;if(re&&!this.layers[0]._featureFilter.filter(new bi(this.zoom),K,l))continue;const ae=tn(K,re);if(!re&&!this.layers[0]._featureFilter.filter(new bi(this.zoom),ae,l))continue;const ue=re?ae.geometry:Gr(K,l,u),xe=[];for(const Ae of ue)for(const je of Ae)xe.push(je.x),xe.push(je.y);const ye={coordinates:xe,crossPerc:K.properties.cross_perc,distanceToRoad:K.properties.distance_to_road,entrances:K.properties.entrances,sourceId:0},Ie=K.properties.source_id;let Pe=E.get(Ie);Pe||(Pe=[],E.set(Ie,Pe)),Pe.push(ye),++A}this.maxHeight=0;const N=new Array,j=new Set,R=K=>{K!=null&&j.add(K)},B=(K,re)=>{K!=null&&N.push({buildingId:K,footprintIndex:re})},V=64*(e.length-A),H=V/2;this.buildingWithFacade.reserve(V,H,!0),this.buildingWithoutFacade.reserve(2*V,2*H,!1),this.footprintsIndices.reserve(16*(e.length-A)),this.footprintsVertices.reserve(8*(e.length-A));for(const{feature:K,id:re,index:ae,sourceLayerIndex:ue}of e){if(tI[K.type]==="LineString")continue;const xe=this.layers[0]._featureFilter.needGeometry;if(xe&&!this.layers[0]._featureFilter.filter(new bi(this.zoom),K,l))continue;let ye=null;if(K.properties&&K.properties.hasOwnProperty("building_id")&&(ye=Number(K.properties.building_id),j.has(ye)))continue;const Ie=tn(K,xe);if(!xe&&!this.layers[0]._featureFilter.filter(new bi(this.zoom),Ie,l))continue;const Pe=xe?Ie.geometry:Gr(K,l,u),Ae=R_(Pe,500);let je=!1;for(const Cn of Ae)if(Cn.length!==1){je=!0;break}if(je){R(ye);continue}if(!X4(Pe,163)){R(ye);continue}const Oe=this.layers[0],ht=K4(Oe.layout.get("building-roof-shape").evaluate(K,{},l)),at=Oe.layout.get("building-base").evaluate(K,{},l),lt=Oe.layout.get("building-height").evaluate(K,{},l),St=Oe.layout.get("building-flood-light-ground-radius").evaluate(K,{},l),bt=Oe.paint.get("building-ambient-occlusion-intensity"),wt=St/this.tileToMeter;K.properties["building-part"]="roof";const st=Oe.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),Et=Oe.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);K.properties["building-part"]="wall";const gt=Oe.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),kt=Oe.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);K.properties["building-part"]="window";const Tt=Oe.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),lr=Oe.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);K.properties["building-part"]="door";const dr=Oe.paint.get("building-color").evaluate(K,{},this.canonical).toPremultipliedRenderColor(this.lut),Wt=Oe.paint.get("building-emissive-strength").evaluate(K,{},this.canonical);let Yt=Oe.layout.get("building-flood-light-wall-radius").evaluate(K,{},l);Yt=Ee(Yt,0,2048);const Fr=Yt/2048*ab,wr=b.get(re),nr=E.get(wr)||[],en=nr.length!==0&&Oe.layout.get("building-facade").evaluate(K,{},l);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(en,!1,1);let kn=0,li=0,En=0,Ai=0,Kn=0,Es=0,Qn=0,Si=0,ts=0,as=0,ls=0;if(en){let Cn=Math.round(Oe.layout.get("building-facade-floors").evaluate(K,{},l));if(at===0){Cn=Math.max(1,Cn-(nr.length>0?1:0));let As=4;if(lt>100){const ro=[10,13,15];As=ro[K.id?K.id%ro.length:0]}else lt<=10&&(As=3);m.setFacadeOptions(As,!0),Kn=(lt<15?1.3:1.61803)*As/g}else Kn=at/g;Es=lt/g,Kn=Math.min(Kn,Es),En=Oe.layout.get("building-facade-unit-width").evaluate(K,{},l)/g,Ai=(Es-Kn)/Cn,m.setFauxFacadeOptions(!0,!0,En);const To=Oe.layout.get("building-facade-window").evaluate(K,{},l);kn=To[0],li=To[1],Qn=Math.floor(65535*Math.min(1,Kn/qt)),Si=Math.floor(65535*Math.min(1,Es/qt)),ts=Math.floor(255*kn)<<8|Math.floor(255*li),as=Math.floor(65535*Math.min(1,En/qt)),ls=Math.floor(65535*Math.min(1,Ai/qt))}const Cs=Array(Ae.length),Do={x:1/0,y:1/0},ga={x:-1/0,y:-1/0},qs={x:0,y:0};let to=0;for(let Cn=0;Cn<Ae.length;Cn++){const To=Ae[Cn];if(To.length>0){const As=[],ro=Array(To.length+1);ro[0]=0;for(let Vc=0;Vc<To.length;Vc++){const vl=To[Vc];for(let Wl=0;Wl<vl.length;Wl++){const Eo=vl[vl.length-Wl-1];Do.x=Math.min(Do.x,Eo.x),Do.y=Math.min(Do.y,Eo.y),ga.x=Math.max(ga.x,Eo.x),ga.y=Math.max(ga.y,Eo.y),qs.x+=Eo.x,qs.y+=Eo.y,to++,As.push(Eo.x),As.push(Eo.y)}ro[Vc+1]=As.length}Cs[Cn]={id:K.id?K.id:0,height:lt,minHeight:at,sourceId:0,roofType:ht,coordinates:As,ringIndices:ro}}}qs.x/=to||1,qs.y/=to||1;const ho=m.generateMesh(Cs,nr);if(typeof ho=="string"){Rr(`Unable to generate building ${K.id}: ${ho}`),R(ye);continue}if(ho.meshes.length===0||ho.modifiedPolygonRings.length===0){R(ye);continue}const bn=en?this.buildingWithFacade:this.buildingWithoutFacade;let cs=0;for(const Cn of ho.meshes)cs+=Cn.positions.length/3;const ms=bn.segmentsBucket.prepareSegment(cs,bn.layoutVertexArray,bn.indexArray),Gl=[];let qa=null,Oo=0,Ga=-1;const Ah=bn.layoutVertexArray.length,Pa=Ah+cs;bn.layoutVertexArray.resize(Pa),bn.layoutCentroidArray.resize(Pa),bn.layoutNormalArray.resize(Pa),bn.layoutAOArray.resize(Pa),bn.layoutColorArray.resize(Pa),bn.layoutFloodLightDataArray.resize(Pa),en&&(bn.layoutFacadePaintArray.resize(Pa),bn.layoutFacadeDataArray.resize(Pa),bn.layoutFacadeVerticalRangeArray.resize(Pa));const jb=bn.indexArray.length;let vy=0,tl=Ah;for(const Cn of ho.meshes){let To,As;if(Cn.buildingPart===1)To=st,As=Et;else if(Cn.buildingPart===0)To=gt,As=kt;else if(Cn.buildingPart===2)To=Tt,As=lr;else{if(Cn.buildingPart!==3)continue;To=dr,As=Wt}if(As=Ee(As,0,1),Cn.buildingPart===3){const Gs=new Array;for(let Na=0;Na<Cn.positions.length;Na+=12){const tm=Cn.positions[Na+0],Fo=Cn.positions[Na+1],bl=Cn.positions[Na+3],Iu=Cn.positions[Na+4],kh=Cn.positions[Na+2],dS=Cn.positions[Na+8]-kh,hS=1,gx=bl-tm,wy=Iu-Fo,gd=Math.hypot(gx,wy);Gs.push({pos:[tm+.5*gx,Fo+.5*wy,kh],normal:[wy/gd,-gx/gd,0],width:gd,height:dS,depth:hS,points:[tm,Fo,bl,Iu]})}const zo=bn.entranceBloom.segmentsBucket.prepareSegment(10*Gs.length,bn.entranceBloom.layoutVertexArray,bn.entranceBloom.indexArray),no=bn.entranceBloom.layoutVertexArray.length;Oo=bn.entranceBloom.indexArray.length,QA(Gs,.5/this.tileToMeter,bn.entranceBloom.indexArray,bn.entranceBloom.layoutVertexArray,bn.entranceBloom.layoutAttenuationArray);const ka=bn.entranceBloom.layoutVertexArray.length-no;Ga=bn.entranceBloom.indexArray.length-Oo;for(let Na=0;Na<ka;Na++)bn.entranceBloom.layoutColorArray.emplaceBack(255*dr.r<<8|255*dr.g,255*dr.b<<8|51*Wt);zo.vertexLength+=ka,zo.primitiveLength+=Ga,qa={part:Cn.buildingPart,vertexOffset:no,vertexLength:ka}}bn.layoutVertexArray.float32.set(Cn.positions,3*tl);const ro=Cn.positions.length/3;for(let Gs=0;Gs<ro;++Gs){const zo=3*Gs;vy=Math.max(vy,Cn.positions[zo+2]);const no=Cn.normals[zo+1]*ab,ka=Cn.normals[zo+2]*ab,Na=3*(tl+Gs);bn.layoutNormalArray.int16[Na]=Cn.normals[zo]*ab,bn.layoutNormalArray.int16[Na+1]=no,bn.layoutNormalArray.int16[Na+2]=ka;const tm=Cn.ao[Gs];bn.layoutAOArray.uint8[tl+Gs]=255*tm;const Fo=1+(tm-1)*bt,bl=255*To.b*Fo<<8|255*As;bn.layoutColorArray.uint16[2*(tl+Gs)]=255*To.r*Fo<<8|255*To.g*Fo,bn.layoutColorArray.uint16[2*(tl+Gs)+1]=bl}const Vc=Math.floor(qs.x),vl=Math.floor(qs.y),Wl=Math.floor(lt);for(let Gs=0;Gs<ro;++Gs){const zo=3*(tl+Gs);bn.layoutCentroidArray.int16[zo]=Vc,bn.layoutCentroidArray.int16[zo+1]=vl,bn.layoutCentroidArray.int16[zo+2]=Wl}if(bn.layoutFloodLightDataArray.uint16.fill(Cn.buildingPart===0?Fr:0,tl,tl+ro),en){const Gs=255*Tt.r<<8|255*Tt.g,zo=255*Tt.b<<8|255*lr;for(let no=0;no<ro;++no){const ka=2*(tl+no);bn.layoutFacadePaintArray.uint16[ka]=Gs,bn.layoutFacadePaintArray.uint16[ka+1]=zo}for(let no=0;no<ro;++no)if(Cn.isFauxFacade[no]){const ka=Math.min(65535,Math.floor(Cn.uv[2*no]*ho.outerRingLength));bn.layoutFacadeDataArray.emplace(tl+no,1|ka,ts,as,ls),bn.layoutFacadeVerticalRangeArray.emplace(tl+no,Qn,Si)}else bn.layoutFacadeDataArray.emplace(tl+no,0,0,0,0),bn.layoutFacadeVerticalRangeArray.emplace(tl+no,0,0)}const Eo=ms.vertexLength,mx=Cn.indices.length/3,Ph=bn.indexArray.length;bn.indexArray.resize(Ph+mx);for(let Gs=0;Gs<mx;++Gs){const zo=3*Gs,no=3*Ph+zo;bn.indexArray.uint16[no]=Eo+Cn.indices[zo],bn.indexArray.uint16[no+1]=Eo+Cn.indices[zo+1],bn.indexArray.uint16[no+2]=Eo+Cn.indices[zo+2]}Cn.buildingPart!==1&&Cn.buildingPart!==0&&Cn.buildingPart!==2&&Cn.buildingPart!==3||Gl.push({part:Cn.buildingPart,vertexOffset:tl,vertexLength:Cn.positions.length/3}),tl+=ro,ms.vertexLength+=ro,ms.primitiveLength+=Cn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,vy);const Rb=bn.indexArray.length-jb,Ih=this.footprintsIndices.length,Gf=this.footprintsVertices.length,em=[],Bc=new Nt(1/0,1/0),Au=new Nt(-1/0,-1/0),px=this.groundEffect.vertexArray.length;for(const Cn of ho.modifiedPolygonRings){const To=[],As=new Nt(1/0,1/0),ro=new Nt(-1/0,-1/0);for(let Vc=0;Vc<Cn.length;Vc+=2){const vl=Cn.length-Vc-2;As.x=Math.min(As.x,Cn[vl]),As.y=Math.min(As.y,Cn[vl+1]),ro.x=Math.max(ro.x,Cn[vl]),ro.y=Math.max(ro.y,Cn[vl+1]);const Wl=new Nt(Cn[vl],Cn[vl+1]);To.push(Wl),em.push(Wl.x,Wl.y),this.footprintsVertices.emplaceBack(Wl.x,Wl.y)}Bc.x=Math.min(Bc.x,As.x),Bc.y=Math.min(Bc.y,As.y),Au.x=Math.max(Au.x,ro.x),Au.y=Math.max(Au.y,ro.y),this.groundEffect.addData(To,[As,ro],wt)}const by=this.groundEffect.vertexArray.length-px;this.groundEffect.groundRadiusArray.reserveForAdditional(by);for(let Cn=0;Cn<by;Cn++)this.groundEffect.groundRadiusArray.emplaceBack(St);(Do.x<0||ga.x>qt||Do.y<0||ga.y>qt)&&this.featuresOnBorder.push({featureId:K.id,footprintIndex:this.footprints.length});{const Cn=ey(em,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Cn.length),this.footprintsIndices.uint16.set(Cn,Ih),this.buildingIds.add(ye??K.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Bc.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Bc.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Au.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Au.y);const To={footprintVertexOffset:Gf,footprintVertexLength:this.footprintsVertices.length-Gf,footprintIndexOffset:Ih,footprintIndexLength:this.footprintsIndices.length-Ih,min:Bc,max:Au,hiddenFlags:0,indicesOffset:jb,indicesLength:Rb,bloomIndicesOffset:Oo,bloomIndicesLength:Ga,groundEffectVertexOffset:px,groundEffectVertexLength:by,hasFauxFacade:en,height:vy,promoteId:re,feature:Ie,parts:Gl,buildingBloom:qa},As=this.footprints.length;K.id!==void 0&&this.featureFootprintLookup.set(K.id,As),B(ye,As),this.footprints.push(To)}this.programConfigurations.populatePaintArrays(bn.layoutVertexArray.length,K,ae,{},r.availableImages,l,r.brightness),this.groundEffect.addPaintPropertiesData(K,ae,{},r.availableImages,l,r.brightness),r.featureIndex.insert(K,Pe,ae,ue,this.index,Ah)}N.forEach(({buildingId:K,footprintIndex:re})=>{j.has(K)&&(this.footprints[re].hiddenFlags|=4)});const Q=new Set;this.buildingIds.forEach((K,re,ae)=>{j.has(K)||Q.add(K)}),this.buildingIds=Q,this.groundEffect.prepareBorderSegments()}update(e,r,l,u,m,g,b){this.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b),this.groundEffect.update(e,r,m,l,u,g,b),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const r=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,JA.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,U4.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,$4.members),l.layoutFloodLightDataBuffer=e.createVertexBuffer(l.layoutFloodLightDataArray,Z4.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,G4.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,W4.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,JA.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,H4.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=r=>{r.layoutVertexBuffer&&(r.layoutVertexBuffer.destroy(),r.layoutNormalBuffer.destroy(),r.layoutColorBuffer.destroy(),r.segmentsBucket.destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.entranceBloom.layoutVertexBuffer&&(r.entranceBloom.layoutVertexBuffer.destroy(),r.entranceBloom.layoutColorBuffer.destroy(),r.entranceBloom.layoutAttenuationBuffer.destroy(),r.entranceBloom.indexBuffer.destroy(),r.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,r,l=!0){let u=!1;const m=l?r:0,g=0|(l?-1:~r);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of e){const E=this.footprints[b],A=E.hiddenFlags&g|m;E.hiddenFlags!==A&&(E.hiddenFlags=A,u=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const r=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};r(this.buildingWithoutFacade),r(this.buildingWithFacade);for(const u of this.footprints){const m=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let E=u.indicesOffset;E<g;E++)m.indexArrayForConflation.uint16[3*E+0]=0,m.indexArrayForConflation.uint16[3*E+1]=0,m.indexArrayForConflation.uint16[3*E+2]=0;const b=u.bloomIndicesOffset+u.bloomIndicesLength;for(let E=u.bloomIndicesOffset;E<b;E++)m.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const l=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const r=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,eI.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,q4.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,eI.members,!0)};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,r){const l=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.footprints){if(4&u.hiddenFlags)continue;const m=r[u.promoteId],g=u.feature;g.properties["building-part"]="roof";const b=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),E=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),N=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";const j=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),R=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";const B=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),H=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const K of u.parts){let re,ae=b;K.part===1?(ae=b,re=E):K.part===0?(ae=A,re=N):K.part===2?(ae=j,re=R):K.part===3&&(ae=B,re=V),re=Ee(re,0,1);for(let ue=0;ue<K.vertexLength;ue++){const xe=K.vertexOffset+ue,ye=1+(H.layoutAOArray.uint8[xe]/255-1)*l;H.layoutColorArray.emplace(xe,ae.r*ye*255<<8|ae.g*ye*255,ae.b*ye*255<<8|255*re),u.hasFauxFacade&&H.layoutFacadePaintArray.emplace(xe,255*j.r<<8|255*j.g,255*j.b<<8|255*R)}}const Q=u.buildingBloom;if(Q)for(let K=0;K<Q.vertexLength;K++)H.entranceBloom.layoutColorArray.emplace(Q.vertexOffset+K,255*B.r<<8|255*B.g,255*B.b<<8|51*V)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(Zv(this.activeReplacements,u))return;this.activeReplacements=u;for(const g of this.footprints)g.hiddenFlags&=-2;const m=[];for(const g of this.activeReplacements){if(g.order<l)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const E of this.footprints)E.min.x>g.max.x||E.max.x<g.min.x||E.min.y>g.max.y||E.max.y<g.min.y||(m.length=0,Q4(this.footprintsVertices,E.footprintVertexOffset,E.footprintVertexLength,g.footprintTileId.canonical,e.canonical,m),s1(g.footprint,m,this.footprintsIndices.uint16,E.footprintIndexOffset,E.footprintIndexLength,0,-b)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const r=this.featureFootprintLookup.get(e.id);return this.footprints[r]}return null}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,u=!0;const m=4*(e+qt)*qt+(r+qt);if(this.footprintLookup.hasOwnProperty(m)){const b=this.footprintLookup[m];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const g=new Nt(e,r);for(const b of this.footprints)e>b.max.x||b.min.x>e||r>b.max.y||b.min.y>r||b.height<=l||Y4(g,this.footprintsVertices.float32.subarray(2*b.footprintVertexOffset,2*(b.footprintVertexOffset+b.footprintVertexLength)),this.footprintsIndices.uint16.subarray(b.footprintIndexOffset,b.footprintIndexOffset+b.footprintIndexLength))&&(l=b.height,this.footprintLookup[m]=b,u=b.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.footprintLookup[m]=void 0}}function Y4(o,e,r){for(let l=0;l<r.length;l+=3){const u=r[l],m=r[l+1],g=r[l+2],b=e[2*u+0],E=e[2*u+1],A=e[2*m+0],N=e[2*m+1],j=e[2*g+0],R=e[2*g+1],B=(b-j)*(o.y-R)-(E-R)*(o.x-j),V=(A-b)*(o.y-E)-(N-E)*(o.x-b);if(B<0!=V<0&&B!==0&&V!==0)continue;const H=(j-A)*(o.y-N)-(R-N)*(o.x-A);if(H===0||H<0==B+V<=0)return!0}return!1}function Q4(o,e,r,l,u,m){const g=Math.pow(2,l.z-u.z);for(let b=0;b<r;b++){let E=o.float32[2*(b+e)+0],A=o.float32[2*(b+e)+1];E=(E+u.x*qt)*g-l.x*qt,A=(A+u.y*qt)*g-l.y*qt,m.push(new Nt(E,A))}}let nI,iI;hr(rI,"BuildingBucket",{omit:["layers"]}),hr(C1,"BuildingGeometry"),hr(E1,"BuildingBloomGeometry");const J4=Tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),e5=Tn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:t5}=J4,r5=Tn([{name:"a_packed",components:3,type:"Float32"}]),{members:n5}=r5,i5=Tn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:s5}=i5;class sI{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Hp({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const l=this.getKey(e,r);return this.positions[l]}trim(){const e=this.width,r=this.height=Xe(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,l){const u=[];let m=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,b=!0;u.push({left:m,right:g,isDash:b,zeroLength:e[0]===0});let E=e[0];for(let A=1;A<e.length;A++){b=!b;const N=e[A];m=E*l,E+=N,g=E*l,u.push({left:m,right:g,isDash:b,zeroLength:N===0})}return u}addRoundDash(e,r,l){const u=r/2;for(let m=-l;m<=l;m++){const g=this.width*(this.nextRow+l+m);let b=0,E=e[b];for(let A=0;A<this.width;A++){A/E.right>1&&(E=e[++b]);const N=Math.abs(A-E.left),j=Math.abs(A-E.right),R=Math.min(N,j);let B;const V=m/l*(u+1);if(E.isDash){const H=u-Math.abs(V);B=Math.sqrt(R*R+H*H)}else B=u-Math.sqrt(R*R+V*V);this.image.data[g+A]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,r){for(let E=e.length-1;E>=0;--E){const A=e[E],N=e[E+1];A.zeroLength?e.splice(E,1):N&&N.isDash===A.isDash&&(N.left=A.left,e.splice(E,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const m=this.width*this.nextRow;let g=0,b=e[g];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++g]);const A=Math.abs(E-b.left),N=Math.abs(E-b.right),j=Math.min(A,N);this.image.data[m+E]=Math.max(0,Math.min(255,(b.isDash?j:-j)+r+128))}}addDash(e,r){const l=this.getKey(e,r);if(this.positions[l])return this.positions[l];const u=r==="round",m=u?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Rr("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let N=0;N<e.length;N++)e[N]<0&&(Rr("Negative value is found in line dasharray, replacing values with 0"),e[N]=0),b+=e[N];if(b!==0){const N=this.width/b,j=this.getDashRanges(e,this.width,N);u?this.addRoundDash(j,N,m):this.addRegularDash(j,r==="square"?.5*N:0)}const E=this.nextRow+m;this.nextRow+=g;const A={tl:[E,m],br:[b,0]};return this.positions[l]=A,A}}hr(sI,"LineAtlas");const o5=Pn.types,a5=Math.cos(Math.PI/180*37.5),l5=Math.cos(Math.PI/180*5);class A1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new gh,this.layoutVertexArray2=new ml,this.patternVertexArray=new ml,this.indexArray=new Os,this.programConfigurations=new O(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Zi,this.maxLineLength=0,this.zOffsetVertexArray=new ml,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,u){}populate(e,r,l,u){this.hasPattern=Ww("line",this.layers,this.pixelRatio,r);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Dt(l);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),B=R.isConstant()&&!R.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&g==="none"&&Rr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const E=[];for(const{feature:R,id:B,index:V,sourceLayerIndex:H}of e){const Q=this.layers[0]._featureFilter.needGeometry,K=tn(R,Q);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),K,l))continue;const re=m?m.evaluate(K,{},l):void 0,ae={id:B,properties:R.properties,type:R.type,sourceLayerIndex:H,index:V,geometry:Q?K.geometry:Gr(R,l,u),patterns:{},sortKey:re};E.push(ae)}m&&E.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:A,featureIndex:N}=r,j=this.addConstantDashes(A);for(const R of E){const{geometry:B,index:V,sourceLayerIndex:H}=R;if(j&&this.addFeatureDashes(R,A),this.hasPattern){const Q=Hw("line",this.layers,R,this.zoom,this.pixelRatio,r);this.patternFeatures.push(Q)}else this.addFeature(R,B,V,l,A.positions,r.availableImages,r.brightness,r.elevationFeatures);N.insert(e[V].feature,B,V,H,this.index)}}addConstantDashes(e){let r=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(u.kind!=="constant"||m.kind!=="constant")r=!0;else{const g=m.value,b=u.value;if(!b)continue;e.addDash(b,g)}}return r}addFeatureDashes(e,r){const l=this.zoom;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let b,E;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:l},e);E=g.kind==="constant"?g.value:g.evaluate({zoom:l},e),r.addDash(b,E),e.patterns[u.id]=[r.getKey(b,E)]}}update(e,r,l,u,m,g,b,E){this.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b,E)}addFeatures(e,r,l,u,m,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,r,l,u,g,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,n5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,s5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,e5.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,t5),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,r){let l,u;if(r&&r>0?(l=`mapbox_clip_start_${r}`,u=`mapbox_clip_end_${r}`):(l="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(u))return{start:+e.properties[l],end:+e.properties[u]}}addFeature(e,r,l,u,m,g,b,E){const A=this.layers[0].layout,N=A.get("line-join").evaluate(e,{}),j=A.get("line-cap").evaluate(e,{}),R=A.get("line-miter-limit"),B=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const V=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const H=this.layers[0].paint.get("line-width").value;if(H.kind!=="constant"&&H.isLineProgressConstant===!1&&(this.variableWidthValue=H),this.elevationType==="road"){const Q=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,r,u,E,N,j,R,B)){const[K,re]=this.clipRuntimeLinesToTile(r,1);for(let ae=0;ae<K.length;ae++){const ue=K[ae],xe=re[ae],ye={progress:{min:xe.progress.min,max:xe.progress.max},nextDir:this.computeSegNextDir(xe,ue),prevDir:this.computeSegPrevDir(xe,ue)};this.addLine(ue,e,u,N,j,R,B,ye,V&&xe.parentIndex>0?xe.parentIndex:null)}this.fillNonElevatedRoadSegment(Q)}}else for(let Q=0;Q<r.length;Q++)this.addLine(r[Q],e,u,N,j,R,B,void 0,V&&Q>0?Q:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,g,u,b,void 0,this.worldview)}computeSegNextDir(e,r){return e.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(e,r){return r[1].sub(e.prevPoint).unit()}clipLinesToTile(e,r){return Yv(e,-r,-r,qt+r,qt+r)}clipRuntimeLinesToTile(e,r){const l=[];return[Yv(e,-r,-r,qt+r,qt+r,l),l]}addElevatedRoadFeature(e,r,l,u,m,g,b,E){const A=[],N=pa.getElevationFeature(e,u);if(N){const j=this.clipLinesToTile(r,1),R=this.prepareElevatedLines(j,N,l);for(const B of R)A.push({geometry:B,elevation:N,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const j of A){const R=this.layoutVertexArray.length;this.addLine(j.geometry,e,l,m,g,b,E);const B=new Ia(l,j.elevationTileID);if(j.elevation)for(let V=R;V<this.layoutVertexArray.length;V++){const H=new Nt(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),Q=B.pointElevation(H,j.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(e,r,l){if(r.constantHeight!=null)return e;const u=[],m=1/Dt(l);for(const g of e)g4(g,new $a(r,m),0,u);return u}fillNonElevatedRoadSegment(e){for(let r=e;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,r,l,u,m,g,b,E,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(r,A):this.lineClips;const N=u==="none";this.patternJoinNone=this.hasPattern&&N,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const j=E&&E.progress.min>0,R=E&&E.progress.max<1;if(this.lineClips){let Ae={min:this.lineClips.start,max:this.lineClips.end},je=1;if(E){const at=this.lineClips.end-this.lineClips.start;Ae=(function(lt,St,bt){return{min:bs(lt.min,St,bt),max:bs(lt.max,St,bt)}})(E.progress,{min:0,max:1},Ae),at>0&&(je=(Ae.max-Ae.min)/at)}const Oe=+r.properties.mapbox_clip_feature_len,ht=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Oe)||Number.isNaN(ht)){for(let lt=0;lt<e.length-1;lt++)this.totalDistance+=e[lt].dist(e[lt+1]);const at=this.totalDistance/(Ae.max-Ae.min);this.totalFeatureLength=Number.isFinite(at)?at:0,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Oe,this.distance=ht*je,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const B=o5[r.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let H=0;for(;H<V-1&&e[H].equals(e[H+1]);)H++;if(V<(B?3:2))return;u==="bevel"&&(g=1.05);const Q=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let K,re,ae,ue,xe,ye,Ie,Pe;E&&E.prevDir&&(ye=E.prevDir.perp()),E&&E.nextDir&&(Ie=E.nextDir.perp()),this.e1=this.e2=-1,B&&(K=e[V-2],xe=e[H].sub(K)._unit()._perp());for(let Ae=H;Ae<V;Ae++){if(ae=Ae===V-1?B?e[H+1]:void 0:e[Ae+1],ae&&e[Ae].equals(ae))continue;xe&&(ue=xe),K&&(re=K),K=e[Ae],Pe=this.evaluateLineProgressFeatures(re?re.dist(K):0),xe=ae?ae.sub(K)._unit()._perp():ue,ue=ue||xe;const je=re&&ae;let Oe=je?u:B||N?"butt":m;const ht=ue.x*xe.x+ue.y*xe.y;if(N){const gt=function(kt){if(kt.patternJoinNone){const Tt=kt.segmentPoints.length/2,lr=kt.lineSoFar-kt.segmentStart;for(let dr=0;dr<Tt;++dr){const Wt=kt.segmentPoints[2*dr+1],Yt=Math.round(kt.segmentPoints[2*dr])+.5+.25*Wt;kt.patternVertexArray.emplaceBack(Yt,lr,kt.segmentStart),kt.patternVertexArray.emplaceBack(Yt,lr,kt.segmentStart)}kt.segmentPoints.length=0}kt.e1=kt.e2=-1};if(je&&ht<l5){this.updateDistance(re,K),this.addCurrentVertex(K,ue,1,1,Q,Pe),gt(this),this.addCurrentVertex(K,xe,-1,-1,Q,Pe);continue}if(re){if(!ae){this.updateDistance(re,K),this.addCurrentVertex(K,ue,1,1,Q,Pe),gt(this);continue}Oe="miter"}}let at=ue.add(xe);at.x===0&&at.y===0||at._unit();const lt=at.x*xe.x+at.y*xe.y,St=lt!==0?1/lt:1/0,bt=2*Math.sqrt(2-2*lt),wt=lt<a5&&re&&ae,st=ue.x*xe.y-ue.y*xe.x>0,Et=this.overscaling<=16?122880/(512*this.overscaling):0;if(je&&Oe==="round"){if(St<b)Oe="miter";else if(St<=2){const gt=I1(K,-10,8202);Oe=this.elevationType==="offset"&&(gt||this.hasCrossSlope)?"miter":"fakeround"}}if(Oe==="miter"&&St>g&&(Oe="bevel"),Oe==="bevel"&&(St>2&&(Oe="flipbevel"),St<g&&(Oe="miter")),re&&!(Oe==="miter"&&wt)&&this.updateDistance(re,K),Oe==="miter")if(wt){const gt=K.dist(re);if(gt>2*Et){const Tt=K.sub(K.sub(re)._mult(Et/gt)._round());this.updateDistance(re,Tt),this.addCurrentVertex(Tt,ue,0,0,Q,Pe),re=Tt}this.updateDistance(re,K),at._mult(St),this.addCurrentVertex(K,at,0,0,Q,Pe);const kt=K.dist(ae);if(kt>2*Et){const Tt=K.add(ae.sub(K)._mult(Et/kt)._round());this.updateDistance(K,Tt),this.addCurrentVertex(Tt,xe,0,0,Q,Pe),K=Tt}}else at._mult(St),this.addCurrentVertex(K,at,0,0,Q,Pe);else if(Oe==="flipbevel"){if(St>100)at=xe.mult(-1);else{const gt=St*ue.add(xe).mag()/ue.sub(xe).mag();at._perp()._mult(gt*(st?-1:1))}this.addCurrentVertex(K,at,0,0,Q,Pe),this.addCurrentVertex(K,at.mult(-1),0,0,Q,Pe)}else if(Oe==="bevel"||Oe==="fakeround"){Pe!=null&&re&&this.addCurrentVertex(K,Ie||ue,-1,-1,Q,Pe);const gt=K.dist(re)<=2*Et&&Oe!=="bevel",kt=at.mult(st?1:-1);kt._mult(St);const Tt=xe.mult(st?-1:1),lr=ue.mult(st?-1:1),dr=this.evaluateLineProgressFeatures(this.distance);if(Pe==null&&(this.addHalfVertex(K,kt.x,kt.y,!1,!st,0,Q,dr),gt||this.addHalfVertex(K,kt.x+2*lr.x,kt.y+2*lr.y,!1,st,0,Q,dr)),Oe==="fakeround"){const Wt=Math.round(180*bt/Math.PI/20);this.addHalfVertex(K,lr.x,lr.y,!1,st,0,Q,dr);for(let Yt=0;Yt<Wt;Yt++){let Fr=Yt/Wt;if(Fr!==.5){const nr=Fr-.5;Fr+=Fr*nr*(Fr-1)*((1.0904+ht*(ht*(3.55645-1.43519*ht)-3.2452))*nr*nr+(.848013+ht*(.215638*ht-1.06021)))}const wr=Tt.sub(lr)._mult(Fr)._add(lr)._unit();this.addHalfVertex(K,wr.x,wr.y,!1,st,0,Q,dr)}this.addHalfVertex(K,Tt.x,Tt.y,!1,st,0,Q,dr)}gt||Pe!=null||this.addHalfVertex(K,kt.x+2*Tt.x,kt.y+2*Tt.y,!1,st,0,Q,dr),Pe!=null&&ae&&this.addCurrentVertex(K,ye||xe,1,1,Q,Pe)}else if(Oe==="butt")this.addCurrentVertex(K,at,0,0,Q,Pe);else if(Oe==="square"){if(!re){const gt=j?0:-1;this.addCurrentVertex(K,at,gt,gt,Q,Pe)}if(this.addCurrentVertex(K,at,0,0,Q,Pe),re){const gt=R?0:1;this.addCurrentVertex(K,at,gt,gt,Q,Pe)}}else if(Oe==="round"){if(re){const gt=!je&&Ie?Ie:ue;this.addCurrentVertex(K,gt,0,0,Q,Pe),!je&&R||this.addCurrentVertex(K,gt,1,1,Q,Pe,!0)}if(ae){const gt=!je&&ye?ye:xe;!je&&j||this.addCurrentVertex(K,gt,-1,-1,Q,Pe,!0),this.addCurrentVertex(K,gt,0,0,Q,Pe)}}}}addVerticesTo(e,r,l,u,m,g,b,E,A,N){const j=(r.w-e.w)/this.tessellationStep|0;let R=0;const B=this.scaledDistance;if(j>1){this.lineSoFar=e.w;const H=(r.x-e.x)/j,Q=(r.y-e.y)/j,K=(r.z-e.z)/j,re=(r.w-e.w)/j;for(let ae=1;ae<j;++ae){e.x+=H,e.y+=Q,e.z+=K,this.lineSoFar+=re,R+=re;const ue=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(e,l,u,N,!1,b,A,ue),this.addHalfVertex(e,m,g,N,!0,-E,A,ue)}}this.lineSoFar=r.w,this.scaledDistance=B;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,l,u,N,!1,b,A,V),this.addHalfVertex(r,m,g,N,!0,-E,A,V)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Rr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(e,r,l,u,m,g,b=!1){const E=r.x+r.y*l,A=r.y-r.x*l,N=r.y*u-r.x,j=-r.y-r.x*u;if(g!=null){const R=this.elevationType==="offset",B=-10,V=8202,H=g.zOffset,Q=new bA(e.x,e.y,H,this.lineSoFar),K=!!R&&I1(e,B,V),re=this.lineSoFar,ae=this.distance;if(this.currentVertex)if(K){const ue=this.currentVertexIsOutside,xe=this.currentVertex,ye=new bA(e.x,e.y,H,this.lineSoFar);if(SA(xe,ye,B,V),!I1(ye,B,V)){if(ue){this.e1=this.e2=-1,this.distance-=xe.dist(Q),this.lineSoFar=xe.w;const Ie=this.evaluateLineProgressFeatures(xe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(xe,E,A,b,!1,l,m,Ie),this.addHalfVertex(xe,N,j,b,!0,-u,m,Ie),this.prevDistance=this.distance}this.distance=this.prevDistance+xe.dist(ye),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(xe,ye,E,A,N,j,l,u,m,b),this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}}else{const ue=this.currentVertex;if(this.currentVertexIsOutside){SA(ue,Q,B,V),this.e1=this.e2=-1,this.distance-=ue.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ue.w;const xe=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,E,A,b,!1,l,m,xe),this.addHalfVertex(ue,N,j,b,!0,-u,m,xe),this.prevDistance=this.distance,this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ue,Q,E,A,N,j,l,u,m,b)}else K||(this.addHalfVertex(e,E,A,b,!1,l,m,g),this.addHalfVertex(e,N,j,b,!0,-u,m,g));this.currentVertex=Q,this.currentVertexIsOutside=K,this.lineSoFar=re}else this.addHalfVertex(e,E,A,b,!1,l,m,g),this.addHalfVertex(e,N,j,b,!0,-u,m,g)}addHalfVertex({x:e,y:r},l,u,m,g,b,E,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const j=$r(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,j)}const N=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),E.primitiveLength++),g?this.e2=N:this.e1=N,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function I1(o,e,r){return o.x<e||o.x>r||o.y<e||o.y>r}let oI,aI;function lI(o,e,r){return e*(qt/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}hr(A1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const cI=(o,e,r)=>(1-r)*o+r*e;function uI(o,e){return 1/lI(o,1,e.tileZoom)}function dI(o,e,r,l){return o.translatePosMatrix(l||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const hI=o=>{const e=[];fI(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=o.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function fI(o){const e=o.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let P1;const pI=()=>P1||(P1={layout:oI||(oI=new is({"line-cap":new er(He.layout_line["line-cap"]),"line-join":new er(He.layout_line["line-join"]),"line-miter-limit":new zt(He.layout_line["line-miter-limit"]),"line-round-limit":new zt(He.layout_line["line-round-limit"]),"line-sort-key":new er(He.layout_line["line-sort-key"]),"line-z-offset":new er(He.layout_line["line-z-offset"]),"line-elevation-reference":new zt(He.layout_line["line-elevation-reference"]),"line-cross-slope":new zt(He.layout_line["line-cross-slope"]),visibility:new zt(He.layout_line.visibility),"line-width-unit":new zt(He.layout_line["line-width-unit"])})),paint:aI||(aI=new is({"line-opacity":new er(He.paint_line["line-opacity"]),"line-color":new er(He.paint_line["line-color"]),"line-translate":new zt(He.paint_line["line-translate"]),"line-translate-anchor":new zt(He.paint_line["line-translate-anchor"]),"line-width":new er(He.paint_line["line-width"]),"line-gap-width":new er(He.paint_line["line-gap-width"]),"line-offset":new er(He.paint_line["line-offset"]),"line-blur":new er(He.paint_line["line-blur"]),"line-dasharray":new er(He.paint_line["line-dasharray"]),"line-pattern":new er(He.paint_line["line-pattern"]),"line-pattern-cross-fade":new zt(He.paint_line["line-pattern-cross-fade"]),"line-gradient":new ad(He.paint_line["line-gradient"]),"line-trim-offset":new zt(He.paint_line["line-trim-offset"]),"line-trim-fade-range":new zt(He.paint_line["line-trim-fade-range"]),"line-trim-color":new zt(He.paint_line["line-trim-color"]),"line-emissive-strength":new er(He.paint_line["line-emissive-strength"]),"line-border-width":new er(He.paint_line["line-border-width"]),"line-border-color":new er(He.paint_line["line-border-color"]),"line-occlusion-opacity":new zt(He.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},P1);class c5 extends er{possiblyEvaluate(e,r){return r=new bi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,u){return r=Object.assign({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,u)}}let H_;function mI(o,e){return e>0?e+2*o:o}const u5=Tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),d5=Tn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),h5=Tn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const f5=Tn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),p5=Tn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),m5=Tn([{name:"a_texb",components:2,type:"Uint16"}]),g5=Tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),y5=Tn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gI=Tn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_5=Tn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Tn([{name:"triangle",components:3,type:"Uint16"}]),Tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Tn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Tn([{type:"Float32",name:"offsetX"}]),Tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var So=24;function x5(o,e,r){return o.sections.forEach(l=>{l.text=(function(u,m,g){const b=m.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?u=u.toLocaleUpperCase():b==="lowercase"&&(u=u.toLocaleLowerCase()),fl.applyArabicShaping&&(u=fl.applyArabicShaping(u)),u})(l.text,e,r)}),o}const Z_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function v5(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function b5(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const k1=4294967296,yI=1/k1,_I=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let lb=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,r=this.length){for(;this.pos<r;){const l=this.readVarint(),u=l>>3,m=this.pos;this.type=7&l,o(u,e,this),this.pos===m&&this.skip(l)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*k1;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*k1;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let r,l;return l=e[this.pos++],r=127&l,l<128?r:(l=e[this.pos++],r|=(127&l)<<7,l<128?r:(l=e[this.pos++],r|=(127&l)<<14,l<128?r:(l=e[this.pos++],r|=(127&l)<<21,l<128?r:(l=e[this.pos],r|=(15&l)<<28,(function(u,m,g){const b=g.buf;let E,A;if(A=b[g.pos++],E=(112&A)>>4,A<128||(A=b[g.pos++],E|=(127&A)<<3,A<128)||(A=b[g.pos++],E|=(127&A)<<10,A<128)||(A=b[g.pos++],E|=(127&A)<<17,A<128)||(A=b[g.pos++],E|=(127&A)<<24,A<128)||(A=b[g.pos++],E|=(1&A)<<31,A<128))return cy(u,E,m);throw new Error("Expected varint not more than 10 bytes")})(r,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&_I?_I.decode(this.buf.subarray(e,o)):(function(r,l,u){let m="",g=l;for(;g<u;){const b=r[g];let E,A,N,j=null,R=b>239?4:b>223?3:b>191?2:1;if(g+R>u)break;R===1?b<128&&(j=b):R===2?(E=r[g+1],(192&E)==128&&(j=(31&b)<<6|63&E,j<=127&&(j=null))):R===3?(E=r[g+1],A=r[g+2],(192&E)==128&&(192&A)==128&&(j=(15&b)<<12|(63&E)<<6|63&A,(j<=2047||j>=55296&&j<=57343)&&(j=null))):R===4&&(E=r[g+1],A=r[g+2],N=r[g+3],(192&E)==128&&(192&A)==128&&(192&N)==128&&(j=(15&b)<<18|(63&E)<<12|(63&A)<<6|63&N,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,R=1):j>65535&&(j-=65536,m+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),m+=String.fromCharCode(j),g+=R}return m})(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const r=this.readPackedEnd();for(;this.pos<r;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*yI),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*yI),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(e,r){let l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(l=~(-e%4294967296),u=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(m,g,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)})(l,0,r),(function(m,g){const b=(7&m)<<4;g.buf[g.pos++]|=b|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(u,r)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=(function(l,u,m){for(let g,b,E=0;E<u.length;E++){if(g=u.charCodeAt(E),g>55295&&g<57344){if(!b){g>56319||E+1===u.length?(l[m++]=239,l[m++]=191,l[m++]=189):b=g;continue}if(g<56320){l[m++]=239,l[m++]=191,l[m++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(l[m++]=239,l[m++]=191,l[m++]=189,b=null);g<128?l[m++]=g:(g<2048?l[m++]=g>>6|192:(g<65536?l[m++]=g>>12|224:(l[m++]=g>>18|240,l[m++]=g>>12&63|128),l[m++]=g>>6&63|128),l[m++]=63&g|128)}return m})(this.buf,o,this.pos);const r=this.pos-e;r>=128&&xI(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let r=0;r<e;r++)this.buf[this.pos++]=o[r]}writeRawMessage(o,e){this.pos++;const r=this.pos;o(e,this);const l=this.pos-r;l>=128&&xI(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l}writeMessage(o,e,r){this.writeTag(o,2),this.writeRawMessage(e,r)}writePackedVarint(o,e){e.length&&this.writeMessage(o,w5,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,S5,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,C5,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,T5,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,E5,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,A5,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,I5,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,P5,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,k5,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function cy(o,e,r){return r?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function xI(o,e,r){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(let u=r.pos-1;u>=o;u--)r.buf[u+l]=r.buf[u]}function w5(o,e){for(let r=0;r<o.length;r++)e.writeVarint(o[r])}function S5(o,e){for(let r=0;r<o.length;r++)e.writeSVarint(o[r])}function T5(o,e){for(let r=0;r<o.length;r++)e.writeFloat(o[r])}function E5(o,e){for(let r=0;r<o.length;r++)e.writeDouble(o[r])}function C5(o,e){for(let r=0;r<o.length;r++)e.writeBoolean(o[r])}function A5(o,e){for(let r=0;r<o.length;r++)e.writeFixed32(o[r])}function I5(o,e){for(let r=0;r<o.length;r++)e.writeSFixed32(o[r])}function P5(o,e){for(let r=0;r<o.length;r++)e.writeFixed64(o[r])}function k5(o,e){for(let r=0;r<o.length;r++)e.writeSFixed64(o[r])}function N5(o,e,r){e.glyphs=[],o===1&&r.readMessage(j5,e)}function j5(o,e,r){if(o===3){const{id:l,bitmap:u,width:m,height:g,left:b,top:E,advance:A}=r.readMessage(R5,{});e.glyphs.push({id:l,bitmap:new Hp({width:m+6,height:g+6},u),metrics:{width:m,height:g,left:b,top:E,advance:A}})}else o===4?e.ascender=r.readSVarint():o===5&&(e.descender=r.readSVarint())}function R5(o,e,r){o===1?e.id=r.readVarint():o===2?e.bitmap=r.readBytes():o===3?e.width=r.readVarint():o===4?e.height=r.readVarint():o===5?e.left=r.readSVarint():o===6?e.top=r.readSVarint():o===7&&(e.advance=r.readVarint())}const ql={horizontal:1,vertical:2,horizontalOnly:3};class X_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const l=new X_;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new X_;return r.image=e,r}}class uy{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,l){const u=new uy;for(let m=0;m<e.sections.length;m++){const g=e.sections[m];g.image?u.addImageSection(g,l):u.addTextSection(g,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(r,l){let u="";for(let m=0;m<r.length;m++){const g=r.charCodeAt(m+1)||null,b=r.charCodeAt(m-1)||null;u+=!l&&(g&&Rp(g)&&!Z_[r[m+1]]||b&&Rp(b)&&!Z_[r[m-1]])||!Z_[r[m]]?r[m]:Z_[r[m]]}return u})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&cb[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&cb[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new uy;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(X_.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,r){const l=e.image?e.image.getPrimary():null;if(!l)return void Rr("Can't add FormattedSection with an empty image.");l.scaleSelf(r);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(X_.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function N1(o,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H=1){const Q=uy.fromFeature(o,u,H);j===ql.vertical&&Q.verticalizePunctuation(R);let K=[];const re=(function(Ie,Pe,Ae,je,Oe,ht){if(!Ie)return[];const at=[],lt=(function(wt,st,Et,gt,kt,Tt){let lr=0;for(let dr=0;dr<wt.length();dr++){const Wt=wt.getSection(dr);lr+=vI(wt.getCodePoint(dr),Wt,gt,kt,st,Tt)}return lr/Math.max(1,Math.ceil(lr/Et))})(Ie,Pe,Ae,je,Oe,ht),St=Ie.text.indexOf("")>=0;let bt=0;for(let wt=0;wt<Ie.length();wt++){const st=Ie.getSection(wt),Et=Ie.getCodePoint(wt);if(cb[Et]||(bt+=vI(Et,st,je,Oe,Pe,ht)),wt<Ie.length()-1){const gt=jp(Et);(M5[Et]||gt||st.image)&&at.push(wI(wt+1,bt,lt,at,L5(Et,Ie.getCodePoint(wt+1),gt&&St),!1))}}return SI(wI(Ie.length(),bt,lt,at,0,!0))})(Q,A,m,e,l,B),{processBidirectionalText:ae,processStyledBidirectionalText:ue}=fl;if(ae&&Q.sections.length===1){const Ie=ae(Q.toString(),re);for(const Pe of Ie){const Ae=new uy;Ae.text=Pe,Ae.sections=Q.sections;for(let je=0;je<Pe.length;je++)Ae.sectionIndex.push(0);K.push(Ae)}}else if(ue){const Ie=ue(Q.text,Q.sectionIndex,re);for(const Pe of Ie){const Ae=new uy;Ae.text=Pe[0],Ae.sectionIndex=Pe[1],Ae.sections=Q.sections,K.push(Ae)}}else K=(function(Ie,Pe){const Ae=[],je=Ie.text;let Oe=0;for(const ht of Pe)Ae.push(Ie.substring(Oe,ht)),Oe=ht;return Oe<je.length&&Ae.push(Ie.substring(Oe,je.length)),Ae})(Q,re);const xe=[],ye={positionedLines:xe,text:Q.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:j,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ie,Pe,Ae,je,Oe,ht,at,lt,St,bt,wt,st){let Et=0,gt=0,kt=0;const Tt=lt==="right"?1:lt==="left"?0:.5;let lr=!1;for(const wr of Oe){const nr=wr.getSections();for(const en of nr){if(en.image)continue;const kn=Pe[en.fontStack];if(kn&&(lr=kn.ascender!==void 0&&kn.descender!==void 0,!lr))break}if(!lr)break}let dr=0;for(const wr of Oe){wr.trim();const nr=wr.getMaxScale(),en=(nr-1)*So,kn={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[dr]=kn;const li=kn.positionedGlyphs;let En=0;if(!wr.length()){gt+=ht,++dr;continue}let Ai=0,Kn=0;for(let Qn=0;Qn<wr.length();Qn++){const Si=wr.getSection(Qn),ts=wr.getSectionIndex(Qn),as=wr.getCodePoint(Qn);let ls=Si.scale,Cs=null,Do=null,ga=null,qs=So,to=0,ho=St;ho===ql.vertical&&Bm(as)&&(ho=ql.horizontal);const bn=!(ho===ql.horizontal||!wt&&!hc(as)||wt&&(cb[as]||If(as)));if(Si.image){const cs=je.get(Si.image.toString());if(!cs)continue;ga=Si.image,Ie.iconsInText=Ie.iconsInText||!0,Do=cs.paddedRect;const ms=cs.displaySize;ls=ls*So/st,Cs={width:ms[0],height:ms[1],left:0,top:-3,advance:bn?ms[1]:ms[0],localGlyph:!1},to=lr?-Cs.height*ls:nr*So-17-ms[1]*ls,qs=Cs.advance;const Gl=(bn?ms[0]:ms[1])*ls-So*nr;Gl>0&&Gl>En&&(En=Gl)}else{const cs=Ae[Si.fontStack];if(!cs)continue;cs[as]&&(Do=cs[as]);const ms=Pe[Si.fontStack];if(!ms)continue;const Gl=ms.glyphs[as];if(!Gl)continue;if(Cs=Gl.metrics,qs=as!==8203?So:0,lr){const qa=ms.ascender!==void 0?Math.abs(ms.ascender):0,Oo=ms.descender!==void 0?Math.abs(ms.descender):0,Ga=(qa+Oo)*ls;Ai<Ga&&(Ai=Ga,Kn=(qa-Oo)/2*ls),to=-qa*ls}else to=(nr-ls)*So-17}bn?(Ie.verticalizable=!0,li.push({glyph:as,image:ga,x:Et,y:gt+to,vertical:bn,scale:ls,localGlyph:Cs.localGlyph,fontStack:Si.fontStack,sectionIndex:ts,metrics:Cs,rect:Do}),Et+=qs*ls+bt):(li.push({glyph:as,image:ga,x:Et,y:gt+to,vertical:bn,scale:ls,localGlyph:Cs.localGlyph,fontStack:Si.fontStack,sectionIndex:ts,metrics:Cs,rect:Do}),Et+=Cs.advance*ls+bt)}li.length!==0&&(kt=Math.max(Et-bt,kt),lr?TI(li,Tt,En,Kn,ht*nr/2):TI(li,Tt,En,0,ht/2)),Et=0;const Es=ht*nr+En;kn.lineOffset=Math.max(En,en),gt+=Es,++dr}const Wt=gt,{horizontalAlign:Yt,verticalAlign:Fr}=j1(at);(function(wr,nr,en,kn,li,En){const Ai=(nr-en)*li,Kn=-En*kn;for(const Es of wr)for(const Qn of Es.positionedGlyphs)Qn.x+=Ai,Qn.y+=Kn})(Ie.positionedLines,Tt,Yt,Fr,kt,Wt),Ie.top+=-Fr*Wt,Ie.bottom=Ie.top+Wt,Ie.left+=-Yt*kt,Ie.right=Ie.left+kt,Ie.hasBaseline=lr})(ye,e,r,l,K,g,b,E,j,A,R,V),!(function(Ie){for(const Pe of Ie)if(Pe.positionedGlyphs.length!==0)return!1;return!0})(xe))return ye}const cb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vI(o,e,r,l,u,m){if(e.image){const g=l.get(e.image.toString());return g?g.displaySize[0]*e.scale*So/m+u:0}{const g=r[e.fontStack],b=g&&g.glyphs[o];return b?b.metrics.advance*e.scale+u:0}}function bI(o,e,r,l){const u=Math.pow(o-e,2);return l?o<e?u/2:2*u:u+Math.abs(r)*r}function L5(o,e,r){let l=0;return o===10&&(l-=1e4),r&&(l+=150),o!==40&&o!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function wI(o,e,r,l,u,m){let g=null,b=bI(e,r,u,m);for(const E of l){const A=bI(e-E.x,r,u,m)+E.badness;A<=b&&(g=E,b=A)}return{index:o,x:e,priorBreak:g,badness:b}}function SI(o){return o?SI(o.priorBreak).concat(o.index):[]}function j1(o){let e=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function TI(o,e,r,l,u){if(!(e||r||l||u))return;const m=o.length-1,g=o[m],b=(g.x+g.metrics.advance*g.scale)*e;for(let E=0;E<=m;E++)o[E].x-=b,o[E].y+=r+l+u}function R1(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function ub(o,e,r,l){const{horizontalAlign:u,verticalAlign:m}=j1(l),g=r[0]-o.displaySize[0]*u,b=r[1]-o.displaySize[1]*m;return{imagePrimary:o,imageSecondary:e,top:b,bottom:b+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function M1(o,e,r,l,u,m){const g=o.imagePrimary;let b;if(g.content){const Q=g.content,K=g.pixelRatio||1;b=[Q[0]/K,Q[1]/K,g.displaySize[0]-Q[2]/K,g.displaySize[1]-Q[3]/K]}const E=e.left*m,A=e.right*m;let N,j,R,B;r==="width"||r==="both"?(B=u[0]+E-l[3],j=u[0]+A+l[1]):(B=u[0]+(E+A-g.displaySize[0])/2,j=B+g.displaySize[0]);const V=e.top*m,H=e.bottom*m;return r==="height"||r==="both"?(N=u[1]+V-l[0],R=u[1]+H+l[2]):(N=u[1]+(V+H-g.displaySize[1])/2,R=N+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:N,right:j,bottom:R,left:B,collisionPadding:b}}function EI(o){return!o.imagePrimary.stretchX}function CI(o){return!o.imagePrimary.stretchY}function AI(o){return{width:o.right-o.left,height:o.bottom-o.top}}const $f=128;function ag(o,e,r,l){const{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new bi(o+1,{worldview:r}),void 0,void 0,void 0,l)};if(u.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:g}=u;let b=0;for(;b<m.length&&m[b]<=o;)b++;b=Math.max(0,b-1);let E=b;for(;E<m.length&&m[E]<o+1;)E++;E=Math.min(m.length-1,E);const A=m[b],N=m[E];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:N,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:N,minSize:u.evaluate(new bi(A,{worldview:r}),void 0,void 0,void 0,l),maxSize:u.evaluate(new bi(N,{worldview:r}),void 0,void 0,void 0,l),interpolationType:g}}}function L1(o,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:u}){return o.kind==="source"?l/$f:o.kind==="composite"?$r(l/$f,u/$f,r):e}function dy(o,e,r=1){let l=0,u=0;if(o.kind==="constant")u=o.layoutSize*r;else if(o.kind!=="source"){const{interpolationType:m,minZoom:g,maxZoom:b}=o,E=m?Ee(za.interpolationFactor(m,e,g,b),0,1):0;o.kind==="camera"?u=$r(o.minSize,o.maxSize,E)*r:l=E*r}return{uSizeT:l,uSize:u}}class qf extends Nt{constructor(e,r,l,u,m){super(e,r),this.angle=u,this.z=l,m!==void 0&&(this.segment=m)}clone(){return new qf(this.x,this.y,this.z,this.angle,this.segment)}}function II(o,e,r,l,u){if(e.segment===void 0)return!0;let m=e,g=e.segment+1,b=0;for(;b>-r/2;){if(g--,g<0)return!1;b-=o[g].dist(m),m=o[g]}b+=o[g].dist(o[g+1]),g++;const E=[];let A=0;for(;b<r/2;){const N=o[g],j=o[g+1];if(!j)return!1;let R=o[g-1].angleTo(N)-N.angleTo(j);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:R}),A+=R;b-E[0].distance>l;)A-=E.shift().angleDelta;if(A>u)return!1;g++,b+=N.dist(j)}return!0}function PI(o){let e=0;for(let r=0;r<o.length-1;r++)e+=o[r].dist(o[r+1]);return e}function kI(o,e,r){return o?.6*e*r:0}function NI(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function D5(o,e,r,l,u,m){const g=kI(r,u,m),b=NI(r,l)*m;let E=0;const A=PI(o)/2;for(let N=0;N<o.length-1;N++){const j=o[N],R=o[N+1],B=j.dist(R);if(E+B>A){const V=(A-E)/B,H=$r(j.x,R.x,V),Q=$r(j.y,R.y,V),K=new qf(H,Q,0,R.angleTo(j),N);return!g||II(o,K,b,g,e)?K:void 0}E+=B}}function O5(o,e,r,l,u,m,g,b,E){const A=kI(l,m,g),N=NI(l,u),j=N*g,R=o[0].x===0||o[0].x===E||o[0].y===0||o[0].y===E;return e-j<e/4&&(e=j+e/4),jI(o,R?e/2*b%e:(N/2+2*m)*g*b%e,e,A,r,j,R,!1,E)}function jI(o,e,r,l,u,m,g,b,E){const A=m/2,N=PI(o);let j=0,R=e-r,B=[];for(let V=0;V<o.length-1;V++){const H=o[V],Q=o[V+1],K=H.dist(Q),re=Q.angleTo(H);for(;R+r<j+K;){R+=r;const ae=(R-j)/K,ue=$r(H.x,Q.x,ae),xe=$r(H.y,Q.y,ae);if(ue>=0&&ue<E&&xe>=0&&xe<E&&R-A>=0&&R+A<=N){const ye=new qf(ue,xe,0,re,V);l&&!II(o,ye,m,l,u)||B.push(ye)}}j+=K}return b||B.length||g||(B=jI(o,j/2,r,l,u,m,g,!0,E)),B}function RI(o){let e=0,r=0;for(const g of o)e+=g.w*g.h,r=Math.max(r,g.w);o.sort((g,b)=>b.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,m=0;for(const g of o)for(let b=l.length-1;b>=0;b--){const E=l[b];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,m=Math.max(m,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===E.w&&g.h===E.h){const A=l.pop();A&&b<l.length&&(l[b]=A)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(l.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:u,h:m,fill:e/(u*m)||0}}hr(qf,"Anchor");class K_{static getImagePositionScale(e,r,l){if(r&&e){const{sx:u,sy:m}=e;return{x:u,y:m}}return{x:l,y:l}}constructor(e,r,l,u){this.paddedRect=e;const{pixelRatio:m,version:g,stretchX:b,stretchY:E,content:A,sdf:N,usvg:j}=r;this.pixelRatio=m,this.stretchX=b,this.stretchY=E,this.content=A,this.version=g,this.padding=l,this.sdf=N,this.usvg=j,this.scale=K_.getImagePositionScale(u,j,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function D1(o,e,r){const l=ba.parse(o),u=(function(m,g,b=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*b[0])+2*g,h:(m.data?m.data.height:m.height*b[1])+2*g}})(e,r,[l.sx,l.sy]);return{bin:u,imagePosition:new K_(u,e,r,l),imageVariant:l}}class MI{constructor(e,r,l){const u=new Map,m=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,u,1,g),this.addImages(r,m,2,g);const{w:b,h:E}=RI(g),A=new ma({width:b||1,height:E||1});for(const[N,j]of e.entries()){const R=u.get(N).paddedRect;ma.copy(j.data,A,{x:0,y:0},{x:R.x+1,y:R.y+1},j.data,null,j.sdf)}for(const[N,j]of r.entries()){const R=m.get(N),B=R.paddedRect;let V=R.padding;const H=B.x+V,Q=B.y+V,K=j.data.width,re=j.data.height;V=V>1?V-1:V,ma.copy(j.data,A,{x:0,y:0},{x:H,y:Q},j.data,l),ma.copy(j.data,A,{x:0,y:re-V},{x:H,y:Q-V},{width:K,height:V},l),ma.copy(j.data,A,{x:0,y:0},{x:H,y:Q+re},{width:K,height:V},l),ma.copy(j.data,A,{x:K-V,y:0},{x:H-V,y:Q},{width:V,height:re},l),ma.copy(j.data,A,{x:0,y:0},{x:H+K,y:Q},{width:V,height:re},l),ma.copy(j.data,A,{x:K-V,y:re-V},{x:H-V,y:Q-V},{width:V,height:V},l),ma.copy(j.data,A,{x:0,y:re-V},{x:H+K,y:Q-V},{width:V,height:V},l),ma.copy(j.data,A,{x:0,y:0},{x:H+K,y:Q+re},{width:V,height:V},l),ma.copy(j.data,A,{x:K-V,y:0},{x:H-V,y:Q+re},{width:V,height:V},l)}this.lut=l,this.image=A,this.iconPositions=u,this.patternPositions=m}addImages(e,r,l,u){for(const[m,g]of e.entries()){const{bin:b,imagePosition:E,imageVariant:A}=D1(m,g,l);r.set(m,E),u.push(b),g.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,r,l,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>e.hasImage(m,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const m of e.getUpdatedImages(l)){for(const g of this.iconPositions.keys()){const b=ba.parse(g);if(co.isEqual(b.id,m)){const E=e.getImage(m,l);this.patchUpdatedImage(this.iconPositions.get(g),E,r,null)}}for(const g of this.patternPositions.keys()){const b=ba.parse(g);if(co.isEqual(b.id,m)){const E=e.getImage(m,l);this.patchUpdatedImage(this.patternPositions.get(g),E,r,u||this.lut)}}}}patchUpdatedImage(e,r,l,u=null){if(!e||!r||e.version===r.version)return;e.version=r.version;const[m,g]=e.tl,b=e.sdf;if(this.lut||b){const E={width:r.data.width,height:r.data.height},A=new ma(E);ma.copy(r.data,A,{x:0,y:0},{x:0,y:0},E,u,b),l.update(A,{position:{x:m,y:g}})}else l.update(r.data,{position:{x:m,y:g}})}}hr(K_,"ImagePosition"),hr(MI,"ImageAtlas",{omit:["lut"]});const Y_=1e20;function LI(o,e,r,l,u,m,g,b,E){for(let A=e;A<e+l;A++)DI(o,r*m+A,m,u,g,b,E);for(let A=r;A<r+u;A++)DI(o,A*m+e,1,l,g,b,E)}function DI(o,e,r,l,u,m,g){m[0]=0,g[0]=-Y_,g[1]=Y_,u[0]=o[e];for(let b=1,E=0,A=0;b<l;b++){u[b]=o[e+b*r];const N=b*b;do{const j=m[E];A=(u[b]-u[j]+N-j*j)/(b-j)/2}while(A<=g[E]&&--E>-1);E++,m[E]=b,g[E]=A,g[E+1]=Y_}for(let b=0,E=0;b<l;b++){for(;g[E+1]<b;)E++;const A=m[E],N=b-A;o[e+b*r]=u[A]+N*N}}const O1={none:0,ideographs:1,all:2};class hy{constructor(e,r,l){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const l=[],u=this.url||Qi.GLYPHS_URL;for(const m in e)for(const g of e[m])l.push({stack:m,id:g});qe(l,({stack:m,id:g},b)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=E.glyphs[g];if(A!==void 0)return void b(null,{stack:m,id:g,glyph:A});if(A=this._tinySDF(E,m,g),A)return E.glyphs[g]=A,void b(null,{stack:m,id:g,glyph:A});const N=Math.floor(g/256);if(256*N>65535)return Rr("glyphs > 65535 not supported"),void b(null,{stack:m,id:g,glyph:A});if(E.ranges[N])return void b(null,{stack:m,id:g,glyph:A});let j=E.requests[N];j||(j=E.requests[N]=[],hy.loadGlyphRange(m,N,u,this.requestManager,(R,B)=>{if(B){E.ascender=B.ascender,E.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(E.glyphs[+V]=B.glyphs[+V]);E.ranges[N]=!0}for(const V of j)V(R,B);delete E.requests[N]})),j.push((R,B)=>{R?b(R):B&&b(null,{stack:m,id:g,glyph:B.glyphs[g]||null})})},(m,g)=>{if(m)r(m);else if(g){const b={};for(const{stack:E,id:A,glyph:N}of g)b[E]===void 0&&(b[E]={}),b[E].glyphs===void 0&&(b[E].glyphs={}),b[E].glyphs[A]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;r(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==O1.none&&(this.localGlyphMode===O1.all?!!this.localFontFamily:!!this.localFontFamily&&(Ps(e)||Tf(e)||rd(e)||nd(e)||Ol(e)||ul(e)||(r=e)>=131072&&r<=173791||(l=>l>=66736&&l<=66815)(e)));var r}_tinySDF(e,r,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let H="400";/bold/i.test(r)?H="900":/medium/i.test(r)?H="500":/light/i.test(r)&&(H="200"),m=e.tinySDF=new hy.TinySDF({fontFamily:u,fontWeight:H,fontSize:48,buffer:6,radius:16}),m.fontWeight=H}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const g=String.fromCodePoint(l),{data:b,width:E,height:A,glyphWidth:N,glyphHeight:j,glyphLeft:R,glyphTop:B,glyphAdvance:V}=m.draw(g);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Hp({width:E,height:A},b),metrics:{width:N/2,height:j/2,left:R/2,top:B/2-27,advance:V/2,localGlyph:!0}}}}function OI(o,e){return o+e[1]-e[0]}function z1(o,e,r,l,u=1){const m=[],g=o.imagePrimary,b=g.pixelRatio,E=g.paddedRect.w-2,A=g.paddedRect.h-2,N=(o.right-o.left)*u,j=(o.bottom-o.top)*u,R=g.stretchX||[[0,E]],B=g.stretchY||[[0,A]],V=R.reduce(OI,0),H=B.reduce(OI,0),Q=E-V,K=A-H;let re=0,ae=V,ue=0,xe=H,ye=0,Ie=Q,Pe=0,Ae=K;if(g.content&&l){const Oe=g.content;re=db(R,0,Oe[0]),ue=db(B,0,Oe[1]),ae=db(R,Oe[0],Oe[2]),xe=db(B,Oe[1],Oe[3]),ye=Oe[0]-re,Pe=Oe[1]-ue,Ie=Oe[2]-Oe[0]-ae,Ae=Oe[3]-Oe[1]-xe}const je=(Oe,ht,at,lt)=>{const St=hb(Oe.stretch-re,ae,N,o.left*u),bt=fb(Oe.fixed-ye,Ie,Oe.stretch,V),wt=hb(ht.stretch-ue,xe,j,o.top*u),st=fb(ht.fixed-Pe,Ae,ht.stretch,H),Et=hb(at.stretch-re,ae,N,o.left*u),gt=fb(at.fixed-ye,Ie,at.stretch,V),kt=hb(lt.stretch-ue,xe,j,o.top*u),Tt=fb(lt.fixed-Pe,Ae,lt.stretch,H),lr=new Nt(St,wt),dr=new Nt(Et,wt),Wt=new Nt(Et,kt),Yt=new Nt(St,kt),Fr=new Nt(bt/b,st/b),wr=new Nt(gt/b,Tt/b),nr=e*Math.PI/180;if(nr){const Kn=Math.sin(nr),Es=Math.cos(nr),Qn=[Es,-Kn,Kn,Es];lr._matMult(Qn),dr._matMult(Qn),Yt._matMult(Qn),Wt._matMult(Qn)}const en=Oe.stretch+Oe.fixed,kn=at.stretch+at.fixed,li=ht.stretch+ht.fixed,En=lt.stretch+lt.fixed,Ai=o.imageSecondary;return{tl:lr,tr:dr,bl:Yt,br:Wt,texPrimary:{x:g.paddedRect.x+1+en,y:g.paddedRect.y+1+li,w:kn-en,h:En-li},texSecondary:Ai?{x:Ai.paddedRect.x+1+en,y:Ai.paddedRect.y+1+li,w:kn-en,h:En-li}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fr,pixelOffsetBR:wr,minFontScaleX:Ie/b/N,minFontScaleY:Ae/b/j,isSDF:r}};if(g.stretchX||g.stretchY){const Oe=zI(R,Q,V),ht=zI(B,K,H);for(let at=0;at<Oe.length-1;at++){const lt=Oe[at],St=Oe[at+1];for(let bt=0;bt<ht.length-1;bt++)m.push(je(lt,ht[bt],St,ht[bt+1]))}}else m.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:A+1}));return m}function z5(o,e){const r=o.stretchY||[[0,o.paddedRect.h-2]];return o.stretchX||o.stretchY?FI(o.stretchX||[[0,o.paddedRect.w-2]])*FI(r):1}function db(o,e,r){let l=0;for(const u of o)l+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return l}function zI(o,e,r){const l=[{fixed:-1,stretch:0}];for(const[u,m]of o){const g=l[l.length-1];l.push({fixed:u-g.stretch,stretch:g.stretch}),l.push({fixed:u-g.stretch,stretch:g.stretch+(m-u)})}return l.push({fixed:e+1,stretch:r}),l}function FI(o){return 2*o.length+1}function hb(o,e,r,l){return o/e*r+l}function fb(o,e,r,l){return o-e*r/l}function F5(o,e,r,l){const u=e+o.positionedLines[l].lineOffset;return l===0?r+u/2:r+(u+(e+o.positionedLines[l-1].lineOffset))/2}function BI(o,e,r,l,u,m,g,b,E){const A=[];if(e.positionedLines.length===0)return A;const N=(E!==void 0?E:l.layout.get("text-rotate").evaluate(m,{}))*Math.PI/180,j=(function(Q){const K=Q[0],re=Q[1],ae=K*re;return ae>0?[K,-re]:ae<0?[-K,re]:K===0?[re,K]:[re,-K]})(r);let R=Math.abs(e.top-e.bottom);for(const Q of e.positionedLines)R-=Q.lineOffset;const B=e.positionedLines.length,V=R/B;let H=e.top-r[1];for(let Q=0;Q<B;++Q){const K=e.positionedLines[Q];H=F5(e,V,H,Q);for(const re of K.positionedGlyphs){if(!re.rect)continue;const ae=re.rect||{};let ue=4,xe=!0,ye=1,Ie=0;if(re.image){const dr=g.get(re.image.toString());if(!dr)continue;if(dr.sdf){Rr("SDF images are not supported in formatted text and will be ignored.");continue}xe=!1,ye=dr.pixelRatio,ue=1/ye}const Pe=(u||b)&&re.vertical,Ae=re.metrics.advance*re.scale/2,je=re.metrics,Oe=re.rect;if(Oe===null)continue;b&&e.verticalizable&&(Ie=re.image?Ae-re.metrics.width*re.scale/2:0);const ht=u?[re.x+Ae,re.y]:[0,0];let at=[0,0],lt=[0,0],St=!1;u||(Pe?(lt=[re.x+Ae+j[0],re.y+j[1]-Ie],St=!0):at=[re.x+Ae+r[0],re.y+r[1]-Ie]);const bt=Oe.w*re.scale/(ye*(re.localGlyph?2:1)),wt=Oe.h*re.scale/(ye*(re.localGlyph?2:1));let st,Et,gt,kt;if(Pe){const dr=re.y-H,Wt=new Nt(-Ae,Ae-dr),Yt=-Math.PI/2,Fr=new Nt(...lt);st=new Nt(-Ae+at[0],at[1]),st._rotateAround(Yt,Wt)._add(Fr),st.x+=-dr+Ae,st.y-=(je.left-ue)*re.scale;const wr=re.image?je.advance*re.scale:So*re.scale,nr=String.fromCodePoint(re.glyph);v5(nr)?st.x+=(1-ue)*re.scale:b5(nr)?st.x+=wr-je.height*re.scale+(-ue-1)*re.scale:st.x+=re.image||je.width+2*ue===Oe.w&&je.height+2*ue===Oe.h?(wr-wt)/2:(wr-(je.height+2*ue)*re.scale)/2,Et=new Nt(st.x,st.y-bt),gt=new Nt(st.x+wt,st.y),kt=new Nt(st.x+wt,st.y-bt)}else{const dr=(je.left-ue)*re.scale-Ae+at[0],Wt=(-je.top-ue)*re.scale+at[1],Yt=dr+bt,Fr=Wt+wt;st=new Nt(dr,Wt),Et=new Nt(Yt,Wt),gt=new Nt(dr,Fr),kt=new Nt(Yt,Fr)}if(N){let dr;dr=u?new Nt(0,0):St?new Nt(j[0],j[1]):new Nt(r[0],r[1]),st._rotateAround(N,dr),Et._rotateAround(N,dr),gt._rotateAround(N,dr),kt._rotateAround(N,dr)}const Tt=new Nt(0,0),lr=new Nt(0,0);A.push({tl:st,tr:Et,bl:gt,br:kt,texPrimary:ae,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:ht,sectionIndex:re.sectionIndex,isSDF:xe,pixelOffsetTL:Tt,pixelOffsetBR:lr,minFontScaleX:0,minFontScaleY:0})}}return A}function B5(o,e=1,r=!1){let l=1/0,u=1/0,m=-1/0,g=-1/0;const b=o[0];for(let B=0;B<b.length;B++){const V=b[B];(!B||V.x<l)&&(l=V.x),(!B||V.y<u)&&(u=V.y),(!B||V.x>m)&&(m=V.x),(!B||V.y>g)&&(g=V.y)}const E=Math.min(m-l,g-u);let A=E/2;const N=new Hd([],V5);if(E===0)return new Nt(l,u);for(let B=l;B<m;B+=E)for(let V=u;V<g;V+=E)N.push(new fy(B+A,V+A,A,o));let j=(function(B){let V=0,H=0,Q=0;const K=B[0];for(let re=0,ae=K.length,ue=ae-1;re<ae;ue=re++){const xe=K[re],ye=K[ue],Ie=xe.x*ye.y-ye.x*xe.y;H+=(xe.x+ye.x)*Ie,Q+=(xe.y+ye.y)*Ie,V+=3*Ie}return new fy(H/V,Q/V,0,B)})(o),R=N.length;for(;N.length;){const B=N.pop();(B.d>j.d||!j.d)&&(j=B,r&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-j.d<=e||(A=B.h/2,N.push(new fy(B.p.x-A,B.p.y-A,A,o)),N.push(new fy(B.p.x+A,B.p.y-A,A,o)),N.push(new fy(B.p.x-A,B.p.y+A,A,o)),N.push(new fy(B.p.x+A,B.p.y+A,A,o)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${j.d}`)),j.p}function V5(o,e){return e.max-o.max}hy.loadGlyphRange=function(o,e,r,l,u){const m=256*e,g=m+255,b=l.transformRequest(l.normalizeGlyphsURL(r).replace("{fontstack}",o).replace("{range}",`${m}-${g}`),qo.Glyphs);Uh(b,(E,A)=>{if(E)u(E);else if(A){const N={},j=(function(R){return new lb(R).readFields(N5,{})})(A);for(const R of j.glyphs)N[R.id]=R;u(null,{glyphs:N,ascender:j.ascender,descender:j.descender})}})},hy.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:b=null}={}){this.buffer=e,this.cutoff=l,this.radius=r,this.lang=b;const E=this.size=o+4*e,A=this._createCanvas(E),N=this.ctx=A.getContext("2d",{willReadFrequently:!0});N.font=`${g} ${m} ${o}px ${u}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(o),g=Math.ceil(r),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),E=Math.min(this.size-this.buffer,g+Math.ceil(l)),A=b+2*this.buffer,N=E+2*this.buffer,j=Math.max(A*N,0),R=new Uint8ClampedArray(j),B={data:R,width:A,height:N,glyphWidth:b,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(b===0||E===0)return B;const{ctx:V,buffer:H,gridInner:Q,gridOuter:K}=this;this.lang&&(V.lang=this.lang),V.clearRect(H,H,b,E),V.fillText(o,H,H+g);const re=V.getImageData(H,H,b,E);K.fill(Y_,0,j),Q.fill(0,0,j);for(let ae=0;ae<E;ae++)for(let ue=0;ue<b;ue++){const xe=re.data[4*(ae*b+ue)+3]/255;if(xe===0)continue;const ye=(ae+H)*A+ue+H;if(xe===1)K[ye]=0,Q[ye]=Y_;else{const Ie=.5-xe;K[ye]=Ie>0?Ie*Ie:0,Q[ye]=Ie<0?Ie*Ie:0}}LI(K,0,0,A,N,A,this.f,this.v,this.z),LI(Q,H,H,b,E,A,this.f,this.v,this.z);for(let ae=0;ae<j;ae++){const ue=Math.sqrt(K[ae])-Math.sqrt(Q[ae]);R[ae]=Math.round(255-255*(ue/this.radius+this.cutoff))}return B}};class fy{constructor(e,r,l,u){this.p=new Nt(e,r),this.h=l,this.d=(function(m,g){let b=!1,E=1/0;for(let A=0;A<g.length;A++){const N=g[A];for(let j=0,R=N.length,B=R-1;j<R;B=j++){const V=N[j],H=N[B];V.y>m.y!=H.y>m.y&&m.x<(H.x-V.x)*(m.y-V.y)/(H.y-V.y)+V.x&&(b=!b),E=Math.min(E,vr(m,V,H))}}return(b?1:-1)*Math.sqrt(E)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const U5=Object.keys,F1=Number.POSITIVE_INFINITY,$5=Math.sqrt(2);function Yp(o,e,r,l,u){const m=R1(o)&&o.collisionPadding?o.collisionPadding:[0,0,0,0],g={top:o.top-m[1],bottom:o.bottom+m[3],left:o.left-m[0],right:o.right+m[2],scaled:!1};return l!==void 0&&(function(b,E){b.top*=E,b.bottom*=E,b.left*=E,b.right*=E,b.scaled=!0})(g,l),r&&(function(b,E){if(!E)return;const A=vn(E),N=new Nt(b.left,b.top),j=new Nt(b.right,b.top),R=new Nt(b.left,b.bottom),B=new Nt(b.right,b.bottom),V=new Nt(0,0);N._rotateAround(A,V),j._rotateAround(A,V),R._rotateAround(A,V),B._rotateAround(A,V),b.left=Math.min(N.x,j.x,R.x,B.x),b.right=Math.max(N.x,j.x,R.x,B.x),b.top=Math.min(N.y,j.y,R.y,B.y),b.bottom=Math.max(N.y,j.y,R.y,B.y)})(g,r),u&&(g.left+=u[0],g.right+=u[0],g.top+=u[1],g.bottom+=u[1]),e?{top:Math.min(e.top,g.top),bottom:Math.max(e.bottom,g.bottom),left:Math.min(e.left,g.left),right:Math.max(e.right,g.right),scaled:e.scaled||g.scaled}:g}function VI(o,[e,r]){let l=0,u=0;if(r===F1){e<0&&(e=0);const m=e/$5;switch(o){case"top-right":case"top-left":u=m-7;break;case"bottom-right":case"bottom-left":u=7-m;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),o){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(o){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function q5(o,e,r,l,u,m,g,b,E,A,N,j,R,B,V){const H=o.layers[0],Q=H.appearances;if(Q.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const K={iconBBox:null,iconVerticalBBox:null},re={textBBox:null,textVerticalBBox:null},{baseIconRotate:ae,baseTextRotate:ue,iconScaleFactor:xe}=(function(Ie,Pe,Ae){const je=Ie.get("icon-rotate").evaluate(Pe,{},Ae),Oe=Ie.get("text-rotate").evaluate(Pe,{},Ae),[ht,at]=Ie.get("icon-size-scale-range");return{baseIconRotate:je,baseTextRotate:Oe,iconScaleFactor:Ee(1,ht,at)}})(l,u,m);e&&(K.iconBBox=Yp(e,K.iconBBox,ae,g),r)&&(K.iconVerticalBBox=Yp(r,K.iconVerticalBBox,ae+90,g));const ye=mb(j.horizontal);ye&&(re.textBBox=Yp(ye,re.textBBox,ue,1,B)),j.vertical&&(re.textVerticalBBox=Yp(j.vertical,re.textVerticalBBox,ue+90,1,B));for(const Ie of Q)Ie.hasIconProperties()&&G5(K,o,H,Ie,u,m,b,ae,g,E,e,A,xe,N,V),Ie.hasTextProperties()&&W5(re,H,Ie,u,m,B,ue,R,ye,j.vertical);return{iconBBox:K.iconBBox,iconVerticalBBox:K.iconVerticalBBox,textBBox:re.textBBox,textVerticalBBox:re.textVerticalBBox}}function G5(o,e,r,l,u,m,g,b,E,A,N,j,R,B,V){const{appearanceIconOffset:H,appearanceIconRotate:Q,appearanceIconSize:K}=UI(l,r,u,m,g,b,E,A.iconScaleFactor);let re=null,ae=null,ue=null;l.hasProperty("icon-image")?ue=(function(xe,ye,Ie,Pe,Ae,je,Oe,ht){let at=null;const lt=ye.getAppearanceValueAndResolveTokens(Ie,"icon-image",Pe,Ae,ht);if(lt){const St=xe.getResolvedImageFromTokens(lt),bt=Ie.getUnevaluatedProperty("icon-size"),wt=Q_(St,ag(xe.zoom,bt,xe.worldview,ht),bt,Ae,xe.zoom,Pe,xe.pixelRatio,Oe,xe.worldview,ht);at=je.get(wt.iconPrimary.toString())}return at})(e,r,l,u,m,j,R,V):N&&(ue=N.imagePrimary),ue&&(re=ub(ue,null,H,B),e.allowVerticalPlacement&&(ae=ub(ue,null,H,B))),re&&(o.iconBBox=Yp(re,o.iconBBox,Q,K)),ae&&(o.iconVerticalBBox=Yp(ae,o.iconVerticalBBox,Q+90,K))}function UI(o,e,r,l,u,m,g,b){const E=o.hasProperty("icon-offset")?e.getAppearanceValueAndResolveTokens(o,"icon-offset",r,l,[]):null,A=E&&Array.isArray(E)?E:u,N=o.hasProperty("icon-rotate")?e.getAppearanceValueAndResolveTokens(o,"icon-rotate",r,l,[]):null,j=typeof N=="number"?N:m,R=o.hasProperty("icon-size")?e.getAppearanceValueAndResolveTokens(o,"icon-size",r,l,[]):null;return{appearanceIconOffset:A,appearanceIconRotate:j,appearanceIconSize:typeof R=="number"?R*b:g}}function W5(o,e,r,l,u,m,g,b,E,A){const{appearanceTextOffset:N,appearanceTextRotate:j,appearanceTextSize:R}=$I(r,e,l,u,m,g,b),B=R/b;E&&(o.textBBox=Yp(E,o.textBBox,j,B,N)),A&&(o.textVerticalBBox=Yp(A,o.textVerticalBBox,j+90,B,N))}function $I(o,e,r,l,u,m,g){const b=o.hasProperty("text-offset")?e.getAppearanceValueAndResolveTokens(o,"text-offset",r,l,[]):null,E=b&&Array.isArray(b)?[b[0]*So,b[1]*So]:u,A=o.hasProperty("text-rotate")?e.getAppearanceValueAndResolveTokens(o,"text-rotate",r,l,[]):null,N=typeof A=="number"?A:m,j=o.hasProperty("text-size")?e.getAppearanceValueAndResolveTokens(o,"text-size",r,l,[]):null;return{appearanceTextOffset:E,appearanceTextRotate:N,appearanceTextSize:typeof j=="number"?j:g}}function pb(o,e,r,l,u,m,g,b,E){if(!e||!e.usvg)return;const A=AI(l),N=AI(u),j=m!=="both"&&m!=="width"||!EI(l)?1:N.width/A.width,R=m!=="both"&&m!=="height"||!CI(l)?1:N.height/A.height;r.scaleSelf(j,R);const B=r.toString();g.set(B,r),b.set(B,e);const{imagePosition:V}=D1(B,e,1);E.set(B,V)}function qI(o,e,r,l,u,m,g,b,E,A){if(!o)return;const N=(function(j,R,B,V,H,Q,K){if(j.kind==="camera")return j.maxSize;if(j.kind==="composite"){const re=R.possiblyEvaluate(new bi(j.maxZoom,{worldview:Q}),B,K).evaluate(H,{},B,K),ae=R.possiblyEvaluate(new bi(j.minZoom,{worldview:Q}),B,K).evaluate(H,{},B,K);return Math.max(re,ae)}return R.possiblyEvaluate(new bi(V,{worldview:Q}),B,K).evaluate(H,{},B,K)})(e,r,l,u,m,E,A);return o.scaleSelf(N*b*g)}function Q_(o,e,r,l,u,m,g,b,E,A){return{iconPrimary:qI(o.getPrimary(),e,r,l,u,m,g,b,E,A),iconSecondary:qI(o.getSecondary(),e,r,l,u,m,g,b,E,A)}}function H5(o,e,r){if(!e)return;const l=r.get(o.toString()),u=r.get(e.toString());l&&u&&(l.paddedRect.w===u.paddedRect.w&&l.paddedRect.h===u.paddedRect.h||Rr(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),l.usvg!==u.usvg&&Rr(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function GI(o,e,r,l){if(!o)return;const u=e.get(r.toString());if(o.imagePrimary=u,l){const m=e.get(l.toString());o.imageSecondary=m}}function Z5(o,e){for(const r in o.horizontal)WI(o.horizontal[r],e);WI(o.vertical,e)}function WI(o,e){if(o){for(const r of o.positionedLines)for(const l of r.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function B1(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function X5(o,e,r,l,u,m,g,b,E){const A=mb(m.horizontal)||m.vertical,N=r.get("icon-text-fit-padding").evaluate(l,{},u);let j,R=e;return e&&E!=="none"&&(o.allowVerticalPlacement&&m.vertical&&(j=M1(e,m.vertical,E,N,b,g)),A&&(R=M1(e,A,E,N,b,g))),{defaultShapedIcon:R,verticallyShapedIcon:j}}function HI(o,e){return o*e/24}function K5(o,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re,ae,ue,xe,ye,Ie){let Pe=g.textMaxSize.evaluate(e,{},R);Pe===void 0?Pe=b*g.textScaleFactor:Pe*=g.textScaleFactor;const Ae=o.layers[0].layout,je=HI(b,g.textScaleFactor),Oe=mb(r.horizontal)||r.vertical,ht=o.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((Q!=="none"||ht)&&o.appearanceFeatureData&&o.featureToAppearanceIndex[e.index]<o.appearanceFeatureData.length){const Wt=o.appearanceFeatureData[o.featureToAppearanceIndex[e.index]];Wt&&(Wt.textShaping=Oe,Wt.iconTextFitPadding=Ae.get("icon-text-fit-padding").evaluate(e,{},R),Wt.fontScale=je,Wt.textScaleFactor=g.textScaleFactor)}const at=B.name==="globe",lt=o.tilePixelRatio*Pe/24,St=(kt=o.overscaling,o.zoom>18&&kt>2&&(kt>>=1),Math.max(qt/(512*kt),1)*Ae.get("symbol-spacing")),bt=Ae.get("text-padding")*o.tilePixelRatio,wt=Ae.get("icon-padding")*o.tilePixelRatio,st=vn(Ae.get("text-max-angle")),Et=Ae.get("icon-rotation-alignment")==="map"&&ae!=="point",gt=St/2;var kt;o.hasAnyIconTextFit===!1&&Q!=="none"&&(o.hasAnyIconTextFit=!0);const Tt=e.properties?+e.properties[On]:null,lr=Tt&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(Tt):65535,dr=(Wt,Yt,Fr)=>{if(Yt.x<0||Yt.x>=qt||Yt.y<0||Yt.y>=qt)return;let wr=null;if(at){const{x:nr,y:en,z:kn}=B.projectTilePoint(Yt.x,Yt.y,Fr);wr={anchor:new qf(nr,en,kn,0,void 0),up:B.upVector(Fr,Yt.x,Yt.y)}}(function(nr,en,kn,li,En,Ai,Kn,Es,Qn,Si,ts,as,ls,Cs,Do,ga,qs,to,ho,bn,cs,ms,Gl,qa,Oo,Ga,Ah,Pa,jb,vy,tl,Rb){const Ih=nr.addToLineVertexArray(en,li);let Gf,em,Bc,Au,px,by,Cn,To=0,As=0,ro=0,Vc=0,vl=-1,Wl=-1;const Eo={};let mx=wc("");const Ph=kn?kn.anchor:en,Gs=Pa!=="none";let zo=0,no=0;if(Qn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Fo=Qn.layout.get("text-offset").evaluate(cs,{},Oo);zo=Fo[0]*So,no=Fo[1]*So}else zo=Qn.layout.get("text-radial-offset").evaluate(cs,{},Oo)*So,no=F1;if(nr.allowVerticalPlacement&&En.vertical){const Fo=En.vertical;if(Do)by=$1(Fo),Es&&(Cn=$1(Es));else{const bl=Qn.layout.get("text-rotate").evaluate(cs,{},Oo)+90;Bc=gb(Si,Ph,en,ts,as,ls,Fo,Cs,bl,ga,Rb),Es&&(Au=gb(Si,Ph,en,ts,as,ls,Es,to,bl,null,tl))}}if(Ai){const Fo=Qn.layout.get("icon-rotate").evaluate(cs,{},Oo),bl=z1(Ai,Fo,Gl,Gs,ms.iconScaleFactor),Iu=Es?z1(Es,Fo,Gl,Gs,ms.iconScaleFactor):void 0;em=gb(Si,Ph,en,ts,as,ls,Ai,to,Fo,null,vy);const kh=(function(gd,lU,dk,cU,uU,hk,fk,dU,Lie,fS){const pk=gd.layers[0],mk=pk.appearances;let Sy=lU.length;if(dk&&(Sy=Math.max(Sy,dk.length)),mk.length===0)return Sy;const[hU,fU]=cU.get("icon-size-scale-range"),pU=Ee(1,hU,fU);for(const pS of mk){const gk=pS.getUnevaluatedProperties();if(gk._values["icon-image"].value!==void 0){const yk=pk.getAppearanceValueAndResolveTokens(pS,"icon-image",hk,fk,fS);if(yk){const _k=gd.getResolvedImageFromTokens(yk);if(_k){const xk=pS.hasProperty("icon-size")?gk._values["icon-size"]:uU._values["icon-size"],mU=Q_(_k,ag(gd.zoom,xk,gd.worldview,fS),xk,fk,gd.zoom,hk,gd.pixelRatio,pU,gd.worldview,fS),vk=dU.get(mU.iconPrimary.toString());vk&&(Sy=Math.max(Sy,z5(vk)))}}}}return Sy})(nr,bl,Iu,Qn.layout,Qn._unevaluatedLayout,cs,Oo,nr.iconAtlasPositions,0,qa);To=4*kh;const dS=Qn.layout.get("icon-size").evaluate(cs,{},Oo,qa),hS=ms.compositeIconSizes?ms.compositeIconSizes[0].evaluate(cs,{},Oo,qa):0,gx=ms.compositeIconSizes?ms.compositeIconSizes[1].evaluate(cs,{},Oo,qa):0,wy=U1(nr.layerIds[0],nr.iconSizeData,dS,ms.iconScaleFactor,hS,gx);nr.addSymbols(nr.icon,bl,wy,bn,ho,cs,void 0,kn,en,Ih.lineStartIndex,Ih.lineLength,-1,qa,Oo,Ga,Ah,nr.symbolInstances.length,kh),vl=nr.icon.placedSymbolArray.length-1,Iu&&(As=4*kh,nr.addSymbols(nr.icon,Iu,wy,bn,ho,cs,ql.vertical,kn,en,Ih.lineStartIndex,Ih.lineLength,-1,qa,Oo,Ga,Ah,nr.symbolInstances.length,kh),Wl=nr.icon.placedSymbolArray.length-1)}for(const Fo in En.horizontal){const bl=Fo,Iu=En.horizontal[bl];Gf||(mx=wc(Iu.text),Do?px=$1(Iu):Gf=gb(Si,Ph,en,ts,as,ls,Iu,Cs,Qn.layout.get("text-rotate").evaluate(cs,{},Oo),ga,Rb));const kh=Iu.positionedLines.length===1;if(ro+=ZI(nr,kn,en,Iu,Kn,Qn,Do,cs,ga,Ih,En.vertical?ql.horizontal:ql.horizontalOnly,kh?U5(En.horizontal):[bl],Eo,vl,ms,qa,Oo,nr.symbolInstances.length,Ga),kh)break}En.vertical&&(Vc+=ZI(nr,kn,en,En.vertical,Kn,Qn,Do,cs,ga,Ih,ql.vertical,["vertical"],Eo,Wl,ms,qa,Oo,nr.symbolInstances.length,Ga));let ka=-1;const Na=(Fo,bl)=>Fo?Math.max(Fo,bl):bl;ka=Na(px,ka),ka=Na(by,ka),ka=Na(Cn,ka);const tm=ka>-1?1:0;nr.glyphOffsetArray.length>=65535&&Rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cs.sortKey!==void 0&&nr.addToSortKeyRanges(nr.symbolInstances.length,cs.sortKey),nr.symbolInstances.emplaceBack(en.x,en.y,Ph.x,Ph.y,Ph.z,Eo.right>=0?Eo.right:-1,Eo.center>=0?Eo.center:-1,Eo.left>=0?Eo.left:-1,Eo.vertical>=0?Eo.vertical:-1,vl,Wl,mx,Gf!==void 0?Gf:nr.collisionBoxArray.length,Gf!==void 0?Gf+1:nr.collisionBoxArray.length,Bc!==void 0?Bc:nr.collisionBoxArray.length,Bc!==void 0?Bc+1:nr.collisionBoxArray.length,em!==void 0?em:nr.collisionBoxArray.length,em!==void 0?em+1:nr.collisionBoxArray.length,Au||nr.collisionBoxArray.length,Au?Au+1:nr.collisionBoxArray.length,ts,ro,Vc,To,As,tm,0,zo,no,ka,0,Gs?1:0,jb)})(o,Yt,wr,Wt,r,l,m,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,bt,re,A,0,wt,Et,K,e,g,N,j,R,V,H,Q,lr,ue,xe,ye)};if(ae==="line")for(const Wt of Yv(e.geometry,0,0,qt,qt)){const Yt=O5(Wt,St,st,r.vertical||Oe,l,24,lt,o.overscaling,qt);for(const Fr of Yt)Oe&&Y5(o,Oe.text,gt,Fr)||dr(Wt,Fr,R)}else if(ae==="line-center"){for(const Wt of e.geometry)if(Wt.length>1){const Yt=D5(Wt,st,r.vertical||Oe,l,24,lt);Yt&&dr(Wt,Yt,R)}}else if(e.type==="Polygon")for(const Wt of R_(e.geometry,0)){const Yt=B5(Wt,16);dr(Wt[0],new qf(Yt.x,Yt.y,0,0,void 0),R)}else if(e.type==="LineString")for(const Wt of e.geometry)dr(Wt,new qf(Wt[0].x,Wt[0].y,0,0,void 0),R);else if(e.type==="Point")for(const Wt of e.geometry)for(const Yt of Wt)dr([Yt],new qf(Yt.x,Yt.y,0,0,void 0),R)}const V1=255,lg=V1*$f;function ZI(o,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re){const ae=BI(0,l,E,m,g,b,u,o.allowVerticalPlacement,void 0),ue=m.layout.get("text-size").evaluate(b,{},Q),xe=V.compositeTextSizes?V.compositeTextSizes[0].evaluate(b,{},Q):0,ye=V.compositeTextSizes?V.compositeTextSizes[1].evaluate(b,{},Q):0,Ie=U1(o.layerIds[0],o.textSizeData,ue,V.textScaleFactor,xe,ye);o.addSymbols(o.text,ae,Ie,E,g,b,N,e,r,A.lineStartIndex,A.lineLength,B,H,Q,re,!1,K,ae.length);for(const Pe of j)R[Pe]=o.text.placedSymbolArray.length-1;return 4*ae.length}function U1(o,e,r,l,u,m){const g=e;let b=null;return g.kind==="source"?(b=[$f*r*l],b[0]>lg&&Rr(`${o}: Value for "text-size" is >= ${V1}. Reduce your "text-size".`)):g.kind==="composite"&&(b=[$f*u*l,$f*m*l],(b[0]>lg||b[1]>lg)&&Rr(`${o}: Value for "text-size" is >= ${V1}. Reduce your "text-size".`)),b}function mb(o){for(const e in o)return o[e];return null}function gb(o,e,r,l,u,m,g,b,E,A,N){let j,R,B,V;if(j=N?N.top:g.top,R=N?N.bottom:g.bottom,B=N?N.left:g.left,V=N?N.right:g.right,R1(g)&&g.collisionPadding){const H=g.collisionPadding;B-=H[0],j-=H[1],V+=H[2],R+=H[3]}if(E){const H=new Nt(B,j),Q=new Nt(V,j),K=new Nt(B,R),re=new Nt(V,R),ae=vn(E);let ue=new Nt(0,0);A&&(ue=new Nt(A[0],A[1])),H._rotateAround(ae,ue),Q._rotateAround(ae,ue),K._rotateAround(ae,ue),re._rotateAround(ae,ue),B=Math.min(H.x,Q.x,K.x,re.x),V=Math.max(H.x,Q.x,K.x,re.x),j=Math.min(H.y,Q.y,K.y,re.y),R=Math.max(H.y,Q.y,K.y,re.y)}return o.emplaceBack(e.x,e.y,e.z,r.x,r.y,B,j,V,R,b,l,u,m),o.length-1}function $1(o){R1(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function Y5(o,e,r,l){const u=o.compareText;if(e in u){const m=u[e];for(let g=m.length-1;g>=0;g--)if(l.dist(m[g])<r)return!0}else u[e]=[];return u[e].push(l),!1}function XI(o,e){const r=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),m=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-o._pitch-r,.01));let g=Math.sin(o._pitch)*m+u;const b=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let E=Math.max(o.zoom-17,0);o.isOrthographic&&(E/=10),g*=1+E}return Math.min(1.01*g,b)}function J_(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const r=Math.pow(2,-o.z),l=o.x*r,u=(o.x+1)*r,m=o.y*r,g=(o.y+1)*r,b=mt(l),E=mt(u),A=Pt(m),N=Pt(g),j=e.project(b,A),R=e.project(E,A),B=e.project(E,N),V=e.project(b,N);let H=Math.min(j.x,R.x,B.x,V.x),Q=Math.min(j.y,R.y,B.y,V.y),K=Math.max(j.x,R.x,B.x,V.x),re=Math.max(j.y,R.y,B.y,V.y);const ae=r/16;function ue(ye,Ie,Pe,Ae,je,Oe){const ht=(Pe+je)/2,at=(Ae+Oe)/2,lt=e.project(mt(ht),Pt(at)),St=Math.max(0,H-lt.x,Q-lt.y,lt.x-K,lt.y-re);H=Math.min(H,lt.x),K=Math.max(K,lt.x),Q=Math.min(Q,lt.y),re=Math.max(re,lt.y),St>ae&&(ue(ye,lt,Pe,Ae,ht,at),ue(lt,Ie,ht,at,je,Oe))}ue(j,R,l,m,u,m),ue(R,B,u,m,u,g),ue(B,V,u,g,l,g),ue(V,j,l,g,l,m),H-=ae,Q-=ae,K+=ae,re+=ae;const xe=1/Math.max(K-H,re-Q);return{scale:xe,x:H*xe,y:Q*xe,x2:K*xe,y2:re*xe,projection:e}}function KI(o,{x:e,y:r},l=0){return new Nt(((e-l)*o.scale-o.x)*qt,(r*o.scale-o.y)*qt)}const Q5=oe(new Float32Array(16));class Qp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new _e(0,0)}projectTilePoint(e,r,l){return{x:e,y:r,z:0}}locationPoint(e,r,l,u=!0){return e._coordinatePoint(e.locationCoordinate(r,l),u)}pixelsPerMeter(e,r){return tt(1,e)*r}pixelSpaceConversion(e,r,l){return 1}farthestPixelDistance(e){return XI(e,e.pixelsPerMeter)}pointCoordinate(e,r,l,u){const m=e.horizonLineFromTop(!1),g=new Nt(r,Math.max(m,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,r,l){const u=new Nt(r,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const m=this.pointCoordinate(e,u.x,u.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const l=e.horizonLineFromTop();return r.y<l}createInversionMatrix(e,r){return Q5}createTileMatrix(e,r,l){let u,m,g;const b=l.canonical,E=oe(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=J_(b,this);u=1,m=A.x+l.wrap*A.scale,g=A.y,Re(E,E,[u/A.scale,u/A.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*l.wrap)*u,g=b.y*u;return Se(E,E,[m,g,0]),Re(E,E,[u/qt,u/qt,1]),E}upVector(e,r,l){return[0,0,1]}upVectorScale(e,r,l){return{metersToTile:1}}}class J5 extends Qp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(vn(r));this.n=(u+Math.sin(vn(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:l,c:u,r0:m}=this,g=vn(e-this.center[0]),b=vn(r),E=Math.sqrt(u-2*l*Math.sin(b))/l;return{x:E*Math.sin(g*l),y:E*Math.cos(g*l)-m,z:0}}unproject(e,r){const{n:l,c:u,r0:m}=this,g=m+r;let b=Math.atan2(e,Math.abs(g))*Math.sign(g);g*l<0&&(b-=Math.PI*Math.sign(e)*Math.sign(g));const E=vn(this.center[0])*l;b=et(b,-Math.PI-E,Math.PI-E);const A=Ee($e(b/l)+this.center[0],-180,180),N=Math.asin(Ee((u-(e*e+g*g)*l*l)/(2*l),-1,1)),j=Ee($e(N),-85.051129,Le);return new _e(A,j)}}const ex=1.340264,tx=-.081106,rx=893e-6,nx=.003796,yb=Math.sqrt(3)/2;class eV extends Qp{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(yb*Math.sin(r)),u=l*l,m=u*u*u;return{x:.5*(e*Math.cos(l)/(yb*(ex+3*tx*u+m*(7*rx+9*nx*u)))/Math.PI+.5),y:1-.5*(l*(ex+tx*u+m*(rx+nx*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=l*l,m=u*u*u;for(let N,j,R,B=0;B<12&&(j=l*(ex+tx*u+m*(rx+nx*u))-r,R=ex+3*tx*u+m*(7*rx+9*nx*u),N=j/R,l=Ee(l-N,-Math.PI/3,Math.PI/3),u=l*l,m=u*u*u,!(Math.abs(N)<1e-12));++B);const g=yb*e*(ex+3*tx*u+m*(7*rx+9*nx*u))/Math.cos(l),b=Math.asin(Math.sin(l)/yb),E=Ee(180*g/Math.PI,-180,180),A=Ee(180*b/Math.PI,-85.051129,Le);return new _e(E,A)}}class tV extends Qp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const l=360*(e-.5),u=Ee(360*(.5-r),-85.051129,Le);return new _e(l,u)}}const py=Math.PI/2;function _b(o){return Math.tan((py+o)/2)}class rV extends Qp{constructor(e){super(e),this.center=e.center||[0,30];const[r,l]=this.parallels=e.parallels||[30,30];let u=vn(r),m=vn(l);this.southernCenter=u+m<0,this.southernCenter&&(u=-u,m=-m);const g=Math.cos(u),b=_b(u);this.n=u===m?Math.sin(u):Math.log(g/Math.cos(m))/Math.log(_b(m)/b),this.f=g*Math.pow(_b(u),this.n)/this.n}project(e,r){r=vn(r),this.southernCenter&&(r=-r),e=vn(e-this.center[0]);const l=1e-6,{n:u,f:m}=this;m>0?r<-py+l&&(r=-py+l):r>py-l&&(r=py-l);const g=m/Math.pow(_b(r),u);let b=g*Math.sin(u*e),E=m-g*Math.cos(u*e);return b=.5*(b/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:b,y:this.southernCenter?E:1-E,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:l,f:u}=this,m=u-r,g=Math.sign(m),b=Math.sign(l)*Math.sqrt(e*e+m*m);let E=Math.atan2(e,Math.abs(m))*g;m*l<0&&(E-=Math.PI*Math.sign(e)*g);const A=Ee($e(E/l)+this.center[0],-180,180),N=Ee($e(2*Math.atan(Math.pow(u/b,1/l))-py),-85.051129,Le);return new _e(A,this.southernCenter?-N:N)}}class YI extends Qp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Ge(e),y:it(r),z:0}}unproject(e,r){const l=mt(e),u=Pt(r);return new _e(l,u)}}const QI=vn(Le);class nV extends Qp{project(e,r){const l=(r=vn(r))*r,u=l*l;return{x:.5*((e=vn(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=25,m=0,g=l*l;do{g=l*l;const A=g*g;m=(l*(1.007226+g*(.015085+A*(.028874*g-.044475-.005916*A)))-r)/(1.007226+g*(.045255+A*(.259866*g-.311325-.005916*11*A))),l=Ee(l-m,-QI,QI)}while(Math.abs(m)>1e-6&&--u>0);g=l*l;const b=Ee($e(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=$e(l);return new _e(b,E)}}const JI=vn(Le);class iV extends Qp{project(e,r){r=vn(r),e=vn(e);const l=Math.cos(r),u=2/Math.PI,m=Math.acos(l*Math.cos(e/2)),g=Math.sin(m)/m,b=.5*(e*u+2*l*Math.sin(e/2)/g)||0,E=.5*(r+Math.sin(r)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,r){let l=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,m=25;const g=1e-6;let b=0,E=0;do{const A=Math.cos(u),N=Math.sin(u),j=2*N*A,R=N*N,B=A*A,V=Math.cos(l/2),H=Math.sin(l/2),Q=2*V*H,K=H*H,re=1-B*V*V,ae=re?1/re:0,ue=re?Math.acos(A*V)*Math.sqrt(1/re):0,xe=.5*(2*ue*A*H+2*l/Math.PI)-e,ye=.5*(ue*N+u)-r,Ie=.5*ae*(B*K+ue*A*V*R)+1/Math.PI,Pe=ae*(Q*j/4-ue*N*H),Ae=.125*ae*(j*H-ue*N*B*Q),je=.5*ae*(R*V+ue*K*A)+.5,Oe=Pe*Ae-je*Ie;b=(ye*Pe-xe*je)/Oe,E=(xe*Ae-ye*Ie)/Oe,l=Ee(l-b,-Math.PI,Math.PI),u=Ee(u-E,-JI,JI)}while((Math.abs(b)>g||Math.abs(E)>g)&&--m>0);return new _e($e(l),$e(u))}}class eP extends Qp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:l,cosPhi:u}=this;return{x:vn(e)*u*l+.5,y:-Math.sin(vn(r))/u*l+.5,z:0}}unproject(e,r){const{scale:l,cosPhi:u}=this,m=-(r-.5)/l,g=Ee($e((e-.5)/l)/u,-180,180),b=Math.asin(Ee(m*u,-1,1)),E=Ee($e(b),-85.051129,Le);return new _e(g,E)}}class sV extends YI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,l){const u=A_(e,r,l);return Sn(u,u,Fv(Th(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r,l){const u=Ce(r.lat,r.lng),m=ir([],u),g=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Lr(u,u,m,tt(1,0)*qt*g);const b=oe(new Float64Array(16));return me(b,e.pixelMatrix,e.globeMatrix),Sn(u,u,b),new Nt(u[0],u[1])}pixelsPerMeter(e,r){return tt(1,0)*r}pixelSpaceConversion(e,r,l){const u=tt(1,e)*r,m=$r(tt(1,45)*r,u,l);return this.pixelsPerMeter(e,r)/m}createTileMatrix(e,r,l){const u=Bw(Th(l.canonical));return me(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:l}=e,u=Fv(Th(r));return rt(u,u,vn(l.lng)),Be(u,u,vn(l.lat)),Re(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,l,u){return pC(e,r,l,!0)||new Kt(0,0)}pointCoordinate3D(e,r,l){const u=this.pointCoordinate(e,r,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!pC(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=(function(u,m){const g=u.cameraToCenterDistance,b=u._centerAltitude*m,E=u._camera,A=u._camera.forward(),N=ut([],xr([],A,-g),[0,0,b]),j=u.worldSize/(2*Math.PI),R=[0,0,-j],B=u.width/u.height,V=Math.tan(u.fovAboveCenter),H=xr([],E.up(),V),Q=xr([],E.right(),V*B),K=ir([],ut([],ut([],A,H),Q)),re=[];let ae;if(new ji(N,K).closestPointOnSphere(R,j,re)){const ue=ut([],re,R),xe=Dr([],ue,N);ae=Math.cos(u.fovAboveCenter)*Ar(xe)}else{const ue=Dr([],N,R),xe=Dr([],R,N);ir(xe,xe);const ye=Ar(ue)-j;ae=Math.sqrt(ye*(ye+2*j));const Ie=Math.acos(ae/(j+ye))-Math.acos(Hr(A,xe));ae*=Math.cos(Ie)}return 1.01*ae})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Wp(e.zoom);if(l>0){const u=XI(e,tt(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return $r(r,u+m*(1-Math.cos(g)),Math.pow(l,10))}return r}upVector(e,r,l){return A_(r,l,e,1)}upVectorScale(e){return{metersToTile:Dv(zv(Th(e)))}}}function tP(o){const e=o.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new YI(o);case"equirectangular":return new tV(o);case"naturalEarth":return new nV(o);case"equalEarth":return new eV(o);case"winkelTripel":return new iV(o);case"albers":return r?new eP(o):new J5(o);case"lambertConformalConic":return r?new eP(o):new rV(o);case"globe":return new sV(o)}throw new Error(`Invalid projection name: ${o.name}`)}const oV=Pn.types,aV=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ix(o,e,r,l,u,m,g,b,E,A,N,j,R){const B=b?Math.min(lg,Math.round(b[0])):0,V=b?Math.min(lg,Math.round(b[1])):0;o.emplaceBack(e,r,Math.round(32*l),Math.round(32*u),m,g,(B<<1)+(E?1:0),0+(V<<1),16*A,16*N,256*j,256*R)}function sx(o,e,r){o.emplaceBack(e,r)}function ox(o,e,r,l,u,m,g){o.emplaceBack(e,r,l,u,m,g)}const xb=(o,e,r,l)=>{for(let u=0;u<e;u++)o.emplaceBack(r[0],r[1],r[2],l[0],l[1],l[2])};function my(o,e,r,l,u){o.emplaceBack(e,r,l,u),o.emplaceBack(e,r,l,u),o.emplaceBack(e,r,l,u),o.emplaceBack(e,r,l,u)}function lV(o){for(const e of o.sections)if(jc(e.text))return!0;return!1}class q1{constructor(e){this.layoutVertexArray=new yh,this.indexArray=new Os,this.programConfigurations=e,this.segments=new Zi,this.dynamicLayoutVertexArray=new vu,this.opacityVertexArray=new Vp,this.placedSymbolArray=new Lo,this.iconTransitioningVertexArray=new Aa,this.globeExtVertexArray=new Fl,this.zOffsetVertexArray=new Us,this.orientationVertexArray=new _o,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(e,r){const l=[],u=this.layoutVertexArray.uint16;for(let m=0;m<r;++m){const g=12*(e+m);l.push(...u.slice(g,g+12))}return l}updateSymbolVertexData(e,r,l,u,m,g,b,E,A,N,j,R,B){const V=this.layoutVertexArray.uint16,H=12*e;V[H]=r,V[H+1]=l,V[H+2]=u,V[H+3]=m,V[H+4]=g,V[H+5]=b,V[H+6]=E,V[H+7]=A,V[H+8]=N,V[H+9]=j,V[H+10]=R,V[H+11]=B}upload(e,r,l,u,m,g){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,u5.members,!!g),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,h5.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,aV,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,m5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,d5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,f5.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,p5.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}hr(q1,"SymbolBuffers");class G1{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new Zi,this.collisionVertexArray=new yo,this.collisionVertexArrayExt=new vu}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,g5.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,y5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hr(G1,"CollisionBuffers");class vb{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oe([]),this.placementViewportMatrix=oe([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=ag(this.zoom,r["text-size"],this.worldview,e.availableImages),this.iconSizeData=ag(this.zoom,r["icon-size"],this.worldview,e.availableImages);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>ql[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const r=this.layers[0].getAppearances();if(!r||r.length===0)return!1;const l=Array.isArray(e)?e:[e];return r.some(u=>l.some(m=>u.getProperty(m)!=null))}createArrays(){this.text=new q1(new O(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new q1(new O(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new vh,this.lineVertexArray=new Km,this.symbolInstances=new zc}calculateGlyphDependencies(e,r,l,u,m){for(const g of e){const b=g.codePointAt(0);if(b===void 0)break;if(r[b]=!0,u&&m&&b<=65535){const E=Z_[g];E&&(r[E.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,r,l,u,m,g,b){if(!e.hasProperty("icon-size"))return b*g;let E=1;const A=e.getUnevaluatedProperties()._values["icon-size"],N=ag(this.zoom,A,this.worldview,m),j=dy(N,r);if(N.kind!=="constant"&&N.kind!=="camera"||(E=j.uSize),N.kind==="composite"){const{minZoom:R,maxZoom:B}=N,V=A.possiblyEvaluate(new bi(R,{worldview:this.worldview}),u),H=A.possiblyEvaluate(new bi(B,{worldview:this.worldview}),u),Q=V.evaluate(l,{},u,m);E=Q+(H.evaluate(l,{},u,m)-Q)*j.uSizeT}return N.kind==="source"&&(E=A.possiblyEvaluate(new bi(this.zoom,{worldview:this.worldview}),u).evaluate(l,{},u,m)),E*g}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Zv(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?wa.build(e):e}populate(e,r,l,u){const m=this.layers[0],g=m.layout,b=this.projection.name==="globe",E=g.get("text-font"),A=g.get("text-field"),N=g.get("icon-image"),[j,R]=g.get("icon-size-scale-range"),B=Ee(r.scaleFactor||1,j,R),V=(A.value.kind!=="constant"||A.value.value instanceof Go&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),H=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,Q=this.hasAnyAppearanceProperty("icon-image"),K=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!V&&!H&&!Q)return;const re=r.iconDependencies,ae=r.glyphDependencies,ue=r.availableImages,xe=new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),ye=Ie=>{const Pe=Ie.id.toString();re.has(Pe)?re.get(Pe).push(Ie):re.set(Pe,[Ie])};for(const Ie of e){const{feature:Pe,id:Ae,index:je,sourceLayerIndex:Oe}=Ie,ht=m._featureFilter.needGeometry,at=tn(Pe,ht);if(!m._featureFilter.filter(xe,at,l))continue;if(ht||(at.geometry=Gr(Pe,l,u)),b&&Pe.type!==1&&l.z<=5){const kt=at.geometry,Tt=.98078528056,lr=(dr,Wt)=>Hr(A_(dr.x,dr.y,l,1),A_(Wt.x,Wt.y,l,1))<Tt;for(let dr=0;dr<kt.length;dr++)kt[dr]=fr(kt[dr],lr)}let lt,St;if(V){const kt=m.getValueAndResolveTokens("text-field",at,l,ue),Tt=Go.factory(kt);lV(Tt)&&(this.hasRTLText=!0),(!this.hasRTLText||kf()==="unavailable"||this.hasRTLText&&fl.isParsed())&&(lt=x5(Tt,m,at))}if(H){const kt=m.getValueAndResolveTokens("icon-image",at,l,ue);St=this.getResolvedImageFromTokens(kt)}const bt=this.layers[0];let wt=!1;if(!St&&Q){const kt=bt.getAppearances();for(const Tt of kt)if(Tt.getProperty("icon-image")){const lr=bt.getAppearanceValueAndResolveTokens(Tt,"icon-image",at,l,ue);if(lr){St=this.getResolvedImageFromTokens(lr),wt=!0;break}}}if(!lt&&!St)continue;const st=this.sortFeaturesByKey?K.evaluate(at,{},l):void 0,Et={id:Ae,text:lt,icon:St,index:je,sourceLayerIndex:Oe,geometry:at.geometry,properties:Pe.properties,type:oV[Pe.type],sortKey:st};if(this.features.push(Et),this.featureToAppearanceIndex[je]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Ae,properties:Pe.properties,usesAppearanceIconAsPlaceholder:wt,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),St){const kt=bt._unevaluatedLayout._values,{iconPrimary:Tt,iconSecondary:lr}=Q_(St,this.iconSizeData,kt["icon-size"],l,this.zoom,Et,this.pixelRatio,B,this.worldview,ue);ye(Tt),lr&&(this.hasAnySecondaryIcon=!0,ye(lr))}const gt=bt.getAppearances();if(gt.length!==0&&gt.forEach(kt=>{if(!kt.getProperty("icon-image"))return;const Tt=this.getCombinedIconPrimary(kt,bt,at,l,ue,Et,B);Tt&&ye(Tt)}),lt){const kt=E.evaluate(at,{},l).join(","),Tt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ql.vertical)>=0;for(const lr of lt.sections)if(lr.image){const dr=lr.image.getPrimary().scaleSelf(this.pixelRatio),Wt=dr.id.toString(),Yt=re.get(Wt)||[];Yt.push(dr),re.set(Wt,Yt)}else{const dr=dl(lt.toString()),Wt=lr.fontStack||kt,Yt=ae[Wt]=ae[Wt]||{};this.calculateGlyphDependencies(lr.text,Yt,Tt,this.allowVerticalPlacement,dr)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(Ie){const Pe={},Ae={},je=[];let Oe=0;function ht(bt){je.push(Ie[bt]),Oe++}function at(bt,wt,st){const Et=Ae[bt];return delete Ae[bt],Ae[wt]=Et,je[Et].geometry[0].pop(),je[Et].geometry[0]=je[Et].geometry[0].concat(st[0]),Et}function lt(bt,wt,st){const Et=Pe[wt];return delete Pe[wt],Pe[bt]=Et,je[Et].geometry[0].shift(),je[Et].geometry[0]=st[0].concat(je[Et].geometry[0]),Et}function St(bt,wt,st){const Et=st?wt[0][wt[0].length-1]:wt[0][0];return`${bt}:${Et.x}:${Et.y}`}for(let bt=0;bt<Ie.length;bt++){const wt=Ie[bt],st=wt.geometry,Et=wt.text?wt.text.toString():null;if(!Et){ht(bt);continue}const gt=St(Et,st),kt=St(Et,st,!0);if(gt in Ae&&kt in Pe&&Ae[gt]!==Pe[kt]){const Tt=lt(gt,kt,st),lr=at(gt,kt,je[Tt].geometry);delete Pe[gt],delete Ae[kt],Ae[St(Et,je[lr].geometry,!0)]=lr,je[Tt].geometry=null}else gt in Ae?at(gt,kt,st):kt in Pe?lt(gt,kt,st):(ht(bt),Pe[gt]=Oe-1,Ae[kt]=Oe-1)}return je.filter(bt=>bt.geometry)})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ie of r.elevationFeatures)this.elevationFeatureIdToIndex.set(Ie.id,this.elevationFeatures.length),this.elevationFeatures.push(Ie)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ie,Pe)=>Ie.sortKey-Pe.sortKey)}getCombinedIconPrimary(e,r,l,u,m,g,b){let E,A;const N=e.getUnevaluatedProperties();if(N._values["icon-image"].value!==void 0){const j=r.getAppearanceValueAndResolveTokens(e,"icon-image",l,u,m);E=this.getResolvedImageFromTokens(j)}else{const j=r.getValueAndResolveTokens("icon-image",l,u,m);E=this.getResolvedImageFromTokens(j)}if(E){const j=e.hasProperty("icon-size")?N._values["icon-size"]:r._unevaluatedLayout._values["icon-size"];A=Q_(E,ag(this.zoom,j,this.worldview,m),j,u,this.zoom,g,this.pixelRatio,b,this.worldview,m).iconPrimary}return A}updateSymbolInstanceIconVertices(e,r,l,u,m,g,b,E,A,N,j,R,B,V){if(e.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(r.activeAppearance===l)return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1};if(l){const H=this.getCombinedIconPrimary(l,A,u,g,b,{sortKey:void 0,text:void 0,icon:null,index:e.featureIndex,sourceLayerIndex:e.featureIndex,geometry:[],properties:r.properties,type:"Point",id:r.id},N);if(!H)return{vertexOffsetDelta:0,hasChanges:!1};const Q=H.toString(),K=this.iconAtlasPositions&&this.iconAtlasPositions.get(Q);if(K){const{appearanceIconOffset:re,appearanceIconRotate:ae}=UI(l,A,u,g,R,V,B,N);let ue=ub(K,void 0,re,A.layout.get("icon-anchor").evaluate(u,j,g));const xe=K.sdf,ye=A.layout.get("icon-text-fit").constantOr("none");ye!=="none"&&r.textShaping&&r.iconTextFitPadding&&r.fontScale&&(ue=M1(ue,r.textShaping,ye,r.iconTextFitPadding,re,r.fontScale));const Ie=this.calculateEffectiveAppearanceIconSize(l,E.zoom,u,g,b,N,B),Pe=0,Ae=1+(Math.min(lg,Math.round(Ie*$f))<<1),je=z1(ue,ae,xe,ye!=="none",N);r.isUsingAppearanceIconVertexData||(r.isUsingAppearanceIconVertexData=!0,r.layoutBasedIconVertexData=this.icon.getSymbolVertexData(m,e.numIconVertices));let Oe=m;for(let at=0;at<je.length;++at){const lt=je[at],St=r.layoutBasedIconVertexData[0]||e.tileAnchorX,bt=r.layoutBasedIconVertexData[1]||e.tileAnchorY,wt=16*lt.pixelOffsetTL.x,st=16*lt.pixelOffsetTL.y,Et=16*lt.pixelOffsetBR.x,gt=16*lt.pixelOffsetBR.y,kt=16*lt.minFontScaleX,Tt=16*lt.minFontScaleY;this.icon.updateSymbolVertexData(Oe,St,bt,Math.round(32*lt.tl.x),Math.round(32*lt.tl.y),lt.texPrimary.x,lt.texPrimary.y,Pe,Ae,wt,st,kt,Tt),this.icon.updateSymbolVertexData(Oe+1,St,bt,Math.round(32*lt.tr.x),Math.round(32*lt.tr.y),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y,Pe,Ae,Et,st,kt,Tt),this.icon.updateSymbolVertexData(Oe+2,St,bt,Math.round(32*lt.bl.x),Math.round(32*lt.bl.y),lt.texPrimary.x,lt.texPrimary.y+lt.texPrimary.h,Pe,Ae,wt,gt,kt,Tt),this.icon.updateSymbolVertexData(Oe+3,St,bt,Math.round(32*lt.br.x),Math.round(32*lt.br.y),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y+lt.texPrimary.h,Pe,Ae,Et,gt,kt,Tt),Oe+=4}const ht=e.numIconVertices-4*je.length;for(let at=0;at<ht;++at)this.icon.updateSymbolVertexData(Oe+at,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}}else if(r.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(m,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(m+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}else if(r.isUsingAppearanceIconVertexData){const Q=r.layoutBasedIconVertexData.length/12;for(let K=0;K<Q;++K){const re=K*12;this.icon.updateSymbolVertexData(m+K,r.layoutBasedIconVertexData[re+0],r.layoutBasedIconVertexData[re+1],r.layoutBasedIconVertexData[re+2],r.layoutBasedIconVertexData[re+3],r.layoutBasedIconVertexData[re+4],r.layoutBasedIconVertexData[re+5],r.layoutBasedIconVertexData[re+6],r.layoutBasedIconVertexData[re+7],r.layoutBasedIconVertexData[re+8],r.layoutBasedIconVertexData[re+9],r.layoutBasedIconVertexData[re+10],r.layoutBasedIconVertexData[re+11])}return r.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:Q,hasChanges:!0}}return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re){const ae=e.numHorizontalGlyphVertices>0||e.numVerticalGlyphVertices>0;if(!ae)return{vertexOffsetDelta:ae?e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices:0,hasChanges:!1};if(r.activeAppearance===l)return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1};if(l&&r.textShaping){const{appearanceTextOffset:ue,appearanceTextRotate:xe,appearanceTextSize:ye}=$I(l,b,u,g,j,B,R);r.fontScale=HI(ye,r.textScaleFactor);const Ie=l.getUnevaluatedProperty("text-size");let Pe=this.textSizeData,Ae=Q,je=K;l.hasProperty("text-size")&&(Pe=ag(this.zoom,Ie,this.worldview,re),Ae=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,je=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Oe=r.textShaping.bottom-j[1],ht=r.textShaping.left-j[0],at=r.textShaping.right-j[0];r.textShaping.top=ue[1]+(r.textShaping.top-j[1]),r.textShaping.bottom=ue[1]+Oe,r.textShaping.left=ue[0]+ht,r.textShaping.right=ue[0]+at;const lt=BI(0,r.textShaping,ue,b,!1,u,A,this.allowVerticalPlacement,xe),St=ye&&Pe.kind==="composite"?Ie.possiblyEvaluate(new bi(Ae,{}),g).evaluate(u,N,g):V,bt=ye&&Pe.kind==="composite"?Ie.possiblyEvaluate(new bi(je,{}),g).evaluate(u,N,g):H,wt=U1(l.name,Pe,ye,E,St,bt),st=Array.isArray(wt)?wt[1]:ye,Et=0,gt=1+(Math.min(lg,Math.round(st*$f))<<1);r.isUsingAppearanceTextVertexData||(r.isUsingAppearanceTextVertexData=!0,r.layoutBasedTextVertexData=this.text.getSymbolVertexData(m,e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices));for(let kt=0;kt<lt.length&&kt<(e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices)/4;++kt){const Tt=lt[kt],lr=Tt.glyphOffset[1],dr=e.tileAnchorX,Wt=e.tileAnchorY,Yt=m+4*kt;this.text.updateSymbolVertexData(Yt,dr,Wt,Math.round(32*Tt.tl.x),Math.round(32*(lr+Tt.tl.y)),Tt.texPrimary.x,Tt.texPrimary.y,Et,gt,Tt.pixelOffsetTL.x,Tt.pixelOffsetTL.y,Tt.minFontScaleX,Tt.minFontScaleY),this.text.updateSymbolVertexData(Yt+1,dr,Wt,Math.round(32*Tt.tr.x),Math.round(32*(lr+Tt.tr.y)),Tt.texPrimary.x+Tt.texPrimary.w,Tt.texPrimary.y,Et,gt,Tt.pixelOffsetBR.x,Tt.pixelOffsetTL.y,Tt.minFontScaleX,Tt.minFontScaleY),this.text.updateSymbolVertexData(Yt+2,dr,Wt,Math.round(32*Tt.bl.x),Math.round(32*(lr+Tt.bl.y)),Tt.texPrimary.x,Tt.texPrimary.y+Tt.texPrimary.h,Et,gt,Tt.pixelOffsetTL.x,Tt.pixelOffsetBR.y,Tt.minFontScaleX,Tt.minFontScaleY),this.text.updateSymbolVertexData(Yt+3,dr,Wt,Math.round(32*Tt.br.x),Math.round(32*(lr+Tt.br.y)),Tt.texPrimary.x+Tt.texPrimary.w,Tt.texPrimary.y+Tt.texPrimary.h,Et,gt,Tt.pixelOffsetBR.x,Tt.pixelOffsetBR.y,Tt.minFontScaleX,Tt.minFontScaleY)}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!0}}if(r.isUsingAppearanceTextVertexData){const xe=r.layoutBasedTextVertexData.length/12;for(let ye=0;ye<xe;++ye){const Ie=ye*12;this.text.updateSymbolVertexData(m+ye,r.layoutBasedTextVertexData[Ie+0],r.layoutBasedTextVertexData[Ie+1],r.layoutBasedTextVertexData[Ie+2],r.layoutBasedTextVertexData[Ie+3],r.layoutBasedTextVertexData[Ie+4],r.layoutBasedTextVertexData[Ie+5],r.layoutBasedTextVertexData[Ie+6],r.layoutBasedTextVertexData[Ie+7],r.layoutBasedTextVertexData[Ie+8],r.layoutBasedTextVertexData[Ie+9],r.layoutBasedTextVertexData[Ie+10],r.layoutBasedTextVertexData[Ie+11])}return r.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:xe,hasChanges:!0}}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1}}update(e,r,l,u,m,g,b){this.text.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,r,m,l,u,g,b,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const l=Dt(e),u=1/l;let m=!1,g=!1;for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b),A=Ut(1,0,0),N=Ut(0,1,0),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:R,numIconVertices:B,numVerticalIconVertices:V}=E,H=j>0||R>0,Q=B>0,K=this.elevationFeatures[E.elevationFeatureIndex];if(K){const re=new Nt(E.tileAnchorX,E.tileAnchorY),ae=.075+K.pointElevation(re);E.zOffset!==ae&&(r=!0,E.zOffset=ae),ae!==0&&(this.hasAnyZOffset=!0);const ue=K.computeSlopeNormal(re,u),xe=Ln(Or(),Ut(0,0,1),ue);At(A,A,xe),At(N,N,xe),A[2]*=l,N[2]*=l,A[0]===1&&A[1]===0&&A[2]===0&&N[0]===0&&N[1]===1&&N[2]===0||(m=m||H,g=g||Q)}if(H&&(xb(this.text.orientationVertexArray,j,A,N),xb(this.text.orientationVertexArray,R,A,N)),Q){const{placedIconSymbolIndex:re,verticalPlacedIconSymbolIndex:ae}=E;re>=0&&xb(this.icon.orientationVertexArray,B,A,N),ae>=0&&xb(this.icon.orientationVertexArray,V,A,N)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,g,b)=>{l+=g,l>m.length&&m.resize(l);for(let E=-g;E<0;E++)m.emplace(E+l,b)},r=(m,g,b)=>{u+=g,u>m.length&&m.resize(u);for(let E=-g;E<0;E++)m.emplace(E+u,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:E,numIconVertices:A}=g,N=g.zOffset,j=A>0;if((b>0||E>0)&&(e(this.text.zOffsetVertexArray,b,N),e(this.text.zOffsetVertexArray,E,N)),j){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:B}=g;R>=0&&r(this.icon.zOffsetVertexArray,A,N),B>=0&&r(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,N)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,r,l,u,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,r,l,u,m){if(!(e&&r&&l&&this.appearanceFeatureData))return!1;const g=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,b=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!g&&!b)return!1;const E=this.layers[0],A=E.layout;let N=1,j=0,R=!1;if(g){const[K,re]=A.get("icon-size-scale-range");N=Ee(1,K,re)}let B=1,V=0,H=!1;if(b){const[K,re]=A.get("text-size-scale-range");B=Ee(1,K,re)}const Q=new Map;if(m&&l)for(const K of l){const re=m.getImage(K,E.scope);if(re){const ae=new ba(K.toString());Q.set(ae.toString(),re)}}for(let K=0;K<this.symbolInstances.length;K++){const re=this.symbolInstances.get(K),ae=this.featureToAppearanceIndex[re.featureIndex],ue=ae!==void 0?this.appearanceFeatureData[ae]:void 0;if(!ue)continue;const xe=ue.id,ye=r&&xe!==void 0?r[String(xe)]:void 0,Ie={type:"Point",id:ue.id,properties:ue.properties,geometry:[]},Pe=E.appearances&&E.appearances.find(Ae=>Ae.isActive({globals:u,feature:Ie,canonical:e,featureState:ye}));if(b){const Ae=A.get("text-size"),je=A.get("text-offset").evaluate(Ie,ye,e),Oe=Ae.evaluate(Ie,ye,e),ht=A.get("text-rotate").evaluate(Ie,ye,e),at=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,lt=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,St=Ae.evaluate(Ie,{zoom:at},e),bt=Ae.evaluate(Ie,{zoom:lt},e),wt=this.updateSymbolInstanceTextVertices(re,ue,Pe,Ie,V,e,E,B,Q,ye,je,Oe,ht,St,bt,at,lt,l);V+=wt.vertexOffsetDelta,H=H||wt.hasChanges}if(g){const Ae=A.get("icon-offset").evaluate(Ie,ye,e),je=A.get("icon-size").evaluate(Ie,ye,e,l),Oe=A.get("icon-rotate").evaluate(Ie,ye,e),ht=this.updateSymbolInstanceIconVertices(re,ue,Pe,Ie,j,e,l,u,E,N,ye,Ae,je,Oe);j+=ht.vertexOffsetDelta,R=R||ht.hasChanges}ue.activeAppearance=Pe}return R&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),H&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),R||H}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:m}of r)this.lineVertexArray.emplaceBack(u,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,u,m,g,b,E,A,N,j,R,B,V,H,Q,K,re){const ae=e.indexArray,ue=e.layoutVertexArray,xe=e.globeExtVertexArray,ye=e.segments.prepareSegment(4*re,ue,ae,this.canOverlap?g.sortKey:void 0),Ie=this.glyphOffsetArray.length,Pe=ye.vertexLength,Ae=this.allowVerticalPlacement&&b===ql.vertical?Math.PI/2:0,je=g.text&&g.text.sections;for(let at=0;at<r.length;at++){const{tl:lt,tr:St,bl:bt,br:wt,texPrimary:st,texSecondary:Et,pixelOffsetTL:gt,pixelOffsetBR:kt,minFontScaleX:Tt,minFontScaleY:lr,glyphOffset:dr,isSDF:Wt,sectionIndex:Yt}=r[at],Fr=ye.vertexLength,wr=dr[1];if(ix(ue,A.x,A.y,lt.x,wr+lt.y,st.x,st.y,l,Wt,gt.x,gt.y,Tt,lr),ix(ue,A.x,A.y,St.x,wr+St.y,st.x+st.w,st.y,l,Wt,kt.x,gt.y,Tt,lr),ix(ue,A.x,A.y,bt.x,wr+bt.y,st.x,st.y+st.h,l,Wt,gt.x,kt.y,Tt,lr),ix(ue,A.x,A.y,wt.x,wr+wt.y,st.x+st.w,st.y+st.h,l,Wt,kt.x,kt.y,Tt,lr),E){const{x:nr,y:en,z:kn}=E.anchor,[li,En,Ai]=E.up;ox(xe,nr,en,kn,li,En,Ai),ox(xe,nr,en,kn,li,En,Ai),ox(xe,nr,en,kn,li,En,Ai),ox(xe,nr,en,kn,li,En,Ai),my(e.dynamicLayoutVertexArray,nr,en,kn,Ae)}else my(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Ae);if(Q){const nr=Et||st;sx(e.iconTransitioningVertexArray,nr.x,nr.y),sx(e.iconTransitioningVertexArray,nr.x+nr.w,nr.y),sx(e.iconTransitioningVertexArray,nr.x,nr.y+nr.h),sx(e.iconTransitioningVertexArray,nr.x+nr.w,nr.y+nr.h)}ae.emplaceBack(Fr,Fr+1,Fr+2),ae.emplaceBack(Fr+1,Fr+2,Fr+3),ye.vertexLength+=4,ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dr[0]),at!==r.length-1&&Yt===r[at+1].sectionIndex||e.programConfigurations.populatePaintArrays(ue.length,g,g.index,{},B,V,H,je&&je[Yt],this.worldview)}const Oe=re-r.length;Oe!==0&&this._addNullVertices(Oe,ue,l,E,xe,e,Q,ye,ae);const ht=E?E.anchor:A;e.placedSymbolArray.emplaceBack(ht.x,ht.y,ht.z,A.x,A.y,Ie,this.glyphOffsetArray.length-Ie,Pe,N,j,A.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],b,0,0,0,R,0),e.symbolInstanceIndices.push(K)}_addNullVertices(e,r,l,u,m,g,b,E,A){for(let N=0;N<e;N++){for(let R=0;R<4;R++)ix(r,0,0,0,0,0,0,l,!1,0,0,0,0),u&&ox(m,0,0,0,0,0,0),my(g.dynamicLayoutVertexArray,0,0,0,0),b&&sx(g.iconTransitioningVertexArray,0,0);const j=E.vertexLength;A.emplaceBack(j,j+1,j+2),A.emplaceBack(j+1,j+2,j+3),E.vertexLength+=4,E.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,r,l,u,m,g,b){e.emplaceBack(r,l,u,m,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,r,l,u,m,g,b){const E=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),A=E.vertexLength,N=b.tileAnchorX,j=b.tileAnchorY;for(let B=0;B<4;B++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,r,e.padding,b.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,m,g,N,j,new Nt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,m,g,N,j,new Nt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,m,g,N,j,new Nt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,m,g,N,j,new Nt(e.x1,e.y2)),E.vertexLength+=4;const R=l.indexArray;R.emplaceBack(A,A+1),R.emplaceBack(A+1,A+2),R.emplaceBack(A+2,A+3),R.emplaceBack(A+3,A),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,l,u,m,g){for(let b=u;b<m;b++){const E=l.get(b),A=this.getSymbolInstanceTextSize(e,g,r,b);this._addCollisionDebugVertices(E,A,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,r,l,u,m,g){for(let b=u;b<m;b++){const E=l.get(b),A=this.getSymbolInstanceIconSize(e,r,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,A,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new G1(Lf,gI.members,Aa),this.iconCollisionBox=new G1(Lf,gI.members,Aa);const u=dy(this.iconSizeData,e),m=dy(this.textSizeData,e,l);for(let g=0;g<this.symbolInstances.length;g++){const b=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,e,r,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(m,e,r,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(u,e,r,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(u,e,r,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(e,r,l,u){const m=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),g=L1(this.textSizeData,e,m)/So;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,r,l){const u=this.icon.placedSymbolArray.get(l),m=L1(this.iconSizeData,e,u);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,r,l,u){e.emplaceBack(r,-l,-l,u),e.emplaceBack(r,l,-l,u),e.emplaceBack(r,l,l,u),e.emplaceBack(r,-l,l,u)}_updateTextDebugCollisionBoxes(e,r,l,u,m,g,b){for(let E=u;E<m;E++){const A=l.get(E),N=this.getSymbolInstanceTextSize(e,g,r,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,N,A.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,r,l,u,m,g,b){for(let E=u;E<m;E++){const A=l.get(E),N=this.getSymbolInstanceIconSize(e,r,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,A.padding,g.zOffset)}}updateCollisionDebugBuffers(e,r,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=dy(this.iconSizeData,e,u),g=dy(this.textSizeData,e,l);for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(g,e,r,E.textBoxStartIndex,E.textBoxEndIndex,E,l),this._updateTextDebugCollisionBoxes(g,e,r,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,l),this._updateIconDebugCollisionBoxes(m,e,r,E.iconBoxStartIndex,E.iconBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(m,e,r,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,l,u,m,g,b,E,A){const N={};if(r<l){const{x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue,featureIndex:xe}=e.get(r);N.textBox={x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue},N.textFeatureIndex=xe}if(u<m){const{x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue,featureIndex:xe}=e.get(u);N.verticalTextBox={x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue},N.verticalTextFeatureIndex=xe}if(g<b){const{x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue,featureIndex:xe}=e.get(g);N.iconBox={x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue},N.iconFeatureIndex=xe}if(E<A){const{x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue,featureIndex:xe}=e.get(E);N.verticalIconBox={x1:j,y1:R,x2:B,y2:V,padding:H,projectedAnchorX:Q,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:ae,tileAnchorY:ue},N.verticalIconFeatureIndex=xe}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),u=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<u;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),u=[],m=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const E=this.symbolInstances.get(b);u.push(0|Math.round(r*E.tileAnchorX+l*E.tileAnchorY)),m.push(E.featureIndex)}return g.sort((b,E)=>u[b]-u[E]||m[E]-m[b]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:A}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const r=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let l;return this.elevationFeatures&&r<this.elevationFeatures.length&&(l=this.elevationFeatures[r]),l}}function rP(o,e){return e.replace(/{([^{}]+)}/g,(r,l)=>l in o?String(o[l]):"")}let nP,iP,W1;hr(vb,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),vb.addDynamicAttributes=my;class sP{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:va,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hr(sP,"FormatSectionOverride",{omit:["defaultValue"]});const H1=()=>W1||(W1={layout:nP||(nP=new is({"symbol-placement":new zt(He.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new er(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(He.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new zt(He.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new zt(He.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new zt(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new zt(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new er(He.layout_symbol["icon-size"]),"icon-size-scale-range":new zt(He.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new er(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new er(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new er(He.layout_symbol["icon-image"]),"icon-image-use-theme":new zt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new er(He.layout_symbol["icon-rotate"]),"icon-padding":new zt(He.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(He.layout_symbol["icon-keep-upright"]),"icon-offset":new er(He.layout_symbol["icon-offset"]),"icon-anchor":new er(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(He.layout_symbol["text-rotation-alignment"]),"text-field":new er(He.layout_symbol["text-field"]),"text-font":new er(He.layout_symbol["text-font"]),"text-size":new er(He.layout_symbol["text-size"]),"text-size-scale-range":new zt(He.layout_symbol["text-size-scale-range"]),"text-max-width":new er(He.layout_symbol["text-max-width"]),"text-line-height":new er(He.layout_symbol["text-line-height"]),"text-letter-spacing":new er(He.layout_symbol["text-letter-spacing"]),"text-justify":new er(He.layout_symbol["text-justify"]),"text-radial-offset":new er(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(He.layout_symbol["text-variable-anchor"]),"text-anchor":new er(He.layout_symbol["text-anchor"]),"text-max-angle":new zt(He.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(He.layout_symbol["text-writing-mode"]),"text-rotate":new er(He.layout_symbol["text-rotate"]),"text-padding":new zt(He.layout_symbol["text-padding"]),"text-keep-upright":new zt(He.layout_symbol["text-keep-upright"]),"text-transform":new er(He.layout_symbol["text-transform"]),"text-offset":new er(He.layout_symbol["text-offset"]),"text-allow-overlap":new zt(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new zt(He.layout_symbol["text-ignore-placement"]),"text-optional":new zt(He.layout_symbol["text-optional"]),visibility:new zt(He.layout_symbol.visibility)})),paint:iP||(iP=new is({"icon-opacity":new er(He.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new er(He.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new er(He.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new er(He.paint_symbol["text-emissive-strength"]),"icon-color":new er(He.paint_symbol["icon-color"]),"icon-halo-color":new er(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new er(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new er(He.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(He.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new zt(He.paint_symbol["icon-image-cross-fade"]),"text-opacity":new er(He.paint_symbol["text-opacity"]),"text-occlusion-opacity":new er(He.paint_symbol["text-occlusion-opacity"]),"text-color":new er(He.paint_symbol["text-color"],{runtimeType:sa,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new er(He.paint_symbol["text-halo-color"]),"text-halo-width":new er(He.paint_symbol["text-halo-width"]),"text-halo-blur":new er(He.paint_symbol["text-halo-blur"]),"text-translate":new zt(He.paint_symbol["text-translate"]),"text-translate-anchor":new zt(He.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new zt(He.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new zt(He.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new zt(He.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new zt(He.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new er(He.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},W1);class bb extends Xo{constructor(e,r,l,u){super(e,H1(),r,l,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=oe([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,r){super.recalculate(e,r),this.appearances&&this.appearances.forEach(u=>{u.recalculate(e,r,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const m of l)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,l,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=(function(m,g,b,E){m=js(m),g=Oi(g);const A=he(),N=m/3,j=1-2*N,R=[j,N,N,0,N,j,N,0,N,N,j,0,0,0,0,1],B=.5-.5*g,V=E-b;return me(A,[V,0,0,0,0,V,0,0,0,0,V,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,B,B,B,1]),me(A,A,R),A})(e,r,l,u),this._saturation=e,this._contrast=r,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,l,u){const m=this.layout.get(e).evaluate(r,{},l,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||td(g.value)||!m?m:rP(r.properties,m)}getAppearanceValueAndResolveTokens(e,r,l,u,m){const g=e.getProperty(r);if(!g)return;const b=g.evaluate(l,{},u,m),E=e.getUnevaluatedProperties()._values[r];return E.isDataDriven()||td(E.value)||!b||typeof b!="string"?b:rP(l.properties,b)}createBucket(e){return new vb(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of H1().paint.overridableProperties){if(!bb.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new sP(r),u=new ah(l,r.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new la("source",u):new Ja("composite",u,r.value.zoomStops,r.value.interpolationType),this.paint._values[e]=new gu(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&bb.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),u=H1().paint.properties[r];let m=!1;const g=b=>{for(const E of b)if(u.overrides&&u.overrides.hasOverride(E))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Go)g(l.value.value.sections);else if(l.value.kind==="source"){const b=A=>{m||(A instanceof rc&&Bs(A.value)===Od?g(A.value.sections):A instanceof _r?g(A.sections):A.eachChild(b))},E=l.value;E._styleExpression&&b(E._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,l){return{config:new D(this,{zoom:r,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let oP,aP,lP,cP;var Z1=Tn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function wb(o,e,r,l,u,m,g,b){const E=[o,e,1,r,l,1,u,m,1],A=[g,b,1],N=X([],E),[j,R,B]=Ci(A,A,N);return ee(E,E,[j,0,0,0,R,0,0,0,B])}function uP(o,e,r,l,u,m,g,b){const E=(function(A,N,j,R,B,V,H,Q){const K=wb(0,0,1,0,1,1,0,1),re=wb(A,N,j,R,B,V,H,Q);return ee(re,re,X([],K))})(o,e,r,l,u,m,g,b);return[E[2]/E[8]/qt,E[5]/E[8]/qt]}function Sb(o){return[o[0],Math.min(Math.max(o[1],-85.051129),Le)]}class dP extends Xs{constructor(e,r,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new tc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=op(this.map._requestManager.transformRequest(this.url,qo.Image),(l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new nu(l)):u&&(this.image=u instanceof HTMLImageElement?Vn.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new G_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new tc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof G_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],l=e[0][1];for(const m of e)m[1]>l&&(l=m[1]),m[1]<r&&(r=m[1]);const u=(l+r)/2;if(u>Le?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(Kt.fromLngLat);this.tileID=(function(g){let b=1/0,E=1/0,A=-1/0,N=-1/0;for(const H of g)b=Math.min(b,H.x),E=Math.min(E,H.y),A=Math.max(A,H.x),N=Math.max(N,H.y);const j=Math.max(A-b,N-E),R=Math.max(0,Math.floor(-Math.log2(j))),B=Math.pow(2,R);let V=Math.floor((b+A)/2*B);return V>1&&(V-=1),new Xn(R,V,Math.floor((E+N)/2*B))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new tc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof G_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const re=this.tiles[K];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=J_(new Xn(0,0,0),this.map.transform.projection),l=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(K){const re=K[1].x-K[0].x,ae=K[1].y-K[0].y,ue=K[2].x-K[1].x,xe=K[2].y-K[1].y,ye=K[3].x-K[2].x,Ie=K[3].y-K[2].y,Pe=K[0].x-K[3].x,Ae=K[0].y-K[3].y,je=re*xe-ue*ae,Oe=ue*Ie-ye*xe,ht=ye*Ae-Pe*Ie,at=Pe*ae-re*Ae;return je>0&&Oe>0&&ht>0&&at>0||je<0&&Oe<0&&ht<0&&at<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=J_(this.tileID,this.map.transform.projection),[m,g,b,E]=this.coordinates.map(K=>{const re=u.projection.project(K[0],K[1]);return KI(u,re)._round()});this.perspectiveTransform=uP(m.x,m.y,g.x,g.y,b.x,b.y,E.x,E.y);const A=this._boundsArray=new gc;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(g.x,g.y,qt,0),A.emplaceBack(E.x,E.y,0,qt),A.emplaceBack(b.x,b.y,qt,qt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,Z1.members),this.boundsSegments=Zi.simpleSegment(0,0,4,2);const N=[],j=[Sb((R=this.coordinates)[0]),Sb(R[1]),Sb(R[2]),Sb(R[3])];var R;const[B,V,H,Q]=(function(K){let re=K[0][0],ae=re,ue=K[0][1],xe=ue;for(let ye=1;ye<K.length;ye++)K[ye][0]<re?re=K[ye][0]:K[ye][0]>ae&&(ae=K[ye][0]),K[ye][1]<ue?ue=K[ye][1]:K[ye][1]>xe&&(xe=K[ye][1]);return[re,ue,ae-re,xe-ue]})(j);{const K=new gc,[re,ae,ue,xe]=(function(wt){let st=wt[0].x,Et=st,gt=wt[0].y,kt=gt;for(let Tt=1;Tt<wt.length;Tt++)wt[Tt].x<st?st=wt[Tt].x:wt[Tt].x>Et&&(Et=wt[Tt].x),wt[Tt].y<gt?gt=wt[Tt].y:wt[Tt].y>kt&&(kt=wt[Tt].y);return[st,gt,Et-st,kt-gt]})(l),ye=wt=>[(wt.x-re)/ue,(wt.y-ae)/xe],[Ie,Pe,Ae,je]=l.map(ye),Oe=(function(wt,st,Et,gt,kt,Tt,lr,dr){const Wt=wb(0,0,1,0,1,1,0,1);return ee(Wt,Wt,X([],wb(wt,st,Et,gt,kt,Tt,lr,dr)))})(Ie[0],Ie[1],Pe[0],Pe[1],Ae[0],Ae[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=uP(Ie[0],Ie[1],Pe[0],Pe[1],Ae[0],Ae[1],je[0],je[1]);const ht=(wt,st)=>{N.push(wt.lng);const Et=Math.round((wt.lng-B)/H*qt),gt=Math.round((wt.lat-V)/Q*qt),kt=ye(st),Tt=Ci([],[kt[0],kt[1],1],Oe),lr=Math.round(Tt[0]/Tt[2]*qt),dr=Math.round(Tt[1]/Tt[2]*qt);K.emplaceBack(Et,gt,lr,dr)},at=l[3].x-l[0].x,lt=l[3].y-l[0].y,St=l[2].x-l[1].x,bt=l[2].y-l[1].y;for(let wt=0;wt<65;wt++){const st=wt/64,Et=[l[0].x+st*at,l[0].y+st*lt],gt=[l[1].x+st*St,l[1].y+st*bt],kt=gt[0]-Et[0],Tt=gt[1]-Et[1];for(let lr=0;lr<65;lr++){const dr=lr/64,Wt={x:Et[0]+kt*dr,y:Et[1]+Tt*dr};ht(r.projection.unproject(Wt.x,Wt.y),Wt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,Z1.members)}{this.maxLongitudeTriangleSize=0;let K=[],re=new Os;const ae=(ue,xe,ye)=>{re.emplaceBack(ue,xe,ye);const Ie=N[ue],Pe=N[xe],Ae=N[ye],je=Math.min(Math.min(Ie,Pe),Ae),Oe=Math.max(Math.max(Ie,Pe),Ae)-je;Oe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Oe),K.push(je+Oe/2)};for(let ue=0;ue<64;ue++)for(let xe=0;xe<64;xe++){const ye=65*ue+xe,Ie=ye+1,Pe=ye+65,Ae=Pe+1;ae(ye,Pe,Ie),ae(Ie,Pe,Ae)}[K,re]=(function(ue,xe){const ye=Array.from({length:ue.length},(Ae,je)=>je);ye.sort((Ae,je)=>ue[Ae]-ue[je]);const Ie=[],Pe=new Os;for(let Ae=0;Ae<ye.length;Ae++){const je=ye[Ae];Ie.push(ue[je]);const Oe=3*je,ht=Oe+1;Pe.emplaceBack(xe.uint16[Oe],xe.uint16[ht],xe.uint16[ht+1])}return[Ie,Pe]})(K,re),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(re)}this.elevatedGlobeSegments=Zi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,H/qt,0,Q/qt,0,0,V,B,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,l=r.gl;!this._dirty||this.texture instanceof G_||(this.texture?this.texture.update(this.image):(this.texture=new _1(r,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(m=e+180)+360*Math.round((l[0]-m)/360);var m;const g=new Zi,b=(j,R)=>{g.segments.push({vertexOffset:0,primitiveOffset:j,vertexLength:r.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=E){const j=di(l,0,l.length,u+E);return j===l.length||b(j,In(l,j+1,l.length,u+360-E)-j),g}u<l[0]&&(u+=360);const A=In(l,0,l.length,u-E);if(A===l.length)return b(0,l.length),g;b(0,A-0);const N=di(l,A+1,l.length,u+E);return N!==l.length&&b(N,l.length-N),g}}const X1=1024,cV=(Math.pow(X1,2)-1)/268170240;class hP extends Xo{constructor(e,r,l,u){super(e,{layout:lP||(lP=new is({visibility:new zt(He.layout_raster.visibility)})),paint:cP||(cP=new is({"raster-opacity":new zt(He.paint_raster["raster-opacity"]),"raster-color":new ad(He.paint_raster["raster-color"]),"raster-color-mix":new zt(He.paint_raster["raster-color-mix"]),"raster-color-range":new zt(He.paint_raster["raster-color-range"]),"raster-hue-rotate":new zt(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(He.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(He.paint_raster["raster-saturation"]),"raster-contrast":new zt(He.paint_raster["raster-contrast"]),"raster-resampling":new zt(He.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(He.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new zt(He.paint_raster["raster-emissive-strength"]),"raster-array-band":new zt(He.paint_raster["raster-array-band"]),"raster-elevation":new zt(He.paint_raster["raster-elevation"]),"raster-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof dP&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=I_({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:X1}),this.colorRampTexture=null,this._curRampRange=[l,u])}is3D(e){return this.paint.get("raster-elevation")>0}}let fP,pP,mP,gP,yP;class _P extends Xo{constructor(e,r,l,u){super(e,{layout:fP||(fP=new is({visibility:new zt(He["layout_raster-particle"].visibility)})),paint:pP||(pP=new is({"raster-particle-array-band":new zt(He["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new zt(He["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ad(He["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new zt(He["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new zt(He["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new zt(He["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new zt(He["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new zt(He["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._updateColorRamp(),this.lastInvalidatedAt=Vn.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=I_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Vn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class uV extends Xo{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function K1(o,e,r){const l=[0,0,1],u=sn([]);return Gi(u,u,r?-vn(o)+Math.PI:vn(o)),Mn(u,u,-vn(e)),At(l,l,u),ir(l,l)}const xP={None:0,Model:1,Symbol:2,FillExtrusion:4};class Tb{constructor(e,r,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function Y1(o,e){const r=o.indexOf("://")===-1;try{return new URL(o,r&&e?"http://example.com":void 0),!0}catch{return!1}}class vP{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class bP{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new xh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const r=16*e,l=this.instancedDataArray.float32;let u=Math.floor(l[r+2]);const m=1.05*(l[r+2]-u);return u/=100,[l[r]%1*1.05,l[r+1]%1*1.05,m,u]}tileCoordinatesForInstance(e){const r=16*e,l=this.instancedDataArray.float32;let u=l[r+0];return u=u>qt?u-qt:u,new Nt(Math.trunc(u),Math.trunc(l[r+1]))}translationForInstance(e){const r=16*e,l=this.instancedDataArray.float32;return[l[r+4],l[r+5],l[r+6]]}rotationScaleForInstance(e){const r=16*e,l=this.instancedDataArray.float32;return[l[r+7],l[r+8],l[r+9],l[r+10],l[r+11],l[r+12],l[r+13],l[r+14],l[r+15]]}transformForInstance(e){const r=16*e,l=this.instancedDataArray.float32;return[l[r+7],l[r+8],l[r+9],l[r+4],l[r+10],l[r+11],l[r+12],l[r+5],l[r+13],l[r+14],l[r+15],l[r+6],0,0,0,1]}}class Q1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,u){}populate(e,r,l,u){this.tileToMeter=Dt(l);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const g=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?r.elevationFeatures:void 0;for(const{feature:b,id:E,index:A,sourceLayerIndex:N}of e){const j=E??(b.properties&&b.properties.hasOwnProperty("id")?b.properties.id:void 0),R=tn(b,m);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),R,l))continue;const B={id:j,sourceLayerIndex:N,index:A,geometry:m?R.geometry:Gr(b,l,u),properties:b.properties,type:b.type,patterns:{}},V=this.addFeature(B,B.geometry,R,g,l);V&&r.featureIndex.insert(b,B.geometry,A,N,this.index,this.instancesPerModel[V].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,r=this.layers[0].scope;let l=0;for(const u of this.modelUris){const m=e.getModel(u,r);if(!m)continue;const g=this.instancesPerModel[u];if(g){const b=.5*yn(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,E=Math.min(qt,Math.max(b/this.tileToMeter,256));l=Math.max(E,l)}}return l}update(e,r,l,u){for(const m in this.instancesPerModel){const g=this.instancesPerModel[m];for(const b in e)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],e[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];for(const u of l.features){const m=this.layers[0],g=u.feature,b=this.canonical,E=m.paint.get("model-rotation").evaluate(g,{},b),A=m.paint.get("model-scale").evaluate(g,{},b),N=m.paint.get("model-translation").evaluate(g,{},b);Sr(u.rotation,E)&&Sr(u.scale,A)&&Sr(u.translation,N)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,r,l,u){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const m=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Zv(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(const b in this.instancesPerModel){const E=this.instancesPerModel[b],A=E.instancedDataArray;for(const N of E.features){const j=N.instancedDataOffset,R=N.instancedDataCount;for(let B=0;B<R;B++){const V=16*(B+j);let H=A.float32[V+0];const Q=H>qt;H=Q?H-qt:H;const K=Math.floor(H),re=Math.floor(A.float32[V+1]);let ae=!1;for(const ue of this.activeReplacements)if(!eA(ue,l,xP.Model,u)&&!(ue.min.x>K||K>ue.max.x||ue.min.y>re||re>ue.max.y)&&(ae=sA(iA(K,re,e.canonical,ue.footprintTileId.canonical),ue.footprint),ae))break;A.float32[V]=ae?H+qt:H,g=g||ae!==Q}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,j4.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(e&&r&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)r.removeModel(l,"",!0)}addFeature(e,r,l,u,m){const g=this.layers[0],b=g.layout.get("model-id"),E=g.layout.get("model-allow-density-reduction"),A=b.evaluate(l,{},this.canonical);if(!A)return Rr(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),A;(Y1(A,!1)||this.styleDefinedModelURLs[A]!==void 0)&&(this.modelUris.includes(A)||this.modelUris.push(A)),this.instancesPerModel[A]||(this.instancesPerModel[A]=new bP);const N=this.instancesPerModel[A],j=N.instancedDataArray,R=new vP(l,j.length);let B;u&&(B=pa.getElevationFeature(e,u));for(const V of r)for(const H of V){if(H.x<0||H.x>=qt||H.y<0||H.y>=qt)continue;if(this.lookupDim!==0&&E){const K=(this.lookupDim-1)/qt,re=this.lookupDim*(H.y*K|0)+H.x*K|0;if(this.lookup){if(this.lookup[re]!==0)continue;this.lookup[re]=1}}this.instanceCount++;const Q=j.length;if(j.resize(Q+1),u){N.instancesRoadElevation||(N.instancesRoadElevation=[]);const K=B?B.pointElevation(new Nt(H.x,H.y)):0;N.instancesRoadElevation.push(K)}N.instancesEvaluatedElevation.push(0),j.float32[16*Q]=H.x,j.float32[16*Q+1]=H.y}return R.instancedDataCount=N.instancedDataArray.length-R.instancedDataOffset,R.instancedDataCount>0&&(e.id&&(N.idToFeaturesIndex[e.id]=N.features.length),N.features.push(R),this.evaluate(R,{},N,!1)),A}getModelUris(){return this.modelUris}evaluate(e,r,l,u){const m=this.layers[0],g=e.feature,b=this.canonical,E=e.rotation=m.paint.get("model-rotation").evaluate(g,r,b),A=e.scale=m.paint.get("model-scale").evaluate(g,r,b),N=e.translation=m.paint.get("model-translation").evaluate(g,r,b),j=Object.assign({},m.paint.get("model-color").evaluate(g,r,b));j.a=m.paint.get("model-color-mix-intensity").evaluate(g,r,b);const R=[];this.maxVerticalOffset<N[2]&&(this.maxVerticalOffset=N[2]);const B=N[0]*N[0]+N[1]*N[1],V=B>0?Math.sqrt(B):0;l.maxScale=Math.max(Math.max(l.maxScale,A[0]),Math.max(A[1],A[2])),l.maxXYTranslationDistance=Math.max(l.maxXYTranslationDistance,V),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),XA(R,E,A);const H=Math.round(100*j.a)+j.b/1.05;for(let Q=0;Q<e.instancedDataCount;++Q){const K=e.instancedDataOffset+Q,re=16*K,ae=l.instancedDataArray.float32;let ue=0;u&&(ue=ae[re+6]-l.instancesEvaluatedElevation[K]);const xe=0|ae[re+1];ae[re]=(0|ae[re])+j.r/1.05,ae[re+1]=xe+j.g/1.05,ae[re+2]=H,ae[re+3]=1/(b.z>10?this.tileToMeter:Dt(b,xe)),ae[re+4]=N[0],ae[re+5]=N[1],ae[re+6]=N[2]+(l.instancesRoadElevation?l.instancesRoadElevation[K]:0)+ue,ae[re+7]=R[0],ae[re+8]=R[1],ae[re+9]=R[2],ae[re+10]=R[4],ae[re+11]=R[5],ae[re+12]=R[6],ae[re+13]=R[8],ae[re+14]=R[9],ae[re+15]=R[10],l.instancesEvaluatedElevation[K]=N[2]}}}let wP,SP;hr(Q1,"ModelBucket",{omit:["layers"]}),hr(bP,"PerModelAttributes"),hr(vP,"ModelFeature");class gy{constructor(e,r,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=l}static create(e,r,l){const u=l||e.findDEMTileFor(r);if(!u||!u.dem)return;const m=u.dem,g=u.tileID,b=1<<r.canonical.z-g.canonical.z;return new gy(u,m.dim/qt/b,[(r.canonical.x/b-g.canonical.x)*m.dim,(r.canonical.y/b-g.canonical.y)*m.dim])}tileCoordToPixel(e,r){const l=r*this._scale+this._offset[1];return new Nt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,r,l,u){const m=e*this._scale+this._offset[0],g=r*this._scale+this._offset[1],b=Math.floor(m),E=Math.floor(g),A=this._dem;return u=!!u,l?$r($r(A.get(b,E,u),A.get(b,E+1,u),g-E),$r(A.get(b+1,E,u),A.get(b+1,E+1,u),g-E),m-b):A.get(b,E,u)}getElevationAtPixel(e,r,l){return this._dem.get(e,r,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*tt(1,e)*this._dem.stride}}const J1=new Float32Array(262144),cg=new Uint8Array(262144);function TP(o){let e=0;if(o.meshes)for(const r of o.meshes)e=Math.max(e,r.aabb.max[2]);if(o.children)for(const r of o.children)e=Math.max(e,TP(r));return e}function EP(o,e,r){if(o.meshes)for(const l of o.meshes){if(l.aabb.min[0]===1/0)continue;const u=Wn.applyTransform(l.aabb,o.globalMatrix);r.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const l of o.children)EP(l,e,r)}const CP=["","wall","door","roof","window","lamp","logo"];class AP{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:TP(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new Wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Wn.applyTransformFast(l.aabb,this.node.globalMatrix),r.encapsulate(l.transformedAabb)),e++;this.aabb=r}return this.aabb}}class Eb{constructor(e,r,l,u,m,g,b,E){this.id=l,this.layers=e,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=ly.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=ly.HasMapboxMeshFeatures),m&&(this.modelTraits|=ly.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of r)this.nodesInfo.push(new AP(A)),EP(A,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,r){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}updateAppearances(e,r,l,u){}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const l=r?this.stateDependentLayers:this.layers;if(!us(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const l of r){const u=l.node;this.uploaded?this.updatePbrBuffer(u):b1(u,e,!0)}for(const l of r)ob(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),r=!0);return r}needsReEvaluation(e,r,l){const u=e.transform.projectionOptions,m=e.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||u.name!==this.projection.name||ax(l.paint.get("model-color").value,g)||ax(l.paint.get("model-color-mix-intensity").value,g)||ax(l.paint.get("model-roughness").value,g)||ax(l.paint.get("model-emissive-strength").value,g)||ax(l.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=u,this.brightness=m;const b=this.getNodesInfo();for(const E of b)E.state=null;return!0}return!1}evaluateTransform(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const m of l){const g=m.feature;m.evaluatedTranslation=r.paint.get("model-translation").evaluate(g,{},u),m.evaluatedScale=r.paint.get("model-scale").evaluate(g,{},u)}}evaluate(e,r){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const m=u.feature,g=r&&r[m.id];if(us(g,u.state))continue;u.state=structuredClone(g);const b=u.node.meshes&&u.node.meshes[0].featureData,E=u.evaluatedColor[2],A=u.evaluatedRMEA[2],N=this.id.canonical;if(u.hasTranslucentParts=!1,b){for(let j=0;j<CP.length;j++){const R=CP[j];R.length&&(m.properties.part=R);const B=e.paint.get("model-color").evaluate(m,g,N).toPremultipliedRenderColor(null),V=e.paint.get("model-color-mix-intensity").evaluate(m,g,N);u.evaluatedColor[j]=[B.r,B.g,B.b,V],u.evaluatedRMEA[j][0]=e.paint.get("model-roughness").evaluate(m,g,N),u.evaluatedRMEA[j][2]=e.paint.get("model-emissive-strength").evaluate(m,g,N),u.evaluatedRMEA[j][3]=B.a,u.emissionHeightBasedParams[j]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,N),!u.hasTranslucentParts&&B.a<1&&(u.hasTranslucentParts=!0)}delete m.properties.part,hV(u,E!==u.evaluatedColor[2]||A!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,g,N);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,g,N),u.evaluatedScale=e.paint.get("model-scale").evaluate(m,g,N),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,l,u){const m=e.findDEMTileFor(l);if(m&&(m.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const g=gy.create(e,l,m);if(!g)return;this.modelTraits&ly.HasMapboxMeshFeatures&&this.updateDEM(e,g,l,u);for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const A=E.footprint.vertices;let N=g.getElevationAt(A[0].x,A[0].y,!0,!0);for(let j=1;j<A.length;j++)N=Math.min(N,g.getElevationAt(A[j].x,A[j].y,!0,!0));E.elevation=N}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,l,u){let m=r._dem._modifiedForSources[u];if(m===void 0&&(r._dem._modifiedForSources[u]=[],m=r._dem._modifiedForSources[u]),m.includes(l.canonical))return;const g=r._dem.dim;m.push(l.canonical);let b=!1;for(const E of this.getNodesInfo()){const A=E.node;if(!A.footprint||!A.footprint.grid)continue;const N=A.footprint.grid,j=r.tileCoordToPixel(N.min.x,N.min.y),R=r.tileCoordToPixel(N.max.x,N.max.y),B=Math.min(Math.min(g-R.y,j.x),Math.min(j.y,g-R.x));if(B<0)continue;const V=Ee(B,2,5);let H=Math.max(0,j.x-V),Q=Math.max(0,j.y-V),K=Math.min(R.x+V,g-1),re=Math.min(R.y+V,g-1);for(let ye=Q;ye<=re;++ye)for(let Ie=H;Ie<=K;++Ie)cg[ye*g+Ie]=255;let ae=0,ue=0;for(let ye=0;ye<N.cellsY;++ye)for(let Ie=0;Ie<N.cellsX;++Ie){if(!N.cells[ye*N.cellsX+Ie])continue;const Pe=r.tileCoordToPixel(N.min.x+Ie/N.xScale,N.min.y+ye/N.yScale),Ae=r.tileCoordToPixel(N.min.x+(Ie+1)/N.xScale,N.min.y+(ye+1)/N.yScale);for(let je=Pe.y;je<=Math.min(Ae.y+1,g-1);++je)for(let Oe=Pe.x;Oe<=Math.min(Ae.x+1,g-1);++Oe)cg[je*g+Oe]===255&&(cg[je*g+Oe]=0,ae+=r.getElevationAtPixel(Oe,je),ue++)}const xe=ae/ue;H=Math.max(1,j.x-V),Q=Math.max(1,j.y-V),K=Math.min(R.x+V,g-2),re=Math.min(R.y+V,g-2),b=!0;for(let ye=Q;ye<=re;++ye)for(let Ie=H;Ie<=K;++Ie)cg[ye*g+Ie]===0&&(J1[ye*g+Ie]=r._dem.set(Ie,ye,xe));for(let ye=1;ye<V;++ye){H=Math.max(1,j.x-ye),Q=Math.max(1,j.y-ye),K=Math.min(R.x+ye,g-2),re=Math.min(R.y+ye,g-2);for(let Ie=Q;Ie<=re;++Ie)for(let Pe=H;Pe<=K;++Pe){const Ae=Ie*g+Pe;if(cg[Ae]===255){let je=0,Oe=0,ht=-1,at=-1;for(let lt=-1;lt<=1;++lt)for(let St=-1;St<=1;++St){const bt=(Ie+lt)*g+Pe+St;if(cg[bt]>=ye)continue;const wt=J1[bt],st=Math.abs(wt);st>Oe&&(je=wt,Oe=st,ht=St,at=lt)}if(Oe>.1){const lt=1-(ye+.5*Math.abs(ht*at))/V;let St=r._dem.get(Pe,Ie)+je*lt;const bt=r._dem.get(Pe+ht,Ie+at),wt=r._dem.get(Pe-ht,Ie-at,!0);(St-bt)*(St-wt)>0&&(St=(bt+wt)/2),J1[Ae]=r._dem.set(Pe,Ie,St),cg[Ae]=ye}}}}}b&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=Vn.now())}setFilter(e){this.filter=e?el(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new bi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)ob(r.node),w1(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const m=u.node.footprint;u.hiddenByReplacement=!!m&&!l.find(g=>g.footprint===m)}}getHeightAtTileCoord(e,r){const l=[],u=[0,0,0],m=oe([]);for(const g of this.getNodesInfo()){const b=g.node.meshes[0],E=b.transformedAabb;if(e<E.min[0]||r<E.min[1]||e>E.max[0]||r>E.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};ve(m,g.node.globalMatrix),u[0]=e,u[1]=r,Sn(u,u,m);const A=(u[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*sg|0,N=Math.min(63,(u[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*sg|0)*sg+Math.min(63,A),j=b.heightmap[N];if(!(j<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:j,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new Nt(e,r),new Nt(e,r),l),l.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function ax(o,e){return o instanceof la&&!o.isLightConstant&&e}function dV(o,e,r,l,u,m,g,b){let E=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,N=240&e|(240&e)>>4;r[3]>0&&(E=$r(E,255*r[0],r[3]),A=$r(A,255*r[1],r[3]),N=$r(N,255*r[2],r[3]));const j=E<<8|A,R=N<<8|Math.floor(255*l[3]),B=(function(ye){const Ie=Ee(ye,0,2);return Math.min(Math.round(.5*Ie*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],V=Ee(u[0],0,1),H=Ee(u[1],0,1),Q=Ee(u[2],0,1),K=Ee(u[3],0,1);let re,ae,ue,xe;if(V!==H&&g!==m&&H!==V){const ye=g-m;ae=1/(ye*(H-V)),ue=-(m+ye*V)/(ye*(H-V));const Ie=Ee(u[4],-1,1);xe=Math.pow(10,Ie),re=255*Q<<8|255*K}else re=65535,ae=0,ue=1,xe=1;if(o.emplaceBack(j,R,B,re,ae,ue,xe),b){const ye=b.length;b.clear();for(let Ie=0;Ie<ye;Ie++)b.emplaceBack(j,R,B,re,ae,ue,xe)}}function hV(o,e,r){const l=o.node;let u=0;const m=r&ly.HasMeshoptCompression;for(const g of l.meshes){if(l.lights&&l.lightMeshIndex===u||!g.featureData)continue;g.featureArray=new hd,g.featureArray.reserve(g.featureData.length);let b=e;for(const E of g.featureData){const A=m?65535&E:E>>16&65535,N=m?E>>16&65535:65535&E,j=(15&N)<8?15&N:0,R=o.evaluatedRMEA[j],B=o.evaluatedColor[j],V=o.emissionHeightBasedParams[j];let H;if(b&&j===2&&l.lights&&(H=new hd,H.resize(10*l.lights.length)),dV(g.featureArray,A,B,R,V,g.aabb.min[2],g.aabb.max[2],H),H&&b){b=!1;const Q=l.meshes[l.lightMeshIndex];Q.featureArray=H,Q.featureArray._trim()}}g.featureArray._trim(),u++}}hr(Eb,"Tiled3dModelBucket",{omit:["layers"]}),hr(AP,"Tiled3dModelFeature");const fV=["id","tile","layer","source","sourceLayer","state"];class ug{constructor(e,r,l,u,m){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=l,this._y=u,this.properties=e?e.properties:{},this.id=m}clone(){const e=new ug(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of fV)this[r]!==void 0&&(e[r]=this[r]);return e}}class dg extends Xs{constructor(e,r,l,u){super(),this.id=e,this.type="model",this.models=[],this._options=r,this._modelsInfo=new Map}loadGLTFFromURI(e){return GA(this.map._requestManager.transformRequest(e,qo.Model).url)}load(){for(const e in this._options.models){const r=this._options.models[e],l=this._modelsInfo.get(e);if(l){l.modelSpec=r;const u=l.model;u&&(u.position=r.position!=null?new _e(r.position[0],r.position[1]):new _e(0,0),u.orientation=r.orientation!=null?r.orientation:[0,0,0],dg.applyModelSpecification(u,r),u.computeBoundsAndApplyParent(),this.models.push(u))}else this._modelsInfo.set(e,{modelSpec:r,model:null}),this.loadGLTFFromURI(r.uri).then(u=>{if(!u)return;const m=this._modelsInfo.get(e);if(!m)return;const g=T1(u),b=m.modelSpec,E=new KA(e,b.uri,b.position,b.orientation,g);dg.applyModelSpecification(E,b),E.computeBoundsAndApplyParent(),this.models.push(E),m.model=E,this.loaded()&&this.fire(new tc("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(u=>{this.fire(new nu(new Error(`Could not load model ${e} from ${r.uri}: ${u.message}`)))})}this.loaded()&&this.fire(new tc("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(e,r){r.nodeOverrides&&dg.convertNodeOverrides(e,r.nodeOverrides),r.materialOverrides&&dg.convertMaterialOverrides(e,r.materialOverrides),r.nodeOverrideNames&&(e.nodeOverrideNames=[...r.nodeOverrideNames]),r.materialOverrideNames&&(e.materialOverrideNames=[...r.materialOverrideNames]),r.featureProperties&&(e.featureProperties=r.featureProperties)}static convertNodeOverrides(e,r){if(Array.isArray(r)&&r.every(l=>typeof l=="string")){e.nodeOverrideNames=[];for(const l of r)e.nodeOverrideNames.push(l)}else Object.entries(r).forEach(([l,u])=>{const m={orientation:[0,0,0]};if(u.hasOwnProperty("orientation")){const g=u.orientation;g&&(m.orientation=g)}e.nodeOverrides.set(l,m)})}static convertMaterialOverrides(e,r){if(Array.isArray(r)&&r.every(l=>typeof l=="string")){e.materialOverrideNames=[];for(const l of r)e.materialOverrideNames.push(l)}else Object.entries(r).forEach(([l,u])=>{const m={color:new ii(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=u["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);const b=u["model-color-mix-intensity"];b!==void 0&&(m.colorMix=b);const E=u["model-emissive-strength"];E!==void 0&&(m.emissionStrength=E);const A=u["model-opacity"];A!==void 0&&(m.opacity=A),e.materialOverrides.set(l,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const e of this._modelsInfo.values())if(e.model==null)return!1;return!0}getModels(){return this.models}loadTile(e,r){}serialize(){return this._options}setProperty(e,r){return!1}reload(){const e=yu(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this.load()}setModels(e){this.models=[];const r=new Map;for(const l in e){const u=e[l];if(this._modelsInfo.has(l)){const m=this._modelsInfo.get(l);m&&m.modelSpec.uri===u.uri&&r.set(l,m)}}this._modelsInfo=r,this._options.models=e,this.load()}}function eS(o,e,r,l){const u=1<<o.z;e.lat=Pt((l/qt+o.y)/u),e.lng=mt((r/qt+o.x)/u)}function pV(o,e,r,l){const u=o.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let m=Number.MAX_VALUE;const g=u.node,b=r.tile,E=l.calculatePosMatrix(b.tileID.toUnwrapped(),l.worldSize),A=u.evaluatedScale;let N=0;l.elevation&&g.elevation&&(N=g.elevation*l.elevation.exaggeration()),Se(E,E,[(g.anchor?g.anchor[0]:0)*(A[0]-1),(g.anchor?g.anchor[1]:0)*(A[1]-1),N]),Re(E,E,A);const j=r.queryGeometry,R=j.isPointQuery()?j.screenBounds:j.screenGeometry,B=function(H){const Q=me([],E,H.globalMatrix);me(Q,l.expandedFarZProjMatrix,Q);for(let K=0;K<H.meshes.length;++K){const re=H.meshes[K];if(K===H.lightMeshIndex)continue;const ae=v1(R,l,Q,re.aabb);ae!=null&&(m=Math.min(ae,m))}if(H.children)for(const K of H.children)B(K)};if(B(g),m===Number.MAX_VALUE)return;const V=new _e(0,0);return eS(b.tileID.canonical,V,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:m,position:V,feature:u.feature}}const mV={circle:class extends Xo{constructor(o,e,r,l){super(o,{layout:Nn||(Nn=new is({"circle-sort-key":new er(He.layout_circle["circle-sort-key"]),"circle-elevation-reference":new zt(He.layout_circle["circle-elevation-reference"]),visibility:new zt(He.layout_circle.visibility)})),paint:Hn||(Hn=new is({"circle-radius":new er(He.paint_circle["circle-radius"]),"circle-color":new er(He.paint_circle["circle-color"]),"circle-blur":new er(He.paint_circle["circle-blur"]),"circle-opacity":new er(He.paint_circle["circle-opacity"]),"circle-translate":new zt(He.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new er(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new er(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new er(He.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new zt(He.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}createBucket(o){return new _(o)}queryRadius(o){const e=o;return Lt("circle-radius",this,e)+Lt("circle-stroke-width",this,e)+xt(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,r,l,u,m,g,b){const E=Br(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return SC(o,l,m,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,r){const l=wC(this);return{config:new D(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Xo{createBucket(o){return new EC(o)}constructor(o,e,r,l){super(o,{layout:CC||(CC=new is({visibility:new zt(He.layout_heatmap.visibility)})),paint:AC||(AC=new is({"heatmap-radius":new er(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new er(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ad(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(He.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=I_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return Lt("heatmap-radius",this,o)}queryIntersectsFeature(o,e,r,l,u,m,g,b){const E=this.paint.get("heatmap-radius").evaluate(e,r);return SC(o,l,m,g,b,!0,!0,new Nt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,r){return o==="heatmap"?{config:new D(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Xo{constructor(o,e,r,l){super(o,{layout:IC||(IC=new is({visibility:new zt(He.layout_hillshade.visibility)})),paint:PC||(PC=new is({"hillshade-illumination-direction":new zt(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(He.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new zt(He.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}},fill:class extends Xo{constructor(o,e,r,l){super(o,{layout:XC||(XC=new is({"fill-sort-key":new er(He.layout_fill["fill-sort-key"]),visibility:new zt(He.layout_fill.visibility),"fill-elevation-reference":new zt(He.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new er(He.layout_fill["fill-construct-bridge-guard-rail"])})),paint:KC||(KC=new is({"fill-antialias":new zt(He.paint_fill["fill-antialias"]),"fill-opacity":new er(He.paint_fill["fill-opacity"]),"fill-color":new er(He.paint_fill["fill-color"]),"fill-outline-color":new er(He.paint_fill["fill-outline-color"]),"fill-translate":new zt(He.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new er(He.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new zt(He.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new zt(He.paint_fill["fill-emissive-strength"]),"fill-z-offset":new er(He.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new er(He.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new er(He.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(o,e,r){return{config:new D(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new n1(o)}queryRadius(){return xt(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,r,l,u,m){return!o.queryGeometry.isAboveHorizon&&z(Vt(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Xo{constructor(o,e,r,l){super(o,{layout:xA||(xA=new is({visibility:new zt(He["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new zt(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:vA||(vA=new is({"fill-extrusion-opacity":new zt(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new er(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new er(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new zt(He["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new er(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new er(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new zt(He["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new zt(He["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new zt(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new zt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new zt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new zt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new zt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new zt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new zt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new zt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new er(He["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new er(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new zt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new zt(He["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new zt(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new zt(He["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new er(He["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new er(He["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new zt(He["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Kv(o)}queryRadius(){return xt(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,r,l,u,m,g,b,E){const A=Br(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(e,r),j=this.paint.get("fill-extrusion-base").evaluate(e,r),R=[0,0],B=b&&m.elevation,V=m.elevation?m.elevation.exaggeration():1,H=o.tile.getBucket(this);if(B&&H instanceof Kv){const ue=H.centroidVertexArray,xe=E+1;xe<ue.length&&(R[0]=ue.geta_centroid_pos0(xe),R[1]=ue.geta_centroid_pos1(xe))}if(R[0]===0&&R[1]===1)return!1;m.projection.name==="globe"&&(l=_A([l],[new Nt(0,0),new Nt(qt,qt)],o.tileID.canonical).map(ue=>ue.polygon).flat());const Q=B?b:null,[K,re]=AA(m,l,j,N,A,g,Q,R,V,m.center.lat,o.tileID.canonical),ae=o.queryGeometry;return CA(K,re,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},building:class extends Xo{constructor(o,e,r,l){super(o,{layout:nI||(nI=new is({visibility:new zt(He.layout_building.visibility),"building-facade":new er(He.layout_building["building-facade"]),"building-facade-floors":new er(He.layout_building["building-facade-floors"]),"building-facade-unit-width":new er(He.layout_building["building-facade-unit-width"]),"building-facade-window":new er(He.layout_building["building-facade-window"]),"building-roof-shape":new er(He.layout_building["building-roof-shape"]),"building-height":new er(He.layout_building["building-height"]),"building-base":new er(He.layout_building["building-base"]),"building-flood-light-wall-radius":new er(He.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new er(He.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new er(He.layout_building["building-flip-roof-orientation"])})),paint:iI||(iI=new is({"building-opacity":new zt(He.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new zt(He.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new zt(He.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new zt(He.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new zt(He.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new zt(He.paint_building["building-vertical-scale"]),"building-cast-shadows":new zt(He.paint_building["building-cast-shadows"]),"building-color":new er(He.paint_building["building-color"]),"building-emissive-strength":new er(He.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new zt(He.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new zt(He.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new zt(He.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new zt(He.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new zt(He.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new rI(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}queryRadius(o){return 0}queryIntersectsFeature(o,e,r,l,u,m,g,b,E,A){let N=this.layout.get("building-height").evaluate(e,r);const j=this.layout.get("building-base").evaluate(e,r),R=o.tile.getBucket(this).getFootprint(e);if(R){if(R.hiddenFlags!==0)return!1;N=R.height}const[B,V]=AA(m,l,j,N,new Nt(0,0),g,null,[0,0],1,m.center.lat,o.tileID.canonical),H=o.queryGeometry;return CA(B,V,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Xo{constructor(o,e,r,l){const u=pI();super(o,u,e,r,l),u.layout&&(this.layout=new ua(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ff,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(H_)return H_;const r=pI();return H_=new c5(r.paint.properties["line-width"].specification),H_.useIntegerZoom=!0,H_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new A1(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,r){const l=hI(this);return{config:new D(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}queryRadius(o){const e=o,r=mI(Lt("line-width",this,e),Lt("line-gap-width",this,e)),l=Lt("line-offset",this,e);return r/2+Math.abs(l)+xt(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,r,l,u,m){if(o.queryGeometry.isAboveHorizon)return!1;const g=Vt(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*mI(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),E=this.paint.get("line-offset").evaluate(e,r);return E&&(l=(function(A,N){const j=[],R=new Nt(0,0);for(let B=0;B<A.length;B++){const V=A[B],H=[];for(let Q=0;Q<V.length;Q++){const K=V[Q],re=V[Q+1],ae=Q===0?R:K.sub(V[Q-1])._unit()._perp(),ue=Q===V.length-1?R:re.sub(K)._unit()._perp(),xe=ae._add(ue)._unit();xe._mult(1/(xe.x*ue.x+xe.y*ue.y)),H.push(xe._mult(N)._add(K))}j.push(H)}return j})(l,E*o.pixelToTileUnitsFactor)),(function(A,N,j){for(let R=0;R<N.length;R++){const B=N[R];if(A.length>=3){for(let V=0;V<B.length;V++)if(mr(A,B[V]))return!0}if(Z(A,B,j))return!0}return!1})(g,l,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:bb,background:class extends Xo{constructor(o,e,r,l){super(o,{layout:oP||(oP=new is({visibility:new zt(He.layout_background.visibility)})),paint:aP||(aP=new is({"background-pitch-alignment":new zt(He.paint_background["background-pitch-alignment"]),"background-color":new zt(He.paint_background["background-color"]),"background-pattern":new zt(He.paint_background["background-pattern"]),"background-opacity":new zt(He.paint_background["background-opacity"]),"background-emissive-strength":new zt(He.paint_background["background-emissive-strength"]),"background-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:hP,"raster-particle":_P,sky:class extends Xo{constructor(o,e,r,l){super(o,{layout:mP||(mP=new is({visibility:new zt(He.layout_sky.visibility)})),paint:gP||(gP=new is({"sky-type":new zt(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new zt(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new zt(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new zt(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new zt(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new ad(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new zt(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new zt(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new zt(He.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=I_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,m=o.style.light,g=m.properties.get("position");return u&&m.properties.get("anchor")==="viewport"&&Rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?K1(g.azimuthal,90-g.polar,e):K1(l[0],90-l[1],e)}const r=this.paint.get("sky-gradient-center");return K1(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Xo{constructor(o,e,r,l){super(o,{paint:yP||(yP=new is({}))},e,null)}},model:class extends Xo{constructor(o,e,r,l){super(o,{layout:wP||(wP=new is({visibility:new zt(He.layout_model.visibility),"model-id":new er(He.layout_model["model-id"]),"model-allow-density-reduction":new zt(He.layout_model["model-allow-density-reduction"])})),paint:SP||(SP=new is({"model-opacity":new er(He.paint_model["model-opacity"]),"model-rotation":new er(He.paint_model["model-rotation"]),"model-scale":new er(He.paint_model["model-scale"]),"model-translation":new er(He.paint_model["model-translation"]),"model-color":new er(He.paint_model["model-color"]),"model-color-mix-intensity":new er(He.paint_model["model-color-mix-intensity"]),"model-type":new zt(He.paint_model["model-type"]),"model-cast-shadows":new zt(He.paint_model["model-cast-shadows"]),"model-receive-shadows":new zt(He.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new zt(He.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new er(He.paint_model["model-emissive-strength"]),"model-roughness":new er(He.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new er(He.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new zt(He.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new zt(He.paint_model["model-front-cutoff"]),"model-elevation-reference":new zt(He.paint_model["model-elevation-reference"]),"model-color-use-theme":new er({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this.layer=o,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Q1(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Eb?8191:0}queryRenderedFeatures(o,e,r){const l=e.getSource();if(!(l&&l instanceof dg))return{};const u=l,m={};m[this.id]=[];const g=m[this.id];let b=0;for(const E of u.models){const A=e.getFeatureState(this.sourceLayer,E.id),N={type:"Unknown",id:E.id,properties:E.featureProperties},j=this.paint.get("model-rotation").evaluate(N,A),R=this.paint.get("model-scale").evaluate(N,A),B=this.paint.get("model-translation").evaluate(N,A),V=this.paint.get("model-elevation-reference");let H=[];sb(H,E,r,E.position,j,R,B,V==="ground",V==="ground",!1),r.projection.name==="globe"&&(H=ib(H,r));const Q=me([],r.projMatrix,H),K=v1(o.isPointQuery()?o.screenBounds:o.screenGeometry,r,Q,E.aabb);if(K!=null){const re=new ug(void 0,0,0,0,E.id);re.layer=this.layer,re.properties=structuredClone(E.featureProperties),re.properties.layer=this.id,re.properties.uri=E.uri,re.properties.orientation=E.orientation,re.sourceLayer=this.sourceLayer,re.geometry={type:"Point",coordinates:[E.position.lng,E.position.lat]},re.state=A,re.source=this.source,g.push({featureIndex:b,feature:re,intersectionZ:K})}++b}return m}queryIntersectsFeature(o,e,r,l,u,m,g,b,E,A){if(!this.modelManager)return!1;const N=this.modelManager,j=o.tile.getBucket(this);if(!(j&&j instanceof Q1))return!1;for(const R in j.instancesPerModel){const B=j.instancesPerModel[R],V=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(B.idToFeaturesIndex.hasOwnProperty(V)){const H=B.features[B.idToFeaturesIndex[V]],Q=N.getModel(R,A||this.scope);if(!Q)return!1;let K=[];const re=new _e(0,0),ae=j.canonical;let ue=Number.MAX_VALUE;for(let xe=0;xe<H.instancedDataCount;++xe){const ye=16*(H.instancedDataOffset+xe),Ie=B.instancedDataArray.float32,Pe=[Ie[ye+4],Ie[ye+5],Ie[ye+6]];eS(ae,re,Math.floor(Ie[ye]),Math.floor(Ie[ye+1])),sb(K,Q,m,re,H.rotation,H.scale,Pe,!1,!1,!1),m.projection.name==="globe"&&(K=ib(K,m));const Ae=me([],m.projMatrix,K),je=o.queryGeometry,Oe=v1(je.isPointQuery()?je.screenBounds:je.screenGeometry,m,Ae,Q.aabb);Oe!=null&&(ue=Math.min(Oe,ue))}return ue!==Number.MAX_VALUE&&ue}}return!1}_handleOverridablePaintPropertyUpdate(o,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ja}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Xo{constructor(o,e,r,l){super(o,{layout:YC||(YC=new is({"clip-layer-types":new zt(He.layout_clip["clip-layer-types"]),"clip-layer-scope":new zt(He.layout_clip["clip-layer-scope"]),visibility:new zt(He.layout_clip.visibility)})),paint:QC||(QC=new is({}))},e,r,l)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new JC(o)}is3D(o){return!0}}},tS=new ii(0,0,0);function gV(o,e,r){o===1&&e.icons.push((function(l,u){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:g}=m;if(g.content_area){const{content_area:b}=g;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=m.usvg_tree.width),b.height==null&&(b.height=b.width)}if(g.text_placeholder){const{text_placeholder:b}=g;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return g.stretch_x&&g.stretch_x.length&&IP(g,"x"),g.stretch_y&&g.stretch_y.length&&IP(g,"y"),m})(l.readFields(yV,{name:void 0},u))})(r,r.readVarint()+r.pos))}function IP(o,e){const r=[],l=o[`stretch_${e}`];let u=null;for(let m=0;m<l.length;m++)u===null?u=r.length===0?l[0]:r[r.length-1][1]+l[m]:(r.push([u,u+l[m]]),u=null);o[`stretch_${e}_areas`]=r}function yV(o,e,r){o===1?e.name=r.readString():o===2?e.metadata=(function(l,u){return l.readFields(_V,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)})(r,r.readVarint()+r.pos):o===3&&(e.usvg_tree=(function(l,u){return l.readFields(bV,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)})(r,r.readVarint()+r.pos),e.data="usvg_tree")}function _V(o,e,r){o===1?e.stretch_x=r.readPackedVarint():o===2?e.stretch_y=r.readPackedVarint():o===3?e.content_area=PP(r,r.readVarint()+r.pos):o===4?e.variables.push((function(l,u){return l.readFields(vV,{name:void 0},u)})(r,r.readVarint()+r.pos)):o===5&&(e.text_placeholder=PP(r,r.readVarint()+r.pos))}function PP(o,e){return o.readFields(xV,{},e)}function xV(o,e,r){o===1?e.left=r.readVarint():o===2?e.width=r.readVarint():o===3?e.top=r.readVarint():o===4&&(e.height=r.readVarint())}function vV(o,e,r){o===1?e.name=r.readString():o===2&&(e.rgb_color=Ib(r.readVarint()),e.value="rgb_color")}function bV(o,e,r){o===1?e.width=e.height=r.readVarint():o===2?e.height=r.readVarint():o===3?e.children.push(Cb(r,r.readVarint()+r.pos)):o===4?e.linear_gradients.push((function(l,u){return l.readFields(IV,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)})(r,r.readVarint()+r.pos)):o===5?e.radial_gradients.push((function(l,u){return l.readFields(kV,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)})(r,r.readVarint()+r.pos)):o===7?e.clip_paths.push((function(l,u){return l.readFields(NV,{children:[]},u)})(r,r.readVarint()+r.pos)):o===8&&e.masks.push((function(l,u){const m=l.readFields(jV,{left:0,width:20,mask_type:1,children:[]},u);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(r,r.readVarint()+r.pos))}function Cb(o,e){return o.readFields(wV,{},e)}function wV(o,e,r){o===1?(e.group=(function(l,u){return l.readFields(SV,{opacity:255,children:[]},u)})(r,r.readVarint()+r.pos),e.node="group"):o===2&&(e.path=(function(l,u){return l.readFields(EV,{paint_order:1,commands:[],step:1,diffs:[],rule:1},u)})(r,r.readVarint()+r.pos),e.node="path")}function SV(o,e,r){o===1?e.transform=Ab(r,r.readVarint()+r.pos):o===2?e.opacity=r.readVarint():o===5?e.clip_path_idx=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(Cb(r,r.readVarint()+r.pos))}function Ab(o,e){return o.readFields(TV,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function TV(o,e,r){o===1?e.sx=r.readFloat():o===2?e.ky=r.readFloat():o===3?e.kx=r.readFloat():o===4?e.sy=r.readFloat():o===5?e.tx=r.readFloat():o===6&&(e.ty=r.readFloat())}function EV(o,e,r){o===1?e.fill=(function(l,u){return l.readFields(CV,{rgb_color:tS,paint:"rgb_color",opacity:255},u)})(r,r.readVarint()+r.pos):o===2?e.stroke=(function(l,u){return l.readFields(AV,{rgb_color:tS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)})(r,r.readVarint()+r.pos):o===3?e.paint_order=r.readVarint():o===5?r.readPackedVarint(e.commands):o===6?e.step=r.readFloat():o===7?r.readPackedSVarint(e.diffs):o===8&&(e.rule=r.readVarint())}function CV(o,e,r){o===1?(e.rgb_color=Ib(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=r.readVarint())}function Ib(o){return new ii((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function AV(o,e,r){o===1?(e.rgb_color=Ib(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5?r.readPackedFloat(e.dasharray):o===6?e.dashoffset=r.readFloat():o===7?e.miterlimit=r.readFloat():o===8?e.opacity=r.readVarint():o===9?e.width=r.readFloat():o===10?e.linecap=r.readVarint():o===11&&(e.linejoin=r.readVarint())}function IV(o,e,r){o===1?e.transform=Ab(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(kP(r,r.readVarint()+r.pos)):o===4?e.x1=r.readFloat():o===5?e.y1=r.readFloat():o===6?e.x2=r.readFloat():o===7&&(e.y2=r.readFloat())}function kP(o,e){return o.readFields(PV,{offset:0,opacity:255,rgb_color:tS},e)}function PV(o,e,r){o===1?e.offset=r.readFloat():o===2?e.opacity=r.readVarint():o===3&&(e.rgb_color=Ib(r.readVarint()))}function kV(o,e,r){o===1?e.transform=Ab(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(kP(r,r.readVarint()+r.pos)):o===4?e.cx=r.readFloat():o===5?e.cy=r.readFloat():o===6?e.r=r.readFloat():o===7?e.fx=r.readFloat():o===8?e.fy=r.readFloat():o===9&&(e.fr=r.readFloat())}function NV(o,e,r){o===1?e.transform=Ab(r,r.readVarint()+r.pos):o===2?e.clip_path_idx=r.readVarint():o===3&&e.children.push(Cb(r,r.readVarint()+r.pos))}function jV(o,e,r){o===1?e.left=e.top=r.readFloat():o===2?e.width=e.height=r.readFloat():o===3?e.top=r.readFloat():o===4?e.height=r.readFloat():o===5?e.mask_type=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(Cb(r,r.readVarint()+r.pos))}class RV{static calculate(e={},r=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;r.forEach(m=>{u.set(m.name,m.rgb_color||new ii(0,0,0))});for(const[m,g]of Object.entries(e))u.has(m)?l.set(u.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return l}}function yy(o,e=255,r){const l=e/255,u=o.toString(),m=r.has(u)?r.get(u).clone():o.clone();return m.a*=l,m.toString()}function lx(o,e){if(!pn()){const r=document.createElement("canvas");return r.width=o,r.height=e,r}return new OffscreenCanvas(o,e)}let rS,cx=null;function nS(o,e,r,l,u){for(const m of l.children)NP(o,e,r,m,u)}function NP(o,e,r,l,u){l.group?(o.save(),(function(m,g,b,E,A){const N=E.mask_idx!=null?b.masks[E.mask_idx]:null,j=E.clip_path_idx!=null?b.clip_paths[E.clip_path_idx]:null;if(E.transform&&(g=_y(E.transform).preMultiplySelf(g)),!(function(V,H,Q){return V.opacity!==255||H||Q})(E,j!=null,N!=null))return void nS(m,g,b,E,A);const R=lx(m.canvas.width,m.canvas.height),B=R.getContext("2d");nS(B,g,b,E,A),j&&zP(B,g,b,j),N&&FP(B,g,b,N,A),m.globalAlpha=E.opacity/255,m.drawImage(R,0,0)})(o,e,r,l.group,u),o.restore()):l.path&&(o.save(),(function(m,g,b,E,A){m.setTransform(g),E.paint_order===1?(jP(m,b,E,A),MP(m,b,E,A)):(MP(m,b,E,A),jP(m,b,E,A))})(o,e,r,l.path,u),o.restore())}function jP(o,e,r,l){const u=r.fill;if(!u)return;const m=u.opacity/255;switch(o.save(),o.beginPath(),BP(r,o),u.paint){case"rgb_color":o.fillStyle=yy(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":{const g=e.linear_gradients[u.linear_gradient_idx];g.transform&&o.setTransform(_y(g.transform).preMultiplySelf(o.getTransform())),o.fillStyle=LP(o,g,m,l);break}case"radial_gradient_idx":{const g=e.radial_gradients[u.radial_gradient_idx];g.transform&&o.setTransform(_y(g.transform).preMultiplySelf(o.getTransform())),o.fillStyle=DP(o,g,m,l)}}o.fill(RP(r)),o.restore()}function RP(o){return o.rule===1?"nonzero":o.rule===2?"evenodd":void 0}function MP(o,e,r,l){const u=r.stroke;if(!u)return;const m=VP(r);o.lineWidth=u.width,o.miterLimit=u.miterlimit,o.setLineDash(u.dasharray),o.lineDashOffset=u.dashoffset;const g=u.opacity/255;switch(u.paint){case"rgb_color":o.strokeStyle=yy(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":o.strokeStyle=LP(o,e.linear_gradients[u.linear_gradient_idx],g,l,!0);break;case"radial_gradient_idx":o.strokeStyle=DP(o,e.radial_gradients[u.radial_gradient_idx],g,l,!0)}switch(u.linejoin){case 2:case 1:o.lineJoin="miter";break;case 3:o.lineJoin="round";break;case 4:o.lineJoin="bevel"}switch(u.linecap){case 1:o.lineCap="butt";break;case 2:o.lineCap="round";break;case 3:o.lineCap="square"}o.stroke(m)}function LP(o,e,r,l,u=!1){if(e.stops.length===1){const R=e.stops[0];return yy(R.rgb_color,R.opacity*r,l)}const{x1:m,y1:g,x2:b,y2:E}=e;let A=new DOMPoint(m,g),N=new DOMPoint(b,E);if(u){const R=_y(e.transform);A=R.transformPoint(A),N=R.transformPoint(N)}const j=o.createLinearGradient(A.x,A.y,N.x,N.y);for(const R of e.stops)j.addColorStop(R.offset,yy(R.rgb_color,R.opacity*r,l));return j}function DP(o,e,r,l,u=!1){if(e.stops.length===1){const K=e.stops[0];return yy(K.rgb_color,K.opacity*r,l)}const m=_y(e.transform),{fx:g,fy:b,fr:E,cx:A,cy:N,r:j}=e;let R=new DOMPoint(g,b),B=new DOMPoint(A,N),V=E,H=j;if(u){R=m.transformPoint(R),B=m.transformPoint(B);const K=(m.a+m.d)/2;V=E*K,H=e.r*K}const Q=o.createRadialGradient(R.x,R.y,V,B.x,B.y,H);for(const K of e.stops)Q.addColorStop(K.offset,yy(K.rgb_color,K.opacity*r,l));return Q}function OP(o,e,r,l){const u=l.transform?_y(l.transform).preMultiplySelf(e):e,m=lx(o.canvas.width,o.canvas.height),g=m.getContext("2d");for(const E of l.children)if(E.group)OP(g,u,r,E.group);else if(E.path){const A=E.path,N=new Path2D;N.addPath(VP(A),u),g.fill(N,RP(A))}const b=l.clip_path_idx!=null?r.clip_paths[l.clip_path_idx]:null;b&&zP(g,u,r,b),o.globalCompositeOperation="source-over",o.drawImage(m,0,0)}function zP(o,e,r,l){const u=lx(o.canvas.width,o.canvas.height);OP(u.getContext("2d"),e,r,l),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function FP(o,e,r,l,u){if(l.children.length===0)return;const m=l.mask_idx!=null?r.masks[l.mask_idx]:null;m&&FP(o,e,r,m,u);const g=o.canvas.width,b=o.canvas.height,E=lx(g,b),A=E.getContext("2d"),N=l.width,j=l.height,R=l.left,B=l.top,V=new Path2D,H=new Path2D;H.rect(R,B,N,j),V.addPath(H,e),A.clip(V);for(const re of l.children)NP(A,e,r,re,u);const Q=A.getImageData(0,0,g,b),K=Q.data;if(l.mask_type===1)for(let re=0;re<K.length;re+=4)K[re+3]=K[re+3]/255*(.2126*K[re]+.7152*K[re+1]+.0722*K[re+2]);A.putImageData(Q,0,0),o.globalCompositeOperation="destination-in",o.drawImage(E,0,0)}function _y(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function BP(o,e){const r=o.step;let l=o.diffs[0]*r,u=o.diffs[1]*r;e.moveTo(l,u);for(let m=0,g=2;m<o.commands.length;m++)switch(o.commands[m]){case 1:l+=o.diffs[g++]*r,u+=o.diffs[g++]*r,e.moveTo(l,u);break;case 2:l+=o.diffs[g++]*r,u+=o.diffs[g++]*r,e.lineTo(l,u);break;case 3:{const b=l+o.diffs[g++]*r,E=u+o.diffs[g++]*r;l=b+o.diffs[g++]*r,u=E+o.diffs[g++]*r,e.quadraticCurveTo(b,E,l,u);break}case 4:{const b=l+o.diffs[g++]*r,E=u+o.diffs[g++]*r,A=b+o.diffs[g++]*r,N=E+o.diffs[g++]*r;l=A+o.diffs[g++]*r,u=N+o.diffs[g++]*r,e.bezierCurveTo(b,E,A,N,l,u);break}case 5:e.closePath();break}return e}function VP(o){return BP(o,new Path2D)}class Pb{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}hr(Pb,"LRUCache");class iS{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ma(e,e.data)}getFromCache(e,r,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new Pb(150)),this.cacheMap.get(l).get(yu(e.toString(),r))}setInCache(e,r,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new Pb(150));const m=this.cacheDependenciesMap.get(u),g=yu(e.id.toString(),l);m.get(g)||m.set(g,new Set);const b=this.cacheMap.get(u),E=e.toString();m.get(g).add(E),b.put(yu(e.toString(),l),r)}removeImagesFromCacheByIds(e,r,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),m=this.cacheDependenciesMap.get(l);for(const g of e){const b=yu(g.toString(),r);if(m.has(b)){for(const E of m.get(b))u.delete(E);m.delete(b)}}}rasterize(e,r,l,u){const m=this.getFromCache(e,l,u);if(m)return m.clone();const g=(function(E,A){const N=RV.calculate(A.params,E.metadata?E.metadata.variables:[]),j=E.usvg_tree,R=j.width,B=j.height,V=Math.max(1,Math.round(R*A.sx)),H=Math.max(1,Math.round(B*A.sy)),Q=new DOMMatrix([V/R,0,0,H/B,0,0]);return cx===null&&(cx=lx(10,10),rS=cx.getContext("2d",{willReadFrequently:!0})),cx.width=V,cx.height=H,nS(rS,Q,j,j,N),rS.getImageData(0,0,V,H)})(r.icon,e),b=iS._getImage(g);return this.setInCache(e,b,l,u),b.clone()}}class UP{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const l=this.toIdx(e,r);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function $P(o,e,r,l){let u=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(r[g]<o[g]||r[g]>e[g])return null}else{const b=1/l[g];let E=(o[g]-r[g])*b,A=(e[g]-r[g])*b;if(E>A){const N=E;E=A,A=N}if(E>u&&(u=E),A<m&&(m=A),u>m)return null}return u}function qP(o,e,r,l,u,m,g,b,E,A,N){const j=l-o,R=u-e,B=m-r,V=g-o,H=b-e,Q=E-r,K=N[1]*Q-N[2]*H,re=N[2]*V-N[0]*Q,ae=N[0]*H-N[1]*V,ue=j*K+R*re+B*ae;if(Math.abs(ue)<1e-15)return null;const xe=1/ue,ye=A[0]-o,Ie=A[1]-e,Pe=A[2]-r,Ae=(ye*K+Ie*re+Pe*ae)*xe;if(Ae<0||Ae>1)return null;const je=Ie*B-Pe*R,Oe=Pe*j-ye*B,ht=ye*R-Ie*j,at=(N[0]*je+N[1]*Oe+N[2]*ht)*xe;return at<0||Ae+at>1?null:(V*je+H*Oe+Q*ht)*xe}function GP(o,e,r){return(o-e)/(r-e)}function WP(o,e,r,l,u,m,g,b,E){const A=1<<r,N=m-l,j=g-u,R=(o+1)/A*N+l,B=(e+0)/A*j+u,V=(e+1)/A*j+u;b[0]=(o+0)/A*N+l,b[1]=B,E[0]=R,E[1]=V}class HP{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=(function(m){const g=Math.ceil(Math.log2(m.dim/8)),b=[];let E=Math.ceil(Math.pow(2,g));const A=1/E,N=(B,V,H,Q,K)=>{const re=Q?1:0,ae=(B+1)*H-re,ue=V*H,xe=(V+1)*H-re;K[0]=B*H,K[1]=ue,K[2]=ae,K[3]=xe};let j=new UP(E);const R=[];for(let B=0;B<E*E;B++){N(B%E,Math.floor(B/E),A,!1,R);const V=Jp(R[0],R[1],m),H=Jp(R[2],R[1],m),Q=Jp(R[2],R[3],m),K=Jp(R[0],R[3],m);j.minimums.push(Math.min(V,H,Q,K)),j.maximums.push(Math.max(V,H,Q,K)),j.leaves.push(1)}for(b.push(j),E/=2;E>=1;E/=2){const B=b[b.length-1];j=new UP(E);for(let V=0;V<E*E;V++){N(V%E,Math.floor(V/E),2,!0,R);const H=B.getElevation(R[0],R[1]),Q=B.getElevation(R[2],R[1]),K=B.getElevation(R[2],R[3]),re=B.getElevation(R[0],R[3]),ae=B.isLeaf(R[0],R[1]),ue=B.isLeaf(R[2],R[1]),xe=B.isLeaf(R[2],R[3]),ye=B.isLeaf(R[0],R[3]),Ie=Math.min(H.min,Q.min,K.min,re.min),Pe=Math.max(H.max,Q.max,K.max,re.max),Ae=ae&&ue&&xe&&ye;j.maximums.push(Pe),j.minimums.push(Ie),j.leaves.push(Pe-Ie<=5&&Ae?1:0)}b.push(j)}return b})(this.dem),l=r.length-1,u=r[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,l,0)}raycastRoot(e,r,l,u,m,g,b=1){return $P([e,r,-100],[l,u,this.maximums[0]*b],m,g)}raycast(e,r,l,u,m,g,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,r,l,u,m,g,b);if(E==null)return null;const A=[],N=[],j=[],R=[],B=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:H,nodex:Q,nodey:K,depth:re}=B.pop();if(this.leaves[V]){WP(Q,K,re,e,r,l,u,j,R);const ue=1<<re,xe=(Q+0)/ue,ye=(Q+1)/ue,Ie=(K+0)/ue,Pe=(K+1)/ue,Ae=Jp(xe,Ie,this.dem)*b,je=Jp(ye,Ie,this.dem)*b,Oe=Jp(ye,Pe,this.dem)*b,ht=Jp(xe,Pe,this.dem)*b,at=qP(j[0],j[1],Ae,R[0],j[1],je,R[0],R[1],Oe,m,g),lt=qP(R[0],R[1],Oe,j[0],R[1],ht,j[0],j[1],Ae,m,g),St=Math.min(at!==null?at:Number.MAX_VALUE,lt!==null?lt:Number.MAX_VALUE);if(St!==Number.MAX_VALUE)return St;{const bt=Lr([],m,g,H);if(ZP(Ae,je,ht,Oe,GP(bt[0],j[0],R[0]),GP(bt[1],j[1],R[1]))>=bt[2])return H}continue}let ae=0;for(let ue=0;ue<this._siblingOffset.length;ue++){WP((Q<<1)+this._siblingOffset[ue][0],(K<<1)+this._siblingOffset[ue][1],re+1,e,r,l,u,j,R),j[2]=-100,R[2]=this.maximums[this.childOffsets[V]+ue]*b;const xe=$P(j,R,m,g);if(xe!=null){const ye=xe;A[ue]=ye;let Ie=!1;for(let Pe=0;Pe<ae&&!Ie;Pe++)ye>=A[N[Pe]]&&(N.splice(Pe,0,ue),Ie=!0);Ie||(N[ae]=ue),ae++}}for(let ue=0;ue<ae;ue++){const xe=N[ue];B.push({idx:this.childOffsets[V]+xe,t:A[xe],nodex:(Q<<1)+this._siblingOffset[xe][0],nodey:(K<<1)+this._siblingOffset[xe][1],depth:re+1})}}return null}_addNode(e,r,l){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,l,u,m){if(e[u].isLeaf(r,l)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=u-1,b=e[g];let E=0,A=0;for(let N=0;N<this._siblingOffset.length;N++){const j=2*r+this._siblingOffset[N][0],R=2*l+this._siblingOffset[N][1],B=b.getElevation(j,R),V=b.isLeaf(j,R),H=this._addNode(B.min,B.max,V);V&&(E|=1<<N),A||(A=H)}for(let N=0;N<this._siblingOffset.length;N++)E&1<<N||this._construct(e,2*r+this._siblingOffset[N][0],2*l+this._siblingOffset[N][1],g,A+N)}}function ZP(o,e,r,l,u,m){return $r($r(o,r,m),$r(e,l,m),u)}function Jp(o,e,r){const l=r.dim,u=Ee(o*l-.5,0,l-1),m=Ee(e*l-.5,0,l-1),g=Math.floor(u),b=Math.floor(m),E=Math.min(g+1,l-1),A=Math.min(b+1,l-1);return ZP(r.get(g,b),r.get(E,b),r.get(g,A),r.get(E,A),u-g,m-b)}const MV={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function LV(o,e,r){return(256*o*256+256*e+r)/10-1e4}function DV(o,e,r){return 256*o+e+r/256-32768}class kb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,l,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Rr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,g=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let E=0;E<m;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(m,E)]=g[this._idx(m-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,m)]=g[this._idx(E,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}const b=l==="terrarium"?DV:LV;for(let E=0;E<g.length;++E){const A=4*E;this.floatView[E]=b(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Vn.now()}_buildQuadTree(){this._tree=new HP(this)}get(e,r,l=!1){l&&(e=Ee(e,-1,this.dim),r=Ee(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,l){const u=this._idx(e,r),m=this.floatView[u];return this.floatView[u]=l,l-m}static getUnpackVector(e){return MV[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const l=[0,0,0,0],u=kb.getUnpackVector(r);let m=Math.floor((e+u[3])/u[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new jC({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,m=r*this.dim+this.dim,g=l*this.dim,b=l*this.dim+this.dim;switch(r){case-1:u=m-1;break;case 1:m=u+1}switch(l){case-1:g=b-1;break;case 1:b=g+1}const E=-r*this.dim,A=-l*this.dim;for(let N=g;N<b;N++)for(let j=u;j<m;j++){const R=4*this._idx(j,N),B=4*this._idx(j+E,N+A);this.pixels[R+0]=e.pixels[B+0],this.pixels[R+1]=e.pixels[B+1],this.pixels[R+2]=e.pixels[B+2],this.pixels[R+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function OV(o,e,r){o===1?e.headerLength=r.readFixed32():o===2?e.x=r.readVarint():o===3?e.y=r.readVarint():o===4?e.z=r.readVarint():o===5&&e.layers.push((function(l,u){return l.readFields(UV,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)})(r,r.readVarint()+r.pos))}function zV(o,e,r){o===1?(e.delta_filter=(function(l,u){return l.readFields(FV,{blockSize:0},u)})(r,r.readVarint()+r.pos),e.filter="delta_filter"):o===2?(r.readVarint(),e.filter="zigzag_filter"):o===3?(r.readVarint(),e.filter="bitshuffle_filter"):o===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function FV(o,e,r){o===1&&(e.blockSize=r.readVarint())}function BV(o,e,r){o===1?(r.readVarint(),e.codec="gzip_data"):o===2?(r.readVarint(),e.codec="jpeg_image"):o===3?(r.readVarint(),e.codec="webp_image"):o===4&&(r.readVarint(),e.codec="png_image")}function VV(o,e,r){let l=0,u=0;o===1?e.firstByte=r.readFixed64():o===2?e.lastByte=r.readFixed64():o===3?e.filters.push((function(m,g){return m.readFields(zV,{},g)})(r,r.readVarint()+r.pos)):o===4?e.codec=(function(m,g){return m.readFields(BV,{},g)})(r,r.readVarint()+r.pos):o===5?u=r.readFloat():o===6?l=r.readFloat():o===7?e.bands.push(r.readString()):o===8?e.offset=r.readDouble():o===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function UV(o,e,r){o===1?e.version=r.readVarint():o===2?e.name=r.readString():o===3?e.units=r.readString():o===4?e.tileSize=r.readVarint():o===5?e.buffer=r.readVarint():o===6?e.pixelFormat=r.readVarint():o===7&&e.dataIndex.push((function(l,u){return l.readFields(VV,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)})(r,r.readVarint()+r.pos))}function $V(o,e,r){if(o===2)(function(l,u,m){l.readFields(qV,m,u)})(r,r.readVarint()+r.pos,e);else if(o===3)throw new Error("Not implemented")}function qV(o,e,r){if(o===1){let l=0;const u=r.readVarint()+r.pos;for(;r.pos<u;)e[l++]=r.readVarint()}}function GV(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,m=l===2?1:0;for(let g=0;g<e[0];g++){const b=e[1]*g;for(let E=u;E<e[1];E++){const A=e[2]*(E+b);for(let N=m;N<e[2];N++){const j=e[3]*(N+A);for(let R=0;R<e[3];R++){const B=j+R;o[B]+=o[B-r]}}}}r*=e[l]}return o}function WV(o){for(let e=0,r=o.length;e<r;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function HV(o,e){switch(e){case"uint32":return o;case"uint16":for(let r=0;r<o.length;r+=2){const l=o[r],u=o[r+1];o[r]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,o[r+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let r=0;r<o.length;r+=4){const l=o[r],u=o[r+1],m=o[r+2],g=o[r+3];o[r+0]=(192&l)>>6|(192&u)>>4|(192&m)>>2|192&g,o[r+1]=(48&l)>>4|(48&u)>>2|48&m|(48&g)<<2,o[r+2]=(12&l)>>2|12&u|(12&m)<<2|(12&g)<<4,o[r+3]=3&l|(3&u)<<2|(3&m)<<4|(3&g)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}hr(kb,"DEMData"),hr(HP,"DemMinMaxQuadTree",{omit:["dem"]});var Fc=Uint8Array,ux=Uint16Array,ZV=Int32Array,XP=new Fc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),KP=new Fc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),XV=new Fc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),YP=function(o,e){for(var r=new ux(31),l=0;l<31;++l)r[l]=e+=1<<o[l-1];var u=new ZV(r[30]);for(l=1;l<30;++l)for(var m=r[l];m<r[l+1];++m)u[m]=m-r[l]<<5|l;return{b:r,r:u}},QP=YP(XP,2),JP=QP.b,KV=QP.r;JP[28]=258,KV[258]=28;for(var YV=YP(KP,0).b,ek=new ux(32768),eo=0;eo<32768;++eo){var xy=(43690&eo)>>1|(21845&eo)<<1;ek[eo]=((65280&(xy=(61680&(xy=(52428&xy)>>2|(13107&xy)<<2))>>4|(3855&xy)<<4))>>8|(255&xy)<<8)>>1}var dx=function(o,e,r){for(var l=o.length,u=0,m=new ux(e);u<l;++u)o[u]&&++m[o[u]-1];var g,b=new ux(e);for(u=1;u<e;++u)b[u]=b[u-1]+m[u-1]<<1;g=new ux(1<<e);var E=15-e;for(u=0;u<l;++u)if(o[u])for(var A=u<<4|o[u],N=e-o[u],j=b[o[u]-1]++<<N,R=j|(1<<N)-1;j<=R;++j)g[ek[j]>>E]=A;return g},hx=new Fc(288);for(eo=0;eo<144;++eo)hx[eo]=8;for(eo=144;eo<256;++eo)hx[eo]=9;for(eo=256;eo<280;++eo)hx[eo]=7;for(eo=280;eo<288;++eo)hx[eo]=8;var tk=new Fc(32);for(eo=0;eo<32;++eo)tk[eo]=5;var QV=dx(hx,9),JV=dx(tk,5),sS=function(o){for(var e=o[0],r=1;r<o.length;++r)o[r]>e&&(e=o[r]);return e},pd=function(o,e,r){var l=e/8|0;return(o[l]|o[l+1]<<8)>>(7&e)&r},oS=function(o,e){var r=e/8|0;return(o[r]|o[r+1]<<8|o[r+2]<<16)>>(7&e)},eU=function(o){return(o+7)/8|0},tU=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],md=function(o,e,r){var l=new Error(e||tU[o]);if(l.code=o,Error.captureStackTrace&&Error.captureStackTrace(l,md),!r)throw l;return l},rU=new Fc(0),nU=typeof TextDecoder<"u"&&new TextDecoder;try{nU.decode(rU,{stream:!0})}catch{}const iU={gzip_data:"gzip"};class Cu extends Error{constructor(e){super(e),this.name="MRTError"}}const sU={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},rk={uint32:1,uint16:2,uint8:4},oU={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let aS;class Nb{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new Cu(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),l=new DataView(e);if(r[0]!==13)throw new Cu("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),l=this.getHeaderLength(e);if(r.length<l)throw new Cu(`Expected header with length >= ${l} but got buffer of length ${r.length}`);const u=new aS(r.subarray(0,l)).readFields(OV,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Cu(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const m of u.layers)this.layers[m.name]=new nk(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const m=l.dataIndex[u],g=m.firstByte-e.firstByte,b=m.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const E={layerName:l.name,firstByte:g,lastByte:b,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[m.bands.length].concat(l.bandShape),buffer:l.buffer,codec:m.codec.codec,filters:m.filters.map(A=>A.filter)};l._blocksInProgress.add(u),r.push(E)}return new ik(r,()=>{r.forEach(u=>l._blocksInProgress.delete(u.blockIndex))},(u,m)=>{if(r.forEach(g=>l._blocksInProgress.delete(g.blockIndex)),u)throw u;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class nk{constructor({version:e,name:r,units:l,tileSize:u,pixelFormat:m,buffer:g,dataIndex:b},E){if(this.version=e,this.version!==1)throw new Cu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=l,this.tileSize=u,this.buffer=g,this.pixelFormat=sU[m],this.dataIndex=b,this.bandShape=[u+2*g,u+2*g,rk[this.pixelFormat]],this._decodedBlocks=new Pb(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return rk[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[m,g]of u.bands.entries())if(g===e)return{bandIndex:r+m,blockIndex:l,blockBandIndex:m};r+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new Cu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,l=-1/0;const u=[],m=new Set;for(const g of e){const{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new Cu(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[b];u.includes(b)||u.push(b),m.add(b),r=Math.min(r,E.firstByte),l=Math.max(l,E.lastByte)}if(m.size>this.cacheSize)throw new Cu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:l}=this.getBlockForBand(e);if(r<0)throw new Cu(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(r.toString());if(!u)throw new Cu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[r],g=this.bandShape.reduce((A,N)=>A*N,1),b=l*g,E=u.subarray(b,b+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}Nb.setPbf=function(o){aS=o};class ik{constructor(e,r,l){this.tasks=e,this._onCancel=r,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}Nb.performDecoding=function(o,e){const r=new Uint8Array(o);return Promise.all(e.tasks.map(l=>{const{layerName:u,firstByte:m,lastByte:g,pixelFormat:b,blockShape:E,blockIndex:A,filters:N,codec:j}=l,R=r.subarray(m,g+1),B=new Uint32Array(E[0]*E[1]*E[2]);let V;if(j!=="gzip_data")throw new Cu(`Unhandled codec: ${j}`);return V=(function(H,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve((xe=(function(Pe){Pe[0]==31&&Pe[1]==139&&Pe[2]==8||md(6,"invalid gzip data");var Ae=Pe[3],je=10;4&Ae&&(je+=2+(Pe[10]|Pe[11]<<8));for(var Oe=(Ae>>3&1)+(Ae>>4&1);Oe>0;Oe-=!Pe[je++]);return je+(2&Ae)})(K=H),xe+8>K.length&&md(6,"invalid gzip data"),(function(Pe,Ae,je,Oe){var ht=Pe.length;if(!ht||Ae.f&&!Ae.l)return je||new Fc(0);var at=!je,lt=at||Ae.i!=2,St=Ae.i;at&&(je=new Fc(3*ht));var bt=function(Ga){var Ah=je.length;if(Ga>Ah){var Pa=new Fc(Math.max(2*Ah,Ga));Pa.set(je),je=Pa}},wt=Ae.f||0,st=Ae.p||0,Et=Ae.b||0,gt=Ae.l,kt=Ae.d,Tt=Ae.m,lr=Ae.n,dr=8*ht;do{if(!gt){wt=pd(Pe,st,1);var Wt=pd(Pe,st+1,3);if(st+=3,!Wt){var Yt=Pe[(Qn=eU(st)+4)-4]|Pe[Qn-3]<<8,Fr=Qn+Yt;if(Fr>ht){St&&md(0);break}lt&&bt(Et+Yt),je.set(Pe.subarray(Qn,Fr),Et),Ae.b=Et+=Yt,Ae.p=st=8*Fr,Ae.f=wt;continue}if(Wt==1)gt=QV,kt=JV,Tt=9,lr=5;else if(Wt==2){var wr=pd(Pe,st,31)+257,nr=pd(Pe,st+10,15)+4,en=wr+pd(Pe,st+5,31)+1;st+=14;for(var kn=new Fc(en),li=new Fc(19),En=0;En<nr;++En)li[XV[En]]=pd(Pe,st+3*En,7);st+=3*nr;var Ai=sS(li),Kn=(1<<Ai)-1,Es=dx(li,Ai);for(En=0;En<en;){var Qn,Si=Es[pd(Pe,st,Kn)];if(st+=15&Si,(Qn=Si>>4)<16)kn[En++]=Qn;else{var ts=0,as=0;for(Qn==16?(as=3+pd(Pe,st,3),st+=2,ts=kn[En-1]):Qn==17?(as=3+pd(Pe,st,7),st+=3):Qn==18&&(as=11+pd(Pe,st,127),st+=7);as--;)kn[En++]=ts}}var ls=kn.subarray(0,wr),Cs=kn.subarray(wr);Tt=sS(ls),lr=sS(Cs),gt=dx(ls,Tt),kt=dx(Cs,lr)}else md(1);if(st>dr){St&&md(0);break}}lt&&bt(Et+131072);for(var Do=(1<<Tt)-1,ga=(1<<lr)-1,qs=st;;qs=st){var to=(ts=gt[oS(Pe,st)&Do])>>4;if((st+=15&ts)>dr){St&&md(0);break}if(ts||md(2),to<256)je[Et++]=to;else{if(to==256){qs=st,gt=null;break}var ho=to-254;to>264&&(ho=pd(Pe,st,(1<<(ms=XP[En=to-257]))-1)+JP[En],st+=ms);var bn=kt[oS(Pe,st)&ga],cs=bn>>4;if(bn||md(3),st+=15&bn,Cs=YV[cs],cs>3){var ms=KP[cs];Cs+=oS(Pe,st)&(1<<ms)-1,st+=ms}if(st>dr){St&&md(0);break}lt&&bt(Et+131072);var Gl=Et+ho;if(Et<Cs){var qa=0-Cs,Oo=Math.min(Cs,Gl);for(qa+Et<0&&md(3);Et<Oo;++Et)je[Et]=Oe[qa+Et]}for(;Et<Gl;++Et)je[Et]=je[Et-Cs]}}Ae.l=gt,Ae.p=qs,Ae.b=Et,Ae.f=wt,gt&&(wt=1,Ae.m=Tt,Ae.d=kt,Ae.n=lr)}while(!wt);return Et!=je.length&&at?(function(Ga,Ah,Pa){return(Pa==null||Pa>Ga.length)&&(Pa=Ga.length),new Fc(Ga.subarray(0,Pa))})(je,0,Et):je.subarray(0,Et)})(K.subarray(xe,-8),{i:2},new Fc(((ae=K)[(ue=ae.length)-4]|ae[ue-3]<<8|ae[ue-2]<<16|ae[ue-1]<<24)>>>0),re)));var K,re,ae,ue,xe;const ye=iU[Q];if(!ye)throw new Error(`Unhandled codec: ${Q}`);const Ie=new globalThis.DecompressionStream(ye);return new Response(new Blob([H]).stream().pipeThrough(Ie)).arrayBuffer().then(Pe=>new Uint8Array(Pe))})(R,j).then(H=>((function(Q,K){Q.readFields($V,K)})(new aS(H),B),new oU[b](B.buffer))),V.then(H=>{for(let Q=N.length-1;Q>=0;Q--)switch(N[Q]){case"delta_filter":GV(H,E);break;case"zigzag_filter":WV(H);break;case"bitshuffle_filter":HV(H,b);break;default:throw new Cu(`Unhandled filter "${N[Q]}"`)}return{layerName:u,blockIndex:A,data:H}}).catch(H=>{throw H})}))},hr(ik,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),hr(Nb,"MapboxRasterTile"),hr(nk,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class sk{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class ok{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ea(qt,16,0),this.featureIndexArray=new bh,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,l,u,m,g=0,b=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,m,g);const A=this.grid;for(let N=0;N<r.length;N++){const j=r[N],R=[1/0,1/0,-1/0,-1/0];for(let B=0;B<j.length;B++){const V=j[B];R[0]=Math.min(R[0],V.x),R[1]=Math.min(R[1],V.y),R[2]=Math.max(R[2],V.x),R[3]=Math.max(R[3],V.y)}b!==0&&(R[0]-=b,R[1]-=b,R[2]+=b,R[3]+=b),R[0]<qt&&R[1]<qt&&R[2]>=0&&R[3]>=0&&A.insert(E,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hi(new lb(this.rawTileData)).layers,this.sourceLayerCoder=new sk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:l,transform:u,tileTransform:m,pixelPosMatrix:g,availableImages:b,worldview:E}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const A=r.queryRadius?r.queryRadius:0,N=l.bufferedTilespaceBounds,j=this.grid.query(N.min.x,N.min.y,N.max.x,N.max.y,(H,Q,K,re)=>Kr(l.bufferedTilespaceGeometry,H-A,Q-A,K+A,re+A));j.sort(aU);let R=null;u.elevation&&j.length>0&&(R=gy.create(u.elevation,this.tileID));const B={};let V;for(let H=0;H<j.length;H++){const Q=j[H];if(Q===V)continue;V=Q;const K=this.featureIndexArray.get(Q);let re=null;this.is3DTile?this.loadMatchingModelFeature(B,K,e,l,u,E):this.loadMatchingFeature(B,K,e,b,E,(ae,ue,xe,ye=0)=>(re||(re=Gr(ae,this.tileID.canonical,m)),ue.queryIntersectsFeature(l,ae,xe,re,this.z,u,g,R,ye,r.scope)))}return B}loadMatchingFeature(e,r,l,u,m,g){const{featureIndex:b,bucketIndex:E,sourceLayerIndex:A,layoutVertexArrayOffset:N}=r,j=this.bucketLayerIDs[E],R=l.layers,B=Object.keys(R);if(B.length&&!Ir(B,j))return;const V=l.sourceCache,H=this.sourceLayerCoder.decode(A),Q=this.vtLayers[H].feature(b),K=this.getId(Q,H);for(let re=0;re<j.length;re++){const ae=j[re];if(!R[ae])continue;const{styleLayer:ue,targets:xe}=R[ae];let ye={};K!==void 0&&(ye=V.getFeatureState(ue.sourceLayer,K));const Ie=!g||g(Q,ue,ye,N);if(!Ie)continue;const Pe=new ug(Q,this.z,this.x,this.y,K);Pe.tile=this.tileID.canonical,Pe.state=ye;let Ae=this.serializedLayersCache.get(ae);Ae||(Ae=ue.serialize(),Ae.id=ae,this.serializedLayersCache.set(ae,Ae)),Pe.source=Ae.source,Pe.sourceLayer=Ae["source-layer"],Pe.layer=Object.assign({},Ae),Pe.layer.paint=ak(Ae.paint,ue.paint,Q,ye,u),Pe.layer.layout=ak(Ae.layout,ue.layout,Q,ye,u);let je=!1;for(const Oe of xe){this.updateFeatureProperties(Pe,Oe);const{filter:ht}=Oe;if(ht){if(Q.properties=Pe.properties,ht.needGeometry){const at=tn(Q,!0);if(!ht.filter(new bi(this.tileID.overscaledZ,{worldview:m}),at,this.tileID.canonical))continue}else if(!ht.filter(new bi(this.tileID.overscaledZ,{worldview:m}),Q))continue}je=!0,Oe.targetId&&this.addFeatureVariant(Pe,Oe)}je&&this.appendToResult(e,ae,b,Pe,Ie)}}loadMatchingModelFeature(e,r,l,u,m,g){const{featureIndex:b,bucketIndex:E}=r,A=this.bucketLayerIDs[E],N=l.layers,j=Object.keys(N);if(!j.length||Ir(j,A))for(let R=0;R<A.length;R++){const B=A[R],{styleLayer:V,targets:H}=N[B];if(V.type!=="model")continue;const Q=u.tile,K=Q.getBucket(V);if(!(K&&K instanceof Eb))continue;const re=pV(K,b,u,m);if(!re)continue;const{z:ae,x:ue,y:xe}=Q.tileID.canonical,{feature:ye,intersectionZ:Ie,position:Pe}=re;let Ae={};ye.id!==void 0&&(Ae=l.sourceCache.getFeatureState(V.sourceLayer,ye.id));const je=new ug({},ae,ue,xe,ye.id);je.tile=this.tileID.canonical,je.state=Ae,je.properties=ye.properties,je.geometry={type:"Point",coordinates:[Pe.lng,Pe.lat]};let Oe=this.serializedLayersCache.get(B);Oe||(Oe=V.serialize(),Oe.id=B,this.serializedLayersCache.set(B,Oe)),je.source=Oe.source,je.sourceLayer=Oe["source-layer"],je.layer=Object.assign({},Oe);let ht=!1;for(const at of H){this.updateFeatureProperties(je,at);const{filter:lt}=at;if(lt){if(ye.properties=je.properties,lt.needGeometry){if(!lt.filter(new bi(this.tileID.overscaledZ,{worldview:g}),ye,this.tileID.canonical))continue}else if(!lt.filter(new bi(this.tileID.overscaledZ,{worldview:g}),ye))continue}ht=!0,at.targetId&&this.addFeatureVariant(je,at)}ht&&this.appendToResult(e,B,b,je,Ie)}}updateFeatureProperties(e,r,l){if(r.properties){const u={};for(const m in r.properties){const g=r.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);g!=null&&(u[m]=g)}e.properties=u}}addFeatureVariant(e,r,l){const u={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(u)}appendToResult(e,r,l,u,m){let g=e[r];g===void 0&&(g=e[r]=[]),g.push({featureIndex:l,feature:u,intersectionZ:m})}lookupSymbolFeatures(e,r,l,u,m,g){const b={};this.loadVTLayers();for(const E of e)this.loadMatchingFeature(b,{bucketIndex:r,sourceLayerIndex:l,featureIndex:E,layoutVertexArrayOffset:0},u,m,g);return b}loadFeature(e){const{featureIndex:r,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),m=this.vtFeatures[u];if(m[r])return m[r];const g=this.vtLayers[u].feature(r);return m[r]=g,g}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const m=Qa(u);if(m.result!=="success"){const g=m.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void Rr(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function ak(o,e,r,l,u){return tr(o,(m,g)=>{const b=e instanceof ua?e.get(g):null;return b&&b.evaluate?b.evaluate(r,l,void 0,u):b})}function aU(o,e){return e-o}hr(ok,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const lk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lS{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const m=lk[15&l];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new lS(b,g,m,e)}constructor(e,r=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=lk.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return cS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:b}=this,E=[0,m.length-1,0],A=[];for(;E.length;){const N=E.pop()||0,j=E.pop()||0,R=E.pop()||0;if(j-R<=b){for(let Q=R;Q<=j;Q++){const K=g[2*Q],re=g[2*Q+1];K>=e&&K<=l&&re>=r&&re<=u&&A.push(m[Q])}continue}const B=R+j>>1,V=g[2*B],H=g[2*B+1];V>=e&&V<=l&&H>=r&&H<=u&&A.push(m[B]),(N===0?e<=V:r<=H)&&(E.push(R),E.push(B-1),E.push(1-N)),(N===0?l>=V:u>=H)&&(E.push(B+1),E.push(j),E.push(1-N))}return A}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:g}=this,b=[0,u.length-1,0],E=[],A=l*l;for(;b.length;){const N=b.pop()||0,j=b.pop()||0,R=b.pop()||0;if(j-R<=g){for(let Q=R;Q<=j;Q++)uk(m[2*Q],m[2*Q+1],e,r)<=A&&E.push(u[Q]);continue}const B=R+j>>1,V=m[2*B],H=m[2*B+1];uk(V,H,e,r)<=A&&E.push(u[B]),(N===0?e-l<=V:r-l<=H)&&(b.push(R),b.push(B-1),b.push(1-N)),(N===0?e+l>=V:r+l>=H)&&(b.push(B+1),b.push(j),b.push(1-N))}return E}}function cS(o,e,r,l,u,m){if(u-l<=r)return;const g=l+u>>1;ck(o,e,g,l,u,m),cS(o,e,r,l,g-1,1-m),cS(o,e,r,g+1,u,1-m)}function ck(o,e,r,l,u,m){for(;u>l;){if(u-l>600){const A=u-l+1,N=r-l+1,j=Math.log(A),R=.5*Math.exp(2*j/3),B=.5*Math.sqrt(j*R*(A-R)/A)*(N-A/2<0?-1:1);ck(o,e,r,Math.max(l,Math.floor(r-N*R/A+B)),Math.min(u,Math.floor(r+(A-N)*R/A+B)),m)}const g=e[2*r+m];let b=l,E=u;for(fx(o,e,l,r),e[2*u+m]>g&&fx(o,e,l,u);b<E;){for(fx(o,e,b,E),b++,E--;e[2*b+m]<g;)b++;for(;e[2*E+m]>g;)E--}e[2*l+m]===g?fx(o,e,l,E):(E++,fx(o,e,E,u)),E<=r&&(l=E+1),r<=E&&(u=E-1)}}function fx(o,e,r,l){uS(o,r,l),uS(e,2*r,2*l),uS(e,2*r+1,2*l+1)}function uS(o,e,r){const l=o[e];o[e]=o[r],o[r]=l}function uk(o,e,r,l){const u=o-r,m=e-l;return u*u+m*m}s.$=Bu,s.A=ba,s.B=yu,s.C=2,s.D=iy,s.E=Xs,s.F=K_,s.G=RI,s.H=hp,s.I=co,s.J=Zg,s.K=Xr,s.L=qr,s.M=Tp,s.N=Sp,s.O=_f,s.P=Nt,s.Q=td,s.R=qo,s.S=Dp,s.T=_1,s.U=Qa,s.V=Tb,s.W=lh,s.X=Kd,s.Y=Zu,s.Z=hf,s._=oa,s.a=function(o){return Qi.API_CDN_URL_REGEX.test(o)},s.a$=Pt,s.a0=Fd,s.a1=Fg,s.a2=Gm,s.a3=class extends Tb{},s.a4=xf,s.a5=Ju,s.a6=He,s.a7=function(o){const e=o.value;return e?Fd(e)?Y1(e,!0)?[]:[new Tb(o.key,e,`invalid url "${e}"`)]:[new Tb(o.key,e,`string expected, "${Xr(e)}" found`)]:[]},s.a8=od,s.a9=is,s.aA=Ee,s.aB=me,s.aC=Jt,s.aD=te,s.aE=mr,s.aF=Ge,s.aG=Ft,s.aH=function(o,e){const r={};for(let l=0;l<e.length;l++){const u=e[l];u in o&&(r[u]=o[u])}return r},s.aI=Me,s.aJ=it,s.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,r,l){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[m,g]=u.result;return this.scheduler?this.scheduler.add(()=>{l(m,g)},e):l(m,g),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=r((m,g)=>{u.result=[m,g];for(const b of u.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,g)},e):b(m,g);setTimeout(()=>delete this.entries[o],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(m=>m!==l),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},s.aL=function(o,e,r){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},u=>{const m=Uh(o.request,(g,b,E)=>{g?u(g):b&&u(null,{rawData:b,vectorTile:r?void 0:new hi(new lb(b)),responseHeaders:new Map(E.entries())})});return()=>{m.cancel(),u()}},e)},s.aM=function(o){return o?{cacheControl:o.get("Cache-Control"),expires:o.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=Ql,s.aO=function(o){_t++,_t>Rd&&(o.getActor().send("enforceCacheSizeLimit",eu),_t=0)},s.aP=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},s.aQ=ai,s.aR=hP,s.aS=_P,s.aT=_e,s.aU=dP,s.aV=function(o,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<o.length;l++){const u=document.createElement("source");$h(o[l])||(r.crossOrigin="Anonymous"),u.src=o[l],r.appendChild(u)}return{cancel:()=>{}}},s.aW=G_,s.aX=dg,s.aY=ct,s.aZ=J_,s.a_=mt,s.aa=zt,s.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return rs(o.expression.evaluate(e))}interpolate(o,e,r){return{x:$r(o.x,e.x,r),y:$r(o.y,e.y,r),z:$r(o.z,e.z,r),azimuthal:$r(o.azimuthal,e.azimuthal,r),polar:$r(o.polar,e.polar,r)}}},s.ac=bi,s.ad=Ja,s.ae=Kt,s.af=Sn,s.ag=Ar,s.ah=Fe,s.ai=ua,s.aj=Wp,s.ak=$r,s.al=qt,s.am=Am,s.an=vn,s.ao=ii,s.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return(function([r,l]){const u=rs([1,r,l]);return{x:u.x,y:u.y,z:u.z}})(o.expression.evaluate(e))}interpolate(o,e,r){return{x:$r(o.x,e.x,r),y:$r(o.y,e.y,r),z:$r(o.z,e.z,r)}}},s.aq=function(o,e,r=0,l=!0){const u=new Nt(r,r),m=o.sub(u),g=e.add(u),b=[m,new Nt(g.x,m.y),g,new Nt(m.x,g.y)];return l&&b.push(m.clone()),b},s.ar=function(o,e){const r=[];for(let l=0;l<o.length;l++){const u=et(l-1,-1,o.length-1),m=et(l+1,-1,o.length-1),g=o[l],b=o[m],E=o[u].sub(g).unit(),A=b.sub(g).unit(),N=A.angleWithSep(E.x,E.y),j=E.add(A).unit().mult(-1*e/Math.sin(N/2));r.push(g.add(j))}return r},s.as=KI,s.at=Kr,s.au=function(o,e,r=0){return Ut(((e.x-r)*o.scale-o.x)*qt,(e.y*o.scale-o.y)*qt,Qe(e.z,e.y))},s.av=Dr,s.aw=ir,s.ax=ji,s.ay=lI,s.az=function(o){let e=1/0,r=1/0,l=-1/0,u=-1/0;for(const m of o)e=Math.min(e,m.x),r=Math.min(r,m.y),l=Math.max(l,m.x),u=Math.max(u,m.y);return{min:new Nt(e,r),max:new Nt(l,u)}},s.b=function(o){return Qi.API_FONTS_REGEX.test(o)},s.b$=iA,s.b0=Os,s.b1=gc,s.b2=Ve,s.b3=$p,s.b4=vb,s.b5=function(){fl.isLoading()||fl.isLoaded()||kf()!=="deferred"||Lp()},s.b6=el,s.b7=tn,s.b8=ug,s.b9=Ii,s.bA=oe,s.bB=We,s.bC=he,s.bD=function(o,e){const{x:r,y:l}=o.point,u=xC(r,l,o.worldSize/o._pixelsPerMercatorPixel,0,0);return me(u,u,Bw(Th(e)))},s.bE=F,s.bF=pt,s.bG=yn,s.bH=Lr,s.bI=Ur,s.bJ=Hr,s.bK=dy,s.bL=ql,s.bM=L1,s.bN=function(o,e,r,l,u){const m=5*e+2;o.float32[m+0]=r,o.float32[m+1]=l,o.float32[m+2]=u},s.bO=my,s.bP=Ze,s.bQ=ki,s.bR=kr,s.bS=oo,s.bT=et,s.bU=function(o,e,r,l){var u=new L(4);return u[0]=o,u[1]=e,u[2]=r,u[3]=l,u},s.bV=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const r=e.getSource().maxzoom,l=1<<r,u=Math.floor(o.x),m=Math.floor((o.x-u)*l),g=Math.floor(o.y*l),b=this.findDEMTileFor(new ai(r,u,r,m,g));return!(!b||!b.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||o.y<0||o.y>1)return e;const u=l.getSource().maxzoom,m=1<<u,g=Math.floor(o.x),b=o.x-g,E=new ai(u,g,u,Math.floor(b*m),Math.floor(o.y*m)),A=this.findDEMTileFor(E);if(!A||!A.dem)return e;const N=A.dem,j=1<<A.tileID.canonical.z,R=(b*j-A.tileID.canonical.x)*N.dim,B=(o.y*j-A.tileID.canonical.y)*N.dim,V=Math.floor(R),H=Math.floor(B);return(r?this.exaggeration():1)*$r($r(N.get(V,H),N.get(V,H+1),B-H),$r(N.get(V+1,H),N.get(V+1,H+1),B-H),R-V)}static getAtTileOffset(o,e,r,l){const u=1<<o.canonical.z;return l?l.pointElevation(e):r?r.getAtPointOrZero(new Kt(o.wrap+(o.canonical.x+e.x/qt)/u,(o.canonical.y+e.y/qt)/u)):0}static getAtTileOffsetFunc(o,e,r,l){return(u,m,g)=>{const b=this.getAtTileOffset(o,u,m,g),E=l.upVector(o.canonical,u.x,u.y);return xr(E,E,b*l.upVectorScale(o.canonical,e,r).metersToTile),E}}getForTilePoints(o,e,r,l){if(this.isUsingMockSource())return!1;const u=gy.create(this,o,l);return!!u&&(e.forEach(m=>{m[2]=this.exaggeration()*u.getElevationAt(m[0],m[1],r)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const r=e.dem.tree,l=e.tileID,u=1<<o.canonical.z-l.canonical.z;let m=o.canonical.x/u-l.canonical.x,g=o.canonical.y/u-l.canonical.y,b=0;for(let E=0;E<o.canonical.z-l.canonical.z&&!r.leaves[b];E++){m*=2,g*=2;const A=2*Math.floor(g)+Math.floor(m);b=r.childOffsets[b]+A,m%=1,g%=1}return{min:this.exaggeration()*r.minimums[b],max:this.exaggeration()*r.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,r=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of o){const m=this.getMinMaxForTile(u.tileID);m&&(r=Math.min(r,m.min),l=Math.max(l,m.max),e=!0)}return e?{min:r,max:l}:null}},s.bW=Yv,s.bX=w,s.bY=So,s.bZ=eA,s.b_=xP,s.ba=A1,s.bb=n1,s.bc=Gr,s.bd=pc,s.be=Oc,s.bf=fC,s.bg=Zi,s.bh=ey,s.bi=Z1,s.bj=function(o,e){const r=Wp(e.zoom);if(r===0)return Th(o);const l=Ov(o),u=Fw(l),m=Ge(l.getWest())*e.worldSize,g=Ge(l.getEast())*e.worldSize,b=it(l.getNorth())*e.worldSize,E=it(l.getSouth())*e.worldSize,A=[m,b,0],N=[g,b,0],j=[m,E,0],R=[g,E,0],B=ve([],e.globeMatrix);return Sn(A,A,B),Sn(N,N,B),Sn(j,j,B),Sn(R,R,B),u[0]=Bf(u[0],j,r),u[1]=Bf(u[1],R,r),u[2]=Bf(u[2],N,r),u[3]=Bf(u[3],A,r),Wn.fromPoints(u)},s.bk=Fv,s.bl=ve,s.bm=A_,s.bn=Bf,s.bo=mc,s.bp=xB,s.bq=Ct,s.br=Se,s.bs=Nb,s.bt=lb,s.bu=Uh,s.bv=function(o,e){const r=[];for(const l in o)l in e||r.push(l);return r},s.bw=qe,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=us,s.bz=se,s.c=Hi,s.c$=function(o,e,r){let l=0;for(let u=0;u<2;++u)o[u]>0&&(l+=(o[u]-0)*(o[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},s.c0=sA,s.c1=j1,s.c2=VI,s.c3=B1,s.c4=lS,s.c5=xr,s.c6=Ke,s.c7=sn,s.c8=function(o,e,r){r*=.5;var l=e[0],u=e[1],m=e[2],g=e[3],b=Math.sin(r),E=Math.cos(r);return o[0]=l*E+u*b,o[1]=u*E-l*b,o[2]=m*E+g*b,o[3]=g*E-m*b,o},s.c9=Mn,s.cA=Rt,s.cB=Js,s.cC=HA,s.cD=Xn,s.cE=gC,s.cF=function(o,e,r,l,u,m,g,b,E){if(E.name==="globe")return gC(o,e,new Xn(r,l,u),!1);const A=J_({z:r,x:l,y:u},E);return new Wn([(m+A.x/A.scale)*e,e*(A.y/A.scale),g],[(m+A.x2/A.scale)*e,e*(A.y2/A.scale),b])},s.cG=function(o,e,r){return o[0]=Math.min(e[0],r[0]),o[1]=Math.min(e[1],r[1]),o[2]=Math.min(e[2],r[2]),o[3]=Math.min(e[3],r[3]),o},s.cH=function(o,e,r){return o[0]=Math.max(e[0],r[0]),o[1]=Math.max(e[1],r[1]),o[2]=Math.max(e[2],r[2]),o[3]=Math.max(e[3],r[3]),o},s.cI=function(o){const e=Math.round((o+45+360)%360/90)%4;return ne[e]},s.cJ=Le,s.cK=jt,s.cL=6,s.cM=function(o){const e=oe(new Float64Array(16));me(e,o.pixelMatrix,o.globeMatrix);const r=[0,pe,0],l=[0,de,0];return Sn(r,r,e),Sn(l,l,e),[r[0]>0&&r[0]<=o.width&&r[1]>0&&r[1]<=o.height&&!Uw(o,new _e(o.center.lat,90)),l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!Uw(o,new _e(o.center.lat,-90))]},s.cN=function(o,e){const{scale:r}=o.tileTransform,l=r*qt/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(u,m,g){var b=m[1],E=m[2],A=m[3],N=g[0],j=g[1];return u[0]=m[0]*N,u[1]=b*N,u[2]=E*j,u[3]=A*j,u})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},s.cO=rb,s.cP=$t,s.cQ=WA,s.cR=function(o){const e=WA(o,!0);return F([],[e[0],e[1],e[4],e[5]])},s.cS=Re,s.cT=es,s.cU=Be,s.cV=function(o){const{x:e,y:r}=o.point,{lng:l,lat:u}=o._center;return xC(e,r,o.worldSize,l,u)},s.cW=Qt,s.cX=$e,s.cY=Vl,s.cZ=on,s.c_=5,s.ca=Ni,s.cb=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},s.cc=rr,s.cd=function(o,e,r,l,u){var m=1/Math.tan(e/2);if(o[0]=m/r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,u!=null&&u!==1/0){var g=1/(l-u);o[10]=(u+l)*g,o[14]=2*u*l*g}else o[10]=-1,o[14]=-2*l;return o},s.ce=function(o,e,r,l,u,m,g){var b=1/(e-r),E=1/(l-u),A=1/(m-g);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*A,o[11]=0,o[12]=(e+r)*b,o[13]=(u+l)*E,o[14]=(g+m)*A,o[15]=1,o},s.cf=tt,s.cg=function(o,e,r){o[4*e+0]=r[0],o[4*e+1]=r[1],o[4*e+2]=r[2],o[4*e+3]=r[3]},s.ch=os,s.ci=Tu,s.cj=hs,s.ck=vo,s.cl=Eu,s.cm=tP,s.cn=function(){var o=new L(4);return L!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},s.co=function(o,e,r){var l=e[0],u=e[1],m=e[2],g=e[3],b=Math.sin(r),E=Math.cos(r);return o[0]=l*E+m*b,o[1]=u*E+g*b,o[2]=l*-b+m*E,o[3]=u*-b+g*E,o},s.cp=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},s.cq=Sr,s.cr=function(o){var e=o[0],r=o[1],l=o[2],u=o[3];return Math.sqrt(e*e+r*r+l*l+u*u)},s.cs=dn,s.ct=At,s.cu=Yo,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=Ti,s.d=function(o){return Qi.API_TILEJSON_REGEX.test(o)},s.d$=class{constructor(o,e,r,l){this.context=o,this.format=l,this.size=r,this.texture=o.gl.createTexture();const[u,m,g]=this.size,{gl:b}=o;b.bindTexture(b.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,u,m,g,0,g1(this.format),y1(this.format),e.data)}bind(o,e){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_3D,this.texture),o!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,o),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},s.d0=function(o){return o*o*o*o*o},s.d1=Ue,s.d2=45,s.d3=wh,s.d4=function(o,e,r){const l=Math.sqrt(o*o+e*e+r*r),u=l>0?Math.acos(r/l)*fo:0;let m=o!==0||e!==0?Math.atan2(-e,-o)*fo+90:0;return m<0&&(m+=360),[l,m,u]},s.d5=Ut,s.d6=rs,s.d7=Dt,s.d8=ut,s.d9=Wn,s.dA=function(o){return o({pluginStatus:uo,pluginURL:Mc}),Mp.on("pluginStateChange",o),o},s.dB=Sh,s.dC=class extends ha{constructor(o){super(o),this.current=Ff}set(o,e,r){if(this.fetchUniformLocation(o,e)){for(let l=0;l<9;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dD=ce,s.dE=function(o,e,r){const l=Wp(r.zoom),u=o.style.map._antialias,m=o.terrain&&o.terrain.exaggeration()>0;return l===0&&!u&&!m},s.dF=function(o){const e=o.pixelsPerMeter,r=e/tt(1,o.center.lat),l=oe(new Float64Array(16));return Se(l,l,[o.point.x,o.point.y,0]),Re(l,l,[r,r,e]),Float32Array.from(l)},s.dG=Ov,s.dH=function(o){const e=80.051129;o=Ee(o,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(vn(o))),3);return Math.round(r*(ge.length-1))},s.dI=function(o,e,r,l){const u=e.getNorth(),m=e.getSouth(),g=e.getWest(),b=e.getEast(),E=1<<o.z,A=b-g,N=u-m,j=A/le,R=-N/ge[r],B=[0,j,0,R,0,0,u,g,0];if(o.z>0){const V=180/l;ee(B,B,[V/A+1,0,0,0,V/N+1,0,-.5*V/j,.5*V/R,1])}return B[2]=E,B[5]=o.x,B[8]=o.y,B},s.dJ=Th,s.dK=function(o,e,r){const l=oe(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return rt(l,r.globeMatrix,u),Float32Array.from(l)},s.dL=jC,s.dM=Dv,s.dN=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},s.dO=W,s.dP=function(o,e){var r=Math.sin(e),l=Math.cos(e);return o[0]=l,o[1]=r,o[2]=0,o[3]=-r,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},s.dQ=Ci,s.dR=_C,s.dS=Oi,s.dT=js,s.dU=X1,s.dV=function(o,e){const r=[0,0,0];return Sn(r,r,Fv(Th(e.canonical))),Sn(r,r,o),r},s.dW=o=>({u_matrix:new Eu(o),u_texsize:new vo(o),u_pixels_to_tile_units:new t(o),u_device_pixel_ratio:new hs(o),u_width_scale:new hs(o),u_floor_width_scale:new hs(o),u_image:new os(o),u_units_to_pixels:new vo(o),u_tile_units_to_pixels:new hs(o),u_alpha_discard_threshold:new hs(o),u_trim_offset:new vo(o),u_trim_fade_range:new vo(o),u_trim_gradient_mix_range:new vo(o),u_trim_color:new wh(o),u_zbias_factor:new hs(o),u_tile_to_meter:new hs(o),u_ground_shadow_factor:new Tu(o),u_pattern_transition:new hs(o)}),s.dX=o=>({u_matrix:new Eu(o),u_pixels_to_tile_units:new t(o),u_device_pixel_ratio:new hs(o),u_width_scale:new hs(o),u_floor_width_scale:new hs(o),u_units_to_pixels:new vo(o),u_dash_image:new os(o),u_gradient_image:new os(o),u_image_height:new hs(o),u_texsize:new vo(o),u_tile_units_to_pixels:new hs(o),u_alpha_discard_threshold:new hs(o),u_trim_offset:new vo(o),u_trim_fade_range:new vo(o),u_trim_gradient_mix_range:new vo(o),u_trim_color:new wh(o),u_zbias_factor:new hs(o),u_tile_to_meter:new hs(o),u_ground_shadow_factor:new Tu(o)}),s.dY=o=>({u_camera_to_center_distance:new hs(o),u_extrude_scale:new t(o),u_device_pixel_ratio:new hs(o),u_matrix:new Eu(o),u_inv_rot_matrix:new Eu(o),u_merc_center:new vo(o),u_tile_id:new Tu(o),u_zoom_transition:new hs(o),u_up_dir:new Tu(o),u_emissive_strength:new hs(o)}),s.dZ=bu,s.d_=_5,s.da=Mt,s.db=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},s.dc=GA,s.dd=T1,s.de=KA,s.df=Y1,s.dg=function(o,e){return o.readFields(gV,{icons:[]},e)},s.dh=Qv,s.di=hy,s.dj=O1,s.dk=tu,s.dl=Pf,s.dm=jo,s.dn=wc,s.dp=Nr,s.dq=function(o){const e=o.indexOf(mh);return e>=0?o.slice(0,e):o},s.dr=function(o){return o.indexOf(mh)>=0},s.ds=function(o){const e=o.lastIndexOf(mh);return e>=0?o.slice(e+1):""},s.dt=function(o){const e=[],r=o.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.du=function(o,e,r,l){return o.type==="custom"?new uV(o,e):new mV[o.type](o,e,r,l)},s.dv=cr,s.dw=function(o){const e=o.indexOf(mh);return e>=0?o.slice(e+1):""},s.dx=class extends ug{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},s.dy=Mp,s.dz=Jl,s.e=Qi,s.e$=Xt,s.e0=wC,s.e1=(o,e,r,l,u,m)=>{const g=o.transform,b=g.projection.name==="globe";let E;if(m.paint.get("circle-pitch-alignment")==="map")if(b){const N=_C(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([N,0,0,N])}else E=g.calculatePixelsToTileUnitsMatrix(r);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(g.projection),u_matrix:o.translatePosMatrix(e.projMatrix,r,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Vn.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:TB,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){A.u_inv_rot_matrix=l,A.u_merc_center=u,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Wp(g.zoom);const N=u[0]*qt,j=u[1]*qt;A.u_up_dir=g.projection.upVector(new Xn(0,0,0),N,j)}return A},s.e2=hI,s.e3=wa,s.e4=(o,e,r,l,u,m,g,b,E,A)=>{const N=o.transform,j=N.pitch<15?cI(.07,.7,Ee((14-N.zoom)/5,0,1)):.07,R=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:dI(o,e,r,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:N.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:uI(e,N),u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:r.lut).toArray01(),u_zbias_factor:j,u_tile_to_meter:Dt(e.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:A}},s.e5=(o,e,r,l,u,m,g,b,E,A)=>{const N=o.transform,j=N.calculatePixelsToTileUnitsMatrix(e),R=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=N.pitch<15?cI(.07,.7,Ee((14-N.zoom)/5,0,1)):.07;return{u_matrix:dI(o,e,r,l),u_pixels_to_tile_units:j,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:b,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:fI(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uI(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:r.lut).toArray01(),u_zbias_factor:B,u_tile_to_meter:Dt(e.tileID.canonical,0),u_ground_shadow_factor:A}},s.e6=Xe,s.e7=I_,s.e8=Qe,s.e9=Ow,s.eA=function(o,e){var r=2*Math.acos(e[3]),l=Math.sin(r/2);return l>M?(o[0]=e[0]/l,o[1]=e[1]/l,o[2]=e[2]/l):(o[0]=1,o[1]=0,o[2]=0),r},s.eB=eS,s.eC=sb,s.eD=ib,s.eE=[1,1,1],s.eF=gy,s.eG=Je,s.eH=function(o,e,r,l){var u=e[0],m=e[1],g=e[2],b=e[3];return o[0]=u+l*(r[0]-u),o[1]=m+l*(r[1]-m),o[2]=g+l*(r[2]-g),o[3]=b+l*(r[3]-b),o},s.eI=ly,s.eJ=Aa,s.eK=Su,s.eL=function(o,e,r,l,u,m,g,b,E,A,N,j,R,B,V,H){var Q=new L(16);return Q[0]=o,Q[1]=e,Q[2]=r,Q[3]=l,Q[4]=u,Q[5]=m,Q[6]=g,Q[7]=b,Q[8]=E,Q[9]=A,Q[10]=N,Q[11]=j,Q[12]=R,Q[13]=B,Q[14]=V,Q[15]=H,Q},s.eM=ke,s.eN=dd,s.eO=wu,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Nt(1/0,1/0),max:new Nt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const r=rA(new Nt(0,0),new Nt(qt,qt),o),l=[];if(e&&!i1(r,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!i1(r,u))continue;const m=o4(u.min,u.max,o);l.push({min:m.min,max:m.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const r=o.getOrder(),l=o.getClipMask(),u=o.getClipScope();for(const m of e){if(!m.footprint)continue;const g=rA(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:r,clipMask:l,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||Hv(e.min,r.min)||Hv(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||(function(l,u){const m=(g,b)=>g+b;return l.length-u.length||l.reduce(m,"").localeCompare(u.reduce(m,""))})(e.clipScope,r.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const r=this._activeRegions[e],l=this._prevRegions[e];o=r.priority!==l.priority||!tA(r,l)||r.order!==l.order||r.clipMask!==l.clipMask||!us(r.clipScope,l.clipScope),this._activeRegions[e].hiddenByOverlap=l.hiddenByOverlap,++e}}if(o){++this._updateTime;for(const r of this._activeRegions)r.order!==D_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const l=this._activeRegions;if(r>=l.length)return r;const u=l[r].priority;for(;r<l.length&&l[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,l=e(r);for(;r!==l;){let u=r;const m=r;for(;u!==l;){const g=this._activeRegions[u];g.hiddenByOverlap=!1;for(let b=0;b<m;b++){const E=this._activeRegions[b];if(!E.hiddenByOverlap&&g.order===D_&&i1(g,E)&&(g.hiddenByOverlap=nA(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++u}r=l,l=e(r)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},s.eQ=D_,s.eR=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const r=new pc,l=new Os,u=[],m=o+1+2,g=e[0]+1,b=e[0]+1+(1+e.length),E=(A,N,j)=>{let R=A===m-1?A-2:A===0?A:A-1;return R+=j?24575:0,[R,N]};for(let A=0;A<m;++A)r.emplaceBack(...E(A,0,!0));for(let A=0;A<g;++A)for(let N=0;N<m;++N)r.emplaceBack(...E(N,A,(N===0||N===m-1)&&!0));for(let A=0;A<e.length;++A){const N=e[A];for(let j=0;j<m;++j)r.emplaceBack(...E(j,N,!0))}for(let A=0;A<e.length;++A){const N=l.length,j=e[A]+1+2,R=new Os;for(let H=0;H<j-1;H++){const Q=H===j-2,K=Q?m*(b-e.length+A-H):m;for(let re=0;re<m-1;re++){const ae=H*m+re;H===0||Q||re===0||re===m-2?(R.emplaceBack(ae+1,ae,ae+K),R.emplaceBack(ae+K,ae+K+1,ae+1)):(l.emplaceBack(ae+1,ae,ae+K),l.emplaceBack(ae+K,ae+K+1,ae+1))}}const B=Zi.simpleSegment(0,N,r.length,l.length-N);for(let H=0;H<R.uint16.length;H+=3)l.emplaceBack(R.uint16[H],R.uint16[H+1],R.uint16[H+2]);const V=Zi.simpleSegment(0,N,r.length,l.length-N);u.push({withoutSkirts:B,withSkirts:V})}return{vertices:r,indices:l,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(le,ge);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,fC.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new Os;for(let g=0;g<=le;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const r=new ud,l=new ud,u=new ud,m=new ud;this._poleSegments=[];for(let g=0,b=0;g<5;g++){const E=360/(1<<g);r.emplaceBack(0,-te,0,.5,0),l.emplaceBack(0,-te,0,.5,1),u.emplaceBack(0,-te,0,.5,.5),m.emplaceBack(0,-te,0,.5,.5);for(let A=0;A<=le;A++){let N=A/le,j=0;const R=$r(0,E,N),[B,V,H]=Ne(wB,SB,R,te);r.emplaceBack(B,V,H,N,j),l.emplaceBack(B,V,H,N,1-j);const Q=vn(R);N=.5+.5*Math.sin(Q),j=.5+.5*Math.cos(Q),u.emplaceBack(B,V,H,N,j),m.emplaceBack(B,V,H,N,1-j)}this._poleSegments.push(Zi.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(r,Lv,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,Lv,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,Lv,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(m,Lv,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},s.eS=s4,s.eT=be,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=De,s.eW=yt,s.eX=function(o,e,r){return o[0]=e[0]/r[0],o[1]=e[1]/r[1],o[2]=e[2]/r[2],o},s.eY=Vr,s.eZ=Ce,s.e_=Zr,s.ea=Kv,s.eb=yA,s.ec=Uf,s.ed=450,s.ee=7,s.ef=nt,s.eg=function(o,e){if(o===e){var r=e[1],l=e[2],u=e[3],m=e[6],g=e[7],b=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=r,o[6]=e[9],o[7]=e[13],o[8]=l,o[9]=m,o[11]=e[14],o[12]=u,o[13]=g,o[14]=b}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},s.eh=cV,s.ei=Tn,s.ej=Up,s.ek=256,s.el=Bw,s.em=ml,s.en=rt,s.eo=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},s.ep=ud,s.eq=Ba,s.er=hn,s.es=function(o,e,r,l,u){return Ee((o-e)/(r-e)*(u-l)+l,l,u)},s.et=Gi,s.eu=function(o,e){var r=e[0],l=e[1],u=e[2],m=e[3],g=e[4],b=e[5],E=e[6],A=e[7],N=e[8],j=N*g-b*A,R=-N*m+b*E,B=A*m-g*E,V=r*j+l*R+u*B;return V?(o[0]=j*(V=1/V),o[1]=(-N*l+u*A)*V,o[2]=(b*l-u*g)*V,o[3]=R*V,o[4]=(N*r-u*E)*V,o[5]=(-b*r+u*m)*V,o[6]=B*V,o[7]=(-A*r+l*E)*V,o[8]=(g*r-l*m)*V,o):null},s.ev=2,s.ew=Qr,s.ex=Or,s.ey=Zt,s.ez=function(o,e){var r=new L(3);Zt(r,e);var l=1/r[0],u=1/r[1],m=1/r[2],g=e[0]*l,b=e[1]*u,E=e[2]*m,A=e[4]*l,N=e[5]*u,j=e[6]*m,R=e[8]*l,B=e[9]*u,V=e[10]*m,H=g+N+V,Q=0;return H>0?(Q=2*Math.sqrt(H+1),o[3]=.25*Q,o[0]=(j-B)/Q,o[1]=(R-E)/Q,o[2]=(b-A)/Q):g>N&&g>V?(Q=2*Math.sqrt(1+g-N-V),o[3]=(j-B)/Q,o[0]=.25*Q,o[1]=(b+A)/Q,o[2]=(R+E)/Q):N>V?(Q=2*Math.sqrt(1+N-g-V),o[3]=(R-E)/Q,o[0]=(b+A)/Q,o[1]=.25*Q,o[2]=(j+B)/Q):(Q=2*Math.sqrt(1+V-g-N),o[3]=(b-A)/Q,o[0]=(R+E)/Q,o[1]=(j+B)/Q,o[2]=.25*Q),o},s.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},s.f0=function([o,e,r]){const l=Math.hypot(o,e,r),u=Math.atan2(o,r),m=.5*Math.PI-Math.acos(-e/l);return new _e($e(u),$e(m))},s.f1=yr,s.f2=x1,s.f3=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!(function(r){if(gn==null){const l=r.navigator?r.navigator.userAgent:null;gn=!!r.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return gn})(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(o,e){eu=o,Rd=e},s.f5=Uw,s.f6=vC,s.f7=function(o){const e=[0,0,0],r=oe(new Float64Array(16));return me(r,o.pixelMatrix,o.globeMatrix),Sn(e,e,r),new Nt(e[0],e[1])},s.f8=function(){const o=U_;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(u1),U_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){Qv().acquire(u1)},s.fA=kb,s.fB=Pn,s.fC=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==BA){const r=new Uint32Array(o,0,7),[,,l,u,m,g]=r;e=r.byteLength+u+m+g+m,(l!==o.byteLength||e>=o.byteLength)&&Rr("Invalid b3dm header information.")}return qA(o,e)},s.fD=function(o,e){const r=T1(o);for(const l of r){for(const u of l.meshes)B4(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(V4(l.lights,e)))}return r},s.fE=Eb,s.fF=Yi,s.fG=PA,s.fH=fl,s.fI=ca,s.fJ=function(o){Fs(),Rs?.then(e=>{e.keys().then(r=>{for(let l=0;l<r.length-o;l++)e.delete(r[l]).catch(u=>Rr(u.message))}).catch(r=>Rr(r.message))}).catch(e=>Rr(e.message))},s.fa=kf,s.fb=function(o,e,r=!1){if(uo===ca.deferred||uo===ca.loading||uo===ca.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mc=Vn.resolveURL(o),uo=ca.deferred,Rc=e,hh(),r||Lp()},s.fc=function(o){sy=Vn.resolveURL(o),oy||(oy=new iy(Qv(),new Xs)),oy.broadcast("setMeshoptUrl",sy)},s.fd=jA,s.fe=function(o){f1=Vn.resolveURL(o),oy||(oy=new iy(Qv(),new Xs)),oy.broadcast("setDracoUrl",f1)},s.ff=NA,s.fg=V_,s.fh=function(o){const e=La();if(!e)return;const r=e.delete(Il);o&&r.then(()=>o()).catch(o)},s.fi=ig,s.fj=hr,s.fk=Hp,s.fl=2,s.fm=sk,s.fn=ok,s.fo=sI,s.fp=On,s.fq="hd_road_elevation",s.fr=pa,s.fs=tr,s.ft=Vf,s.fu=D1,s.fv=1,s.fw=function(o,e,r,l,u,m,g,b=1,E,A,N,j){o.createArrays(),o.tilePixelRatio=qt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const R=o.layers[0].layout,B=o.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=b,V.textSizeScaleRange=R.get("text-size-scale-range"),V.iconSizeScaleRange=R.get("icon-size-scale-range");const[H,Q]=V.textSizeScaleRange,[K,re]=V.iconSizeScaleRange;V.textScaleFactor=Ee(V.scaleFactor,H,Q),V.iconScaleFactor=Ee(V.scaleFactor,K,re);const ae=B["text-size"],ue=B["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:je,maxZoom:Oe}=o.textSizeData;V.compositeTextSizes=[ae.possiblyEvaluate(new bi(je,{worldview:N}),m),ae.possiblyEvaluate(new bi(Oe,{worldview:N}),m)]}if(o.iconSizeData.kind==="composite"){const{minZoom:je,maxZoom:Oe}=o.iconSizeData;V.compositeIconSizes=[ue.possiblyEvaluate(new bi(je,{worldview:N}),m,j),ue.possiblyEvaluate(new bi(Oe,{worldview:N}),m,j)]}V.layoutTextSize=ae.possiblyEvaluate(new bi(g+1,{worldview:N}),m),V.layoutIconSize=ue.possiblyEvaluate(new bi(g+1,{worldview:N}),m,j),V.textMaxSize=ae.possiblyEvaluate(new bi(18,{worldview:N}),m);const xe=R.get("symbol-placement"),ye=R.get("text-rotation-alignment")==="map"&&xe!=="point",Ie=R.get("text-size");let Pe=!1;const Ae=[];for(const je of o.features){const Oe=R.get("text-font").evaluate(je,{},m).join(","),ht=Ie.evaluate(je,{},m)*V.textScaleFactor,at=V.layoutTextSize.evaluate(je,{},m)*V.textScaleFactor,lt=V.layoutIconSize.evaluate(je,{},m,j)*V.iconScaleFactor,St={horizontal:{},vertical:void 0},bt=je.text;let wt,st=[0,0];if(bt){const Kn=bt.toString(),Es=R.get("text-letter-spacing").evaluate(je,{},m)*So,Qn=R.get("text-line-height").evaluate(je,{},m)*So,Si=hl(Kn)?Es:0,ts=R.get("text-anchor").evaluate(je,{},m),as=R.get("text-variable-anchor");if(!as){const qs=R.get("text-radial-offset").evaluate(je,{},m);if(qs)st=VI(ts,[qs*So,F1]);else{const to=R.get("text-offset").evaluate(je,{},m);st=[to[0]*So,to[1]*So]}}let ls=ye?"center":R.get("text-justify").evaluate(je,{},m);const Cs=xe==="point",Do=Cs?R.get("text-max-width").evaluate(je,{},m)*So:1/0,ga=qs=>{o.allowVerticalPlacement&&dl(Kn)&&(St.vertical=N1(bt,e,r,u,Oe,Do,Qn,ts,qs,Si,st,ql.vertical,!0,at,ht,E))};if(!ye&&as){const qs=ls==="auto"?as.map(ho=>B1(ho)):[ls];let to=!1;for(let ho=0;ho<qs.length;ho++){const bn=qs[ho];if(!St.horizontal[bn])if(to)St.horizontal[bn]=St.horizontal[0];else{const cs=N1(bt,e,r,u,Oe,Do,Qn,"center",bn,Si,st,ql.horizontal,!1,at,ht,E);cs&&(St.horizontal[bn]=cs,to=cs.positionedLines.length===1)}}ga("left")}else{if(ls==="auto"&&(ls=B1(ts)),Cs||R.get("text-writing-mode").indexOf("horizontal")>=0||!dl(Kn)){const qs=N1(bt,e,r,u,Oe,Do,Qn,ts,ls,Si,st,ql.horizontal,!1,at,ht,E);qs&&(St.horizontal[ls]=qs)}ga(Cs?"left":ls)}}let Et,gt,kt,Tt,lr,dr,Wt=!1;const Yt=R.get("icon-text-fit").evaluate(je,{},m);if(je.icon&&je.icon.hasPrimary()){const Kn=Q_(je.icon,o.iconSizeData,B["icon-size"],m,o.zoom,je,E,V.iconScaleFactor,N,j);Et=Kn.iconPrimary,kt=Kn.iconSecondary;const Es=Et.toString();if(gt=l.get(Es),gt&&(lr=R.get("icon-offset").evaluate(je,{},m),dr=R.get("icon-anchor").evaluate(je,{},m),wt=ub(u.get(Es),kt?u.get(kt.toString()):void 0,lr,dr),Wt=gt.sdf,o.sdfIcons===void 0?o.sdfIcons=gt.sdf:o.sdfIcons!==gt.sdf&&Rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(gt.pixelRatio!==o.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),kt){const Qn=kt.toString();Tt=l.get(Qn)}}Pe=Pe||!(!je.icon||!je.icon.hasSecondary());const Fr=mb(St.horizontal)||St.vertical;o.iconsInText||(o.iconsInText=!!Fr&&Fr.iconsInText);const wr=at*V.textScaleFactor/So,{defaultShapedIcon:nr,verticallyShapedIcon:en}=X5(o,wt,R,je,m,St,wr,lr,Yt);Yt!=="none"&&wt&&(EI(wt)||CI(wt))&&(pb(0,gt,Et,wt,nr,Yt,A,l,u),pb(0,Tt,kt,wt,nr,Yt,A,l,u),en&&(pb(0,gt,Et,wt,en,Yt,A,l,u),pb(0,Tt,kt,wt,en,Yt,A,l,u))),wt=nr;const{iconBBox:kn,iconVerticalBBox:li,textBBox:En,textVerticalBBox:Ai}=q5(o,wt,en,R,je,m,lt,lr,V,u,dr,St,at,st,j);Ae.push({feature:je,shapedTextOrientations:St,shapedText:Fr,shapedIcon:wt,iconPrimary:Et,iconSecondary:kt,iconOffset:lr,iconAnchor:dr,verticallyShapedIcon:en,layoutTextSize:at,layoutIconSize:lt,textOffset:st,isSDFIcon:Wt,iconTextFit:Yt,iconCollisionBounds:kn,iconVerticalCollisionBounds:li,textCollisionBounds:En,textVerticalCollisionBounds:Ai})}return{featureData:Ae,sizes:V,hasAnySecondaryIcon:Pe,textAlongLine:ye,symbolPlacement:xe}},s.fx=MI,s.fy=function(o,e,r,l,u,m,g,b,E,A){o.iconAtlasPositions=A.iconPositions;const{featureData:N,hasAnySecondaryIcon:j,sizes:R,textAlongLine:B,symbolPlacement:V}=e;for(const H of N){const{shapedIcon:Q,verticallyShapedIcon:K,feature:re,shapedTextOrientations:ae,shapedText:ue,layoutTextSize:xe,textOffset:ye,isSDFIcon:Ie,iconPrimary:Pe,iconSecondary:Ae,iconTextFit:je,iconOffset:Oe,iconCollisionBounds:ht,iconVerticalCollisionBounds:at,textCollisionBounds:lt}=H;GI(Q,A.iconPositions,Pe,Ae),GI(K,A.iconPositions,Pe,Ae),Z5(ae,A.iconPositions),H5(Pe,Ae,A.iconPositions),(ue||Q)&&K5(o,re,ae,Q,K,E,R,xe,0,ye,Ie,l,u,g,b,j,je,Oe,B,V,ht,at,lt)}r&&o.generateCollisionDebugBuffers(m,o.collisionBoxArray,R.textScaleFactor)},s.fz=hi,s.g=function(o,e){return Jl(Object.assign(o,{method:"GET"}),e)},s.h=function(o){return o.indexOf("mapbox:")===0},s.i=function(o){return Qi.API_STYLE_REGEX.test(o)&&!Hi(o)},s.j=po,s.k=Tr,s.l=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(o,e){return Jl(Object.assign(o,{type:"json"}),e)},s.n=op,s.o=Vn,s.p=function(o,e){return Jl(Object.assign(o,{method:"POST"}),e)},s.q=ma,s.r=pn,s.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return d1||(d1=new ig("ImageRasterizer")),d1},s.u=function(){return(function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},s.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},s.w=Rr,s.x=iS,s.y=nu,s.z=tc}),v(["./shared"],function(s){function M($e){const ne=$e?$e.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function L($e){if(typeof $e=="number"||typeof $e=="boolean"||typeof $e=="string"||$e==null)return JSON.stringify($e);if(Array.isArray($e)){let ce="[";for(const be of $e)ce+=`${L(be)},`;return`${ce}]`}let ne="{";for(const ce of Object.keys($e).sort())ne+=`${ce}:${L($e[ce])},`;return`${ne}}`}function F($e){let ne="";for(const ce of s.bx)ne+=`/${L($e[ce])}`;return ne}function W($e,ne){return(function ce(be){return typeof be=="string"&&be===ne||(Array.isArray(be)?be.some(ce):!(!be||typeof be!="object")&&Object.values(be).some(ce))})($e)}class X{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ce){this._layerConfigs={},this._layers={},this.update(ne,[],ce)}update(ne,ce,be){this._options=be;for(const Ee of ne)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=s.du(Ee,this.scope,null,this._options)).compileFilter(be),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of ce)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const De=(function(Ee,Fe){const et={};for(let fe=0;fe<Ee.length;fe++){const Ve=Ee[fe];let Xe=Fe&&Fe[Ve.id];Xe||(Ve.type==="symbol"?Xe=Ve.id:(Xe=F(Ve),Ve.type==="line"&&Ve.paint&&W(Ve.paint["line-width"],"line-progress")&&(Xe+=`/${L(Ve.paint["line-width"])}`))),Fe&&(Fe[Ve.id]=Xe);let ct=et[Xe];ct||(ct=et[Xe]=[]),ct.push(Ve)}const qe=[];for(const fe in et)qe.push(et[fe]);return qe})(Object.values(this._layerConfigs),this.keyCache);for(const Ee of De){const Fe=Ee.map(ct=>this._layers[ct.id]),et=Fe[0];if(et.visibility==="none")continue;const qe=et.source||"";let fe=this.familiesBySource[qe];fe||(fe=this.familiesBySource[qe]={});const Ve=et.sourceLayer||"_geojsonTileLayer";let Xe=fe[Ve];Xe||(Xe=fe[Ve]=[]),Xe.push(Fe)}}}const ee=1*s.fl;class he{constructor(ne){const ce={},be=[];for(const et in ne){const qe=ne[et],fe=ce[et]={};for(const Ve in qe.glyphs){const Xe=qe.glyphs[+Ve];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const ct=Xe.metrics.localGlyph?ee:1,tr={x:0,y:0,w:Xe.bitmap.width+2*ct,h:Xe.bitmap.height+2*ct};be.push(tr),fe[Ve]=tr}}const{w:De,h:Ee}=s.G(be),Fe=new s.fk({width:De||1,height:Ee||1});for(const et in ne){const qe=ne[et];for(const fe in qe.glyphs){const Ve=qe.glyphs[+fe];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const Xe=ce[et][fe],ct=Ve.metrics.localGlyph?ee:1;s.fk.copy(Ve.bitmap,Fe,{x:0,y:0},{x:Xe.x+ct,y:Xe.y+ct},Ve.bitmap)}}this.image=Fe,this.positions=ce}}function se($e,ne,ce){$e[ne]?ce&&($e[ne].center=ce):$e[ne]={floorIds:new Set,center:ce||[0,0],floors:{}}}function oe($e,ne,ce,be){for(const De of ne)se($e,De),$e[De].floors[ce]=be,$e[De].floorIds.add(ce)}function ve($e){return{id:$e.properties.id.toString(),center:$e.properties.center.toString().split(";").map(Number)}}function me($e){return{id:$e.properties.id.toString(),isDefault:!!$e.properties.is_default&&$e.properties.is_default,connections:$e.properties.connected_floor_ids?new Set($e.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:$e.properties.conflicted_floor_ids?new Set($e.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:$e.properties.building_ids?new Set($e.properties.building_ids.toString().split(";")):new Set,name:$e.properties.name.toString(),zIndex:$e.properties.z_index}}function Se($e,ne){return ne.every(ce=>$e.properties&&$e.properties[ce]!=null)}function Re($e){return Se($e,["type","id","name"])&&$e.properties.type==="building"}function Be($e){return Se($e,["type","id","name","z_index"])&&$e.properties.type==="floor"}s.fj(he,"GlyphAtlas");class rt{constructor(ne){this.tileID=new s.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=s.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,ce,be,De,Ee,Fe){this.status="parsing",this.data=ne,this.collisionBoxArray=new s.b3;const et=new s.fm(Object.keys(ne.layers).sort()),qe=new s.fn(this.tileID,this.promoteId);qe.bucketLayerIDs=[];const fe={},Ve=new s.fo(256,256),Xe={featureIndex:qe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ve,availableImages:be,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Nr=this.indoor.indoorState.activeFloorsVisible,Ir=(function(jr,Rr,ni){const $i=(function(Ii,gn){if(!Ii)return s.w("No source layers defined in indoor specification"),gn;if(Ii.size===0)return gn;const Ni=Ii.difference(gn);for(const In of Ni)s.w(`Missing source layer required in indoor specification: ${In}`);return gn.intersection(gn)})(Rr.sourceLayers,new Set(Object.keys(jr.layers))),rs=Rr.indoorState,Yi=(function(Ii,gn,Ni,In){const di=new Set,Oi=new Set,js=new Set,bs=new Map,Qi={},po=Hi=>{const ws=bs.get(Hi)||new Set;for(const ra of di)if((bs.get(ra)||new Set).has(Hi)||ws.has(ra))return!0;return!1};for(const Hi of gn){const ws=Ii.layers[Hi];if(ws)for(let ra=0;ra<ws.length;ra++){const Uo=ws.feature(ra);if(Re(Uo)){const{id:lo,center:ot}=ve(Uo);se(Qi,lo,ot),di.add(lo);continue}if(Be(Uo)){const{id:lo,isDefault:ot,connections:br,conflicts:pn,buildings:Vn,name:$n,zIndex:jo}=me(Uo);oe(Qi,Vn,lo,{name:$n,zIndex:jo}),bs.set(lo,pn),(lo===In||br.has(In))&&di.add(lo),Oi.add(lo),ot&&js.add(lo)}}else s.w(`indoor source layer not found: ${Hi}`)}if(Ni)for(const Hi of Ni)Oi.has(Hi)&&(po(Hi)||di.add(Hi));for(const Hi of js)di.has(Hi)||po(Hi)||di.add(Hi);return{buildings:Qi,activeFloors:di}})(jr,$i,rs.lastActiveFloors,rs.selectedFloorId);return ni.send("setIndoorData",Yi),Yi})(ne,this.indoor,Ee);Xe.activeFloors=Nr?Ir.activeFloors:void 0}const ct=[],tr=ce.familiesBySource[this.source];for(const Nr in tr){const Ir=ne.layers[Nr];if(!Ir)continue;let jr=!1,Rr=!1,ni=!1;for(const gn of tr[Nr])gn[0].type==="symbol"?jr=!0:Rr=!0,gn[0].is3D()&&gn[0].type!=="model"&&(ni=!0);if(this.extraShadowCaster&&!ni||this.isSymbolTile===!0&&!jr||this.isSymbolTile===!1&&!Rr)continue;Ir.version===1&&s.w(`Vector tile source "${this.source}" layer "${Nr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $i=et.encode(Nr),rs=[],Yi=this.localizableLayerIds&&this.localizableLayerIds.has(Nr);let Ii=!1;for(let gn=0,Ni=0;gn<Ir.length;gn++){const In=Ir.feature(gn),di=qe.getId(In,Nr),Oi=In.properties?In.properties.worldview:null;if(Yi&&this.worldview&&typeof Oi=="string")if(Oi==="all")In.properties.$localized=!0;else{if(!Oi.split(",").includes(this.worldview))continue;In.properties.$localized=!0,In.properties.worldview=this.worldview}!Ii&&In.properties&&In.properties.hasOwnProperty(s.fp)&&(Ii=!0),rs.push({feature:In,id:di,index:Ni,sourceLayerIndex:$i}),Ni++}Ii&&!Xe.elevationFeatures&&ne.layers.hasOwnProperty(s.fq)&&(Xe.elevationFeatures=s.fr.parseFrom(ne.layers[s.fq],this.canonical));for(const gn of tr[Nr]){const Ni=gn[0];if(this.extraShadowCaster&&(!Ni.is3D()||Ni.type==="model")||this.isSymbolTile!==void 0&&Ni.type==="symbol"!==this.isSymbolTile||Ni.minzoom&&this.zoom<Math.floor(Ni.minzoom)||Ni.maxzoom&&this.zoom>=Ni.maxzoom||Ni.visibility==="none")continue;We(gn,this.zoom,Xe.brightness,be,this.worldview);const In=fe[Ni.id]=Ni.createBucket({index:qe.bucketLayerIDs.length,layers:gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$i,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:De,worldview:this.worldview,localizable:Yi,availableImages:be});qe.bucketLayerIDs.push(gn.map(Oi=>s.B(Oi.id,Oi.scope)));let di=In.prepare?In.prepare():null;di!=null?(di=di.then(()=>In.populate(rs,Xe,this.tileID.canonical,this.tileTransform)),ct.push(di)):In.populate(rs,Xe,this.tileID.canonical,this.tileTransform)}}const cr=()=>{let Nr,Ir,jr,Rr,ni,$i;Ve.trim();const rs={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Yi=()=>{if(Nr)return this.status="done",Fe(Nr);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(fe).filter(gn=>!gn.isEmpty()),featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ir&&jr&&Rr){const gn=new he(Ir),Ni=new Map;for(const[Oi,js]of jr.entries()){const{imagePosition:bs}=s.fu(Oi,js,s.fv);Ni.set(Oi,bs)}const In={};for(const Oi in fe){const js=fe[Oi];js instanceof s.b4&&(We(js.layers,this.zoom,Xe.brightness,be,this.worldview),In[Oi]=s.fw(js,Ir,gn.positions,jr,Ni,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ni,this.worldview,be))}const di={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ee,jr,ni,()=>{di.iconsPending=!1,Ii(In,gn,di)}),this.rasterizeIfNeeded(Ee,Rr,$i,()=>{di.patternsPending=!1,Ii(In,gn,di)})}},Ii=(gn,Ni,In,di)=>{if(In.iconsPending||In.patternsPending)return;const Oi=new s.fx(jr,Rr,this.lut);for(const js in fe){const bs=fe[js];if(js in gn)s.fy(bs,gn[js],this.showCollisionBoxes,be,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,jr,Oi);else if(bs.hasPattern&&(bs instanceof s.ba||bs instanceof s.bb||bs instanceof s.ea)){We(bs.layers,this.zoom,Xe.brightness,be,this.worldview);const Qi=Object.fromEntries(Oi.patternPositions);bs.addFeatures(Xe,this.tileID.canonical,Qi,be,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(fe).filter(js=>!js.isEmpty()),featureIndex:qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ni.image,lineAtlas:Ve,imageAtlas:Oi,brightness:Xe.brightness})};if(!this.extraShadowCaster){const gn=s.fs(Xe.glyphDependencies,di=>Object.keys(di).map(Number));Object.keys(gn).length?Ee.send("getGlyphs",{uid:this.uid,stacks:gn},(di,Oi)=>{Nr||(Nr=di,Ir=Oi,Yi())},void 0,!1,rs):Ir={};const Ni=Array.from(Xe.iconDependencies.keys()).map(di=>s.I.parse(di));Ni.length?Ee.send("getImages",{images:Ni,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(di,Oi)=>{Nr||(Nr=di,jr=new Map,ni=this.updateImageMapAndGetImageTaskQueue(jr,Oi,Xe.iconDependencies),Yi())},void 0,!1,rs):(jr=new Map,ni=new Map);const In=Array.from(Xe.patternDependencies.keys()).map(di=>s.I.parse(di));In.length?Ee.send("getImages",{images:In,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(di,Oi)=>{Nr||(Nr=di,Rr=new Map,$i=this.updateImageMapAndGetImageTaskQueue(Rr,Oi,Xe.patternDependencies),Yi())},void 0,!1,rs):(Rr=new Map,$i=new Map)}if(Xe.elevationFeatures&&Xe.elevationFeatures.length>0){const gn=[];for(const In of Object.values(fe))if(In instanceof s.bb){const di=In.getUnevaluatedPortalGraph();di&&gn.push(di)}const Ni=s.ft.evaluate(gn);for(const In of Object.values(fe))if(In instanceof s.bb){const di=ne.layers[et.decode(In.sourceLayerIndex)];In.setEvaluatedPortalGraph(Ni,di,this.tileID.canonical,Xe.availableImages,Xe.brightness)}}Yi()};ct.length>0?Promise.allSettled(ct).then(cr).catch(Fe):cr()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=s.aZ(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,ce,be,De){Array.from(ce.values()).some(Ee=>Ee.usvg)?this.rasterize(ne,ce,be,De):De()}updateImageMapAndGetImageTaskQueue(ne,ce,be){const De=new Map;for(const Ee of ce.keys()){const Fe=be.get(Ee)||[];for(const et of Fe){const qe=et.toString(),fe=ce.get(et.id.toString());fe.usvg?De.has(qe)||(De.set(qe,et),ne.set(qe,Object.assign({},fe))):ne.set(qe,fe)}}return De}rasterize(ne,ce,be,De){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:be},(Ee,Fe)=>{if(!Ee)for(const[et,qe]of Fe.entries()){const fe=Object.assign(ce.get(et),{data:qe});ce.set(et,fe)}De()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function We($e,ne,ce,be,De){const Ee=new s.ac(ne,{brightness:ce,worldview:De});for(const Fe of $e)Fe.recalculate(Ee,be)}class Ct extends s.E{constructor(ne,ce,be,De,Ee,Fe,et){super(),this.actor=ne,this.layerIndex=ce,this.availableImages=be,this.availableModels=De,this.loadVectorData=Fe||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ne.scheduler),this.isSpriteLoaded=Ee,this.scheduler=ne.scheduler,this.brightness=et}loadTile(ne,ce){const be=ne.uid,De=ne&&ne.request,Ee=De&&De.collectResourceTiming,Fe=this.loading[be]=new rt(ne);Fe.abort=this.loadVectorData(ne,(et,qe)=>{const fe=!this.loading[be];if(delete this.loading[be],Fe.cancelRasterize(),fe||et||!qe)return Fe.status="done",fe||(this.loaded[be]=Fe),ce(et);const Ve=qe.rawData,Xe={},ct=s.aM(qe.responseHeaders);ct&&ct.expires&&(Xe.expires=ct.expires),ct&&ct.cacheControl&&(Xe.cacheControl=ct.cacheControl),Fe.vectorTile=qe.vectorTile||new s.fz(new s.bt(Ve));const tr=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(cr,Nr)=>{if(cr||!Nr)return ce(cr);const Ir={};if(Ee){const jr=M(De);jr.length>0&&(Ir.resourceTiming=JSON.parse(JSON.stringify(jr)))}ce(null,Object.assign({rawTileData:Ve.slice(0),responseHeaders:qe.responseHeaders},Nr,Xe,Ir))})};this.isSpriteLoaded?tr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(tr,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):tr()}),this.loaded=this.loaded||{},this.loaded[be]=Fe})}reloadTile(ne,ce){const be=this.loaded,De=ne.uid;if(be&&be[De]){const Ee=be[De];Ee.updateParameters(ne);const Fe=(et,qe)=>{const fe=Ee.reloadCallback;fe&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,fe)),ce(et,qe)};Ee.status==="parsing"?Ee.reloadCallback=Fe:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else ce(null,void 0)}abortTile(ne,ce){const be=ne.uid,De=this.loading[be];De&&(De.abort&&De.abort(),delete this.loading[be]),ce()}removeTile(ne,ce){const be=this.loaded,De=ne.uid;be&&be[De]&&delete be[De],ce()}}class Ht{loadTile(ne,ce){const{uid:be,encoding:De,rawImageData:Ee,padding:Fe}=ne,et=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,Fe):Ee;ce(null,new s.fA(be,et,De,Fe<1))}reloadTile(ne,ce){ce(null,null)}abortTile(ne,ce){ce()}removeTile(ne,ce){ce()}getImageData(ne,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const be=this.offscreenCanvasContext.getImageData(-ce,-ce,ne.width+2*ce,ne.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),be}}s.bs.setPbf(s.bt);class Zt{constructor(ne){this._mrt=new s.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ce){const be=this._mrt;this.status="parsing",this._entireBuffer=ne;try{be.parseHeader(ne),this._isHeaderLoaded=!0;const De=[];for(const Ee in be.layers){const Fe=be.getLayer(Ee),et=Fe.getDataRange(Fe.getBandList()),qe=be.createDecodingTask(et),fe=ne.slice(et.firstByte,et.lastByte+1),Ve=s.bs.performDecoding(fe,qe).then(Xe=>qe.complete(null,Xe)).catch(Xe=>qe.complete(Xe,null));De.push(Ve)}Promise.allSettled(De).then(()=>ce(null,be)).catch(Ee=>ce(Ee))}catch(De){ce(De)}}}class rr{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ce){const be=ne.uid,De=ne.request,Ee=this.loading[be]=new Zt(ne),{cancel:Fe}=s.bu(De,(et,qe,fe)=>{const Ve=!this.loading[be];if(delete this.loading[be],Ve||et||!qe)return Ee.status="done",Ve||(this.loaded[be]=Ee),ce(et);Ee.parse(qe,(Xe,ct)=>{if(Xe||!ct)return ce(Xe);ce(null,ct,fe)}),this.loaded[be]=Ee});Ee.abort=Fe}reloadTile(ne,ce){ce(null,void 0)}abortTile(ne,ce){const be=ne.uid,De=this.loading[be];De&&(De.abort&&De.abort(),delete this.loading[be]),ce()}removeTile(ne,ce){const be=ne.uid;this.loaded[be]&&delete this.loaded[be],ce()}decodeRasterArray(ne,ce){s.bs.performDecoding(ne.buffer,ne.task).then(be=>ce(null,be)).catch(be=>ce(be))}}const $t=s.fB.prototype.toGeoJSON;class Rt{constructor(ne){this._feature=ne,this.extent=s.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ce of this._feature.geometry)ne.push([new s.P(ce[0],ce[1])]);return ne}{const ne=[];for(const ce of this._feature.geometry){const be=[];for(const De of ce)be.push(new s.P(De[0],De[1]));ne.push(be)}return ne}}toGeoJSON(ne,ce,be){return $t.call(this,ne,ce,be)}}class Gt{constructor(ne,ce){this.name=ne,this.extent=s.al,this.length=ce.length,this._jsonFeatures=ce}feature(ne){return new Rt(this._jsonFeatures[ne])}}class Ar{constructor(ne){this.layers={},this.extent=s.al;for(const ce of Object.keys(ne))this.layers[ce]=new Gt(ce,ne[ce])}}const Ut=64/4096;class Xt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ce){for(const be of ne){const De=be.id;if(De==null)continue;let Ee=this.features.get(De);Ee&&this.updateCache(Ee,ce),be.geometry?(Ee=Mt(be),this.updateCache(Ee,ce),this.features.set(De,Ee)):this.features.delete(De),this.updateCache(Ee,ce)}}updateCache(ne,ce){for(const{canonical:be,uid:De}of Object.values(ce)){const{z:Ee,x:Fe,y:et}=be;ut(ne,Math.pow(2,Ee),Fe,et)&&delete ce[De]}}getTile(ne,ce,be){const De=Math.pow(2,ne),Ee=[];for(const Fe of this.features.values())ut(Fe,De,ce,be)&&Ee.push(xr(Fe,De,ce,be));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function ut({minX:$e,minY:ne,maxX:ce,maxY:be},De,Ee,Fe){return $e<(Ee+1+Ut)/De&&ne<(Fe+1+Ut)/De&&ce>(Ee-Ut)/De&&be>(Fe-Ut)/De}function Mt($e){const{id:ne,geometry:ce,properties:be}=$e;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:Ee}=ce,Fe={id:ne,type:1,geometry:[],tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=Fe.geometry;if(De==="Point")Qt(Ee,et,Fe);else if(De==="MultiPoint")for(const qe of Ee)Qt(qe,et,Fe);else if(De==="LineString")Fe.type=2,ze(Ee,et,Fe);else if(De==="MultiLineString")Fe.type=2,It(Ee,et,Fe);else if(De==="Polygon")Fe.type=3,It(Ee,et,Fe,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const qe of Ee)It(qe,et,Fe,!0)}return Fe}function Qt([$e,ne],ce,be){const De=s.aF($e);let Ee=s.aJ(ne);Ee=Ee<0?0:Ee>1?1:Ee,ce.push(De,Ee),be.minX=Math.min(be.minX,De),be.minY=Math.min(be.minY,Ee),be.maxX=Math.max(be.maxX,De),be.maxY=Math.max(be.maxY,Ee)}function ze($e,ne,ce,be=!1,De=!1){const Ee=[];for(const Fe of $e)Qt(Fe,Ee,ce);ne.push(Ee),be&&(function(Fe,et){let qe=0;for(let fe=0,Ve=Fe.length,Xe=Ve-2;fe<Ve;Xe=fe,fe+=2)qe+=(Fe[fe]-Fe[Xe])*(Fe[fe+1]+Fe[Xe+1]);if(qe>0===et)for(let fe=0,Ve=Fe.length;fe<Ve/2;fe+=2){const Xe=Fe[fe],ct=Fe[fe+1];Fe[fe]=Fe[Ve-2-fe],Fe[fe+1]=Fe[Ve-1-fe],Fe[Ve-2-fe]=Xe,Fe[Ve-1-fe]=ct}})(Ee,De)}function It($e,ne,ce,be=!1){for(let De=0;De<$e.length;De++)ze($e[De],ne,ce,be,De===0)}function xr($e,ne,ce,be){const{id:De,type:Ee,geometry:Fe,tags:et}=$e,qe=[];if(Ee===1)(function(fe,Ve,Xe,ct,tr){for(let cr=0;cr<fe.length;cr+=2){const Nr=Math.round(s.al*(fe[cr+0]*Ve-Xe)),Ir=Math.round(s.al*(fe[cr+1]*Ve-ct));tr.push([Nr,Ir])}})(Fe,ne,ce,be,qe);else if(Ee===2)for(const fe of Fe)Lr(fe,ne,ce,be,qe);else if(Ee===3)for(const fe of Fe)yn(fe,ne,ce,be,qe);return{id:De,type:Ee,geometry:qe,tags:et}}function Lr($e,ne,ce,be,De){const Fe=s.al+128;let et;for(let qe=0;qe<$e.length-2;qe+=2){let fe=Math.round(s.al*($e[qe+0]*ne-ce)),Ve=Math.round(s.al*($e[qe+1]*ne-be)),Xe=Math.round(s.al*($e[qe+2]*ne-ce)),ct=Math.round(s.al*($e[qe+3]*ne-be));const tr=Xe-fe,cr=ct-Ve;fe<-128&&Xe<-128||(fe<-128?(Ve+=Math.round(cr*((-128-fe)/tr)),fe=-128):Xe<-128&&(ct=Ve+Math.round(cr*((-128-fe)/tr)),Xe=-128),Ve<-128&&ct<-128||(Ve<-128?(fe+=Math.round(tr*((-128-Ve)/cr)),Ve=-128):ct<-128&&(Xe=fe+Math.round(tr*((-128-Ve)/cr)),ct=-128),fe>=Fe&&Xe>=Fe||(fe>=Fe?(Ve+=Math.round(cr*((Fe-fe)/tr)),fe=Fe):Xe>=Fe&&(ct=Ve+Math.round(cr*((Fe-fe)/tr)),Xe=Fe),Ve>=Fe&&ct>=Fe||(Ve>=Fe?(fe+=Math.round(tr*((Fe-Ve)/cr)),Ve=Fe):ct>=Fe&&(Xe=fe+Math.round(tr*((Fe-Ve)/cr)),ct=Fe),et&&fe===et[et.length-1][0]&&Ve===et[et.length-1][1]||(et=[[fe,Ve]],De.push(et)),et.push([Xe,ct])))))}}function yn($e,ne,ce,be,De){const Ee=(ce-Ut)/ne,Fe=(be-Ut)/ne,et=(ce+1+Ut)/ne,qe=(be+1+Ut)/ne;function fe(ct,tr){let cr=0;return ct<Ee?cr|=1:ct>et&&(cr|=2),tr<Fe?cr|=4:tr>qe&&(cr|=8),cr}let Ve=[];for(let ct=1;ct<=8;ct*=2){let tr=$e[$e.length-2],cr=$e[$e.length-1],Nr=!(fe(tr,cr)&ct);for(let Ir=0;Ir<$e.length;Ir+=2){const jr=$e[Ir],Rr=$e[Ir+1],ni=!(fe(jr,Rr)&ct);ni!==Nr&&(8&ct?Ve.push(tr+(jr-tr)*(qe-cr)/(Rr-cr),qe):4&ct?Ve.push(tr+(jr-tr)*(Fe-cr)/(Rr-cr),Fe):2&ct?Ve.push(et,cr+(Rr-cr)*(et-tr)/(jr-tr)):1&ct&&Ve.push(Ee,cr+(Rr-cr)*(Ee-tr)/(jr-tr))),ni&&Ve.push(jr,Rr),tr=jr,cr=Rr,Nr=ni}if(!($e=Ve).length||ct===8)break;Ve=[]}const Xe=[];for(let ct=0;ct<Ve.length;ct+=2)Xe.push([Math.round(s.al*(Ve[ct]*ne-ce)),Math.round(s.al*(Ve[ct+1]*ne-be))]);Xe.length&&De.push(Xe)}function Yr({name:$e,features:ne},ce){ce.writeStringField(1,$e),ce.writeVarintField(5,s.al);const be=new Map,De=new Map,Ee={keys:be,values:De,feature:null};for(const Fe of ne)Ee.feature=Fe,ce.writeMessage(2,Zr,Ee);for(const Fe of be.keys())ce.writeStringField(3,Fe);for(const Fe of De.keys())ce.writeMessage(4,Ti,Fe)}function Zr($e,ne){const ce=$e.feature;ce.id!==void 0&&Number.isSafeInteger(+ce.id)&&ne.writeVarintField(1,+ce.id),ce.tags&&ne.writeMessage(2,Qr,$e),ne.writeVarintField(3,ce.type),ne.writeMessage(4,Ur,ce)}function Qr({keys:$e,values:ne,feature:ce},be){for(const De of Object.keys(ce.tags)){let Ee=ce.tags[De];if(Ee===null)continue;let Fe=$e.get(De);Fe===void 0&&(Fe=$e.size,$e.set(De,Fe)),be.writeVarint(Fe);const et=typeof Ee;et!=="string"&&et!=="boolean"&&et!=="number"&&(Ee=JSON.stringify(Ee));let qe=ne.get(Ee);qe===void 0&&(qe=ne.size,ne.set(Ee,qe)),be.writeVarint(qe)}}function ir($e,ne){return(ne<<3)+(7&$e)}function Hr($e){return $e<<1^$e>>31}function Ur($e,ne){const{geometry:ce,type:be}=$e;let De=0,Ee=0;if(be===1){ne.writeVarint(ir(1,ce.length));for(const Fe of ce){const et=Fe[0]-De,qe=Fe[1]-Ee;ne.writeVarint(Hr(et)),ne.writeVarint(Hr(qe)),De+=et,Ee+=qe}}else for(const Fe of ce){if(Fe.length===0)continue;ne.writeVarint(ir(1,1));const et=Fe.length-(be===3?1:0);for(let qe=0;qe<et;qe++){qe===1&&ne.writeVarint(ir(2,et-1));const fe=Fe[qe][0]-De,Ve=Fe[qe][1]-Ee;ne.writeVarint(Hr(fe)),ne.writeVarint(Hr(Ve)),De+=fe,Ee+=Ve}be===3&&ne.writeVarint(ir(7,1))}}function Ti($e,ne){const ce=typeof $e;ce==="string"?ne.writeStringField(1,$e):ce==="boolean"?ne.writeBooleanField(7,$e):ce==="number"&&($e%1!=0?ne.writeDoubleField(3,$e):$e<0?ne.writeSVarintField(6,$e):ne.writeVarintField(5,$e))}const Sn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$e=>$e},Ci=Math.fround||(At=new Float32Array(1),$e=>(At[0]=+$e,At[0]));var At;class pt{constructor(ne){this.options=Object.assign(Object.create(Sn),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:be,maxZoom:De}=this.options;ce&&console.time("total time");const Ee=`prepare ${ne.length} points`;ce&&console.time(Ee),this.points=ne;const Fe=[];for(let qe=0;qe<ne.length;qe++){const fe=ne[qe];if(!fe.geometry)continue;const[Ve,Xe]=fe.geometry.coordinates,ct=Ci(Vr(Ve)),tr=Ci(Ke(Xe));Fe.push(ct,tr,1/0,qe,-1,1),this.options.reduce&&Fe.push(0)}let et=this.trees[De+1]=this._createTree(Fe);ce&&console.timeEnd(Ee);for(let qe=De;qe>=be;qe--){const fe=+Date.now();et=this.trees[qe]=this._createTree(this._cluster(et,qe)),ce&&console.log("z%d: %d clusters in %dms",qe,et.numItems,+Date.now()-fe)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let be=((ne[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ne[1]));let Ee=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)be=-180,Ee=180;else if(be>Ee){const Xe=this.getClusters([be,De,180,Fe],ce),ct=this.getClusters([-180,De,Ee,Fe],ce);return Xe.concat(ct)}const et=this.trees[this._limitZoom(ce)],qe=et.range(Vr(be),Ke(Fe),Vr(Ee),Ke(De)),fe=et.data,Ve=[];for(const Xe of qe){const ct=this.stride*Xe;Ve.push(fe[ct+5]>1?Sr(fe,ct,this.clusterProps):this.points[fe[ct+3]])}return Ve}getChildren(ne){const ce=this._getOriginId(ne),be=this._getOriginZoom(ne),De="No cluster with the specified id.",Ee=this.trees[be];if(!Ee)throw new Error(De);const Fe=Ee.data;if(ce*this.stride>=Fe.length)throw new Error(De);const et=this.options.radius/(this.options.extent*Math.pow(2,be-1)),qe=Ee.within(Fe[ce*this.stride],Fe[ce*this.stride+1],et),fe=[];for(const Ve of qe){const Xe=Ve*this.stride;Fe[Xe+4]===ne&&fe.push(Fe[Xe+5]>1?Sr(Fe,Xe,this.clusterProps):this.points[Fe[Xe+3]])}if(fe.length===0)throw new Error(De);return fe}getLeaves(ne,ce,be){const De=[];return this._appendLeaves(De,ne,ce=ce||10,be=be||0,0),De}getTile(ne,ce,be){const De=this.trees[this._limitZoom(ne)],Ee=Math.pow(2,ne),{extent:Fe,radius:et}=this.options,qe=et/Fe,fe=(be-qe)/Ee,Ve=(be+1+qe)/Ee,Xe={features:[]};return this._addTileFeatures(De.range((ce-qe)/Ee,fe,(ce+1+qe)/Ee,Ve),De.data,ce,be,Ee,Xe),ce===0&&this._addTileFeatures(De.range(1-qe/Ee,fe,1,Ve),De.data,Ee,be,Ee,Xe),ce===Ee-1&&this._addTileFeatures(De.range(0,fe,qe/Ee,Ve),De.data,-1,be,Ee,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const be=this.getChildren(ne);if(ce++,be.length!==1)break;ne=be[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,be,De,Ee){const Fe=this.getChildren(ce);for(const et of Fe){const qe=et.properties;if(qe&&qe.cluster?Ee+qe.point_count<=De?Ee+=qe.point_count:Ee=this._appendLeaves(ne,qe.cluster_id,be,De,Ee):Ee<De?Ee++:ne.push(et),ne.length===be)break}return Ee}_createTree(ne){const ce=new s.c4(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let be=0;be<ne.length;be+=this.stride)ce.add(ne[be],ne[be+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,be,De,Ee,Fe){for(const et of ne){const qe=et*this.stride,fe=ce[qe+5]>1;let Ve,Xe,ct;if(fe)Ve=Dr(ce,qe,this.clusterProps),Xe=ce[qe],ct=ce[qe+1];else{const Nr=this.points[ce[qe+3]];Ve=Nr.properties;const[Ir,jr]=Nr.geometry.coordinates;Xe=Vr(Ir),ct=Ke(jr)}const tr={type:1,geometry:[[Math.round(this.options.extent*(Xe*Ee-be)),Math.round(this.options.extent*(ct*Ee-De))]],tags:Ve};let cr;cr=fe||this.options.generateId?ce[qe+3]:this.points[ce[qe+3]].id,cr!==void 0&&(tr.id=cr),Fe.features.push(tr)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:be,extent:De,reduce:Ee,minPoints:Fe}=this.options,et=be/(De*Math.pow(2,ce)),qe=ne.data,fe=[],Ve=this.stride;for(let Xe=0;Xe<qe.length;Xe+=Ve){if(qe[Xe+2]<=ce)continue;qe[Xe+2]=ce;const ct=qe[Xe],tr=qe[Xe+1],cr=ne.within(qe[Xe],qe[Xe+1],et),Nr=qe[Xe+5];let Ir=Nr;for(const jr of cr){const Rr=jr*Ve;qe[Rr+2]>ce&&(Ir+=qe[Rr+5])}if(Ir>Nr&&Ir>=Fe){let jr,Rr=ct*Nr,ni=tr*Nr,$i=-1;const rs=(Xe/Ve<<5)+(ce+1)+this.points.length;for(const Yi of cr){const Ii=Yi*Ve;if(qe[Ii+2]<=ce)continue;qe[Ii+2]=ce;const gn=qe[Ii+5];Rr+=qe[Ii]*gn,ni+=qe[Ii+1]*gn,qe[Ii+4]=rs,Ee&&(jr||(jr=this._map(qe,Xe,!0),$i=this.clusterProps.length,this.clusterProps.push(jr)),Ee(jr,this._map(qe,Ii)))}qe[Xe+4]=rs,fe.push(Rr/Ir,ni/Ir,1/0,rs,-1,Ir),Ee&&fe.push($i)}else{for(let jr=0;jr<Ve;jr++)fe.push(qe[Xe+jr]);if(Ir>1)for(const jr of cr){const Rr=jr*Ve;if(!(qe[Rr+2]<=ce)){qe[Rr+2]=ce;for(let ni=0;ni<Ve;ni++)fe.push(qe[Rr+ni])}}}}return fe}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,be){if(ne[ce+5]>1){const Fe=this.clusterProps[ne[ce+6]];return be?Object.assign({},Fe):Fe}const De=this.points[ne[ce+3]].properties,Ee=this.options.map(De);return be&&Ee===De?Object.assign({},Ee):Ee}}function Sr($e,ne,ce){return{type:"Feature",id:$e[ne+3],properties:Dr($e,ne,ce),geometry:{type:"Point",coordinates:[(be=$e[ne],360*(be-.5)),Je($e[ne+1])]}};var be}function Dr($e,ne,ce){const be=$e[ne+5],De=be>=1e4?`${Math.round(be/1e3)}k`:be>=1e3?Math.round(be/100)/10+"k":be,Ee=$e[ne+6],Fe=Ee===-1?{}:Object.assign({},ce[Ee]);return Object.assign(Fe,{cluster:!0,cluster_id:$e[ne+3],point_count:be,point_count_abbreviated:De})}function Vr($e){return $e/360+.5}function Ke($e){const ne=Math.sin($e*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function Je($e){const ne=(180-360*$e)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function jt($e,ne,ce,be){let De=be;const Ee=ne+(ce-ne>>1);let Fe,et=ce-ne;const qe=$e[ne],fe=$e[ne+1],Ve=$e[ce],Xe=$e[ce+1];for(let ct=ne+3;ct<ce;ct+=3){const tr=yr($e[ct],$e[ct+1],qe,fe,Ve,Xe);if(tr>De)Fe=ct,De=tr;else if(tr===De){const cr=Math.abs(ct-Ee);cr<et&&(Fe=ct,et=cr)}}De>be&&(Fe-ne>3&&jt($e,ne,Fe,be),$e[Fe+2]=De,ce-Fe>3&&jt($e,Fe,ce,be))}function yr($e,ne,ce,be,De,Ee){let Fe=De-ce,et=Ee-be;if(Fe!==0||et!==0){const qe=(($e-ce)*Fe+(ne-be)*et)/(Fe*Fe+et*et);qe>1?(ce=De,be=Ee):qe>0&&(ce+=Fe*qe,be+=et*qe)}return Fe=$e-ce,et=ne-be,Fe*Fe+et*et}function pr($e,ne,ce,be){const De={id:$e??null,type:ne,geometry:ce,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Jt(De,ce);else if(ne==="Polygon")Jt(De,ce[0]);else if(ne==="MultiLineString")for(const Ee of ce)Jt(De,Ee);else if(ne==="MultiPolygon")for(const Ee of ce)Jt(De,Ee[0]);return De}function Jt($e,ne){for(let ce=0;ce<ne.length;ce+=3)$e.minX=Math.min($e.minX,ne[ce]),$e.minY=Math.min($e.minY,ne[ce+1]),$e.maxX=Math.max($e.maxX,ne[ce]),$e.maxY=Math.max($e.maxY,ne[ce+1])}function Or($e,ne,ce,be){if(!ne.geometry)return;const De=ne.geometry.coordinates;if(De&&De.length===0)return;const Ee=ne.geometry.type,Fe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let et=[],qe=ne.id;if(ce.promoteId?qe=ne.properties[ce.promoteId]:ce.generateId&&(qe=be||0),Ee==="Point")sn(De,et);else if(Ee==="MultiPoint")for(const fe of De)sn(fe,et);else if(Ee==="LineString")Mn(De,et,Fe,!1);else if(Ee==="MultiLineString"){if(ce.lineMetrics){for(const fe of De)et=[],Mn(fe,et,Fe,!1),$e.push(pr(qe,"LineString",et,ne.properties));return}Gi(De,et,Fe,!1)}else if(Ee==="Polygon")Gi(De,et,Fe,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const fe of ne.geometry.geometries)Or($e,{id:qe,geometry:fe,properties:ne.properties},ce,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const fe of De){const Ve=[];Gi(fe,Ve,Fe,!0),et.push(Ve)}}$e.push(pr(qe,Ee,et,ne.properties))}function sn($e,ne){ne.push(yi($e[0]),vt($e[1]),0)}function Mn($e,ne,ce,be){let De,Ee,Fe=0;for(let qe=0;qe<$e.length;qe++){const fe=yi($e[qe][0]),Ve=vt($e[qe][1]);ne.push(fe,Ve,0),qe>0&&(Fe+=be?(De*Ve-fe*Ee)/2:Math.sqrt(Math.pow(fe-De,2)+Math.pow(Ve-Ee,2))),De=fe,Ee=Ve}const et=ne.length-3;ne[2]=1,jt(ne,0,et,ce),ne[et+2]=1,ne.size=Math.abs(Fe),ne.start=0,ne.end=ne.size}function Gi($e,ne,ce,be){for(let De=0;De<$e.length;De++){const Ee=[];Mn($e[De],Ee,ce,be),ne.push(Ee)}}function yi($e){return $e/360+.5}function vt($e){const ne=Math.sin($e*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function or($e,ne,ce,be,De,Ee,Fe,et){if(be/=ne,Ee>=(ce/=ne)&&Fe<be)return $e;if(Fe<ce||Ee>=be)return null;const qe=[];for(const fe of $e){const Ve=fe.geometry;let Xe=fe.type;const ct=De===0?fe.minX:fe.minY,tr=De===0?fe.maxX:fe.maxY;if(ct>=ce&&tr<be){qe.push(fe);continue}if(tr<ce||ct>=be)continue;let cr=[];if(Xe==="Point"||Xe==="MultiPoint")dn(Ve,cr,ce,be,De);else if(Xe==="LineString")Ln(Ve,cr,ce,be,De,!1,et.lineMetrics);else if(Xe==="MultiLineString")Ze(Ve,cr,ce,be,De,!1);else if(Xe==="Polygon")Ze(Ve,cr,ce,be,De,!0);else if(Xe==="MultiPolygon")for(const Nr of Ve){const Ir=[];Ze(Nr,Ir,ce,be,De,!0),Ir.length&&cr.push(Ir)}if(cr.length){if(et.lineMetrics&&Xe==="LineString"){for(const Nr of cr)qe.push(pr(fe.id,Xe,Nr,fe.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(cr.length===1?(Xe="LineString",cr=cr[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=cr.length===3?"Point":"MultiPoint"),qe.push(pr(fe.id,Xe,cr,fe.tags))}}return qe.length?qe:null}function dn($e,ne,ce,be,De){for(let Ee=0;Ee<$e.length;Ee+=3){const Fe=$e[Ee+De];Fe>=ce&&Fe<=be&&ur(ne,$e[Ee],$e[Ee+1],$e[Ee+2])}}function Ln($e,ne,ce,be,De,Ee,Fe){let et=Bn($e);const qe=De===0?kr:An;let fe,Ve,Xe=$e.start;for(let Ir=0;Ir<$e.length-3;Ir+=3){const jr=$e[Ir],Rr=$e[Ir+1],ni=$e[Ir+2],$i=$e[Ir+3],rs=$e[Ir+4],Yi=De===0?jr:Rr,Ii=De===0?$i:rs;let gn=!1;Fe&&(fe=Math.sqrt(Math.pow(jr-$i,2)+Math.pow(Rr-rs,2))),Yi<ce?Ii>ce&&(Ve=qe(et,jr,Rr,$i,rs,ce),Fe&&(et.start=Xe+fe*Ve)):Yi>be?Ii<be&&(Ve=qe(et,jr,Rr,$i,rs,be),Fe&&(et.start=Xe+fe*Ve)):ur(et,jr,Rr,ni),Ii<ce&&Yi>=ce&&(Ve=qe(et,jr,Rr,$i,rs,ce),gn=!0),Ii>be&&Yi<=be&&(Ve=qe(et,jr,Rr,$i,rs,be),gn=!0),!Ee&&gn&&(Fe&&(et.end=Xe+fe*Ve),ne.push(et),et=Bn($e)),Fe&&(Xe+=fe)}let ct=$e.length-3;const tr=$e[ct],cr=$e[ct+1],Nr=De===0?tr:cr;Nr>=ce&&Nr<=be&&ur(et,tr,cr,$e[ct+2]),ct=et.length-3,Ee&&ct>=3&&(et[ct]!==et[0]||et[ct+1]!==et[1])&&ur(et,et[0],et[1],et[2]),et.length&&ne.push(et)}function Bn($e){const ne=[];return ne.size=$e.size,ne.start=$e.start,ne.end=$e.end,ne}function Ze($e,ne,ce,be,De,Ee){for(const Fe of $e)Ln(Fe,ne,ce,be,De,Ee,!1)}function ur($e,ne,ce,be){$e.push(ne,ce,be)}function kr($e,ne,ce,be,De,Ee){const Fe=(Ee-ne)/(be-ne);return ur($e,Ee,ce+(De-ce)*Fe,1),Fe}function An($e,ne,ce,be,De,Ee){const Fe=(Ee-ce)/(De-ce);return ur($e,ne+(be-ne)*Fe,Ee,1),Fe}function ki($e,ne){const ce=[];for(let be=0;be<$e.length;be++){const De=$e[be],Ee=De.type;let Fe;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Fe=Yn(De.geometry,ne);else if(Ee==="MultiLineString"||Ee==="Polygon"){Fe=[];for(const et of De.geometry)Fe.push(Yn(et,ne))}else if(Ee==="MultiPolygon"){Fe=[];for(const et of De.geometry){const qe=[];for(const fe of et)qe.push(Yn(fe,ne));Fe.push(qe)}}ce.push(pr(De.id,Ee,Fe,De.tags))}return ce}function Yn($e,ne){const ce=[];ce.size=$e.size,$e.start!==void 0&&(ce.start=$e.start,ce.end=$e.end);for(let be=0;be<$e.length;be+=3)ce.push($e[be]+ne,$e[be+1],$e[be+2]);return ce}function Ri($e,ne){if($e.transformed)return $e;const ce=1<<$e.z,be=$e.x,De=$e.y;for(const Ee of $e.features){const Fe=Ee.geometry,et=Ee.type;if(Ee.geometry=[],et===1)for(let qe=0;qe<Fe.length;qe+=2)Ee.geometry.push(ui(Fe[qe],Fe[qe+1],ne,ce,be,De));else for(let qe=0;qe<Fe.length;qe++){const fe=[];for(let Ve=0;Ve<Fe[qe].length;Ve+=2)fe.push(ui(Fe[qe][Ve],Fe[qe][Ve+1],ne,ce,be,De));Ee.geometry.push(fe)}}return $e.transformed=!0,$e}function ui($e,ne,ce,be,De,Ee){return[Math.round(ce*($e*be-De)),Math.round(ce*(ne*be-Ee))]}function _i($e,ne,ce,be,De){const Ee=ne===De.maxZoom?0:De.tolerance/((1<<ne)*De.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:$e.length,source:null,x:ce,y:be,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of $e)Ds(Fe,et,Ee,De);return Fe}function Ds($e,ne,ce,be){const De=ne.geometry,Ee=ne.type,Fe=[];if($e.minX=Math.min($e.minX,ne.minX),$e.minY=Math.min($e.minY,ne.minY),$e.maxX=Math.max($e.maxX,ne.maxX),$e.maxY=Math.max($e.maxY,ne.maxY),Ee==="Point"||Ee==="MultiPoint")for(let et=0;et<De.length;et+=3)Fe.push(De[et],De[et+1]),$e.numPoints++,$e.numSimplified++;else if(Ee==="LineString")oo(Fe,De,$e,ce,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let et=0;et<De.length;et++)oo(Fe,De[et],$e,ce,Ee==="Polygon",et===0);else if(Ee==="MultiPolygon")for(let et=0;et<De.length;et++){const qe=De[et];for(let fe=0;fe<qe.length;fe++)oo(Fe,qe[fe],$e,ce,!0,fe===0)}if(Fe.length){let et=ne.tags||null;if(Ee==="LineString"&&be.lineMetrics){et={};for(const fe in ne.tags)et[fe]=ne.tags[fe];et.mapbox_clip_start=De.start/De.size,et.mapbox_clip_end=De.end/De.size}const qe={geometry:Fe,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:et};ne.id!==null&&(qe.id=ne.id),$e.features.push(qe)}}function oo($e,ne,ce,be,De,Ee){const Fe=be*be;if(be>0&&ne.size<(De?Fe:be))return void(ce.numPoints+=ne.length/3);const et=[];for(let qe=0;qe<ne.length;qe+=3)(be===0||ne[qe+2]>Fe)&&(ce.numSimplified++,et.push(ne[qe],ne[qe+1])),ce.numPoints++;De&&(function(qe,fe){let Ve=0;for(let Xe=0,ct=qe.length,tr=ct-2;Xe<ct;tr=Xe,Xe+=2)Ve+=(qe[Xe]-qe[tr])*(qe[Xe+1]+qe[tr+1]);if(Ve>0===fe)for(let Xe=0,ct=qe.length;Xe<ct/2;Xe+=2){const tr=qe[Xe],cr=qe[Xe+1];qe[Xe]=qe[ct-2-Xe],qe[Xe+1]=qe[ct-1-Xe],qe[ct-2-Xe]=tr,qe[ct-1-Xe]=cr}})(et,Ee),$e.push(et)}const Is={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ao{constructor(ne,ce){const be=(ce=this.options=(function(Ee,Fe){for(const et in Fe)Ee[et]=Fe[et];return Ee})(Object.create(Is),ce)).debug;if(be&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=(function(Ee,Fe){const et=[];if(Ee.type==="FeatureCollection")for(let qe=0;qe<Ee.features.length;qe++)Or(et,Ee.features[qe],Fe,qe);else Or(et,Ee.type==="Feature"?Ee:{geometry:Ee},Fe);return et})(ne,ce);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=(function(Ee,Fe){const et=Fe.buffer/Fe.extent;let qe=Ee;const fe=or(Ee,1,-1-et,et,0,-1,2,Fe),Ve=or(Ee,1,1-et,2+et,0,-1,2,Fe);return(fe||Ve)&&(qe=or(Ee,1,-et,1+et,0,-1,2,Fe)||[],fe&&(qe=ki(fe,1).concat(qe)),Ve&&(qe=qe.concat(ki(Ve,-1)))),qe})(De,ce),De.length&&this.splitTile(De,0,0,0),be&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ce,be,De,Ee,Fe,et){const qe=[ne,ce,be,De],fe=this.options,Ve=fe.debug;for(;qe.length;){De=qe.pop(),be=qe.pop(),ce=qe.pop(),ne=qe.pop();const Xe=1<<ce,ct=No(ce,be,De);let tr=this.tiles[ct];if(!tr&&(Ve>1&&console.time("creation"),tr=this.tiles[ct]=_i(ne,ce,be,De,fe),this.tileCoords.push({z:ce,x:be,y:De}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,be,De,tr.numFeatures,tr.numPoints,tr.numSimplified),console.timeEnd("creation"));const gn=`z${ce}`;this.stats[gn]=(this.stats[gn]||0)+1,this.total++}if(tr.source=ne,Ee==null){if(ce===fe.indexMaxZoom||tr.numPoints<=fe.indexMaxPoints)continue}else{if(ce===fe.maxZoom||ce===Ee)continue;if(Ee!=null){const gn=Ee-ce;if(be!==Fe>>gn||De!==et>>gn)continue}}if(tr.source=null,ne.length===0)continue;Ve>1&&console.time("clipping");const cr=.5*fe.buffer/fe.extent,Nr=.5-cr,Ir=.5+cr,jr=1+cr;let Rr=null,ni=null,$i=null,rs=null,Yi=or(ne,Xe,be-cr,be+Ir,0,tr.minX,tr.maxX,fe),Ii=or(ne,Xe,be+Nr,be+jr,0,tr.minX,tr.maxX,fe);ne=null,Yi&&(Rr=or(Yi,Xe,De-cr,De+Ir,1,tr.minY,tr.maxY,fe),ni=or(Yi,Xe,De+Nr,De+jr,1,tr.minY,tr.maxY,fe),Yi=null),Ii&&($i=or(Ii,Xe,De-cr,De+Ir,1,tr.minY,tr.maxY,fe),rs=or(Ii,Xe,De+Nr,De+jr,1,tr.minY,tr.maxY,fe),Ii=null),Ve>1&&console.timeEnd("clipping"),qe.push(Rr||[],ce+1,2*be,2*De),qe.push(ni||[],ce+1,2*be,2*De+1),qe.push($i||[],ce+1,2*be+1,2*De),qe.push(rs||[],ce+1,2*be+1,2*De+1)}}getTile(ne,ce,be){ne=+ne,ce=+ce,be=+be;const De=this.options,{extent:Ee,debug:Fe}=De;if(ne<0||ne>24)return null;const et=1<<ne,qe=No(ne,ce=ce+et&et-1,be);if(this.tiles[qe])return Ri(this.tiles[qe],Ee);Fe>1&&console.log("drilling down to z%d-%d-%d",ne,ce,be);let fe,Ve=ne,Xe=ce,ct=be;for(;!fe&&Ve>0;)Ve--,Xe>>=1,ct>>=1,fe=this.tiles[No(Ve,Xe,ct)];return fe&&fe.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Ve,Xe,ct),console.time("drilling down")),this.splitTile(fe.source,Ve,Xe,ct,ne,ce,be),Fe>1&&console.timeEnd("drilling down"),this.tiles[qe]?Ri(this.tiles[qe],Ee):null):null}}function No($e,ne,ce){return 32*((1<<$e)*ce+ne)+$e}function Nt($e,ne){const ce=$e.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const be=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!be)return void ne(null,null);const De=fe=>fe.tags&&"3d_elevation_id"in fe.tags&&"source"in fe.tags&&fe.tags.source==="elevation",Ee=be.features.filter(fe=>De(fe));let Fe={_geojsonTileLayer:be.features};Ee.length>0&&(Fe={_geojsonTileLayer:be.features.filter(fe=>!De(fe)),hd_road_elevation:Ee});const et=new Ar(Fe),qe=(function(fe){const Ve=new s.bt;for(const Xe of Object.keys(fe))Ve.writeMessage(3,Yr,{name:Xe,features:fe[Xe]});return Ve.finish()})(Fe).buffer;ne(null,{vectorTile:et,rawData:qe})}class us extends Ct{constructor(ne,ce,be,De,Ee,Fe,et){super(ne,ce,be,De,Ee,Nt,et),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new Xt}loadData(ne,ce){const be=ne&&ne.request,De=be&&be.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,(Ee,Fe)=>{if(Ee||!Fe)return ce(Ee);if(typeof Fe!="object")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const qe=s.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map(fe=>`${fe.key}: ${fe.message}`).join(", "));Fe.features=Fe.features.filter(fe=>qe.value.evaluate({zoom:0},fe))}ne.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),ne.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new pt((function({superclusterOptions:qe,clusterProperties:fe}){if(!fe||!qe)return qe;const Ve={},Xe={},ct={accumulated:null,zoom:0},tr={properties:null},cr=Object.keys(fe);for(const Nr of cr){const[Ir,jr]=fe[Nr],Rr=s.U(jr),ni=s.U(typeof Ir=="string"?[Ir,["accumulated"],["get",Nr]]:Ir);Ve[Nr]=Rr.value,Xe[Nr]=ni.value}return qe.map=Nr=>{tr.properties=Nr;const Ir={};for(const jr of cr)Ir[jr]=Ve[jr].evaluate(ct,tr);return Ir},qe.reduce=(Nr,Ir)=>{tr.properties=Ir;for(const jr of cr)ct.accumulated=Nr[jr],Nr[jr]=Xe[jr].evaluate(ct,tr)},qe})(ne)).load(Fe.features):ne.dynamic?this._dynamicIndex:(function(qe,fe){return new ao(qe,fe)})(Fe,ne.geojsonVtOptions)}catch(qe){return ce(qe)}const et={};if(De){const qe=M(be);qe&&(et.resourceTiming={},et.resourceTiming[ne.source]=JSON.parse(JSON.stringify(qe)))}ce(null,et)}})}reloadTile(ne,ce){const be=this.loaded;return be&&be[ne.uid]?ne.partial?ce(null,void 0):super.reloadTile(ne,ce):this.loadTile(ne,ce)}loadGeoJSON(ne,ce){if(ne.request)s.m(ne.request,ce);else{if(typeof ne.data!="string")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ce(null,JSON.parse(ne.data))}catch{return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ne,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(be){ce(be)}}getClusterChildren(ne,ce){try{ce(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(be){ce(be)}}getClusterLeaves(ne,ce){try{ce(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(be){ce(be)}}}class ks{constructor(ne,ce,be){this.tileID=new s.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ce,this.worldview=be}parse(ne,ce,be,De){this.status="parsing";const Ee=new s.aQ(be.tileID.overscaledZ,be.tileID.wrap,be.tileID.canonical.z,be.tileID.canonical.x,be.tileID.canonical.y),Fe=[],et=ce.familiesBySource[be.source],qe=new s.fn(Ee,be.promoteId);qe.bucketLayerIDs=[],qe.is3DTile=!0,s.fC(ne).then(fe=>{if(!fe)return De(new Error("Could not parse tile"));const Ve=fe.json.extensionsUsed&&fe.json.extensionsUsed.includes("MAPBOX_mesh_features")||fe.json.asset.extras&&fe.json.asset.extras.MAPBOX_mesh_features,Xe=fe.json.extensionsUsed&&fe.json.extensionsUsed.includes("EXT_meshopt_compression"),ct=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const tr in et)for(const cr of et[tr]){const Nr=cr[0];qe.bucketLayerIDs.push(cr.map(Rr=>s.B(Rr.id,Rr.scope))),Nr.recalculate(ct,[]);const Ir=s.fD(fe,1/s.d7(be.tileID.canonical)),jr=new s.fE(cr,Ir,Ee,Ve,Xe,this.brightness,qe,this.worldview);Ve||(jr.needsUpload=!0),Fe.push(jr),jr.evaluate(Nr)}this.status="done",De(null,{buckets:Fe,featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(fe=>De(new Error(fe.message)))}}class fo{constructor(ne,ce,be,De,Ee,Fe,et,qe){this.actor=ne,this.layerIndex=ce,this.availableImages=be,this.availableModels=De,this.brightness=et,this.loading={},this.loaded={},this.worldview=qe}loadTile(ne,ce){const be=ne.uid,De=this.loading[be]=new ks(ne,this.brightness,this.worldview);s.bu(ne.request,(Ee,Fe)=>{const et=!this.loading[be];return delete this.loading[be],et||Ee?(De.status="done",et||(this.loaded[be]=De),ce(Ee)):Fe&&Fe.byteLength!==0?void De.parse(Fe,this.layerIndex,ne,(qe,fe)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[be]=De,qe||!fe?ce(qe):ce(null,fe)}):(De.status="done",this.loaded[be]=De,ce())})}reloadTile(ne,ce){const be=this.loaded,De=ne.uid;if(be&&be[De]){const Ee=be[De];Ee.projection=ne.projection,Ee.brightness=ne.brightness;const Fe=(et,qe)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(ne,ce)),ce(et,qe)};Ee.status==="parsing"?Ee.reloadCallback=Fe:Ee.status==="done"&&this.loadTile(ne,ce)}}abortTile(ne,ce){const be=ne.uid;this.loading[be]&&delete this.loading[be],ce()}removeTile(ne,ce){const be=this.loaded,De=ne.uid;be&&be[De]&&delete be[De],ce()}}class vn{constructor(ne){this.self=ne,this.actor=new s.fG(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:Ct,geojson:us,"raster-dem":Ht,"raster-array":rr,"batched-model":fo},this.workerSources={},this.self.registerWorkerSource=(ce,be)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=be},this.self.registerRTLTextPlugin=ce=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=ce.applyArabicShaping,s.fH.processBidirectionalText=ce.processBidirectionalText,s.fH.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const be of this.rtlPluginParsingListeners)be(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ce,be){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],be()}checkIfReady(ne,ce,be){be()}setReferrer(ne,ce){this.referrer=ce}spriteLoaded(ne,ce){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:be,isLoaded:De}=ce;if(this.isSpriteLoaded[ne][be]=De,this.workerSources[ne]&&this.workerSources[ne][be])for(const Ee in this.workerSources[ne][be]){const Fe=this.workerSources[ne][be][Ee];for(const et in Fe){const qe=Fe[et];qe instanceof Ct&&(qe.isSpriteLoaded=De,qe.fire(new s.z("isSpriteLoaded")))}}}setImages(ne,ce,be){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:De,images:Ee}=ce;if(this.availableImages[ne][De]=Ee,this.workerSources[ne]&&this.workerSources[ne][De]){for(const Fe in this.workerSources[ne][De]){const et=this.workerSources[ne][De][Fe];for(const qe in et)et[qe].availableImages=Ee}be()}else be()}setModels(ne,{scope:ce,models:be},De){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ce]=be,this.workerSources[ne]&&this.workerSources[ne][ce]){for(const Ee in this.workerSources[ne][ce]){const Fe=this.workerSources[ne][ce][Ee];for(const et in Fe)Fe[et].availableModels=be}De()}else De()}setProjection(ne,ce){this.projections[ne]=s.cm(ce)}setBrightness(ne,ce,be){this.brightness=ce,be()}setWorldview(ne,ce,be){this.worldview=ce,be()}setLayers(ne,ce,be){this.getLayerIndex(ne,ce.scope).replace(ce.layers,ce.options),be()}updateLayers(ne,ce,be){this.getLayerIndex(ne,ce.scope).update(ce.layers,ce.removedIds,ce.options),be()}loadTile(ne,ce,be){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).loadTile(ce,be)}decodeRasterArray(ne,ce,be){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).decodeRasterArray(ce,be)}reloadTile(ne,ce,be){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).reloadTile(ce,be)}abortTile(ne,ce,be){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).abortTile(ce,be)}removeTile(ne,ce,be){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).removeTile(ce,be)}removeSource(ne,ce,be){if(!(this.workerSources[ne]&&this.workerSources[ne][ce.scope]&&this.workerSources[ne][ce.scope][ce.type]&&this.workerSources[ne][ce.scope][ce.type][ce.source]))return;const De=this.workerSources[ne][ce.scope][ce.type][ce.source];delete this.workerSources[ne][ce.scope][ce.type][ce.source],De.removeSource!==void 0?De.removeSource(ce,be):be()}loadWorkerSource(ne,ce,be){try{this.self.importScripts(ce.url),be()}catch(De){be(De)}}syncRTLPluginState(ne,ce,be){if(s.fH.isParsed())be(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(be);else try{s.fH.setState(ce);const De=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||De==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(De),s.fH.isParsed()?be(null,!0):this.rtlPluginParsingListeners.push(be))}catch(De){be(De)}}setDracoUrl(ne,ce){this.dracoUrl=ce}getAvailableImages(ne,ce){this.availableImages[ne]||(this.availableImages[ne]={});let be=this.availableImages[ne][ce];return be||(be=[]),be}getAvailableModels(ne,ce){this.availableModels[ne]||(this.availableModels[ne]={});let be=this.availableModels[ne][ce];return be||(be={}),be}getLayerIndex(ne,ce){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let be=this.layerIndexes[ne][ce];return be||(be=this.layerIndexes[ne][ce]=new X,be.scope=ce),be}getWorkerSource(ne,ce,be,De){const Ee=this.workerSources;return Ee[ne]||(Ee[ne]={}),Ee[ne][De]||(Ee[ne][De]={}),Ee[ne][De][ce]||(Ee[ne][De][ce]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),Ee[ne][De][ce][be]||(Ee[ne][De][ce][be]=new this.workerSourceTypes[ce]({send:(Fe,et,qe,fe,Ve,Xe)=>this.actor.send(Fe,et,qe,ne,Ve,Xe),scheduler:this.actor.scheduler},this.getLayerIndex(ne,De),this.getAvailableImages(ne,De),this.getAvailableModels(ne,De),this.isSpriteLoaded[ne][De],void 0,this.brightness,this.worldview)),Ee[ne][De][ce][be]}rasterizeImagesWorker(ne,ce,be){const De=new Map;for(const[Ee,{image:Fe,imageVariant:et}]of ce.tasks.entries()){const qe=this.imageRasterizer.rasterize(et,Fe,ce.scope,ne);De.set(Ee,qe)}be(void 0,De)}removeRasterizedImages(ne,ce,be){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,ne),be()}enforceCacheSizeLimit(ne,ce){s.fJ(ce)}getWorkerPerformanceMetrics(ne,ce,be){be(void 0,void 0)}}return s.fF(self)&&(self.worker=new vn(self)),vn}),v(["./shared"],function(s){var M="3.18.1";const L={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(f){performance.mark(f)},measure(f,t,c){performance.measure(f,t,c)}};function W(f){const t=f.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var X,ee={},he=(function(){if(X)return ee;function f(p){return!t(p)}function t(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,T,I=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(I);try{T=new Worker(k),S=!0}catch{S=!1}return T&&T.terminate(),URL.revokeObjectURL(k),S})()?(function(){var S=document.createElement("canvas");S.width=S.height=1;var T=S.getContext("2d");if(!T)return!1;var I=T.getImageData(0,0,1,1);return I&&I.width===S.width})()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=(function(S){var T,I=(function(k){var D=document.createElement("canvas"),O=Object.create(f.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=k,D.getContext("webgl2",O)})(S);if(!I)return!1;try{T=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!T||I.isContextLost())&&(I.shaderSource(T,"void main() {}"),I.compileShader(T),I.getShaderParameter(T,I.COMPILE_STATUS)===!0)})(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}X=1,ee.supported=f,ee.notSupportedReason=t;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ee})();function se(f,t,c){const p=document.createElement(f);return t!=null&&(p.className=t),c&&c.appendChild(p),p}function oe(f,t,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(t))p.setAttributeNS(null,x,String(t[x]));return c&&c.appendChild(p),p}const ve=typeof document<"u"?document.documentElement&&document.documentElement.style:null,me=ve&&ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Se;function Re(){ve&&me&&(Se=ve[me],ve[me]="none")}function Be(){ve&&me&&(ve[me]=Se)}function rt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",rt,!0)}function We(){window.addEventListener("click",rt,!0),window.setTimeout(()=>{window.removeEventListener("click",rt,!0)},0)}function Ct(f,t){const c=f.getBoundingClientRect();return rr(f,c,t)}function Ht(f,t){const c=f.getBoundingClientRect(),p=[];for(let x=0;x<t.length;x++)p.push(rr(f,c,t[x]));return p}function Zt(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function rr(f,t,c){const p=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new s.P((c.clientX-t.left)*p,(c.clientY-t.top)*p)}const $t="01",Rt="NO_ACCESS_TOKEN";class Gt{constructor(t,c,p){this._transformRequestFn=t,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const t=(function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$t,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,c){return this._transformRequestFn&&this._transformRequestFn(t,c)||{url:t}}normalizeStyleURL(t,c){if(!s.h(t))return t;const p=Ut(t);return p.params.push(`sdk=js-${M}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(t,c){if(!s.h(t))return t;const p=Ut(t);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(t,c){if(!s.h(t))return t;const p=Ut(t);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(t,c,p,x){if(!s.h(t))return t;const S=Ut(t);return S.path=`/v4/${S.authority}.json`,S.params.push("secure"),p&&S.params.push(`language=${p}`),x&&S.params.push(`worldview=${x}`),this._makeAPIURL(S,this._customAccessToken||c)}normalizeIconsetURL(t,c){const p=Ut(t);return s.h(t)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Xt(p)}normalizeSpriteURL(t,c,p,x){const S=Ut(t);return s.h(t)?(S.path=`/styles/v1${S.path}/sprite${c}${p}`,this._makeAPIURL(S,this._customAccessToken||x)):(S.path+=`${c}${p}`,Xt(S))}normalizeTileURL(t,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.h(t))return t;const x=Ut(t);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${s.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const S=this._customAccessToken||(function(T){for(const I of T){const k=I.match(/^access_token=(.*)$/);if(k)return k[1]}return null})(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,S)}canonicalizeTileURL(t,c){const p=Ut(t);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return t;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let S=p.params;return c&&(S=S.filter(T=>!T.match(/^access_token=/))),S.length&&(x+=`?${S.join("&")}`),x}canonicalizeTileset(t,c){const p=!!c&&s.h(c),x=[];for(const S of t.tiles||[])s.j(S)?x.push(this.canonicalizeTileURL(S,p)):x.push(S);return x}_makeAPIURL(t,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Ut(s.e.API_URL);if(t.protocol=x.protocol,t.authority=x.authority,t.protocol==="http"){const S=t.params.indexOf("secure");S>=0&&t.params.splice(S,1)}if(x.path!=="/"&&(t.path=`${x.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Xt(t);if(c=c||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return t.params=t.params.filter(S=>S.indexOf("access_token")===-1),t.params.push(`access_token=${c||""}`),Xt(t)}}const Ar=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ut(f){const t=f.match(Ar);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Xt(f){const t=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${t}`}const ut="mapbox.eventData";function Mt(f){if(!f)return null;const t=f.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.l(t[1]))}catch{return null}}class Qt{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const c=Mt(s.e.ACCESS_TOKEN);let p="";return p=c&&c.u?s.f(c.u):s.e.ACCESS_TOKEN||"",t?`${ut}.${t}:${p}`:`${ut}:${p}`}fetchEventData(){const t=s.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp");if(t)try{const S=localStorage.getItem(c);S&&(this.eventData=JSON.parse(S));const T=localStorage.getItem(p);T&&(this.anonId=T);const I=localStorage.getItem(x);I&&(this.anonIdTimestamp=Number(I));const k=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<k)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=s.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp"),S=this.anonId,T=this.anonIdTimestamp;if(t&&S)try{localStorage.setItem(p,S),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),T&&localStorage.setItem(x,T.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,c,p,x){if(!s.e.EVENTS_URL)return;const S=Ut(s.e.EVENTS_URL);S.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},I=c?Object.assign(T,c):T,k={url:Xt(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(k,D=>{this.pendingRequest=null,p(D),this.saveEventData(),this.processRequests(x)})}queueRequest(t,c){this.queue.push(t),this.processRequests(c)}}class ze extends Qt{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!s.e.EVENTS_URL||!t&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},t)}}const It=new class extends Qt{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>s.h(c)||s.j(c))&&this.queueRequest(Date.now(),t)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Mt(s.e.ACCESS_TOKEN),c=t?t.u:s.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const S=new Date(this.eventData.lastSuccess),T=new Date(x),I=(x-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||S.getDate()!==T.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:$t,"enabled.telemetry":!1,userId:this.anonId},S=>{S||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)},f):this.processRequests()}},xr=It.postTurnstileEvent.bind(It),Lr=new class extends Qt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,t,c,p){this.skuToken=t,this.errorCb=p,s.e.EVENTS_URL&&(c||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Rt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:c}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:$t,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):t&&(this.success[t]=!0)},f))}remove(){this.errorCb=null}},yn=Lr.postMapLoadEvent.bind(Lr),Yr=new class extends Qt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let t=this.mapInstanceIdMap.get(f);return t||(t=s.u(),this.mapInstanceIdMap.set(f,t)),t}getEventId(f){const t=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,t+1),t}postStyleLoadEvent(f,t){const{map:c,style:p,importedStyles:x}=t;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const S=this.getMapInstanceId(c),T={mapInstanceId:S,eventId:this.getEventId(S),style:p};x.length&&(T.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:c}=this.queue.shift();this.postEvent(t,c,()=>{},f)}},Zr=Yr.postStyleLoadEvent.bind(Yr),Qr=new ze({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),ir=Qr.postMetricsEvent.bind(Qr),Hr=new ze({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Ur=Hr.postMetricsEvent.bind(Hr),Ti=new class extends Qt{constructor(){super("gljs.performance")}postPerformanceEvent(f,t){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:c}=this.queue.shift(),p=(function(x){const S=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),I=(function(G){const J={};if(G){for(const Y in G)if(Y!=="other")for(const te of G[Y]){const le=`${Y}ResolveRangeMin`,ge=`${Y}ResolveRangeMax`,pe=`${Y}RequestCount`,de=`${Y}RequestCachedCount`;J[le]=Math.min(J[le]||1/0,te.startTime),J[ge]=Math.max(J[ge]||-1/0,te.responseEnd);const Ne=Ce=>{J[Ce]===void 0&&(J[Ce]=0),++J[Ce]};te.transferSize!==void 0&&te.transferSize===0&&Ne(de),Ne(pe)}}return J})((function(G,J){const Y={};if(G)for(const te of G){const le=J(te);Y[le]===void 0&&(Y[le]=[]),Y[le].push(te)}return Y})(S,W)),k=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=D?D.effectiveType:void 0,q={counters:[],metadata:[],attributes:[]},U=(G,J,Y)=>{Y!=null&&G.push({name:J,value:Y.toString()})};for(const G in I)U(q.counters,G,I[G]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(U(q.counters,"interactionRangeMin",x.interactionRange[0]),U(q.counters,"interactionRangeMax",x.interactionRange[1])),T)for(const G of Object.values(L)){const J=T.find(Y=>Y.name===G);J&&U(q.counters,G,J.startTime)}return U(q.counters,"visibilityHidden",x.visibilityHidden),U(q.attributes,"style",(function(G){if(G)for(const J of G){const Y=J.name.split("?")[0];if(s.i(Y)){const te=Y.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}})(S)),U(q.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),U(q.attributes,"fogEnabled",x.fogEnabled?"true":"false"),U(q.attributes,"projection",x.projection),U(q.attributes,"zoom",x.zoom),U(q.metadata,"devicePixelRatio",k),U(q.metadata,"connectionEffectiveType",O),U(q.metadata,"navigatorUserAgent",navigator.userAgent),U(q.metadata,"screenWidth",window.screen.width),U(q.metadata,"screenHeight",window.screen.height),U(q.metadata,"windowWidth",window.innerWidth),U(q.metadata,"windowHeight",window.innerHeight),U(q.metadata,"mapWidth",x.width/k),U(q.metadata,"mapHeight",x.height/k),U(q.metadata,"webglRenderer",x.renderer),U(q.metadata,"webglVendor",x.vendor),U(q.metadata,"sdkVersion",M),U(q.metadata,"sdkIdentifier","mapbox-gl-js"),q})(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(t,p,()=>{},f)}},Sn=Ti.postPerformanceEvent.bind(Ti),Ci=new class extends Qt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,t,c,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=Ut(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${t||""}`),x.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const S={url:Xt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(S,T=>{this.pendingRequest=null,c(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,t,c,p){this.skuToken=t,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(c||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Rt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:c}=this.queue.shift();t&&this.success[t]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):t&&(this.success[t]=!0)},f)}remove(){this.errorCb=null}},At=Ci.getSessionAPI.bind(Ci),pt=new Set;function Sr(f,t){t?pt.add(f):pt.delete(f)}class Dr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,c){this._updatedSourceCaches[t]=c,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const c=t.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(t.id),this.setDirty()}removeLayer(t){const c=t.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][t.id]=t,this._updatedLayers[c].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const c in this._updatedLayers)t[c]=t[c]||{},t[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)t[c]=t[c]||{},t[c].removedIds=Object.keys(this._removedLayers[c]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Vr(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ke extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const c=this.atlasTexture.get(t);c&&(c.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(t.id,t)}removeImageProvider(t,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(t)}getPendingImageProviders(){const t=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&t.push(p);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,c){if(this.loaded.get(c)!==t&&(this.loaded.set(c,t),t)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(t,c){return!!this.getImage(t,c)}getImage(t,c){return this.images.get(c).get(t.toString())}addImage(t,c,p){this._validate(t,p)&&this.images.get(c).set(t.toString(),p)}_validate(t,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "content" value`))),p=!1),p}_validateStretch(t,c){if(!t)return!0;let p=0;for(const x of t){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(t,c){return t?t.length!==4||!c.usvg&&(t[0]<0||c.data.width<t[0]||t[1]<0||c.data.height<t[1]||t[2]<0||c.data.width<t[2]||t[3]<0||c.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,c,p){const x=this.images.get(c).get(t.toString());p.version=x.version+1,this.images.get(c).set(t.toString(),p),this.updatedImages.get(c).add(t),this.removeFromImageRasterizerCache(t,c)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,c){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([t],c))}removeImage(t,c){const p=this.images.get(c),x=p.get(t.toString());p.delete(t.toString()),this.patterns.get(c).delete(t.toString()),this.removeFromImageRasterizerCache(t,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(c=>s.I.from(c))}getImages(t,c,p){const x=[],S=[],T=this.imageProviders.get(c);for(const O of t){if(!O.iconsetId){x.push(O);continue}const q=T.get(O.iconsetId);q&&(this.getImage(O,c)?S.push(O):q.addPendingRequest(O))}if(x.length===0)return void this._notify(S,c,p);let I=!0;const k=!!this.loaded.get(c),D=this.images.get(c);if(!k)for(const O of x)D.has(O.toString())||(I=!1);k||I?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(t,c){const p=new Map,{tasks:x,scope:S}=t;for(const[T,I]of x.entries()){const k=this.getImage(I.id,S);k&&p.set(T,{image:k,imageVariant:I})}this._rasterizeImages(S,p,c)}_rasterizeImages(t,c,p){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:t},p);else{const x=new Map;for(const[S,{image:T,imageVariant:I}]of c.entries())x.set(S,this.imageRasterizer.rasterize(I,T,t,0));p(void 0,x)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,c,p){const x=this.images.get(c),S=new Map;for(const T of t){if(!x.get(T.toString())){if(T.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:T.name}))}const I=x.get(T.toString());if(!I){s.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const k={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(k,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),S.set(s.I.toString(T),k)}p(null,S)}getPixelSize(t){const{width:c,height:p}=this.atlasImage.get(t);return{width:c,height:p}}getPattern(t,c,p){const x=t.toString(),S=this.patterns.get(c),T=S.get(x),I=this.getImage(t,c);if(!I)return null;if(T){if(T.position.version===I.version)return T.position;T.position.version=I.version}else{if(I.usvg&&!I.data){const k=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(k))return null;this.patternsInFlight.add(k);const D=new s.A(t).scaleSelf(s.o.devicePixelRatio),O=new Map([[D.toString(),{image:I,imageVariant:D}]]);return this._rasterizeImages(c,O,(q,U)=>this.storePatternImage(D,c,I,p,U)),null}this.storePattern(t,c,I)}return this._updatePatternAtlas(c,p),S.get(x).position}getPatternInFlightId(t,c){return s.B(t,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,c,p,x,S){const T=t.toString(),I=S?S.get(T):void 0;I&&(p.data=I,this.storePattern(t.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),c)))}storePattern(t,c,p){const x={w:p.data.width+2*s.C,h:p.data.height+2*s.C,x:0,y:0},S=new s.F(x,p,s.C);this.patterns.get(c).set(t.toString(),{bin:x,position:S})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,c){const p=t.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new s.T(t,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(t,c){const p=this.patterns.get(t),x=Array.from(p.values()).map(({bin:D})=>D),{w:S,h:T}=s.G(x),I=this.atlasImage.get(t);I.resize({width:S||1,height:T||1});const k=this.images.get(t);for(const[D,{bin:O,position:q}]of p.entries()){let U=q.padding;const G=O.x+U,J=O.y+U,Y=k.get(D).data,te=Y.width,le=Y.height;U=U>1?U-1:U,s.q.copy(Y,I,{x:0,y:0},{x:G,y:J},{width:te,height:le},c),s.q.copy(Y,I,{x:0,y:le-U},{x:G,y:J-U},{width:te,height:U},c),s.q.copy(Y,I,{x:0,y:0},{x:G,y:J+le},{width:te,height:U},c),s.q.copy(Y,I,{x:te-U,y:0},{x:G-U,y:J},{width:U,height:le},c),s.q.copy(Y,I,{x:0,y:0},{x:G+te,y:J},{width:U,height:le},c),s.q.copy(Y,I,{x:te-U,y:le-U},{x:G-U,y:J-U},{width:U,height:U},c),s.q.copy(Y,I,{x:0,y:le-U},{x:G+te,y:J-U},{width:U,height:U},c),s.q.copy(Y,I,{x:0,y:0},{x:G+te,y:J+le},{width:U,height:U},c),s.q.copy(Y,I,{x:te-U,y:0},{x:G-U,y:J+le},{width:U,height:U},c)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,c){const p=this.images.get(c);for(const x of t){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const S=p.get(x.toString());Vr(S)&&this.updateImage(x,c,S)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Je(f){const t=f.value,c=f.valueSpec,p=f.style,x=f.styleSpec,S=f.key,T=f.arrayElementValidator||ui;if(!Array.isArray(t))return[new s.V(S,t,`array expected, ${s.K(t)} found`)];if(c.length&&t.length!==c.length)return[new s.V(S,t,`array length ${c.length} expected, length ${t.length} found`)];if(c["min-length"]&&t.length<c["min-length"])return[new s.V(S,t,`array length at least ${c["min-length"]} expected, length ${t.length} found`)];let I={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(I.function=c.function),s.H(c.value)&&(I=c.value);let k=[];for(let D=0;D<t.length;D++)k=k.concat(T({array:t,arrayIndex:D,value:t[D],valueSpec:I,style:p,styleSpec:x,key:`${S}[${D}]`},!0));return k}function jt(f){const t=f.key,c=f.value,p=f.valueSpec;if(!s.L(c))return[new s.V(t,c,`number expected, ${s.K(c)} found`)];if(c!=c)return[new s.V(t,c,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[f.arrayIndex]),c<x)return[new s.V(t,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[f.arrayIndex]),c>x)return[new s.V(t,c,`${c} is greater than the maximum value ${x}`)]}return[]}function yr(f){const t=f.key,c=f.value;if(!s.H(c))return[new s.V(t,c,`object expected, ${s.K(c)} found`)];const p=f.valueSpec,x=s.J(c.type);let S,T,I,k={};const D=x!=="categorical"&&c.property===void 0,O=!D,q=(function(Y){const te=Y.stops;return Array.isArray(te)&&Array.isArray(te[0])&&s.H(te[0][0])})(c),U=_i({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Y){if(x==="identity")return[new s.V(Y.key,Y.value,'identity function may not have a "stops" property')];let te=[];const le=Y.value;return te=te.concat(Je({key:Y.key,value:le,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:G})),Array.isArray(le)&&le.length===0&&te.push(new s.V(Y.key,le,"array must have at least one stop")),te},default:function(Y){return ui({key:Y.key,value:Y.value,valueSpec:p,style:Y.style,styleSpec:Y.styleSpec})}}});return x==="identity"&&D&&U.push(new s.V(f.key,f.value,'missing required property "property"')),x==="identity"||c.stops||U.push(new s.V(f.key,f.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!s.M(p)&&U.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(O&&!s.N(p)?U.push(new s.V(f.key,f.value,"property functions not supported")):D&&!s.O(p)&&U.push(new s.V(f.key,f.value,"zoom functions not supported"))),x!=="categorical"&&!q||c.property!==void 0||U.push(new s.V(f.key,f.value,'"property" property is required')),U;function G(Y){let te=[];const le=Y.value,ge=Y.key;if(!Array.isArray(le))return[new s.V(ge,le,`array expected, ${s.K(le)} found`)];if(le.length!==2)return[new s.V(ge,le,`array length 2 expected, length ${le.length} found`)];if(q){if(!s.H(le[0]))return[new s.V(ge,le,`object expected, ${s.K(le[0])} found`)];const pe=le[0];if(pe.zoom===void 0)return[new s.V(ge,le,"object stop key must have zoom")];if(pe.value===void 0)return[new s.V(ge,le,"object stop key must have value")];const de=s.J(pe.zoom);if(typeof de!="number")return[new s.V(ge,pe.zoom,"stop zoom values must be numbers")];if(I&&I>de)return[new s.V(ge,pe.zoom,"stop zoom values must appear in ascending order")];de!==I&&(I=de,T=void 0,k={}),te=te.concat(_i({key:`${ge}[0]`,value:le[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:jt,value:J}}))}else te=te.concat(J({key:`${ge}[0]`,value:le[0],style:Y.style,styleSpec:Y.styleSpec},le));return s.Q(s.S(le[1]))?te.concat([new s.V(`${ge}[1]`,le[1],"expressions are not allowed in function stops.")]):te.concat(ui({key:`${ge}[1]`,value:le[1],valueSpec:p,style:Y.style,styleSpec:Y.styleSpec}))}function J(Y,te){const le=s.K(Y.value),ge=s.J(Y.value),pe=Y.value!==null?Y.value:te;if(S){if(le!==S)return[new s.V(Y.key,pe,`${le} stop domain type must match previous stop domain type ${S}`)]}else S=le;if(le!=="number"&&le!=="string"&&le!=="boolean"&&typeof ge!="number"&&typeof ge!="string"&&typeof ge!="boolean")return[new s.V(Y.key,pe,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&x!=="categorical"){let de=`number expected, ${le} found`;return s.N(p)&&x===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(Y.key,pe,de)]}return x!=="categorical"||le!=="number"||typeof ge=="number"&&isFinite(ge)&&Math.floor(ge)===ge?x!=="categorical"&&le==="number"&&typeof ge=="number"&&typeof T=="number"&&T!==void 0&&ge<T?[new s.V(Y.key,pe,"stop domain values must appear in ascending order")]:(T=ge,x==="categorical"&&ge in k?[new s.V(Y.key,pe,"stop domain values must be unique")]:(k[ge]=!0,[])):[new s.V(Y.key,pe,`integer expected, found ${String(ge)}`)]}}function pr(f){const t=(f.expressionContext==="property"?s.W:s.U)(s.S(f.value),f.valueSpec);if(t.result==="error")return t.value.map(p=>new s.V(`${f.key}${p.key}`,f.value,p.message));const c=t.value.expression||t.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.Z(c))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Jt(c,f);if(f.expressionContext==="appearance")return Or(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(c,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(c))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jt(f,t){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const x of t.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return f instanceof s._&&c.has(f.name)?[new s.V(t.key,t.value,`["${f.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(f.eachChild(x=>{p.push(...Jt(x,t))}),p)}function Or(f,t){const c=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const x of t.valueSpec.expression.parameters)c.add(x);if(c.size===0)return[];const p=[];return f instanceof s._&&!c.has(f.name)?[new s.V(t.key,t.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(x=>{p.push(...Or(x,t))}),p)}function sn(f){const t=f.key,c=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(s.J(c))===-1&&x.push(new s.V(t,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(s.J(c))===-1&&x.push(new s.V(t,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function Mn(f){return s.a2(s.S(f.value))?pr(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Gi(f)}function Gi(f){const t=f.value,c=f.key;if(!Array.isArray(t))return[new s.V(c,t,`array expected, ${s.K(t)} found`)];if(t.length<1)return[new s.V(c,t,"filter array must have at least 1 element")];const p=f.styleSpec;let x=sn({key:`${c}[0]`,value:t[0],valueSpec:p.filter_operator});const S=()=>{t.length>=2&&(s.a0(t[1])||x.push(new s.V(`${c}[1]`,t[1],`string expected, ${s.K(t[1])} found`)));for(let T=2;T<t.length;T++)s.J(t[1])==="$type"?x=x.concat(sn({key:`${c}[${T}]`,value:t[T],valueSpec:p.geometry_type})):s.a0(t[T])||s.L(t[T])||s.$(t[T])||x.push(new s.V(`${c}[${T}]`,t[T],`string, number, or boolean expected, ${s.K(t[T])} found.`))};switch(s.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.J(t[1])==="$type"&&x.push(new s.V(c,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&x.push(new s.V(c,t,`filter array for operator "${t[0]}" must have 3 elements`)),S();break;case"==":case"!=":t.length!==3&&x.push(new s.V(c,t,`filter array for operator "${t[0]}" must have 3 elements`)),S();break;case"in":case"!in":S();break;case"any":case"all":case"none":for(let T=1;T<t.length;T++)x=x.concat(Gi({key:`${c}[${T}]`,value:t[T],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":t.length!==2?x.push(new s.V(c,t,`filter array for "${t[0]}" operator must have 2 elements`)):s.a0(t[1])||x.push(new s.V(`${c}[1]`,t[1],`string expected, ${s.K(t[1])} found`))}return x}function yi(f,t){const c=f.key,p=f.style,x=f.layer,S=f.styleSpec,T=f.value,I=f.objectKey,k=S[`${t}_${f.layerType}`];if(!k)return[];const D=I.match(/^(.*)-use-theme$/);if(D&&k[D[1]])return s.Q(s.S(T))?[].concat(ui({key:c,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:S,expressionContext:"property",propertyType:t,propertyKey:I})):ui({key:c,value:T,valueSpec:{type:"string"},style:p,styleSpec:S});const O=I.match(/^(.*)-transition$/);if(t==="paint"&&O&&k[O[1]]&&k[O[1]].transition)return ui({key:c,value:T,valueSpec:S.transition,style:p,styleSpec:S});const q=f.valueSpec||k[I];if(!q)return[new s.a3(c,T,`unknown property "${I}"`)];let U;if(s.a0(T)&&s.N(q)&&!q.tokens&&(U=/^{([^}]+)}$/.exec(T))){const J=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new s.V(c,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const G=[];if(f.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||G.push(new s.V(c,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(T))&&s.J(T.type)==="identity"&&G.push(new s.V(c,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&t==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.N(q)&&(s.a5(q)||s.O(q))){const J=s.W(s.S(T),q).value,Y="expression"in J&&J.expression||"_styleExpression"in J&&J._styleExpression&&J._styleExpression.expression;Y&&!s.X(Y,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(Y)&&s.Z(Y)||G.push(new s.V(c,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(ui({key:f.key,value:T,valueSpec:q,style:p,styleSpec:S,expressionContext:"property",propertyType:t,propertyKey:I}))}function vt(f){return yi(f,"paint")}function or(f){return yi(f,"layout")}function dn(f){let t=[];const c=f.value,p=f.key,x=f.style,S=f.styleSpec;if(!s.H(c))return[new s.V(p,c,"object expected")];c.type||c.ref||t.push(new s.V(p,c,'either "type" or "ref" is required'));let T=s.J(c.type);const I=s.J(c.ref);if(c.id){const k=s.J(c.id);for(let D=0;D<f.arrayIndex;D++){const O=x.layers[D];s.J(O.id)===k&&t.push(new s.V(p,c.id,`duplicate layer id "${k}", previously used at line ${O.id.__line__}`))}}if("ref"in c){let k;["type","source","source-layer","filter","layout"].forEach(D=>{D in c&&t.push(new s.V(p,c[D],`"${D}" is prohibited for ref layers`))}),x.layers.forEach(D=>{s.J(D.id)===I&&(k=D)}),k?k.ref?t.push(new s.V(p,c.ref,"ref cannot reference another ref layer")):T=s.J(k.type):typeof I=="string"&&t.push(new s.V(p,c.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(c.source)if(s.a0(c.source)){const k=x.sources&&x.sources[c.source],D=k&&s.J(k.type);k?D==="vector"&&T==="raster"?t.push(new s.V(p,c.source,`layer "${c.id}" requires a raster source`)):D==="raster"&&T!=="raster"?t.push(new s.V(p,c.source,`layer "${c.id}" requires a vector source`)):D!=="vector"||c["source-layer"]?D==="raster-dem"&&T!=="hillshade"?t.push(new s.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&D==="geojson"&&!k.lineMetrics?t.push(new s.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&D!=="raster-array"&&t.push(new s.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):t.push(new s.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):t.push(new s.V(p,c.source,`source "${c.source}" not found`))}else t.push(new s.V(`${p}.source`,c.source,'"source" must be a string'));else t.push(new s.V(p,c,'missing required property "source"'));return t=t.concat(_i({key:p,value:c,valueSpec:S.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ui({key:`${p}.type`,value:c.type,valueSpec:S.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:k=>Mn(Object.assign({layerType:T},k)),layout:k=>_i({layer:c,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":D=>or(Object.assign({layerType:T},D))}}),paint:k=>_i({layer:c,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":D=>vt(Object.assign({layerType:T,layer:c},D))}}),appearances(k){const D=Je({key:k.key,value:k.value,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:U=>(function(G){const{key:J,layer:Y,layerType:te}=G,le=s.J(G.value),ge=s.J(le.name),pe=s.J(le.condition),de=_i({key:J,value:le,valueSpec:G.styleSpec.appearance,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{condition:Ne=>(function(Ce){const ke=[];return ke.push(...pr({key:Ce.key,value:Ce.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),ke})(Object.assign({layer:Y,layerType:te},Ne)),properties:Ne=>(function(Ce){const ke=[],{styleSpec:Te,layer:_e,layerType:Me}=Ce,Ue=Te[`paint_${Me}`],Ge=Te[`layout_${Me}`],it=Ce.object[Ce.objectKey];for(const tt in it){const mt=tt in Ue?"paint":tt in Ge?"layout":void 0;if(!mt){ke.push(new s.V(Ce.key,tt,`unknown property "${tt}" for layer type "${Me}"`));continue}const Pt=Object.assign({},Ce,{key:`${Ce.key}.${tt}`,object:it,objectKey:tt,layer:_e,layerType:Me,value:it[tt],valueSpec:mt==="paint"?Ue[tt]:Ge[tt]});ke.push(...yi(Pt,mt))}return ke})(Object.assign({layer:Y,layerType:te},Ne))}});return ge!=="hidden"&&pe===void 0&&de.push(new s.V(G.key,"name",'Appearance with name different than "hidden" must have a condition')),de})(Object.assign({layerType:T,layer:c},U))}),O=Array.isArray(k.value)?k.value:[],q=new Set;return O.forEach((U,G)=>{const J=s.J(U.name);if(J)if(q.has(J)){const Y=s.J(c.id);D.push(new s.V(k.key,J,`Duplicated appearance name "${J}" for layer "${Y}"`))}else q.add(J)}),D}}})),t}function Ln({key:f,value:t}){return s.a0(t)?[]:[new s.V(f,t,`string expected, ${s.K(t)} found`)]}const Bn={promoteId:function f({key:t,value:c}){if(s.a0(c))return Ln({key:t,value:c});if(Array.isArray(c)){const x=[],S=s.S(c),T=s.U(S);return T.result==="error"&&T.value.forEach(I=>{x.push(new s.V(`${t}${I.key}`,null,`${I.message}`))}),s.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),x}if(!s.H(c))return[new s.V(t,c,`string, expression or object expected, "${s.K(c)}" found`)];const p=[];for(const x in c)p.push(...f({key:`${t}.${x}`,value:c[x]}));return p}};function Ze(f){const t=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!s.H(t))return[new s.V(c,t,`object expected, ${s.K(t)} found`)];if(!("type"in t))return[new s.V(c,t,'"type" is required')];const S=s.J(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&("url"in t||"tiles"in t||T.push(new s.a3(c,t,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(_i({key:c,value:t,valueSpec:p[`source_${S.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Bn})),T;case"geojson":if(T=_i({key:c,value:t,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Bn}),"cluster"in t&&"clusterProperties"in t){if(!s.H(t.clusterProperties))return[new s.V(`${c}.clusterProperties`,t,`object expected, ${s.K(t)} found`)];for(const I in t.clusterProperties){const k=t.clusterProperties[I];if(!Array.isArray(k))return[new s.V(`${c}.clusterProperties.${I}`,k,"array expected")];const[D,O]=k,q=typeof D=="string"?[D,["accumulated"],["get",I]]:D;T.push(...pr({key:`${c}.${I}.map`,value:O,expressionContext:"cluster-map"})),T.push(...pr({key:`${c}.${I}.reduce`,value:q,expressionContext:"cluster-reduce"}))}}return T;case"video":return _i({key:c,value:t,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return _i({key:c,value:t,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new s.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sn({key:`${c}.type`,value:t.type,valueSpec:{values:ur(p)}})}}function ur(f){return f.source.reduce((t,c)=>{const p=f[c];return p.type.type==="enum"&&(t=t.concat(Object.keys(p.type.values||{}))),t},[])}function kr(f){const t=f.value,c=f.styleSpec,p=c.light,x=f.style;if(t===void 0)return[];if(!s.H(t))return[new s.V("light",t,`object expected, ${s.K(t)} found`)];let S=[];for(const T in t){const I=T.match(/^(.*)-transition$/),k=T.match(/^(.*)-use-theme$/);S=S.concat(k&&p[k[1]]?ui({key:T,value:t[T],valueSpec:{type:"string"},style:x,styleSpec:c}):I&&p[I[1]]&&p[I[1]].transition?ui({key:T,value:t[T],valueSpec:c.transition,style:x,styleSpec:c}):p[T]?ui({key:T,value:t[T],valueSpec:p[T],style:x,styleSpec:c}):[new s.V(T,t[T],`unknown property "${T}"`)])}return S}function An(f){const t=f.value;if(!t)return[];const c=f.key;if(!s.H(t))return[new s.V(c,t,`object expected, ${s.K(t)} found`)];let p=[];const x=f.styleSpec,S=x["light-3d"],T=f.style,I=f.style.lights;for(const O of["type","id"])if(!(O in t))return p=p.concat([new s.V(c,t,`missing property "${O}"`)]),p;if(!s.a0(t.type))return p=p.concat([new s.V(`${c}.type`,t.type,"string expected")]),p;if(I)for(let O=0;O<f.arrayIndex;O++){const q=s.J(t.type),U=I[O];s.J(U.type)===q&&p.push(new s.V(c,t.id,`duplicate light type "${t.type}", previously defined at line ${U.id.__line__}`))}const k=`properties_light_${t.type}`;if(!(k in x))return p=p.concat([new s.V(`${c}.type`,t,`Invalid light type ${t.type}`)]),p;const D=x[k];for(const O in t)if(O==="properties"){const q=t[O];if(!s.H(q))return p=p.concat([new s.V("properties",q,`object expected, ${s.K(q)} found`)]),p;for(const U in q){const G=U.match(/^(.*)-transition$/),J=U.match(/^(.*)-use-theme$/);p=p.concat(J&&D[J[1]]?ui({key:O,value:q[U],valueSpec:{type:"string"},style:T,styleSpec:x}):G&&D[G[1]]&&D[G[1]].transition?ui({key:O,value:t[O],valueSpec:x.transition,style:T,styleSpec:x}):D[U]?ui({key:U,value:q[U],valueSpec:D[U],style:T,styleSpec:x}):[new s.a3(f.key,q[U],`unknown property "${U}"`)])}}else p=p.concat(S[O]?ui({key:O,value:t[O],valueSpec:S[O],style:T,styleSpec:x}):[new s.a3(O,t[O],`unknown property "${O}"`)]);return p}function ki(f){const t=f.value,c=f.key,p=f.style,x=f.styleSpec,S=x.terrain;if(t==null)return[];if(!s.H(t))return[new s.V("terrain",t,`object expected, ${s.K(t)} found`)];let T=[];for(const I in t){const k=I.match(/^(.*)-transition$/),D=I.match(/^(.*)-use-theme$/);T=T.concat(D&&S[D[1]]?ui({key:I,value:t[I],valueSpec:{type:"string"},style:p,styleSpec:x}):k&&S[k[1]]&&S[k[1]].transition?ui({key:I,value:t[I],valueSpec:x.transition,style:p,styleSpec:x}):S[I]?ui({key:I,value:t[I],valueSpec:S[I],style:p,styleSpec:x}):[new s.a3(I,t[I],`unknown property "${I}"`)])}if(t.source)if(s.a0(t.source)){const I=p.sources&&p.sources[t.source],k=I&&s.J(I.type);I?k!=="raster-dem"&&T.push(new s.V(`${c}.source`,t.source,`terrain cannot be used with a source of type ${k}, it only be used with a "raster-dem" source type`)):T.push(new s.V(`${c}.source`,t.source,`source "${t.source}" not found`))}else T.push(new s.V(`${c}.source`,t.source,"source must be a string"));else T.push(new s.V(c,t,'terrain is missing required property "source"'));return T}function Yn(f){const t=f.value,c=f.style,p=f.styleSpec,x=p.fog;if(t===void 0)return[];if(!s.H(t))return[new s.V("fog",t,`object expected, ${s.K(t)} found`)];let S=[];for(const T in t){const I=T.match(/^(.*)-transition$/),k=T.match(/^(.*)-use-theme$/);S=S.concat(k&&x[k[1]]?ui({key:T,value:t[T],valueSpec:{type:"string"},style:c,styleSpec:p}):I&&x[I[1]]&&x[I[1]].transition?ui({key:T,value:t[T],valueSpec:p.transition,style:c,styleSpec:p}):x[T]?ui({key:T,value:t[T],valueSpec:x[T],style:c,styleSpec:p}):[new s.a3(T,t[T],`unknown property "${T}"`)])}return S}const Ri={"*":()=>[],array:Je,boolean:function(f){const t=f.value,c=f.key;return s.$(t)?[]:[new s.V(c,t,`boolean expected, ${s.K(t)} found`)]},number:jt,color:function({key:f,value:t}){return s.a0(t)?s.a1.parseCSSColor(t)===null?[new s.V(f,t,`color expected, "${t}" found`)]:[]:[new s.V(f,t,`color expected, ${s.K(t)} found`)]},enum:sn,filter:Mn,function:yr,layer:dn,object:_i,source:Ze,model:s.a7,light:kr,"light-3d":An,terrain:ki,fog:Yn,string:Ln,formatted:function(f){return Ln(f).length===0?[]:pr(f)},resolvedImage:function(f){return Ln(f).length===0?[]:pr(f)},projection:function(f){const t=f.value,c=f.styleSpec,p=c.projection,x=f.style;if(s.H(t)){let S=[];for(const T in t)S=S.concat(ui({key:T,value:t[T],valueSpec:p[T],style:x,styleSpec:c}));return S}return s.a0(t)?[]:[new s.V("projection",t,`object or string expected, ${s.K(t)} found`)]},import:function(f){const t=f.key,{value:c,styleSpec:p}=f;if(!s.H(c))return[new s.V(t,c,"import must be an object")];const{data:x,...S}=c;Object.defineProperty(S,"__line__",{value:c.__line__,enumerable:!1});let T=_i(Object.assign({},f,{value:S,valueSpec:p.import}));return s.J(S.id)===""&&T.push(new s.V(`${f.key}.id`,S,"import id can't be an empty string")),x&&(T=T.concat(oo(x,p,{key:`${f.key}.data`}))),T},iconset:function(f){const t=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!s.H(t))return[new s.V(c,t,"object expected")];if(!t.type)return[new s.V(c,t,'"type" is required')];const S=s.J(t.type);let T=[];if(T=T.concat(_i({key:c,value:t,valueSpec:p[`iconset_${S}`],style:x,styleSpec:p})),(function(I,k){return!(I!=="source"||!k.source)})(S,t)){const I=x.sources&&x.sources[t.source],k=I&&s.J(I.type);I?k!=="raster-array"&&T.push(new s.V(c,t.source,`iconset cannot be used with a source of type ${String(k)}, it only be used with a "raster-array" source type`)):T.push(new s.V(c,t.source,`source "${t.source}" not found`))}return T}};function ui(f,t=!1){const c=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression){if(s.a4(s.J(c)))return yr(f);if(s.Q(s.S(c)))return pr(f)}if(p.type&&Ri[p.type]){const S=Ri[p.type](f);return t===!0&&S.length>0&&Array.isArray(f.value)?pr(f):S}return _i(Object.assign({},f,{valueSpec:p.type?x[p.type]:p}))}function _i(f){const t=f.key,c=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},S=f.style,T=f.styleSpec;if(!s.H(c))return[new s.V(t,c,`object expected, ${s.K(c)} found`)];let I=[];for(const k in c){const D=k.split(".")[0];let O;x[D]?O=x[D]:p[D]?O=ui:x["*"]?O=x["*"]:p["*"]&&(O=ui),O?I=I.concat(O({key:(t&&`${t}.`)+k,value:c[k],valueSpec:p[D]||p["*"],style:S,styleSpec:T,object:c,objectKey:k},c)):I.push(new s.a3(t,c[k],`unknown property "${k}"`))}for(const k in p){if(x[k])continue;const D=p[k];D.required&&D.default===void 0&&c[k]===void 0&&I.push(new s.V(t,c,`missing required property "${k}"`))}return I}function Ds({key:f,value:t}){const c=Ln({key:f,value:t});if(c.length)return c;const p=t;return p.indexOf("{fontstack}")===-1&&c.push(new s.V(f,t,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new s.V(f,t,'"glyphs" url must include a "{range}" token')),c}function oo(f,t=s.a6,c={}){return _i({key:c.key||"",value:f,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:f,objectElementValidators:{glyphs:Ds}})}function Is(f,t=s.a6){return Ee(oo(f,t))}const ao=f=>Ee(Ze(f)),No=f=>Ee(kr(f)),Nt=f=>Ee(An(f)),us=f=>Ee(ki(f)),ks=f=>Ee(Yn(f)),fo=f=>Ee((function(t){const c=t.value,p=t.style,x=t.styleSpec,S=x.snow;if(c===void 0)return[];if(!s.H(c))return[new s.V("snow",c,`object expected, ${s.K(c)} found`)];let T=[];for(const I in c){const k=I.match(/^(.*)-transition$/);T=T.concat(k&&S[k[1]]&&S[k[1]].transition?ui({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):S[I]?ui({key:I,value:c[I],valueSpec:S[I],style:p,styleSpec:x}):[new s.a3(I,c[I],`unknown property "${I}"`)])}return T})(f)),vn=f=>Ee((function(t){const c=t.value,p=t.style,x=t.styleSpec,S=x.rain;if(c===void 0)return[];if(!s.H(c))return[new s.V("rain",c,`object expected, ${s.K(c)} found`)];let T=[];for(const I in c){const k=I.match(/^(.*)-transition$/);T=T.concat(k&&S[k[1]]&&S[k[1]].transition?ui({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):S[I]?ui({key:I,value:c[I],valueSpec:S[I],style:p,styleSpec:x}):[new s.a3(I,c[I],`unknown property "${I}"`)])}return T})(f)),$e=f=>Ee(dn(f)),ne=f=>Ee(Mn(f)),ce=f=>Ee(vt(f)),be=f=>Ee(or(f)),De=f=>Ee(s.a7(f));function Ee(f){return f.slice().sort((t,c)=>t.line&&c.line?t.line-c.line:0)}function Fe(f,t){let c=!1;if(t&&t.length)for(const p of t)p instanceof s.a3?s.w(p.message):(f.fire(new s.y(new Error(p.message))),c=!0);return c}const et=s.a6.light;let qe;class fe extends s.E{constructor(t,c="flat"){super(),this._transitionable=new s.a8(qe||(qe=new s.a9({anchor:new s.aa(et.anchor),position:new s.ab(et.position),color:new s.aa(et.color),intensity:new s.aa(et.intensity)}))),this.setLight(t,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,c,p={}){this._validate(No,t,p)||(this._transitionable.setTransitionOrValue(t),this.id=c)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,c,p){return(!p||p.validate!==!1)&&Fe(this,t.call(Is,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const Ve=s.a6.terrain;let Xe=class extends s.E{constructor(f,t,c,p,x){super(),this.scope=c,this._transitionable=new s.a8(new s.a9({source:new s.aa(Ve.source),exaggeration:new s.aa(Ve.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=x}get(){return this._transitionable.serialize()}set(f,t){this._transitionable.setTransitionOrValue(f,t)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const t=f.value.expression;if(!t)return null;let c=-1,p=-1,x=1;for(const S of t.zoomStops)x=t.evaluate(new s.ac(S,{worldview:this.worldview})),x>.01?(c=S,p=-1):p=S;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.ad}};const ct=.05;function tr(f,t,c,p){const x=s.ah(45,65,c),[S,T]=cr(f,p);let I=1-Math.min(1,Math.exp((t-S)/(T-S)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*f.alpha}function cr(f,t){const c=.5/Math.tan(.5*t);return[f.range[0]+c,f.range[1]+c]}function Nr(f,t,c,p,x){const S=s.af([],[t,c,p],x.mercatorFogMatrix);return tr(f,s.ag(S),x.pitch,x._fov)}function Ir(f,t,c,p,x,S,T){const I=[[c,p,0],[x,p,0],[x,S,0],[c,S,0]];let k=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const O of I){const q=s.af([],O,t),U=s.ag(q);k=Math.min(k,U),D=Math.max(D,U)}return[tr(f,k,T.pitch,T._fov),tr(f,D,T.pitch,T._fov)]}const jr=s.a6.fog;class Rr extends s.E{constructor(t,c,p,x){super();const S=new s.a9({range:new s.aa(jr.range),color:new s.aa(jr.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(jr["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(jr["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(jr["horizon-blend"]),"star-intensity":new s.aa(jr["star-intensity"]),"vertical-range":new s.aa(jr["vertical-range"])});this._transitionable=new s.a8(S,p,new Map(x)),this.set(t,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new s.ai(S),this.scope=p}get state(){const t=this._transform,c=t.projection.name==="globe",p=s.aj(t.zoom),x=this.properties.get("range"),S=[.5,3];return{range:c?[s.ak(S[0],x[0],p),s.ak(S[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,c,p={}){if(this._validate(ks,t,p))return;const x=Object.assign({},t);for(const S of Object.keys(jr))x[S]===void 0&&(x[S]=jr[S].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,t))*c.a}getOpacityAtLatLng(t,c){return this._transform.projection.supportsFog?(function(p,x,S){const T=s.ae.fromLngLat(x),I=S.elevation?S.elevation.getAtPointOrZero(T):0;return Nr(p,T.x,T.y,I,S)})(this.state,t,c):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ir(this.state,c,0,0,s.al,s.al,this._transform)}getOpacityForBounds(t,c,p,x,S){return this._transform.projection.supportsFog?Ir(this.state,t,c,p,x,S,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?cr(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=t.points[p];let S;if(x[2]>=0)S=x;else{const T=t.points[p-4];S=s.am(T,x,T[2]/(T[2]-x[2]))}if(Nr(this.state,S[0],S[1],0,this._transform)>=ct)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,c,p){return(!p||p.validate!==!1)&&Fe(this,t.call(Is,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let ni,$i,rs,Yi=class extends s.E{constructor(f,t,c,p){super();const x=ni||(ni=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=c}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),c=this.properties.get("direction"),p=s.an(c[0]),x=-Math.max(s.an(c[1]),.01),S=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*f),direction:S,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(f,t,c={}){if(this._validate(fo,f,c))return;const p=Object.assign({},f),x=s.a6.snow;for(const S of Object.keys(x))p[S]===void 0&&(p[S]=x[S].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,c){return(!c||c.validate!==!1)&&Fe(this,f.call(Is,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Ii=class extends s.E{constructor(f,t,c,p){super();const x=$i||($i=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=c}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),c=this.properties.get("direction"),p=s.an(c[0]),x=-Math.max(s.an(c[1]),.01),S=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*f),direction:S,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,t,c={}){if(this._validate(vn,f,c))return;const p=Object.assign({},f),x=s.a6.rain;for(const S of Object.keys(x))p[S]===void 0&&(p[S]=x[S].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,c){return(!c||c.validate!==!1)&&Fe(this,f.call(Is,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class gn extends s.E{constructor(t,c,p,x){super(),this.scope=p,this._options=t,this.properties=new s.ai(c),this._transitionable=new s.a8(c,p,new Map(x)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,c){this._options=t,this._transitionable.setTransitionOrValue(t.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Ni=()=>rs||(rs=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let In;const di=()=>In||(In=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class Oi{constructor(t,c,p){this.screenBounds=t,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,c){let p,x;if(t instanceof s.P||typeof t[0]=="number"){const S=s.P.convert(t);p=[S],x=c.isPointAboveHorizon(S)}else{const S=s.P.convert(t[0]),T=s.P.convert(t[1]),I=S.add(T)._div(2);p=[S,T],x=s.aq(S,T).every(k=>c.isPointAboveHorizon(k))&&c.isPointAboveHorizon(I)}return new Oi(p,x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),s.ar(x,t)}bufferedCameraGeometryGlobe(t){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(c,p,t),S=this.cameraPoint.clone();switch(3*((S.y>c.y)+(S.y>p.y))+((S.x>c.x)+(S.x>p.x))){case 0:x[0]=S,x[4]=S.clone();break;case 1:x.splice(1,0,S);break;case 2:x[1]=S;break;case 3:x.splice(4,0,S);break;case 5:x.splice(2,0,S);break;case 6:x[3]=S;break;case 7:x.splice(3,0,S);break;case 8:x[2]=S}return x}containsTile(t,c,p,x=0){const S=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(S,c):this._bufferedScreenMercator(S,c);let I=t.tileID.wrap+(T.unwrapped?x:0);const k=T.polygon.map(te=>s.as(t.tileTransform,te,I));if(!s.at(k,0,0,s.al,s.al))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(te=>s.au(t.tileTransform,te,I)),O=D.map(te=>new s.P(te[0],te[1])),q=c.getFreeCameraOptions().position||new s.ae(0,0,0),U=s.au(t.tileTransform,q,I),G=D.map(te=>{const le=s.av(te,te,U);return s.aw(le,le),new s.ax(U,le)}),J=s.ay(t,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:G,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(Y=s.az(k),Y.min.x=s.aA(Y.min.x,0,s.al),Y.min.y=s.aA(Y.min.y,0,s.al),Y.max.x=s.aA(Y.max.x,0,s.al),Y.max.y=s.aA(Y.max.y,0,s.al),Y),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:J};var Y}_bufferedScreenMercator(t,c){const p=Qi(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),c):{polygon:this.bufferedScreenGeometry(t).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(t,c){const p=Qi(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),c):{polygon:this.bufferedCameraGeometry(t).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(t,c){const p=(function(S,T){const I=s.aB([],T.pixelMatrix,T.globeMatrix),k=[0,-s.aD,0,1],D=[0,s.aD,0,1],O=[0,0,0,1];s.aC(k,k,I),s.aC(D,D,I),s.aC(O,O,I);const q=new s.P(k[0]/k[3],k[1]/k[3]),U=new s.P(D[0]/D[3],D[1]/D[3]),G=s.aE(S,q)&&k[3]<O[3],J=s.aE(S,U)&&D[3]<O[3];if(!G&&!J)return null;const Y=(function(ke,Te,_e){for(let Me=1;Me<ke.length;Me++){const Ue=bs(Te.pointCoordinate3D(ke[Me-1]).x),Ge=bs(Te.pointCoordinate3D(ke[Me]).x);if(_e<0){if(Ue<Ge)return{idx:Me,t:-Ue/(Ge-1-Ue)}}else if(Ge<Ue)return{idx:Me,t:(1-Ue)/(Ge+1-Ue)}}return null})(S,T,G?-1:1);if(!Y)return null;const{idx:te,t:le}=Y;let ge=te>1?js(S.slice(0,te),T):[],pe=te<S.length?js(S.slice(te),T):[];ge=ge.map(ke=>new s.P(bs(ke.x),ke.y)),pe=pe.map(ke=>new s.P(bs(ke.x),ke.y));const de=[...ge];de.length===0&&de.push(pe[pe.length-1]);const Ne=s.ak(de[de.length-1].y,(pe.length===0?ge[0]:pe[0]).y,le);let Ce;return Ce=G?[new s.P(0,Ne),new s.P(0,0),new s.P(1,0),new s.P(1,Ne)]:[new s.P(1,Ne),new s.P(1,1),new s.P(0,1),new s.P(0,Ne)],de.push(...Ce),pe.length===0?de.push(ge[0]):de.push(...pe),{polygon:de.map(ke=>new s.ae(ke.x,ke.y)),unwrapped:!1}})(t,c);if(p)return p;const x=(function(S,T){let I=!1,k=-1/0,D=0;for(let q=0;q<S.length-1;q++)S[q].x>k&&(k=S[q].x,D=q);for(let q=0;q<S.length-1;q++){const U=(D+q)%(S.length-1),G=S[U],J=S[U+1];Math.abs(G.x-J.x)>.5&&(G.x<J.x?(G.x+=1,U===0&&(S[S.length-1].x+=1)):(J.x+=1,U+1===S.length-1&&(S[0].x+=1)),I=!0)}const O=s.aF(T.center.lng);return I&&O<Math.abs(O-1)&&S.forEach(q=>{q.x-=1}),{polygon:S,unwrapped:I}})(js(t,c).map(S=>new s.P(bs(S.x),S.y)),c);return{polygon:x.polygon.map(S=>new s.ae(S.x,S.y)),unwrapped:x.unwrapped}}}function js(f,t){return s.aG(f,c=>{const p=t.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function bs(f){return f<0?1+f%1:f%1}function Qi(f){return 100*f|0}function po(f,t,c,p,x){const S=function(I,k){if(I)return x(I);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return x(new Error("variants must be an array"));for(const O of k.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return x(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){k=Object.assign(k,O);break}}}const D=s.aH(Object.assign({},k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=t.canonicalizeTileset(D,f.url),x(null,D)}},T=(function(I,k,D){if(!I)return null;if(!k&&!D)return I;D=D||I.worldview_default;const O=Object.values(I.language||{});if(O.length===0)return null;const q=Object.values(I.worldview||{});if(q.length===0)return null;const U=O.every(J=>J===k),G=q.every(J=>J===D);return U&&G?I:k in(I.language_options||{})||D in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null})(f.data,c,p);return T?s.o.frame(()=>S(null,T)):f.url?s.m(t.transformRequest(t.normalizeSourceURL(f.url,null,c,p),s.R.Source),S):s.o.frame(()=>{const{data:I,...k}=f;S(null,k)})}function Hi(f,t){const c=Math.pow(2,t.z),p=Math.floor(s.aF(f.getWest())*c),x=Math.floor(s.aJ(f.getNorth())*c),S=Math.ceil(s.aF(f.getEast())*c),T=Math.ceil(s.aJ(f.getSouth())*c);return t.x>=p&&t.x<S&&t.y>=x&&t.y<T}class ws{constructor(t,c,p){this.bounds=t?s.aI.convert(this.validateBounds(t)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const c of t)this.extraBounds.push(s.aI.convert(this.validateBounds(c)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Hi(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Hi(c,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const c=new ws(t.bounds,t.minzoom,t.maxzoom);return c.addExtraBounds(t.extra_bounds),c}}class ra extends s.E{constructor(t,c,p,x){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.aK}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=po(this._options,this.map._requestManager,c,p,(x,S)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(x));else if(S){if(Object.assign(this,S),this.hasWorldviews=!!S.worldview_options,S.worldview_default&&(this.worldviewDefault=S.worldview_default),S.vector_layers){this.vectorLayers=S.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of S.vector_layers)this.vectorLayerIds.push(T.id),S.worldview&&S.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=ws.fromTileJSON(S),xr(S.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(x)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,c){const p=t.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),S=this.map._requestManager.transformRequest(x,s.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,I=T?{image:T.image.clone()}:null,k={request:S,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(p)&&(k.localizableLayerIds=this.localizableLayerIds),k.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=c:t.request=t.actor.send("reloadTile",k,D.bind(this));else if(t.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",k,D.bind(this),void 0,!0);else{const O=s.aL.call({deduped:this._deduped},k,(q,U)=>{if(q||!U)D.call(this,q);else{const G=s.aM(U.responseHeaders);k.data={rawData:U.rawData.slice(0),expires:G.expires,cacheControl:G.cacheControl},t.actor&&t.actor.send("loadTile",k,D.bind(this),void 0,!0)}},!0);t.request={cancel:O}}function D(O,q){return delete t.request,t.aborted?c(null):O&&O instanceof s.aN&&O.status!==404?c(O):(q&&q.resourceTiming&&(t.resourceTiming=q.resourceTiming),this.map._refreshExpiredTiles&&q&&t.setExpiryData(q),t.loadVectorData(q,this.map.painter),s.aO(this.dispatcher),c(null,q),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,c){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Uo extends s.E{constructor(t,c,p,x){super(),this.id=t,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,s.aH(c,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=po(this._options,this.map._requestManager,null,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),this.tileBounds=ws.fromTileJSON(x),xr(x.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(p)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,c){const p=s.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=s.n(this.map._requestManager.transformRequest(x,s.R.Tile),(S,T,I)=>{if(delete t.request,t.aborted)return t.state="unloaded",c(null);if(S)return t.state="errored",c(S);if(!T)return c(null);const k=s.aM(I);this.map._refreshExpiredTiles&&t.setExpiryData(k),t.setTexture(T,this.map.painter),t.state="loaded",s.aO(this.dispatcher),c(null)})}abortTile(t,c){t.request&&(t.request.cancel(),delete t.request),c&&c()}unloadTile(t,c){t.texture&&t.texture instanceof s.T?(t.destroy(!1),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function lo([f,t],c,p,{scaled:x=!0}={}){const{tileSize:S,buffer:T}=p,{x:I,y:k,z:D}=c;if(!isFinite(I)||!isFinite(k)||!isFinite(D))throw new Error("Invalid MRT header");const O=2**D,q=O*s.aF(f),U=O*s.aJ(t);return(function([G,J],Y,{scaled:te=!0}={}){if(!Y)throw new Error("bandView is undefined");const{data:le,tileSize:ge,buffer:pe,offset:de,scale:Ne,dimension:Ce}=Y;if(G<-pe||G>ge+pe||J<-pe||J>ge+pe)throw new Error(`Point (${G}, ${J}) out of bounds for tileSize=${ge}, buffer=${pe}`);const ke=(J+pe)*(ge+2*pe)+(G+pe);if(new Uint32Array(le.buffer)[ke]===4294967295)return null;let Te=[];Te=te?[]:new Y.data.constructor(Ce);for(let _e=0;_e<Ce;_e++)Te[_e]=Math.round(1e12*(le[Ce*ke+_e]*Ne+de))/1e12;return Te})([Math.min(Math.max(-T,Math.floor((q-I)*S)),S-1+T),Math.min(Math.max(-T,Math.floor((U-k)*S)),S-1+T)],p,{scaled:x})}class ot extends Uo{constructor(t,c,p,x){super(t,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(t){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,t.tileID),this.map.triggerRepaint()}loadTile(t,c){const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile),S={request:x,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=x,t.actor||(t.actor=this.dispatcher.getActor());const T=(I,k,D)=>{if(delete t.request,t.aborted)return t.state="unloaded",c(null);if(I)return I.name==="AbortError"?void 0:(t.state="errored",c(I));if(this.map._refreshExpiredTiles&&k){const O=s.aM(D);t.setExpiryData(O)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!k)return c(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=k}c(null)};t.request=this.partial?t.fetchHeader(void 0,T.bind(this)):t.actor.send("loadTile",S,T.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,c){const p=t.texturePerLayer;if(t.flushAllQueues(),p.size){t.destroy(!1);for(const x of p.values())this.map.painter.saveTileTexture(x)}else t.destroy()}prepareTile(t,c,p,x){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(c,p,x,(S,T)=>{if(S)return t.state="errored",this.fire(new s.y(S)),void this.triggerRepaint(t);T&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(p,T,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:S})=>S===t),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(t,c,p){if(!t)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let S=null;c instanceof s.aR?S=c.paint.get("raster-array-band"):c instanceof s.aS&&(S=c.paint.get("raster-particle-array-band"));const T=S||this.getInitialBand(x);if(T==null)return;if(!t.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(t,x,c.id,T);if(t.updateNeeded(c.id,T)&&!p)return;const I=t.textureDescriptorPerLayer.get(c.id);return Object.assign({},I,{texture:t.texturePerLayer.get(c.id)})}getImages(t,c){const p=new Map;for(const x of t)for(const S of c){const[T,I]=S.split("/"),k=x.getLayer(T);if(!k||!k.hasBand(I)||!k.hasDataForBand(I))continue;const{bytes:D,tileSize:O,buffer:q}=k.getBandView(I),U=O+2*q,G={data:new s.q({width:U,height:U},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(S,G)}return p}queryRasterArrayValueByBandId(t,c,p){const x=c._mrt;return new Promise(S=>{const T={},I=new Set;for(const[k,D]of Object.entries(x.layers)){if(p.layerName&&k!==p.layerName)continue;const O={};T[k]=O;for(const{bands:q}of D.dataIndex)for(const U of q)p.bands&&!p.bands.includes(U)||(I.add(s.B(k,U)),c.fetchBand(k,null,U,G=>{s.o.frame(()=>{O[U]=G?null:lo([t.lng,t.lat],x,D.getBandView(U)),I.delete(s.B(k,U)),I.size===0&&S(T)})},!1))}I.size===0&&S(T)})}_loadTileForQuery(t,c){if(this._loadTileLoaded[t.uid])return void c(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(c);this._loadTilePending[t.uid]=[c];const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile);t.actor.send("loadTile",{request:x,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(S,T,I)=>{if(S)return this._loadTilePending[t.uid].forEach(k=>k(S,null)),void delete this._loadTilePending[t.uid];if(!T)return this._loadTilePending[t.uid].forEach(k=>k(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&T){const k=s.aM(I);t.setExpiryData(k)}t._mrt=T,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(k=>k(null,T)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,c,p){return new Promise((x,S)=>{this._loadTileForQuery(c,(T,I)=>{T?S(T):x(I?this.queryRasterArrayValueByBandId(t,c,p):null)})})}queryRasterArrayValue(t,c){const p=s.aT.convert(t),x=this.findLoadedParent(p);return x&&x._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,c):this.queryRasterArrayValueByAllBands(p,x,c):Promise.resolve(null)}findLoadedParent(t){const c=s.ae.fromLngLat(t,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,S=Math.floor(c.x),T=Math.floor((c.x-S)*x),I=Math.floor(c.y*x),k=this.map.style.getSourceCache(this.id),D=new s.aQ(p,S,p,T,I);return k.findLoadedParent(D,this.minzoom)}}const br={vector:ra,raster:Uo,"raster-dem":class extends Uo{constructor(f,t,c,p){super(f,t,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,S){x&&(f.state="errored",t(x)),S&&(f.dem=S,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=s.n(this.map._requestManager.transformRequest(c,s.R.Tile),(function(x,S,T){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(x)f.state="errored",t(x);else if(S){const I=s.aM(T);this.map._refreshExpiredTiles&&f.setExpiryData(I);const k=ImageBitmap&&S instanceof ImageBitmap&&s.r(),D=1-(S.width-s.aP(S.width))/2;D<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=k?S:s.o.getImageData(S,D),q={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:D};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",q,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const t=f.canonical,c=Math.pow(2,t.z),p=(t.x-1+c)%c,x=t.x===0?f.wrap-1:f.wrap,S=(t.x+1+c)%c,T=t.x+1===c?f.wrap+1:f.wrap,I={};return I[new s.aQ(f.overscaledZ,x,t.z,p,t.y).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,T,t.z,S,t.y).key]={backfilled:!1},t.y>0&&(I[new s.aQ(f.overscaledZ,x,t.z,p,t.y-1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,T,t.z,S,t.y-1).key]={backfilled:!1}),t.y+1<c&&(I[new s.aQ(f.overscaledZ,x,t.z,p,t.y+1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new s.aQ(f.overscaledZ,T,t.z,S,t.y+1).key]={backfilled:!1}),I}},"raster-array":ot,geojson:class extends s.E{constructor(f,t,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const x=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*x,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*x,extent:s.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*x,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const c of this._data.features)t.set(c.id,c);for(const c of f.features)t.set(c.id,c);this._data.features=[...t.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterLeaves(f,t,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:t,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:f},this.workerOptions);t.scope=this.scope;const c=this._data;typeof c=="string"?(t.request=this.map._requestManager.transformRequest(s.o.resolveURL(c),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(S.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",S)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,t){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,S=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:S,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};f.request=this.actor.send(c,T,(I,k)=>S&&!k?(f.state="loaded",t(null)):(delete f.request,f.destroy(!1),f.aborted?t(null):I?t(I):(f.loadVectorData(k,this.map.painter,c==="reloadTile"),t(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,t){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(f,t,c,p){super(f,t,c,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aV(this.urls,(t,c)=>{this._loaded=!0,t?this.fire(new s.y(t)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(f,t,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=po(this._options,this.map._requestManager,t,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new ws(x.bounds,this.minzoom,this.maxzoom)),xr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,t){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=t;else{if(f.buckets){const S=Object.values(f.buckets);for(const T of S)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(S,T){return f.aborted?t(null):S&&S.status!==404?t(S):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(f,t,c,p){super(f,t,c,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(S=>typeof S!="number"))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,t,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ws(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:t,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:c,y:p,z:x}=f.tileID.canonical,S=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:S.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",t(null)):T===void 0?(f.state="errored",t(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):(function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement})(T)?(this.loadTileData(f,T),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(f.state="errored",t(T))}),f.request.cancel=()=>S.abort()}loadTileData(f,t){f.setTexture(t,this.map.painter)}unloadTile(f,t){if(f.texture&&f.texture instanceof s.T?(f.destroy(!1),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}t&&t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},pn=function(f,t,c,p){const x=new br[t.type](f,t,c,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return s.aY(["load","abort","unload","serialize","prepare"],x),x};function Vn(f,t,c=""){return`${c}:${t.id||""}:${t.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:S}=p;return`featureset:${x}${S?`:import:${S}`:""}`}})(f.target)}`}function $n(f,t,c,p=""){if(f.uniqueFeatureID){const x=Vn(f,t,p);if(c.has(x))return!0;c.add(x)}return!1}function jo(f,t,c,p,x=!1,S=void 0){const T=t.sourceCache.transform,I=t.sourceCache.tilesIn(f,t.has3DLayers,x);I.sort(Rd);const k=[];for(const D of I){const O=D.tile.queryRenderedFeatures(t,D,c,p,T,x,S);Object.keys(O).length&&k.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:O})}for(const D in t.layers){const O=t.layers[D];if(O.styleLayer){const q=O.styleLayer.queryRenderedFeatures(f,t.sourceCache,p);Object.keys(q).length&&k.push({wrappedTileID:0,queryResults:q})}}return k.length===0?{}:(function(D){const O={},q={};for(const U of D){const G=U.queryResults,J=U.wrappedTileID,Y=q[J]=q[J]||{};for(const te in G){const le=G[te],ge=Y[te]=Y[te]||{},pe=O[te]=O[te]||[];for(const de of le)ge[de.featureIndex]||(ge[de.featureIndex]=!0,pe.push(de))}}return O})(k)}function Il(f,t,c,p,x,S){const T={},I=p.queryRenderedSymbols(f),k=[];for(const D of Object.keys(I).map(Number))k.push(x[D]);k.sort(Rd);for(const D of k){const O=D.featureIndex.lookupSymbolFeatures(I[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,t,c,S);for(const q in O){const U=T[q]=T[q]||[],G=O[q];G.sort((J,Y)=>{const te=D.featureSortOrder;if(te){const le=te.indexOf(J.featureIndex);return te.indexOf(Y.featureIndex)-le}return Y.featureIndex-J.featureIndex});for(const J of G)U.push(J)}}return T}function eu(f,t){const c=f.getRenderableIds().map(S=>f.getTileByID(S)),p=[],x={};for(let S=0;S<c.length;S++){const T=c[S],I=T.tileID.canonical.key;x[I]||(x[I]=!0,T.querySourceFeatures(p,t))}return p}function Rd(f,t){const c=f.tileID,p=t.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Lu(f,t){const c={};if(!t)return c;for(const p of f){const x=p.layerIds.map(S=>t.getLayer(S)).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(S=>x.filter(T=>T.id===S)[0]));for(const S of x)c[S.fqid]=p}}return c}const Rs=32,$o=33,La=new Uint16Array(8184);for(let f=0;f<2046;f++){let t=f+2,c=0,p=0,x=0,S=0,T=0,I=0;for(1&t?x=S=T=Rs:c=p=I=Rs;(t>>=1)>1;){const D=c+x>>1,O=p+S>>1;1&t?(x=c,S=p,c=T,p=I):(c=x,p=S,x=T,S=I),T=D,I=O}const k=4*f;La[k+0]=c,La[k+1]=p,La[k+2]=x,La[k+3]=S}const Fs=new Uint16Array(2178),_t=new Uint8Array(1089),Tr=new Uint16Array(1089);function an(f){return f===0?-.03125:f===32?.03125:0}const Gn={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Ei{constructor(t,c,p,x,S,T){this.tileID=t,this.uid=s.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(t){const c=t+this.timeAdded;c<s.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,c,p){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Lu(t.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof s.b4){if(this.hasSymbolBuckets=!0,!p)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof s.b4&&S.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x],T=c.style.getOwnLayer(x);if(!T)continue;const I=T.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,c,p){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Lu(t.buckets,c.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,c){for(const S in this.buckets){const T=this.buckets[S];if(T.uploadPending()){let I={},k=[],D={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){k=c.style.listImages();const O=T.layers[0],q=O.sourceLayer||"_geojsonTileLayer",U=c.style.getLayerSourceCache(O);U&&(I=U._state.getState(q,void 0))}D={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}T.upload(t,this.tileID.canonical,I,k,D)}}const p=t.gl,x=this.imageAtlas;x&&!x.uploaded&&(this.imageAtlasTexture=new s.T(t,x.image,p.RGBA8,{useMipmap:!!x.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(t,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&c){const S=c.style.getLut(p);this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,p,S)}if(!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||x||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const c in this.buckets){const p=this.buckets[c];p.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,p.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,c,p,x,S,T,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const k=this.evaluateQueryRenderedFeaturePadding(),D=(function(O,q){const U=s.bq([],[.5*O.width,.5*-O.height,1]);return s.br(U,U,[1,-1,0]),s.aB(U,U,O.calculateProjMatrix(q.toUnwrapped())),Float32Array.from(U)})(S,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:c,pixelPosMatrix:D,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:k,scope:I})}querySourceFeatures(t,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),S=c?c.sourceLayer:"",T=x._geojsonTileLayer||x[S];if(!T)return;const I=s.b6(c&&c.filter),{z:k,x:D,y:O}=this.tileID.canonical,q={z:k,x:D,y:O};for(let U=0;U<T.length;U++){const G=T.feature(U);if(I.needGeometry){const te=s.b7(G,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),te,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),G))continue;const J=p.getId(G,S),Y=new s.b8(G,k,D,O,J);Y.tile=q,t.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const c=this.expirationTime;if(t.cacheControl){const p=s.b9(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const S=this.expirationTime-c;S?this.expirationTime=p+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const c in this.buckets)if(t.style.hasLayer(c)&&this.buckets[c].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(t,c){if(!this.latestFeatureIndex||!t.style)return;const p=t.style.listImages(),x=t.style.getBrightness();for(const S in this.buckets){if(!t.style.hasLayer(S))continue;const T=this.buckets[S],I=T.layers[0],k=I.sourceLayer||"_geojsonTileLayer",D=t.style.getLayerSourceCache(I);let O={};D&&(O=D._state.getState(k,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},U=Object.keys(O).length>0&&!c;T.hasAppearances=T.layers.some(Y=>Y.appearances&&Y.appearances.length>0);const G=U?T.stateDependentLayers:T.layers;if(U&&T.stateDependentLayers.length!==0||c){const Y=this.latestFeatureIndex.loadVTLayers();T.update(O,Y[k],p,q,G,c,x)}if(U&&T.stateDependentLayers.length!==0||c||T.hasAppearances){const Y={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};T.updateAppearances(this.tileID.canonical,O,p,Y,t.imageManager)}(T instanceof s.ba||T instanceof s.bb)&&t._terrain&&t._terrain.enabled&&D&&T.uploadPending()&&t._terrain._clearRenderCacheForTile(D.id,this.tileID);const J=t&&t.style&&t.style.getOwnLayer(S);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.o.now()+t}setTexture(t,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(p,t,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(t,c){const p={};for(const x of c)p[x]=!0;this.dependencies[t]=p}hasDependency(t,c){for(const p of t){const x=this.dependencies[p];if(x){for(const S of c)if(x[S])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=s.bc(Gn,this.tileID.canonical,this.tileTransform)[0],x=new s.bd,S=new s.be;for(let T=0;T<p.length;T++){const{x:I,y:k}=p[T];x.emplaceBack(I,k),S.emplaceBack(T)}S.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(S),this._tileDebugBuffer=t.createVertexBuffer(x,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,x.length,S.length)}_makeTileBoundsBuffers(t,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=s.bc(Gn,this.tileID.canonical,this.tileTransform)[0];let x,S;if(this.isRaster){const T=(function(I,k){const D=s.aZ(I,k),O=Math.pow(2,I.z);for(let te=0;te<$o;te++)for(let le=0;le<$o;le++){const ge=s.a_((I.x+(le+an(le))/Rs)/O),pe=s.a$((I.y+(te+an(te))/Rs)/O),de=k.project(ge,pe),Ne=te*$o+le;Fs[2*Ne+0]=Math.round((de.x*D.scale-D.x)*s.al),Fs[2*Ne+1]=Math.round((de.y*D.scale-D.y)*s.al)}_t.fill(0),Tr.fill(0);for(let te=2045;te>=0;te--){const le=4*te,ge=La[le+0],pe=La[le+1],de=La[le+2],Ne=La[le+3],Ce=ge+de>>1,ke=pe+Ne>>1,Te=Ce+ke-pe,_e=ke+ge-Ce,Me=pe*$o+ge,Ue=Ne*$o+de,Ge=ke*$o+Ce,it=Math.hypot((Fs[2*Me+0]+Fs[2*Ue+0])/2-Fs[2*Ge+0],(Fs[2*Me+1]+Fs[2*Ue+1])/2-Fs[2*Ge+1])>=16;_t[Ge]=_t[Ge]||(it?1:0),te<1022&&(_t[Ge]=_t[Ge]||_t[(pe+_e>>1)*$o+(ge+Te>>1)]||_t[(Ne+_e>>1)*$o+(de+Te>>1)])}const q=new s.b1,U=new s.b0;let G=0;function J(te,le){const ge=le*$o+te;return Tr[ge]===0&&(q.emplaceBack(Fs[2*ge+0],Fs[2*ge+1],te*s.al/Rs,le*s.al/Rs),Tr[ge]=++G),Tr[ge]-1}function Y(te,le,ge,pe,de,Ne){const Ce=te+ge>>1,ke=le+pe>>1;if(Math.abs(te-de)+Math.abs(le-Ne)>1&&_t[ke*$o+Ce])Y(de,Ne,te,le,Ce,ke),Y(ge,pe,de,Ne,Ce,ke);else{const Te=J(te,le),_e=J(ge,pe),Me=J(de,Ne);U.emplaceBack(Te,_e,Me)}}return Y(0,0,Rs,Rs,Rs,0),Y(Rs,Rs,0,0,0,Rs),{vertices:q,indices:U}})(this.tileID.canonical,c);x=T.vertices,S=T.indices}else{x=new s.b1,S=new s.b0;for(const{x:I,y:k}of p)x.emplaceBack(I,k,0,0);const T=s.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let I=0;I<T.length;I+=3)S.emplaceBack(T[I],T[I+1],T[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(x,s.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(S),this._tileBoundsSegments=s.bg.simpleSegment(0,0,x.length,S.length)}_makeGlobeTileDebugBuffers(t,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,S=s.bj(x,c),T=s.bk(S),I=s.aj(c.zoom);let k;I>0&&(k=s.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,x,c,T,k,I),this._makeGlobeTileDebugTextBuffer(t,x,c,T,k,I)}_globePoint(t,c,p,x,S,T,I){let k=s.bm(t,c,p);if(T){const D=1<<p.z,O=s.aF(x.center.lng),q=s.aJ(x.center.lat),U=(p.x+.5)/D-O;let G=0;U>.5?G=-1:U<-.5&&(G=1);let J=(t/s.al+p.x)/D+G,Y=(c/s.al+p.y)/D;J=(J-O)*x._pixelsPerMercatorPixel+O,Y=(Y-q)*x._pixelsPerMercatorPixel+q;const te=[J*x.worldSize,Y*x.worldSize,0];s.af(te,te,T),k=s.bn(k,te,I)}return s.af(k,k,S)}_makeGlobeTileDebugBorderBuffer(t,c,p,x,S,T){const I=new s.bd,k=new s.be,D=new s.bo,O=(U,G,J,Y,te)=>{const le=(J-U)/(te-1),ge=(Y-G)/(te-1),pe=I.length;for(let de=0;de<te;de++){const Ne=U+de*le,Ce=G+de*ge;I.emplaceBack(Ne,Ce);const ke=this._globePoint(Ne,Ce,c,p,x,S,T);D.emplaceBack(ke[0],ke[1],ke[2]),k.emplaceBack(pe+de)}},q=s.al;O(0,0,q,0,16),O(q,0,q,q,16),O(q,q,0,q,16),O(0,q,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(k),this._tileDebugBuffer=t.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(D,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,k.length)}_makeGlobeTileDebugTextBuffer(t,c,p,x,S,T){const I=s.al/4,k=new s.bd,D=new s.b0,O=new s.bo,q=25;D.reserve(32),k.reserve(q),O.reserve(q);const U=(G,J)=>q*G+J;for(let G=0;G<q;G++){const J=G*I;for(let Y=0;Y<q;Y++){const te=Y*I;k.emplaceBack(te,J);const le=this._globePoint(te,J,c,p,x,S,T);O.emplaceBack(le[0],le[1],le[2])}}for(let G=0;G<4;G++)for(let J=0;J<4;J++){const Y=U(G,J),te=U(G,J+1),le=U(G+1,J),ge=U(G+1,J+1);D.emplaceBack(Y,te,le),D.emplaceBack(le,te,ge)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(k,s.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(O,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,q,32)}destroy(t=!0){for(const c in this.buckets)this.buckets[c].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class _s extends Ei{constructor(t,c,p,x,S){super(t,c,p,x,S),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,c,p){const x=p.context,S=x.gl;let T=this.texturePerLayer.get(t)||p.getTileTexture(c.width);T&&T instanceof s.T?T.update(c,{premultiply:!1}):T=new s.T(x,c,S.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,T)}flushQueues(t){const c=this._workQueuePerLayer.get(t)||[],p=this._fetchQueuePerLayer.get(t)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(t)||[];for(;c.length;)c.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(t)||[];for(;c.length;)c.pop()()}}fetchHeader(t=16384,c){const p=this._mrt=new s.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bu(x,(S,T,I)=>{if(S)c(S);else try{const k=p.getHeaderLength(T);if(k>t)return void(this.request=this.fetchHeader(k,c));p.parseHeader(T),this._isHeaderLoaded=!0;let D=0;for(const O of Object.values(p.layers))D=Math.max(D,O.dataIndex[O.dataIndex.length-1].lastByte);T.byteLength>=D&&(this.entireBuffer=T),c(null,this.entireBuffer||T,I)}catch(k){c(k)}}),this.request}fetchBandForRender(t,c,p,x){this.fetchBand(t,c,p,S=>{if(S)return void x(S);this.updateTextureDescriptor(t,c,p);const T=this.textureDescriptorPerLayer.get(c);x(null,T?T.img:null)})}fetchBand(t,c,p,x,S=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void x(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void x(new Error("Can't fetch tile band without an actor"));let k;const D=s.B(String(p),s.B(this.tileID.key,t));let O=this._taskQueue.get(D);O?O.add(x):(O=new Set,O.add(x),this._taskQueue.set(D,O));const q=(Y,te)=>{k.complete(Y,te),Y?x(Y):(O.forEach(le=>le(null,te)),this._taskQueue.delete(D))},U=(Y,te)=>{if(Y)return x(Y);const le=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:te,task:k},q,void 0,!0);if(c!==null){const ge=this._workQueuePerLayer.get(c)||[];ge.push(()=>{le&&le.cancel(),k.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,ge)}};let G;try{G=T.getLayer(t)}catch(Y){if(this.state==="reloading")return;throw Y}if(!G)return void x(new Error(`Unknown sourceLayer "${t}"`));if(G.hasDataForBand(p))return O.forEach(Y=>Y(null,null)),void this._taskQueue.delete(D);const J=G.getDataRange([p]);if(k=T.createDecodingTask(J),!k||k.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)U(null,this.entireBuffer.slice(J.firstByte,J.lastByte+1));else{const Y=Object.assign({},this.requestParams,{headers:{Range:`bytes=${J.firstByte}-${J.lastByte}`}}),te=s.bu(Y,U);if(c!==null){const le=this._fetchQueuePerLayer.get(c)||[];le.push(()=>{te.cancel(),k.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,le)}}}updateNeeded(t,c){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,c,p){if(!this._mrt)return;const x=this._mrt.getLayer(t);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:S,tileSize:T,buffer:I,offset:k,scale:D}=x.getBandView(p),O=T+2*I,q=new s.q({width:O,height:O},S),U=this.texturePerLayer.get(c);U&&U instanceof s.T&&U.update(q,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:t,band:p,img:q,buffer:I,offset:k,tileSize:T,format:x.pixelFormat,mix:[D,256*D,65536*D,16777216*D]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const c of this.texturePerLayer.values())c&&c instanceof s.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class na{constructor(t,c){this.max=t,this.onRemove=c,this.reset()}reset(){for(const t in this.data)for(const c of this.data[t])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(t,c,p){const x=t.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const S={value:c,timeout:void 0};if(p!==void 0&&(S.timeout=setTimeout(()=>{this.remove(t,S)},p)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const c=this.data[t].shift();return c.timeout&&clearTimeout(c.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),c.value}getByKey(t){const c=this.data[t];return c?c[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,c){if(!this.has(t))return this;const p=t.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),S=this.data[p][x];return this.data[p].splice(x,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(t){const c=[];for(const p in this.data)for(const x of this.data[p])t(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class Zs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,c,p){const x=String(c);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][x]=this.stateChanges[t][x]||{},Object.assign(this.stateChanges[t][x],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const S in this.state[t])S!==x&&(this.deletedStates[t][S]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][x]===null){this.deletedStates[t][x]={};for(const S in this.state[t][x])p[S]||(this.deletedStates[t][x][S]=null)}else for(const S in p)this.deletedStates[t]&&this.deletedStates[t][x]&&this.deletedStates[t][x][S]===null&&delete this.deletedStates[t][x][S]}removeFeatureState(t,c,p){if(this.deletedStates[t]===null)return;const x=String(c);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&c!==void 0)this.deletedStates[t][x]!==null&&(this.deletedStates[t][x]=this.deletedStates[t][x]||{},this.deletedStates[t][x][p]=null);else if(c!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][x])for(p in this.deletedStates[t][x]={},this.stateChanges[t][x])this.deletedStates[t][x][p]=null;else this.deletedStates[t][x]=null;else this.deletedStates[t]=null}getState(t,c){const p=this.state[t]||{},x=this.stateChanges[t]||{},S=this.deletedStates[t];if(S===null)return{};if(c!==void 0){const I=String(c),k=Object.assign({},p[I],x[I]);if(S){const D=S[c];if(D===null)return{};for(const O in D)delete k[O]}return k}const T=Object.assign({},p,x);if(S)for(const I in S)delete T[I];return T}initializeTileState(t,c){t.refreshFeatureState(c)}coalesceChanges(t,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const T in this.stateChanges[x])this.state[x][T]||(this.state[x][T]={}),Object.assign(this.state[x][T],this.stateChanges[x][T]),S[T]=this.state[x][T];p[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const T in this.state[x])S[T]={},this.state[x][T]={};else for(const T in this.deletedStates[x]){if(this.deletedStates[x][T]===null)this.state[x][T]={};else if(this.state[x][T])for(const I of Object.keys(this.deletedStates[x][T]))delete this.state[x][T][I];S[T]=this.state[x][T]}p[x]=p[x]||{},Object.assign(p[x],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in t)t[x].refreshFeatureState(c)}}class qo extends s.E{constructor(t,c,p){super(),this.id=t,this._onlySymbols=p,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new na(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Zs,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,c){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,c)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(t,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ql).map(t=>t.key)}getRenderableIds(t,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,t,c)&&p.push(this._tiles[x]);return t?p.sort((x,S)=>{const T=x.tileID,I=S.tileID,k=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),D=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-I.overscaledZ||D.y-k.y||D.x-k.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(Ql).map(x=>x.key)}hasRenderableParent(t){const c=this.findLoadedParent(t,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(t,c,p){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(c||!this._tiles[t].holdingForFade())&&(p||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,c){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,t,c)))}_tileLoaded(t,c,p,x,S){if(x){if(t.state="errored",x.status!==404)this._source.fire(new s.y(x,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=s.o.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(c,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let T=new Map;S&&S.responseHeaders&&(T=S.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(t){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const S=c[x];if(t.neighboringTiles&&t.neighboringTiles[S]){const T=this.getTileByID(S);p(t,T),p(T,t)}}function p(x,S){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let T=S.tileID.canonical.x-x.tileID.canonical.x;const I=S.tileID.canonical.y-x.tileID.canonical.y,k=Math.pow(2,x.tileID.canonical.z),D=S.tileID.key;T===0&&I===0||Math.abs(I)>1||(Math.abs(T)>1&&(Math.abs(T+k)===1?T+=k:Math.abs(T-k)===1&&(T-=k)),S.dem&&x.dem&&(x.dem.backfillBorder(S.dem,T,I),x.neighboringTiles&&x.neighboringTiles[D]&&(x.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,c,p,x){for(const S in this._tiles){let T=this._tiles[S];if(x[S]||!T.hasData()||T.tileID.overscaledZ<=c||T.tileID.overscaledZ>p)continue;let I=T.tileID;for(;T&&T.tileID.overscaledZ>c+1;){const D=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[D.key],T&&T.hasData()&&(I=D)}let k=I;for(;k.overscaledZ>c;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){x[I.key]=I;break}}}findLoadedParent(t,c){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=t.overscaledZ-1;p>=c;p--){const x=t.scaledTo(p),S=this._getLoadedTile(x);if(S)return S}}_getLoadedTile(t){const c=this._tiles[t.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,c){c=c||this._source.tileSize;const p=Math.ceil(t.width/c)+1,x=Math.ceil(t.height/c)+1,S=Math.floor(p*x*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,S):S,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(I)}handleWrapJump(t){const c=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,c){const p={};for(const x in this._tiles){const S=this._tiles[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),p[S.tileID.key]=S}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(t,c,p,x,S){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(t,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let I,k=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const U=D.attenuationRange()[0],G=Math.floor(U)-Math.log2(D.getDemUpscale());k>G&&(k=G)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new s.aQ(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=t.clone();U.tileCoverLift=this.tileCoverLift,I=U.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&t.projection.name==="globe"&&(I.push(new s.aQ(1,0,1,0,0)),I.push(new s.aQ(1,0,1,1,0)),I.push(new s.aQ(1,0,1,0,1)),I.push(new s.aQ(1,0,1,1,1)))}else if(I=t.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);I=I.filter(G=>U(G))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!tu(this._source.type)){const U=t.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),G=Math.min(U,this._source.maxzoom);if(T){const J=t.extendTileCover(I,G);for(const Y of J)I.push(Y)}else if(S){const J=t.extendTileCoverToNearPlane(I,this.transform.getFrustum(G),G);for(const Y of J)I.push(Y)}else if(this.castsShadows&&x){const J=t.extendTileCover(I,G,x,16);for(const Y of J)this._shadowCasterTiles[Y.key]=!0,I.push(Y)}}const O=this._updateRetainedTiles(I);if(tu(this._source.type)&&I.length!==0){const U={},G={},J=Object.keys(O);for(const te of J){const le=O[te],ge=this._tiles[te];if(!ge||ge.fadeEndTime&&ge.fadeEndTime<=s.o.now())continue;const pe=this.findLoadedParent(le,Math.max(le.overscaledZ-qo.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),U[pe.tileID.key]=pe.tileID),G[te]=le}const Y=I[I.length-1].overscaledZ;for(const te in this._tiles){const le=this._tiles[te];if(O[te]||!le.hasData())continue;let ge=le.tileID;for(;ge.overscaledZ>Y;){ge=ge.scaledTo(ge.overscaledZ-1);const pe=this._tiles[ge.key];if(pe&&pe.hasData()&&G[ge.key]){O[te]=le.tileID;break}}}for(const te in U)O[te]||(this._coveredTiles[te]=!0,O[te]=U[te])}for(const U in O)this._tiles[U].clearFadeHold();const q=s.bv(this._tiles,O);for(const U of q){const G=this._tiles[U];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const c={};if(t.length===0)return c;const p={},x=t.reduce((D,O)=>Math.min(D,O.overscaledZ),1/0),S=t[0].overscaledZ,T=Math.max(S-qo.maxOverzooming,this._source.minzoom),I=Math.max(S+qo.maxUnderzooming,this._source.minzoom),k={};for(const D of t){const O=this._addTile(D);c[D.key]=D,O.hasData()||x<this._source.maxzoom&&(k[D.key]=D)}this._retainLoadedChildren(k,x,I,c);for(const D of t){let O=this._tiles[D.key];if(O.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const U=D.children(this._source.maxzoom)[0],G=this.getTile(U);if(G&&G.hasData()){c[U.key]=U;continue}}else{const U=D.children(this._source.maxzoom);if(c[U[0].key]&&c[U[1].key]&&c[U[2].key]&&c[U[3].key])continue}let q=O.wasRequested();for(let U=D.overscaledZ-1;U>=T;--U){const G=D.scaledTo(U);if(p[G.key]||(p[G.key]=!0,O=this.getTile(G),!O&&q&&(O=this._addTile(G)),O&&(c[G.key]=G,q=O.wasRequested(),O.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const c=[];let p,x=this._tiles[t].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const S=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(S),p)break;x=S}for(const S of c)this._loadedParentTiles[S]=p}}_addTile(t){let c=this._tiles[t.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),c;c=this._cache.getAndRemove(t),c&&(this._setTileReloadTimer(t.key,c),c.tileID=t,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,S=this._source.tileSize*t.overscaleFactor();c=this._source.type==="raster-array"?new _s(t,S,this.transform.tileZoom,x,this._isRaster):new Ei(t,S,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,t.key,c.state))}return c.uses++,this._tiles[t.key]=c,p||this._source.fire(new s.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(t,c){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=c.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const c=this._tiles[t];c&&(c.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,c,p){const x=[],S=this.transform;if(!S)return x;const T=S.projection.name==="globe",I=s.aF(S.center.lng);for(const k in this._tiles){const D=this._tiles[k];if(p&&D.clearQueryDebugViz(),D.holdingForFade())continue;let O;if(T){const q=D.tileID.canonical;if(q.z===0){const U=[Math.abs(s.aA(I,...Jl(q,-1))-I),Math.abs(s.aA(I,...Jl(q,1))-I)];O=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(s.aA(I,...Jl(q,-1))-I),Math.abs(s.aA(I,...Jl(q,0))-I),Math.abs(s.aA(I,...Jl(q,1))-I)];O=[U.indexOf(Math.min(...U))-1]}}else O=[0];for(const q of O){const U=t.containsTile(D,S,c,q);U&&x.push(U)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,c){const p=this.getRenderableIds(t,c).map(S=>this._tiles[S].tileID),x=this.transform.projection.name==="globe";for(const S of p)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=x?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return p}sortCoordinatesByDistance(t){const c=t.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),S={};for(const T of c){const I=1/(1<<T.canonical.z);S[T.key]=((T.canonical.x+.5)*I+T.wrap-p[0])*x[0]+((T.canonical.y+.5)*I-p[1])*x[1]-p[2]*x[2]}return c.sort((T,I)=>S[T.key]-S[I.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(tu(this._source.type))for(const t in this._tiles){const c=this._tiles[t];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(t,c,p){this._state.updateState(t=t||"_geojsonTileLayer",c,p)}removeFeatureState(t,c,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",c,p)}getFeatureState(t,c){return this._state.getState(t=t||"_geojsonTileLayer",c)}setDependencies(t,c,p){const x=this._tiles[t];x&&x.setDependencies(c,p)}reloadTilesForDependencies(t,c){for(const p in this._tiles)this._tiles[p].hasDependency(t,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(t,c))}_preloadTiles(t,c){if(!this._sourceLoaded){const k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(t,c))};return void this._source.on("data",k)}const p=new Map,x=Array.isArray(t)?t:[t],S=this.map.painter.terrain,T=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(const k of x){const D=k.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of D)p.set(O.key,O);this.usedForTerrain&&k.updateElevation(!1)}const I=Array.from(p.values());s.bw(I,(k,D)=>{const O=new Ei(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(O,q=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),D(q,O)})},c)}}function Ql(f,t){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||p-c||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function tu(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Jl(f,t){const c=1<<f.z;return[f.x/c+t,(f.x+1)/c+t]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class Uh{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:t,visibilityChanged:c});else if(x.type==="model"){const S=this.style.getLayerSource(x);S&&S.type==="batched-model"&&this.layers.push({layer:x,visible:t,visibilityChanged:c})}}}onNewFrame(t){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(t)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(t)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(t)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(t,c){this.currentBuildingBuckets=[];for(const x of this.layers){const S=x.layer,T=this.style.getLayerSourceCache(S);let I=1;S.type==="fill-extrusion"?I=x.visible?S.paint.get("fill-extrusion-vertical-scale"):0:S.type==="building"&&(I=x.visible?S.paint.get("building-vertical-scale"):0);let k=T?T.getTile(c):null;if(!k&&T)for(const D in T._tiles){const O=T._tiles[D];if(c.canonical.isChildOf(O.tileID.canonical)){k=O;break}}this.currentBuildingBuckets.push({bucket:k?k.getBucket(S):null,tileID:k?k.tileID:c,verticalScale:I})}t.hasAnyZOffset=!1;let p=!1;for(let x=0;x<t.symbolInstances.length;x++){const S=t.symbolInstances.get(x),T=S.zOffset,I=this._getHeightAtTileOffset(c,S.tileAnchorX,S.tileAnchorY);S.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,p||T===S.zOffset||(p=!0),t.hasAnyZOffset||S.zOffset===0||(t.hasAnyZOffset=!0)}p&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,c,p,x){let S=c,T=p;if(t.canonical.z!==x.canonical.z){const I=x.canonical,k=1/(1<<t.canonical.z-I.z);S=(c+t.canonical.x*s.al)*k-I.x*s.al|0,T=(p+t.canonical.y*s.al)*k-I.y*s.al|0}return{tileX:S,tileY:T}}_getHeightAtTileOffset(t,c,p){let x,S;for(let T=0;T<this.layers.length;++T){const I=this.layers[T].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:k,tileID:D,verticalScale:O}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:q,tileY:U}=this._mapCoordToOverlappingTile(t,c,p,D),G=k.getHeightAtTileCoord(q,U);G&&G.height!==void 0&&(G.hidden?x=G.height:S=Math.max(G.height*O,S||0))}if(S!==void 0)return S;for(let T=0;T<this.layers.length;++T){const I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:k,tileID:D}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:O,tileY:q}=this._mapCoordToOverlappingTile(t,c,p,D),U=k.getHeightAtTileCoord(O,q);if(U&&!U.hidden)return U.height===void 0&&x!==void 0?Math.min(U.maxHeight,x)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function $h(f,t){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return s.bx.forEach(p=>{p in t&&(c[p]=t[p])}),c}function Du(f){f=f.slice();const t=Object.create(null);for(let c=0;c<f.length;c++)t[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=$h(f[c],t[f[c].ref]));return f}const Dn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function bc(f,t,c){c.push({command:Dn.addSource,args:[f,t[f]]})}function op(f,t,c){t.push({command:Dn.removeSource,args:[f]}),c[f]=!0}function zg(f,t,c,p){op(f,c,p),bc(f,t,c)}function ap(f,t,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!s.by(f[c][p],t[c][p]))return!1;for(p in t[c])if(t[c].hasOwnProperty(p)&&p!=="data"&&!s.by(f[c][p],t[c][p]))return!1;return!0}function ru(f,t,c,p,x,S){let T;for(T in t=t||{},f=f||{})f.hasOwnProperty(T)&&(s.by(f[T],t[T])||c.push({command:S,args:[p,T,t[T],x]}));for(T in t)t.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(s.by(f[T],t[T])||c.push({command:S,args:[p,T,t[T],x]}))}function ec(f){return f.id}function Md(f,t){return f[t.id]=t,f}function Pl(f,t,c){const p=t.createTileMatrix(f,f.worldSize,c.toUnwrapped());return s.aB(new Float32Array(16),f.projMatrix,p)}function Cm(f,t,c){if(t.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(t.projection),Pl(p,t.getProjection(),f)}function wc(f,t,c){return t.name===c.projection.name?f.projMatrix:Pl(c,t,f)}class tc{constructor(t,c){this.reset(t,c)}reset(t,c){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aA(t,0,1);let c=1,p=this._distances[c];const x=t*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const S=c-1,T=this._distances[S],I=p-T,k=I>0?(x-T)/I:0;return this.points[S].mult(1-k).add(this.points[c].mult(k))}}class nu{constructor(t,c,p){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(c/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=c,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,c,p,x,S){this._forEachCell(c,p,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(t,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(t,c,p,x,S,T){this.boxCells[S].push(T)}_insertCircleCell(t,c,p,x,S,T){this.circleCells[S].push(T)}_query(t,c,p,x,S,T){if(p<0||t>this.width||x<0||c>this.height)return!S&&[];const I=[];if(t<=0&&c<=0&&this.width<=p&&this.height<=x){if(S)return!0;for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const D=this.circles[3*k],O=this.circles[3*k+1],q=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:D-q,y1:O-q,x2:D+q,y2:O+q})}return T?I.filter(T):I}return this._forEachCell(t,c,p,x,this._queryCell,I,{hitTest:S,seenUids:{box:{},circle:{}}},T),S?I.length>0:I}_queryCircle(t,c,p,x,S){const T=t-p,I=t+p,k=c-p,D=c+p;if(I<0||T>this.width||D<0||k>this.height)return!x&&[];const O=[];return this._forEachCell(T,k,I,D,this._queryCellCircle,O,{hitTest:x,circle:{x:t,y:c,radius:p},seenUids:{box:{},circle:{}}},S),x?O.length>0:O}query(t,c,p,x,S){return this._query(t,c,p,x,!1,S)}hitTest(t,c,p,x,S){return this._query(t,c,p,x,!0,S)}hitTestCircle(t,c,p,x){return this._queryCircle(t,c,p,!0,x)}_queryCell(t,c,p,x,S,T,I,k){const D=I.seenUids,O=this.boxCells[S];if(O!==null){const U=this.bboxes;for(const G of O)if(!D.box[G]){D.box[G]=!0;const J=4*G;if(t<=U[J+2]&&c<=U[J+3]&&p>=U[J+0]&&x>=U[J+1]&&(!k||k(this.boxKeys[G]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[G],x1:U[J],y1:U[J+1],x2:U[J+2],y2:U[J+3]})}}}const q=this.circleCells[S];if(q!==null){const U=this.circles;for(const G of q)if(!D.circle[G]){D.circle[G]=!0;const J=3*G;if(this._circleAndRectCollide(U[J],U[J+1],U[J+2],t,c,p,x)&&(!k||k(this.circleKeys[G]))){if(I.hitTest)return T.push(!0),!0;{const Y=U[J],te=U[J+1],le=U[J+2];T.push({key:this.circleKeys[G],x1:Y-le,y1:te-le,x2:Y+le,y2:te+le})}}}}}_queryCellCircle(t,c,p,x,S,T,I,k){const D=I.circle,O=I.seenUids,q=this.boxCells[S];if(q!==null){const G=this.bboxes;for(const J of q)if(!O.box[J]){O.box[J]=!0;const Y=4*J;if(this._circleAndRectCollide(D.x,D.y,D.radius,G[Y+0],G[Y+1],G[Y+2],G[Y+3])&&(!k||k(this.boxKeys[J])))return T.push(!0),!0}}const U=this.circleCells[S];if(U!==null){const G=this.circles;for(const J of U)if(!O.circle[J]){O.circle[J]=!0;const Y=3*J;if(this._circlesCollide(G[Y],G[Y+1],G[Y+2],D.x,D.y,D.radius)&&(!k||k(this.circleKeys[J])))return T.push(!0),!0}}}_forEachCell(t,c,p,x,S,T,I,k){const D=this._convertToXCellCoord(t),O=this._convertToYCellCoord(c),q=this._convertToXCellCoord(p),U=this._convertToYCellCoord(x);for(let G=D;G<=q;G++)for(let J=O;J<=U;J++)if(S.call(this,t,c,p,x,this.xCellCount*J+G,T,I,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,c,p,x,S,T){const I=x-t,k=S-c,D=p+T;return D*D>I*I+k*k}_circleAndRectCollide(t,c,p,x,S,T,I){const k=(T-x)/2,D=Math.abs(t-(x+k));if(D>k+p)return!1;const O=(I-S)/2,q=Math.abs(c-(S+O));if(q>O+p)return!1;if(D<=k||q<=O)return!0;const U=D-k,G=q-O;return U*U+G*G<=p*p}}const qh=Math.tan(85*Math.PI/180);function iu(f,t,c,p,x,S,T){const I=s.bC();if(c)if(S.name==="globe"){const k=s.bD(x,t);s.aB(I,I,k)}else{const k=s.bE([],T);I[0]=k[0],I[1]=k[1],I[4]=k[2],I[5]=k[3],p||s.bB(I,I,x.angle)}else s.aB(I,x.labelPlaneMatrix,f);return I}function Xs(f,t,c,p,x,S,T){const I=iu(f,t,c,p,x,S,T);return S.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function co(f,t,c,p,x,S,T){if(c){if(S.name==="globe"){const I=iu(f,t,c,p,x,S,T);return s.bl(I,I),s.aB(I,f,I),I}{const I=s.bz(f),k=s.bA([]);return k[0]=T[0],k[1]=T[1],k[4]=T[2],k[5]=T[3],s.aB(I,I,k),p||s.bB(I,I,-x.angle),I}}return x.glCoordMatrix}function Da(f,t,c,p){const x=[f,t,c,1];c?s.aC(x,x,p):Dd(x,x,p);const S=x[3];return x[0]/=S,x[1]/=S,x[2]/=S,x}function su(f,t){return Math.min(.5+f/t*.5,1.5)}function Fg(f,t){const c=f[0]/f[3],p=f[1]/f[3];return c>=-t[0]&&c<=t[0]&&p>=-t[1]&&p<=t[1]}function ii(f,t,c,p,x,S,T,I,k,D,O=1){const q=c.transform,U=p?f.textSizeData:f.iconSizeData,G=s.bK(U,c.transform.zoom,O),J=q.projection.name==="globe",Y=[256/c.width*2+1,256/c.height*2+1],te=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;te.clear();let le=null;J&&(le=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const ge=f.lineVertexArray,pe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,de=c.transform.width/c.transform.height;let Ne,Ce=!1;for(let ke=0;ke<pe.length;ke++){const Te=pe.get(ke),{numGlyphs:_e,writingMode:Me}=Te;if(Me!==s.bL.vertical||Ce||Ne===s.bL.horizontal||(Ce=!0),Ne=Me,(Te.hidden||Me===s.bL.vertical)&&!Ce){ia(_e,te);continue}Ce=!1;const Ue=new s.P(Te.tileAnchorX,Te.tileAnchorY),Ge=f.elevationType==="road",it=!!q.elevation||Ge;let{x:tt,y:mt,z:Pt}=q.projection.projectTilePoint(Ue.x,Ue.y,D.canonical),Qe=null;if(it){const ar=Ge?f.getElevationFeatureForText(ke):null;Qe={getElevation:k,elevation:q.elevation,elevationFeature:ar};const[Mr,Gr,tn]=k(Ue,q.elevation,ar);tt+=Mr,mt+=Gr,Pt+=tn}const Le=[tt,mt,Pt,1];if(s.aC(Le,Le,t),!Fg(Le,Y)){ia(_e,te);continue}const dt=Le[3],nt=su(c.transform.getCameraToCenterDistance(q.projection),dt),yt=s.bM(U,G,Te),Dt=T?yt/nt:yt*nt,Kt=Da(tt,mt,Pt,x);if(Kt[3]<=0){ia(_e,te);continue}let Ot={};const Ft=s.an(f.layers[0].layout.get("text-max-angle")),gr=Math.cos(Ft),fr=T?null:Qe,sr=Wh(Te,Dt,!1,I,t,x,S,f.glyphOffsetArray,ge,te,le,Kt,Ue,Ot,de,fr,q.projection,D,T,gr);Ce=sr.useVertical,fr&&sr.needsFlipping&&(Ot={}),(sr.notEnoughRoom||Ce||sr.needsFlipping&&Wh(Te,Dt,!0,I,t,x,S,f.glyphOffsetArray,ge,te,le,Kt,Ue,Ot,de,fr,q.projection,D,T,gr).notEnoughRoom)&&ia(_e,te)}p?(f.text.dynamicLayoutVertexBuffer.updateData(te),le&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(le)):(f.icon.dynamicLayoutVertexBuffer.updateData(te),le&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(le))}function Gh(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te){const{lineStartIndex:le,glyphStartIndex:ge,segment:pe}=I,de=ge+I.numGlyphs,Ne=le+I.lineLength,Ce=t.getoffsetX(ge),ke=t.getoffsetX(de-1),Te=Ou(f*Ce,c,p,x,S,T,pe,le,Ne,k,D,O,q,U,!0,G,J,Y,te);if(!Te)return null;const _e=Ou(f*ke,c,p,x,S,T,pe,le,Ne,k,D,O,q,U,!0,G,J,Y,te);return _e?{first:Te,last:_e}:null}function Ld(f,t,c,p){return f===s.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===s.bL.vertical?p>0?{needsFlipping:!0}:null:t!==0&&(function(x,S){return x===0||Math.abs(S/x)>qh})(c,p)?t===1?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Wh(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le,ge,pe){const de=t/24,Ne=f.lineOffsetX*de,Ce=f.lineOffsetY*de,{lineStartIndex:ke,glyphStartIndex:Te,numGlyphs:_e,segment:Me,writingMode:Ue,flipState:Ge}=f,it=ke+f.lineLength,tt=mt=>{if(O){const[dt,nt,yt]=mt.up,Dt=D.length;s.bN(O,Dt+0,dt,nt,yt),s.bN(O,Dt+1,dt,nt,yt),s.bN(O,Dt+2,dt,nt,yt),s.bN(O,Dt+3,dt,nt,yt)}const[Pt,Qe,Le]=mt.point;s.bO(D,Pt,Qe,Le,mt.angle)};if(_e>1){const mt=Gh(de,I,Ne,Ce,c,q,U,f,k,S,G,Y,!1,te,le,ge,pe);if(!mt)return{notEnoughRoom:!0};if(p&&!c){let[Pt,Qe,Le]=mt.first.point,[dt,nt,yt]=mt.last.point;[Pt,Qe]=Da(Pt,Qe,Le,T),[dt,nt]=Da(dt,nt,yt,T);const Dt=Ld(Ue,Ge,(dt-Pt)*J,nt-Qe);if(f.flipState=Dt&&Dt.needsFlipping?1:2,Dt)return Dt}tt(mt.first);for(let Pt=Te+1;Pt<Te+_e-1;Pt++){const Qe=Ou(de*I.getoffsetX(Pt),Ne,Ce,c,q,U,Me,ke,it,k,S,G,Y,!1,!1,te,le,ge,pe);if(!Qe)return D.length-=4*(Pt-Te),{notEnoughRoom:!0};tt(Qe)}tt(mt.last)}else{if(p&&!c){const Pt=Da(U.x,U.y,0,x),Qe=ke+Me+1,Le=new s.P(k.getx(Qe),k.gety(Qe)),dt=Da(Le.x,Le.y,0,x),nt=dt[3]>0?dt:Am(U,Le,Pt,1,x,void 0,te,le.canonical),yt=Ld(Ue,Ge,(nt[0]-Pt[0])*J,nt[1]-Pt[1]);if(f.flipState=yt&&yt.needsFlipping?1:2,yt)return yt}const mt=Ou(de*I.getoffsetX(Te),Ne,Ce,c,q,U,Me,ke,it,k,S,G,Y,!1,!1,te,le,ge,pe);if(!mt)return{notEnoughRoom:!0};tt(mt)}return{}}function $r(f,t,c,p,x){const{x:S,y:T,z:I}=p.projectTilePoint(f.x,f.y,t);if(!x)return Da(S,T,I,c);const[k,D,O]=x.getElevation(f,x.elevation,x.elevationFeature);return Da(S+k,T+D,I+O,c)}function Am(f,t,c,p,x,S,T,I){const k=$r(f.sub(t)._unit()._add(f),I,x,T,S);return s.av(k,c,k),s.aw(k,k),s.bH(k,c,k,p)}function Ou(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le,ge){const pe=p?f-t:f+t;let de=pe>0?1:-1,Ne=0;p&&(de*=-1,Ne=Math.PI),de<0&&(Ne+=Math.PI);let Ce=I+T+(de>0?0:1)|0,ke=x,Te=x,_e=0,Me=0;const Ue=Math.abs(pe),Ge=[],it=[];let tt=S,mt=tt,Pt=s.bF([]);const Qe=()=>Am(mt,tt,Te,Ue-_e+1,O,U,Y,te.canonical);for(;_e+Me<=Ue;){if(Ce+=de,Ce<I||Ce>=k)return null;if(Te=ke,mt=tt,Ge.push(Te),G&&it.push(mt),tt=new s.P(D.getx(Ce),D.gety(Ce)),ke=q[Ce],!ke){const fr=$r(tt,te.canonical,O,Y,U);ke=fr[3]>0?q[Ce]=fr:Qe()}_e+=Me;const Ft=s.av([],ke,Te),gr=s.bG(Te,ke);if(c&&gr>0&&Me>0&&s.bJ(Pt,Ft)/(Me*gr)<ge)return null;Me=gr,Pt=Ft}J&&U&&(q[Ce]&&(ke=Qe(),Me=s.bG(Te,ke),Pt=s.av([],ke,Te)),q[Ce]=ke);const Le=(Ue-_e)/Me,dt=tt.sub(mt)._mult(Le)._add(mt),nt=s.bH([],Te,Pt,Le);let yt=[0,0,1],Dt=Pt[0],Kt=Pt[1];if(le&&(yt=Y.upVector(te.canonical,dt.x,dt.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const Ft=[yt[2],0,-yt[0]],gr=s.bI([],yt,Ft);s.aw(Ft,Ft),s.aw(gr,gr),Dt=s.bJ(Pt,Ft),Kt=s.bJ(Pt,gr)}if(c){const Ft=s.bI([],yt,Pt);s.aw(Ft,Ft),s.bH(nt,nt,Ft,c*de)}const Ot=Ne+Math.atan2(Kt,Dt);return Ge.push(nt),G&&it.push(dt),{point:nt,angle:Ot,path:Ge,tilePath:it,up:yt}}function ia(f,t){const c=t.length,p=c+4*f;t.resize(p),t.float32.fill(-1/0,4*c,4*p)}function Dd(f,t,c){const p=t[0],x=t[1];return f[0]=c[0]*p+c[4]*x+c[12],f[1]=c[1]*p+c[5]*x+c[13],f[3]=c[3]*p+c[7]*x+c[15],f}const va=100;class Er{constructor(t,c,p=new nu(t.width+200,t.height+200,25),x=new nu(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+va,this.screenBottomBoundary=t.height+va,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=c}placeCollisionBox(t,c,p,x,S,T,I,k,D,O,q){let U=p.projectedAnchorX,G=p.projectedAnchorY,J=p.projectedAnchorZ;const Y=p.tileAnchorX,te=p.tileAnchorY,le=p.elevation,ge=p.tileID,pe=t.getProjection();if(le&&ge){const[it,tt,mt]=pe.upVector(ge.canonical,p.tileAnchorX,p.tileAnchorY),Pt=pe.upVectorScale(ge.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=it*le*Pt,G+=tt*le*Pt,J+=mt*le*Pt}const de=t.projection.name==="globe",Ne=t.projection.name==="globe"?s.aj(this.transform.zoom):0;if(ge&&de&&Ne<1&&!T){const it=1<<ge.canonical.z,tt=s.bP(Y,te);s.bQ(tt,tt,1/s.al),s.bR(tt,tt,s.bP(ge.canonical.x,ge.canonical.y)),s.bQ(tt,tt,1/it),s.bS(tt,tt,s.bP(x[0],x[1])),tt[0]=s.bT(tt[0],-.5,.5),s.bQ(tt,tt,s.al);const mt=s.bU(tt[0],tt[1],s.al/(2*Math.PI),1);s.aC(mt,mt,S),U=s.ak(U,mt[0],Ne),G=s.ak(G,mt[1],Ne),J=s.ak(J,mt[2],Ne)}const Ce=this.projectAndGetPerspectiveRatio(O,U,G,J,p.tileID,pe.name==="globe"||!!le||this.transform.pitch>0,pe),ke=D*Ce.perspectiveRatio,Te=(p.x1*c+I.x-p.padding)*ke+Ce.point.x,_e=(p.y1*c+I.y-p.padding)*ke+Ce.point.y,Me=(p.x2*c+I.x+p.padding)*ke+Ce.point.x,Ue=(p.y2*c+I.y+p.padding)*ke+Ce.point.y,Ge=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(Te,_e,Me,Ue)||!k&&this.grid.hitTest(Te,_e,Me,Ue,q)||Ge?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[Te,_e,Me,Ue],offscreen:this.isOffscreen(Te,_e,Me,Ue),occluded:!1}}placeCollisionCircles(t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te){const le=[],ge=this.transform.elevation,pe=t.getProjection(),de=t.elevationType==="road",Ne=!!ge||de,Ce=s.bV.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,pe),ke=new s.P(p.tileAnchorX,p.tileAnchorY),Te=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:_e,y:Me,z:Ue}=pe.projectTilePoint(Te.x,Te.y,te.canonical),Ge=null;if(Ne){const gr=de?t.getElevationFeatureForText(x):null;Ge={getElevation:Ce,elevation:ge,elevationFeature:gr};const[fr,sr,ar]=Ce(ke,ge,gr);_e+=fr,Me+=sr,Ue+=ar}const it=pe.name==="globe",tt=this.projectAndGetPerspectiveRatio(k,_e,Me,Ue,te,it||!!ge||this.transform.pitch>0,pe),{perspectiveRatio:mt}=tt,Pt=(U?I/mt:I*mt)/s.bY,Qe=Da(_e,Me,Ue,D),Le=p.lineOffsetX*Pt,dt=p.lineOffsetY*Pt,nt=s.an(t.layers[0].layout.get("text-max-angle")),yt=Math.cos(nt),Dt=tt.signedDistanceFromCamera>0?Gh(Pt,T,Le,dt,de&&p.flipState===1,Qe,Te,p,S,D,{},Ne&&!U?Ge:null,U&&Ne,pe,te,U,yt):null;let Kt=!1,Ot=!1,Ft=!0;if(Dt&&!tt.occluded){const gr=.5*J*mt+Y,fr=new s.P(-100,-100),sr=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ar=new tc,{first:Mr,last:Gr}=Dt,tn=Mr.path.length;let Pn=[];for(let rn=tn-1;rn>=1;rn--)Pn.push(Mr.path[rn]);for(let rn=1;rn<Gr.path.length;rn++)Pn.push(Gr.path[rn]);const Wr=2.5*gr;O&&(Pn=Pn.map(([rn,oi,hi],fi)=>(Ne&&!it&&(hi=Ce(fi<tn-1?Mr.tilePath[tn-1-fi]:Gr.tilePath[fi-tn+2],ge,Ge.elevationFeature)[2]),Da(rn,oi,hi,O))),Pn.some(rn=>rn[3]<=0)&&(Pn=[]));let Fn=[];if(Pn.length>0){let rn=1/0,oi=-1/0,hi=1/0,fi=-1/0;for(const On of Pn)rn=Math.min(rn,On[0]),hi=Math.min(hi,On[1]),oi=Math.max(oi,On[0]),fi=Math.max(fi,On[1]);oi>=fr.x&&rn<=sr.x&&fi>=fr.y&&hi<=sr.y&&(Fn=[Pn.map(On=>new s.P(On[0],On[1]))],(rn<fr.x||oi>sr.x||hi<fr.y||fi>sr.y)&&(Fn=s.bW(Fn,fr.x,fr.y,sr.x,sr.y)))}for(const rn of Fn){ar.reset(rn,.25*gr);let oi=0;oi=ar.length<=.5*gr?1:Math.ceil(ar.paddedLength/Wr)+1;for(let hi=0;hi<oi;hi++){const fi=hi/Math.max(oi-1,1),On=ar.lerp(fi),un=On.x+va,ti=On.y+va;le.push(un,ti,gr,0);const Fi=un-gr,Bi=ti-gr,ri=un+gr,wn=ti+gr;if(Ft=Ft&&this.isOffscreen(Fi,Bi,ri,wn),Ot=Ot||this.isInsideGrid(Fi,Bi,ri,wn),!c&&this.grid.hitTestCircle(un,ti,gr,G)&&(Kt=!0,!q))return{circles:[],offscreen:!1,collisionDetected:Kt,occluded:!1}}}}return{circles:!q&&Kt||!Ot?[]:le,offscreen:Ft,collisionDetected:Kt,occluded:tt.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,S=-1/0,T=-1/0;for(const O of t){const q=new s.P(O.x+va,O.y+va);p=Math.min(p,q.x),x=Math.min(x,q.y),S=Math.max(S,q.x),T=Math.max(T,q.y),c.push(q)}const I=this.grid.query(p,x,S,T).concat(this.ignoredGrid.query(p,x,S,T)),k={},D={};for(const O of I){const q=O.key;if(k[q.bucketInstanceId]===void 0&&(k[q.bucketInstanceId]={}),k[q.bucketInstanceId][q.featureIndex])continue;const U=[new s.P(O.x1,O.y1),new s.P(O.x2,O.y1),new s.P(O.x2,O.y2),new s.P(O.x1,O.y2)];s.bX(c,U)&&(k[q.bucketInstanceId][q.featureIndex]=!0,D[q.bucketInstanceId]===void 0&&(D[q.bucketInstanceId]=[]),D[q.bucketInstanceId].push(q.featureIndex))}return D}insertCollisionBox(t,c,p,x,S){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:S},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,c,p,x,S){const T=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:x,collisionGroupID:S};for(let k=0;k<t.length;k+=4)T.insertCircle(I,t[k],t[k+1],t[k+2])}projectAndGetPerspectiveRatio(t,c,p,x,S,T,I){const k=[c,p,x,1];let D=!1;x||this.transform.pitch>0?(s.aC(k,k,t),this.fogState&&S&&I.name!=="globe"&&(D=(function(U,G,J,Y,te,le){const ge=le.calculateFogTileMatrix(te),pe=[G,J,Y];return s.af(pe,pe,ge),tr(U,s.ag(pe),le.pitch,le._fov)})(this.fogState,c,p,x,S.toUnwrapped(),this.transform)>.9)):Dd(k,k,t);const O=k[3];return{point:new s.P((k[0]/O+1)/2*this.transform.width+va,(-k[1]/O+1)/2*this.transform.height+va),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/O*.5,1.5),signedDistanceFromCamera:O,occluded:T&&k[2]>O||D}}isOffscreen(t,c,p,x){return p<va||t>=this.screenRightBoundary||x<va||c>this.screenBottomBoundary}isInsideGrid(t,c,p,x){return p>=0&&t<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const t=s.bA([]);return s.br(t,t,[-100,-100,0]),t}}class si{constructor(t,c,p,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ei{constructor(t,c,p,x,S,T=!1){this.text=new si(t?t.text:null,c,p,S),this.icon=new si(t?t.icon:null,c,x,S),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sa{constructor(t,c,p,x=!1){this.text=t,this.icon=c,this.skipFade=p,this.clipped=x}}class zu{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class xi{constructor(t,c,p,x,S){this.bucketInstanceId=t,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=S}}class lp{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const c=++this.maxGroupID;this.collisionGroups[t]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[t]}}function Od(f,t,c,p,x){const{horizontalAlign:S,verticalAlign:T}=s.c1(f),I=-(S-.5)*t,k=-(T-.5)*c,D=s.c2(f,p);return new s.P(I+D[0]*x,k+D[1]*x)}function Fu(f,t,c,p,x){const S=new s.P(f,t);return c&&S._rotate(p?x:-x),S}class mo{constructor(t,c,p,x,S,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Er(this.transform,S),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new lp(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,c,p,x,S=1){const T=p.getBucket(c),I=p.latestFeatureIndex;if(!T||!I||c.fqid!==T.layerIds[0])return;const k=T.layers[0].layout,D=T.layers[0].paint,O=p.collisionBoxArray,q=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/s.al,G=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const J=(Y=p.tileID,te=T.getProjection(),le=this.transform,te.name===this.projection?le.calculateProjMatrix(Y.toUnwrapped()):Pl(le,te,Y));var Y,te,le;const ge=k.get("text-pitch-alignment")==="map",pe=k.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const de=c.dynamicFilter(),Ne=c.dynamicFilterNeedsFeature(),Ce=this.transform.calculatePixelsToTileUnitsMatrix(p),ke=Xs(J,p.tileID.canonical,ge,pe,this.transform,T.getProjection(),Ce);let Te=null;const _e=T.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(ge){const Le=co(J,p.tileID.canonical,ge,pe,this.transform,T.getProjection(),Ce);Te=s.aB([],this.transform.labelPlaneMatrix,Le)}let Me=null;de&&p.latestFeatureIndex&&(Me={unwrappedTileID:G,dynamicFilter:de,dynamicFilterNeedsFeature:Ne}),this.retainedQueryData[T.bucketInstanceId]=new xi(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,p.tileID);const[Ue,Ge]=T.layers[0].layout.get("text-size-scale-range"),it=s.aA(S,Ue,Ge),[tt,mt]=k.get("icon-size-scale-range"),Pt=s.aA(S,tt,mt),Qe={bucket:T,layout:k,paint:D,posMatrix:J,invMatrix:_e,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ke,labelToScreenMatrix:Te,clippingData:Me,scale:q,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:s.bK(T.textSizeData,this.transform.zoom,it),partiallyEvaluatedIconSize:s.bK(T.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Le of T.sortKeyRanges){const{sortKey:dt,symbolInstanceStart:nt,symbolInstanceEnd:yt}=Le;t.push({sortKey:dt,symbolInstanceStart:nt,symbolInstanceEnd:yt,parameters:Qe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Qe})}attemptAnchorPlacement(t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le,ge,pe,de,Ne){const{textOffset0:Ce,textOffset1:ke,crossTileID:Te}=Y,_e=[Ce,ke],Me=Od(t,T,I,_e,k),Ue=this.collisionIndex.placeCollisionBox(le,k,c,p,x,S,Fu(Me.x,Me.y,D,O,this.transform.angle),J,q,U,G.predicate);if(pe){const Ge=le.getSymbolInstanceIconSize(Ne,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(le,Ge,pe,p,x,S,Fu(Me.x,Me.y,D,O,this.transform.angle),J,q,U,G.predicate).box.length===0)return}if(Ue.box.length>0){let Ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Ge=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:_e,width:T,height:I,anchor:t,textScale:k,prevAnchor:Ge},this.markUsedJustification(le,t,Y,ge),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ge,Y),this.placedOrientations[Te]=ge),{shift:Me,placedGlyphBoxes:Ue}}}placeLayerBucketPart(t,c,p,x,S=1){const{bucket:T,layout:I,paint:k,posMatrix:D,textLabelPlaneMatrix:O,labelToScreenMatrix:q,clippingData:U,textPixelRatio:G,mercatorCenter:J,invMatrix:Y,holdingForFade:te,collisionBoxArray:le,partiallyEvaluatedTextSize:ge,partiallyEvaluatedIconSize:pe,collisionGroup:de,latestFeatureIndex:Ne}=t.parameters,Ce=I.get("text-optional"),ke=I.get("icon-optional"),Te=I.get("text-allow-overlap"),_e=I.get("icon-allow-overlap"),Me=I.get("text-rotation-alignment")==="map",Ue=I.get("icon-rotation-alignment")==="map",Ge=I.get("text-pitch-alignment")==="map",it=k.get("symbol-z-offset"),tt=I.get("symbol-elevation-reference")==="sea",mt=I.get("symbol-placement"),[Pt,Qe]=I.get("text-size-scale-range"),[Le,dt]=I.get("icon-size-scale-range"),nt=s.aA(S,Pt,Qe),yt=s.aA(S,Le,dt),Dt=I.get("text-variable-anchor"),Kt=Me&&mt!=="point",Ot=Ue&&mt!=="point",Ft=Dt&&T.hasTextData(),gr=T.hasIconTextFit()&&Ft&&T.hasIconData();this.transform.setProjection(T.projection);const fr=Ft||Kt,sr=Ot||gr;let ar=Te&&(_e||!T.hasIconData()||ke),Mr=_e&&(Te||!T.hasTextData()||Ce);const Gr=!it.isConstant();!T.collisionArrays&&le&&T.deserializeCollisionBoxes(le),p&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,le,nt,yt);const tn=(Wr,Fn,rn)=>{const{crossTileID:oi,numVerticalGlyphVertices:hi}=Wr;let fi=null;if(U&&U.dynamicFilterNeedsFeature||Gr){const w=this.retainedQueryData[T.bucketInstanceId];fi=Ne.loadFeature({featureIndex:Wr.featureIndex,bucketIndex:w.bucketIndex,sourceLayerIndex:w.sourceLayerIndex,layoutVertexArrayOffset:0});const P=fi.properties?fi.properties.worldview:null;if(T.localizable&&T.worldview&&typeof P=="string")if(P==="all")fi.properties.$localized=!0;else{if(!P.split(",").includes(T.worldview))return;fi.properties.$localized=!0,fi.properties.worldview=T.worldview}}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},fi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new s.P(Wr.tileAnchorX,Wr.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[oi]=new sa(!1,!1,!1,!0),void c.add(oi);const On=it.evaluate(fi,{});if(c.has(oi))return;if(te)return void(this.placements[oi]=new sa(!1,!1,!1));let un=!1,ti=!1,Fi=!0,Bi=!1,ri=!1,wn=null,mn={box:null,offscreen:null,occluded:null},ji={box:null},es=null,Pi=null,Li=null,bo=0,fa=0,Js=0;rn.textFeatureIndex?bo=rn.textFeatureIndex:Wr.useRuntimeCollisionCircles&&(bo=Wr.featureIndex),rn.verticalTextFeatureIndex&&(fa=rn.verticalTextFeatureIndex);const Wn=T.elevationFeatures?T.elevationFeatures[Wr.elevationFeatureIndex]:void 0,$a=w=>{w.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const P=this.transform.elevation;w.elevation=tt?On:On+s.bV.getAtTileOffset(w.tileID,new s.P(w.tileAnchorX,w.tileAnchorY),P,Wn),w.elevation+=Wr.zOffset},zs=rn.textBox;if(zs){$a(zs);const w=z=>{let Z=s.bL.horizontal;if(T.allowVerticalPlacement&&!z&&this.prevPlacement){const ie=this.prevPlacement.placedOrientations[oi];ie&&(this.placedOrientations[oi]=ie,Z=ie,this.markUsedOrientation(T,Z,Wr))}return Z},P=(z,Z)=>{if(T.allowVerticalPlacement&&hi>0&&rn.verticalTextBox){for(const ie of T.writingModes)if(ie===s.bL.vertical?(mn=Z(),ji=mn):mn=z(),mn&&mn.box&&mn.box.length)break}else mn=z()};if(Dt){let z=Dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[oi]){const we=this.prevPlacement.variableOffsets[oi];z.indexOf(we.anchor)>0&&(z=z.filter(Ye=>Ye!==we.anchor),z.unshift(we.anchor))}const Z=(we,Ye,ft)=>{const Bt=T.getSymbolInstanceTextSize(ge,Wr,this.transform.zoom,Fn),vr=(we.x2-we.x1)*Bt+2*we.padding,Cr=(we.y2-we.y1)*Bt+2*we.padding,mr=Wr.hasIconTextFit&&!_e?Ye:null;mr&&$a(mr);let Kr={box:[],offscreen:!1,occluded:!1};const on=Te?2*z.length:z.length;for(let nn=0;nn<on;++nn){const ps=this.attemptAnchorPlacement(z[nn%z.length],we,J,Y,fr,vr,Cr,Bt,Me,Ge,G,D,de,nn>=z.length,Wr,Fn,T,ft,mr,ge,pe);if(ps&&(Kr=ps.placedGlyphBoxes,Kr&&Kr.box&&Kr.box.length)){un=!0,wn=ps.shift;break}}return Kr};P(()=>Z(zs,rn.iconBox,s.bL.horizontal),()=>{const we=rn.verticalTextBox;return we&&$a(we),T.allowVerticalPlacement&&!(mn&&mn.box&&mn.box.length)&&hi>0&&we?Z(we,rn.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),mn&&(un=mn.box,Fi=mn.offscreen,Bi=mn.occluded);const ie=w(!(!mn||!mn.box));if(!un&&this.prevPlacement){const we=this.prevPlacement.variableOffsets[oi];we&&(this.variableOffsets[oi]=we,this.markUsedJustification(T,we.anchor,Wr,ie))}}else{const z=(Z,ie)=>{const we=T.getSymbolInstanceTextSize(ge,Wr,this.transform.zoom,Fn),Ye=this.collisionIndex.placeCollisionBox(T,we,Z,J,Y,fr,new s.P(0,0),Te,G,D,de.predicate);return Ye&&Ye.box&&Ye.box.length&&(this.markUsedOrientation(T,ie,Wr),this.placedOrientations[oi]=ie),Ye};P(()=>z(zs,s.bL.horizontal),()=>{const Z=rn.verticalTextBox;return T.allowVerticalPlacement&&hi>0&&Z?($a(Z),z(Z,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),w(!!(mn&&mn.box&&mn.box.length))}}if(es=mn,un=es&&es.box&&es.box.length>0,Fi=es&&es.offscreen,Bi=es&&es.occluded,Wr.useRuntimeCollisionCircles){const w=Wr.centerJustifiedTextSymbolIndex>=0?Wr.centerJustifiedTextSymbolIndex:Wr.verticalPlacedTextSymbolIndex,P=T.text.placedSymbolArray.get(w),z=s.bM(T.textSizeData,ge,P),Z=I.get("text-padding");Pi=this.collisionIndex.placeCollisionCircles(T,Te,P,w,T.lineVertexArray,T.glyphOffsetArray,z,D,O,q,p,Ge,de.predicate,Wr.collisionCircleDiameter*z/s.bY,Z,this.retainedQueryData[T.bucketInstanceId].tileID),un=Te||Pi.circles.length>0&&!Pi.collisionDetected,Fi=Fi&&Pi.offscreen,Bi=Pi.occluded}if(rn.iconFeatureIndex&&(Js=rn.iconFeatureIndex),rn.iconBox){const w=P=>{$a(P);const z=Wr.hasIconTextFit&&wn?Fu(wn.x,wn.y,Me,Ge,this.transform.angle):new s.P(0,0),Z=T.getSymbolInstanceIconSize(pe,this.transform.zoom,Wr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Z,P,J,Y,sr,z,_e,G,D,de.predicate)};ji&&ji.box&&ji.box.length&&rn.verticalIconBox?(Li=w(rn.verticalIconBox),ti=Li.box.length>0):(Li=w(rn.iconBox),ti=Li.box.length>0),Fi=Fi&&Li.offscreen,ri=Li.occluded}const pa=Ce||Wr.numHorizontalGlyphVertices===0&&hi===0,Ia=ke||Wr.numIconVertices===0;if(pa||Ia?Ia?pa||(ti=ti&&un):un=ti&&un:ti=un=ti&&un,un&&es&&es.box&&this.collisionIndex.insertCollisionBox(es.box,I.get("text-ignore-placement"),T.bucketInstanceId,ji&&ji.box&&fa?fa:bo,de.ID),ti&&Li&&this.collisionIndex.insertCollisionBox(Li.box,I.get("icon-ignore-placement"),T.bucketInstanceId,Js,de.ID),Pi&&(un&&this.collisionIndex.insertCollisionCircles(Pi.circles,I.get("text-ignore-placement"),T.bucketInstanceId,bo,de.ID),p)){const w=T.bucketInstanceId;let P=this.collisionCircleArrays[w];P===void 0&&(P=this.collisionCircleArrays[w]=new zu);for(let z=0;z<Pi.circles.length;z+=4)P.circles.push(Pi.circles[z+0]),P.circles.push(Pi.circles[z+1]),P.circles.push(Pi.circles[z+2]),P.circles.push(Pi.collisionDetected?1:0)}const _=T.projection.name!=="globe";ar=ar&&(_||!Bi),Mr=Mr&&(_||!ri),this.placements[oi]=new sa(un||ar,ti||Mr,Fi||T.justReloaded),c.add(oi)},Pn=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Pn),T.elevationType==="road"&&T.updateRoadElevation(Pn.canonical),T.updateZOffset(),T.sortFeaturesByY){const Wr=T.getSortedSymbolIndexes(this.transform.angle);for(let Fn=Wr.length-1;Fn>=0;--Fn){const rn=Wr[Fn];tn(T.symbolInstances.get(rn),rn,T.collisionArrays[rn])}T.hasAnyZOffset&&s.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Wr=T.getSortedIndexesByZOffset();for(let Fn=0;Fn<Wr.length;++Fn){const rn=Wr[Fn];tn(T.symbolInstances.get(rn),rn,T.collisionArrays[rn])}}else for(let Wr=t.symbolInstanceStart;Wr<t.symbolInstanceEnd;Wr++)tn(T.symbolInstances.get(Wr),Wr,T.collisionArrays[Wr]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const Wr=this.collisionCircleArrays[T.bucketInstanceId];s.bl(Wr.invProjMatrix,D),Wr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,c,p,x){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:k,crossTileID:D}=p,O=s.c3(c),q=x===s.bL.vertical?k:O==="left"?S:O==="center"?T:O==="right"?I:-1;S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=q>=0&&S!==q?0:D),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=q>=0&&T!==q?0:D),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=q>=0&&I!==q?0:D),k>=0&&(t.text.placedSymbolArray.get(k).crossTileID=q>=0&&k!==q?0:D)}markUsedOrientation(t,c,p){const x=c===s.bL.horizontal||c===s.bL.horizontalOnly?c:0,S=c===s.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:D}=p,O=t.text.placedSymbolArray;T>=0&&(O.get(T).placedOrientation=x),I>=0&&(O.get(I).placedOrientation=x),k>=0&&(O.get(k).placedOrientation=x),D>=0&&(O.get(D).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(t):1,S=c?c.opacities:{},T=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(const k in this.placements){const D=this.placements[k],O=S[k];O?(this.opacities[k]=new ei(O,x,D.text,D.icon,null,D.clipped),p=p||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[k]=new ei(null,x,D.text,D.icon,D.skipFade,D.clipped),p=p||D.text||D.icon)}for(const k in S){const D=S[k];if(!this.opacities[k]){const O=new ei(D,x,!1,!1);O.isHidden()||(this.opacities[k]=O,p=p||D.text.placed||D.icon.placed)}}for(const k in T)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=T[k]);for(const k in I)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=I[k]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:t)}updateLayerOpacities(t,c,p,x){x&&(this.lastReplacementSourceUpdateTime=x.updateTime);const S=new Set;for(const T of c){const I=T.getBucket(t);I&&T.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,S,T,T.collisionBoxArray,p,x,T.tileID,t.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,T.tileID),I.elevationType==="road"&&I.updateRoadElevation(T.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(t,c,p,x,S,T,I,k){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const D=t.layers[0].layout,O=t.layers[0].paint,q=!!t.layers[0].dynamicFilter(),U=new ei(null,0,!1,!1,!0),G=D.get("text-allow-overlap"),J=D.get("icon-allow-overlap"),Y=D.get("text-variable-anchor"),te=D.get("text-rotation-alignment")==="map",le=D.get("text-pitch-alignment")==="map",ge=O.get("symbol-z-offset"),pe=D.get("symbol-elevation-reference")==="sea",de=!ge.isConstant(),Ne=new ei(null,0,G&&(J||!t.hasIconData()||D.get("icon-optional")),J&&(G||!t.hasTextData()||D.get("text-optional")),!0);!t.collisionArrays&&x&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(x);const Ce=(Te,_e,Me)=>{for(let Ue=0;Ue<_e/4;Ue++)Te.opacityVertexArray.emplaceBack(Me)};let ke=0;T&&t.updateReplacement(I,T);for(let Te=0;Te<t.symbolInstances.length;Te++){const _e=t.symbolInstances.get(Te),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:Ue,crossTileID:Ge,numIconVertices:it,tileAnchorX:tt,tileAnchorY:mt}=_e;let Pt=null;const Qe=this.retainedQueryData[t.bucketInstanceId];de&&_e&&Qe&&(Pt=p.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Qe.bucketIndex,sourceLayerIndex:Qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Le=ge.evaluate(Pt,{}),dt=c.has(Ge);let nt=this.opacities[Ge];dt?nt=U:nt||(nt=Ne,this.opacities[Ge]=nt),c.add(Ge);const yt=Me>0||Ue>0,Dt=it>0,Kt=this.placedOrientations[Ge],Ot=Kt===s.bL.vertical,Ft=Kt===s.bL.horizontal||Kt===s.bL.horizontalOnly;!yt&&!Dt||nt.isHidden()||ke++;let gr=!1;if((yt||Dt)&&T)for(const fr of t.activeReplacements){if(s.bZ(fr,S,s.b_.Symbol,k)||fr.min.x>tt||tt>fr.max.x||fr.min.y>mt||mt>fr.max.y)continue;const sr=s.b$(tt,mt,I.canonical,fr.footprintTileId.canonical);if(gr=s.c0(sr,fr.footprint),gr)break}if(yt){const fr=gr?ba:Go(nt.text);Ce(t.text,Me,Ot?ba:fr),Ce(t.text,Ue,Ft?ba:fr);const sr=nt.text.isHidden(),{leftJustifiedTextSymbolIndex:ar,centerJustifiedTextSymbolIndex:Mr,rightJustifiedTextSymbolIndex:Gr,verticalPlacedTextSymbolIndex:tn}=_e,Pn=t.text.placedSymbolArray,Wr=sr||Ot?1:0;ar>=0&&(Pn.get(ar).hidden=Wr),Mr>=0&&(Pn.get(Mr).hidden=Wr),Gr>=0&&(Pn.get(Gr).hidden=Wr),tn>=0&&(Pn.get(tn).hidden=sr||Ft?1:0);const Fn=this.variableOffsets[Ge];Fn&&this.markUsedJustification(t,Fn.anchor,_e,Kt);const rn=this.placedOrientations[Ge];rn&&(this.markUsedJustification(t,"left",_e,rn),this.markUsedOrientation(t,rn,_e))}if(Dt){const fr=gr?ba:Go(nt.icon),{placedIconSymbolIndex:sr,verticalPlacedIconSymbolIndex:ar}=_e,Mr=t.icon.placedSymbolArray,Gr=nt.icon.isHidden()?1:0;sr>=0&&(Ce(t.icon,it,Ot?ba:fr),Mr.get(sr).hidden=Gr),ar>=0&&(Ce(t.icon,_e.numVerticalIconVertices,Ft?ba:fr),Mr.get(ar).hidden=Gr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const fr=t.collisionArrays[Te];if(fr){let sr=new s.P(0,0),ar=!0;if(fr.textBox||fr.verticalTextBox){if(Y){const Gr=this.variableOffsets[Ge];Gr?(sr=Od(Gr.anchor,Gr.width,Gr.height,Gr.textOffset,Gr.textScale),te&&sr._rotate(le?this.transform.angle:-this.transform.angle)):ar=!1}q&&(ar=!nt.clipped),fr.textBox&&Ss(t.textCollisionBox.collisionVertexArray,nt.text.placed,!ar||Ot,Le,pe,sr.x,sr.y),fr.verticalTextBox&&Ss(t.textCollisionBox.collisionVertexArray,nt.text.placed,!ar||Ft,Le,pe,sr.x,sr.y)}const Mr=ar&&!!(!Ft&&fr.verticalIconBox);fr.iconBox&&Ss(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,Mr,Le,pe,_e.hasIconTextFit?sr.x:0,_e.hasIconTextFit?sr.y:0),fr.verticalIconBox&&Ss(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,!Mr,Le,pe,_e.hasIconTextFit?sr.x:0,_e.hasIconTextFit?sr.y:0)}}}if(t.fullyClipped=ke===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Te.invProjMatrix,t.placementViewportMatrix=Te.viewportMatrix,t.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>t}isStale(){return this.stale}setStale(){this.stale=!0}}function Ss(f,t,c,p,x,S,T){f.emplaceBack(t?1:0,c?1:0,S||0,T||0,p,x?1:0),f.emplaceBack(t?1:0,c?1:0,S||0,T||0,p,x?1:0),f.emplaceBack(t?1:0,c?1:0,S||0,T||0,p,x?1:0),f.emplaceBack(t?1:0,c?1:0,S||0,T||0,p,x?1:0)}const S_=Math.pow(2,25),Hh=Math.pow(2,24),cp=Math.pow(2,17),Zh=Math.pow(2,16),up=Math.pow(2,9),Im=Math.pow(2,8),dp=Math.pow(2,1);function Go(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,c=Math.floor(127*f.opacity);return c*S_+t*Hh+c*cp+t*Zh+c*up+t*Im+c*dp+t}const ba=0;class wa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,c,p,x,S,T){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(c.getBucketParts(I,x,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((k,D)=>k.sortKey-D.sortKey));this._currentPartIndex<I.length;){const k=I[this._currentPartIndex];if(c.placeLayerBucketPart(k,this._seenCrossTileIDs,p,k.symbolInstanceStart===0,T),this._currentPartIndex++,S())return!0}return!1}}class Xh{startNewPlacement(t,c,p,x,S,T,I,k){return this.placement=new mo(t,x,S,T,I,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=p,this._fadeDuration=x,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(t,c,p,x,S){const T=s.o.now(),I=()=>{const k=s.o.now()-T;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&k>2};for(;this._currentPlacementIndex>=0;){const k=c[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&k.visibility!=="none"&&(!k.minzoom||k.minzoom<=D)&&(!k.maxzoom||k.maxzoom>D)){const O=k,q=O.layout.get("symbol-z-elevate"),U=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=O.layout.get("symbol-z-order"),J=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&U),Y=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),te=J&&Y,le=this._inProgressLayer=this._inProgressLayer||new wa(O),ge=s.B(k.source,k.scope);if(le.continuePlacement(q||te?x[ge]:p[ge],this.placement,this._showCollisionBoxes,k,I,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const sl=512/s.al/2;class Bs{constructor(t,c,p){this.tileID=t,this.bucketInstanceId=p,this.index=new s.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=t.canonical.x*s.al,S=t.canonical.y*s.al;for(let T=0;T<c.length;T++){const{key:I,crossTileID:k,tileAnchorX:D,tileAnchorY:O}=c.get(T),q=Math.floor((x+D)*sl),U=Math.floor((S+O)*sl);this.index.add(q,U),this.keys.push(I),this.crossTileIDs.push(k)}this.index.finish()}findMatches(t,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),S=sl/Math.pow(2,c.canonical.z-this.tileID.canonical.z),T=c.canonical.x*s.al,I=c.canonical.y*s.al;for(let k=0;k<t.length;k++){const D=t.get(k);if(D.crossTileID)continue;const{key:O,tileAnchorX:q,tileAnchorY:U}=D,G=Math.floor((T+q)*S),J=Math.floor((I+U)*S),Y=this.index.range(G-x,J-x,G+x,J+x).sort((te,le)=>te-le);for(const te of Y){const le=this.crossTileIDs[te];if(this.keys[te]===O&&!p.has(le)){p.add(le),D.crossTileID=le;break}}}}}class kl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const c=Math.round((t-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],S={};for(const T in x){const I=x[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),S[I.tileID.key]=I}this.indexes[p]=S}this.lng=t}addBucket(t,c,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<c.symbolInstances.length;S++)c.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const x=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const T=this.indexes[S];if(Number(S)>t.overscaledZ)for(const I in T){const k=T[I];k.tileID.isChildOf(t)&&k.findMatches(c.symbolInstances,t,x)}else{const I=T[t.scaledTo(Number(S)).key];I&&I.findMatches(c.symbolInstances,t,x)}}for(let S=0;S<c.symbolInstances.length;S++){const T=c.symbolInstances.get(S);T.crossTileID||(T.crossTileID=p.generate(),x.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Bs(t,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(t,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[t].delete(p)}removeStaleBuckets(t){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const S in x)t[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[S]),delete x[S],c=!0)}return c}}class Ms{constructor(){this.layerIndexes={},this.crossTileIDs=new kl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,c,p,x){let S=this.layerIndexes[t.fqid];S===void 0&&(S=this.layerIndexes[t.fqid]=new rc);let T=!1;const I={};x.name!=="globe"&&S.handleWrapJump(p);for(const k of c){const D=k.getBucket(t);D&&t.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(k.tileID,D,this.crossTileIDs)&&(T=!0),I[D.bucketInstanceId]=!0)}return S.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(t){const c={};t.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Sc=771;class Jr{constructor(t,c,p,x){this.blendFunction=t,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}Jr.Replace=[1,0,1,0],Jr.disabled=new Jr(Jr.Replace,s.ao.transparent,[!1,!1,!1,!1]),Jr.unblended=new Jr(Jr.Replace,s.ao.transparent,[!0,!0,!0,!0]),Jr.alphaBlended=new Jr([1,Sc,1,Sc],s.ao.transparent,[!0,!0,!0,!0]),Jr.alphaBlendedNonPremultiplied=new Jr([770,Sc,770,Sc],s.ao.transparent,[!0,!0,!0,!0]),Jr.multiply=new Jr([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),Jr.additive=new Jr([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class _r{constructor(t,c,p){this.func=t,this.mask=c,this.range=p}}_r.ReadOnly=!1,_r.ReadWrite=!0,_r.disabled=new _r(519,_r.ReadOnly,[0,1]);const zd=7680;class Xr{constructor(t,c,p,x,S,T){this.test=t,this.ref=c,this.mask=p,this.fail=x,this.depthFail=S,this.pass=T}}Xr.disabled=new Xr({func:519,mask:0},0,0,zd,zd,zd);const hp=1029,Fd=2305;class qr{constructor(t,c,p){this.enable=t,this.mode=c,this.frontFace=p}}function Bu(f,t){const c=s.ca(f,3);s.cc(f,t),s.cg(f,3,c)}function Vu(f,t){const c=s.c7([]);return s.c8(c,c,-t),s.c9(c,c,-f),c}function nc(f,t){const c=[f[0],f[1],0],p=[t[0],t[1],0];if(s.ag(c)>=1e-15){const T=s.aw([],c);s.c5(p,T,s.bJ(p,T)),t[0]=p[0],t[1]=p[1]}const x=s.bI([],t,f);if(s.c6(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return Vu(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),S)}qr.disabled=new qr(!1,hp,Fd),qr.backCCW=new qr(!0,hp,Fd),qr.backCW=new qr(!0,hp,2304),qr.frontCW=new qr(!0,1028,2304),qr.frontCCW=new qr(!0,1028,Fd);class Kh{constructor(t,c){this.position=t,this.orientation=c}get position(){return this._position}set position(t){if(t){const c=t instanceof s.ae?t:new s.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(c.x=s.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(t,c,p){if(this.orientation=null,!this.position)return;const x=this.position,S=p||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(t)):0),T=s.ae.fromLngLat(t,S),I=[T.x-x.x,T.y-x.y,T.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=nc(I,c)}setPitchBearing(t,c){this.orientation=Vu(s.an(t),s.an(-c))}}class Bd{constructor(t,c){this._transform=s.bA([]),this.orientation=c,this.position=t}get mercatorPosition(){const t=this.position;return new s.ae(t[0],t[1],t[2])}get position(){const t=s.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var c;t&&s.cg(this._transform,3,[(c=t)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c7([]),t&&Bu(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,c){this._orientation=Vu(t,c),Bu(this._transform,this._orientation)}forward(){const t=s.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,c){const p=new Float64Array(16);return s.bl(p,this.getWorldToCamera(t,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,c,p){const x=this.position;s.c5(x,x,-t);const S=new Float64Array(16);return s.bq(S,[p,p,p]),s.br(S,S,x),S[10]*=c,S}getWorldToCamera(t,c){const p=new Float64Array(16),x=new Float64Array(4),S=this.position;return s.cb(x,this._orientation),s.c5(S,S,-t),s.cc(p,x),s.br(p,p,S),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(t,c,p,x){const S=new Float64Array(16);return s.cd(S,t,c,p,x),S}getCameraToClipOrthographic(t,c,p,x,S,T){const I=new Float64Array(16);return s.ce(I,t,c,p,x,S,T),I}getDistanceToElevation(t,c=!1){const p=t===0?0:s.cf(t,c?s.a$(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Bd([...this.position],[...this.orientation])}}const oa=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t});class Yh{constructor(t=0,c=0,p=0,x=0){if(isNaN(t)||t<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=c,this.left=p,this.right=x}interpolate(t,c,p){return c.top!=null&&t.top!=null&&(this.top=s.ak(t.top,c.top,p)),c.bottom!=null&&t.bottom!=null&&(this.bottom=s.ak(t.bottom,c.bottom,p)),c.left!=null&&t.left!=null&&(this.left=s.ak(t.left,c.left,p)),c.right!=null&&t.right!=null&&(this.right=s.ak(t.right,c.right,p)),this}getCenter(t,c){const p=s.aA((this.left+t-this.right)/2,0,t),x=s.aA((this.top+c-this.bottom)/2,0,c);return new s.P(p,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Yh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ol=15;class Qh{constructor(t,c,p,x,S,T,I){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=t||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Yh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Bd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Qh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ol}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(t||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const p=this.getProjection(),x=!s.by(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const c=t!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const c=-t*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const c=s.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const c=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,S=0;for(let T=0;T<c.length;T++){const I=new s.P(c[T][0]*this.width,p+c[T][1]*(this.height-p)),k=t.pointCoordinate(I);if(!k)continue;const D=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);x+=k[3]*D,S+=D}return S===0?NaN:x/S}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(t),S=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-p,S);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const c=this.elevation,p=t.elevation,x=c!=null!=(p!=null)||c&&p&&c.exaggeration()!==p.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!x}computeZoomRelativeTo(t){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[c.x,c.y,c.z]:[t.x,t.y,t.z];const x=s.ag(s.av([],this._camera.position,p));return s.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let c=!1;if(t.orientation&&!s.cp(t.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];s.cq(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,c=new Kh;return c.position=new s.ae(t[0],t[1],t[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(t){if(!s.cr(t))return!1;s.cs(t,t);const c=s.ct([],[0,0,-1],t),p=s.ct([],[0,-1,0],t);if(p[2]<0)return!1;const x=nc(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(t){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;t[2]=s.aA(t[2],x/p,x/c),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,c,p){this._unmodified=!1,this._edgeInsets.interpolate(t,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const c=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(t){const c=[new s.cu(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),S=this.pointCoordinate(new s.P(this.width,this.height)),T=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(p.x,x.x,S.x,T.x)),k=Math.floor(Math.max(p.x,x.x,S.x,T.x)),D=1;for(let O=I-D;O<=k+D;O++)O!==0&&c.push(new s.cu(O,t))}return c}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,c,p,x){let S=[];const T=p!=null,I=!T;if(I&&this.zoom<c||T&&p[0]===0&&p[1]===0)return S;const k=new Set,D=(q,U,G,J,Y)=>{const te=s.cY(U,q,G,J,Y);k.has(te)||(S.push(new s.aQ(q,U,G,J,Y)),k.add(te))};for(let q=0;q<t.length;q++){const U=t[q];if(I&&U.canonical.z!==c||T&&x!==void 0&&x>U.canonical.z)continue;const G=U.canonical,J=U.overscaledZ,Y=U.wrap,te=1<<G.z,le=G.x+1<te,ge=G.x>0,pe=G.y+1<te,de=G.y>0,Ne=U.wrap-(ge?0:1),Ce=U.wrap+(le?0:1),ke=ge?G.x-1:te-1,Te=le?G.x+1:0;if(T)p[0]<0?(D(J,Ce,G.z,Te,G.y),p[1]<0&&pe&&(D(J,Y,G.z,G.x,G.y+1),D(J,Ce,G.z,Te,G.y+1)),p[1]>0&&de&&(D(J,Y,G.z,G.x,G.y-1),D(J,Ce,G.z,Te,G.y-1))):p[0]>0?(D(J,Ne,G.z,ke,G.y),p[1]<0&&pe&&(D(J,Y,G.z,G.x,G.y+1),D(J,Ne,G.z,ke,G.y+1)),p[1]>0&&de&&(D(J,Y,G.z,G.x,G.y-1),D(J,Ne,G.z,ke,G.y-1))):p[1]<0&&pe?D(J,Y,G.z,G.x,G.y+1):de&&D(J,Y,G.z,G.x,G.y-1);else{const _e=U.visibleQuadrants;1&_e&&(D(J,Ne,G.z,ke,G.y),de&&(D(J,Y,G.z,G.x,G.y-1),D(J,Ne,G.z,ke,G.y-1))),2&_e&&(D(J,Ce,G.z,Te,G.y),de&&(D(J,Y,G.z,G.x,G.y-1),D(J,Ce,G.z,Te,G.y-1))),4&_e&&(D(J,Ne,G.z,ke,G.y),pe&&(D(J,Y,G.z,G.x,G.y+1),D(J,Ne,G.z,ke,G.y+1))),8&_e&&(D(J,Ce,G.z,Te,G.y),pe&&(D(J,Y,G.z,G.x,G.y+1),D(J,Ce,G.z,Te,G.y+1)))}}const O=[];for(const q of S)S.some(U=>q.isChildOf(U))||O.push(q);if(S=O.filter(q=>!t.some(U=>!!(q.overscaledZ<c&&U.isChildOf(q))||q.equals(U)||q.isChildOf(U))),I){const q=1<<c,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=[q*U.x,q*U.y],J=4,Y=J*J;S=S.filter(te=>{const le=te.canonical.x+.5-G[0],ge=te.canonical.y+.5-G[1];return le*le+ge*ge<Y})}return S}extendTileCoverToNearPlane(t,c,p){const x=[],S=new Set;for(const ge of t)S.add(ge.key);const T=(ge,pe,de,Ne,Ce)=>{const ke=s.cY(pe,ge,de,Ne,Ce);S.has(ke)||(x.push(new s.aQ(ge,pe,de,Ne,Ce)),S.add(ke))},I=t.reduce((ge,pe)=>Math.max(ge,pe.overscaledZ),p),k=1<<p,D=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],O=new s.P(0,0),q=new s.P(0,0),U=(ge,pe)=>{const de=Math.floor(ge[0]),Ne=Math.floor(ge[1]),Ce=(ge[0]-de)*s.al,ke=(ge[1]-Ne)*s.al,Te=Math.floor(pe[0]),_e=Math.floor(pe[1]),Me=(pe[0]-Te)*s.al,Ue=(pe[1]-_e)*s.al;for(let Ge=-1;Ge<=1;Ge++){const it=de+Ge;if(!(it<0||it>=k)){O.x=Ce-Ge*s.al,q.x=Me-(it-Te)*s.al;for(let tt=-1;tt<=1;tt++){const mt=Ne+tt;O.y=ke-tt*s.al,q.y=Ue-(mt-_e)*s.al,s.cZ(O,q,D)&&T(I,0,p,it,mt)}}}},G=c.points,J=G[s.cv],Y=G[s.cw],te=this._projectToGround(J,G[s.cx]),le=this._projectToGround(Y,G[s.cy]);return U(J,te),U(Y,le),x}_projectToGround(t,c){return s.cz(s.cA(),t,c,t[2]/(t[2]-c[2]))}coveringTiles(t){let c=this.coveringZoomLevel(t);const p=c,x=this.elevation&&this.elevation.exaggeration(),S=x&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const I=this.locationCoordinate(this.center),k=this.center.lat,D=1<<c,O=[D*I.x,D*I.y,0],q=this.projection.name==="globe",U=!q,G=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,U),J=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=D*s.cf(1,this.center.lat),te=this._camera.position[2]/s.cf(1,this.center.lat),le=[D*J.x,D*J.y,te*(U?1:Y)],ge=q||x,pe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),de=this.isLODDisabled(!0)?c:0;let Ne;if(this._elevation&&t.isTerrainDEM)Ne=1e4*this._elevation.exaggeration();else if(this._elevation){const Le=this._elevation.getMinMaxForVisibleTiles();Ne=Le?Le.max:this._centerAltitude}else Ne=this._centerAltitude;const Ce=t.isTerrainDEM?-Ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,ke=this.projection.isReprojectedInTileSpace?s.cC(this):1,Te=Le=>{const nt=new s.ae(Le.x+25e-6,Le.y,Le.z),yt=new s.ae(Le.x,Le.y+25e-6,Le.z),Dt=Le.toLngLat(),Kt=nt.toLngLat(),Ot=yt.toLngLat(),Ft=this.locationCoordinate(Dt),gr=this.locationCoordinate(Kt),fr=this.locationCoordinate(Ot),sr=Math.hypot(gr.x-Ft.x,gr.y-Ft.y),ar=Math.hypot(fr.x-Ft.x,fr.y-Ft.y);return Math.sqrt(sr*ar)*ke/25e-6},_e=Le=>{const dt=Ne,nt=Ce;return{aabb:s.cF(this,D,0,0,0,Le,nt,dt,this.projection),zoom:0,x:0,y:0,minZ:nt,maxZ:dt,wrap:Le,fullyVisible:!1}},Me=[];let Ue=[];const Ge=c,it=t.reparseOverscaled?p:c,tt=(te-this._centerAltitude)*Y,mt=Le=>{if(!this._elevation||!Le.tileID||!T)return;const dt=this._elevation.getMinMaxForTile(Le.tileID),nt=Le.aabb;dt?(nt.min[2]=dt.min,nt.max[2]=dt.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(Le.shouldSplit=Qe(Le),Le.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},Pt=(Le,dt)=>{if(.707*dt<Le)return 1;const nt=dt/Le;return nt/(1.4144271570014144+(Math.pow(1.1,nt-1.4144271570014144+1)-1)/(1.1-1)-1)},Qe=Le=>{if(Le.zoom<de)return!0;if(Le.zoom===Ge)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const dt=Le.aabb.distanceX(le),nt=Le.aabb.distanceY(le);let yt=tt,Dt=1;if(q){yt=Le.aabb.distanceZ(le);const ar=Math.pow(2,Le.zoom),Mr=s.a$((Le.y+1)/ar),Gr=s.a$(Le.y/ar),tn=Math.min(Math.max(k,Mr),Gr),Pn=s.d1(tn)/s.d1(k);if(Dt=tn===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pn/this._mercatorScaleRatio),this.zoom<=s.c_&&Le.zoom===Ge-1&&Pn>=.9)return!0}else if(S&&(yt=Le.aabb.distanceZ(le)*Y),this.projection.isReprojectedInTileSpace&&p<=5){const ar=Math.pow(2,Le.zoom),Mr=Te(new s.ae((Le.x+.5)/ar,(Le.y+.5)/ar));Dt=Mr>.85?1:Mr}if(!T&&!q){const ar=Math.sqrt(dt*dt+nt*nt+yt*yt);let Mr=(1<<Ge-Le.zoom)*pe*Dt;return Mr*=Pt(Math.max(yt,tt),ar),ar<Mr}let Kt=Number.MAX_VALUE,Ot=0;const Ft=Le.aabb.getCorners(),gr=[];for(const ar of Ft){s.av(gr,ar,le),q||(S?gr[2]*=Y:gr[2]=tt);const Mr=s.bJ(gr,this._camera.forward());Mr<Kt&&(Kt=Mr,Ot=Math.abs(gr[2]))}let fr=(1<<Ge-Le.zoom)*pe*Dt;if(fr*=Pt(Math.max(Ot,tt),Kt),Kt<fr)return!0;const sr=Le.aabb.closestPoint(O);return sr[0]===O[0]&&sr[1]===O[1]};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Me.push(_e(-Le)),Me.push(_e(Le));for(Me.push(_e(0));Me.length>0;){const Le=Me.pop(),dt=Le.x,nt=Le.y;let yt=Le.fullyVisible;const Dt=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!yt){let Kt=ge?Le.aabb.intersects(G):Le.aabb.intersectsFlat(G);if(Kt===0&&Dt()){const Ot=new s.cD(Le.zoom,dt,nt);Kt=s.cE(this,D,Ot,!0).intersects(G)}if(Kt===0)continue;yt=Kt===2}if(Le.zoom===Ge||!Qe(Le)){const Kt=Le.zoom===Ge?it:Le.zoom;if(t.minzoom&&t.minzoom>Kt)continue;let Ot=0;if(!yt){let sr=ge?Le.aabb.intersectsPrecise(G):Le.aabb.intersectsPreciseFlat(G);if(sr===0&&Dt()){const ar=new s.cD(Le.zoom,dt,nt);sr=s.cE(this,D,ar,!0).intersectsPrecise(G)}if(sr===0)continue;if(t.calculateQuadrantVisibility)if(G.containsPoint(Le.aabb.center))Ot=15;else for(let ar=0;ar<4;ar++)Le.aabb.quadrant(ar).intersects(G)!==0&&(Ot|=1<<ar)}const Ft=O[0]-(.5+dt+(Le.wrap<<Le.zoom))*(1<<c-Le.zoom),gr=O[1]-.5-nt,fr=Le.tileID?Le.tileID:new s.aQ(Kt,Le.wrap,Le.zoom,dt,nt);t.calculateQuadrantVisibility&&(fr.visibleQuadrants=Ot),Ue.push({tileID:fr,distanceSq:Ft*Ft+gr*gr});continue}for(let Kt=0;Kt<4;Kt++){const Ot=(dt<<1)+Kt%2,Ft=(nt<<1)+(Kt>>1),gr={aabb:T?Le.aabb.quadrant(Kt):s.cF(this,D,Le.zoom+1,Ot,Ft,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:Ot,y:Ft,wrap:Le.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};S&&!q&&(gr.tileID=new s.aQ(Le.zoom+1===Ge?it:Le.zoom+1,Le.wrap,Le.zoom+1,Ot,Ft),mt(gr)),Me.push(gr)}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,dt=this.horizonLineFromTop();Ue=Ue.filter(nt=>{const yt=[0,0,0,1],Dt=[s.al,s.al,0,1],Kt=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());s.aC(yt,yt,Kt),s.aC(Dt,Dt,Kt);const Ot=s.cG([],yt,Dt),Ft=s.cH([],yt,Dt),gr=s.c$(Ot,Ft);if(gr===0)return!0;let fr=!1;const sr=this._elevation;if(sr&&gr>Le&&dt!==0){const ar=this.calculateProjMatrix(nt.tileID.toUnwrapped());let Mr;t.isTerrainDEM||(Mr=sr.getMinMaxForTile(nt.tileID)),Mr||(Mr={min:Ce,max:Ne});const Gr=s.cI(this.rotation),tn=[Gr[0]*s.al,Gr[1]*s.al,Mr.max];s.af(tn,tn,ar),fr=(1-tn[1])*this.height*.5<dt}return gr<Le||fr})}return Ue.sort((Le,dt)=>Le.distanceSq-dt.distanceSq).map(Le=>Le.tileID)}resize(t,c){this.width=t,this.height=c,this.pixelsToGLUnits=[2/t,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const c=s.aA(t.lat,-s.cJ,s.cJ),p=this.projection.project(t.lng,c);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,c){let p,x;const S=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(c.x-S.x)/I,x=(c.y-S.y)/I}else{const I=this.pointCoordinate(c),k=this.pointCoordinate(S);p=I.x-k.x,x=I.y-k.y}const T=this.locationCoordinate(t);this.setLocation(new s.ae(T.x-p,T.y-x))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,c){return this.projection.locationPoint(this,t,c)}locationPoint3D(t,c){return this.projection.locationPoint(this,t,c,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,c){return this.coordinateLocation(this.pointCoordinate3D(t,c))}locationCoordinate(t,c){const p=c?s.cf(c,t.lat):void 0,x=this.projection.project(t.lng,t.lat);return new s.ae(x.x,x.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,c){const p=c??this._centerAltitude,x=[t.x,t.y,0,1],S=[t.x,t.y,1,1];s.aC(x,x,this.pixelMatrixInverse),s.aC(S,S,this.pixelMatrixInverse);const T=S[3];s.cK(x,x,1/x[3]),s.cK(S,S,1/T);const I=x[2],k=S[2];return{p0:x,p1:S,t:I===k?0:(p-I)/(k-I)}}screenPointToMercatorRay(t){const c=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return s.aC(c,c,this.pixelMatrixInverse),s.aC(p,p,this.pixelMatrixInverse),s.cK(c,c,1/c[3]),s.cK(p,p,1/p[3]),c[2]=s.cf(c[2],this._center.lat)*this.worldSize,p[2]=s.cf(p[2],this._center.lat)*this.worldSize,s.cK(c,c,1/this.worldSize),s.cK(p,p,1/this.worldSize),new s.ax([c[0],c[1],c[2]],s.aw([],s.av([],p,c)))}rayIntersectionCoordinate(t){const{p0:c,p1:p,t:x}=t,S=s.cf(c[2],this._center.lat),T=s.cf(p[2],this._center.lat);return new s.ae(s.ak(c[0],p[0],x)/this.worldSize,s.ak(c[1],p[1],x)/this.worldSize,s.ak(S,T,x))}pointCoordinate(t,c=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,c)}pointCoordinate3D(t,c){if(!this.elevation)return this.pointCoordinate(t,c);let p=this.projection.pointCoordinate3D(this,t.x,t.y);if(p)return new s.ae(p[0],p[1],p[2]);let x=0,S=this.horizonLineFromTop();if(t.y>S)return this.pointCoordinate(t,c);const T=.02*S,I=t.clone();for(let k=0;k<10&&S-x>T;k++){I.y=s.ak(x,S,.66);const D=this.projection.pointCoordinate3D(this,I.x,I.y);D?(S=I.y,p=D):x=I.y}return p?new s.ae(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(t);const c=this.pointCoordinate(t);return c.y>=0&&c.y<=1}_coordinatePoint(t,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,x=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return s.aC(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=this.pointLocation3D(new s.P(c,t)),T=this.pointLocation3D(new s.P(x,t)),I=this.pointLocation3D(new s.P(x,p)),k=this.pointLocation3D(new s.P(c,p));let D=Math.min(S.lng,T.lng,I.lng,k.lng),O=Math.max(S.lng,T.lng,I.lng,k.lng),q=Math.min(S.lat,T.lat,I.lat,k.lat),U=Math.max(S.lat,T.lat,I.lat,k.lat);const G=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,Y=(te,le,ge,pe,de)=>{const Ne=(te+ge)/2,Ce=(le+pe)/2,ke=new s.P(Ne,Ce),{lng:Te,lat:_e}=this.pointLocation3D(ke),Me=Math.max(0,D-Te,q-_e,Te-O,_e-U);D=Math.min(D,Te),O=Math.max(O,Te),q=Math.min(q,_e),U=Math.max(U,_e),(de<J||Me>G)&&(Y(te,le,Ne,Ce,de+1),Y(Ne,Ce,ge,pe,de+1))};if(Y(c,t,x,t,1),Y(x,t,x,p,1),Y(x,p,c,p,1),Y(c,p,c,t,1),this.projection.name==="globe"){const[te,le]=s.cM(this);te?(U=90,O=180,D=-180):le&&(q=-90,O=180,D=-180)}return new s.aI(new s.aT(D,q),new s.aT(O,U))}_getBoundsRectangular(t,c){const{top:p,left:x}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new s.P(x,p),k=new s.P(T,p),D=new s.P(T,S),O=new s.P(x,S);let q=this.pointCoordinate(I,t),U=this.pointCoordinate(k,t);const G=this.pointCoordinate(D,c),J=this.pointCoordinate(O,c),Y=(te,le)=>(le.y-te.y)/(le.x-te.x);return q.y>1&&U.y>=0?q=new s.ae((1-J.y)/Y(J,q)+J.x,1):q.y<0&&U.y<=1&&(q=new s.ae(-J.y/Y(J,q)+J.x,0)),U.y>1&&q.y>=0?U=new s.ae((1-G.y)/Y(G,U)+G.x,1):U.y<0&&q.y<=1&&(U=new s.ae(-G.y/Y(G,U)+G.x,0)),new s.aI().extend(this.coordinateLocation(q)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=t.visibleDemTiles.reduce((p,x)=>{if(x.dem){const S=x.dem.tree;p.min=Math.min(p.min,S.minimums[0]),p.max=Math.max(p.max,S.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*t.exaggeration(),c.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,c){return this.projection.createTileMatrix(this,c,t)}calculateDistanceTileData(t){const c=t.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=t.canonical,S=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(x.z),k=(x.x+Math.pow(2,x.z)*t.wrap)*I,D=x.y*I,O=this.point;O.x*=T/this.worldSize,O.y*=T/this.worldSize;const q=this.angle,U=Math.sin(-q),G=-Math.cos(-q);return p[c]={bearing:[U,G],center:[(O.x-k)*S,(O.y-D)*S],scale:I/s.al*S},p[c]}calculateFogTileMatrix(t){const c=t.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.aB(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(t,c=!1,p=!1){const x=t.key;let S;if(S=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,S[x])return S[x];const T=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,s.aB(T,I,T),S[x]=new Float32Array(T),S[x]}calculatePixelsToTileUnitsMatrix(t){const c=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=s.cN(t,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,c=s.bq([],[t,t,t]);return s.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const c=s.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),S=s.cf(1,this._center.lat);p[2]/=S,x[2]/=S,s.aw(x,x);const T=t.raycast(p,x,t.exaggeration());if(T){const I=s.bH([],p,x,T),k=new s.ae(I[0],I[1],s.cf(I[2],s.a$(I[1]))),D=(k.z+s.ag([k.x-p[0],k.y-p[1],k.z-p[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const c=this._elevation,p=s.cf(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),S=c.getAtPointOrZero(new s.ae(...x)),T=this.pixelsPerMeter/this.worldSize*S,I=this._minimumHeightOverTerrain(),k=x[2]-T;if(k<=I)if(k<0||t){const D=this.locationCoordinate(this._center,this._centerAltitude),O=[x[0],x[1],D.z-x[2]],q=s.ag(O);O[2]-=(I-k)/this._pixelsPerMercatorPixel;const U=s.ag(O);if(U===0)return;s.c5(O,O,q/U*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],D.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const U=this.center;return U.lat=s.aA(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(U.lng=s.aA(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let S=0,T=p,I=x;const k=this.width/2,D=this.height/2,O=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(x-D<O&&(I=O+D),x+D>q&&(I=q-D),q-O<this.height&&(S=Math.max(S,this.height/(q-O)),I=(q+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,J=this.worldSize/2-(U+G)/2;T=(p+J+this.worldSize)%this.worldSize-J,T-k<U&&(T=U+k),T+k>G&&(T=G-k),G-U<this.width&&(S=Math.max(S,this.width/(G-U)),T=(G+U)/2)}T===p&&I===x||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(T,I))),S&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const x=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,S);let I;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-t.x/this.width,k[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Me=_e*this.aspect,Ue=-Me,Ge=-_e;Me-=t.x,Ue-=t.x,_e+=t.y,Ge+=t.y,I=this._camera.getCameraToClipOrthographic(Ue,Me,Ge,_e,this._nearZ,this._farZ),((it,tt,mt,Pt)=>{for(let Qe=0;Qe<16;Qe++)it[Qe]=s.ak(tt[Qe],mt[Qe],Pt)})(I,I,k,s.d0(this.pitch>=ol?1:this.pitch/ol))}else I=k;const D=s.cP([],k,T);let O=s.cP([],I,T);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),Me=s.bA([]);s.br(Me,Me,[_e.x*this.worldSize,_e.y*this.worldSize,0]),s.aB(Me,Me,s.cQ(this)),s.br(Me,Me,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),s.aB(O,O,Me),s.aB(D,D,Me),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],O,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=O,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),c){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cP([],_e,T)}else this.expandedFarZProjMatrix=this.projMatrix;const q=s.bl([],I);this.frustumCorners=s.cT.fromInvProjectionMatrix(q,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const U=new Float32Array(16);s.bA(U),s.cS(U,U,[1,-1,1]),s.cU(U,U,this._pitch),s.bB(U,U,this.angle);const G=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(G);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-t.x/this.width,G[9]=2*(t.y+J)/this.height,this.skyboxMatrix=s.aB(U,G,U);const Y=this.point,te=Y.x,le=Y.y,ge=this.width%2/2,pe=this.height%2/2,de=Math.cos(this.angle),Ne=Math.sin(this.angle),Ce=te-Math.round(te)+de*ge+Ne*pe,ke=le-Math.round(le)+de*pe+Ne*ge,Te=new Float64Array(O);if(s.br(Te,Te,[Ce>.5?Ce-1:Ce,ke>.5?ke-1:ke,0]),this.alignedProjMatrix=Te,O=s.bC(),s.cS(O,O,[this.width/2,-this.height/2,1]),s.br(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.bC(),s.cS(O,O,[1,-1,1]),s.br(O,O,[-1,-1,0]),s.cS(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},O=s.bl(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(_e,_e,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,S=[t,t,c];s.c5(S,S,x),s.c5(p,p,-1),s.cW(p,p,S);const T=s.bC();s.br(T,T,p),s.cS(T,T,S),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,c,x)}_computeCameraPosition(t){const c=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-t/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*S,x.y/this.worldSize-p[1]*S,t/this.worldSize*this._centerAltitude-p[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=t[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(S=Math.min((c-p)/x,1)),this._camera.position=s.bH([],this._camera.position,t,S),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),S=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((t[2]-S)/Math.cos(p),T),k=this._zoomFromMercatorZ(I);s.bH(t,t,c,I),this._pitch=s.aA(p,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(x,-Math.PI,Math.PI),this._setZoom(s.aA(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let c=0,p=s.cL,x=0,S=1/0;for(;p-c>1e-6&&p>c;){const T=c+.5*(p-c),I=this.tileSize*Math.pow(2,T),k=this.getCameraToCenterDistance(this.projection,T,I),D=this.scaleZoom(k/(Math.max(0,t)*this.tileSize)),O=Math.abs(T-D);O<S&&(S=O,x=T),T<D?c=T:p=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,c){const p=Math.min(t.x,c.x),x=Math.max(t.x,c.x),S=Math.min(t.y,c.y),T=Math.max(t.y,c.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(p,S),new s.P(x,T),new s.P(p,T),new s.P(x,S)],k=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const O of I){const q=this.pointRayIntersection(O);if(q.t<0)return!0;const U=this.rayIntersectionCoordinate(q);if(U.x<k||U.y<0||U.x>D||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,c){const p=s.ag(s.av([],this._camera.position,t)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([c,p,x],S){const T=[c,p,x,1];s.aC(T,T,S);const I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,c=this.zoom,p=this.worldSize){const x=s.cO(t,c,this.width,this.height,1024),S=t.pixelSpaceConversion(this.center.lat,p,x);let T=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(T=s.ak(1,T,s.d0(this.pitch>=ol?1:this.pitch/ol))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(t,t,this.globeMatrix),t}getFrustum(t){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Ha=(f,t)=>{if(t>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?s.ah(60,45,c.pitch):s.ah(30,15,c.pitch),S=c._farZ-c._nearZ,T=t*c.height,I=((1-(k=x))*c.cameraToCenterDistance+k*(c._farZ+T))*p;var k;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/S,(I-T-c._nearZ)/S]}}},Tc=2048;class T_{constructor(t,c){this.aabb=t,this.lastCascade=c}}class Jh{add(t,c){const p=this.receivers[t.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[t.key]=new T_(c,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,c,p){const x=s.d9.fromPoints(t.points);let S=0;for(const T in this.receivers){const I=this.receivers[T];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);const k=I.aabb.getCorners();for(let D=0;D<p.length;D++){let O=!0;for(const q of k){const U=[q[0]*c,q[1]*c,q[2]];if(s.af(U,U,p[D].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){O=!1;break}}if(I.lastCascade=D,S=Math.max(S,D),O)break}}return S+1}}class ef{constructor(t){this.painter=t,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Jh,this._depthMode=new _r(t.context.gl.LEQUAL,_r.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,c){const p=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity"),S=c.properties.get("shadow-draw-before-layer");if(!c.shadowsEnabled()||x<=0)return;let T=-1,I=0;for(const le of p.style.order){const ge=p.style._mergedLayers[le];ge.hasShadowPass()&&!ge.isHidden(t.zoom)&&(T=I),S&&S===le&&(this._drawShadowAfterLayer=I>0?I-1:0),I+=1}if(this._enabled=T>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=T);const k=p.context,D=Tc,O=Tc;if(this._cascades.length===0||Tc!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<2;++le){const ge=p._shadowMapDebug,pe=k.gl,de=k.createFramebuffer(D,O,ge?1:0,"texture"),Ne=new s.T(k,{width:D,height:O,data:null},pe.DEPTH_COMPONENT16);if(de.depthAttachment.set(Ne.texture),ge){const Ce=new s.T(k,{width:D,height:O,data:null},pe.RGBA8);de.colorAttachment0.set(Ce.texture)}this._cascades.push({framebuffer:de,texture:Ne,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=Bg(c);let q=0;if(t.elevation){const le=t.elevation,ge=[1e4,-1e4];le.visibleDemTiles.filter(pe=>pe.dem).forEach(pe=>{const de=pe.dem.tree;ge[0]=Math.min(ge[0],de.minimums[0]),ge[1]=Math.max(ge[1],de.maximums[0])}),ge[0]!==1e4&&(q=(ge[1]-ge[0])*le.exaggeration())}const U=1.5*t.cameraToCenterDistance,G=3*U,J=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const ge=this._cascades[le];let pe=t.height/50,de=1;le===0?de=U:(pe=U,de=G);const[Ne,Ce]=Vd(t,this.shadowDirection,pe,de,Tc,q);ge.scale=t.scale,ge.matrix=Ne,ge.boundingSphereRadius=Ce,s.bl(J,ge.matrix),ge.frustum=s.cB.fromInvProjectionMatrix(J,1,0,!0),ge.far=de}const Y=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Y].far,this._cascades[Y].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Tc,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const te=p.transform.elevation;for(const le of this._groundShadowTiles){let ge={min:0,max:0};if(te){const pe=te.getMinMaxForTile(le);pe&&(ge=pe)}this.addShadowReceiver(le.toUnwrapped(),ge.min,ge.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,Tc,Tc]);for(let S=0;S<this._numCascadesToRender;++S){p.currentShadowCascade=S,x.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),x.clear({color:s.ao.white,depth:1});for(const T of t.order){const I=t._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const k=t.getLayerSourceCache(I),D=k?c[k.id]:void 0;(I.type==="model"||D&&D.length)&&p.renderLayer(p,k,I,D)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,c=t.style,p=t.context,x=p.gl,S=c.directionalLight,T=c.ambientLight;if(!S||!T)return;const I=[],k=Ha(t,t.longestCutoffRange);k.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const D=Vs(c,S,T),O=new _r(x.LEQUAL,_r.ReadOnly,t.depthRangeFor3D),q=new Xr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const U of this._groundShadowTiles){const G=U.toUnwrapped(),J=t.isTileAffectedByFog(U),Y=t.getOrCreateProgram("groundShadow",{defines:I,overrideFog:J});this.setupShadows(G,Y),t.uploadCommonUniforms(p,Y,G,null,k);const te=oa(t.transform.calculateProjMatrix(G),D);Y.draw(t,x.TRIANGLES,O,q,Jr.multiply,qr.disabled,te,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Jr.unblended:Jr.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(t){const c=this.painter.transform,p=c.calculatePosMatrix(t,c.worldSize);return s.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(t){const c=s.bz(t);return s.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,t),c}setupShadows(t,c,p){if(!this.enabled)return;const x=this.painter.transform,S=this.painter.context,T=S.gl,I=this._uniformValues,k=new Float64Array(16),D=x.calculatePosMatrix(t,x.worldSize);for(let O=0;O<this._cascades.length;O++)s.aB(k,this._cascades[O].matrix,D),I[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),S.activeTexture.set(T.TEXTURE0+11+O),this._cascades[O].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const O=s.d7(t.canonical),q=2/x.tileSize*s.al/Tc,U=q*this._cascades[0].boundingSphereRadius,G=q*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(p==="vector-tile"?1:3)*(function(Y){const te=s.aA((Y-22)/-22,0,1);return .125*(1-te)+4*te})(x.zoom);I.u_shadow_normal_offset=[O,U*J,G*J],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(S,I)}setupShadowsFromMatrix(t,c,p=!1){if(!this.enabled)return;const x=this.painter.context,S=x.gl,T=this._uniformValues,I=new Float64Array(16);for(let k=0;k<2;k++)s.aB(I,this._cascades[k].matrix,t),T[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(S.TEXTURE0+11+k),this._cascades[k].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);this.useNormalOffset=p,p?(T.u_shadow_normal_offset=[1,3,3],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,c,p,x){if(x[2]>=0)return{};const S=(function(k,D,O){const q=O/(1<<k.canonical.z);return new s.d9([k.canonical.x*q+k.wrap*O,k.canonical.y*q+k.wrap*O,0],[(k.canonical.x+1)*q+k.wrap*O,(k.canonical.y+1)*q+k.wrap*O,D])})(t,c,p).getCorners(),T=c/-x[2];x[0]<0?(s.d8(S[0],S[0],[x[0]*T,0,0]),s.d8(S[3],S[3],[x[0]*T,0,0])):x[0]>0&&(s.d8(S[1],S[1],[x[0]*T,0,0]),s.d8(S[2],S[2],[x[0]*T,0,0])),x[1]<0?(s.d8(S[0],S[0],[0,x[1]*T,0]),s.d8(S[1],S[1],[0,x[1]*T,0])):x[1]>0&&(s.d8(S[2],S[2],[0,x[1]*T,0]),s.d8(S[3],S[3],[0,x[1]*T,0]));const I={};return I.vertices=S,I.planes=[fp(S[1],S[0],S[4]),fp(S[2],S[1],S[5]),fp(S[3],S[2],S[6]),fp(S[0],S[3],S[7])],I}addShadowReceiver(t,c,p){this._receivers.add(t,s.d9.fromTileIdAndHeight(t,c,p))}getMaxCascadeForTile(t){const c=this._receivers.get(t);return c&&c.lastCascade?c.lastCascade:0}}function fp(f,t,c){const p=s.av([],c,t),x=s.av([],f,t),S=s.bI([],p,x),T=s.ag(S);return T===0?[0,0,1,0]:(s.c5(S,S,1/T),[S[0],S[1],S[2],-s.bJ(S,t)])}function Bg(f){const t=f.properties.get("direction"),c=s.d4(t.x,t.y,t.z);c[2]=s.aA(c[2],0,75);const p=s.d6([c[0],c[1],c[2]]);return s.d5(p.x,p.y,p.z)}function Vs(f,t,c){const p=t.properties.get("color-use-theme")==="none",x=t.properties.get("color"),S=t.properties.get("intensity"),T=t.properties.get("direction"),I=[T.x,T.y,T.z],k=c.properties.get("color-use-theme")==="none",D=c.properties.get("color"),O=c.properties.get("intensity"),q=Math.max(s.bJ([0,0,1],I),0),U=[0,0,0];s.c5(U,D.toPremultipliedRenderColor(k?null:f.getLut(t.scope)).toArray01Linear().slice(0,3),O);const G=[0,0,0];return s.c5(G,x.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),q*S),s.db([U[0]>0?U[0]/(U[0]+G[0]):0,U[1]>0?U[1]/(U[1]+G[1]):0,U[2]>0?U[2]/(U[2]+G[2]):0])}function Vd(f,t,c,p,x,S){const T=f.zoom,I=f.scale,k=f.worldSize,D=1/k,O=f.aspect,q=Math.sqrt(1+O*O)*Math.tan(.5*f.fovX),U=q*q,G=p-c,J=p+c;let Y,te;U>G/J?(Y=p,te=p*q):(Y=.5*J*(1+U),te=.5*Math.sqrt(G*G+2*(p*p+c*c)*U+J*J*U*U));const le=f.projection.pixelsPerMeter(f.center.lat,k),ge=f._camera.getCameraToWorldMercator(),pe=[0,0,-Y*D];s.af(pe,pe,ge);let de=te*D;const Ne=function(yt){return yt[0]/=I,yt[1]/=I,yt[2]=s.cf(yt[2],f._center.lat),yt},Ce=f._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const yt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?le:1),Dt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);Dt[8]=2*-f.centerOffset.x/f.width,Dt[9]=2*f.centerOffset.y/f.height;const Kt=new Float64Array(16);s.cP(Kt,Dt,yt);const Ot=new Float64Array(16);s.bl(Ot,Kt);const Ft=s.cB.fromInvProjectionMatrix(Ot,k,T,!0);for(const gr of Ft.points){const fr=Ne(gr);de=Math.max(de,s.c6(s.da([],pe,fr)))}}de*=x/(x-1);const ke=Math.acos(t[2]),Te=Math.atan2(-t[0],-t[1]),_e=new Bd;_e.position=pe,_e.setPitchBearing(ke,Te);const Me=_e.getWorldToCamera(k,le),Ue=de*k,Ge=Math.min(f._mercatorZfromZoom(17)*k*-2,-2*Ue),it=_e.getCameraToClipOrthographic(-Ue,Ue,-Ue,Ue,Ge,(Ue+S*le)/t[2]),tt=new Float64Array(16);s.aB(tt,it,Me);const mt=s.d5(Math.floor(1e6*pe[0])/1e6*k,Math.floor(1e6*pe[1])/1e6*k,0),Pt=.5*x,Qe=[0,0,0];s.af(Qe,mt,tt),s.c5(Qe,Qe,Pt);const Le=[Math.floor(Qe[0]),Math.floor(Qe[1]),Math.floor(Qe[2])],dt=[0,0,0];s.av(dt,Qe,Le),s.c5(dt,dt,-1/Pt);const nt=new Float64Array(16);return s.bA(nt),s.br(nt,nt,dt),s.aB(tt,nt,tt),[tt,Ue]}class tf extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,c){return s.dc(this.requestManager.transformRequest(c,s.R.Model).url).then(p=>{if(!p)return;const x=s.dd(p),S=new s.de(t,c,void 0,void 0,x);return S.computeBoundsAndApplyParent(),S}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${c}: ${p.message}`)))})}load(t,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(t),S=[],T=[];for(const I of x){const k=t[I];this.hasURLBeenRequested(k)&&!p.forceReload||(this.modelByURL[k]={modelId:I,scope:c},S.push(this.loadModel(I,k)),T.push(I)),this.models[c][I]||(this.models[c][I]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+T.length,Promise.allSettled(S).then(I=>{for(let k=0;k<I.length;k++){const{status:D}=I[k];if(D==="rejected")continue;const{value:O}=I[k];this.models[c][T[k]]||(this.models[c][T[k]]={model:null,numReferences:1}),this.models[c][T[k]].model=O}this.numModelsLoading[c]-=T.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(t,c):this.getModelByURL(this.modelUris[c][t]))}getModel(t,c){return this.models[c]||(this.models[c]={}),this.models[c][t]?this.models[c][t].model:void 0}getModelByURL(t){if(!t)return null;const c=this.modelByURL[t];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(t,c){return this.models[c]&&this.models[c][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(t,p,{exactIdMatch:!0})||this.hasModelBeenAdded(t,p))&&this.modelUris[p][t]===x)this.models[p][t].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:S,modelId:T}=this.modelByURL[x];this.models[S][T].numReferences++}else this.modelUris[p][t]=x,this.load({[t]:this.modelUris[p][t]},p)}addModelURLs(t,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in t)p[x]=this.requestManager.normalizeModelURL(t[x])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of t)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&s.df(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,c,p=!1,x=!1){if(this.models[c]&&this.models[c][t]&&(this.models[c][t].numReferences--,this.models[c][t].numReferences===0||x)){const S=this.modelUris[c][t];p||delete this.modelUris[c][t],delete this.modelByURL[S];const T=this.models[c][t].model;if(!T)return;delete this.models[c][t],T.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const c of Object.keys(this.models[t])){const p=this.models[t][c].model;delete this.models[t][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(t.context)}}const Ud=s.a6.colorTheme,Ec=new s.a9({data:new s.aa(Ud.data)});function Vg(f){if(!f.metadata||!f.metadata.content_area)return;const t=s.o.devicePixelRatio,{left:c,top:p,width:x,height:S}=f.metadata.content_area,T=c*t,I=p*t;return[T,I,T+x*t,I+S*t]}function pp(f){if(f)return f.map(([t,c])=>[t*s.o.devicePixelRatio,c*s.o.devicePixelRatio])}class E_{constructor(t,c,p){this.id=t,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return t;const p=this.sourceCache.getSource();if(!(p instanceof ot))return t;const x=c.map(T=>this.sourceCache.getTile(T)),S=p.getImages(x,Array.from(this.pendingRequests));for(const[T,I]of S)t.set(s.I.from({name:T,iconsetId:this.id}),I),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),t}}class Pm{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(t,c){const p=se("button",t,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,c){this._map&&(t.setAttribute("aria-label",c),t.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const c=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(p=>p.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});se("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,c){for(let p=0;p<t.length;p++){const x=t[p],S=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(x.id)}),T=(x.name||"").trim(),I=x.zIndex.toString(),k=T?Array.from(T).slice(0,3).join(""):I;this._setButtonTitle(S,k),this._model&&x.id===this._model.selectedFloorId&&c&&S.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(S),p<t.length-1&&this._createSeparator()}}}class $d extends s.E{constructor(t){super(),this._style=t,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[c,p]of Object.entries(t.buildings))if(this._buildings[c])for(const x of p.floorIds)this._buildings[c].floors[x]||(this._buildings[c].floors[x]=p.floors[x]);else this._buildings[c]=p;for(const c of t.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(t,c){const p=this._style.getIndoorSourceLayers(t,c);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Pm,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const t=this._style.map.transform,c=(function(p,x,S,T){let I=null,k=Number.MAX_SAFE_INTEGER;if(T<16)return null;for(const[D,O]of Object.entries(p)){const q=O.center;if(q){const U=x.distanceTo(s.aT.convert(q));U<k&&S.contains(q)&&(k=U,I=D)}}return I})(this._buildings,t.center,t.getBounds(),t.zoom);c!==this._closestBuildingId&&(this._closestBuildingId=c,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,c=this._closestBuildingId,p=c&&t?t[c]:void 0;if(!p)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let x=null;for(const T of p.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){x=T;break}const S=Array.from(p.floorIds).map(T=>({id:T,name:p.floors[T].name,zIndex:p.floors[T].zIndex})).sort((T,I)=>I.zIndex-T.zIndex).filter((T,I,k)=>I===0||T.zIndex!==k[I-1].zIndex);this.fire(new s.z("selector-update",{selectedFloorId:x,activeFloorsVisible:this._activeFloorsVisible,floors:S}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const Nl=(f,t)=>Fe(f,t&&t.filter(c=>c.identifier!=="source.canvas")),qd=s.aH(Dn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),mp=s.aH(Dn,["setCenter","setZoom","setBearing","setPitch"]),rf=new Set(["background","sky","slot","custom"]),Gd={version:8,layers:[],sources:{}},Za={duration:300,delay:0};class aa extends s.E{constructor(t,c={}){super(),this.map=t,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Za),this._buildingIndex=new Uh(this),this.crossTileSymbolIndex=new Ms,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Dr,this._hasDataDrivenEmissive=!1,this.indoorManager=new $d(this),this.dispatcher=c.dispatcher?c.dispatcher:new s.D(s.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Ke(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new s.di(t._requestManager,c.localFontFamily?s.dj.all:c.localIdeographFontFamily?s.dj.ideographs:s.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new tf(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const p=this;this._rtlTextPluginCallback=aa.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,T)=>{if(s.dl(S),T&&T.every(I=>I))for(const I in p._sourceCaches){const k=p._sourceCaches[I],D=k.getSource().type;D!=="vector"&&D!=="geojson"||k.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const S=this.getOwnSource(x.sourceId);if(S&&S.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===S.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.h(t))return t;const c=s.dm(t);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${s.dn(JSON.stringify(t))}`}_diffStyle(t,c,p){this.globalId=this._getGlobalId(t);const x=(S,T)=>{try{T(null,this.setState(S,p))}catch(I){T(I,!1)}};if(typeof t=="string"){const S=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(S,s.R.Style);s.m(T,(I,k)=>{I?this.fire(new s.y(I)):k&&x(k,c)})}else typeof t=="object"&&x(t,c)}loadURL(t,c={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!s.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,c.accessToken),this.resolvedImports.add(t);const x=this.importsCache.get(t);if(x)return this._load(x,p);const S=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.m(S,(T,I)=>{if(this._request=null,T)this.fire(new s.y(T));else if(I)return this.importsCache.set(t,I),this._load(I,p)})}loadJSON(t,c={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.o.frame(()=>{this._request=null,this._load(t,c.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Gd,!1)}_loadImports(t,c,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const S of t){const T=this._createFragmentStyle(S),I=new Promise(O=>{T.once("style.import.load",O),T.once("error",O)}).then(()=>this.mergeAll());if(x.push(I),this.resolvedImports.has(S.url)){T.loadEmpty();continue}const k=S.data||this.importsCache.get(S.url);k?(T.loadJSON(k,{validate:c}),this._isInternalStyle(k)&&(T.globalId=null)):S.url?T.loadURL(S.url,{validate:c}):T.loadEmpty();const D={style:T,id:S.id,config:S.config};if(p){const O=this.fragments.findIndex(({id:q})=>q===p);this.fragments=this.fragments.slice(0,O).concat(D).concat(this.fragments.slice(O))}else this.fragments.push(D)}return Promise.allSettled(x)}getImportGlobalIds(t=this,c=new Set){for(const p of t.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(t){const c=this.scope?s.B(t.id,this.scope):t.id;let p;const x=this._initialConfig&&this._initialConfig[c];(t.config||x)&&(p=Object.assign({},t.config,x));const S=new aa(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return S.setEventedParent(this.map,{style:S}),S}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,c){if(this._isInternalStyle(t)){const S=Object.assign({},Gd,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(S,c)}if(this.updateConfig(this._config,t.schema),c&&Nl(this,Is(t)))return;this._loaded=!0,this.stylesheet=s.dp(t);const p=()=>{for(const k in t.sources)this.addSource(k,t.sources[k],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const k in t.iconsets)this.addIconset(k,t.iconsets[k]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const S=Du(this.stylesheet.layers);if(this._order=S.map(k=>k.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const k=this.stylesheet.lights[0];this.light=new fe(k.properties,k.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new fe(this.stylesheet.light)),this._layers={};for(const k of S){const D=s.du(k,this.scope,this._styleColorTheme.lut,this.options);D.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(D.fqid),this._hasAppearances=this._hasAppearances||D.getAppearances().length!==0,D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const O=this.getOwnLayerSourceCache(D),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&D.canCastShadows()&&q&&(O.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();t.imports?this._loadImports(t.imports,c).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(k=>{this.fire(new s.y(new Error("Failed to load imports",k))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{p()}).catch(T=>{s.w(`Couldn't load color theme from the stylesheet: ${T}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(t=>t.style.hasAppearances())}mergeAll(){let t,c,p,x,S,T,I,k,D,O;const q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(t=U.light),U.stylesheet.lights)for(const G of U.stylesheet.lights)G.type==="ambient"&&U.ambientLight!=null&&(c=U.ambientLight),G.type==="directional"&&U.directionalLight!=null&&(p=U.directionalLight);x=this._prioritizeTerrain(x,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(S=U.fog),U.stylesheet.snow&&U.snow!=null&&(T=U.snow),U.stylesheet.rain&&U.rain!=null&&(I=U.rain),U.stylesheet.camera!=null&&(O=U.stylesheet.camera),U.stylesheet.projection!=null&&(k=U.stylesheet.projection),U.stylesheet.transition!=null&&(D=U.stylesheet.transition),q[U.scope]=U._styleColorTheme}}),this.light=t,this.ambientLight=c,this.directionalLight=p,this.fog=S,this.snow=T,this.rain=I,this._styleColorThemeForScope=q,x===null?delete this.terrain:this.terrain=x,this.camera=O||{"camera-projection":"perspective"},this.projection=k||{name:"mercator"},this.transition=Object.assign({},Za,D),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const c=p=>{for(const x of p.fragments)c(x.style);t(p)};c(this)}_prioritizeTerrain(t,c,p){const x=t&&t.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?t:null:c!=null&&(!t||x||c&&c.drapeRenderMode===1)?c:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{t=this._prioritizeTerrain(t,c.terrain,c.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(t=c.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},c={},p={};this.forEachFragmentStyle(x=>{for(const S in x._sourceCaches){const T=s.B(S,x.scope);t[T]=x._sourceCaches[S]}for(const S in x._otherSourceCaches){const T=s.B(S,x.scope);c[T]=x._otherSourceCaches[S]}for(const S in x._symbolSourceCaches){const T=s.B(S,x.scope);p[T]=x._symbolSourceCaches[S]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const c of Object.values(t.stylesheet.indoor)){const p=c,x=s.B(p.sourceId,t.scope);this._mergedIndoor[x]=new Set(p.sourceLayers||[])}})}mergeLayers(){const t={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const I of T._order){const k=T._layers[I];if(k.type==="slot"){const D=s.dq(I);if(t[D])continue;t[D]=[]}k.slot&&t[k.slot]?t[k.slot].push(k):c.push(k)}}),this._mergedOrder=[];let x=-1;const S=(T=[])=>{for(const I of T)if(I.type==="slot"){const k=s.dq(I.id);t[k]&&S(t[k]),this._mergedSlots.push(k)}else{const k=s.B(I.id,I.scope);this._mergedOrder.push(k),p[k]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(S(c),this._has3DLayers){const T={};for(let I=0;I<this._mergedOrder.length;++I){const k=this._mergedOrder[I];T[k]=I===x?1:I<x?p[k].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,k)=>T[I]-T[k])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(c,p,x){const S=Object.assign({},p);for(const I of Object.keys(Ud))S[I]===void 0&&(S[I]=Ud[I].default);const T=new s.a8(Ec,c,new Map(x));return T.setTransitionOrValue(S,x),T.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,x)=>{const S="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=t;T.startsWith(S)||(T=S+T);const I=s.I.from("mapbox-reserved-lut"),k=new Image;k.src=T,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:D,height:O,data:q}=s.o.getImageData(k);if(O>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==O*O)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:D,height:O},q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const U=this.imageManager.getImage(I,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:t},p()):x(new Error("Missing LUT image."))}})}getLut(t){const c=this._styleColorThemeForScope[t];return c?c.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(c,p,x){let S,T,I;const k=s.o.devicePixelRatio>1?"@2x":"";let D=s.m(p.transformRequest(p.normalizeSpriteURL(c,k,".json"),s.R.SpriteJSON),(U,G)=>{D=null,I||(I=U,S=G,q())}),O=s.n(p.transformRequest(p.normalizeSpriteURL(c,k,".png"),s.R.SpriteImage),(U,G)=>{O=null,I||(I=U,T=G,q())});function q(){if(I)x(I);else if(S&&T){const U=s.o.getImageData(T),G={};for(const J in S){const{width:Y,height:te,x:le,y:ge,sdf:pe,pixelRatio:de,stretchX:Ne,stretchY:Ce,content:ke}=S[J],Te=new s.q({width:Y,height:te});s.q.copy(U,Te,{x:le,y:ge},{x:0,y:0},{width:Y,height:te},null),G[J]={data:Te,pixelRatio:de!==void 0?de:1,sdf:pe!==void 0&&pe,stretchX:Ne,stretchY:Ce,content:ke,usvg:!1,version:0}}x(null,G)}}return{cancel(){D&&(D.cancel(),D=null),O&&(O.cancel(),O=null)}}})(t,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new s.y(c));else if(p){const x=new Map;for(const S in p)x.set(s.I.from(S),p[S]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(t,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new s.y(new Error(`Source "${c.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${c.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const S=new E_(t,this.scope,p);this.imageManager.addImageProvider(S,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(S,T)=>{if(this._spriteRequest=null,S)c?this._loadSprite(t):this.fire(new s.y(S));else if(T){const I=new Map;for(const k in T)I.set(s.I.from(k),T[k]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(t),s.R.Iconset),(S,T)=>{if(S)return void x(S);const I={},k=s.dg(new s.bt(T));for(const D of k.icons){const O={version:1,pixelRatio:s.o.devicePixelRatio,content:Vg(D),stretchX:D.metadata?pp(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?pp(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};I[D.name]=O}x(null,I)}))}_validateLayer(t){const c=this.getOwnSource(t.source);if(!c)return;const p=t.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,c)=>{const p=this.fragments[c];return p&&p.style&&(t.data=p.style.serialize()),t})}_serializeSources(){const t={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();t[p.id]||(t[p.id]=p.serialize())}return t}_serializeLayers(t){const c=[];for(const p of t){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const c=this._mergedLayers[t];if(c._transitionablePaint&&c._transitionablePaint._values){const p=c._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const c=this.getOwnLayer(t);if(c)return c;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const c=this.getOwnSource(t);if(c)return c;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,c){const p=this.map.painter;if(p)for(let x=t.minzoom||0;x<(t.maxzoom||25.5);x++){const S=t.getProgramIds();if(S)for(const T of S){const I=t.getDefaultProgramParams(T,c.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(T,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(T,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(T,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const c=this.calculateLightsBrightness();t.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const k in I){const{updatedIds:D,removedIds:O}=I[k];(D||O)&&(this._updateWorkerLayers(k,D,O),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const S={};for(const I in this._mergedSourceCaches){const k=this._mergedSourceCaches[I];S[I]=k.used,k.used=!1,k.tileCoverLift=0}for(const I of this._mergedOrder){const k=this._mergedLayers[I];if(k.visibility!=="none"&&k.recalculate(t,this._availableImages),!k.isHidden(t.zoom)){const D=this.getLayerSourceCache(k);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,t)}):this.precompilePrograms(k,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const I of T)I.sourceCache.used=!0;for(const I in S){const k=this._mergedSourceCaches[I];S[I]!==k.used&&k.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const c of t){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const t={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;t[p]=t[p]||this._changes.getUpdatedImages(p),t[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],t[p])}for(const c in t)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(t,c,p){const x=this.getFragmentStyle(t);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:t,removedIds:p||[],options:x.options})}setState(t,c){if(this._checkLoaded(),Nl(this,Is(t)))return!1;(t=s.dp(t)).layers=Du(t.layers);const p=(function(T,I){if(!T)return[{command:Dn.setStyle,args:[I]}];let k=[];try{if(!s.by(T.version,I.version))return[{command:Dn.setStyle,args:[I]}];if(s.by(T.center,I.center)||k.push({command:Dn.setCenter,args:[I.center]}),s.by(T.zoom,I.zoom)||k.push({command:Dn.setZoom,args:[I.zoom]}),s.by(T.bearing,I.bearing)||k.push({command:Dn.setBearing,args:[I.bearing]}),s.by(T.pitch,I.pitch)||k.push({command:Dn.setPitch,args:[I.pitch]}),s.by(T.sprite,I.sprite)||k.push({command:Dn.setSprite,args:[I.sprite]}),s.by(T.glyphs,I.glyphs)||k.push({command:Dn.setGlyphs,args:[I.glyphs]}),s.by(T.imports,I.imports)||(function(G=[],J=[],Y){J=J||[];const te=(G=G||[]).map(ec),le=J.map(ec),ge=G.reduce(Md,{}),pe=J.reduce(Md,{}),de=te.slice();let Ne,Ce,ke,Te;for(Ne=0,Ce=0;Ne<te.length;Ne++)ke=te[Ne],pe.hasOwnProperty(ke)?Ce++:(Y.push({command:Dn.removeImport,args:[ke]}),de.splice(de.indexOf(ke,Ce),1));for(Ne=0,Ce=0;Ne<le.length;Ne++)ke=le[le.length-1-Ne],de[de.length-1-Ne]!==ke&&(ge.hasOwnProperty(ke)?(Y.push({command:Dn.removeImport,args:[ke]}),de.splice(de.lastIndexOf(ke,de.length-Ce),1)):Ce++,Te=de[de.length-Ne],Y.push({command:Dn.addImport,args:[pe[ke],Te]}),de.splice(de.length-Ne,0,ke));for(const _e of J){const Me=ge[_e.id];Me&&(delete Me.data,s.by(Me,_e)||Y.push({command:Dn.updateImport,args:[_e.id,_e]}))}})(T.imports,I.imports,k),s.by(T.transition,I.transition)||k.push({command:Dn.setTransition,args:[I.transition]}),s.by(T.light,I.light)||k.push({command:Dn.setLight,args:[I.light]}),s.by(T.fog,I.fog)||k.push({command:Dn.setFog,args:[I.fog]}),s.by(T.snow,I.snow)||k.push({command:Dn.setSnow,args:[I.snow]}),s.by(T.rain,I.rain)||k.push({command:Dn.setRain,args:[I.rain]}),s.by(T.projection,I.projection)||k.push({command:Dn.setProjection,args:[I.projection]}),s.by(T.lights,I.lights)||k.push({command:Dn.setLights,args:[I.lights]}),s.by(T.camera,I.camera)||k.push({command:Dn.setCamera,args:[I.camera]}),s.by(T.iconsets,I.iconsets)||(function(G,J,Y){let te;for(te in J=J||{},G=G||{})G.hasOwnProperty(te)&&(J.hasOwnProperty(te)||Y.push({command:Dn.removeIconset,args:[te]}));for(te in J){if(!J.hasOwnProperty(te))continue;const le=J[te];G.hasOwnProperty(te)?s.by(G[te],le)||(Y.push({command:Dn.removeIconset,args:[te]}),Y.push({command:Dn.addIconset,args:[te,le]})):Y.push({command:Dn.addIconset,args:[te,le]})}})(T.iconsets,I.iconsets,k),!s.by(T["color-theme"],I["color-theme"]))return[{command:Dn.setStyle,args:[I]}];const D={},O=[];(function(G,J,Y,te){let le;for(le in J=J||{},G=G||{})G.hasOwnProperty(le)&&(J.hasOwnProperty(le)||op(le,Y,te));for(le in J){if(!J.hasOwnProperty(le))continue;const ge=J[le];G.hasOwnProperty(le)?s.by(G[le],ge)||(G[le].type==="geojson"&&ge.type==="geojson"&&ap(G,J,le)?Y.push({command:Dn.setGeoJSONSourceData,args:[le,ge.data]}):zg(le,J,Y,te)):bc(le,J,Y)}})(T.sources,I.sources,O,D);const q=[];T.layers&&T.layers.forEach(G=>{G.source&&D[G.source]?k.push({command:Dn.removeLayer,args:[G.id]}):q.push(G)});let U=T.terrain;U&&D[U.source]&&(k.push({command:Dn.setTerrain,args:[void 0]}),U=void 0),k=k.concat(O),s.by(U,I.terrain)||k.push({command:Dn.setTerrain,args:[I.terrain]}),(function(G,J,Y){J=J||[];const te=(G=G||[]).map(ec),le=J.map(ec),ge=G.reduce(Md,{}),pe=J.reduce(Md,{}),de=te.slice(),Ne=Object.create(null);let Ce,ke,Te,_e,Me,Ue,Ge;for(Ce=0,ke=0;Ce<te.length;Ce++)Te=te[Ce],pe.hasOwnProperty(Te)?ke++:(Y.push({command:Dn.removeLayer,args:[Te]}),de.splice(de.indexOf(Te,ke),1));for(Ce=0,ke=0;Ce<le.length;Ce++)Te=le[le.length-1-Ce],de[de.length-1-Ce]!==Te&&(ge.hasOwnProperty(Te)?(Y.push({command:Dn.removeLayer,args:[Te]}),de.splice(de.lastIndexOf(Te,de.length-ke),1)):ke++,Ue=de[de.length-Ce],Y.push({command:Dn.addLayer,args:[pe[Te],Ue]}),de.splice(de.length-Ce,0,Te),Ne[Te]=!0);for(Ce=0;Ce<le.length;Ce++)if(Te=le[Ce],_e=ge[Te],Me=pe[Te],!Ne[Te]&&!s.by(_e,Me))if(s.by(_e.source,Me.source)&&s.by(_e["source-layer"],Me["source-layer"])&&s.by(_e.type,Me.type)){for(Ge in ru(_e.layout,Me.layout,Y,Te,null,Dn.setLayoutProperty),ru(_e.paint,Me.paint,Y,Te,null,Dn.setPaintProperty),s.by(_e.slot,Me.slot)||Y.push({command:Dn.setSlot,args:[Te,Me.slot]}),s.by(_e.filter,Me.filter)||Y.push({command:Dn.setFilter,args:[Te,Me.filter]}),s.by(_e.minzoom,Me.minzoom)&&s.by(_e.maxzoom,Me.maxzoom)||Y.push({command:Dn.setLayerZoomRange,args:[Te,Me.minzoom,Me.maxzoom]}),_e)_e.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?ru(_e[Ge],Me[Ge],Y,Te,Ge.slice(6),Dn.setPaintProperty):s.by(_e[Ge],Me[Ge])||Y.push({command:Dn.setLayerProperty,args:[Te,Ge,Me[Ge]]}));for(Ge in Me)Me.hasOwnProperty(Ge)&&!_e.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?ru(_e[Ge],Me[Ge],Y,Te,Ge.slice(6),Dn.setPaintProperty):s.by(_e[Ge],Me[Ge])||Y.push({command:Dn.setLayerProperty,args:[Te,Ge,Me[Ge]]}))}else Y.push({command:Dn.removeLayer,args:[Te]}),Ue=de[de.lastIndexOf(Te)+1],Y.push({command:Dn.addLayer,args:[Me,Ue]})})(q,I.layers,k)}catch(D){console.warn("Unable to compute style diff:",D),k=[{command:Dn.setStyle,args:[I]}]}return k})(this.serialize(),t).filter(T=>!(T.command in mp));if(p.length===0)return!1;const x=p.filter(T=>!(T.command in qd));if(x.length>0)throw new Error(`Unimplemented: ${x.map(T=>T.command).join(", ")}.`);const S=[];return p.forEach(T=>{S.push(this[T.command](...T.args))}),c&&Promise.all(S).then(c).catch(c),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[c,p]of t.entries()){if(this.getImage(c))return this.fire(new s.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(t,c){return this.getImage(t)?this.fire(new s.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,c),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(t,c,p=!1){this.imageManager.updateImage(t,this.scope,c),p&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(t,c,p={}){return this._checkLoaded(),this._validate(De,`models.${t}`,c,null,p)||(this.modelManager.addModel(t,c,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,c,p={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(ao,`sources.${t}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=pn(t,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const S=T=>{const I=(T?"symbol:":"other:")+x.id,k=s.B(I,this.scope),D=this._sourceCaches[I]=new qo(k,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=D,D.onAdd(this.map)};S(!1),c.type!=="vector"&&c.type!=="geojson"||S(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const c=this.getOwnSource(t);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([S,T])=>T.type==="source"&&T.source===t);if(x)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(t);for(const x of p){const S=s.dq(x.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,c){this._checkLoaded(),this.getOwnSource(t).setData(c),this._changes.setDirty()}getOwnSource(t){const c=this.getOwnSourceCache(t);return c&&c.getSource()}getOwnSources(){const t=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&t.push(p.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const c in t){const p=t[c]._tiles;for(const x in p){const S=p[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const S of t){if(this._validate(Nt,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(S),T.updateTransitions(c)}else this.ambientLight=new gn(S,Ni(),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(S),T.updateTransitions(c)}else this.directionalLight=new gn(S,di(),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new s.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,c=this.ambientLight;if(!t||!c)return;const p=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),x=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),S=t.properties.get("intensity"),T=t.properties.get("direction"),I=1-s.d4(T.x,T.y,T.z)[2]/90,k=p(x)*S*I,D=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),O=c.properties.get("intensity"),q=p(D)*O;return Number(((k+q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dr(t)){const c=s.ds(t),p=this.fragments.find(({id:S})=>S===c);if(!p)return;const x=s.dq(t);return p.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:p})=>p===t);return c?c.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const c={},p=(x,S="")=>`${x}::${S}`;this._featuresetSelectors={};for(const x in t){const S=this._featuresetSelectors[x]=[];for(const T of t[x].selectors){if(T.featureNamespace){const k=this.getOwnLayer(T.layer);if(!k){s.w(`Layer is undefined for selector: ${T.layer}`);continue}const D=p(k.source,k.sourceLayer);if(D in c&&c[D]!==T.featureNamespace){s.w(`"featureNamespace ${T.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[D]=T.featureNamespace}let I;if(T.properties)for(const k in T.properties){const D=s.U(T.properties[k]);D.result==="success"&&(I=I||{},I[k]=D.value)}S.push({layerId:T.layer,namespace:T.featureNamespace,properties:I,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const c=this.getFragmentStyle(t);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(t,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const S=[];for(const T of x[t].selectors){const I=p.getOwnLayer(T.layer);I&&S.push(I)}return S}getConfigProperty(t,c){const p=this.getFragmentStyle(t);if(!p)return null;const x=s.B(c,p.scope),S=p.options.get(x),T=S?S.value||S.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,c){const p=s.B(t,c);return this._mergedIndoor[p]}setIndoorData(t,c){this.indoorManager.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,c,p){const x=this.getFragmentStyle(t);if(!x)return;const S=x.stylesheet.schema;if(!S||!S[c])return;const T=s.U(p);if(T.result!=="success")return void Nl(this,T.value);const I=T.value.expression,k=s.B(c,x.scope),D=x.options.get(k);if(!D)return;let O;const{minValue:q,maxValue:U,stepValue:G,type:J,values:Y}=S[c],te=s.U(S[c].default);te.result==="success"&&(O=te.value.expression),O?(this.options.set(k,Object.assign({},D,{value:I,default:O,minValue:q,maxValue:U,stepValue:G,type:J,values:Y})),this.updateConfigDependencies(c)):this.fire(new s.y(new Error(`No schema defined for the config option "${c}" in the "${t}" fragment.`)))}getConfig(t){const c=this.getFragmentStyle(t);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const S in p){const T=s.B(S,c.scope),I=c.options.get(T),k=I?I.value||I.default:null;x[S]=k?k.serialize():null}return x}setConfig(t,c){const p=this.getFragmentStyle(t);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const c=this.getFragmentStyle(t);return c?c.stylesheet.schema:null}setSchema(t,c){const p=this.getFragmentStyle(t);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(t,c){if(this._config=t,t||c)if(c)for(const p in c){let x,S;const T=s.U(c[p].default);if(T.result==="success"&&(x=T.value.expression),t&&t[p]!==void 0){const U=s.U(t[p]);U.result==="success"&&(S=U.value.expression)}const{minValue:I,maxValue:k,stepValue:D,type:O,values:q}=c[p];if(x){const U=s.B(p,this.scope);this.options.set(U,{default:x,value:S,minValue:I,maxValue:k,stepValue:D,type:O,values:q})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,c=()=>!0){for(const p of t){const x=this.getLayer(p);x&&c(x)&&(x.possiblyEvaluateVisibility(),this._updateLayer(x),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,c=>!t||c.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(t,c,p={}){this._checkLoaded();const x=t.id;if(this._layers[x])return void this.fire(new s.y(new Error(`Layer with id "${x}" already exists on this map`)));let S;if(t.type==="custom"){if(Nl(this,s.dt(t)))return;S=s.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(x,t.source),t=s.dp(t),t=Object.assign(t,{source:x})),this._validate($e,`layers.${x}`,t,{arrayIndex:-1},p))return;S=s.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}const T=s.B(S.source,S.scope);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let I=this._order.length;if(c){const q=this._order.indexOf(c);if(q===-1)return void this.fire(new s.y(new Error(`Layer with id "${c}" does not exist on this map.`)));S.slot&&S.slot!==this._layers[c].slot?s.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):I=q}this._order.splice(I,0,x),this._handleLayerOrderChange(),this._layers[x]=S;const k=this.getOwnLayerSourceCache(S),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&S.canCastShadows()&&D&&(k.castsShadows=!0);const O=this._changes.getRemovedLayer(S);if(O&&S.source&&k&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const q=s.B(S.source,S.scope);O.type!==S.type?this._changes.updateSourceCache(q,"clear"):(this._changes.updateSourceCache(q,"reload"),k.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(t,c){this._checkLoaded();const p=this._checkLayer(t);if(!p||t===c)return;const x=this._order.indexOf(t);this._order.splice(x,1);let S=this._order.length;if(c){const T=this._order.indexOf(c);if(T===-1)return void this.fire(new s.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot&&p.slot!==this._layers[c].slot?s.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`):S=T}this._order.splice(S,0,t),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(t){this._checkLoaded();const c=this._checkLayer(t);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),delete this._layers[t],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let S=!1;for(const T in this._layers)if(this._layers[T].source===c.source&&this._layers[T].canCastShadows()){S=!0;break}x.castsShadows=S}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const c in this._layers)if(this._layers[c].type===t)return!0;return!1}setLayerZoomRange(t,c,p){this._checkLoaded();const x=this._checkLayer(t);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,c){this._checkLoaded();const p=this._checkLayer(t);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(t,c,p={}){this._checkLoaded();const x=this._checkLayer(t);if(x&&!s.by(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ne,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=s.dp(c),this._updateLayer(x)))}getFilter(t){const c=this._checkLayer(t);if(c)return s.dp(c.filter)}setLayoutProperty(t,c,p,x={}){this._checkLoaded();const S=this._checkLayer(t);if(S&&!s.by(S.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&Nl(S,be.call(Is,{key:`layers.${t}.layout.${c}`,layerType:S.type,objectKey:c,value:p,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(c,p),S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),this._updateLayer(S)}}setLayerProperty(t,c,p,x={}){this._checkLoaded();const S=this._checkLayer(t);S&&(c==="appearances"?(S.setAppearances(p),this._changes.setDirty()):S.isPaintProperty(c)?this.setPaintProperty(t,c,p,x):this.setLayoutProperty(t,c,p,x))}getLayoutProperty(t,c){const p=this._checkLayer(t);if(p)return p.getLayoutProperty(c)}setPaintProperty(t,c,p,x={}){this._checkLoaded();const S=this._checkLayer(t);if(!S||s.by(S.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&Nl(S,ce.call(Is,{key:`layers.${t}.paint.${c}`,layerType:S.type,objectKey:c,value:p,styleSpec:s.a6})))return;const T=S.setPaintProperty(c,p);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),T&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(t,c){const p=this._checkLayer(t);if(p)return p.getPaintProperty(c)}setFeatureState(t,c){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:k,importId:D}=t.target,O=this.getFragmentStyle(D),q=O.getFeaturesetLayers(k);for(const{source:U,sourceLayer:G}of q)O.setFeatureState({id:t.id,source:U,sourceLayer:G},c)}else if("layerId"in t.target){const{layerId:k}=t.target,D=this.getLayer(k);this.setFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},c)}return}const p=t.source,x=t.sourceLayer,S=this._checkSource(p);if(!S)return;const T=S.type;if(T==="geojson"&&x)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const k of I)k.setFeatureState(x,t.id,c)}removeFeatureState(t,c){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:k,importId:D}=t.target,O=this.getFragmentStyle(D),q=O.getFeaturesetLayers(k);for(const{source:U,sourceLayer:G}of q)O.removeFeatureState({id:t.id,source:U,sourceLayer:G},c)}else if("layerId"in t.target){const{layerId:k}=t.target,D=this.getLayer(k);this.removeFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},c)}return}const p=t.source,x=this._checkSource(p);if(!x)return;const S=x.type,T=S==="vector"?t.sourceLayer:void 0;if(S==="vector"&&!T)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const k of I)k.removeFeatureState(T,t.id,c)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let S;if("featuresetId"in t.target){const{featuresetId:T,importId:I}=t.target,k=this.getFragmentStyle(I),D=k.getFeaturesetLayers(T);for(const{source:O,sourceLayer:q}of D){const U=k.getFeatureState({id:t.id,source:O,sourceLayer:q});if(U&&!S)S=U;else if(!s.by(S,U))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,I=this.getLayer(T);S=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return S}const c=t.source,p=t.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),c=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(t){for(const c of Object.values(this._mergedLayers))t(c)&&this._updateLayer(c)}_updateLayer(t){this._changes.updateLayer(t);const c=this.getLayerSourceCache(t),p=s.B(t.source,t.scope),x=this._changes.getUpdatedSourceCaches();t.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const c=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,x={},S=[];for(let I=p.length-1;I>=0;I--){const k=p[I];if(c(k)){x[k]=I;for(const D of t){const O=D[k];if(O)for(const q of O)S.push(q)}}}S.sort((I,k)=>k.intersectionZ-I.intersectionZ);const T=[];for(let I=p.length-1;I>=0;I--){const k=p[I];if(c(k))for(let D=S.length-1;D>=0;D--){const O=S[D].feature;if(O.layer&&x[O.layer.id]<I)break;T.push(O),S.pop()}else for(const D of t){const O=D[k];if(O)for(const q of O)T.push(q.feature)}}return T}queryRasterValue(t,c,p){const x=this.getOwnSource(t);return x?x.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(c,p):(this.fire(new s.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),x=s.b6(c.filter));const S={},T=O=>{if(rf.has(O.type))return;const q=this.getOwnLayerSourceCache(O),U=S[q.id]=S[q.id]||{sourceCache:q,layers:{},has3DLayers:!1};O.is3D(!!this.terrain)&&(U.has3DLayers=!0),U.layers[O.fqid]=U.layers[O.fqid]||{styleLayer:O,targets:[]},U.layers[O.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const O of c.layers){const q=this._layers[O];if(!q)return this.fire(new s.y(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];T(q)}}else for(const O in this._layers)T(this._layers[O]);const I=this._queryRenderedFeatures(t,S,p),k=this._flattenAndSortRenderedFeatures(I),D=[];for(const O of k)s.dw(O.layer.id)===this.scope&&D.push(O);return D}queryRenderedFeatureset(t,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),x=s.b6(c.filter));const S="mock",T=[];if(c&&c.target)T.push(Object.assign({},c,{targetId:S,filter:x}));else{const O=this.getFeaturesetDescriptors();for(const q of O)T.push({targetId:S,filter:x,target:q});for(const{style:q}of this.fragments){const U=q.getFeaturesetDescriptors();for(const G of U)T.push({targetId:S,filter:x,target:G})}}const I=this.queryRenderedTargets(t,T,p),k=[],D=new Set;for(const O of I)for(const q of O.variants[S])$n(q,O,D)||k.push(new s.dx(O,q));return k}queryRenderedTargets(t,c,p){const x={},S=(I,k,D,O)=>{const q=x[k.id]=x[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};if(q.layers[I.fqid]=q.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(q.has3DLayers=!0),!O)return D.uniqueFeatureID=!1,void q.layers[I.fqid].targets.push(D);q.layers[I.fqid].targets.push(Object.assign({},D,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const I of c)if("featuresetId"in I.target){const{featuresetId:k,importId:D}=I.target,O=this.getFragmentStyle(D);if(!O||!O._featuresetSelectors)continue;const q=O._featuresetSelectors[k];if(!q){this.fire(new s.y(new Error(`The featureset '${k}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const U of q){const G=O.getOwnLayer(U.layerId);G&&!rf.has(G.type)&&S(G,O.getOwnLayerSourceCache(G),I,U)}}else if("layerId"in I.target){const{layerId:k}=I.target,D=this.getLayer(k);if(!D||rf.has(D.type))continue;S(D,this.getLayerSourceCache(D),I)}const T=this._queryRenderedFeatures(t,x,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,c,p){const x=[],S=!!this.map._showQueryGeometry,T=Oi.createFromScreenPoints(t,p);for(const I in c){const k=jo(T,c[I],this._availableImages,p,S,this.getActualScope());Object.keys(k).length&&x.push(k)}if(this.placement)for(const I in c){if(!c[I].sourceCache._onlySymbols)continue;const k=Il(T.screenGeometry,c[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(k).length&&x.push(k)}return x}querySourceFeatures(t,c){const p=c&&c.filter;p&&this._validate(ne,"querySourceFeatures.filter",p,null,c);let x=[];const S=this.getOwnSourceCaches(t);for(const T of S)x=x.concat(eu(T,c));return x}addSourceType(t,c,p){return aa.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(aa.setSourceType(t,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,c,p={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const I in t)if(!s.by(t[I],x[I])){S=!0;break}if(!S)return;const T=this._getTransitionParameters();this.light.setLight(t,c,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,c=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=t;const x=!("source"in t)||t.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=s.dp(p),p=Object.assign(p,{source:I})}const S=Object.assign({},p),T={};if(this.terrain&&x){S.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(us,"terrain",S,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new s.z("data",{dataType:"style"}))}else{const S=this.terrain,T=S.get();for(const I of Object.keys(s.a6.terrain))!p.hasOwnProperty(I)&&s.a6.terrain[I].default&&(p[I]=s.a6.terrain[I].default);for(const I in t)if(!s.by(t[I],T[I])){S.set(t,this.options),this.stylesheet.terrain=t;const k=this._getTransitionParameters({duration:0});S.updateTransitions(k),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const c=this.fog=new Rr(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(t){const c=this.snow=new Yi(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(t){const c=this.rain=new Ii(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!s.by(c.get(),t)){c.set(t,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!s.by(c.get(),t)){c.set(t,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!s.by(c.get(),t)){c.set(t,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void t();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new s.z("colorthemeset")),t()}).catch(x=>{s.w(`Couldn't set color theme: ${x}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,c){const p=this.getFragmentStyle(t);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(t){return{now:s.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?t.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...c)}_createTerrain(t,c){const p=this.terrain=new Xe(t,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const t in this._layers){const c=this._layers[t];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const c=this._layers[t];c.type==="symbol"&&this._updateLayer(c)}}_validate(t,c,p,x,S={}){if(S&&S.validate===!1)return!1;const T=Object.assign({},this.serialize());return Nl(this,t.call(Is,Object.assign({key:c,style:T,value:p,styleSpec:s.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const c=this.getSourceCaches(t);for(const p of c)p.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const c=this._mergedLayers[t];c._clear&&c._clear()}}reloadSource(t){const c=this.getSourceCaches(t);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let c;this.directionalLight&&(c=Bg(this.directionalLight));const p=new Set,x=new Set;for(const S in this._mergedLayers){const T=this._mergedLayers[S];T.type==="building"&&p.add(T.source),T.hasElevation()&&!x.has(T.source)&&x.add(T.source)}for(const S in this._mergedSourceCaches){const T=this._mergedSourceCaches[S],I=x.has(T._source.id);p.has(T._source.id)&&(T._source.reparseOverscaled=!1),T.update(t,void 0,void 0,c,I)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const c=this._sourceCaches[t];c.resume(),c.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new Xh),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(t,c,p,x,S){this.pauseablePlacement||(this.pauseablePlacement=new Xh);let T=!1,I=!1;const k={},D={};for(const Y of this._mergedOrder){const te=this._mergedLayers[Y];if(te.type!=="symbol")continue;const le=s.B(te.source,te.scope);let ge=k[le];if(!ge){const de=this.getLayerSourceCache(te);if(!de)continue;const Ne=de.getRenderableIds(!0).map(Ce=>de.getTileByID(Ce));D[le]=Ne.slice(),ge=k[le]=Ne.sort((Ce,ke)=>ke.tileID.overscaledZ-Ce.tileID.overscaledZ||(Ce.tileID.isLessThan(ke.tileID)?-1:1))}const pe=this.crossTileSymbolIndex.addLayer(te,ge,t.center.lng,t.projection);T=T||pe}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const O=!!(this.placement&&!t.equals(this.placement.transform)),q=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!S||this.placement.lastReplacementSourceUpdateTime!==S.updateTime)),U=O||q||T,G=(U||this.pauseablePlacement.isStale())&&p===0,J=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),t.zoom)&&p!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||G||J)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(t,this._mergedOrder,c,p,x,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?U&&p!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,D,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),I=!0),T&&this.pauseablePlacement.setStale()),I||T){this._buildingIndex.onNewFrame(t.zoom);for(let Y=0;Y<this._mergedOrder.length;Y++){const te=this._mergedLayers[this._mergedOrder[Y]];if(te.type!=="symbol"||te.visibility==="none")continue;const le=this.isLayerClipped(te);this.placement.updateLayerOpacities(te,k[s.B(te.source,te.scope)],Y,le?S:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:S})=>S===t.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!c)return p.push(t),this._loadImports([t],!0);const x=p.findIndex(({id:S})=>S===c);return x===-1&&this.fire(new s.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(t).concat(p.slice(x)),this._loadImports([t],!0,c)}updateImport(t,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(t);return x===-1?this:typeof c=="string"?(this.setImportUrl(t,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(t,c.url),s.by(c.config,p[x].config)||this.setImportConfig(t,c.config,c.data.schema),s.by(c.data,p[x].data)||this.setImportData(t,c.data),this)}moveImport(t,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(t);if(x===-1)return this;const S=this.getImportIndex(c);if(S===-1)return this;const T=p[x],I=this.fragments[x];return p=p.filter(({id:k})=>k!==t),this.fragments=this.fragments.filter(({id:k})=>k!==t),this.stylesheet.imports=p.slice(0,S).concat(T).concat(p.slice(S)),this.fragments=this.fragments.slice(0,S).concat(I).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(t,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(t);if(x===-1)return this;p[x].url=c;const S=this.fragments[x];return S.style=this._createFragmentStyle(p[x]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(c),this}setImportData(t,c){this._checkLoaded();const p=this.getImportIndex(t),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(t,x[p].url))}setImportConfig(t,c,p){this._checkLoaded();const x=this.getImportIndex(t),S=this.stylesheet.imports||[];if(x===-1)return this;c?S[x].config=c:delete S[x].config;const T=this.fragments[x];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const I=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=c,T.style.updateConfig(c,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(t);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(t){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===t);return c===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),c}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&t.push(p.getSource())}return t}getSource(t,c){const p=this.getSourceCache(t,c);return p&&p.getSource()}getLayerSource(t){const c=this.getLayerSourceCache(t);return c&&c.getSource()}getSourceCache(t,c){const p=s.B(t,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(t){const c=s.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[t]&&c.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&c.push(this._mergedSymbolSourceCaches[t]),c}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const c in t){const p=t[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(t){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=T=>{if(T){const I=c.images.map(k=>s.I.toString(k));T.setDependencies(c.tileID.key,c.type,I)}},S=s.B(c.source,c.scope);x(this._mergedOtherSourceCaches[S]),x(this._mergedSymbolSourceCaches[S]),c.images.some(T=>T.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(t,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(t,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(t,c,p){return s.dz(c,p)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const c=[];return this._otherSourceCaches[t]&&c.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&c.push(this._symbolSourceCaches[t]),c}_isSourceCacheLoaded(t){const c=this.getOwnSourceCaches(t);return c.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,c){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const p=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),x=t.type==="building";if(t.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}aa.getSourceType=function(f){return br[f]},aa.setSourceType=function(f,t){br[f]=t},aa.registerForPluginStateChange=s.dA;var gp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Wd=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Uu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,$u="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",yp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,nf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Oa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hd=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,qt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,sf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,of=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const af=/#include\s+"([^"]+)"/g,ic=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,qu=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Gu=new Set(["ifdef","ifndef","elif","if","defined"]),ou=new Set;al(gp,ou),al(Uu,ou),al(Wd,ou);const Cc={"_prelude_fog.vertex.glsl":nf,"_prelude_terrain.vertex.glsl":yp,"_prelude_shadow.vertex.glsl":sf,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Oa,"_prelude_shadow.fragment.glsl":of,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Hd,"_prelude_raster_particle.glsl":qt},xs={};jn("",yp),jn(Oa,nf),jn(of,sf),jn(Hd,""),jn(qt,"");const _p=jn(Wd,Uu),Wu=gp,lf=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Wu,_p.fragmentSource].join(`
`),km=["precision highp float;",Wu,_p.vertexSource].join(`
`);var cf={background:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:jn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:jn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:jn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:jn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:jn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:jn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:jn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:jn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:jn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:jn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:jn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$u),skyboxGradient:jn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$u),skyboxCapture:jn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:jn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:jn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:jn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:jn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:jn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:jn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function al(f,t){const c=f.split(`
`);for(let p of c){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const x=p.match(qu);if(x)for(const S of x)Gu.has(S)||t.add(S)}}function jn(f,t){const c=new Set,p=[],x=[];f=f.replace(af,(T,I)=>(x.push(I),"")),t=t.replace(af,(T,I)=>(p.push(I),""));let S=new Set(ou);al(f,S),al(t,S);for(const T of[...p,...x])xs[T]||(xs[T]=new Set,al(Cc[T],xs[T])),S=new Set([...S,...xs[T]]);return{fragmentSource:f=f.replace(ic,(T,I,k,D,O)=>(c.add(O),I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${k} ${D} ${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${k} ${D} ${O} = u_${O};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${k} ${D} ${O};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(ic,(T,I,k,D,O)=>{const q=`MATERIAL_ATTRIBUTE_OFFSET_${O}`,U=D==="float"?"vec2":D,G=`GET_ATTRIBUTE_${U}(a_${O}, materialInfo, ${q})`,J=O.match(/color/)?"color":U;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${k} ${D} a_${O};
#endif
`:c.has(O)?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${q})
        in ${k} ${U} a_${O};
    #endif
out ${k} ${D} ${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:I==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${k} ${D} ${O} = u_${O};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${O})
    #ifdef ${q}
        ${O} = unpack_mix_${J}(${G}, u_${O}_t);
    #else
        ${O} = unpack_mix_${J}(a_${O}, u_${O}_t);
    #endif
#else
    ${k} ${D} ${O} = u_${O};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${k} ${D} a_${O};
    out ${k} ${D} ${O};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${q})
        in ${k} ${U} a_${O};
    #endif
#else
uniform ${k} ${D} u_${O};
#endif
`:I==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${k} ${D} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${U} a_${O};
#else
uniform ${k} ${D} u_${O};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${k} ${D} ${O} = a_${O};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${q}
        ${k} ${D} ${O} = ${G};
    #else
        ${k} ${D} ${O} = a_${O};
    #endif
#else
    ${k} ${D} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${q}
        ${k} ${D} ${O} = unpack_mix_${J}(${G}, u_${O}_t);
    #else
        ${k} ${D} ${O} = unpack_mix_${J}(a_${O}, u_${O}_t);
    #endif
#else
    ${k} ${D} ${O} = u_${O};
#endif
`}),usedDefines:S,vertexIncludes:p,fragmentIncludes:x}}class Zd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,c,p,x,S,T,I,k){this.context=t;let D=this.boundPaintVertexBuffers.length!==x.length;for(let q=0;!D&&q<x.length;q++)this.boundPaintVertexBuffers[q]!==x[q]&&(D=!0);let O=this.boundDynamicVertexBuffers.length!==I.length;for(let q=0;!O&&q<I.length;q++)this.boundDynamicVertexBuffers[q]!==I[q]&&(O=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||D||O||this.boundIndexBuffer!==S||this.boundVertexOffset!==T)this.freshBind(c,p,x,S,T,I,k);else{t.bindVertexArrayOES.set(this.vao);for(const q of I)q&&(q.bind(),k&&q.instanceCount&&q.setVertexAttribDivisor(t.gl,c,k));S&&S.dynamicDraw&&S.bind()}}freshBind(t,c,p,x,S,T,I){const k=this.context,D=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=T,c.enableAttributes(D,t),c.bind(),c.setVertexAttribPointers(D,t,S);for(const O of p)O.enableAttributes(D,t),O.bind(),O.setVertexAttribPointers(D,t,S);for(const O of T)O&&(O.enableAttributes(D,t),O.bind(),O.setVertexAttribPointers(D,t,S),I&&O.instanceCount&&O.setVertexAttribDivisor(D,t,I));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ug(f,t){const c=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new s.ae(0,p/c).toLngLat().lat,new s.ae(0,(p+1)/c).toLngLat().lat]}function C_(f,t,c,p,x,S,T){const I=f.context,k=I.gl,D=c.hillshadeFBO;if(!D)return;f.prepareDrawTile();const O=f.isTileAffectedByFog(t),q=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&q.push("USE_MRT1");const U=f.getOrCreateProgram("hillshade",{overrideFog:O,defines:q});I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment0.get());const G=((le,ge,pe,de)=>{const Ne=pe.paint.get("hillshade-shadow-color"),Ce=pe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ke=pe.paint.get("hillshade-highlight-color"),Te=pe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_e=pe.paint.get("hillshade-accent-color"),Me=pe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ue=pe.paint.get("hillshade-emissive-strength");let Ge=s.an(pe.paint.get("hillshade-illumination-direction"));if(pe.paint.get("hillshade-illumination-anchor")==="viewport")Ge-=le.transform.angle;else if(le.style&&le.style.enable3dLights()&&le.style.directionalLight){const tt=le.style.directionalLight.properties.get("direction"),mt=s.d4(tt.x,tt.y,tt.z);Ge=s.an(mt[1])}const it=!le.options.moving;return{u_matrix:de||le.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),it),u_image:0,u_latrange:Ug(0,ge.tileID),u_light:[pe.paint.get("hillshade-exaggeration"),Ge],u_shadow:Ne.toPremultipliedRenderColor(Ce?null:pe.lut),u_highlight:ke.toPremultipliedRenderColor(Te?null:pe.lut),u_emissive_strength:Ue,u_accent:_e.toPremultipliedRenderColor(Me?null:pe.lut)}})(f,c,p,f.terrain?t.projMatrix:null);f.uploadCommonUniforms(I,U,t.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:Y,tileBoundsSegments:te}=f.getTileBoundsBuffers(c);U.draw(f,k.TRIANGLES,x,S,T,qr.disabled,G,p.id,J,Y,te)}function Nm(f,t,c){if(!t.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(c.stride);const S=c.getPixels();t.demTexture?t.demTexture.update(S,{premultiply:!1}):t.demTexture=new s.T(p,S,x.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function $g(f,t,c){const p=f.context,x=p.gl;if(!t.dem)return;const S=t.dem;if(p.activeTexture.set(x.TEXTURE1),Nm(f,t,S),!t.demTexture)return;t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=S.dim;p.activeTexture.set(x.TEXTURE0);let I=t.hillshadeFBO;if(!I){const U=new s.T(p,{width:T,height:T,data:null},x.RGBA8);U.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=t.hillshadeFBO=p.createFramebuffer(T,T,1,"renderbuffer"),I.colorAttachment0.set(U.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:D,tileBoundsSegments:O}=f.getMercatorTileBoundsBuffers(),q=[];f.linearFloatFilteringSupported()&&q.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&q.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:q}).draw(f,x.TRIANGLES,_r.disabled,Xr.disabled,Jr.unblended,qr.disabled,((U,G)=>{const J=G.stride,Y=s.bC();return s.ce(Y,0,s.al,-s.al,0,0,1),s.br(Y,Y,[0,-s.al,0]),{u_matrix:Y,u_image:1,u_dimension:[J,J],u_zoom:U.overscaledZ}})(t.tileID,S),c.id,k,D,O),t.needsHillshadePrepare=!1}class Mi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xp extends Mi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const c=this.current;(t.r!==c.r||t.g!==c.g||t.b!==c.b||t.a!==c.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vp extends Mi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class uf extends Mi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Xd extends Mi{getDefault(){return[!0,!0,!0,!0]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class df extends Mi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Hu extends Mi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Zu extends Mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const c=this.current;(t.func!==c.func||t.ref!==c.ref||t.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class hf extends Mi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Kd extends Mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=t,this.dirty=!1}}class bp extends Mi{getDefault(){return[0,1]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class sc extends Mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=t,this.dirty=!1}}class jm extends Mi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class jl extends Mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.BLEND):c.disable(c.BLEND),this.current=t,this.dirty=!1}}class Xa extends Mi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class au extends Mi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const c=this.current;(t.r!==c.r||t.g!==c.g||t.b!==c.b||t.a!==c.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Rl extends Mi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Yd extends Mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=t,this.dirty=!1}}class ff extends Mi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class qg extends Mi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let lu=class extends Mi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Qd extends Mi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ml extends Mi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pf extends Mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Rm extends Mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jd extends Mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class cu extends Mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ts extends Mi{getDefault(){return null}set(t){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vs extends Mi{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class oc extends Mi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ro extends Mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Sa extends Mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ac extends Mi{constructor(t,c){super(t),this.context=t,this.parent=c}getDefault(){return null}}class Ac extends ac{constructor(t,c,p=0){super(t,c),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class go extends ac{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class uu extends ac{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mm extends go{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const za=(f,t,c,p)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:c,u_emissive_texture_available:p}),Xu=(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:S,u_image0:0,u_image1:1,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:k,u_frustum_bl:D,u_globe_pos:O,u_globe_radius:q,u_viewport:U,u_grid_matrix:te?Float32Array.from(te):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:J,u_emissive_texture_available:Y});function eh(f,t){return f!=null&&t!=null&&!(!f.hasData()||!t.hasData())&&f.demTexture!=null&&t.demTexture!=null&&f.tileID.key!==t.tileID.key}const Wo=new class{constructor(){this.operations={}}newMorphing(f,t,c,p,x){if(f in this.operations){const S=this.operations[f];S.to.tileID.key!==c.tileID.key&&(S.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:x,from:t,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const c=this.operations[t];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Ku={0:null,1:"TERRAIN_VERTEX_MORPHING"};function th(f,t,c){if(t===0)return 0;const p=t<1&&c===514?.25/t:1;return 6*Math.pow(1.5,22-f)*Math.max(t,1)*p}function wp(f,t){const c=1<<f.z;return!t&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}function rh(f,t){if(!f.style||!f.style.enable3dLights())return;const c=f.context,p=c.gl;c.activeTexture.set(p.TEXTURE1),t?t.bind(p.LINEAR,p.CLAMP_TO_EDGE):f.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const ll=f=>({u_matrix:f});function lc(f,t,c,p,x){if(x>0){const S=s.o.now(),T=(S-f.timeAdded)/x,I=t?(S-t.timeAdded)/x:-1,k=c.getSource(),D=p.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(f.tileID.overscaledZ-D),q=O&&f.refreshedUponExpiration?1:s.aA(O?T:1-I,0,1);return t?{opacity:1,mix:1-q,isFading:T<1}:{opacity:q,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Ic extends qo{constructor(t){const c=pn("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,c){t.state="loaded",c(null)}}class nh extends qo{constructor(t){const c=pn("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,c,p){if(t.freezeTileCoverage)return;this.transform=t;const x=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,T)=>{if(S[T.key]="",!this._tiles[T.key]){const I=new Ei(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[T.key]=I}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(t){const c=this.proxyCachedFBO[t];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ih extends s.aQ{constructor(t,c,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Fa extends s.bV{constructor(t,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,S]=(function(){const k=new s.bd,D=new s.b0,O=131;k.reserve(17161),D.reserve(33800);const q=s.al/128,U=s.al+q/2,G=U+q;for(let Y=-q;Y<G;Y+=q)for(let te=-q;te<G;te+=q){const le=te<0||te>U||Y<0||Y>U?24575:0,ge=s.aA(Math.round(te),0,s.al),pe=s.aA(Math.round(Y),0,s.al);k.emplaceBack(ge+le,pe)}const J=(Y,te)=>{const le=te*O+Y;D.emplaceBack(le+1,le,le+O),D.emplaceBack(le+O,le+O+1,le+1)};for(let Y=1;Y<129;Y++)for(let te=1;te<129;te++)J(te,Y);return[0,129].forEach(Y=>{for(let te=0;te<130;te++)J(te,Y),J(Y,te)}),[k,D,32768]})(),T=t.context;this.gridBuffer=T.createVertexBuffer(p,s.bf.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=s.bg.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,p.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new nh(c.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=T.gl;this._overlapStencilMode=new Xr({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ic(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,c,p){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const x=t.terrain.properties,S=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=t.terrain&&t.terrain.scope,k=x.get("source"),D=S?this._mockSourceCache:t.getSourceCache(k,I);if(!D)return void s.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=D,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const q=this.getScaledDemTileSize();this.sourceCache.update(c,q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const c=this._previousCameraAltitude,p=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const S=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(S);let I=S-this._previousZoom;const k=this._previousUpdateTimestamp;let D=S;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(S-D)>.5&&(I=.5*(S-D+I)),I*x<0&&(D+=I)),this._evaluationZoom=D;const O=T.getExaggeration(D),q=O===T.getExaggeration(Math.max(0,D-.1));if(q&&Math.abs(O-this._exaggeration)<.01)return O;let U=Math.min(.1,.00375*(this._updateTimestamp-k));return(q||O<.1||Math.abs(I)<1e-4)&&(U=Math.min(.2,4*U)),s.ak(this._exaggeration,O,U)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(k=>{const D=c.getTileByID(k).tileID;return D.projMatrix=p.calculateProjMatrix(D.toUnwrapped()),D});(function(k,D){const O=D.transform.pointCoordinate(D.transform.getCameraPoint()),q=new s.P(O.x,O.y);k.sort((U,G)=>{if(G.overscaledZ-U.overscaledZ)return G.overscaledZ-U.overscaledZ;const J=new s.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Y=new s.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),te=q.mult(1<<U.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(J)-te.distSqr(Y)})})(x,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const k in T){const D=T[k];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,t[k],S),D.usedForTerrain))continue;const O=t[k];D.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[c.id]=x.map(k=>new ih(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const D=this.terrainTileForTile[k.key];if(!D)continue;const O=D.tileID.key;O in I||(this._visibleDemTiles.push(D),I[O]=O)}}_assignTerrainTiles(t){this._initializing||t.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,c=t.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(t.activeTexture.set(c.TEXTURE1),Nm(this.painter,x,S))}}_prepareDemTileUniforms(t,c,p,x){if(!c||c.demTexture==null)return!1;const S=t.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-S.z),I=x||"";return p[`u_dem_tl${I}`]=[S.x*T%1,S.y*T%1],p[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const c=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const S=x.dem.tree.minimums[0];return S>0&&t++,p+S},0);return t?c/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,c=t.gl;t.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new s.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new s.T(t,x,c.R32F,{premultiply:!1}),S}setupElevationDraw(t,c,p){const x=this.painter.context,S=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,k=null,D=1;if(p&&p.morphing&&this._useVertexMorphing){const G=p.morphing.srcDemTile,J=p.morphing.dstDemTile;D=p.morphing.phase,G&&J&&(this._prepareDemTileUniforms(t,G,T,"_prev")&&(k=G),this._prepareDemTileUniforms(t,J,T)&&(I=J))}const O=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST;let q=null;var U;if(this.enabled?k&&I?(q=I.demTexture,x.activeTexture.set(S.TEXTURE4),k.demTexture.bind(O(k),S.CLAMP_TO_EDGE),T.u_dem_lerp=D):(I=this.terrainTileForTile[t.tileID.key],q=this._prepareDemTileUniforms(t,I,T)?I.demTexture:this.emptyDEMTexture):q=this.emptyDEMTexture,x.activeTexture.set(S.TEXTURE2),q&&(T.u_dem_size=(U=q).size[0]===1?1:U.size[0]-2,q.bind(O(I),S.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,T),p&&p.useMeterToDem&&I){const G=(1<<I.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=G}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,t.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,G)}}globeUniformValues(t,c,p){const x=t.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,s.al,0),u_tile_br_up:x.upVector(c,s.al,s.al),u_tile_bl_up:x.upVector(c,0,s.al),u_tile_up_scale:p?s.dM(1):x.upVectorScale(c,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const c=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,S,T,I,k){if(x.transform.projection.name==="globe")(function(D,O,q,U,G){const J=D.context,Y=J.gl;let te,le;const ge=D.transform,pe=s.dE(D,J,ge),de=(it,tt)=>{if(le===tt)return;const mt=[Ku[tt],"PROJECTION_GLOBE_VIEW"];pe&&mt.push("CUSTOM_ANTIALIASING");const Pt=D.isTileAffectedByFog(it);te=D.getOrCreateProgram("globeRaster",{defines:mt,overrideFog:Pt}),le=tt},Ne=D.colorModeForRenderPass(),Ce=new _r(Y.LEQUAL,_r.ReadWrite,D.depthRangeFor3D);Wo.update(G);const ke=s.dF(ge),Te=[s.aF(ge.center.lng),s.aJ(ge.center.lat)],_e=D.globeSharedBuffers,Me=[ge.width*s.o.devicePixelRatio,ge.height*s.o.devicePixelRatio],Ue=Float32Array.from(ge.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const it=D.transform,tt=th(it.zoom,O.exaggeration(),O.sourceCache._source.tileSize);le=-1;const mt=Y.TRIANGLES;for(const Pt of U){const Qe=q.getTile(Pt),Le=Xr.disabled,dt=O.prevTerrainTileForTile[Pt.key],nt=O.terrainTileForTile[Pt.key];eh(dt,nt)&&Wo.newMorphing(Pt.key,dt,nt,G,250),rh(D,Qe.emissiveTexture),J.activeTexture.set(Y.TEXTURE0),Qe.texture&&Qe.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const yt=Wo.getMorphValuesForProxy(Pt.key),Dt=yt?1:0;yt&&Object.assign(Ge,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:s.dD(yt.phase)}});const Kt=s.dG(Pt.canonical),Ot=s.dH(Kt.getCenter().lat),Ft=s.dI(Pt.canonical,Kt,Ot,it.worldSize/it._pixelsPerMercatorPixel),gr=s.bk(s.dJ(Pt.canonical)),fr=D.emissiveMode==="mrt-fallback"?1:0,sr=Xu(it.expandedFarZProjMatrix,Ue,ke,gr,s.aj(it.zoom),Te,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Me,tt,it._farZ,fr,Ft);if(de(Pt,Dt),te&&(O.setupElevationDraw(Qe,te,Ge),D.uploadCommonUniforms(J,te,Pt.toUnwrapped()),_e)){const[ar,Mr,Gr]=_e.getGridBuffers(Ot,tt!==0);te.draw(D,mt,Ce,Le,Ne,qr.backCCW,sr,"globe_raster",ar,Mr,Gr)}}}if(_e&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&it.push("CUSTOM_ANTIALIASING"),te=D.getOrCreateProgram("globeRaster",{defines:it});for(const tt of U){const{x:mt,y:Pt,z:Qe}=tt.canonical,Le=Pt===0,dt=Pt===(1<<Qe)-1,[nt,yt,Dt,Kt]=_e.getPoleBuffers(Qe,!1);if(Kt&&(Le||dt)){const Ot=q.getTile(tt);rh(D,Ot.emissiveTexture),J.activeTexture.set(Y.TEXTURE0),Ot.texture&&Ot.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Ft=s.dK(Qe,mt,ge);const gr=s.bk(s.dJ(tt.canonical)),fr=D.emissiveMode==="mrt-fallback"?1:0,sr=(ar,Mr)=>ar.draw(D,Y.TRIANGLES,Ce,Xr.disabled,Ne,qr.disabled,Xu(ge.expandedFarZProjMatrix,Ft,Ft,gr,0,Te,ge.frustumCorners.TL,ge.frustumCorners.TR,ge.frustumCorners.BR,ge.frustumCorners.BL,ge.globeCenterInViewSpace,ge.globeRadius,Me,0,ge._farZ,fr),"globe_pole_raster",Mr,Dt,Kt);O.setupElevationDraw(Ot,te,Ge),D.uploadCommonUniforms(J,te,tt.toUnwrapped()),Le&&D.renderDefaultNorthPole&&sr(te,nt),dt&&D.renderDefaultSouthPole&&(Ft=s.cS(s.bC(),Ft,[1,-1,1]),sr(te,yt))}}}})(x,S,T,I,k);else{const D=x.context,O=D.gl;let q,U;const G=x.shadowRenderer,J=Ha(x,x.longestCutoffRange),Y=Ne=>{if(U===Ne)return;const Ce=[];Ce.push(Ku[Ne]),J.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),G&&(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&Ce.push("NORMAL_OFFSET")),q=x.getOrCreateProgram("terrainRaster",{defines:Ce}),U=Ne},te=x.colorModeForRenderPass(),le=new _r(O.LEQUAL,_r.ReadWrite,x.depthRangeFor3D);Wo.update(k);const ge=x.transform,pe=th(ge.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let de=[0,0,0];if(G){const Ne=x.style.directionalLight,Ce=x.style.ambientLight;Ne&&Ce&&(de=Vs(x.style,Ne,Ce))}{U=-1;const Ne=O.TRIANGLES,[Ce,ke]=[S.gridIndexBuffer,S.gridSegments];for(const Te of I){const _e=T.getTile(Te),Me=Xr.disabled,Ue=S.prevTerrainTileForTile[Te.key],Ge=S.terrainTileForTile[Te.key];eh(Ue,Ge)&&Wo.newMorphing(Te.key,Ue,Ge,k,250),rh(x,_e.emissiveTexture),D.activeTexture.set(O.TEXTURE0),_e.texture&&_e.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const it=Wo.getMorphValuesForProxy(Te.key),tt=it?1:0;let mt;it&&(mt={morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:s.dD(it.phase)}});const Pt=x.emissiveMode==="mrt-fallback"?1:0,Qe=za(Te.projMatrix,wp(Te.canonical,ge.renderWorldCopies)?pe/10:pe,de,Pt);if(Y(tt),!q)continue;S.setupElevationDraw(_e,q,mt);const Le=Te.toUnwrapped();G&&G.setupShadows(Le,q),x.uploadCommonUniforms(D,q,Le,null,J),q.draw(x,Ne,le,Me,te,qr.backCCW,Qe,"terrain_raster",S.gridBuffer,Ce,ke)}}}})(c,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),I=c.style.order,k=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let D=0;for(const O of S){const q=x.getTileByID(O.proxyTileKey),U=x.proxyCachedFBO[O.key]?x.proxyCachedFBO[O.key][t]:void 0,G=U!==void 0?x.renderCache[U]:this.pool[D++],J=U!==void 0;if(q.texture=G.tex,q.emissiveTexture=G.emissiveTex,J&&!G.dirty){k.push(q.tileID);continue}p.bindFramebuffer.set(G.fb.framebuffer);const Y=p.gl;let te;Y.drawBuffers(c.emissiveMode==="mrt-fallback"?[Y.COLOR_ATTACHMENT0,Y.COLOR_ATTACHMENT1]:[Y.COLOR_ATTACHMENT0]),this.renderedToTile=!1,G.dirty&&(p.clear({color:s.ao.transparent,stencil:0}),G.dirty=!1);for(let le=T.start;le<=T.end;++le){const ge=c.style._mergedLayers[I[le]];if(ge.isHidden(c.transform.zoom))continue;const pe=c.style.getLayerSourceCache(ge),de=pe?this.proxyToSource[O.key][pe.id]:[O];if(!de)continue;const Ne=de;p.viewport.set([0,0,G.fb.width,G.fb.height]),te!==(pe?pe.id:null)&&(this._setupStencil(G,de,ge,pe),te=pe?pe.id:null),c.renderLayer(c,pe,ge,Ne)}if(Y.drawBuffers([Y.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const le of this._pendingGroundEffectLayers){const ge=c.style._mergedLayers[I[le]];if(ge.isHidden(c.transform.zoom))continue;const pe=c.style.getLayerSourceCache(ge),de=pe?this.proxyToSource[O.key][pe.id]:[O];if(!de)continue;const Ne=de;p.viewport.set([0,0,G.fb.width,G.fb.height]),te!==(pe?pe.id:null)&&(this._setupStencil(G,de,ge,pe),te=pe?pe.id:null),c.renderLayer(c,pe,ge,Ne)}this.renderedToTile?(G.dirty=!0,k.push(q.tileID)):J||--D,D===5&&(D=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const c=t.order.length;let p=-1,x=c;for(let S=0;S<c;++S)this._style.isLayerDraped(t._mergedLayers[t.order[S]])?p=Math.max(p,S):x=Math.min(x,S);return x>p}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{t=Math.min(t,c.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const T=S.tileID,I=1<<T.overscaledZ,{x:k,y:D}=T.canonical,O=k/I,q=(k+1)/I,U=D/I,G=(D+1)/I;return{minx:O,miny:U,maxx:q,maxy:G,t:S.dem.tree.raycastRoot(O,U,q,G,t,c,p),tile:S}});x.sort((S,T)=>(S.t!==null?S.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const S of x){if(S.t==null)return null;const T=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,t,c,p);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,c=t.gl,p=this.drapeBufferSize;t.activeTexture.set(c.TEXTURE0);const x=new s.T(t,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const S=t.createFramebuffer(p[0],p[1],1,null);let T;return S.colorAttachment0.set(x.texture),this._emissiveTexture&&(T=new s.T(t,{width:p[0],height:p[1],data:null},c.R8),T.bind(c.LINEAR,c.CLAMP_TO_EDGE),S.createColorAttachment(t,1),S.colorAttachment1.set(T.texture)),S.depthAttachment=new Mm(t,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:S,tex:x,emissiveTex:T,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const c of this.pool)this._updateFBO(c,t);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,t);this._emissiveTexture=t}}_updateFBO(t,c){const p=t.fb,x=this.painter.context,S=x.gl,T=this.drapeBufferSize;if(c){const I=new s.T(x,{width:T[0],height:T[1],data:null},S.R8);I.bind(S.LINEAR,S.CLAMP_TO_EDGE),t.emissiveTex=I,p.createColorAttachment(x,1),p.colorAttachment1.set(I.texture)}else t.emissiveTex=void 0,p.removeColorAttachment(x,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const c=this._style._mergedLayers[t],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const p of this._style.getSources())if(p instanceof ra){t=!0;break}if(!t)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],S=this._style.getLayerSourceCache(x);if(!S||c[S.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="line")continue;const T=x.widthExpression(),I=x.emissiveStrengthExpression();if(T instanceof s.ad||I instanceof s.ad){c[S.id]=!0;for(const k of this.proxyCoords){const D=this.proxyToSource[k.key][S.id];if(D)for(const O of D)this._clearRenderCacheForTile(S.id,O)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Uo){t=!0;break}if(!t)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],S=this._style.getLayerSourceCache(x);if(!S||c[S.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const T=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const k=this.proxyToSource[I.key][S.id];if(k)for(const D of k){const O=lc(S.getTile(D),S.findLoadedParent(D,0),S,this.painter.transform,T);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(S.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,c=t.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,S=0,T=this._style._mergedLayers[t[S]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++S<c;)T=this._style._mergedLayers[t[S]];for(;S<c;++S){const I=this._style._mergedLayers[t[S]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=S):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),x!==void 0&&(p.push({start:x,end:S-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:S-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every(k=>k>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(t){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<T.length;++I){const k=Object.values(T[I]);c.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const I=p[T];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){const k=t[I.key],D=this.proxyToSource[I.key];let O=0;for(const q in D){const U=D[q],G=k[q];if(!G||G.length!==U.length||U.some((J,Y)=>J!==G[Y]||x[q]&&x[q].hasOwnProperty(J.key))){O=-1;break}++O}for(const q in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][q]].dirty=O<0||O!==Object.values(k).length}}const S=[...this._drapedRenderBatches];S.sort((T,I)=>I.end-I.start-(T.end-T.start));for(const T of S)for(const I of p){if(c.proxyCachedFBO[I.key])continue;let k=c.renderCachePool.pop();k===void 0&&c.renderCache.length<50&&(k=c.renderCache.length,c.renderCache.push(this._createFBO())),k!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][T.start]=k,c.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(t,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,T=S.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Xr.disabled}_renderTileClippingMasks(t,c){const p=this.painter,x=this.painter.context,S=x.gl;p._tileClippingMaskIDs={},x.setColorMode(Jr.disabled),x.setDepthMode(_r.disabled);const T=p.getOrCreateProgram("clippingMask");for(const I of t){const k=p._tileClippingMaskIDs[I.key]=--c;T.draw(p,S.TRIANGLES,_r.disabled,new Xr({func:S.ALWAYS,mask:0},k,255,S.KEEP,S.KEEP,S.REPLACE),Jr.disabled,qr.disabled,ll(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const c=this.painter.transform;if(t.x<0||t.x>c.width||t.y<0||t.y>c.height)return null;const p=[t.x,t.y,1,1];s.aC(p,p,c.pixelMatrixInverse),s.cK(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,S=s.cf(1,c.center.lat),T=[x[0],x[1],x[2]/S,0],I=s.da([],p.slice(0,3),T);s.aw(I,I);const k=this.raycast(T,I,this._exaggeration);return k!==null&&k?(s.bH(T,T,I,k),T[3]=T[2],T[2]*=S,T):null}_setupProxiedCoordsForOrtho(t,c,p){if(t.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(t,c,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const x=this.proxiedCoords[t.id]=[],S=this.proxyCoords;for(let k=0;k<S.length;k++){const D=S[k],O=this._findTileCoveringTileID(D,t);if(O){const q=this._createProxiedId(D,O,p[D.key]&&p[D.key][t.id]);x.push(q),this.proxyToSource[D.key][t.id]=[q]}}let T=!1;const I=new Set;for(let k=0;k<c.length;k++){const D=t.getTile(c[k]);if(!D||!D.hasData())continue;const O=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==D.tileID.canonical.z){const q=this.proxyToSource[O.tileID.key][t.id],U=this._createProxiedId(O.tileID,D,p[O.tileID.key]&&p[O.tileID.key][t.id]);q?q.splice(q.length-1,0,U):this.proxyToSource[O.tileID.key][t.id]=[U];const G=this.proxyToSource[O.tileID.key][t.id];I.has(G)||I.add(G),x.push(U),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const k of I)k.sort((D,O)=>O.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(t,c,p){if(!t.getSource().loaded())return;const x=this.proxiedCoords[t.id]=[],S=this.proxyCoords,T=t.getSource(),I=T.tileID;if(!I)return;const k=new s.P(I.x,I.y)._div(1<<I.z),D=T.coordinates.map(s.ae.fromLngLat).reduce((q,U)=>(q.min.x=Math.min(q.min.x,U.x-k.x),q.min.y=Math.min(q.min.y,U.y-k.y),q.max.x=Math.max(q.max.x,U.x-k.x),q.max.y=Math.max(q.max.y,U.y-k.y),q),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(q,U)=>{const G=q.wrap+q.canonical.x/(1<<q.canonical.z),J=q.canonical.y/(1<<q.canonical.z),Y=s.al/(1<<q.canonical.z),te=U.wrap+U.canonical.x/(1<<U.canonical.z),le=U.canonical.y/(1<<U.canonical.z);return G+Y<te+D.min.x||G>te+D.max.x||J+Y<le+D.min.y||J>le+D.max.y};for(let q=0;q<S.length;q++){const U=S[q];for(let G=0;G<c.length;G++){const J=t.getTile(c[G]);if(!J||!J.hasData()||O(U,J.tileID))continue;const Y=this._createProxiedId(U,J,p[U.key]&&p[U.key][t.id]),te=this.proxyToSource[U.key][t.id];te?te.push(Y):this.proxyToSource[U.key][t.id]=[Y],x.push(Y)}}}_createProxiedId(t,c,p){let x=this.orthoMatrix;if(p){const S=p.find(T=>T.key===c.tileID.key);if(S)return S}if(c.tileID.key!==t.key){const S=t.canonical.z-c.tileID.canonical.z;let T,I,k;x=s.bC();const D=c.tileID.wrap-t.wrap<<t.overscaledZ;S>0?(T=s.al>>S,I=T*((c.tileID.canonical.x<<S)-t.canonical.x+D),k=T*((c.tileID.canonical.y<<S)-t.canonical.y)):(T=s.al<<-S,I=s.al*(c.tileID.canonical.x-(t.canonical.x+D<<-S)),k=s.al*(c.tileID.canonical.y-(t.canonical.y<<-S))),s.ce(x,0,T,0,T,0,1),s.br(x,x,[I,k,0])}return new ih(c.tileID,t.key,x)}_findTileCoveringTileID(t,c){let p=c.getTile(t);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],S=x[t.key];if(p=S?c.getTileByID(S):null,p&&p.hasData()||S===null)return p;let T=p?p.tileID:t,I=T.overscaledZ;const k=c.getSource().minzoom,D=[];if(!S){const q=c.getSource().maxzoom;if(t.canonical.z>=q){const U=t.canonical.z-q;c.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,c.transform.tileZoom),T=new s.aQ(I,t.wrap,q,t.canonical.x>>U,t.canonical.y>>U)):U!==0&&(I=q,T=new s.aQ(I,t.wrap,q,t.canonical.x>>U,t.canonical.y>>U))}T.key!==t.key&&(D.push(T.key),p=c.getTile(T))}const O=q=>{D.forEach(U=>{x[U]=q}),D.length=0};for(I-=1;I>=k&&(!p||!p.hasData());I--){p&&O(p.tileID.key);const q=T.calculateScaledKey(I);if(p=c.getTileByID(q),p&&p.hasData())break;const U=x[q];if(U===null)break;U===void 0?D.push(q):p=c.getTileByID(U)}return O(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,c){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[c.key]=!0}}function Ho(f,t,c){const p=(function(I,k,D){const O=s.bJ(k,I),q=s.bJ(D,[.2126,.7152,.0722]),U=(J,Y,te)=>(1-te)*J+te*Y,G=U(1-.3*Math.min(q,1),1,Math.min(O+1,1));return U(.92,1,Math.asin(s.aA(k[2],-1,1))/Math.PI+.5)*G})(f,[0,0,1],t),x=[0,0,0];s.c5(x,c.slice(0,3),p);const S=[0,0,0];s.c5(S,t.slice(0,3),f[2]);const T=[0,0,0];return s.d8(T,x,S),s.db(T)}const Yu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Pc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class cc{static cacheKey(t,c,p,x){const S=[c];x&&S.push(x.cacheKey);for(const T of p)t.usedDefines.has(T)&&S.push(T);return S.join("/")}constructor(t,c,p,x,S,T){const I=t.gl;this.program=I.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...T];const k=`#version 300 es
${(x?x.defines():[]).concat(T.map(Y=>`#define ${Y}`)).join(`
`)}`,D=[k,lf];for(const Y of p.fragmentIncludes)D.push(Cc[Y]);D.push(p.fragmentSource);const O=D.join(`
`),q=[k,km];for(const Y of p.vertexIncludes)q.push(Cc[Y]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&q.push("uniform int u_instanceID;"),q.push(p.vertexSource);let U=q.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const G=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(G,O),I.compileShader(G),I.attachShader(this.program,G);const J=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(J,U),I.compileShader(J),I.attachShader(this.program,J),this.attributes={},I.linkProgram(this.program),I.deleteShader(J),I.deleteShader(G),this.fixedUniforms=S(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=x?x.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new s.ch(Y)}))(t)),(T.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(Y=>({u_dem:new s.ch(Y),u_dem_prev:new s.ch(Y),u_dem_tl:new s.ck(Y),u_dem_scale:new s.cj(Y),u_dem_tl_prev:new s.ck(Y),u_dem_scale_prev:new s.cj(Y),u_dem_size:new s.cj(Y),u_dem_lerp:new s.cj(Y),u_exaggeration:new s.cj(Y),u_depth:new s.ch(Y),u_depth_size_inv:new s.ck(Y),u_depth_range_unpack:new s.ck(Y),u_occluder_half_size:new s.cj(Y),u_occlusion_depth_offset:new s.cj(Y),u_meter_to_dem:new s.cj(Y),u_label_plane_matrix_inv:new s.cl(Y)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new s.ci(Y),u_tile_tr_up:new s.ci(Y),u_tile_br_up:new s.ci(Y),u_tile_bl_up:new s.ci(Y),u_tile_up_scale:new s.cj(Y)}))(t)),T.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new s.cl(Y),u_fog_range:new s.ck(Y),u_fog_color:new s.d3(Y),u_fog_horizon_blend:new s.cj(Y),u_fog_vertical_limit:new s.ck(Y),u_fog_temporal_offset:new s.cj(Y),u_frustum_tl:new s.ci(Y),u_frustum_tr:new s.ci(Y),u_frustum_br:new s.ci(Y),u_frustum_bl:new s.ci(Y),u_globe_pos:new s.ci(Y),u_globe_radius:new s.cj(Y),u_globe_transition:new s.cj(Y),u_is_globe:new s.ch(Y),u_viewport:new s.ck(Y)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new s.d3(Y)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new s.ci(Y),u_lighting_directional_dir:new s.ci(Y),u_lighting_directional_color:new s.ci(Y),u_ground_radiance:new s.ci(Y)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new s.cl(Y),u_light_matrix_1:new s.cl(Y),u_fade_range:new s.ck(Y),u_shadow_normal_offset:new s.ci(Y),u_shadow_intensity:new s.cj(Y),u_shadow_texel_size:new s.cj(Y),u_shadow_map_resolution:new s.cj(Y),u_shadow_direction:new s.ci(Y),u_shadow_bias:new s.ci(Y),u_shadowmap_0:new s.ch(Y),u_shadowmap_1:new s.ch(Y)}))(t)))}getAttributeLocation(t,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=t.getAttribLocation(this.program,c)),p}setTerrainUniformValues(t,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(t,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(t,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(t,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(t,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(t,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;t.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(t,c,p,x,S,T,I,k,D,O){const q=t.options.wireframe;if(q.terrain===!1&&q.layers2D===!1&&q.layers3D===!1)return;const U=t.context;if(!(!(!q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!q.layers2D||t._terrain&&t._terrain.renderingToTexture||!Yu.includes(this.name))||!(!q.layers3D||!Pc.includes(this.name))))return;const G=U.gl,J=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,S,U);if(!J)return;const Y=[...this.fixedDefines,"DEBUG_WIREFRAME"],te=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});U.program.set(te.program);const le=(de,Ne,Ce)=>{if(Ne[de]&&Ce[de])for(const ke in Ne[de])Ce[de][ke]&&Ce[de][ke].set(Ce.program,ke,Ne[de][ke].current)};D&&D.setUniforms(te.program,U,te.binderUniforms,I,{zoom:k}),le("fixedUniforms",this,te),le("terrainUniforms",this,te),le("globeUniforms",this,te),le("fogUniforms",this,te),le("lightsUniforms",this,te),le("shadowUniforms",this,te),J.bind(),U.setColorMode(new Jr([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],s.ao.transparent,[!0,!0,!0,!1])),U.setDepthMode(new _r(c.func===G.LESS?G.LEQUAL:c.func,_r.ReadOnly,c.range)),U.setStencilMode(Xr.disabled);const ge=3*T.primitiveLength*2,pe=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const de=O||1;for(let Ne=0;Ne<de;++Ne)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ne),G.drawElements(G.LINES,ge,G.UNSIGNED_SHORT,pe)}else O&&O>1?G.drawElementsInstanced(G.LINES,ge,G.UNSIGNED_SHORT,pe,O):G.drawElements(G.LINES,ge,G.UNSIGNED_SHORT,pe);S.bind(),U.program.set(this.program),U.setDepthMode(c),U.setStencilMode(p),U.setColorMode(x)}checkUniforms(t,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${x} not set but required by ${c} being defined`)}}draw(t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te){const le=t.context,ge=le.gl;if(this.failedToCreate)return;le.program.set(this.program),le.setDepthMode(p),le.setStencilMode(x),le.setColorMode(S),le.setCullFace(T);for(const[Te,_e]of this.fixedUniformsEntries)_e.set(this.program,Te,I[Te]);J&&J.setUniforms(this.program,le,this.binderUniforms,U,{zoom:G});const pe={[ge.POINTS]:1,[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[c];this.checkUniforms(k,"RENDER_SHADOWS",this.shadowUniforms);const de=Y||[],Ne=J?J.getPaintVertexBuffers():[],Ce=c===ge.TRIANGLES&&O,ke=te&&te>0?1:void 0;for(const Te of q.get()){const _e=Te.vaos||(Te.vaos={});if((_e[k]||(_e[k]=new Zd)).bind(le,this,D,Ne,O,Te.vertexOffset,de,ke),this.forceManualRenderingForInstanceIDShaders){const Me=te||1;for(let Ue=0;Ue<Me;++Ue)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ue),O?ge.drawElements(c,Te.primitiveLength*pe,ge.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):ge.drawArrays(c,Te.vertexOffset,Te.vertexLength)}else te&&te>1?ge.drawElementsInstanced(c,Te.primitiveLength*pe,ge.UNSIGNED_SHORT,Te.primitiveOffset*pe*2,te):O?ge.drawElements(c,Te.primitiveLength*pe,ge.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):ge.drawArrays(c,Te.vertexOffset,Te.vertexLength);Ce&&this._drawDebugWireframe(t,p,x,S,O,Te,U,G,J,te)}}}function du(f,t,c=0){const p=Math.pow(2,t.tileID.overscaledZ),x=t.tileSize*Math.pow(2,f.transform.tileZoom)/p,S=x*(t.tileID.canonical.x+t.tileID.wrap*p),T=x*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(t,1,f.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T],u_pattern_transition:c}}const mf={terrain:0,flat:1},Lm=s.bC(),sh=(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le)=>{const ge=t.style.light,pe=ge.properties.get("position"),de=[pe.x,pe.y,pe.z],Ne=s.dO();ge.properties.get("anchor")==="viewport"&&(s.dP(Ne,-t.transform.angle),s.dQ(de,de,Ne));const Ce=ge.properties.get("color").toPremultipliedRenderColor(null),ke=t.transform,Te={u_matrix:f,u_lightpos:de,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:mf[D],u_base_type:mf[O],u_ao:x,u_edge_radius:S,u_width_scale:T,u_flood_light_color:J,u_vertical_scale:Y,u_flood_light_intensity:te,u_ground_shadow_factor:le};return ke.projection.name==="globe"&&(Te.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Te.u_zoom_transition=q,Te.u_inv_rot_matrix=G,Te.u_merc_center=U,Te.u_up_dir=ke.projection.upVector(new s.cD(0,0,0),U[0]*s.al,U[1]*s.al),Te.u_height_lift=k),Te},Ta=(f,t,c,p,x,S)=>({u_matrix:f,u_edge_radius:t,u_width_scale:c,u_vertical_scale:p,u_height_type:mf[x],u_base_type:mf[S]}),Ba=(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le)=>{const ge=sh(f,t,c,p,x,S,T,I,D,O,q,U,G,J,Y,te,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,I.overscaledZ)/k.tileSize/8};return Object.assign(ge,du(t,k,le),pe)},ds=(f,t,c)=>({u_matrix:f,u_emissive_strength:t,u_ground_shadow_factor:c}),Ka=(f,t,c,p,x,S=0)=>Object.assign(ds(f,t,x),du(c,p,S)),Dm=(f,t,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:t,u_ground_shadow_factor:p}),Om=(f,t,c,p,x,S,T=0)=>Object.assign(Ka(f,t,c,p,S,T),{u_world:x}),gf=(f,t)=>({u_matrix:f,u_depth_bias:t}),uc=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t}),hu=(f,t,c,p,x)=>({u_matrix:f,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),Qu=(f,t,c,p,x,S,T,I,k)=>({u_matrix:f,u_normal_matrix:t,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:S,u_facade_emissive_chance:T,u_flood_light_color:I,u_flood_light_intensity:k}),zm=f=>({u_matrix:f}),Ya=f=>({u_matrix:f}),yf=(f,t,c,p,x,S,T,I)=>{const k=s.al/S.tileSize;return{u_matrix:f,u_inv_rot_matrix:t,u_camera_to_center_distance:c.getCameraToCenterDistance(I),u_extrude_scale:[c.pixelsToGLUnits[0]/k,c.pixelsToGLUnits[1]/k],u_zoom_transition:p,u_tile_id:T,u_merc_center:x}},Sp=(f,t,c,p)=>({u_matrix:f,u_inv_matrix:t,u_camera_to_center_distance:c.getCameraToCenterDistance(p),u_viewport_size:[c.width,c.height]}),Ju=(f,t,c=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:c}),_f=s.bC(),Tp=(f,t,c,p,x,S,T)=>{const I=f.transform,k=I.projection.name==="globe",D=k?s.dR(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:s.ay(c,1,S),O={u_matrix:t.projMatrix,u_extrude_scale:D,u_intensity:T,u_inv_rot_matrix:_f,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){O.u_inv_rot_matrix=p,O.u_merc_center=x,O.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],O.u_zoom_transition=s.aj(I.zoom);const q=x[0]*s.al,U=x[1]*s.al;O.u_up_dir=I.projection.upVector(new s.cD(0,0,0),q,U)}return O};function xf(f,[t,c,p,x],[S,T]){if(S===T)return[0,0,0,0];const I=255*(f-1)/(f*(T-S));return[t*I,c*I,p*I,x*I]}function ed(f,t,[c,p]){return c===p?0:.5/f+(t-c)*(f-1)/(f*(p-c))}const Ep=(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le,ge,pe,de)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:D,u_fade_t:O.mix,u_opacity:O.opacity*q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:q.paint.get("raster-brightness-min"),u_brightness_high:q.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(q.paint.get("raster-saturation")),u_contrast_factor:s.dS(q.paint.get("raster-contrast")),u_spin_weights:fu(q.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:G,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:k,u_colorization_mix:xf(s.dU,Y,le),u_colorization_offset:ed(s.dU,te,le),u_color_ramp:J,u_texture_offset:[pe/(ge+2*pe),ge/(ge+2*pe)],u_texture_res:[ge+2*pe,ge+2*pe],u_emissive_strength:de});function fu(f){f*=Math.PI/180;const t=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*t-c+1)/3,(Math.sqrt(3)*t-c+1)/3]}const kc=.05,oh=(f,t,c,p,x,S,T,I,k,D,O,q)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:D,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:k}),Cp=(f,t,c,p,x,S,T,I,k,D)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_tile_offset:c,u_velocity:p,u_color_ramp:S,u_velocity_res:x,u_max_speed:T,u_uv_offset:I,u_data_scale:[255*k[0],255*k[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[kc,kc]}),Fm=(f,t,c,p,x,S,T,I,k,D)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:S,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*k[0],255*k[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[kc,kc]}),ah=s.bC(),td=(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le,ge,pe,de,Ne,Ce,ke)=>{const Te=x.transform,_e={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Te.getCameraToCenterDistance(ge),u_rotate_symbol:+c,u_aspect_ratio:Te.width/Te.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+D,u_elevation_from_sea:k?1:0,u_pitch_with_map:+p,u_texsize:O,u_texsize_icon:q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ah,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ah,u_up_vector:[0,-1,0],u_color_adj_mat:Ne,u_icon_transition:Ce||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(ge)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ke||1,u_ground_shadow_factor:pe,u_inv_matrix:s.bl(s.bC(),T),u_normal_scale:de,u_lutTexture:10};return ge.name==="globe"&&(_e.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],_e.u_zoom_transition=J,_e.u_inv_rot_matrix=te,_e.u_merc_center=Y,_e.u_camera_forward=Te._camera.forward(),_e.u_ecef_origin=s.dV(Te.globeMatrix,G.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(Te.globeMatrix),_e.u_up_vector=le),_e},Qa=(f,t,c,p)=>({u_matrix:f,u_emissive_strength:t,u_opacity:c,u_color:p}),la=(f,t,c,p,x,S,T,I,k)=>Object.assign((function(D,O,q,U,G,J){const{width:Y,height:te}=U.imageManager.getPixelSize(O),le=Math.pow(2,J.tileID.overscaledZ),ge=J.tileSize*Math.pow(2,U.transform.tileZoom)/le,pe=ge*(J.tileID.canonical.x+J.tileID.wrap*le),de=ge*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:q.tl,u_pattern_br:q.br,u_texsize:[Y,te],u_pattern_size:q.displaySize,u_pattern_units_to_pixels:G?[U.transform.width,-1*U.transform.height]:[1/s.ay(J,1,U.transform.tileZoom),1/s.ay(J,1,U.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,de>>16],u_pixel_coord_lower:[65535&pe,65535&de]}})(0,S,T,p,I,k),{u_matrix:f,u_emissive_strength:t,u_opacity:c}),Ja=new Float32Array(s.bA([])),lh=(f,t,c,p,x,S,T,I,k,D,O,q,U,G=[0,0,0],J,Y,te)=>{const le=x.style.light,ge=le.properties.get("position"),pe=[-ge.x,-ge.y,ge.z],de=s.dO();le.properties.get("anchor")==="viewport"&&(s.dP(de,-x.transform.angle),s.dQ(pe,pe,de));const Ne=O.alphaMode==="MASK",Ce=le.properties.get("color").toNonPremultipliedRenderColor(null),ke=U.paint.get("model-ambient-occlusion-intensity"),Te=U.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return Te.a=U.paint.get("model-color-mix-intensity").constantOr(0),te&&(Te.r=te[0],Te.g=te[1],Te.b=te[2],Te.a=te[3]),Y&&(Te.r=Y.color.r,Te.g=Y.color.g,Te.b=Y.color.b,Te.a=Y.colorMix,q=Y.emissionStrength,S*=Y.opacity),{u_matrix:f,u_lighting_matrix:t,u_normal_matrix:c,u_node_matrix:p||Ja,u_lightpos:pe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_camera_pos:G,u_opacity:S,u_baseTextureIsAlpha:0,u_alphaMask:+Ne,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:k,u_roughnessFactor:D,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:Te.toArray01(),u_aoIntensity:ke,u_emissive_strength:q,u_occlusionTextureTransform:J||[0,0,0,0]}},ch=(f,t=Ja,c=Ja)=>({u_matrix:f,u_instance:t,u_node_matrix:c}),cl={fillExtrusion:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_opacity:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_flood_light_color:new s.ci(f),u_vertical_scale:new s.cj(f),u_flood_light_intensity:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new s.cl(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_vertical_scale:new s.cj(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_vertical_gradient:new s.cj(f),u_height_factor:new s.cj(f),u_edge_radius:new s.cj(f),u_width_scale:new s.cj(f),u_ao:new s.ck(f),u_height_type:new s.ch(f),u_base_type:new s.ch(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_up_dir:new s.ci(f),u_height_lift:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_opacity:new s.cj(f),u_pattern_transition:new s.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.cl(f),u_opacity:new s.cj(f),u_ao_pass:new s.cj(f),u_meter_to_tile:new s.cj(f),u_ao:new s.ck(f),u_flood_light_intensity:new s.cj(f),u_flood_light_color:new s.ci(f),u_attenuation:new s.cj(f),u_edge_radius:new s.cj(f),u_fb:new s.ch(f),u_fb_size:new s.cj(f),u_dynamic_offset:new s.cj(f)}),fill:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_ground_shadow_factor:new s.ci(f)}),fillPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),fillOutline:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_ground_shadow_factor:new s.ci(f)}),fillOutlinePattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_world:new s.ck(f),u_image:new s.ch(f),u_texsize:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_tile_units_to_pixels:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_pattern_transition:new s.cj(f)}),building:f=>({u_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_opacity:new s.cj(f),u_faux_facade_ao_intensity:new s.cj(f),u_camera_pos:new s.ci(f),u_tile_to_meter:new s.cj(f),u_facade_emissive_chance:new s.cj(f),u_flood_light_color:new s.ci(f),u_flood_light_intensity:new s.cj(f)}),buildingBloom:f=>({u_matrix:new s.cl(f)}),buildingDepth:f=>({u_matrix:new s.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new s.cl(f),u_depth_bias:new s.cj(f)}),elevatedStructures:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new s.cl(f),u_camera_pos:new s.ci(f),u_depth_bias:new s.cj(f),u_height_scale:new s.cj(f),u_reset_depth:new s.cj(f)}),circle:s.dY,collisionBox:f=>({u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_extrude_scale:new s.ck(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f)}),collisionCircle:f=>({u_matrix:new s.cl(f),u_inv_matrix:new s.cl(f),u_camera_to_center_distance:new s.cj(f),u_viewport_size:new s.ck(f)}),debug:f=>({u_color:new s.dB(f),u_matrix:new s.cl(f),u_overlay:new s.ch(f),u_overlay_scale:new s.cj(f)}),clippingMask:f=>({u_matrix:new s.cl(f)}),heatmap:f=>({u_extrude_scale:new s.cj(f),u_intensity:new s.cj(f),u_matrix:new s.cl(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_up_dir:new s.ci(f)}),heatmapTexture:f=>({u_image:new s.ch(f),u_color_ramp:new s.ch(f),u_opacity:new s.cj(f)}),hillshade:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_latrange:new s.ck(f),u_light:new s.ck(f),u_shadow:new s.dB(f),u_highlight:new s.dB(f),u_emissive_strength:new s.cj(f),u_accent:new s.dB(f)}),hillshadePrepare:f=>({u_matrix:new s.cl(f),u_image:new s.ch(f),u_dimension:new s.ck(f),u_zoom:new s.cj(f)}),line:s.dX,linePattern:s.dW,raster:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_brightness_low:new s.cj(f),u_brightness_high:new s.cj(f),u_saturation_factor:new s.cj(f),u_contrast_factor:new s.cj(f),u_spin_weights:new s.ci(f),u_perspective_transform:new s.ck(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f),u_colorization_mix:new s.d3(f),u_colorization_offset:new s.cj(f),u_color_ramp:new s.ch(f),u_texture_offset:new s.ck(f),u_texture_res:new s.ck(f),u_emissive_strength:new s.cj(f)}),rasterParticle:f=>({u_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_grid_matrix:new s.dC(f),u_tl_parent:new s.ck(f),u_scale_parent:new s.cj(f),u_fade_t:new s.cj(f),u_opacity:new s.cj(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_raster_elevation:new s.cj(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_cutoff_params:new s.d3(f)}),rasterParticleTexture:f=>({u_texture:new s.ch(f),u_opacity:new s.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_tile_offset:new s.ck(f),u_velocity:new s.ch(f),u_color_ramp:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.ch(f),u_particle_texture_side_len:new s.cj(f),u_velocity:new s.ch(f),u_velocity_res:new s.ck(f),u_max_speed:new s.cj(f),u_speed_factor:new s.cj(f),u_reset_rate:new s.cj(f),u_rand_seed:new s.cj(f),u_uv_offset:new s.ck(f),u_data_scale:new s.ck(f),u_data_offset:new s.cj(f),u_particle_pos_scale:new s.cj(f),u_particle_pos_offset:new s.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new s.ch(f),u_is_size_feature_constant:new s.ch(f),u_size_t:new s.cj(f),u_size:new s.cj(f),u_camera_to_center_distance:new s.cj(f),u_rotate_symbol:new s.ch(f),u_aspect_ratio:new s.cj(f),u_fade_change:new s.cj(f),u_matrix:new s.cl(f),u_label_plane_matrix:new s.cl(f),u_coord_matrix:new s.cl(f),u_is_text:new s.ch(f),u_elevation_from_sea:new s.ch(f),u_pitch_with_map:new s.ch(f),u_texsize:new s.ck(f),u_texsize_icon:new s.ck(f),u_texture:new s.ch(f),u_texture_icon:new s.ch(f),u_gamma_scale:new s.cj(f),u_device_pixel_ratio:new s.cj(f),u_tile_id:new s.ci(f),u_zoom_transition:new s.cj(f),u_inv_rot_matrix:new s.cl(f),u_merc_center:new s.ck(f),u_camera_forward:new s.ci(f),u_tile_matrix:new s.cl(f),u_up_vector:new s.ci(f),u_ecef_origin:new s.ci(f),u_is_halo:new s.ch(f),u_icon_transition:new s.cj(f),u_color_adj_mat:new s.cl(f),u_scale_factor:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_inv_matrix:new s.cl(f),u_normal_scale:new s.cj(f),u_lutTexture:new s.ch(f)}),background:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_color:new s.dB(f)}),backgroundPattern:f=>({u_matrix:new s.cl(f),u_emissive_strength:new s.cj(f),u_opacity:new s.cj(f),u_image:new s.ch(f),u_pattern_tl:new s.ck(f),u_pattern_br:new s.ck(f),u_texsize:new s.ck(f),u_pattern_size:new s.ck(f),u_pixel_coord_upper:new s.ck(f),u_pixel_coord_lower:new s.ck(f),u_pattern_units_to_pixels:new s.ck(f)}),terrainRaster:f=>({u_matrix:new s.cl(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_skirt_height:new s.cj(f),u_ground_shadow_factor:new s.ci(f),u_emissive_texture_available:new s.cj(f)}),skybox:f=>({u_matrix:new s.cl(f),u_sun_direction:new s.ci(f),u_cubemap:new s.ch(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxGradient:f=>({u_matrix:new s.cl(f),u_color_ramp:new s.ch(f),u_center_direction:new s.ci(f),u_radius:new s.cj(f),u_opacity:new s.cj(f),u_temporal_offset:new s.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new s.dC(f),u_sun_direction:new s.ci(f),u_sun_intensity:new s.cj(f),u_color_tint_r:new s.d3(f),u_color_tint_m:new s.d3(f),u_luminance:new s.cj(f)}),globeRaster:f=>({u_proj_matrix:new s.cl(f),u_globe_matrix:new s.cl(f),u_normalize_matrix:new s.cl(f),u_merc_matrix:new s.cl(f),u_zoom_transition:new s.cj(f),u_merc_center:new s.ck(f),u_image0:new s.ch(f),u_image1:new s.ch(f),u_grid_matrix:new s.dC(f),u_skirt_height:new s.cj(f),u_far_z_cutoff:new s.cj(f),u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_globe_pos:new s.ci(f),u_globe_radius:new s.cj(f),u_viewport:new s.ck(f),u_emissive_texture_available:new s.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.ci(f),u_frustum_tr:new s.ci(f),u_frustum_br:new s.ci(f),u_frustum_bl:new s.ci(f),u_horizon:new s.cj(f),u_transition:new s.cj(f),u_fadeout_range:new s.cj(f),u_atmosphere_fog_color:new s.d3(f),u_high_color:new s.d3(f),u_space_color:new s.d3(f),u_temporal_offset:new s.cj(f),u_horizon_angle:new s.cj(f)}),model:f=>({u_matrix:new s.cl(f),u_lighting_matrix:new s.cl(f),u_normal_matrix:new s.cl(f),u_node_matrix:new s.cl(f),u_lightpos:new s.ci(f),u_lightintensity:new s.cj(f),u_lightcolor:new s.ci(f),u_camera_pos:new s.ci(f),u_opacity:new s.cj(f),u_baseColorFactor:new s.d3(f),u_emissiveFactor:new s.d3(f),u_metallicFactor:new s.cj(f),u_roughnessFactor:new s.cj(f),u_baseTextureIsAlpha:new s.ch(f),u_alphaMask:new s.ch(f),u_alphaCutoff:new s.cj(f),u_baseColorTexture:new s.ch(f),u_metallicRoughnessTexture:new s.ch(f),u_normalTexture:new s.ch(f),u_occlusionTexture:new s.ch(f),u_emissionTexture:new s.ch(f),u_lutTexture:new s.ch(f),u_color_mix:new s.d3(f),u_aoIntensity:new s.cj(f),u_emissive_strength:new s.cj(f),u_occlusionTextureTransform:new s.d3(f)}),modelDepth:f=>({u_matrix:new s.cl(f),u_instance:new s.cl(f),u_node_matrix:new s.cl(f)}),groundShadow:f=>({u_matrix:new s.cl(f),u_ground_shadow_factor:new s.ci(f)}),stars:f=>({u_matrix:new s.cl(f),u_up:new s.ci(f),u_right:new s.ci(f),u_intensity_multiplier:new s.cj(f)}),snowParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_horizontalOscillationRadius:new s.cj(f),u_horizontalOscillationRate:new s.cj(f),u_boxSize:new s.cj(f),u_billboardSize:new s.cj(f),u_simpleShapeParameters:new s.ck(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_particleColor:new s.d3(f),u_direction:new s.ci(f)}),rainParticle:f=>({u_modelview:new s.cl(f),u_projection:new s.cl(f),u_time:new s.cj(f),u_cam_pos:new s.ci(f),u_texScreen:new s.ch(f),u_velocityConeAperture:new s.cj(f),u_velocity:new s.cj(f),u_boxSize:new s.cj(f),u_rainDropletSize:new s.ck(f),u_distortionStrength:new s.cj(f),u_rainDirection:new s.ci(f),u_color:new s.d3(f),u_screenSize:new s.ck(f),u_thinningCenterPos:new s.ck(f),u_thinningShape:new s.ci(f),u_thinningAffectedRatio:new s.cj(f),u_thinningParticleOffset:new s.cj(f),u_shapeDirectionalPower:new s.cj(f),u_shapeNormalPower:new s.cj(f),u_mode:new s.cj(f)}),vignette:f=>({u_vignetteShape:new s.ci(f),u_vignetteColor:new s.d3(f)}),occlusion:f=>({u_matrix:new s.cl(f),u_anchorPos:new s.ci(f),u_screenSizePx:new s.ck(f),u_occluderSizePx:new s.ck(f),u_color:new s.d3(f)})};class Zo{constructor(t,c,p,x){this.id=Zo.uniqueIdxCounter,Zo.uniqueIdxCounter++,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Zo.uniqueIdxCounter,Zo.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Zo.uniqueIdxCounter=0;const Ap={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gg{constructor(t,c,p,x,S,T){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||S||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,c){for(let p=0;p<this.attributes.length;p++){const x=c.getAttributeLocation(t,this.attributes[p].name);x!==-1&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,c,p){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],T=c.getAttributeLocation(t,S.name);T!==-1&&t.vertexAttribPointer(T,S.components,t[Ap[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(t,c,p){for(let x=0;x<this.attributes.length;x++){const S=c.getAttributeLocation(t,this.attributes[x].name);S!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(S,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ea{constructor(t,c,p,x,S){this.context=t,this.width=c,this.height=p;const T=this.framebuffer=t.gl.createFramebuffer();x>0&&(this.colorAttachment0=new Ac(t,T,0)),x>1&&(this.colorAttachment1=new Ac(t,T,1)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new go(t,T):new uu(t,T))}createColorAttachment(t,c){c===0?this.colorAttachment0=new Ac(t,this.framebuffer,0):c===1&&(this.colorAttachment1=new Ac(t,this.framebuffer,1))}removeColorAttachment(t,c){const p=this.context.gl;let x;c===0?(x=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(x=this.colorAttachment1.get(),this.colorAttachment1=void 0),x&&p.deleteTexture(x)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&t.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&t.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&t.deleteTexture(c)}t.deleteFramebuffer(this.framebuffer)}}class Ll{constructor(t,c){this.gl=t,this.clearColor=new xp(this),this.clearDepth=new vp(this),this.clearStencil=new uf(this),this.colorMask=new Xd(this),this.depthMask=new df(this),this.stencilMask=new Hu(this),this.stencilFunc=new Zu(this),this.stencilOp=new hf(this),this.stencilTest=new Kd(this),this.depthRange=new bp(this),this.depthTest=new sc(this),this.depthFunc=new jm(this),this.blend=new jl(this),this.blendFunc=new Xa(this),this.blendColor=new au(this),this.blendEquation=new Rl(this),this.cullFace=new Yd(this),this.cullFaceSide=new ff(this),this.frontFace=new qg(this),this.program=new lu(this),this.activeTexture=new Qd(this),this.viewport=new Ml(this),this.bindFramebuffer=new pf(this),this.bindRenderbuffer=new Rm(this),this.bindTexture=new Jd(this),this.bindVertexBuffer=new cu(this),this.bindElementBuffer=new Ts(this),this.bindVertexArrayOES=new vs(this),this.pixelStoreUnpack=new oc(this),this.pixelStoreUnpackPremultiplyAlpha=new Ro(this),this.pixelStoreUnpackFlipY=new Sa(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,c,p){return new Zo(this,t,c,p)}createVertexBuffer(t,c,p,x,S){return new Gg(this,t,c,p,x,S)}createRenderbuffer(t,c,p){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,t,c,p),this.bindRenderbuffer.set(null),S}createFramebuffer(t,c,p,x){return new Ea(this,t,c,p,x)}clear({color:t,depth:c,stencil:p,colorMask:x}){const S=this.gl;let T=0;t&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),S.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.by(t.blendFunction,Jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let hr;function Ip(f,t,c,p,x,S,T){const I=f.context,k=I.gl,D=f.transform,O=[s.aF(D.center.lng),s.aJ(D.center.lat)],q=c.layout.get("symbol-placement"),U=c.layout.get("text-variable-anchor"),G=c.layout.get("icon-rotation-alignment")==="map",J=c.layout.get("text-rotation-alignment")==="map",Y=q!=="point",te=[];let le=0,ge=0;for(let Te=0;Te<p.length;Te++){const _e=p[Te],Me=t.getTile(_e),Ue=Me.getBucket(c);if(!Ue)continue;const Ge=Ue.getProjection().createInversionMatrix(D,_e.canonical),it=[],tt=Cm(_e,Ue,D),mt=!T&&G&&Y,Pt=T&&J&&Y,Qe=U&&Ue.hasTextData(),Le=Ue.hasIconTextFit()&&Qe&&Ue.hasIconData(),dt=mt||Pt||T&&Qe||Le,nt=Ue.projection.name==="globe",yt=nt?s.aj(D.zoom):0;nt&&(it.push("PROJECTION_GLOBE_VIEW"),dt&&it.push("PROJECTED_POS_ON_VIEWPORT"));const Dt=f.getOrCreateProgram("collisionBox",{defines:it});let Kt=tt;x[0]===0&&x[1]===0||(Kt=f.translatePosMatrix(tt,Me,x,S));const Ot=T?Ue.textCollisionBox:Ue.iconCollisionBox,Ft=Ue.collisionCircleArray;if(Ft.length>0){const fr=s.bC(),sr=Kt;s.cP(fr,Ue.placementInvProjMatrix,D.glCoordMatrix),s.cP(fr,fr,Ue.placementViewportMatrix),te.push({circleArray:Ft,circleOffset:ge,transform:sr,invTransform:fr,projection:Ue.getProjection()}),le+=Ft.length/4,ge=le}if(!Ot)continue;f.terrain&&f.terrain.setupElevationDraw(Me,Dt);const gr=nt?[_e.canonical.x,_e.canonical.y,1<<_e.canonical.z]:[0,0,0];Dt.draw(f,k.LINES,_r.disabled,Xr.disabled,f.colorModeForRenderPass(),qr.disabled,yf(Kt,Ge,D,yt,O,Me,gr,Ue.getProjection()),c.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,null,D.zoom,null,[Ot.collisionVertexBuffer,Ot.collisionVertexBufferExt])}if(!T||!te.length)return;const pe=f.getOrCreateProgram("collisionCircle"),de=new s.dZ;de.resize(4*le),de._trim();let Ne=0;for(const Te of te)for(let _e=0;_e<Te.circleArray.length/4;_e++){const Me=4*_e,Ue=Te.circleArray[Me+0],Ge=Te.circleArray[Me+1],it=Te.circleArray[Me+2],tt=Te.circleArray[Me+3];de.emplace(Ne++,Ue,Ge,it,tt,0),de.emplace(Ne++,Ue,Ge,it,tt,1),de.emplace(Ne++,Ue,Ge,it,tt,2),de.emplace(Ne++,Ue,Ge,it,tt,3)}(!hr||hr.length<2*le)&&(hr=(function(Te){const _e=2*Te,Me=new s.b0;Me.resize(_e),Me._trim();for(let Ue=0;Ue<_e;Ue++){const Ge=6*Ue;Me.uint16[Ge+0]=4*Ue+0,Me.uint16[Ge+1]=4*Ue+1,Me.uint16[Ge+2]=4*Ue+2,Me.uint16[Ge+3]=4*Ue+2,Me.uint16[Ge+4]=4*Ue+3,Me.uint16[Ge+5]=4*Ue+0}return Me})(le));const Ce=I.createIndexBuffer(hr,!0),ke=I.createVertexBuffer(de,s.d_.members,!0);for(const Te of te){const _e=Sp(Te.transform,Te.invTransform,D,Te.projection);pe.draw(f,k.TRIANGLES,_r.disabled,Xr.disabled,f.colorModeForRenderPass(),qr.disabled,_e,c.id,ke,Ce,s.bg.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,D.zoom)}ke.destroy(),Ce.destroy()}const Va=s.bC();function dc(f){const t=f._camera.getWorldToCamera(f.worldSize,1),c=s.aB([],t,f.globeMatrix);s.bl(c,c);const p=[0,0,0],x=[0,1,0,0];return s.aC(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],s.aw(p,p),p}function uh({width:f,height:t,anchor:c,textOffset:p,textScale:x},S){const{horizontalAlign:T,verticalAlign:I}=s.c1(c),k=-(T-.5)*f,D=-(I-.5)*t,O=s.c2(c,p);return new s.P((k/x+O[0])*S,(D/x+O[1])*S)}function Dl(f,t,c,p,x,S,T,I,k,D){const O=f.text.placedSymbolArray,q=f.text.dynamicLayoutVertexArray,U=f.icon.dynamicLayoutVertexArray,G={},J=f.getProjection(),Y=wc(T,J,x),te=x.elevation,le=J.upVectorScale(T.canonical,x.center.lat,x.worldSize).metersToTile;q.clear();for(let ge=0;ge<O.length;ge++){const pe=O.get(ge),{tileAnchorX:de,tileAnchorY:Ne,numGlyphs:Ce}=pe,ke=pe.hidden||!pe.crossTileID||f.allowVerticalPlacement&&!pe.placedOrientation?null:p[pe.crossTileID];if(ke){let Te=0,_e=0,Me=0;const Ue=f.elevationType==="road";if(te||Ue){const nt=Ue?f.getElevationFeatureForText(ge):null,yt=s.bV.getAtTileOffset(T,new s.P(de,Ne),te,nt),[Dt,Kt,Ot]=J.upVector(T.canonical,de,Ne);Te=yt*Dt*le,_e=yt*Kt*le,Me=yt*Ot*le}let[Ge,it,tt,mt]=Da(pe.projectedAnchorX+Te,pe.projectedAnchorY+_e,pe.projectedAnchorZ+Me,c?Y:S);const Pt=su(x.getCameraToCenterDistance(J),mt);let Qe=s.bM(f.textSizeData,k,pe)*Pt/s.bY;c&&(Qe*=f.tilePixelRatio/I);const Le=uh(ke,Qe);c?({x:Ge,y:it,z:tt}=J.projectTilePoint(de+Le.x,Ne+Le.y,T.canonical),[Ge,it,tt]=Da(Ge+Te,it+_e,tt+Me,S)):(t&&Le._rotate(-x.angle),Ge+=Le.x,it+=Le.y,tt=0);const dt=f.allowVerticalPlacement&&pe.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let nt=0;nt<Ce;nt++)s.bO(q,Ge,it,tt,dt);D&&pe.associatedIconIndex>=0&&(G[pe.associatedIconIndex]={x:Ge,y:it,z:tt,angle:dt})}else ia(Ce,q)}if(D){U.clear();const ge=f.icon.placedSymbolArray;for(let pe=0;pe<ge.length;pe++){const de=ge.get(pe),{numGlyphs:Ne}=de,Ce=G[pe];if(de.hidden||!Ce)ia(Ne,U);else{const{x:ke,y:Te,z:_e,angle:Me}=Ce;for(let Ue=0;Ue<Ne;Ue++)s.bO(U,ke,Te,_e,Me)}}f.icon.dynamicLayoutVertexBuffer.updateData(U)}f.text.dynamicLayoutVertexBuffer.updateData(q)}function pu(f,t,c,p,x,S,T={}){const I=c.paint.get("icon-translate"),k=c.paint.get("text-translate"),D=c.paint.get("icon-translate-anchor"),O=c.paint.get("text-translate-anchor"),q=c.layout.get("icon-rotation-alignment"),U=c.layout.get("text-rotation-alignment"),G=c.layout.get("icon-pitch-alignment"),J=c.layout.get("text-pitch-alignment"),Y=c.layout.get("icon-keep-upright"),te=c.layout.get("text-keep-upright"),le=c.paint.get("icon-color-saturation"),ge=c.paint.get("icon-color-contrast"),pe=c.paint.get("icon-color-brightness-min"),de=c.paint.get("icon-color-brightness-max"),Ne=c.layout.get("symbol-elevation-reference")==="sea",Ce=c.layout.get("icon-image-use-theme")==="none",ke=f.context,Te=ke.gl,_e=f.transform,Me=q==="map",Ue=U==="map",Ge=G==="map",it=J==="map",tt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let mt=!1;const Pt=f.depthModeForSublayer(0,_r.ReadOnly),Qe=new _r(f.context.gl.LEQUAL,_r.ReadOnly,f.depthRangeFor3D),Le=[s.aF(_e.center.lng),s.aJ(_e.center.lat)],dt=c.layout.get("text-variable-anchor"),nt=_e.projection.name==="globe",yt=[],Dt=[0,-1,0];for(const Kt of p){const Ot=t.getTile(Kt),Ft=Ot.getBucket(c);if(!Ft||Ft.projection.name==="mercator"&&nt||Ft.fullyClipped)continue;const gr=Ft.projection.name==="globe",fr=gr?s.aj(_e.zoom):0,sr=wc(Kt,Ft.getProjection(),_e),ar=_e.calculatePixelsToTileUnitsMatrix(Ot),Mr=dt&&Ft.hasTextData(),Gr=Ft.hasIconTextFit()&&Mr&&Ft.hasIconData(),tn=Ft.getProjection().createInversionMatrix(_e,Kt.canonical),Pn=(1<<Ot.tileID.canonical.z)*s.al/f.transform.worldSize,Wr=ri=>{let wn=[0,0,0];if(ri){const mn=f.style.directionalLight,ji=f.style.ambientLight;mn&&ji&&(wn=Vs(f.style,mn,ji))}return wn},Fn=ri=>{_e.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||f.terrain)&&(ri.push("DEPTH_D24"),ri.push("DEPTH_OCCLUSION"))},rn=ri=>{c.lut&&!Ce&&(c.lut.texture||(c.lut.texture=new s.d$(f.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],ke.gl.RGBA8)),ke.activeTexture.set(ke.gl.TEXTURE0+10),c.lut.texture&&c.lut.texture.bind(ke.gl.LINEAR,ke.gl.CLAMP_TO_EDGE),ri.push("APPLY_LUT_ON_GPU"))},oi=()=>{const ri=Me&&c.layout.get("symbol-placement")!=="point",wn=[];Fn(wn),rn(wn);const mn=ri||Gr,ji=Ft.elevationType==="road",es=f.shadowRenderer,Pi=ji&&Ge&&!!es&&es.enabled,Li=Wr(Pi),bo=ji&&Ge&&!f.terrain?Qe:Pt,fa=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ge&&wn.push("PITCH_WITH_MAP_TERRAIN"),gr&&(wn.push("PROJECTION_GLOBE_VIEW"),mn&&wn.push("PROJECTED_POS_ON_VIEWPORT")),fa>0&&Ft.hasAnySecondaryIcon&&wn.push("ICON_TRANSITION"),!Ft.icon.zOffsetVertexBuffer||ji&&f.terrain||wn.push("Z_OFFSET"),le===0&&ge===0&&pe===0&&de===1||wn.push("COLOR_ADJUSTMENT"),Ft.sdfIcons&&wn.push("RENDER_SDF"),Pi&&wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ji&&Ge&&!f.terrain&&Ft.icon.orientationVertexBuffer&&wn.push("ELEVATED_ROADS");const Js=Ft.icon.programConfigurations.get(c.id),Wn=f.getOrCreateProgram("symbol",{config:Js,defines:wn}),$a=Ot.imageAtlasTexture?Ot.imageAtlasTexture.size:[0,0],zs=Ft.iconSizeData,pa=s.bK(zs,_e.zoom),Ia=Ge||!_e.isOrthographic,_=iu(sr,Ot.tileID.canonical,Ge,Me,_e,Ft.getProjection(),ar),w=co(sr,Ot.tileID.canonical,Ge,Me,_e,Ft.getProjection(),ar),P=f.translatePosMatrix(w,Ot,I,D,!0),z=f.translatePosMatrix(sr,Ot,I,D),Z=mn?Va:_,ie=Me&&!Ge&&!ri;let we=Dt;!nt&&!_e.mercatorFromTransition||Me||(we=dc(_e));const Ye=gr?we:Dt,ft=c.getColorAdjustmentMatrix(le,ge,pe,de),Bt=td(zs.kind,pa,ie,Ge,f,z,Z,P,Ne,!1,$a,[0,0],0,Kt,fr,Le,tn,Ye,Ft.getProjection(),Li,Pn,ft,fa,null),vr=Ot.imageAtlasTexture?Ot.imageAtlasTexture:null,Cr=c.layout.get("icon-size").constantOr(0)!==1||Ft.iconsNeedLinear,mr=Ft.sdfIcons||f.options.rotating||f.options.zooming||Cr||Ia?Te.LINEAR:Te.NEAREST,Kr=Ft.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,on=f.terrain&&Ge&&ri?s.bl(s.bC(),_):Va;if(ri&&Ft.icon){const nn=s.bV.getAtTileOffsetFunc(Kt,_e.center.lat,_e.worldSize,Ft.getProjection()),ps=Xs(sr,Ot.tileID.canonical,Ge,Me,_e,Ft.getProjection(),ar),Lt=c.layout.get("icon-size-scale-range"),xt=s.aA(f.scaleFactor,Lt[0],Lt[1]);ii(Ft,sr,f,!1,ps,w,Ge,Y,nn,Kt,xt)}return{program:Wn,buffers:Ft.icon,uniformValues:Bt,atlasTexture:vr,atlasTextureIcon:null,atlasInterpolation:mr,atlasInterpolationIcon:null,isSDF:Ft.sdfIcons,hasHalo:Kr,depthMode:bo,tile:Ot,renderWithShadows:Pi,labelPlaneMatrixInv:on}},hi=()=>{const ri=Ue&&c.layout.get("symbol-placement")!=="point",wn=[],mn=ri||dt||Gr,ji=Ft.elevationType==="road",es=f.shadowRenderer,Pi=ji&&it&&!!es&&es.enabled,Li=Wr(Pi),bo=ji&&it&&!f.terrain?Qe:Pt;f.terrainRenderModeElevated()&&it&&wn.push("PITCH_WITH_MAP_TERRAIN"),gr&&(wn.push("PROJECTION_GLOBE_VIEW"),mn&&wn.push("PROJECTED_POS_ON_VIEWPORT")),!Ft.text.zOffsetVertexBuffer||ji&&f.terrain||wn.push("Z_OFFSET"),Ft.iconsInText&&wn.push("RENDER_TEXT_AND_SYMBOL"),wn.push("RENDER_SDF"),Pi&&wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ji&&it&&!f.terrain&&Ft.text.orientationVertexBuffer&&wn.push("ELEVATED_ROADS"),Fn(wn);const fa=Ft.text.programConfigurations.get(c.id),Js=f.getOrCreateProgram("symbol",{config:fa,defines:wn});let Wn,$a=[0,0],zs=null;const pa=Ft.textSizeData;Ft.iconsInText&&($a=Ot.imageAtlasTexture?Ot.imageAtlasTexture.size:[0,0],zs=Ot.imageAtlasTexture?Ot.imageAtlasTexture:null,Wn=it||!_e.isOrthographic||f.options.rotating||f.options.zooming||pa.kind==="composite"||pa.kind==="camera"?Te.LINEAR:Te.NEAREST);const Ia=Ot.glyphAtlasTexture?Ot.glyphAtlasTexture.size:[0,0],_=c.layout.get("text-size-scale-range"),w=s.aA(f.scaleFactor,_[0],_[1]),P=s.bK(pa,_e.zoom,w),z=iu(sr,Ot.tileID.canonical,it,Ue,_e,Ft.getProjection(),ar),Z=co(sr,Ot.tileID.canonical,it,Ue,_e,Ft.getProjection(),ar),ie=f.translatePosMatrix(Z,Ot,k,O,!0),we=f.translatePosMatrix(sr,Ot,k,O),Ye=mn?Va:z,ft=Ue&&!it&&!ri;let Bt=Dt;!nt&&!_e.mercatorFromTransition||Ue||(Bt=dc(_e));const vr=td(pa.kind,P,ft,it,f,we,Ye,ie,Ne,!0,Ia,$a,0,Kt,fr,Le,tn,gr?Bt:Dt,Ft.getProjection(),Li,Pn,null,null,w),Cr=Ot.glyphAtlasTexture?Ot.glyphAtlasTexture:null,mr=Te.LINEAR,Kr=c.paint.get("text-halo-width").constantOr(1)!==0,on=f.terrain&&it&&ri?s.bl(s.bC(),z):Va;if(ri&&Ft.text){const nn=s.bV.getAtTileOffsetFunc(Kt,_e.center.lat,_e.worldSize,Ft.getProjection()),ps=Xs(sr,Ot.tileID.canonical,it,Ue,_e,Ft.getProjection(),ar);ii(Ft,sr,f,!0,ps,Z,it,te,nn,Kt,w)}return{program:Js,buffers:Ft.text,uniformValues:vr,atlasTexture:Cr,atlasTextureIcon:zs,atlasInterpolation:mr,atlasInterpolationIcon:Wn,isSDF:!0,hasHalo:Kr,depthMode:bo,tile:Ot,renderWithShadows:Pi,labelPlaneMatrixInv:on}},fi=Ft.icon.segments.get().length,On=Ft.text.segments.get().length,un=fi&&!T.onlyText?oi():null,ti=On&&!T.onlyIcons?hi():null,Fi=c.paint.get("icon-opacity").constantOr(1),Bi=c.paint.get("text-opacity").constantOr(1);if(tt&&Ft.canOverlap){mt=!0;const ri=Fi&&!T.onlyText?Ft.icon.segments.get():[],wn=Bi&&!T.onlyIcons?Ft.text.segments.get():[];for(const mn of ri)yt.push({segments:new s.bg([mn]),sortKey:mn.sortKey,state:un});for(const mn of wn)yt.push({segments:new s.bg([mn]),sortKey:mn.sortKey,state:ti})}else T.onlyText||yt.push({segments:Fi?Ft.icon.segments:new s.bg([]),sortKey:0,state:un}),T.onlyIcons||yt.push({segments:Bi?Ft.text.segments:new s.bg([]),sortKey:0,state:ti})}mt&&yt.sort((Kt,Ot)=>Kt.sortKey-Ot.sortKey);for(const Kt of yt){const Ot=Kt.state;if(Ot)if(f.terrain?f.terrain.setupElevationDraw(Ot.tile,Ot.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ot.labelPlaneMatrixInv}):f.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,Ot.program),ke.activeTexture.set(Te.TEXTURE0),Ot.atlasTexture&&Ot.atlasTexture.bind(Ot.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),Ot.atlasTextureIcon&&(ke.activeTexture.set(Te.TEXTURE1),Ot.atlasTextureIcon&&Ot.atlasTextureIcon.bind(Ot.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),Ot.renderWithShadows&&f.shadowRenderer.setupShadows(Ot.tile.tileID.toUnwrapped(),Ot.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Ot.program),Ot.hasHalo){const Ft=Ot.uniformValues;Ft.u_is_halo=1,mu(Ot.buffers,Kt.segments,c,f,Ot.program,Ot.depthMode,x,S,Ft,2),Ft.u_is_halo=0}else{if(Ot.isSDF){const Ft=Ot.uniformValues;Ot.hasHalo&&(Ft.u_is_halo=1,mu(Ot.buffers,Kt.segments,c,f,Ot.program,Ot.depthMode,x,S,Ft,1)),Ft.u_is_halo=0}mu(Ot.buffers,Kt.segments,c,f,Ot.program,Ot.depthMode,x,S,Ot.uniformValues,1)}}}function mu(f,t,c,p,x,S,T,I,k,D){const O=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,S,T,I,qr.disabled,k,c.id,f.layoutVertexBuffer,f.indexBuffer,t,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),O,D)}function Nc(f,t){const c=1<<f.canonical.z,p=(t.x*c-f.canonical.x-f.wrap*c)*s.al,x=(t.y*c-f.canonical.y)*s.al,S=s.e8(t.z,t.y);return s.d5(p,x,S)}function vf(f,t,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const S=f.context.gl,T=new _r(f.context.gl.LEQUAL,_r.ReadWrite,f.depthRangeFor3D),I=new _r(f.context.gl.GREATER,_r.ReadWrite,f.depthRangeFor3D),k=(function(G){let J=.01;return G.isOrthographic&&(J=s.ak(1e-4,J,s.d0(G.pitch>=ol?1:G.pitch/ol))),2*J})(f.transform),D=f.transform.getFreeCameraOptions().position,O="elevatedStructuresDepthReconstruct",q=f.getOrCreateProgram(O,{defines:["DEPTH_RECONSTRUCTION"]}),U=f.getOrCreateProgram(O);for(const G of p){const J=t.getTile(G),Y=J.getBucket(c);if(!Y)continue;const te=Y.elevatedStructures;if(!te)continue;const le=Y.elevationBufferData.heightRange,ge=Nc(G.toUnwrapped(),D),pe=f.translatePosMatrix(G.projMatrix,J,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let de,Ne,Ce,ke;if(x==="initialize"){if(!le||le.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;de=hu(pe,ge,k,1,0),Ne=T,Ce=te.depthSegments,ke=q}else if(x==="reset"){if(!le||le.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;de=hu(pe,ge,0,0,1),Ne=I,Ce=te.maskSegments,ke=q}else if(x==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;de=hu(pe,ge,k,1,0),Ne=T,Ce=te.depthSegments,ke=U}ke.draw(f,S.TRIANGLES,Ne,Xr.disabled,Jr.disabled,qr.disabled,de,c.id,te.vertexBuffer,te.indexBuffer,Ce,c.paint,f.transform.zoom)}}function Ol(f,t,c,p){const{painter:x,sourceCache:S,layer:T,coords:I,colorMode:k,elevationType:D,terrainEnabled:O,pass:q}=f,U=x.context.gl,G=T.paint.get("fill-pattern"),J=T.paint.get("fill-pattern-cross-fade"),Y=G.constantOr(null);let te=D;D!=="road"||t&&!O||(te="none");const le=te==="road",ge=f.painter.shadowRenderer,pe=le&&!!ge&&ge.enabled,de=new _r(x.context.gl.LEQUAL,_r.ReadOnly,x.depthRangeFor3D);let Ne=[0,0,0];if(pe){const _e=x.style.directionalLight,Me=x.style.ambientLight;_e&&Me&&(Ne=Vs(x.style,_e,Me))}const Ce=G&&G.constantOr(1),ke=x.terrain&&x.terrain.renderingToTexture,Te=(_e,Me)=>{let Ue,Ge,it,tt,mt;Me?(Ue=Ce&&!T.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",it=U.LINES):(Ue=Ce?"fillPattern":"fill",it=U.TRIANGLES);for(const Pt of I){const Qe=S.getTile(Pt);if(Ce&&!Qe.patternsLoaded())continue;const Le=Qe.getBucket(T);if(!Le)continue;const dt=t?Le.elevationBufferData:Le.bufferData;if(dt.isEmpty())continue;x.prepareDrawTile();const nt=dt.programConfigurations.get(T.id),yt=x.isTileAffectedByFog(Pt),Dt=[],Kt=[];le&&(Dt.push("ELEVATED_ROADS"),Kt.push(dt.elevatedLayoutVertexBuffer)),pe&&Dt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ke&&c&&Dt.push("USE_MRT1"),Ce&&(x.context.activeTexture.set(U.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),nt.updatePaintBuffers());let Ot=!1;if(Y&&Qe.imageAtlas){const ar=Qe.imageAtlas,Mr=s.e3.from(Y),Gr=Mr.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),tn=Mr.getSecondary(),Pn=ar.patternPositions.get(Gr),Wr=tn?ar.patternPositions.get(tn.scaleSelf(s.o.devicePixelRatio).toString()):null;Ot=!!Pn&&!!Wr,Pn&&nt.setConstantPatternPositions(Pn,Wr)}J>0&&(Ot||nt.getPatternTransitionVertexBuffer("fill-pattern"))&&Dt.push("FILL_PATTERN_TRANSITION");const Ft=x.getOrCreateProgram(Ue,{config:nt,overrideFog:yt,defines:Dt}),gr=x.translatePosMatrix(Pt.projMatrix,Qe,T.paint.get("fill-translate"),T.paint.get("fill-translate-anchor"));pe&&ge.setupShadows(Qe.tileID.toUnwrapped(),Ft,"vector-tile");const fr=T.paint.get("fill-emissive-strength");if(Me){tt=dt.lineIndexBuffer,mt=dt.lineSegments;const ar=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Ge=Ue==="fillOutlinePattern"&&Ce?Om(gr,fr,x,Qe,ar,Ne,J):Dm(gr,fr,ar,Ne)}else tt=dt.indexBuffer,mt=dt.triangleSegments,Ge=Ce?Ka(gr,fr,x,Qe,Ne,J):ds(gr,fr,Ne);x.uploadCommonUniforms(x.context,Ft,Pt.toUnwrapped());let sr=_e;(D==="road"&&!O||D==="offset")&&(sr=de),Ft.draw(x,it,sr,p||x.stencilModeForClipping(Pt),k,qr.disabled,Ge,T.id,dt.layoutVertexBuffer,tt,mt,T.paint,x.transform.zoom,nt,Kt)}};x.renderPass===q&&Te(x.depthModeForSublayer(1,x.renderPass==="opaque"?_r.ReadWrite:_r.ReadOnly),!1),te==="none"&&x.renderPass==="translucent"&&T.paint.get("fill-antialias")&&Te(x.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,_r.ReadOnly),!0)}function rd(f,t,c,p,x,S,T,I){c.resetLayerRenderingStats(f);const k=f.context,D=k.gl,O=f.transform,q=c.paint.get("fill-extrusion-pattern"),U=c.paint.get("fill-extrusion-pattern-cross-fade"),G=q.constantOr(null),J=q.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),te=f.style.enable3dLights(),le=c.paint.get(te&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ge=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),le],pe=c.layout.get("fill-extrusion-edge-radius"),de=pe>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ne=de?0:pe,Ce=O.projection.name==="globe"?s.eb():0,ke=O.projection.name==="globe",Te=ke?s.aj(O.zoom):0,_e=[s.aF(O.center.lng),s.aJ(O.center.lat)],Me=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ue=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Me?null:c.lut).toArray01().slice(0,3),Ge=c.paint.get("fill-extrusion-flood-light-intensity"),it=c.paint.get("fill-extrusion-vertical-scale"),tt=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,mt=c.paint.get("fill-extrusion-height-alignment"),Pt=c.paint.get("fill-extrusion-base-alignment"),Qe=Ha(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Le=[];let dt;ke&&Le.push("PROJECTION_GLOBE_VIEW"),ge[0]>0&&Le.push("FAUX_AO"),de&&Le.push("ZERO_ROOF_RADIUS"),I&&Le.push("HAS_CENTROID"),Ge>0&&Le.push("FLOOD_LIGHT"),Qe.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),tt&&Le.push("RENDER_WALL_MODE");const nt=f.renderPass==="shadow",yt=f.shadowRenderer,Dt=nt&&!!yt,Kt=nt?qr.disabled:qr.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Ot=[0,0,0];if(yt){const fr=f.style.directionalLight,sr=f.style.ambientLight;fr&&sr&&(Ot=Vs(f.style,fr,sr)),nt||(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),yt.useNormalOffset&&Le.push("NORMAL_OFFSET")),dt=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const Ft=Dt?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",gr=c.getLayerRenderingStats();for(const fr of p){const sr=t.getTile(fr),ar=sr.getBucket(c);if(!ar||ar.projection.name!==O.projection.name)continue;let Mr=!1;yt&&(Mr=yt.getMaxCascadeForTile(fr.toUnwrapped())===0);const Gr=f.isTileAffectedByFog(fr),tn=ar.programConfigurations.get(c.id);let Pn=!1;if(G&&sr.imageAtlas){const On=sr.imageAtlas,un=s.e3.from(G),ti=un.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Fi=un.getSecondary(),Bi=On.patternPositions.get(ti),ri=Fi?On.patternPositions.get(Fi.scaleSelf(s.o.devicePixelRatio).toString()):null;Pn=!!Bi&&!!ri,Bi&&tn.setConstantPatternPositions(Bi,ri)}U>0&&(Pn||tn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Le.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Wr=f.getOrCreateProgram(Ft,{config:tn,defines:Mr?dt:Le,overrideFog:Gr});if(f.terrain&&f.terrain.setupElevationDraw(sr,Wr,{useMeterToDem:!0}),!ar.centroidVertexBuffer){const On=Wr.getAttributeLocation(D,"a_centroid_pos");On!==-1&&D.vertexAttrib2f(On,0,0)}!nt&&yt&&yt.setupShadows(sr.tileID.toUnwrapped(),Wr,"vector-tile"),J&&(f.context.activeTexture.set(D.TEXTURE0),sr.imageAtlasTexture&&sr.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),tn.updatePaintBuffers());const Fn=c.paint.get("fill-extrusion-vertical-gradient"),rn=1/ar.tileToMeter;let oi;if(nt&&yt){if(Sf(sr.tileID,ar.maxHeight,f))continue;const On=yt.calculateShadowPassMatrixFromTile(sr.tileID.toUnwrapped());oi=Ta(On,Ne,rn,it,mt,Pt)}else{const On=f.translatePosMatrix(fr.expandedProjMatrix,sr,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),un=O.projection.createInversionMatrix(O,fr.canonical);oi=J?Ba(On,f,Fn,Y,ge,Ne,rn,fr,sr,Ce,mt,Pt,Te,_e,un,Ue,it,U):sh(On,f,Fn,Y,ge,Ne,rn,fr,Ce,mt,Pt,Te,_e,un,Ue,it,Ge,Ot)}f.uploadCommonUniforms(k,Wr,fr.toUnwrapped(),null,Qe);let hi=ar.segments;if(O.projection.name==="mercator"&&!nt&&(hi=ar.getVisibleSegments(sr.tileID,f.terrain,f.transform.getFrustum(0)),!hi.get().length))continue;if(gr)if(nt)for(const On of hi.get())gr.numRenderedVerticesInShadowPass+=On.primitiveLength;else for(const On of hi.get())gr.numRenderedVerticesInTransparentPass+=On.primitiveLength;const fi=[];(f.terrain||I)&&fi.push(ar.centroidVertexBuffer),ke&&fi.push(ar.layoutVertexExtBuffer),tt&&fi.push(ar.wallVertexBuffer),Wr.draw(f,k.gl.TRIANGLES,x,S,T,Kt,oi,c.id,ar.layoutVertexBuffer,ar.indexBuffer,hi,c.paint,f.transform.zoom,tn,fi)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class nd{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function ns(f,t,c,p,x,S,T,I,k,D,O,q,U,G,J,Y,te,le,ge,pe){const de=t.context,Ne=de.gl,Ce=t.transform,ke=t.transform.zoom,Te=[],_e=f.translate,Me=f.translateAnchor,Ue=f.edgeRadius,Ge=Ha(t,f.cutoffFadeRange);O==="clear"?(Te.push("CLEAR_SUBPASS"),pe&&(Te.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(Ne.TEXTURE0),pe.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE))):O==="sdf"?Te.push("SDF_SUBPASS"):O==="emissive"&&(Te.push("USE_MRT1"),de.activeTexture.set(Ne.TEXTURE0),pe.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)),le&&Te.push("HAS_CENTROID"),Ge.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const it=(tt,mt,Pt,Qe,Le)=>{let dt=Te;mt.groundRadiusBuffer!=null&&(dt=Te.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const nt=mt.programConfigurations.get(p.id),yt=t.isTileAffectedByFog(tt),Dt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:dt,overrideFog:yt}),Kt=((Ft,gr,fr,sr,ar,Mr,Gr,tn,Pn,Wr,Fn)=>({u_matrix:gr,u_opacity:fr,u_ao_pass:sr?1:0,u_meter_to_tile:ar,u_ao:Mr,u_flood_light_intensity:Gr,u_flood_light_color:tn,u_attenuation:Pn,u_edge_radius:Wr,u_fb:0,u_fb_size:Fn,u_dynamic_offset:1}))(0,Qe,q,D,Le,[U,G*Le],J,Y,te,ke>=17?0:Ue*Le,pe?pe.size[0]:0),Ot=[];le&&Ot.push(mt.hiddenByLandmarkVertexBuffer),mt.groundRadiusBuffer!=null&&Ot.push(mt.groundRadiusBuffer),t.uploadCommonUniforms(de,Dt,tt.toUnwrapped(),null,Ge),Dt.draw(t,de.gl.TRIANGLES,S,T,I,k,Kt,p.id,mt.vertexBuffer,mt.indexBuffer,Pt,p.paint,ke,nt,Ot)};for(const tt of x){const mt=c.getTile(tt),Pt=mt.getBucket(p);if(!Pt||Pt.projection.name!==Ce.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const Qe=Pt.groundEffect,Le=1/Pt.tileToMeter;{const dt=t.translatePosMatrix(tt.projMatrix,mt,_e,Me),nt=Qe.getDefaultSegment();it(tt,Qe,nt,dt,Le)}if(ge)for(let dt=0;dt<4;dt++){const nt=s.e9[dt](tt),yt=c.getTile(nt);if(!yt)continue;const Dt=yt.getBucket(p);if(!Dt||Dt.projection.name!==Ce.projection.name||!Dt.groundEffect||Dt.groundEffect&&!Dt.groundEffect.hasData())continue;const Kt=Dt.groundEffect;let Ot,Ft;dt===0?(Ot=[-s.al,0,0],Ft=1):dt===1?(Ot=[s.al,0,0],Ft=0):dt===2?(Ot=[0,-s.al,0],Ft=3):(Ot=[0,s.al,0],Ft=2);const gr=Kt.regionSegments[Ft];if(!gr)continue;const fr=new Float32Array(16);s.br(fr,tt.projMatrix,Ot),it(tt,Kt,gr,t.translatePosMatrix(fr,mt,_e,Me),Le)}}}function bf(f,t,c,p,x,S,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=S?S.findDEMTileFor(c):null;if(!(I&&I.dem||T))return;S&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const k=(te,le)=>{(te.flags|le.flags)&s.ec?(te.flags|=s.ec,le.flags|=s.ec):(te.flags&=~s.ec,le.flags&=~s.ec)},D=te=>new s.P(Math.ceil((te+s.ed)*s.ee),0),O=te=>{const le=t.getSource().minzoom,ge=de=>{const Ne=t.getTileByID(de);if(Ne&&Ne.hasData())return Ne.getBucket(x)},pe=[0,-1,1];for(const de of pe){if(te.overscaledZ+de<le)continue;const Ne=ge(te.calculateScaledKey(te.overscaledZ+de));if(Ne)return Ne}},q=[0,0,0],U=(te,le)=>(q[0]=Math.min(te.min.y,le.min.y),q[1]=Math.max(te.max.y,le.max.y),q[2]=s.al-le.min.x>te.max.x?le.min.x-s.al:te.max.x,q),G=(te,le)=>(q[0]=Math.min(te.min.x,le.min.x),q[1]=Math.max(te.max.x,le.max.x),q[2]=s.al-le.min.y>te.max.y?le.min.y-s.al:te.max.y,q),J=[(te,le)=>U(te,le),(te,le)=>U(le,te),(te,le)=>G(te,le),(te,le)=>G(le,te)],Y=(te,le,ge,pe,de,Ne,Ce)=>{if(!S)return 0;const ke=[[Ne?ge:te,Ne?te:ge,0],[Ne?ge:le,Ne?le:ge,0]],Te=Ce<0?s.al+Ce:Ce,_e=[Ne?Te:(te+le)/2,Ne?(te+le)/2:Te,0];return ge===0&&Ce<0||ge!==0&&Ce>0?S.getForTilePoints(de,[_e],!0,pe):ke.push(_e),S.getForTilePoints(c,ke,!0,I),Math.max(ke[0][2],ke[1][2],_e[2])/S.exaggeration()};for(let te=0;te<4;te++){const le=p.borderFeatureIndices[te];if(le.length===0)continue;const ge=s.e9[te](c),pe=O(ge);if(!(pe&&pe instanceof s.ea))continue;const de=S?S.findDEMTileFor(ge):null;if(!(de&&de.dem||T)||(S&&de&&de.dem&&p.borderDEMTileTimestamp[te]!==de.dem._timestamp&&(p.borderDoneWithNeighborZ[te]=-1,p.borderDEMTileTimestamp[te]=de.dem._timestamp),p.borderDoneWithNeighborZ[te]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const Ne=(te<2?1:5)-te,Ce=pe.borderDoneWithNeighborZ[Ne]!==p.canonical.z,ke=pe.borderFeatureIndices[Ne];let Te=0;if(p.canonical.z!==pe.canonical.z){for(const _e of le)p.showCentroid(p.featuresOnBorder[_e]);if(Ce)for(const _e of ke)pe.showCentroid(pe.featuresOnBorder[_e]);p.borderDoneWithNeighborZ[te]=pe.canonical.z,pe.borderDoneWithNeighborZ[Ne]=p.canonical.z}for(const _e of le){const Me=p.featuresOnBorder[_e],Ue=p.centroidData[Me.centroidDataIndex],Ge=Me.borders[te];let it;for(;Te<ke.length;){it=pe.featuresOnBorder[ke[Te]];const tt=it.borders[Ne];if(tt[1]>Ge[0]+3||tt[0]>Ge[0]-3)break;pe.showCentroid(it),Te++}if(it&&Te<ke.length){const tt=Te;let mt=0;for(;!(it.borders[Ne][0]>Ge[1]-3)&&(mt++,++Te!==ke.length);)it=pe.featuresOnBorder[ke[Te]];it=pe.featuresOnBorder[ke[tt]];let Pt=!1;if(mt>=1){const dt=it.borders[Ne];Math.abs(Ge[0]-dt[0])<3&&Math.abs(Ge[1]-dt[1])<3&&(mt=1,Pt=!0,Te=tt+1)}else if(mt===0){p.showCentroid(Me);continue}const Qe=pe.centroidData[it.centroidDataIndex];T&&Pt&&k(Ue,Qe);const Le=Me.intersectsCount()>1||it.intersectsCount()>1;if(mt>1)Te=tt,Ue.centroidXY=Qe.centroidXY=new s.P(0,0);else if(de&&de.dem&&!Le){const dt=J[te](Ue,Qe),nt=te%2?s.al-1:0,yt=Y(dt[0],Math.min(s.al-1,dt[1]),nt,de,ge,te<2,dt[2]);Ue.centroidXY=Qe.centroidXY=D(yt)}else Le?Ue.centroidXY=Qe.centroidXY=new s.P(0,0):(Ue.centroidXY=p.encodeBorderCentroid(Me),Qe.centroidXY=pe.encodeBorderCentroid(it));p.writeCentroidToBuffer(Ue),pe.writeCentroidToBuffer(Qe)}else p.showCentroid(Me)}p.borderDoneWithNeighborZ[te]=pe.canonical.z,pe.borderDoneWithNeighborZ[Ne]=p.canonical.z}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Pp=[1,0,0],kp=[0,1,0],wf=[0,0,1];function Sf(f,t,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const S=f.toUnwrapped(),T=p.tileSize*x._cascades[c.currentShadowCascade].scale;let I=t;if(p.elevation){const Y=p.elevation.getMinMaxForTile(f);Y&&(I+=Y.max)}const k=[...x.shadowDirection];k[2]=-k[2];const D=x.computeSimplifiedTileShadowVolume(S,I,T,k);if(!D)return!1;const O=[Pp,kp,wf,k,[k[0],0,k[2]],[0,k[1],k[2]]],q=p.projection.name==="globe",U=p.scaleZoom(T),G=s.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,U,!q),J=x.getCurrentCascadeFrustum();return G.intersectsPrecise(D.vertices,D.planes,O)===0||J.intersectsPrecise(D.vertices,D.planes,O)===0}function ul(f){const{painter:t,source:c,layer:p,coords:x}=f;let S=f.defines;const T=t.context,I=t.renderPass==="shadow",k=t.renderPass==="light-beam",D=t.shadowRenderer,O=s.ef(t.transform.center.lat,t.transform.zoom),q=Ha(t,p.paint.get("building-cutoff-fade-range"));q.shouldRenderCutoff&&(S=S.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(S=S.concat("FLOOD_LIGHT"));for(const U of x){const G=c.getTile(U),J=G.getBucket(p);if(!J)continue;D&&D.getMaxCascadeForTile(U.toUnwrapped())===0&&(S=S.concat("SHADOWS_SINGLE_CASCADE"));const Y=J.programConfigurations.get(p.id);let te,le,ge,pe=t.translatePosMatrix(U.expandedProjMatrix,G,[0,0],"map");if(pe=s.cS(s.bC(),pe,[1,1,f.verticalScale]),I&&D){if(Sf(G.tileID,J.maxHeight*O,t))continue;let Ne=D.calculateShadowPassMatrixFromTile(G.tileID.toUnwrapped());Ne=s.cS(s.bC(),Ne,[1,1,f.verticalScale]),ge=Ya(Ne),te=le=t.getOrCreateProgram("buildingDepth",{config:Y,defines:S,overrideFog:!1})}else if(k)te=le=t.getOrCreateProgram("buildingBloom",{config:Y,defines:S,overrideFog:!1}),ge=zm(pe);else{const Ne=t.transform.calculatePosMatrix(U.toUnwrapped(),t.transform.worldSize);s.cS(Ne,Ne,[1,1,f.verticalScale]);const Ce=s.bC();s.cS(Ce,Ne,[1,-1,1/O]),s.bl(Ce,Ce),s.eg(Ce,Ce);const ke=t.transform.getFreeCameraOptions().position,Te=1<<U.canonical.z;if(ge=Qu(pe,Ce,f.opacity,f.facadeAOIntensity,[((ke.x-U.wrap)*Te-U.canonical.x)*s.al,(ke.y*Te-U.canonical.y)*s.al,ke.z*Te*s.al],J.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),le=t.getOrCreateProgram("building",{config:Y,defines:S,overrideFog:!1}),f.depthOnly===!0)te=le;else{const _e=S.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);te=t.getOrCreateProgram("building",{config:Y,defines:_e,overrideFog:!1})}D&&(D.setupShadowsFromMatrix(Ne,le,!0),te!==le&&D.setupShadowsFromMatrix(Ne,te,!0))}const de=(Ne,Ce)=>{if(k){const ke=Ne.entranceBloom;Ce.draw(t,T.gl.TRIANGLES,f.depthMode,Xr.disabled,f.blendMode,qr.disabled,ge,p.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segmentsBucket,p.paint,t.transform.zoom,Y,[ke.layoutAttenuationBuffer,ke.layoutColorBuffer])}else{const ke=Ne.segmentsBucket;let Te=[Ne.layoutNormalBuffer,Ne.layoutCentroidBuffer,Ne.layoutColorBuffer,Ne.layoutFloodLightDataBuffer];Ne.layoutFacadePaintBuffer&&(Te=Te.concat([Ne.layoutFacadeDataBuffer,Ne.layoutFacadeVerticalRangeBuffer,Ne.layoutFacadePaintBuffer])),Ce.draw(t,T.gl.TRIANGLES,f.depthMode,Xr.disabled,f.blendMode,I?qr.disabled:qr.backCW,ge,p.id,Ne.layoutVertexBuffer,Ne.indexBuffer,ke,p.paint,t.transform.zoom,Y,Te)}};t.uploadCommonUniforms(T,le,U.toUnwrapped(),null,q),J.buildingWithoutFacade&&de(J.buildingWithoutFacade,le),J.buildingWithFacade&&(te!==le&&t.uploadCommonUniforms(T,te,U.toUnwrapped(),null,q),de(J.buildingWithFacade,te))}}function Ps(f,t,c,p,x,S,T,I,k,D,O,q,U){const G=f.context.gl,J=f.depthModeForSublayer(1,_r.ReadOnly,G.LEQUAL,!0),Y=.1*(1-(te=O))+3*te;var te;const le=f._showOverdrawInspector,ge=q,pe=new nd;le||ns(pe,f,t,c,p,J,new Xr({func:G.ALWAYS,mask:255},255,255,G.KEEP,G.KEEP,G.REPLACE),new Jr([G.ONE,G.ONE,G.ONE,G.ONE],s.ao.transparent,[!1,!1,!1,!0],G.MIN),qr.disabled,x,"sdf",S,T,I,k,D,Y,ge,!1);{const de=le?Xr.disabled:new Xr({func:G.EQUAL,mask:255},255,255,G.KEEP,G.DECR,G.DECR),Ne=le?f.colorModeForRenderPass():new Jr([G.ONE_MINUS_DST_ALPHA,G.DST_ALPHA,G.ONE,G.ONE],s.ao.transparent,[!0,!0,!0,!0]);ns(pe,f,t,c,p,J,de,Ne,qr.disabled,x,"color",S,T,I,k,D,Y,ge,!1)}}function Ks(f){return[f[0]*s.eh,f[1]*s.eh,f[2]*s.eh,0]}function Ys(f,t,c,p,x,S,T,I,k){const D=p.getSource(),O=c.globeSharedBuffers;if(!O)return;let q,U,G;if(t&&(q=p.getTile(t)),D instanceof s.aU?(U=D.texture,G=s.dK(0,0,c.transform)):q&&t&&(U=q.texture,G=s.dK(t.canonical.z,t.canonical.x,c.transform)),!U||!G)return;f||(G=s.cS(s.bC(),G,[1,-1,1]));const J=c.context,Y=J.gl,te=x.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,le=c.colorModeForDrapableLayerRenderPass(S),ge=T.defines;ge.push("GLOBE_POLES");const pe=new _r(Y.LEQUAL,_r.ReadWrite,c.depthRangeFor3D),de=Float32Array.from(c.transform.expandedFarZProjMatrix),Ne=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),J.activeTexture.set(Y.TEXTURE0),U.bind(te,Y.CLAMP_TO_EDGE),J.activeTexture.set(Y.TEXTURE1),U.bind(te,Y.CLAMP_TO_EDGE),"useMipmap"in U&&J.extTextureFilterAnisotropic&&c.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[Ce,ke,Te,_e]=t?O.getPoleBuffers(t.canonical.z,!1):O.getPoleBuffers(0,!0),Me=x.paint.get("raster-elevation");let Ue;f?(Ue=Ce,c.renderDefaultNorthPole=Me!==0):(Ue=ke,c.renderDefaultSouthPole=Me!==0);const Ge=Ks(T.mix),it=((mt,Pt,Qe,Le,dt,nt,yt,Dt,Kt,Ot,Ft,gr,fr)=>Ep(mt,Pt,Qe,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},nt,[0,0],Dt,2,Ot,Ft,gr,1,0,fr))(de,Ne,G,s.aj(c.transform.zoom),0,x,0,Me,0,Ge,T.offset,T.range,S),tt=c.getOrCreateProgram("raster",{defines:ge});c.uploadCommonUniforms(J,tt,null),tt.draw(c,Y.TRIANGLES,pe,k,le,I,it,x.id,Ue,Te,_e)}function Tf(f){if(f.isOrthographic)return[0,0,0,0];const t=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-t,x=.2*f.height,S=t+x;return[t,c,(S-x-t)/p,(S-t)/p]}function dh(f,t,c,p){if(f)return t instanceof ot&&f instanceof _s?t.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:Ks(p.mix),offset:p.offset,buffer:0,tileSize:1}}var id=s.ei([{name:"a_index",type:"Int16",components:1}]);class Wg{constructor(t,c,p,x){const S={width:p[0],height:p[1],data:null},T=t.gl;this.targetColorTexture=new s.T(t,S,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,S,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(t,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new s.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const S=new s.ej;S.reserve(x);for(let T=0;T<x;T++)S.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(S,id.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Mo(f,t,c){if(!f)return null;const p=t.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:x,mix:S,offset:T,tileSize:I,buffer:k,format:D}=p;if(!x||!D)return null;let O=!1;return D==="uint32"&&(O=!0,S[3]=0,S=xf(s.ek,S,[0,c.paint.get("raster-particle-max-speed")]),T=ed(s.ek,T,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[k/(I+2*k),I/(I+2*k)],tileSize:I,scalarData:O,scale:S,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function Np(f){const t=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-t,x=.2*f.height,S=t+x;return[t,c,(S-x-t)/p,(S-t)/p]}const Ef=new s.ao(1,0,0,1),Cf=new s.ao(0,1,0,1),dl=new s.ao(0,0,1,1),hl=new s.ao(1,0,1,1),Af=new s.ao(0,1,1,1);function jp(f,t,c,p,x,S){for(let T=0;T<c.length;T++)if(x){const D=new s.ao(p.r*.8,p.g*.8,p.b*.8,1);hc(f,t,c[T],p,-1,-1,S),hc(f,t,c[T],p,-1,1,S),hc(f,t,c[T],p,1,1,S),hc(f,t,c[T],p,1,-1,S),hc(f,t,c[T],D,0,0,S)}else hc(f,t,c[T],p,0,0,S)}function hc(f,t,c,p,x,S,T){const I=f.context,k=f.transform,D=I.gl,O=k.projection.name==="globe",q=O?["PROJECTION_GLOBE_VIEW"]:[];let U=s.bz(c.projMatrix);if(O&&s.aj(k.zoom)>0){const Ge=s.bj(c.canonical,k),it=s.el(Ge);U=s.aB(new Float32Array(16),k.globeMatrix,it),s.aB(U,k.projMatrix,U)}const G=s.bC();G[12]+=2*x/(s.o.devicePixelRatio*k.width),G[13]+=2*S/(s.o.devicePixelRatio*k.height),s.aB(U,G,U);const J=f.getOrCreateProgram("debug",{defines:q}),Y=t.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(Y,J);const te=_r.disabled,le=Xr.disabled,ge=f.colorModeForRenderPass(),pe="$debug";I.activeTexture.set(D.TEXTURE0),f.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),O?Y._makeGlobeTileDebugBuffers(f.context,k):Y._makeDebugTileBoundsBuffers(f.context,k.projection);const de=Y._tileDebugBuffer||f.debugBuffer,Ne=Y._tileDebugIndexBuffer||f.debugIndexBuffer,Ce=Y._tileDebugSegments||f.debugSegments;if(J.draw(f,D.LINE_STRIP,te,le,ge,qr.disabled,Ju(U,p.toPremultipliedRenderColor(null)),pe,de,Ne,Ce,null,null,null,[Y._globeTileDebugBorderBuffer]),T){const Ge=Y.latestRawTileData,it=Math.floor((Ge&&Ge.byteLength||0)/1024);let tt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(tt+=` => ${c.overscaledZ}`),tt+=` ${Y.state}`,tt+=` ${it}kb`,(function(mt,Pt){mt.initDebugOverlayCanvas();const Qe=mt.debugOverlayCanvas,Le=mt.context.gl,dt=mt.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,Qe.width,Qe.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(Pt,5,5),dt.strokeText(Pt,5,5),mt.debugOverlayTexture.update(Qe),mt.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)})(f,tt)}const ke=t.getTile(c).tileSize,Te=512/Math.min(ke,512)*(c.overscaledZ/k.zoom)*.5,_e=Y._tileDebugTextBuffer||f.debugBuffer,Me=Y._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ue=Y._tileDebugTextSegments||f.debugSegments;J.draw(f,D.TRIANGLES,te,le,Jr.alphaBlended,qr.disabled,Ju(U,s.ao.transparent.toPremultipliedRenderColor(null),Te),pe,_e,Me,Ue,null,null,null,[Y._globeTileDebugTextBuffer])}function Bm(f,t,c,p){If(f,0,t+c/2,f.transform.width,c,p)}function Rp(f,t,c,p){If(f,t-c/2,0,c,f.transform.height,p)}function If(f,t,c,p,x,S){const T=f.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*s.o.devicePixelRatio,c*s.o.devicePixelRatio,p*s.o.devicePixelRatio,x*s.o.devicePixelRatio),T.clear({color:S}),I.disable(I.SCISSOR_TEST)}const Vm=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Hg}=Vm;function jc(f,t,c,p){f.emplaceBack(t,c,p)}class ca{constructor(t){this.vertexArray=new s.em,this.indices=new s.b0,jc(this.vertexArray,-1,-1,1),jc(this.vertexArray,1,-1,1),jc(this.vertexArray,-1,1,1),jc(this.vertexArray,1,1,1),jc(this.vertexArray,-1,-1,-1),jc(this.vertexArray,1,-1,-1),jc(this.vertexArray,-1,1,-1),jc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Hg),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function Rc(f,t,c,p,x,S){const T=f.context.gl,I=t.paint.get("sky-atmosphere-color"),k=t.paint.get("sky-atmosphere-halo-color"),D=t.paint.get("sky-atmosphere-sun-intensity"),O=((q,U,G,J,Y)=>({u_matrix_3f:q,u_sun_direction:U,u_sun_intensity:G,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(s.eo(s.dO(),p),x,D,I.toPremultipliedRenderColor(null),k.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+S,t.skyboxTexture,0),c.draw(f,T.TRIANGLES,_r.disabled,Xr.disabled,Jr.unblended,qr.frontCW,O,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const uo=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Mc{constructor(t){const c=new s.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new s.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(c,uo.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pf=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Mp{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Jr([1,Sc,1,Sc],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Jr([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new hh,this.updateNeeded=!0}update(t){const c=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Mc(c);const p=this.params.sizeRange,x=this.params.intensityRange,S=(function(O){const q=s.eq(30),U=[];for(let G=0;G<O;++G){const J=2*Math.PI*q(),Y=Math.acos(1-2*q())-.5*Math.PI;U.push(s.d5(Math.cos(Y)*Math.cos(J),Math.cos(Y)*Math.sin(J),Math.sin(Y)))}return U})(this.params.starsCount),T=s.eq(300),I=new s.er,k=new s.b0;let D=0;for(let O=0;O<S.length;++O){const q=s.c5([],S[O],200),U=Math.max(0,1+.01*p*(1*T()-.5)),G=Math.max(0,1+.01*x*(1*T()-.5));I.emplaceBack(q[0],q[1],q[2],-1,-1,U,G),I.emplaceBack(q[0],q[1],q[2],1,-1,U,G),I.emplaceBack(q[0],q[1],q[2],1,1,U,G),I.emplaceBack(q[0],q[1],q[2],-1,1,U,G),k.emplaceBack(D+0,D+1,D+2),k.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=c.createVertexBuffer(I,Pf.members),this.starsIdx=c.createIndexBuffer(k),this.starsSegments=s.bg.simpleSegment(0,0,I.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,c){const p=t.context,x=p.gl,S=t.transform,T=new _r(x.LEQUAL,_r.ReadOnly,[0,1]),I=s.aj(S.zoom),k=t.style.getLut(c.scope),D=c.properties.get("color-use-theme")==="none",O=c.properties.get("color").toNonPremultipliedRenderColor(D?null:k),q=c.properties.get("high-color-use-theme")==="none",U=c.properties.get("high-color").toNonPremultipliedRenderColor(q?null:k),G=c.properties.get("space-color-use-theme")==="none",J=c.properties.get("space-color").toNonPremultipliedRenderColor(G?null:k),Y=5e-4,te=s.es(c.properties.get("horizon-blend"),0,1,Y,.25),le=s.dE(t,p,S)&&te===Y?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,ge=t.frameCounter/1e3%1,pe=s.ag(S.globeCenterInViewSpace),de=Math.sqrt(Math.pow(pe,2)-Math.pow(le,2)),Ne=Math.acos(de/pe),Ce=ke=>{const Te=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ke&&Te.push("ALPHA_PASS");const _e=t.getOrCreateProgram("globeAtmosphere",{defines:Te}),Me=((Ge,it,tt,mt,Pt,Qe,Le,dt,nt,yt,Dt,Kt)=>({u_frustum_tl:Ge,u_frustum_tr:it,u_frustum_br:tt,u_frustum_bl:mt,u_horizon:Pt,u_transition:Qe,u_fadeout_range:Le,u_atmosphere_fog_color:dt.toArray01(),u_high_color:nt.toArray01(),u_space_color:yt.toArray01(),u_temporal_offset:Dt,u_horizon_angle:Kt}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,I,te,O,U,J,ge,Ne);t.uploadCommonUniforms(p,_e);const Ue=this.atmosphereBuffer;Ue&&_e.draw(t,x.TRIANGLES,T,Xr.disabled,ke?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qr.backCW,Me,ke?"atmosphere_glow_alpha":"atmosphere_glow",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)};Ce(!1),Ce(!0)}drawStars(t,c){const p=s.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=t.context,S=x.gl,T=t.transform,I=t.getOrCreateProgram("stars"),k=s.c7([]);s.c9(k,k,-T._pitch),s.c8(k,k,-T.angle),s.c9(k,k,s.an(T._center.lat)),s.et(k,k,-s.an(T._center.lng));const D=s.cc(new Float32Array(16),k),O=s.aB([],T.starsProjMatrix,D),q=s.eo([],D),U=s.eu([],q),G=[0,1,0];s.dQ(G,G,U),s.c5(G,G,this.params.sizeMultiplier);const J=[1,0,0];s.dQ(J,J,U),s.c5(J,J,this.params.sizeMultiplier);const Y=(te=G,le=J,ge=p,{u_matrix:Float32Array.from(O),u_up:te,u_right:le,u_intensity_multiplier:ge});var te,le,ge;t.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(t,S.TRIANGLES,_r.disabled,Xr.disabled,this.colorModeAlphaBlendedWriteRGB,qr.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class kf{constructor(){this.visibleTiles=[]}updateBorders(t,c){const p=[],x=[],S=t._getRenderableCoordinates(!1,!0);for(const k of S){const D=t.getTile(k);if(!D.hasData())continue;const O=D.getBucket(c);O&&(O.isEmpty()||(p.push(k.key),x.push({bucket:O,tileID:k.canonical})))}let T=p.length!==this.visibleTiles.length;if(!T){p.sort();for(let k=0;k<p.length;k++)if(p[k]!==this.visibleTiles[k]){T=!0;break}}if(!T)return;const I=new Set;this.visibleTiles=p,x.sort((k,D)=>k.tileID.z-D.tileID.z||k.tileID.x-D.tileID.x||k.tileID.y-D.tileID.y);for(const k of x){const D=new Array,O=new Array,q=k.bucket;for(const U of q.featuresOnBorder)I.has(U.featureId)?O.push(U.footprintIndex):(I.add(U.featureId),D.push(U.footprintIndex));q.updateFootprintHiddenFlags(D,s.ev,!1),q.updateFootprintHiddenFlags(O,s.ev,!0)}}}function Lp(f,t){const c=[...f],p=t.cameraWorldSizeForFog/t.worldSize,x=s.bA([]);return s.cS(x,x,[p,p,1]),s.aB(c,x,c),s.aB(c,t.worldToFogMatrix,c),c}function fl(f,t,c,p,x){const S=c.material,T=p.context,{baseColorTexture:I,metallicRoughnessTexture:k}=S.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:O,emissionTexture:q}=S;function U(J,Y,te){if(J&&(f.push(Y),T.activeTexture.set(T.gl.TEXTURE0+te),J.gfxTexture)){const{minFilter:le,magFilter:ge,wrapS:pe,wrapT:de}=J.sampler;J.gfxTexture.bindExtraParam(le,ge,pe,de)}}U(I,"HAS_TEXTURE_u_baseColorTexture",5),U(k,"HAS_TEXTURE_u_metallicRoughnessTexture",6),U(D,"HAS_TEXTURE_u_normalTexture",7),U(O,"HAS_TEXTURE_u_occlusionTexture",8),U(q,"HAS_TEXTURE_u_emissionTexture",9),x&&(x.texture||(x.texture=new s.d$(p.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+10),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(c.pbrBuffer)),S.alphaMode!=="OPAQUE"&&S.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),S.defined||f.push("DIFFUSE_SHADED");const G=p.shadowRenderer;G&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&f.push("NORMAL_OFFSET"))}function bi(f,t,c,p,x,S){const T=f.modelOpacity,I=t.context,k=new _r(t.context.gl.LEQUAL,f.isLightMesh?_r.ReadOnly:_r.ReadWrite,t.depthRangeFor3D),D=t.transform,O=f.mesh,q=O.material,U=q.pbrMetallicRoughness,G=t.style.fog;let J;J=t.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.aB([],p.zScaleMatrix,f.nodeModelMatrix),s.aB(J,p.negCameraPosMatrix,J);const Y=s.bl([],J);s.eg(Y,Y);const te=c.paint.get("model-color-use-theme").constantOr("default")==="none",le=c.paint.get("model-emissive-strength").constantOr(0),ge=lh(new Float32Array(f.worldViewProjection),new Float32Array(J),new Float32Array(Y),null,t,T,U.baseColorFactor,q.emissiveFactor,U.metallicFactor,U.roughnessFactor,q,le,c,void 0,void 0,f.materialOverride,f.modelColor),pe={defines:[]},de=[],Ne=t.shadowRenderer;Ne&&(Ne.useNormalOffset=!1),fl(pe.defines,de,O,t,te?null:c.lut);let Ce=null;if(G){const _e=Lp(f.nodeModelMatrix,t.transform);if(Ce=new Float32Array(_e),D.projection.name!=="globe"){const Me=O.aabb.min,Ue=O.aabb.max,[Ge,it]=G.getOpacityForBounds(_e,Me[0],Me[1],Ue[0],Ue[1]);pe.overrideFog=Ge>=ct||it>=ct}}const ke=Ha(t,c.paint.get("model-cutoff-fade-range"));ke.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const Te=t.getOrCreateProgram("model",pe);t.uploadCommonUniforms(I,Te,null,Ce,ke),t.renderPass!=="shadow"&&Ne&&Ne.setupShadowsFromMatrix(f.nodeModelMatrix,Te),Te.draw(t,I.gl.TRIANGLES,k,x,S,O.material.doubleSided?qr.disabled:qr.backCCW,ge,c.id,O.vertexBuffer,O.indexBuffer,O.segments,c.paint,t.transform.zoom,void 0,de)}function fh(f,t){return f.style._importedAsBasemap?"basemap":t.scope}function sd(f,t,c,p,x,S,T,I,k,D){const O=f.transform,q=!!t.isGeometryBloom&&t.isGeometryBloom;if(q&&f.renderPass==="shadow")return;const U=O.projection.name==="globe"?s.eD(c,O):[...c];s.aB(U,U,t.globalMatrix);const G=s.aB([],p,U);if(t.meshes)for(const J of t.meshes){const Y=I.get(J.material.name);if(Y&&Y.opacity<=0)continue;if(J.material.alphaMode!=="BLEND"){T.push({mesh:J,depth:0,modelIndex:x,worldViewProjection:G,nodeModelMatrix:U,isLightMesh:q,materialOverride:Y,modelOpacity:k,modelColor:D});continue}const te=s.af([],J.centroid,G);!O.isOrthographic&&te[2]<=0||S.push({mesh:J,depth:te[2],modelIndex:x,worldViewProjection:G,nodeModelMatrix:U,isLightMesh:q,materialOverride:Y,modelOpacity:k,modelColor:D})}if(t.children)for(const J of t.children)sd(f,J,c,p,x,S,T,I,k,D)}function od(f,t,c,p){const x=c.shadowRenderer;if(!x)return;const S=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(t),k=ch(I);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,S,Xr.disabled,T,qr.disabled,k,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function Um(f,t,c,p,x,S){for(const T of x){const I=Object.assign({},p);I.part=T;const k={type:"Unknown",id:t,properties:I},D={orientation:f.paint.get("model-rotation").evaluate(k,c)};S.set(T,D)}}function $m(f,t,c,p,x,S){for(const T of x){const I=Object.assign({},p);I.part=T;const k={type:"Unknown",id:t,properties:I},D={color:f.paint.get("model-color").evaluate(k,c),colorMix:f.paint.get("model-color-mix-intensity").evaluate(k,c),opacity:f.paint.get("model-opacity").evaluate(k,c),emissionStrength:f.paint.get("model-emissive-strength").evaluate(k,c)};S.set(T,D)}}function qm(f,t,c,p,x){let S=!1;for(const I of p)I.modelOpacity!==1&&(bi(I,f,t,x[I.modelIndex],Xr.disabled,Jr.disabled),S=!0);for(const I of p)bi(I,f,t,x[I.modelIndex],I.modelOpacity!==1?f.stencilModeFor3D():Xr.disabled,f.colorModeForRenderPass());S&&f.resetStencilClippingMasks();const T=Jr.additive;for(const I of c)bi(I,f,t,x[I.modelIndex],Xr.disabled,I.isLightMesh?T:f.colorModeForRenderPass())}function gu(f,t,c){const p=t.updateZoomBasedPaintProperties(),x=(function(S,T,I){let k,D,O,q=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&q>0){const U=S.terrain,G=U.findDEMTileFor(I);G&&G.dem?k=s.eF.create(U,I,G):q=0}if(q===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),q===T.validForExaggeration&&(q===0||k&&k._demTile&&k._demTile.tileID===T.validForDEMTile.id&&k._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const U in T.instancesPerModel){const G=T.instancesPerModel[U];for(let J=0;J<G.instancedDataArray.length;++J){const Y=(k?q*k.getElevationAt(0|G.instancedDataArray.float32[16*J],0|G.instancedDataArray.float32[16*J+1],!0,!0):0)+G.instancesEvaluatedElevation[J];G.instancedDataArray.float32[16*J+6]=Y,D=D?Math.min(T.terrainElevationMin,Y):Y,O=O?Math.max(T.terrainElevationMax,Y):Y}}return T.terrainElevationMin=D||0,T.terrainElevationMax=O||0,T.validForExaggeration=q,T.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,t,c);(p||x)&&(t.uploaded=!1,t.upload(f.context))}const ua={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function zt(f,t){const c=1<<f.canonical.z,p=t.getFreeCameraOptions().position,x=t.elevation,S=f.canonical.x/c,T=(f.canonical.x+1)/c,I=f.canonical.y/c,k=(f.canonical.y+1)/c;let D=t._centerAltitude;if(x){const G=x.getMinMaxForTile(f);G&&G.max>D&&(D=G.max)}const O=s.aA(p.x,S,T)-p.x,q=s.aA(p.y,I,k)-p.y,U=s.cf(D,t.center.lat)-p.z;return t._zoomFromMercatorZ(Math.sqrt(O*O+q*q+U*U))}function er(f,t,c,p,x,S,T){const I=f.context,k=f.renderPass==="shadow",D=f.shadowRenderer,O=k&&D?D.getShadowPassDepthMode():new _r(I.gl.LEQUAL,_r.ReadWrite,f.depthRangeFor3D),q=f.isTileAffectedByFog(S),U=f.transform.projection.name==="globe";if(c.meshes)for(const G of c.meshes){const J=U?[]:["MODEL_POSITION_ON_GPU"],Y=[];let te,le,ge;const pe=!U&&p.instancedDataArray.length>20;pe&&J.push("INSTANCED_ARRAYS");const de=Ha(f,t.paint.get("model-cutoff-fade-range"));if(de.shouldRenderCutoff&&J.push("RENDER_CUTOFF"),k&&D)te=f.getOrCreateProgram("modelDepth",{defines:J}),le=ch(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(c.globalMatrix)),ge=D.getShadowPassColorMode();else{fl(J,Y,G,f,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),te=f.getOrCreateProgram("model",{defines:J,overrideFog:q});const Ce=G.material,ke=Ce.pbrMetallicRoughness,Te=t.paint.get("model-opacity").constantOr(1),_e=t.paint.get("model-emissive-strength").constantOr(0);le=lh(S.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,f,Te,ke.baseColorFactor,Ce.emissiveFactor,ke.metallicFactor,ke.roughnessFactor,Ce,_e,t,x),D&&(T.shadowUniformsInitialized?te.setShadowUniformValues(I,D.getShadowUniformValues()):(D.setupShadows(S.toUnwrapped(),te,"model-tile"),T.shadowUniformsInitialized=!0)),ge=de.shouldRenderCutoff||Te<1||Ce.alphaMode!=="OPAQUE"?Jr.alphaBlended:Jr.unblended}f.uploadCommonUniforms(I,te,S.toUnwrapped(),null,de);const Ne=G.material.doubleSided?qr.disabled:qr.backCCW;if(pe)Y.push(p.instancedDataBuffer),te.draw(f,I.gl.TRIANGLES,O,Xr.disabled,ge,Ne,le,t.id,G.vertexBuffer,G.indexBuffer,G.segments,t.paint,f.transform.zoom,void 0,Y,p.instancedDataArray.length);else{const Ce=k?"u_instance":"u_normal_matrix";for(let ke=0;ke<p.instancedDataArray.length;++ke)le[Ce]=new Float32Array(p.instancedDataArray.arrayBuffer,64*ke,16),te.draw(f,I.gl.TRIANGLES,O,Xr.disabled,ge,Ne,le,t.id,G.vertexBuffer,G.indexBuffer,G.segments,t.paint,f.transform.zoom,void 0,Y)}}if(c.children)for(const G of c.children)er(f,t,G,p,x,S,T)}const ad=[1,-1,1];function is(f,t,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const S=c.shadowRenderer,T=t.aabb;let I=!0,k=f.maxHeight;if(k===0){let O=0;for(const q in f.instancesPerModel){const U=x.getModel(q,p);U?O=Math.max(O,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):I=!1}k=f.maxScale*O*1.41+f.maxVerticalOffset,I&&(f.maxHeight=k)}T.max[2]=k,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,s.af(T.min,T.min,t.tileMatrix),s.af(T.max,T.max,t.tileMatrix);const D=T.intersects(S.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=D===2),D===0}function He(f,t){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],S=f.uniformValues.u_cutoff_params[3];return p===c||S===x?1:s.aA(((t-c)/(p-c)-x)/(S-x),0,1)}function Zg(f,t,c,p){if(t.pitch<20)return 1;const x=t.getWorldToCameraMatrix();s.aB(x,x,f);const S=s.bU(c.min[0],c.min[1],c.min[2],1);let T=s.aC(s.eG(),S,x),I=T,k=T;S[1]=c.max[1],T=s.aC(s.eG(),S,x),I=T[1]<I[1]?T:I,k=T[1]>k[1]?T:k,S[0]=c.max[0],T=s.aC(s.eG(),S,x),I=T[1]<I[1]?T:I,k=T[1]>k[1]?T:k,S[1]=c.min[1],T=s.aC(s.eG(),S,x),I=T[1]<I[1]?T:I,k=T[1]>k[1]?T:k;const D=s.aA(p[0],0,1),O=100*t.pixelsPerMeter*s.aA(p[1],0,1),q=s.aA(p[2],0,1),U=s.eH(s.eG(),I,k,D),G=Math.tan(.5*t.fovX),J=-U[2]*G;if(O===0)return U[1]<-Math.abs(J)?q:1;const Y=(-Math.abs(J)-U[1])/O,te=(ge,pe,de)=>(1-de)*ge+de*pe,le=s.aA(te(1,q,Y),q,1);return te(1,le,s.aA((t.pitch-20)/20,0,1))}class Dp{}class Gm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,c,p){{const q=this._storage.get(c.id);if(q)return q.lastUsedFrameIdx=t,q.buf}const x=p.gl,S=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(S),I=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const k=new s.eJ;for(let q=0;q<S/2;q+=3){const U=I[q],G=I[q+1],J=I[q+2];k.emplaceBack(U,G),k.emplaceBack(G,J),k.emplaceBack(J,U)}const D=p.bindVertexArrayOES.current,O=new Dp;return O.buf=new Zo(p,k),O.lastUsedFrameIdx=t,this._storage.set(c.id,O),p.bindVertexArrayOES.set(D),O.buf}update(t){for(const[c,p]of this._storage)t-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[t,c]of this._storage)c.buf.destroy(),this._storage.delete(t)}}class el{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Op=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ph{constructor(t){this.revealStart=11,this.revealRange=2}}const ld=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Xg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,c){const p=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new s.eK,I=new s.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,ld.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const x=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,p);const T={u_vignetteShape:(S={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:S.vignetteColor};p.draw(t,t.context.gl.TRIANGLES,_r.disabled,Xr.disabled,Jr.alphaBlended,qr.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,x)}var S}}class Kg{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,c){const p=t.getFreeCameraOptions().position,x=p.toAltitude(),S=p.toLngLat(),T=s.an(S.lng),I=s.an(S.lat),k=t.pixelsPerMeter/c,D=T*s.eM,O=s.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const q=-this._offsetYPrev+O,U=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*k,this._accumulatedOffsetY+=q*k,this._accumulatedElevation+=U*k,this._offsetXPrev=D,this._offsetYPrev=O,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Nf(f,t){return[-(f[0]-Math.floor(f[0]/t)*t),-(f[1]-Math.floor(f[1]/t)*t),-(f[2]-Math.floor(f[2]/t)*t)]}function fc(f){const t=s.eq(1323123451230),c=[];for(let p=0;p<f;++p){const x=2*t()-1,S=2*t()-1,T=2*t()-1;c.push(s.d5(x,S,T))}return c}function pl(f,t,c,p,x){const S=s.aA((x-c)/(p-c),0,1);return(1-S)*f+S*t}class jf{constructor(t){this._movement=new Kg,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Xg,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,c){const p=t.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,S=s.c7([]);s.c9(S,S,s.an(90)-p._pitch),s.c8(S,S,-p.angle);const T=s.cc(new Float32Array(16),S),I=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),k=s.eg([],I),D=s.aB([],k,T),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*c,this._prevTime=O,{projectionMatrix:x,modelviewMatrix:D}}}class Yg extends jf{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ph("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const c=t.context;if(!this.particlesVx){const p=fc(this.particlesCount),x=new s.eN,S=new s.b0;let T=0;const I=s.eq(1323123451230);for(let k=0;k<p.length;++k){const D=p[k],O=[2*I()-1,I(),I(),I()];x.emplaceBack(D[0],D[1],D[2],-1,-1,...O),x.emplaceBack(D[0],D[1],D[2],1,-1,...O),x.emplaceBack(D[0],D[1],D[2],1,1,...O),x.emplaceBack(D[0],D[1],D[2],-1,1,...O),S.emplaceBack(T+0,T+1,T+2),S.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=c.createVertexBuffer(x,Op.members),this.particlesIdx=c.createIndexBuffer(S)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=t.transform.zoom;if(c.revealStart>p)return;const x=pl(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const S=structuredClone(this._params);let T=[-S.direction.x,S.direction.y,-100];s.aw(T,T);const I=structuredClone(this._vignetteParams);I.strength*=x,S.overrideStyleParameters||(S.intensity=t.style.rain.state.density,S.timeFactor=t.style.rain.state.intensity,S.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),S.screenThinning.intensity=t.style.rain.state.centerThinning,S.dropletSizeX=t.style.rain.state.dropletSize[0],S.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],S.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const k=this.updateOnRender(t,S.timeFactor),D=t.context,O=D.gl,q=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(D,{width:t.width,height:t.height,data:null},O.RGBA8)),S.distortionStrength>0&&(D.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const U=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(D,U),D.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const G=[S.color.r,S.color.g,S.color.b,S.color.a],J=(Y,te)=>{const le=Nf(this._movement.getPosition(),Y),ge=S.dropletSizeX,pe=S.dropletSizeX*S.dropletSizeYScale,de=t.width/2,Ne=t.height/2,Ce=pl(0,S.screenThinning.start,0,1,S.screenThinning.intensity),ke=pl(.001,S.screenThinning.range,0,1,S.screenThinning.intensity),Te=pl(0,S.screenThinning.particleOffset,0,1,S.screenThinning.intensity),_e=(Me={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:le,velocityConeAperture:S.velocityConeAperture,velocity:S.velocity,boxSize:Y,rainDropletSize:[ge,pe],distortionStrength:S.distortionStrength,rainDirection:T,color:G,screenSize:[q.width,q.height],thinningCenterPos:[de,Ne],thinningShape:[Ce,ke,Math.pow(10,S.screenThinning.fadePower)],thinningAffectedRatio:S.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:S.shapeDirPower,shapeNormalPower:S.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Me.modelview),u_projection:Float32Array.from(Me.projection),u_time:Me.time,u_cam_pos:Me.camPos,u_texScreen:0,u_velocityConeAperture:Me.velocityConeAperture,u_velocity:Me.velocity,u_boxSize:Me.boxSize,u_rainDropletSize:Me.rainDropletSize,u_distortionStrength:Me.distortionStrength,u_rainDirection:Me.rainDirection,u_color:Me.color,u_screenSize:Me.screenSize,u_thinningCenterPos:Me.thinningCenterPos,u_thinningShape:Me.thinningShape,u_thinningAffectedRatio:Me.thinningAffectedRatio,u_thinningParticleOffset:Me.thinningParticleOffset,u_shapeDirectionalPower:Me.shapeDirectionalPower,u_shapeNormalPower:Me.shapeNormalPower,u_mode:Me.mode});var Me;const Ue=Math.round(S.intensity*this.particlesCount),Ge=s.bg.simpleSegment(0,0,4*Ue,2*Ue);U.draw(t,O.TRIANGLES,_r.disabled,Xr.disabled,Jr.alphaBlended,qr.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};S.distortionStrength>0&&J(S.boxSize,!0),J(S.boxSize,!1),this._vignette.draw(t,I)}}const Rf=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class mh extends jf{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ph("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const c=t.context;if(!this.particlesVx){const p=fc(this.particlesCount),x=new s.eO,S=new s.b0;let T=0;const I=s.eq(1323123451230);for(let k=0;k<p.length;++k){const D=p[k],O=I(),q=I(),U=I(),G=[k/p.length,O,q,U],J=[I(),I()];x.emplaceBack(D[0],D[1],D[2],-1,-1,...G,...J),x.emplaceBack(D[0],D[1],D[2],1,-1,...G,...J),x.emplaceBack(D[0],D[1],D[2],1,1,...G,...J),x.emplaceBack(D[0],D[1],D[2],-1,1,...G,...J),S.emplaceBack(T+0,T+1,T+2),S.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=c.createVertexBuffer(x,Rf.members),this.particlesIdx=c.createIndexBuffer(S)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];s.aw(p,p);const x=structuredClone(this._vignetteParams),S=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(S.revealStart>T)return;const I=pl(0,1,S.revealStart,S.revealStart+S.revealRange,T);x.strength*=I,c.overrideStyleParameters||(c.intensity=t.style.snow.state.density,c.timeFactor=t.style.snow.state.intensity,c.color=structuredClone(t.style.snow.state.color),p=structuredClone(t.style.snow.state.direction),c.screenThinning.intensity=t.style.snow.state.centerThinning,c.billboardSize=2.79*t.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(t.style.snow.state.vignetteColor));const k=this.updateOnRender(t,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=t.context,O=D.gl,q=t.transform,U=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(D,U),((G,J,Y)=>{const te=Nf(this._movement.getPosition(),G),le=q.width/2,ge=q.height/2,pe=pl(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),de=pl(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ne=pl(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),Ce=(ke={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:G,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[q.width,q.height],thinningCenterPos:[le,ge],thinningShape:[pe,de,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ne,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:p},{u_modelview:Float32Array.from(ke.modelview),u_projection:Float32Array.from(ke.projection),u_time:ke.time,u_cam_pos:ke.camPos,u_velocityConeAperture:ke.velocityConeAperture,u_velocity:ke.velocity,u_horizontalOscillationRadius:ke.horizontalOscillationRadius,u_horizontalOscillationRate:ke.horizontalOscillationRate,u_boxSize:ke.boxSize,u_billboardSize:ke.billboardSize,u_simpleShapeParameters:ke.simpleShapeParameters,u_screenSize:ke.screenSize,u_thinningCenterPos:ke.thinningCenterPos,u_thinningShape:ke.thinningShape,u_thinningAffectedRatio:ke.thinningAffectedRatio,u_thinningParticleOffset:ke.thinningParticleOffset,u_particleColor:ke.color,u_direction:ke.direction});var ke;const Te=Math.round(Y.intensity*this.particlesCount),_e=s.bg.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&U.draw(t,O.TRIANGLES,_r.disabled,Xr.disabled,Jr.alphaBlended,qr.disabled,Ce,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(c.boxSize,0,c),this._vignette.draw(t,x)}}const yu={symbol:function(f,t,c,p,x){if(f.renderPass!=="translucent")return;const S=Xr.disabled,T=f.colorModeForRenderPass(),I=c.layout.get("text-variable-anchor"),k=c.layout.get("text-size-scale-range"),D=s.aA(f.scaleFactor,k[0],k[1]);I&&(function(U,G,J,Y,te,le,ge,pe){const de=G.transform,Ne=te==="map",Ce=le==="map";for(const ke of U){const Te=Y.getTile(ke),_e=Te.getBucket(J);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const Me=s.bK(_e.textSizeData,de.zoom,pe),Ue=wc(ke,_e.getProjection(),de),Ge=de.calculatePixelsToTileUnitsMatrix(Te),it=iu(Ue,Te.tileID.canonical,Ce,Ne,de,_e.getProjection(),Ge),tt=_e.hasIconTextFit()&&_e.hasIconData();Me&&Dl(_e,Ne,Ce,ge,de,it,ke,Math.pow(2,de.zoom-Te.tileID.overscaledZ),Me,tt)}})(p,f,c,t,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,D);const O=c.paint.get("icon-opacity").constantOr(1)!==0,q=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(O||q)?pu(f,t,c,p,S,T):(O&&pu(f,t,c,p,S,T,{onlyIcons:!0}),q&&pu(f,t,c,p,S,T,{onlyText:!0})),t.map.showCollisionBoxes&&(Ip(f,t,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Ip(f,t,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),S=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,k=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(S.constantOr(1)===0||T.constantOr(1)===0))return;const D=f.context,O=D.gl,q=f.transform,U=!(!f.terrain||!f.terrain.enabled),G=c.layout.get("circle-elevation-reference"),J=f.depthModeForSublayer(0,_r.ReadOnly),Y=new _r(f.context.gl.LEQUAL,_r.ReadOnly,f.depthRangeFor3D),te=G==="none"||U?J:Y,le=Xr.disabled,ge=f.colorModeForDrapableLayerRenderPass(k),pe=q.projection.name==="globe",de=[s.aF(q.center.lng),s.aJ(q.center.lat)],Ne=[];for(let ke=0;ke<p.length;ke++){const Te=p[ke],_e=t.getTile(Te),Me=_e.getBucket(c);if(!Me||Me.projection.name!==q.projection.name)continue;const Ue=Me.programConfigurations.get(c.id),Ge=Me.layoutVertexBuffer,it=Me.globeExtVertexBuffer,tt=Me.indexBuffer,mt=s.e0(c),Pt=[it],Qe=f.isTileAffectedByFog(Te);pe&&mt.push("PROJECTION_GLOBE_VIEW"),mt.push("DEPTH_D24"),f.terrain&&q.depthOcclusionForSymbolsAndCircles&&mt.push("DEPTH_OCCLUSION"),Me.hasElevation&&!f.terrain&&(mt.push("ELEVATED_ROADS"),Pt.push(Me.elevatedLayoutVertexBuffer));const Le=f.getOrCreateProgram("circle",{config:Ue,defines:mt,overrideFog:Qe}),dt=q.projection.createInversionMatrix(q,Te.canonical),nt={programConfiguration:Ue,program:Le,layoutVertexBuffer:Ge,dynamicBuffers:Pt,indexBuffer:tt,uniformValues:s.e1(f,Te,_e,dt,de,c),tile:_e};if(I){const yt=Me.segments.get();for(const Dt of yt)Ne.push({segments:new s.bg([Dt]),sortKey:Dt.sortKey,state:nt})}else Ne.push({segments:Me.segments,sortKey:0,state:nt})}I&&Ne.sort((ke,Te)=>ke.sortKey-Te.sortKey);const Ce={useDepthForOcclusion:q.depthOcclusionForSymbolsAndCircles};for(const ke of Ne){const{programConfiguration:Te,program:_e,layoutVertexBuffer:Me,dynamicBuffers:Ue,indexBuffer:Ge,uniformValues:it,tile:tt}=ke.state,mt=ke.segments;f.terrain&&f.terrain.setupElevationDraw(tt,_e,Ce),f.uploadCommonUniforms(D,_e,tt.tileID.toUnwrapped()),_e.draw(f,O.TRIANGLES,te,le,ge,qr.disabled,it,c.id,Me,Ge,mt,c.paint,q.zoom,Te,Ue)}},heatmap:function(f,t,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,S=x.gl,T=Xr.disabled,I=new Jr([S.ONE,S.ONE,S.ONE,S.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(G,J,Y,te){const le=G.gl,ge=J.width*te,pe=J.height*te;G.activeTexture.set(le.TEXTURE1),G.viewport.set([0,0,ge,pe]);let de=Y.heatmapFbo;if(!de||de&&(de.width!==ge||de.height!==pe)){de&&de.destroy();const Ne=le.createTexture();le.bindTexture(le.TEXTURE_2D,Ne),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),de=Y.heatmapFbo=G.createFramebuffer(ge,pe,1,null),(function(Ce,ke,Te,_e,Me,Ue){const Ge=Ce.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Ce.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Me,Ue,0,Ge.RGBA,Ce.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),_e.colorAttachment0.set(Te)})(G,0,Ne,de,ge,pe)}else le.bindTexture(le.TEXTURE_2D,de.colorAttachment0.get()),G.bindFramebuffer.set(de.framebuffer)})(x,f,c,f.transform.projection.name==="globe"?.5:.25),x.clear({color:s.ao.transparent});const k=f.transform,D=k.projection.name==="globe",O=D?["PROJECTION_GLOBE_VIEW"]:[],q=D?qr.frontCCW:qr.disabled,U=[s.aF(k.center.lng),s.aJ(k.center.lat)];for(let G=0;G<p.length;G++){const J=p[G];if(t.hasRenderableParent(J))continue;const Y=t.getTile(J),te=Y.getBucket(c);if(!te||te.projection.name!==k.projection.name)continue;const le=f.isTileAffectedByFog(J),ge=te.programConfigurations.get(c.id),pe=f.getOrCreateProgram("heatmap",{config:ge,defines:O,overrideFog:le}),{zoom:de}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,pe),f.uploadCommonUniforms(x,pe,J.toUnwrapped());const Ne=k.projection.createInversionMatrix(k,J.canonical);pe.draw(f,S.TRIANGLES,_r.disabled,T,I,q,Tp(f,J,Y,Ne,U,de,c.paint.get("heatmap-intensity")),c.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,c.paint,f.transform.zoom,ge,D?[te.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(x,S){const T=x.context,I=T.gl,k=S.heatmapFbo;if(!k)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment0.get()),T.activeTexture.set(I.TEXTURE1);let D=S.colorRampTexture;D||(D=S.colorRampTexture=new s.T(T,S.colorRamp,I.RGBA8)),D.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,_r.disabled,Xr.disabled,x.colorModeForRenderPass(),qr.disabled,((O,q)=>({u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}))(0,S),S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)})(f,c))},line:function(f,t,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),S=c.paint.get("line-width");if(x.constantOr(1)===0||S.constantOr(1)===0)return;const T=c.paint.get("line-emissive-strength").isConstant(),I=c.paint.get("line-emissive-strength").constantOr(0),k=c.paint.get("line-occlusion-opacity"),D=c.layout.get("line-elevation-reference"),O=c.layout.get("line-width-unit")==="meters",q=D==="sea",U=!(!f.terrain||!f.terrain.enabled),G=f.context,J=G.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Y=c.layout.get("line-cross-slope"),te=Y!==void 0,le=Y<1,ge=f.colorModeForDrapableLayerRenderPass(T?I:null),pe=f.terrain&&f.terrain.renderingToTexture,de=pe?1:s.o.devicePixelRatio,Ne=c.paint.get("line-dasharray"),Ce=Ne.constantOr(1),ke=c.layout.get("line-cap"),Te=Ne.constantOr(null),_e=ke.constantOr(null),Me=c.paint.get("line-pattern"),Ue=Me.constantOr(1),Ge=c.paint.get("line-pattern-cross-fade"),it=Me.constantOr(null),tt=c.paint.get("line-opacity").constantOr(1);let mt=!Ue&&tt!==1||f.depthOcclusion&&k>0&&k<1;const Pt=c.paint.get("line-gradient"),Qe=Ue?"linePattern":"line",Le=s.e2(c);let dt;if(pe&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(mt=!1),k!==0&&f.depthOcclusion){const Kt=c.paint._values["line-opacity"];Kt&&Kt.value&&Kt.value.kind==="constant"?dt=Kt.value:s.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}S.value.kind!=="constant"&&S.value.isLineProgressConstant===!1&&Le.push("VARIABLE_LINE_WIDTH"),pe&&(f.emissiveMode!=="dual-source-blending"||T?f.emissiveMode==="mrt-fallback"&&Le.push("USE_MRT1"):Le.push("DUAL_SOURCE_BLENDING"));const nt=(Kt,Ot,Ft,gr,fr,sr)=>{for(const ar of Kt){const Mr=t.getTile(ar);if(Ue&&!Mr.patternsLoaded())continue;const Gr=Mr.getBucket(c);if(!Gr||Gr.elevationType!=="none"&&!fr||Gr.elevationType==="none"&&fr)continue;f.prepareDrawTile();const tn=[...Ot],Pn=f.shadowRenderer,Wr=Gr.elevationType==="road"&&!!Pn&&Pn.enabled;let Fn=[0,0,0];if(Wr){const mn=f.style.directionalLight,ji=f.style.ambientLight;mn&&ji&&(Fn=Vs(f.style,mn,ji)),tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const rn=Gr.programConfigurations.get(c.id);let oi=!1;if(it&&Mr.imageAtlas){const mn=s.e3.from(it),ji=mn.getPrimary().scaleSelf(de).toString(),es=Mr.imageAtlas.patternPositions.get(ji),Pi=mn.getSecondary(),Li=Pi?Mr.imageAtlas.patternPositions.get(Pi.scaleSelf(de).toString()):null;oi=!!es&&!!Li,es&&rn.setConstantPatternPositions(es,Li)}Ge>0&&(oi||rn.getPatternTransitionVertexBuffer("line-pattern"))&&tn.push("LINE_PATTERN_TRANSITION");const hi=f.isTileAffectedByFog(ar),fi=f.getOrCreateProgram(Qe,{config:rn,defines:tn,overrideFog:hi});if(!Ue&&Te&&_e&&Mr.lineAtlas){const mn=Mr.lineAtlas.getDash(Te,_e);mn&&rn.setConstantPatternPositions(mn)}Wr&&Pn.setupShadows(Mr.tileID.toUnwrapped(),fi,"vector-tile");let[On,un]=c.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&On!==un&&(On===0&&(On-=1),un===1&&(un+=1));const ti=pe?ar.projMatrix:null,Fi=O?1/Gr.tileToMeter/s.ay(Mr,1,f.transform.zoom):1,Bi=O?1/Gr.tileToMeter/s.ay(Mr,1,Math.floor(f.transform.zoom)):1,ri=Ue?s.e4(f,Mr,c,ti,de,Fi,Bi,[On,un],Fn,Ge):s.e5(f,Mr,c,ti,Gr.lineClipsArray.length,de,Fi,Bi,[On,un],Fn);if(Pt){const mn=Gr.gradients[c.id];let ji=mn.texture;if(c.gradientVersion!==mn.version){let es=256;if(c.stepInterpolant){const Pi=t.getSource().maxzoom,Li=ar.canonical.z===Pi?Math.ceil(1<<f.transform.maxZoom-ar.canonical.z):1;es=s.aA(s.e6(Gr.maxLineLength/s.al*1024*Li),256,G.maxTextureSize)}mn.gradient=s.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:es,image:mn.gradient||void 0,clips:Gr.lineClipsArray}),mn.texture?mn.texture.update(mn.gradient):mn.texture=new s.T(G,mn.gradient,J.RGBA8),mn.version=c.gradientVersion,ji=mn.texture}G.activeTexture.set(J.TEXTURE1),ji.bind(c.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}Ce&&(G.activeTexture.set(J.TEXTURE0),Mr.lineAtlasTexture&&Mr.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),rn.updatePaintBuffers()),Ue&&(G.activeTexture.set(J.TEXTURE0),Mr.imageAtlasTexture&&Mr.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),rn.updatePaintBuffers()),fr&&!q&&f.terrain.setupElevationDraw(Mr,fi),f.uploadCommonUniforms(G,fi,ar.toUnwrapped());const wn=mn=>{dt!=null&&(dt.value=tt*k),fi.draw(f,J.TRIANGLES,Ft,mn,ge,qr.disabled,ri,c.id,Gr.layoutVertexBuffer,Gr.indexBuffer,Gr.segments,c.paint,f.transform.zoom,rn,[Gr.layoutVertexBuffer2,Gr.patternVertexBuffer,Gr.zOffsetVertexBuffer]),dt!=null&&(dt.value=tt)};if(mt&&!fr){const mn=f.stencilModeForClipping(ar).ref;mn===0&&pe&&G.clear({stencil:0});const ji={func:J.EQUAL,mask:255};ri.u_alpha_discard_threshold=.8,wn(new Xr(ji,mn,255,J.KEEP,J.KEEP,J.INVERT)),ri.u_alpha_discard_threshold=0,wn(new Xr(ji,mn,255,J.KEEP,J.KEEP,J.KEEP))}else ri.u_alpha_discard_threshold=mt&&fr&&sr?.8:0,wn(fr?gr:f.stencilModeForClipping(ar))}};let yt=f.depthModeForSublayer(0,_r.ReadOnly);const Dt=new _r(f.depthOcclusion?J.GREATER:J.LEQUAL,_r.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const Kt=!pe&&f.terrain;k!==0&&Kt?s.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Kt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):nt(p,Le,yt,Xr.disabled,!1,!0)}if(c.hasElevatedBuckets){D==="hd-road-markup"?U||(yt=Dt,Le.push("ELEVATED_ROADS")):(Le.push("ELEVATED"),yt=Dt,te&&Le.push(le?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),q&&Le.push("ELEVATION_REFERENCE_SEA"));const Kt=mt?f.stencilModeFor3D():Xr.disabled;f.forceTerrainMode=!0,nt(p,Le,yt,Kt,!0,!0),mt&&nt(p,Le,yt,Kt,!0,!1),f.forceTerrainMode=!1}mt&&(f.resetStencilClippingMasks(),pe&&G.clear({stencil:0})),k===0||f.depthOcclusion||pe||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,t,c,p){const x=c.paint.get("fill-color"),S=c.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const T=c.paint.get("fill-emissive-strength"),I=f.colorModeForDrapableLayerRenderPass(T),k=c.paint.get("fill-pattern"),D=f.opaquePassEnabledForLayer()&&!k.constantOr(1)&&x.constantOr(s.ao.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";let O="none";c.layout.get("fill-elevation-reference")!=="none"?O="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(O="offset");const q=!(!f.terrain||!f.terrain.enabled),U={painter:f,sourceCache:t,layer:c,coords:p,colorMode:I,elevationType:O,terrainEnabled:q,pass:D};if(f.renderPass==="shadow")return void(f.shadowRenderer&&O==="road"&&!q&&(function(J){const{painter:Y,sourceCache:te,layer:le,coords:ge}=J,pe=Y.context.gl,de=J.painter.shadowRenderer;for(const Ne of ge){const Ce=te.getTile(Ne),ke=Ce.getBucket(le);if(!ke)continue;const Te=ke.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const _e=ke.bufferData.programConfigurations.get(le.id),Me=Y.isTileAffectedByFog(Ne),Ue=Y.getOrCreateProgram("elevatedStructuresDepth",{config:_e,overrideFog:Me}),Ge=de.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());Y.uploadCommonUniforms(Y.context,Ue,Ne.toUnwrapped());const it=gf(Ge,0);Ue.draw(Y,pe.TRIANGLES,de.getShadowPassDepthMode(),Xr.disabled,de.getShadowPassColorMode(),qr.disabled,it,le.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,le.paint,Y.transform.zoom,_e)}})(U));const G=f.emissiveMode==="mrt-fallback";if(O!=="offset"){if(Ol(U,!1,G),O==="road"){const J=!q&&f.renderPass==="translucent";J&&vf(f,t,c,p,"geometry"),Ol(U,!0,G,Xr.disabled),J&&(function(Y){const{painter:te,sourceCache:le,layer:ge,coords:pe,colorMode:de}=Y,Ne=te.context.gl,Ce=Y.painter.shadowRenderer,ke=!!Ce&&Ce.enabled,Te=new _r(te.context.gl.LEQUAL,_r.ReadOnly,te.depthRangeFor3D);let _e=[0,0,0];if(ke){const Ue=te.style.directionalLight,Ge=te.style.ambientLight;Ue&&Ge&&(_e=Vs(te.style,Ue,Ge))}const Me=Ue=>{for(const Ge of pe){const it=le.getTile(Ge),tt=it.getBucket(ge);if(!tt)continue;const mt=tt.elevatedStructures;if(!mt)continue;let Pt,Qe;if(Ue?(Pt=mt.renderableBridgeSegments,Qe=mt.bridgeProgramConfigurations.get(ge.id)):(Pt=mt.renderableTunnelSegments,Qe=mt.tunnelProgramConfigurations.get(ge.id)),!Pt||Pt.segments[0].primitiveLength===0)continue;Qe.updatePaintBuffers(),te.prepareDrawTile();const Le=te.isTileAffectedByFog(Ge),dt=[];ke&&dt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=te.getOrCreateProgram("elevatedStructures",{config:Qe,overrideFog:Le,defines:dt}),yt=te.translatePosMatrix(Ge.projMatrix,it,ge.paint.get("fill-translate"),ge.paint.get("fill-translate-anchor"));ke&&Ce.setupShadows(it.tileID.toUnwrapped(),nt,"vector-tile");const Dt=uc(yt,_e);te.uploadCommonUniforms(te.context,nt,Ge.toUnwrapped()),nt.draw(te,Ne.TRIANGLES,Te,Xr.disabled,de,qr.backCCW,Dt,ge.id,mt.vertexBuffer,mt.indexBuffer,Pt,ge.paint,te.transform.zoom,Qe,[mt.vertexBufferNormal])}};Me(!0),Me(!1)})(U)}}else Ol(U,!1,G,f.stencilModeFor3D())},"fill-extrusion":function(f,t,c,p){const x=c.paint.get("fill-extrusion-opacity"),S=f.context,T=S.gl,I=f.terrain,k=I&&I.renderingToTexture;if(x===0)return;const D=f.emissiveMode==="mrt-fallback",O=f.conflationActive&&f.style.isLayerClipped(c,t.getSource()),q=f.style.order.indexOf(c.fqid);if(O&&(function(U,G,J,Y,te){for(const le of Y){const ge=G.getTile(le).getBucket(J);ge&&(ge.updateReplacement(le,U.replacementSource,te),ge.uploadCentroid(U.context))}})(f,t,c,p,q),I||O)for(const U of p){const G=t.getTile(U).getBucket(c);G&&bf(f.context,t,U,G,c,I,O)}if(f.renderPass==="shadow"&&f.shadowRenderer){const U=f.shadowRenderer;if(I&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const G=U.getShadowPassDepthMode(),J=U.getShadowPassColorMode();rd(f,t,c,p,G,Xr.disabled,J,O)}else if(f.renderPass==="translucent"){const U=!c.paint.get("fill-extrusion-pattern").constantOr(1),G=c.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!k&&G.a!==0){const J=new _r(f.context.gl.LEQUAL,_r.ReadWrite,f.depthRangeFor3D);x===1&&U?rd(f,t,c,p,J,Xr.disabled,Jr.unblended,O):(rd(f,t,c,p,J,Xr.disabled,Jr.disabled,O),rd(f,t,c,p,J,f.stencilModeFor3D(),f.colorModeForRenderPass(),O),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&U&&(!I&&f.transform.projection.name!=="globe"||k)){const J=c.paint.get("fill-extrusion-opacity"),Y=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),te=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),le=c.paint.get("fill-extrusion-flood-light-intensity"),ge=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",pe=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ge?null:c.lut).toArray01().slice(0,3),de=Y>0&&te>0,Ne=le>0,Ce=(_e,Me,Ue)=>(1-Ue)*_e+Ue*Me,ke=new nd;ke.translate=c.paint.get("fill-extrusion-translate"),ke.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),ke.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),ke.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Te=_e=>{const Me=f.depthModeForSublayer(1,_r.ReadOnly,T.LEQUAL,!0),Ue=c.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ge=Ce(.1,3,Ue),it=f._showOverdrawInspector;if(!it){const tt=new Xr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),mt=new Jr([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);ns(ke,f,t,c,p,Me,tt,mt,qr.disabled,_e,"sdf",J,Y,te,le,pe,Ge,O,!1)}{const tt=it?Xr.disabled:new Xr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),mt=it?f.colorModeForRenderPass():new Jr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],s.ao.transparent,[!0,!0,!0,!0]);ns(ke,f,t,c,p,Me,tt,mt,qr.disabled,_e,"color",J,Y,te,le,pe,Ge,O,!1)}};if(k){const _e=()=>{const Ue=I.drapeBufferSize[0],Ge=I.drapeBufferSize[1];let it=I.framebufferCopyTexture;return it&&(!it||it.size[0]===Ue&&it.size[1]===Ge)||(it&&it.destroy(),it=I.framebufferCopyTexture=new s.T(S,new s.q({width:Ue,height:Ge}),T.RGBA8)),it.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Ue,Ge),it},Me=(Ue,Ge,it)=>{const tt=f.depthModeForSublayer(1,_r.ReadOnly,T.LEQUAL,!1),mt=c.paint.get(Ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pt=Ce(.1,3,mt);{const Qe=new Jr([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0]);ns(ke,f,t,c,p,tt,Xr.disabled,Qe,qr.disabled,Ue,"clear",J,Y,te,le,pe,Pt,O,Ge)}{const Qe=new Xr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Le=new Jr([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);ns(ke,f,t,c,p,tt,Qe,Le,qr.disabled,Ue,"sdf",J,Y,te,le,pe,Pt,O,Ge)}D&&!Ue&&(it=_e());{const Qe=Ue?T.ZERO:T.ONE_MINUS_DST_ALPHA,Le=new Xr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),dt=new Jr([Qe,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],s.ao.transparent,[!0,!0,!0,!0]);ns(ke,f,t,c,p,tt,Le,dt,qr.disabled,Ue,"color",J,Y,te,le,pe,Pt,O,Ge)}if(!D||Ue){const Qe=new Jr([T.ONE,T.ONE,T.ONE,Ue?T.ZERO:T.ONE],s.ao.transparent,[!1,!1,!1,!0],Ue?T.FUNC_ADD:T.MAX);ns(ke,f,t,c,p,tt,Xr.disabled,Qe,qr.disabled,Ue,"clear",J,Y,te,le,pe,Pt,O,Ge,it)}else{T.drawBuffers([T.NONE,T.COLOR_ATTACHMENT1]);const Qe=new Xr({func:T.EQUAL,mask:255},254,255,T.KEEP,T.DECR,T.DECR),Le=new Jr([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!0,!1,!1,!1],T.MAX);ns(ke,f,t,c,p,tt,Qe,Le,qr.disabled,Ue,"emissive",J,Y,te,le,pe,Pt,O,Ge,it),T.drawBuffers([T.COLOR_ATTACHMENT0])}};if(de||Ne){let Ue;f.prepareDrawTile(),D&&!de||(Ue=_e()),de&&Me(!0,!1,Ue),Ne&&Me(!1,!0,Ue)}}else de&&Te(!0),Ne&&Te(!1),(de||Ne)&&f.resetStencilClippingMasks()}}},building:function(f,t,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const x=c.paint.get("building-ambient-occlusion-ground-intensity"),S=c.paint.get("building-ambient-occlusion-ground-radius"),T=c.paint.get("building-ambient-occlusion-ground-attenuation"),I=c.paint.get("building-opacity");if(I<=0)return;let k=x>0&&S>0,D=!0;const O=c.paint.get("building-vertical-scale");if(O<=0)return;f.shadowRenderer||(D=!1);const q=f.conflationActive&&f.style.isLayerClipped(c,t.getSource()),U=f.style.order.indexOf(c.fqid);if((function(G,J,Y,te,le,ge){for(const pe of ge){const de=J.getTile(pe).getBucket(Y);de&&(le&&de.updateReplacement(pe,G.replacementSource,te),de.uploadUpdatedIndexBuffer(G.context))}})(f,t,c,U,q,p),(function(G,J,Y,te){for(const le of te){const ge=J.getTile(le).getBucket(Y);ge&&ge.needsEvaluation()&&ge.uploadUpdatedColorBuffer(G.context)}})(f,t,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer,J=[],Y=G.getShadowPassDepthMode();ul({painter:f,source:t,layer:c,coords:p,defines:J,blendMode:G.getShadowPassColorMode(),depthMode:Y,opacity:I,verticalScale:O,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let G=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];D&&(G=G.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(G=G.concat("NORMAL_OFFSET"));const J=c.paint.get("building-facade-emissive-chance"),Y=c.paint.get("building-ambient-occlusion-intensity"),te=c.paint.get("building-flood-light-intensity"),le=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ge=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(le?null:c.lut).toArray01().slice(0,3),pe=c.paint.get("building-flood-light-ground-attenuation"),de=te>0,Ne=new _r(f.context.gl.LEQUAL,_r.ReadWrite,f.depthRangeFor3D);I<1&&ul({painter:f,source:t,layer:c,coords:p,defines:G,blendMode:Jr.disabled,depthMode:Ne,opacity:I,verticalScale:O,facadeEmissiveChance:J,facadeAOIntensity:Y,floodLightIntensity:te,floodLightColor:ge,depthOnly:!0});const Ce=f.colorModeForRenderPass();ul({painter:f,source:t,layer:c,coords:p,defines:G,blendMode:Ce,depthMode:Ne,opacity:I,verticalScale:O,facadeEmissiveChance:J,facadeAOIntensity:Y,floodLightIntensity:te,floodLightColor:ge}),k&&Ps(f,t,c,p,!0,I,x,S,te,ge,T,q),de&&Ps(f,t,c,p,!1,I,x,S,te,ge,pe,q)}else if(f.renderPass==="light-beam"){const G=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],J=new _r(f.context.gl.LEQUAL,_r.ReadOnly,f.depthRangeFor3D);ul({painter:f,source:t,layer:c,coords:p,defines:G,blendMode:Jr.alphaBlended,depthMode:J,opacity:I,verticalScale:O,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,t,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,S=f.terrain&&f.terrain.renderingToTexture,[T,I]=f.renderPass!=="translucent"||S?[{},p]:f.stencilConfigForOverlap(p);for(const k of I){const D=t.getTile(k);if(D.needsHillshadePrepare&&f.renderPass==="offscreen")$g(f,D,c);else if(f.renderPass==="translucent"){const O=f.depthModeForSublayer(0,_r.ReadOnly),q=c.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(q),G=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(k):T[k.overscaledZ];C_(f,k,D,c,O,G,U)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,c,p,x,S){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",I=c.paint.get("raster-elevation")!==0,k=I&&T;if(f.renderElevatedRasterBackface&&!k)return;const D=f.context,O=D.gl,q=t.getSource(),U=(function(Ce,ke,Te,_e,Me){const Ue=ke.paint.get("raster-color"),Ge=Ce.type==="raster-array",it=[],tt=ke.paint.get("raster-resampling"),mt=ke.paint.get("raster-color-mix");let Pt=ke.paint.get("raster-color-range");const Qe=[mt[0],mt[1],mt[2],0],Le=mt[3];let dt=tt==="nearest"?_e.NEAREST:_e.LINEAR;if(Ge&&(it.push("RASTER_ARRAY"),Ue||it.push("RASTER_COLOR"),tt==="linear"&&it.push("RASTER_ARRAY_LINEAR"),dt=_e.NEAREST,!Pt&&Ce.rasterLayers)){const nt=Ce.rasterLayers.find(({id:yt})=>yt===ke.sourceLayer);nt&&nt.fields&&nt.fields.range&&(Pt=nt.fields.range)}if(Pt=Pt||[0,1],Ue){it.push("RASTER_COLOR"),Te.activeTexture.set(_e.TEXTURE2),ke.updateColorRamp(Pt);let nt=ke.colorRampTexture;nt||(nt=ke.colorRampTexture=new s.T(Te,ke.colorRamp,_e.RGBA8)),nt.bind(dt,_e.CLAMP_TO_EDGE)}return Me&&it.push("USE_MRT1"),{mix:Qe,range:Pt,offset:Le,defines:it,resampling:dt}})(q,c,D,O,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(q instanceof s.aU&&!p.length&&!T)return;const G=c.paint.get("raster-emissive-strength"),J=f.colorModeForDrapableLayerRenderPass(G),Y=f.terrain&&f.terrain.renderingToTexture,te=!f.options.moving,le=c.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(q instanceof s.aU&&!p.length&&(q.onNorthPole||q.onSouthPole)){const Ce=I?f.stencilModeFor3D():Xr.disabled;return void Ys(!!q.onNorthPole,null,f,t,c,G,U,qr.disabled,Ce)}if(!p.length)return;const[ge,pe]=q instanceof s.aU||Y?[{},p]:f.stencilConfigForOverlap(p),de=pe[pe.length-1].overscaledZ;k&&U.defines.push("PROJECTION_GLOBE_VIEW"),I&&U.defines.push("RENDER_CUTOFF");const Ne=(Ce,ke,Te)=>{for(const _e of Ce){const Me=_e.toUnwrapped(),Ue=t.getTile(_e);if(Y&&(!Ue||!Ue.hasData()))continue;D.activeTexture.set(O.TEXTURE0);const Ge=dh(Ue,q,c,U);if(!Ge||!Ge.texture)continue;const{texture:it,mix:tt,offset:mt,tileSize:Pt,buffer:Qe}=Ge;let Le,dt;Y?(Le=_r.disabled,dt=_e.projMatrix):I?(Le=new _r(O.LEQUAL,_r.ReadWrite,f.depthRangeFor3D),dt=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Me,te)):(Le=f.depthModeForSublayer(_e.overscaledZ-de,c.paint.get("raster-opacity")===1?_r.ReadWrite:_r.ReadOnly,O.LESS),dt=f.transform.calculateProjMatrix(Me,te));const nt=f.terrain&&Y?f.terrain.stencilModeForRTTOverlap(_e):ge[_e.overscaledZ],yt=S?0:c.paint.get("raster-fade-duration");Ue.registerFadeDuration(yt);const Dt=t.findLoadedParent(_e,0),Kt=lc(Ue,Dt,t,f.transform,yt);let Ot,Ft;!Kt.isFading&&Ue.refreshedUponExpiration&&(Ue.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),D.activeTexture.set(O.TEXTURE0),it.bind(le,O.CLAMP_TO_EDGE),D.activeTexture.set(O.TEXTURE1),Dt?(Dt.texture&&Dt.texture.bind(le,O.CLAMP_TO_EDGE),Ot=Math.pow(2,Dt.tileID.overscaledZ-Ue.tileID.overscaledZ),Ft=[Ue.tileID.canonical.x*Ot%1,Ue.tileID.canonical.y*Ot%1]):it.bind(le,O.CLAMP_TO_EDGE),"useMipmap"in it&&D.extTextureFilterAnisotropic&&f.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const gr=f.transform;let fr;const sr=I?Tf(gr):[0,0,0,0];let ar,Mr,Gr,tn,Pn,Wr=0;if(k&&q instanceof s.aU&&q.coordinates.length>3)ar=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),Mr=Float32Array.from(gr.globeMatrix),Gr=Float32Array.from(s.dF(gr)),tn=[s.aF(gr.center.lng),s.aJ(gr.center.lat)],fr=q.elevatedGlobePerspectiveTransform,Pn=q.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const hi=s.dG(_e.canonical);Wr=s.dH(hi.getCenter().lat),ar=Float32Array.from(s.bk(s.dJ(_e.canonical))),Mr=Float32Array.from(gr.globeMatrix),Gr=Float32Array.from(s.dF(gr)),tn=[s.aF(gr.center.lng),s.aJ(gr.center.lat)],fr=[0,0],Pn=Float32Array.from(s.dI(_e.canonical,hi,Wr,gr.worldSize/gr._pixelsPerMercatorPixel))}else fr=q instanceof s.aU?q.perspectiveTransform:[0,0],ar=new Float32Array(16),Mr=new Float32Array(9),Gr=new Float32Array(16),tn=[0,0],Pn=new Float32Array(9);const Fn=Ep(dt,ar,Mr,Gr,Pn,Ft||[0,0],s.aj(f.transform.zoom),tn,sr,Ot||1,Kt,c,fr,I?c.paint.get("raster-elevation"):0,2,tt,mt,U.range,Pt,Qe,G),rn=f.isTileAffectedByFog(_e),oi=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:rn});if(f.uploadCommonUniforms(D,oi,Me),q instanceof s.aU){const hi=q.elevatedGlobeVertexBuffer,fi=q.elevatedGlobeIndexBuffer;if(Y||!T)q.boundsBuffer&&q.boundsSegments&&oi.draw(f,O.TRIANGLES,Le,Xr.disabled,J,qr.disabled,Fn,c.id,q.boundsBuffer,f.quadTriangleIndexBuffer,q.boundsSegments);else if(hi&&fi){const On=gr.zoom<=s.c_?q.elevatedGlobeSegments:q.getSegmentsForLongitude(gr.center.lng);On&&oi.draw(f,O.TRIANGLES,Le,Xr.disabled,J,ke,Fn,c.id,hi,fi,On)}}else if(k){Le=new _r(O.LEQUAL,_r.ReadOnly,f.depthRangeFor3D);const hi=f.globeSharedBuffers;if(hi){const[fi,On,un]=hi.getGridBuffers(Wr,!1);oi.draw(f,O.TRIANGLES,Le,Te||nt,f.colorModeForRenderPass(),ke,Fn,c.id,fi,On,un)}}else{const{tileBoundsBuffer:hi,tileBoundsIndexBuffer:fi,tileBoundsSegments:On}=f.getTileBoundsBuffers(Ue);oi.draw(f,O.TRIANGLES,Le,nt,J,qr.disabled,Fn,c.id,hi,fi,On)}}if(!(q instanceof s.aU)&&k)for(const _e of Ce){const Me=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&Ys(!0,_e,f,t,c,G,U,ke,Te||Xr.disabled),Me&&Ys(!1,_e,f,t,c,G,U,ke===qr.frontCW?qr.backCW:qr.frontCW,Te||Xr.disabled)}};k?Ne(pe,f.renderElevatedRasterBackface?qr.backCW:qr.frontCW,f.stencilModeFor3D()):Ne(pe,qr.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,t,c,p,x,S){f.renderPass==="offscreen"&&(function(T,I,k,D){if(!D.length)return;const O=T.context,q=O.gl,U=I.getSource();if(!(U instanceof ot))return;const G=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let J=k.particlePositionRGBAImage;if(!J||J.width!==G){const pe=(function(de){const Ne=de*de,Ce=new Uint8Array(4*Ne),ke=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},Te=.9090909090909091;for(let _e=0;_e<Ne;_e++){const Me=Te*(ke(2*_e+0)+kc),Ue=Te*(ke(2*_e+1)+kc),Ge=255*Me%1,it=255*Ue%1,tt=Ge,mt=Ue-it/255,Pt=it;Ce[4*_e+0]=255*(Me-Ge/255),Ce[4*_e+1]=255*tt,Ce[4*_e+2]=255*mt,Ce[4*_e+3]=255*Pt}return Ce})(G);J=k.particlePositionRGBAImage=new s.q({width:G,height:G},pe)}let Y=k.particleFramebuffer;Y?Y.width!==G&&(Y.destroy(),Y=k.particleFramebuffer=O.createFramebuffer(G,G,1,null)):Y=k.particleFramebuffer=O.createFramebuffer(G,G,1,null);const te=[];for(const pe of D){const de=I.getTile(pe);if(!(de instanceof _s))continue;const Ne=Mo(de,U,k);if(!Ne)continue;const Ce=[de.tileSize,de.tileSize];let ke=k.tileFramebuffer;ke||(ke=k.tileFramebuffer=O.createFramebuffer(Ce[0],Ce[1],1,null));let Te=de.rasterParticleState;Te||(Te=de.rasterParticleState=new Wg(O,pe,Ce,J));const _e=Te.update(k.lastInvalidatedAt);Te.particleTextureDimension!==G&&Te.updateParticleTexture(pe,J);const Me=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Me;const Ue=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=Ue,te.push([pe,Ne,Te,_e])}if(te.length===0)return;const le=s.o.now(),ge=k.previousDrawTimestamp?.001*(le-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=le,k.hasColorMap()){O.activeTexture.set(q.TEXTURE0+2);let pe=k.colorRampTexture;pe||(pe=k.colorRampTexture=new s.T(O,k.colorRamp,q.RGBA8)),pe.bind(q.LINEAR,q.CLAMP_TO_EDGE)}O.bindFramebuffer.set(k.tileFramebuffer.framebuffer),(function(pe,de,Ne){const Ce=pe.context,ke=Ce.gl,Te=de.tileFramebuffer;Ce.activeTexture.set(ke.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(Ue=de.paint.get("raster-particle-fade-opacity-factor"))/(Ue+.05)},Me=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ue;for(const Ge of Ne){const[,,it,tt]=Ge;Te.colorAttachment0.set(it.targetColorTexture.texture),Ce.viewport.set([0,0,Te.width,Te.height]),Ce.clear({color:s.ao.transparent}),tt&&(it.backgroundColorTexture.bind(ke.NEAREST,ke.CLAMP_TO_EDGE),Me.draw(pe,ke.TRIANGLES,_r.disabled,Xr.disabled,Jr.alphaBlended,qr.disabled,_e,de.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}})(T,k,te),(function(pe,de,Ne,Ce){const ke=pe.context,Te=ke.gl,_e=Ne.tileFramebuffer,Me=pe.transform.projection.name==="globe",Ue=Ne.paint.get("raster-particle-max-speed");for(const Ge of Ce){const[it,tt,mt]=Ge;ke.activeTexture.set(Te.TEXTURE0+0),tt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),_e.colorAttachment0.set(mt.targetColorTexture.texture);const Pt=pe.getOrCreateProgram("rasterParticleDraw",{defines:tt.defines,overrideFog:!1});ke.activeTexture.set(Te.TEXTURE0+1);const Qe=tt.scalarData?[]:[0,1,2,3].map(nt=>s.e9[nt](it));Qe.push(it);const Le=it.canonical.x,dt=it.canonical.y;for(const nt of Qe){const yt=de.getTile(Me?nt.wrapped():nt);if(!yt)continue;const Dt=yt.rasterParticleState;if(!Dt)continue;const Kt=nt.canonical.x+(1<<nt.canonical.z)*(nt.wrap-it.wrap),Ot=nt.canonical.y;Dt.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const Ft=Cp(1,Dt.particleTexture0.size[0],[Kt-Le,Ot-dt],0,tt.texture.size,2,Ue,tt.textureOffset,tt.scale,tt.offset);Pt.draw(pe,Te.POINTS,_r.disabled,Xr.disabled,Jr.alphaBlended,qr.disabled,Ft,Ne.id,Dt.particleIndexBuffer,void 0,Dt.particleSegment)}}})(T,I,k,te),O.bindFramebuffer.set(k.particleFramebuffer.framebuffer),(function(pe,de,Ne,Ce){const ke=pe.context,Te=ke.gl,_e=de.paint.get("raster-particle-max-speed"),Me=Ce*de.paint.get("raster-particle-speed-factor")*.15,Ue=(function(it){return Math.pow(it,6)})(.01+1*de.paint.get("raster-particle-reset-rate-factor")),Ge=de.particleFramebuffer;ke.viewport.set([0,0,Ge.width,Ge.height]);for(const it of Ne){const[,tt,mt]=it;ke.activeTexture.set(Te.TEXTURE0+0),tt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),ke.activeTexture.set(Te.TEXTURE0+1);const Pt=mt.particleTexture0;Pt.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const Qe=Fm(1,Pt.size[0],0,tt.texture.size,_e,Me,Ue,tt.textureOffset,tt.scale,tt.offset);Ge.colorAttachment0.set(mt.particleTexture1.texture),ke.clear({color:s.ao.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:tt.defines}).draw(pe,Te.TRIANGLES,_r.disabled,Xr.disabled,Jr.unblended,qr.disabled,Qe,de.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}})(T,k,te,ge)})(f,t,c,p),f.renderPass==="translucent"&&((function(T,I,k,D){const O=T.context,q=O.gl,U=I.getSource().tileSize,G=5*(1-s.ah(s.cL,s.cL+1,T.transform.zoom))*U+k.paint.get("raster-particle-elevation"),J=!T.options.moving,Y=T.transform.projection.name==="globe";if(!D.length)return;const[te,le]=T.stencilConfigForOverlap(D),ge=[];Y&&ge.push("PROJECTION_GLOBE_VIEW");const pe=T.stencilModeFor3D();for(const de of le){const Ne=de.toUnwrapped(),Ce=I.getTile(de);if(!Ce.rasterParticleState)continue;const ke=Ce.rasterParticleState,Te=100;Ce.registerFadeDuration(Te);const _e=I.findLoadedParent(de,0),Me=lc(Ce,_e,I,T.transform,Te);let Ue,Ge;T.terrain&&T.terrain.prepareDrawTile(),O.activeTexture.set(q.TEXTURE0),ke.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),O.activeTexture.set(q.TEXTURE1),_e&&_e.rasterParticleState?(_e.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Ue=Math.pow(2,_e.tileID.overscaledZ-Ce.tileID.overscaledZ),Ge=[Ce.tileID.canonical.x*Ue%1,Ce.tileID.canonical.y*Ue%1]):ke.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const it=Y?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Ne,J),tt=T.transform,mt=Np(tt),Pt=s.dG(de.canonical),Qe=s.dH(Pt.getCenter().lat);let Le,dt,nt,yt,Dt;Y?(Le=Float32Array.from(s.bk(s.dJ(de.canonical))),dt=Float32Array.from(tt.globeMatrix),nt=Float32Array.from(s.dF(tt)),yt=[s.aF(tt.center.lng),s.aJ(tt.center.lat)],Dt=Float32Array.from(s.dI(de.canonical,Pt,Qe,tt.worldSize/tt._pixelsPerMercatorPixel))):(Le=new Float32Array(16),dt=new Float32Array(9),nt=new Float32Array(16),yt=[0,0],Dt=new Float32Array(9));const Kt=oh(it,Le,dt,nt,Dt,Ge||[0,0],s.aj(T.transform.zoom),yt,mt,Ue||1,Me,G),Ot=T.isTileAffectedByFog(de),Ft=T.getOrCreateProgram("rasterParticle",{defines:ge,overrideFog:Ot});if(T.uploadCommonUniforms(O,Ft,Ne),Y){const gr=new _r(q.LEQUAL,_r.ReadOnly,T.depthRangeFor3D),fr=0,sr=T.globeSharedBuffers;if(sr){const[ar,Mr,Gr]=sr.getGridBuffers(Qe,fr!==0);Ft.draw(T,q.TRIANGLES,gr,pe,Jr.alphaBlended,T.renderElevatedRasterBackface?qr.frontCCW:qr.backCCW,Kt,k.id,ar,Mr,Gr)}}else{const gr=T.depthModeForSublayer(0,_r.ReadOnly),fr=te[de.overscaledZ],{tileBoundsBuffer:sr,tileBoundsIndexBuffer:ar,tileBoundsSegments:Mr}=T.getTileBoundsBuffers(Ce);Ft.draw(T,q.TRIANGLES,gr,fr,Jr.alphaBlended,qr.disabled,Kt,k.id,sr,ar,Mr)}}T.resetStencilClippingMasks()})(f,t,c,p),f.style.map.triggerRepaint())},background:function(f,t,c,p){const x=c.paint.get("background-color"),S=c.paint.get("background-color-use-theme").constantOr("default")==="none",T=c.paint.get("background-opacity"),I=c.paint.get("background-emissive-strength"),k=c.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const D=f.context,O=D.gl,q=f.transform,U=q.tileSize,G=c.paint.get("background-pattern");let J;if(G!==void 0&&(G===null||(J=f.imageManager.getPattern(s.I.from(G.toString()),c.scope,f.style.getLut(c.scope)),!J)))return;const Y=!G&&x.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const te=Xr.disabled,le=f.depthModeForSublayer(0,Y==="opaque"?_r.ReadWrite:_r.ReadOnly),ge=f.colorModeForDrapableLayerRenderPass(I),pe=G?"backgroundPattern":"background";let de,Ne=p;Ne||(de=f.getBackgroundTiles(),Ne=Object.values(de).map(ke=>ke.tileID)),G&&(D.activeTexture.set(O.TEXTURE0),f.imageManager.bind(f.context,c.scope));const Ce=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&Ce.push("USE_MRT1"),k){const ke=f.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0,defines:Ce}),Te=new Float32Array(s.bA([])),_e=new s.aQ(0,0,0,0,0),Me=G?la(Te,I,T,f,0,c.scope,J,k,{tileID:_e,tileSize:U}):Qa(Te,I,T,x.toPremultipliedRenderColor(S?null:c.lut));return void ke.draw(f,O.TRIANGLES,le,te,ge,qr.disabled,Me,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}for(const ke of Ne){const Te=f.isTileAffectedByFog(ke),_e=f.getOrCreateProgram(pe,{overrideFog:Te,defines:Ce}),Me=ke.toUnwrapped(),Ue=p?ke.projMatrix:f.transform.calculateProjMatrix(Me);f.prepareDrawTile();const Ge=t?t.getTile(ke):de?de[ke.key]:new Ei(ke,U,q.zoom,f),it=G?la(Ue,I,T,f,0,c.scope,J,k,{tileID:ke,tileSize:U}):Qa(Ue,I,T,x.toPremultipliedRenderColor(S?null:c.lut));f.uploadCommonUniforms(D,_e,Me);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:mt,tileBoundsSegments:Pt}=f.getTileBoundsBuffers(Ge);_e.draw(f,O.TRIANGLES,le,te,ge,qr.disabled,it,c.id,tt,mt,Pt)}},sky:function(f,t,c){const p=f._atmosphere?s.aj(f.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const S=f.context,T=c.paint.get("sky-type"),I=new _r(S.gl.LEQUAL,_r.ReadOnly,[0,1]),k=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&((function(D,O){const q=D.context,U=q.gl;let G=O.skyboxFbo;if(!G){G=O.skyboxFbo=q.createFramebuffer(32,32,1,null),O.skyboxGeometry=new ca(q),O.skyboxTexture=q.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,O.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let le=0;le<6;++le)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(G.framebuffer),q.viewport.set([0,0,32,32]);const J=O.getCenter(D,!0),Y=D.getOrCreateProgram("skyboxCapture"),te=new Float64Array(16);s.bA(te),s.en(te,te,.5*-Math.PI),Rc(D,O,Y,te,J,0),s.bA(te),s.en(te,te,.5*Math.PI),Rc(D,O,Y,te,J,1),s.bA(te),s.cU(te,te,.5*-Math.PI),Rc(D,O,Y,te,J,2),s.bA(te),s.cU(te,te,.5*Math.PI),Rc(D,O,Y,te,J,3),s.bA(te),Rc(D,O,Y,te,J,4),s.bA(te),s.en(te,te,Math.PI),Rc(D,O,Y,te,J,5),q.viewport.set([0,0,D.width,D.height])})(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&(function(D,O,q,U,G){const J=D.context,Y=J.gl,te=D.transform,le=D.getOrCreateProgram("skybox");J.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture);const ge=((pe,de,Ne,Ce,ke)=>({u_matrix:pe,u_sun_direction:de,u_cubemap:0,u_opacity:Ce,u_temporal_offset:ke}))(te.skyboxMatrix,O.getCenter(D,!1),0,U,G);D.uploadCommonUniforms(J,le),le.draw(D,Y.TRIANGLES,q,Xr.disabled,D.colorModeForRenderPass(),qr.backCW,ge,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)})(f,c,I,x,k):T==="gradient"&&f.renderPass==="sky"&&(function(D,O,q,U,G){const J=D.context,Y=J.gl,te=D.transform,le=D.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new ca(J)),J.activeTexture.set(Y.TEXTURE0);let ge=O.colorRampTexture;ge||(ge=O.colorRampTexture=new s.T(J,O.colorRamp,Y.RGBA8)),ge.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const pe=((de,Ne,Ce,ke,Te)=>({u_matrix:de,u_color_ramp:0,u_center_direction:Ne,u_radius:s.an(Ce),u_opacity:ke,u_temporal_offset:Te}))(te.skyboxMatrix,O.getCenter(D,!1),O.paint.get("sky-gradient-radius"),U,G);D.uploadCommonUniforms(J,le),le.draw(D,Y.TRIANGLES,q,Xr.disabled,D.colorModeForRenderPass(),qr.backCW,pe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)})(f,c,I,x,k)},custom:function(f,t,c,p){const x=f.context,S=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(t)){if(f.renderPass==="offscreen"){const T=S.prerender;if(T){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;T.call(S,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else T.call(S,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const I=S.renderToTile;if(I){const k=p[0].canonical,D={x:k.x+p[0].wrap*(S.wrapTileId?0:1<<k.z),y:k.y,z:k.z};x.setDepthMode(_r.disabled),x.setStencilMode(Xr.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(S,x.gl,D),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(Xr.disabled);const T=S.renderingMode==="3d"?new _r(f.context.gl.LEQUAL,_r.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,_r.ReadOnly);if(x.setDepthMode(T),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;S.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else S.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,t,c,p){if(f.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1),S=c.paint.get("model-elevation-reference"),T=S==="ground",I=S==="ground";if(x===0)return;const k=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!k||f.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const D=f.shadowRenderer,O=c.paint.get("model-receive-shadows");D&&(D.useNormalOffset=!0,O||(D.enabled=!1));const q=()=>{D&&(D.useNormalOffset=!0,O||(D.enabled=!0))},U=t.getSource();if(f.renderPass==="light-beam"&&U.type!=="batched-model")return;if(U.type==="vector"||U.type==="geojson")return(function(de,Ne,Ce,ke,Te){const _e=de.transform,Me=_e.projection.name==="globe",Ue=_e.getFreeCameraOptions().position;if(!de.modelManager)return;const Ge=de.modelManager;Ce.modelManager=Ge;const it=de.shadowRenderer;if(!Ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const tt=Ce._unevaluatedLayout._values["model-id"],mt=Object.assign({},Ce.layout.get("model-id").parameters),Pt=de.style.order.indexOf(Ce.fqid),Qe=Ce.paint.get("model-opacity").constantOr(1);for(const Le of ke){const dt=Ne.getTile(Le).getBucket(Ce);if(!dt||dt.projection.name!==_e.projection.name)continue;const nt=dt.getModelUris();if(nt&&!dt.modelsRequested&&(Ge.addModelsFromBucket(nt,Te),dt.modelsRequested=!0),Me)mt.zoom=Le.overscaledZ;else{const sr=zt(Le,_e);mt.zoom=sr}const yt=tt.possiblyEvaluate(mt);if(gu(de,dt,Le),ua.shadowUniformsInitialized=!1,ua.useSingleShadowCascade=!!it&&it.getMaxCascadeForTile(Le.toUnwrapped())===0,de.renderPass==="shadow"&&it){if(de.currentShadowCascade===1&&dt.isInsideFirstShadowMapFrustum)continue;const sr=_e.calculatePosMatrix(Le.toUnwrapped(),_e.worldSize);if(ua.tileMatrix.set(sr),ua.shadowTileMatrix=Float32Array.from(it.calculateShadowPassMatrixFromMatrix(sr)),ua.aabb.min=[0,0,0],ua.aabb.max[0]=ua.aabb.max[1]=s.al,ua.aabb.max[2]=0,is(dt,ua,de,Ce.scope))continue}const Dt=1<<Le.canonical.z,Kt=[((Ue.x-Le.wrap)*Dt-Le.canonical.x)*s.al,(Ue.y*Dt-Le.canonical.y)*s.al,Ue.z*Dt*s.al];de.conflationActive&&Object.keys(dt.instancesPerModel).length>0&&de.style.isLayerClipped(Ce,Ne.getSource())&&dt.updateReplacement(Le,de.replacementSource,Pt,Ce.scope)&&(dt.uploaded=!1,dt.upload(de.context));let Ot=0;const Ft=new Array,gr=new Array,fr=new Array;for(let sr in dt.instancesPerModel){const ar=dt.instancesPerModel[sr];ar.features.length>0&&!Me&&(sr=yt.evaluate(ar.features[0].feature,{}));const Mr=Ge.getModel(sr,Te);if(Mr||Ge.hasURLBeenRequested(sr)||dt.modelUris.includes(sr)||(dt.modelUris.push(sr),dt.modelsRequested=!1),Mr&&Mr.uploaded)if(Me){const Gr=s.c5([],[Ue.x,Ue.y,Ue.z],de.transform.worldSize);s.ew(Gr,Gr);for(let tn=0;tn<ar.instancedDataArray.length;++tn){const Pn=[0,0,0],Wr=[1,1,1],Fn=s.ex(),rn=ar.tileCoordinatesForInstance(tn),oi=ar.transformForInstance(tn);s.ey(Wr,oi),s.ez(Fn,oi),s.eA(Pn,Fn);const hi=ar.translationForInstance(tn),fi=new s.aT(0,0);s.eB(dt.canonical,fi,rn.x,rn.y);const On=s.bC();s.eC(On,Mr,de.transform,fi,Pn,Wr,hi,!0,!1,!1);const un=ar.colorForInstance(tn),ti=s.bA([]),Fi=s.ef(fi.lat,de.transform.zoom),Bi=s.bq([],[1,1,1/Fi]);s.br(ti,ti,Gr),fr.push({zScaleMatrix:Bi,negCameraPosMatrix:ti});for(const ri of Mr.nodes)sd(de,ri,On,de.transform.expandedFarZProjMatrix,Ot,Ft,gr,Mr.materialOverrides,Qe,un);++Ot}}else for(const Gr of Mr.nodes)er(de,Ce,Gr,ar,Kt,Le,ua)}if(Me)if(de.renderPass==="shadow"){for(const sr of gr)od(sr.mesh,sr.nodeModelMatrix,de,Ce);for(const sr of Ft)od(sr.mesh,sr.nodeModelMatrix,de,Ce)}else qm(de,Ce,Ft,gr,fr)}})(f,t,c,p,fh(f,c)),void q();if(!U.loaded())return;if(U.type==="batched-model")return(function(de,Ne,Ce,ke){Ce.resetLayerRenderingStats(de);const Te=de.context,_e=de.transform,Me=de.style.fog,Ue=de.shadowRenderer;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const Ge=de.transform.getFreeCameraOptions().position,it=s.c5([],[Ge.x,Ge.y,Ge.z],de.transform.worldSize),tt=s.ew([],it),mt=s.bA([]),Pt=s.ef(_e.center.lat,_e.zoom),Qe=s.bq([],[1,1,1/Pt]);s.br(mt,mt,tt);const Le=Ce.paint.get("model-opacity").constantOr(1),dt=new _r(Te.gl.LEQUAL,_r.ReadWrite,de.depthRangeFor3D),nt=new _r(Te.gl.LEQUAL,_r.ReadOnly,de.depthRangeFor3D),yt=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Dt=de.renderPass==="shadow",Kt=Dt&&Ue?Ue.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),Ot=Ce.paint.get("model-front-cutoff"),Ft=Ot[2]<1,gr=Ha(de,Ce.paint.get("model-cutoff-fade-range")),fr=Ce.getLayerRenderingStats();(function(sr,ar,Mr,Gr){const tn=sr.terrain?sr.terrain.exaggeration():0,Pn=sr.transform.zoom;for(const Wr of Gr){const Fn=ar.getTile(Wr).getBucket(Mr);Fn&&(Fn.setFilter(Mr.filter),sr.conflationActive&&Fn.updateReplacement(Wr,sr.replacementSource),Fn.evaluateTransform(sr,Mr),sr.terrain&&tn>0&&Fn.elevationUpdate(sr.terrain,tn,Wr,Mr.source),Fn.needsReEvaluation(sr,Pn,Mr)&&Fn.evaluate(Mr))}})(de,Ne,Ce,ke),(function(){let sr,ar,Mr;Ft?(sr=ke.length-1,ar=-1,Mr=-1):(sr=0,ar=ke.length,Mr=1);const Gr=new Float64Array(16),tn=s.cA(),Pn=new s.P(0,0);for(let Wr=sr;Wr!==ar;Wr+=Mr){const Fn=ke[Wr],rn=Ne.getTile(Fn).getBucket(Ce);if(!rn||!rn.uploaded)continue;let oi=!1;Ue&&(oi=Ue.getMaxCascadeForTile(Fn.toUnwrapped())===0);const hi=_e.calculatePosMatrix(Fn.toUnwrapped(),_e.worldSize),fi=rn.modelTraits;!Dt&&Ft&&(s.bl(Gr,hi),s.af(tn,it,Gr),Pn.x=tn[0],Pn.y=tn[1]);const On=[];rn.setFilter(Ce.filter);for(const un of rn.getNodesInfo()){if(un.hiddenByReplacement||!un.node.meshes)continue;const ti=un.node;let Fi=0;de.terrain&&ti.elevation&&(Fi=ti.elevation*de.terrain.exaggeration());const Bi=(()=>{const Wn=un.aabb;return yt.min=[...Wn.min],yt.max=[...Wn.max],yt.min[2]+=Fi,yt.max[2]+=Fi,s.af(yt.min,yt.min,hi),s.af(yt.max,yt.max,hi),yt})(),ri=un.evaluatedScale;if(ri[0]<=1&&ri[1]<=1&&ri[2]<=1&&Bi.intersects(Kt)===0)continue;if(!Dt&&Ft){const Wn=.16666666666666666;un.cameraCollisionOpacity=it[0]>Bi.min[0]&&it[0]<Bi.max[0]&&it[1]>Bi.min[1]&&it[1]<Bi.max[1]&&it[2]*Pt<Bi.max[2]&&ti.footprint&&s.c0(Pn,ti.footprint)?Math.max(un.cameraCollisionOpacity-Wn,0):Math.min(1,un.cameraCollisionOpacity+Wn)}const wn=[...hi],mn=1/s.d7(Fn.canonical),ji=ti.anchor?ti.anchor[0]:0,es=ti.anchor?ti.anchor[1]:0;s.br(wn,wn,[ji*(ri[0]-1)+un.evaluatedTranslation[0]*mn,es*(ri[1]-1)+un.evaluatedTranslation[1]*mn,Fi+un.evaluatedTranslation[2]]),s.cq(ri,s.eE)||s.cS(wn,wn,ri);const Pi=s.aB([],wn,ti.globalMatrix),Li=s.aB([],_e.expandedFarZProjMatrix,Pi),bo=s.aB([],_e.expandedFarZProjMatrix,wn),fa=s.aC([],[ji,es,Fi,1],Li)[2];ti.hidden=!1;let Js=Le;Dt||(Ft&&(Js*=un.cameraCollisionOpacity,Js*=Zg(wn,_e,un.aabb,Ot)),Js*=He(gr,fa)),Js!==0?On.push({nodeInfo:un,depth:fa,opacity:Js,wvpForNode:Li,wvpForTile:bo,nodeModelMatrix:Pi,tileModelMatrix:wn}):ti.hidden=!0}Dt||On.sort((un,ti)=>!Ft||un.opacity===1&&ti.opacity===1?un.depth<ti.depth?-1:1:un.opacity===1?-1:ti.opacity===1?1:un.depth>ti.depth?-1:1);for(const un of On){const ti=un.nodeInfo,Fi=ti.node;let Bi=s.aB([],Qe,un.tileModelMatrix);s.aB(Bi,mt,Bi);const ri=s.bl([],Bi);s.eg(ri,ri),s.cS(ri,ri,ad),Bi=s.aB(Bi,Bi,Fi.globalMatrix);const wn=de.renderPass==="light-beam",mn=Ce.paint.get("model-color-use-theme").constantOr("default")==="none",ji=fi&s.eI.HasMapboxMeshFeatures,es=ji?0:ti.evaluatedRMEA[0][2];for(let Pi=0;Pi<Fi.meshes.length;++Pi){const Li=Fi.meshes[Pi],bo=Pi===Fi.lightMeshIndex;let fa=un.wvpForNode;if(bo){if(!wn&&!de.terrain&&de.shadowRenderer){de.currentLayer<de.firstLightBeamLayer&&(de.firstLightBeamLayer=de.currentLayer);continue}fa=un.wvpForTile}else if(wn)continue;const Js={defines:[]},Wn=[];if(!Dt&&Ue&&(Ue.useNormalOffset=!!Li.normalBuffer),fl(Js.defines,Wn,Li,de,mn?null:Ce.lut),ji||Js.defines.push("DIFFUSE_SHADED"),oi&&Js.defines.push("SHADOWS_SINGLE_CASCADE"),fr&&(Dt?fr.numRenderedVerticesInShadowPass+=Li.vertexArray.length:fr.numRenderedVerticesInTransparentPass+=Li.vertexArray.length),Dt){od(Li,un.nodeModelMatrix,de,Ce);continue}let $a=null;if(Me){const P=Lp(un.nodeModelMatrix,de.transform);if($a=new Float32Array(P),_e.projection.name!=="globe"){const z=Li.aabb.min,Z=Li.aabb.max,[ie,we]=Me.getOpacityForBounds(P,z[0],z[1],Z[0],Z[1]);Js.overrideFog=ie>=ct||we>=ct}}const zs=Li.material;let pa;zs.occlusionTexture&&zs.occlusionTexture.offsetScale&&(pa=zs.occlusionTexture.offsetScale,Js.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ia=de.getOrCreateProgram("model",Js);!Dt&&Ue&&Ue.setupShadowsFromMatrix(un.tileModelMatrix,Ia,Ue.useNormalOffset),de.uploadCommonUniforms(Te,Ia,null,$a);const _=zs.pbrMetallicRoughness;_.metallicFactor=.9,_.roughnessFactor=.5;const w=lh(new Float32Array(fa),new Float32Array(Bi),new Float32Array(ri),new Float32Array(Fi.globalMatrix),de,un.opacity,_.baseColorFactor,zs.emissiveFactor,_.metallicFactor,_.roughnessFactor,zs,es,Ce,[0,0,0],pa);!bo&&(ti.hasTranslucentParts||un.opacity<1)&&Ia.draw(de,Te.gl.TRIANGLES,dt,Xr.disabled,Jr.disabled,qr.backCCW,w,Ce.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,Ce.paint,de.transform.zoom,void 0,Wn),Ia.draw(de,Te.gl.TRIANGLES,bo?nt:dt,Xr.disabled,bo||un.opacity<1||ti.hasTranslucentParts?Jr.alphaBlended:Jr.unblended,qr.backCCW,w,Ce.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,Ce.paint,de.transform.zoom,void 0,Wn)}}}})()})(f,t,c,p),void q();if(U.type!=="model")return;const G=U.getModels(),J=[],Y=f.transform.getFreeCameraOptions().position,te=s.c5([],[Y.x,Y.y,Y.z],f.transform.worldSize);s.ew(te,te);const le=[],ge=[];let pe=0;for(const de of G){const Ne=t.getFeatureState("",de.id),Ce={type:"Unknown",id:de.id,properties:de.featureProperties},ke=c.paint.get("model-rotation").evaluate(Ce,Ne),Te=c.paint.get("model-scale").evaluate(Ce,Ne),_e=c.paint.get("model-translation").evaluate(Ce,Ne),Me=c.paint.get("model-opacity").evaluate(Ce,Ne);Um(c,de.id,Ne,de.featureProperties,de.nodeOverrideNames,de.nodeOverrides),$m(c,de.id,Ne,de.featureProperties,de.materialOverrideNames,de.materialOverrides),de.nodeOverrides.size>0&&de.computeBoundsAndApplyParent(),de.computeModelMatrix(f,ke,Te,_e,I,T,!1);const Ue=s.bA([]),Ge=s.ef(de.position.lat,f.transform.zoom),it=s.bq([],[1,1,1/Ge]);s.br(Ue,Ue,te),J.push({zScaleMatrix:it,negCameraPosMatrix:Ue});for(const tt of de.nodes)sd(f,tt,de.matrix,f.transform.expandedFarZProjMatrix,pe,le,ge,de.materialOverrides,Me);pe++}if(le.sort((de,Ne)=>Ne.depth-de.depth),f.renderPass!=="shadow")qm(f,c,le,ge,J),q();else{for(const de of ge)od(de.mesh,de.nodeModelMatrix,f,c);for(const de of le)od(de.mesh,de.nodeModelMatrix,f,c);q()}}},zp={line:function(f,t,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const p=t.getVisibleCoordinates();for(const x of p){const S=t.getTile(x).getBucket(f);if(S&&(S.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,t,c){const p=t.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,fh(c,f)));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const S of x)S.upload(c.context)},raster:function(f,t,c){const p=t.getSource();if(!(p instanceof ot&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const S=f.paint.get("raster-array-band")||p.getInitialBand(x);if(S==null)return;const T=t.getIds().map(I=>t.getTileByID(I));for(const I of T)I.updateNeeded(f.id,S)&&p.prepareTile(I,x,f.id,S)},"raster-particle":function(f,t,c){const p=t.getSource();if(!(p instanceof ot&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const S=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(S==null)return;const T=t.getIds().map(I=>t.getTileByID(I));for(const I of T)I.updateNeeded(f.id,S)&&p.prepareTile(I,x,f.id,S)}},Fp={fill:vf},Qg={fill:function(f,t,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const x=f.context.gl,S=new _r(x.LEQUAL,_r.ReadOnly,f.depthRangeFor3D),T=new Xr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),I=f.transform.getFreeCameraOptions().position,k=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const D of p){const O=t.getTile(D),q=O.getBucket(c);if(!q)continue;const U=q.elevatedStructures;if(!U||U.depthSegments.segments[0].primitiveLength===0)continue;const G=Nc(D.toUnwrapped(),I),J=f.translatePosMatrix(D.projMatrix,O,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Y=hu(J,G,0,1,0);k.draw(f,x.TRIANGLES,S,T,Jr.disabled,qr.disabled,Y,c.id,U.vertexBuffer,U.indexBuffer,U.depthSegments,c.paint,f.transform.zoom)}}};class Ca{constructor(t,c,p,x,S){this.context=new Ll(t,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of T)this._debugParams.enabledLayers[k]=!0;for(const k of T);this.occlusionParams=new el,this.setup(),this.numSublayers=qo.maxUnderzooming+qo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ef(this),this._wireframeDebugCache=new Gm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=S,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,c){const p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fa(this,t));const x=this._terrain;this.transform.elevation=p?x:null,x.update(t,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(t){const c=t.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const S=p+.78*(x-p);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Fa(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,c){if(this.width=t*s.o.devicePixelRatio,this.height=c*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const t=this.context,c=new s.bd;c.emplaceBack(0,0),c.emplaceBack(s.al,0),c.emplaceBack(0,s.al),c.emplaceBack(s.al,s.al),this.tileExtentBuffer=t.createVertexBuffer(c,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const p=new s.bd;p.emplaceBack(0,0),p.emplaceBack(s.al,0),p.emplaceBack(0,s.al),p.emplaceBack(s.al,s.al),this.debugBuffer=t.createVertexBuffer(p,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const x=new s.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(x,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const S=new s.b1;S.emplaceBack(0,0,0,0),S.emplaceBack(s.al,0,s.al,0),S.emplaceBack(0,s.al,0,s.al),S.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=t.createVertexBuffer(S,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const T=new s.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const I=new s.be;for(const D of[0,1,3,2,0])I.emplaceBack(D);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new s.T(t,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bC();const k=this.context.gl;this.stencilClearMode=new Xr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,_r.disabled,this.stencilClearMode,Jr.disabled,qr.disabled,ll(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,c,p){if(!c||this.currentStencilSource===c.id||!t.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const k of p)if(this._tileClippingMaskIDs[k.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;const x=this.context,S=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(Jr.disabled),x.setDepthMode(_r.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const k=c.getTile(I),D=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:q,tileBoundsSegments:U}=this.getTileBoundsBuffers(k);T.draw(this,S.TRIANGLES,_r.disabled,new Xr({func:S.ALWAYS,mask:0},D,255,S.KEEP,S.KEEP,S.REPLACE),Jr.disabled,qr.disabled,ll(I.projMatrix),"$clipping",O,q,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,c=this.context.gl;return new Xr({func:c.NOTEQUAL,mask:255},t,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const c=this.context.gl;return new Xr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(t){const c=this.context.gl,p=t.sort((T,I)=>I.overscaledZ-T.overscaledZ),x=p[p.length-1].overscaledZ,S=p[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const T={};for(let I=0;I<S;I++)T[I+x]=new Xr({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[T,p]}return[{[x]:Xr.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Jr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jr.unblended:Jr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Jr([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Jr([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,c,p,x=!1){if(this.depthOcclusion)return new _r(this.context.gl.GREATER,_r.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return _r.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _r(p||this.context.gl.LEQUAL,c,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),S=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new Ea(this.context,c,p,0,"texture"),this.depthTexture=new s.T(this.context,{width:c,height:p,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),t.bindTexture(t.TEXTURE_2D,S),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,c,p,0,0,c,p,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,c)=>t+c/this._fpsHistory.length,0))}render(t,c){const p=s.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=c;const x=this.style._mergedLayers,S=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(S).filter(Qe=>{const Le=x[Qe];return!(Le.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Le.type]});let I=T(),k=!1,D=!1,O=null,q=0,U=!1;for(const Qe of I){const Le=x[Qe];Le.visibility!=="none"&&(Le.type==="circle"?k=!0:Le.type==="building"?(O=Le,++q):Le.type==="symbol"&&(Le.hasOcclusionOpacityProperties?D=!0:k=!0))}this.updateEmissiveMode();let G=I.map(Qe=>x[Qe]);const J=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const Qe in J){const Le=J[Qe];Le.used&&(Le.prepare(this.context),Le.getSource().usedInConflation&&++q)}let Y=!1;for(const Qe of G)Qe.isHidden(this.transform.zoom)||(Qe.type==="clip"&&(Y=!0),this.prepareLayer(Qe));const te={},le={},ge={},pe={},de={};for(const Qe in J){const Le=J[Qe];te[Qe]=Le.getVisibleCoordinates(),le[Qe]=te[Qe].slice().reverse(),ge[Qe]=Le.getVisibleCoordinates(!0).reverse(),pe[Qe]=Le.getShadowCasterCoordinates(),de[Qe]=Le.sortCoordinatesByDistance(te[Qe])}const Ne=Qe=>{const Le=this.style.getLayerSourceCache(Qe);return Le&&Le.used?Le.getSource():null};if(q||Y||this._clippingActiveLastFrame){const Qe=[],Le=[];let dt=0;for(const nt of G)this.isSourceForClippingOrConflation(nt,Ne(nt))&&(Qe.push(nt),Le.push(dt)),dt++;if(Qe&&(Y||Qe.length>1)||this._clippingActiveLastFrame){Y=!1;const nt=[];for(let yt=0;yt<Qe.length;yt++){const Dt=Qe[yt],Kt=Le[yt],Ot=this.style.getLayerSourceCache(Dt);if(!Ot||!Ot.used||!Ot.getSource().usedInConflation&&Dt.type!=="clip"&&Dt.type!=="building")continue;let Ft=s.eQ,gr=s.b_.None;const fr=[];let sr=!0;if(Dt.type==="building")Ft=s.eS;else if(Dt.type==="clip")if(Ft=Kt,Dt.isHidden(this.transform.zoom))sr=!1;else{if(!Dt.layout){sr=!1;continue}for(const ar of Dt.layout.get("clip-layer-types"))gr|=ar==="model"?s.b_.Model:ar==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const ar of Dt.layout.get("clip-layer-scope"))fr.push(ar);Y=!0}sr&&nt.push({layer:Dt.fqid,cache:Ot,order:Ft,clipMask:gr,clipScope:fr})}this.replacementSource.setSources(nt),U=!0}}this._clippingActiveLastFrame=Y,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Qe=0;Qe<G.length;Qe++){const Le=G[Qe];if(Le.visibility==="none")continue;const dt=Le.cutoffRange();if(this.longestCutoffRange=Math.max(dt,this.longestCutoffRange),dt>0){const nt=Ne(Le);nt&&(this.minCutoffZoom=Math.max(nt.minzoom,this.minCutoffZoom)),Le.minzoom&&(this.minCutoffZoom=Math.max(Le.minzoom,this.minCutoffZoom))}Le.is3D(S)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Qe),this._lastOcclusionLayer=Qe)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ge),this.opaquePassCutoff=0,I=T(),G=I.map(Qe=>x[Qe]));const ke=this._shadowRenderer;if(ke){ke.updateShadowParameters(this.transform,this.style.directionalLight);for(const Qe in J)for(const Le of te[Qe]){let dt={min:0,max:0};this.terrain&&(dt=this.terrain.getMinMaxForTile(Le)||dt),ke.addShadowReceiver(Le.toUnwrapped(),dt.min,dt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Mp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),_e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new mh(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),_e&&!this._rain&&(this._rain=new Yg(this)),!_e&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),O){this.buildingTileBorderManager||(this.buildingTileBorderManager=new kf);const Qe=this.style.getLayerSourceCache(O);this.buildingTileBorderManager.updateBorders(Qe,O)}if(!pt.has(this.context.gl))return;this.renderPass="offscreen";for(const Qe of G){const Le=t.getLayerSourceCache(Qe);if(!Qe.hasOffscreenPass()||Qe.isHidden(this.transform.zoom))continue;const dt=Le?le[Le.id]:void 0;(Qe.type==="custom"||Qe.type==="raster"||Qe.type==="raster-particle"||Qe.isSky()||dt&&dt.length)&&this.renderLayer(this,Le,Qe,dt)}this.depthRangeFor3D=[0,1-(G.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ue=(()=>{if(c.showOverdrawInspector)return s.ao.black;const Qe=this.style.fog;if(Qe&&this.transform.projection.supportsFog){const Le=this.style.getLut(Qe.scope);if(!Me){const dt=Qe.properties.get("color-use-theme")==="none",nt=Qe.properties.get("color").toNonPremultipliedRenderColor(dt?null:Le).toArray01();return new s.ao(...nt)}if(Me){const dt=Qe.properties.get("space-color-use-theme")==="none",nt=Qe.properties.get("space-color").toNonPremultipliedRenderColor(dt?null:Le).toArray01();return new s.ao(...nt)}}return s.ao.transparent})();if(this.context.clear({color:Ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Qe=G[this.currentLayer],Le=t.getLayerSourceCache(Qe);if(Qe.isSky())continue;const dt=Le?(Qe.is3D(S)?de:le)[Le.id]:void 0;this._renderTileClippingMasks(Qe,Le,dt),this.renderLayer(this,Le,Qe,dt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Qe=G[this.currentLayer],Le=t.getLayerSourceCache(Qe);Qe.isSky()&&this.renderLayer(this,Le,Qe,Le?le[Le.id]:void 0)}function Ge(Qe,Le){let dt;return Le&&(dt=(Qe.type==="symbol"?ge:Qe.is3D(S)?de:le)[Le.id]),dt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Qe=G[this.currentLayer];if(Qe.type==="raster"||Qe.type==="raster-particle"){const Le=t.getLayerSourceCache(Qe);this.renderLayer(this,Le,Qe,Ge(Qe,Le))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const it=ke?ke.getGroundShadowLayerIndex():-1;let tt=!1,mt=-1;for(let Qe=0;Qe<I.length;++Qe){const Le=G[Qe];Le.isHidden(this.transform.zoom)||Le.is3D(S)&&(mt=Qe)}D&&mt===-1&&(k=!0);let Pt=!1;for(;this.currentLayer<I.length;){const Qe=G[this.currentLayer],Le=t.getLayerSourceCache(Qe);if(Qe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Qe)){if(Qe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pt&&Qe.is3D(S)&&!S){const dt=this.currentLayer,nt=yt=>{for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const Dt=G[this.currentLayer];if(Fp[Dt.type]){const Kt=this.style.getLayerSourceCache(Dt);Fp[Dt.type](this,Kt,Dt,Ge(Dt,Kt),yt)}}};nt("initialize"),nt("reset"),this.currentLayer=dt,Pt=!0}if(k&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),D&&mt!==-1&&this.currentLayer===mt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Qe,Le,Le?te[Le.id]:void 0),this.renderLayer(this,Le,Qe,Ge(Qe,Le)),!this.terrain&&ke&&this.currentLayer===it){{this.clearStencil(),this.resetStencilClippingMasks();const dt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const nt=G[this.currentLayer];if(Qg[nt.type]){const yt=this.style.getLayerSourceCache(nt);Qg[nt.type](this,yt,nt,Ge(nt,yt))}}this.currentLayer=dt}if(ke.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const dt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=dt;this.currentLayer++){const nt=G[this.currentLayer];if(!nt.hasLightBeamPass())continue;const yt=t.getLayerSourceCache(nt);this.renderLayer(this,yt,nt,yt?le[yt.id]:void 0)}this.currentLayer=dt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const dt=this.currentLayer;this.depthOcclusion=!0;for(const nt of this.layersWithOcclusionOpacity){this.currentLayer=nt;const yt=G[this.currentLayer],Dt=t.getLayerSourceCache(yt),Kt=Dt?le[Dt.id]:void 0;this.terrain||this._renderTileClippingMasks(yt,Dt,Dt?te[Dt.id]:void 0),this.renderLayer(this,Dt,yt,Kt)}this.depthOcclusion=!1,this.currentLayer=dt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Qe=null;G.forEach(Le=>{const dt=t.getLayerSourceCache(Le);dt&&!Le.isHidden(this.transform.zoom)&&dt.getVisibleCoordinates().length&&(!Qe||Qe.getSource().maxzoom<dt.getSource().maxzoom)&&(Qe=dt)}),Qe&&this.options.showTileBoundaries&&jp(this,Qe,Qe.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&jp(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Qe){const Le=Qe.transform.padding;Bm(Qe,Qe.transform.height-(Le.top||0),3,Ef),Bm(Qe,Le.bottom||0,3,Cf),Rp(Qe,Le.left||0,3,dl),Rp(Qe,Qe.transform.width-(Le.right||0),3,hl);const dt=Qe.transform.centerPoint;(function(nt,yt,Dt,Kt){If(nt,yt-1,Dt-10,2,20,Kt),If(nt,yt-10,Dt-1,20,2,Kt)})(Qe,dt.x,Qe.transform.height-dt.y,Af)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(t.type);if(zp[t.type]&&(p||this.terrain&&t.type==="custom")){const x=this.style.getLayerSourceCache(t);zp[t.type](t,x,this)}this.gpuTimingEnd()}renderLayer(t,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)&&(!t.terrain||p.type!=="custom")||p.type==="clip"||yu[p.type](t,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[t.id];x||(x=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(t.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const c={};for(const p in t){const x=t[p],S=this.context.extTimerQuery,T=S.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(x.query),c[p]=T}return c}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of t)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(t,c,p,x,S){if(!p[0]&&!p[1])return t;const T=S?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),O=Math.cos(T);p=[p[0]*O-p[1]*D,p[0]*D+p[1]*O]}const I=[S?p[0]:s.ay(c,p[0],this.transform.zoom),S?p[1]:s.ay(c,p[1],this.transform.zoom),0],k=new Float32Array(16);return s.br(k,t,I),k}saveTileTexture(t){if(t.context!==this.context)return;const c=t.size[0],p=this._tileTextures[c];p?p.push(t):this._tileTextures[c]=[t]}getTileTexture(t){const c=this._tileTextures[t];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,S=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||S.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||S.push("FOG"),x&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(t,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,S=this.currentGlobalDefines(t,c&&c.overrideFog,c&&c.overrideRtt).concat(p),T=cc.cacheKey(cf[t],t,S,x);return this.cache[T]||(this.cache[T]=new cc(this.context,t,cf[t],x,cl[t],S)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const S=((T,I,k)=>{const D=T.properties.get("direction"),O=T.properties.get("color-use-theme")==="none",q=T.properties.get("color").toNonPremultipliedRenderColor(O?null:k.getLut(T.scope)).toArray01(),U=T.properties.get("intensity"),G=I.properties.get("color-use-theme")==="none",J=I.properties.get("color").toNonPremultipliedRenderColor(G?null:k.getLut(I.scope)).toArray01(),Y=I.properties.get("intensity"),te=[D.x,D.y,D.z],le=s.dN(J,Y),ge=s.dN(q,U);return{u_lighting_ambient_color:le,u_lighting_directional_dir:te,u_lighting_directional_color:ge,u_ground_radiance:Ho(te,ge,le)}})(p,x,this.style);c.setLightsUniformValues(t,S)}}}uploadCommonUniforms(t,c,p,x,S){if(this.uploadCommonLightUniforms(t,c),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const I=T.getOpacity(this.transform.pitch),k=((D,O,q,U,G,J,Y,te,le,ge,pe,de)=>{const Ne=D.transform,Ce=O.properties.get("color-use-theme")==="none",ke=O.properties.get("color").toNonPremultipliedRenderColor(Ce?null:D.style.getLut(O.scope)).toArray01();ke[3]=U;const Te=D.frameCounter/1e3%1,[_e,Me]=O.properties.get("vertical-range");return{u_fog_matrix:q?Ne.calculateFogTileMatrix(q):de||D.identityMat,u_fog_range:O.getFovAdjustedRange(Ne._fov),u_fog_color:ke,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,Me),Me],u_fog_temporal_offset:Te,u_frustum_tl:G,u_frustum_tr:J,u_frustum_br:Y,u_frustum_bl:te,u_globe_pos:le,u_globe_radius:ge,u_viewport:pe,u_globe_transition:s.aj(Ne.zoom),u_is_globe:+(Ne.projection.name==="globe")}})(this,T,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],x);c.setFogUniformValues(t,k)}S&&c.setCutoffUniformValues(t,S.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,c=t.createTexture();return t.bindTexture(t.TEXTURE_2D,c),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=t[x.key]||new Ei(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,c){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[t.key];return c||(this._cachedTileFogOpacities[t.key]=c=this.style.fog.getOpacityForTile(t)),c[0]>=ct||c[1]>=ct}setupDepthForOcclusion(t,c,p){const x=this.context,S=x.gl,T=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(S.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),x.activeTexture.set(S.TEXTURE0),T||c.setTerrainUniformValues(x,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function da(f,t){let c=!1,p=null;const x=()=>{p=null,c&&(f(),p=setTimeout(x,t),c=!1)};return()=>(c=!0,p||x(),p)}class Xo{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=da(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const c=Wm(t);if(this._hashName){const p=this._hashName;let x=!1;const S=location.hash.slice(1).split("&").map(T=>{const I=T.split("=")[0];return I===p?(x=!0,`${I}=${c}`):T}).filter(T=>T);return x||S.push(`${p}=${c}`),`#${S.join("&")}`}return`#${c}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let c;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(c[3]||0):t.getBearing();return t.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wm(f,t){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),T=Math.round(c.lng*S)/S,I=Math.round(c.lat*S)/S,k=f.getBearing(),D=f.getPitch();let O=t?`/${T}/${I}/${p}`:`${p}/${I}/${T}`;return(k||D)&&(O+="/"+Math.round(10*k)/10),D&&(O+=`/${Math.round(D)}`),O}const Lc={linearity:.3,easing:s.eT(0,0,.3,1)},Jg=Object.assign({deceleration:2500,maxSpeed:1400},Lc),zi=Object.assign({deceleration:20,maxSpeed:1400},Lc),Tn=Object.assign({deceleration:1e3,maxSpeed:360},Lc),Hm=Object.assign({deceleration:1e3,maxSpeed:90},Lc);class pc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,c=s.o.now();for(;t.length>0&&c-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const S=gc(c.pan.mag(),p,Object.assign({},Jg,t||{}));x.offset=c.pan.mult(S.amount/c.pan.mag()),x.center=this._map.transform.center,mc(x,S)}if(c.zoom){const S=gc(c.zoom,p,zi);x.zoom=this._map.transform.zoom+S.amount,mc(x,S)}if(c.bearing){const S=gc(c.bearing,p,Tn);x.bearing=this._map.transform.bearing+s.aA(S.amount,-179,179),mc(x,S)}if(c.pitch){const S=gc(c.pitch,p,Hm);x.pitch=this._map.transform.pitch+S.amount,mc(x,S)}if(x.zoom||x.bearing){const S=c.pinchAround===void 0?c.around:c.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function mc(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function gc(f,t,c){const{maxSpeed:p,linearity:x,deceleration:S}=c,T=s.aA(f*x/(t/1e3),-p,p),I=Math.abs(T)/(S*x);return{easing:c.easing,duration:1e3*I,amount:T*(I/2)}}class Us extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,p,x={}){const S=Ct(c.getCanvasContainer(),p),T=c.unproject(S);super(t,Object.assign({point:S,lngLat:T,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class _u extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,p){const x=t==="touchend"?p.changedTouches:p.touches,S=Ht(c.getCanvasContainer(),x),T=S.map(k=>c.unproject(k)),I=S.reduce((k,D,O,q)=>k.add(D.div(q.length)),new s.P(0,0));super(t,{points:S,point:I,lngLats:T,lngLat:c.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class Bp extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Mf{constructor(t,c){this._map=t,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Bp(this._map,t))}mousedown(t,c){return this._mousedownPos=c,this._firePreventable(new Us(t.type,this._map,t))}mouseup(t){this._map.fire(new Us(t.type,this._map,t))}preclick(t){const c=new MouseEvent("preclick",t);this._map.fire(new Us(c.type,this._map,c))}click(t,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Us(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Us(t.type,this._map,t))}mouseover(t){this._map.fire(new Us(t.type,this._map,t))}mouseout(t){this._map.fire(new Us(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _u(t.type,this._map,t))}touchmove(t){this._map.fire(new _u(t.type,this._map,t))}touchend(t){this._map.fire(new _u(t.type,this._map,t))}touchcancel(t){this._map.fire(new _u(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Us(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Us("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Us(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ml{constructor(t,c){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,c){this.isEnabled()&&t.shiftKey&&t.button===0&&(Re(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(t,c){if(!this._active)return;const p=c,x=this._startPos,S=this._lastPos;if(!x||!S||S.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(x.x,p.x),I=Math.max(x.x,p.x),k=Math.min(x.y,p.y),D=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${k}px)`,this._box.style.width=I-T+"px",this._box.style.height=D-k+"px")})}mouseupWindow(t,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&t.button===0){if(this.reset(),We(),p.x!==x.x||p.y!==x.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Be(),delete this._startPos,delete this._lastPos}_fireEvent(t,c){return this._map.fire(new s.z(t,{originalEvent:c}))}}function zl(f,t){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=t[p];return c}class xu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const S=new s.P(0,0);for(const T of x)S._add(T);return S.div(x.length)})(c),this.touches=zl(p,c)))}touchmove(t,c,p){if(this.aborted||!this.centroid)return;const x=zl(p,c);for(const S in this.touches){const T=x[S];(!T||T.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(t,c,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class cd{constructor(t){this.singleTap=new xu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,c,p){this.singleTap.touchstart(t,c,p)}touchmove(t,c,p){this.singleTap.touchmove(t,c,p)}touchend(t,c,p){const x=this.singleTap.touchend(t,c,p);if(x){const S=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(S&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class yh{constructor(){this._zoomIn=new cd({numTouches:1,numTaps:2}),this._zoomOut=new cd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,c,p){this._zoomIn.touchstart(t,c,p),this._zoomOut.touchstart(t,c,p)}touchmove(t,c,p){this._zoomIn.touchmove(t,c,p),this._zoomOut.touchmove(t,c,p)}touchend(t,c,p){const x=this._zoomIn.touchend(t,c,p),S=this._zoomOut.touchend(t,c,p);return x?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:t})}):S?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Fl=0,vu=2,Vp={[Fl]:1,[vu]:2},Aa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class _h{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,c){return!1}_move(t,c){return{}}mousedown(t,c){if(this._lastPoint)return;const p=Zt(t);this._correctButton(t,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(t,c){const p=this._lastPoint;if(p){if(t.preventDefault(),this._eventButton!=null&&(function(x,S){const T=Vp[S];return x.buttons===void 0||(x.buttons&T)!==T})(t,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(t){this._lastPoint&&Zt(t)===this._eventButton&&(this._moved&&We(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lf extends _h{mousedown(t,c){super.mousedown(t,c),this._lastPoint&&(this._active=!0)}_correctButton(t,c){return c===0&&!t.ctrlKey}_move(t,c){return{around:c,panDelta:c.sub(t)}}}class bu extends _h{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Aa[t.pitchRotateKey]:void 0}_correctButton(t,c){return this._pitchRotateKey?c===0&&t[this._pitchRotateKey]:c===0&&t.ctrlKey||c===2}_move(t,c){const p=.8*(c.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class yo extends _h{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Aa[t.pitchRotateKey]:void 0}_correctButton(t,c){return this._pitchRotateKey?c===0&&t[this._pitchRotateKey]:c===0&&t.ctrlKey||c===2}_move(t,c){const p=-.5*(c.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Os{constructor(t,c){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,c,p){return this._calculateTransform(t,c,p)}touchmove(t,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,c,p)}}touchend(t,c,p){this._calculateTransform(t,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,c,p){p.length>0&&(this._active=!0);const x=zl(p,c),S=new s.P(0,0),T=new s.P(0,0);let I=0;for(const D in x){const O=x[D],q=this._touches[D];q&&(S._add(O),T._add(O.sub(q)),I++,x[D]=O)}if(this._touches=x,I<this._minTouches||!T.mag())return;const k=T.div(I);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(I),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Df{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,c,p){return{}}touchstart(t,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(t,c,p){const x=this._firstTwoTouches;if(!x)return;t.preventDefault();const[S,T]=x,I=Dc(p,c,S),k=Dc(p,c,T);if(!I||!k)return;const D=this._aroundCenter?null:I.add(k).div(2);return this._move([I,k],D,t)}touchend(t,c,p){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,T=Dc(p,c,x),I=Dc(p,c,S);T&&I||(this._active&&We(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dc(f,t,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return t[p]}function _o(f,t){return Math.log2(f/t)}class ud extends Df{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,c){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(_o(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_o(this._distance,p),pinchAround:c}}}function hn(f,t){return 180*f.angleWith(t)/Math.PI}class wu extends Df{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,c){const p=this._vector;if(this._vector=t[0].sub(t[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hn(this._vector,p),pinchAround:c}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=hn(t,p);return Math.abs(x)<c}}function dd(f){return Math.abs(f.y)>Math.abs(f.x)}class Su extends Df{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,dd(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,c,p){const x=this._lastPoints;if(!x)return;const S=t[0].sub(x[0]),T=t[1].sub(x[1]);return this._map._cooperativeGestures&&!s.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(S,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5})}gestureBeginsVertically(t,c,p){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,S=c.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=t.y>0==c.y>0;return dd(t)&&dd(c)&&T}}const Zm={panStep:100,bearingStep:15,pitchStep:10};class Oc{constructor(){const t=Zm;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let c=0,p=0,x=0,S=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:I=>{const k=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:xh,zoom:c?Math.round(k)+c*(t.shiftKey?2:1):k,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xh(f){return f*(2-f)}const hd=4.000244140625,Up=1/450;class Of{constructor(t,c){this._map=t,this._el=t.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Up,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=s.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%hd===0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),t.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=t,this._delta-=c,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ct(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>hd?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&O!==0&&(O=1/O);const q=c(),U=Math.pow(2,q),G=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(G*O))),this._type==="wheel"&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,S=this._easing;let T,I=!1;if(this._type==="wheel"&&x&&S){const D=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),O=S(D);T=s.ak(x,p,O),D<1?this._frameId||(this._frameId=!0):I=!0}else T=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=T-c();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let c=s.eV;if(this._prevEase){const p=this._prevEase,x=(s.o.now()-p.start)/p.duration,S=p.easing(x+.01)-p.easing(x),T=.27/Math.sqrt(S*S+1e-4)*.01,I=Math.sqrt(.0729-T*T);c=s.eT(T,I,.25,1)}return this._prevEase={start:s.o.now(),duration:t,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Xm{constructor(t,c){this._clickZoom=t,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $p{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,c){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qp{constructor(){this._tap=new cd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,c,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,c,p))}touchmove(t,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(t,c,p)}touchend(t,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,c,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lo{constructor(t,c,p){this._el=t,this._mousePan=c,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gl{constructor(t,c,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zc{constructor(t,c,p,x){this._el=t,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vh=f=>f.zoom||f.drag||f.pitch||f.rotate;class Km extends s.z{}class yl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,c){const p=s.av([],c,t);this.radius=s.ag(p[2]<0?s.eX([],p,this.constants):[p[0],p[1],0])}projectRay(t){s.eX(t,t,this.constants),s.aw(t,t),s.eY(t,t,this.constants);const c=s.c5([],t,this.radius);if(c[2]>0){const p=s.c5([],[0,0,1],s.bJ(c,[0,0,1])),x=s.c5([],s.aw([],[c[0],c[1],0]),this.radius),S=s.d8([],c,s.c5([],s.av([],s.d8([],x,p),c),2));c[0]=S[0],c[1]=S[1]}return c}}function bh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Bl{constructor(t,c){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pc(t),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,T]of this._listeners){const I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(S,I,T)}}destroy(){for(const[t,c,p]of this._listeners){const x=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(c,x,p)}}_addDefaultHandlers(t){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Mf(c,t));const x=c.boxZoom=new ml(c,t);this._add("boxZoom",x);const S=new yh,T=new $p;c.doubleClickZoom=new Xm(T,S),this._add("tapZoom",S),this._add("clickZoom",T);const I=new qp;this._add("tapDragZoom",I);const k=c.touchPitch=new Su(c);this._add("touchPitch",k);const D=new bu(t),O=new yo(t);c.dragRotate=new gl(t,D,O),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const q=new Lf(t),U=new Os(c,t);c.dragPan=new Lo(p,q,U),this._add("mousePan",q),this._add("touchPan",U,["touchZoom","touchRotate"]);const G=new wu,J=new ud;c.touchZoomRotate=new zc(p,J,G,I),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new gh(c));const Y=c.scrollZoom=new Of(c,this);this._add("scrollZoom",Y,["mousePan"]);const te=c.keyboard=new Oc;this._add("keyboard",te);for(const le of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[le]&&c[le].enable(t[le])}_add(t,c,p){this._handlers.push({handlerName:t,handler:c,allowed:p}),this._handlersById[t]=c}stop(t){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,c,p){for(const x in t)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const c=[];for(const p of t)this._el.contains(p.target)&&c.push(p);return c}handleEvent(t,c){this._updatingCamera=!0;const p=t.type==="renderFrame",x=p?void 0:t,S={needsRenderFrame:!1},T={},I={},k=t.touches?this._getMapTouches(t.touches):void 0,D=k?Ht(this._el,k):p?void 0:Ct(this._el,t);for(const{handlerName:U,handler:G,allowed:J}of this._handlers){if(!G.isEnabled())continue;let Y;this._blockedByActive(I,J,U)?G.reset():G[c||t.type]&&(Y=G[c||t.type](t,D,k),this.mergeHandlerResult(S,T,Y,U,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||G.isActive())&&(I[U]=G)}const O={};for(const U in this._previousActiveHandlers)I[U]||(O[U]=x);this._previousActiveHandlers=I,(Object.keys(O).length||bh(S))&&(this._changes.push([S,T,O]),this._triggerRenderFrame()),(Object.keys(I).length||bh(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=S;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(t,c,p,x,S){if(!p)return;Object.assign(t,p);const T={handlerName:x,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(c.zoom=T),p.panDelta!==void 0&&(c.drag=T),p.pitchDelta!==void 0&&(c.pitch=T),p.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const t={},c={},p={};for(const[x,S,T]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(t.around=x.around),x.aroundCoord!==void 0&&(t.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),Object.assign(c,S),Object.assign(p,T);this._updateMapTransform(t,c,p),this._changes=[]}_updateMapTransform(t,c,p){const x=this._map,S=x.transform,T=ge=>[ge.x,ge.y,ge.z];if((()=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!bh(t)){const ge=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ge!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&x._stop(!0),!bh(t))return void this._fireEvents(c,p,!0);let{panDelta:I,zoomDelta:k,bearingDelta:D,pitchDelta:O,around:q,aroundCoord:U,pinchAround:G}=t;S._isCameraConstrained&&(k>0&&(k=0),S._isCameraConstrained=!1),G!==void 0&&(q=G),(k||(ge=>c[ge]&&!this._eventsInProgress[ge])("drag"))&&q&&(this._dragOrigin=T(S.pointCoordinate3D(q)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),q=q||x.transform.centerPoint,D&&(S.bearing+=D),O&&(S.pitch+=O),S._updateCameraState();const J=[0,0,0];if(I)if(S.projection.name==="mercator"){const ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(q).dir),pe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(q.sub(I)).dir);J[0]=pe[0]-ge[0],J[1]=pe[1]-ge[1]}else{const ge=S.pointCoordinate(q);if(S.projection.name==="globe"){I=I.rotate(-S.angle);const pe=S._pixelsPerMercatorPixel/S.worldSize;J[0]=-I.x*s.eW(s.a$(ge.y))*pe,J[1]=-I.y*s.eW(S.center.lat)*pe}else{const pe=S.pointCoordinate(q.sub(I));ge&&pe&&(J[0]=pe.x-ge.x,J[1]=pe.y-ge.y)}}const Y=S.zoom,te=[0,0,0];if(k){const ge=T(U||S.pointCoordinate3D(q)),pe={dir:s.aw([],s.av([],ge,S._camera.position))};if(pe.dir[2]<0){const de=S.zoomDeltaToMovement(ge,k);s.c5(te,pe.dir,de)}}const le=s.d8(J,J,te);S._translateCameraConstrained(le),k&&Math.abs(S.zoom-Y)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(c,p,!0)}_fireEvents(t,c,p){const x=vh(this._eventsInProgress),S=vh(t),T={};for(const O in t){const{originalEvent:q}=t[O];this._eventsInProgress[O]||(T[`${O}start`]=q),this._eventsInProgress[O]=t[O]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const O in T)this._fireEvent(O,T[O]);S&&this._fireEvent("move",S.originalEvent);for(const O in t){const{originalEvent:q}=t[O];this._fireEvent(O,q)}const I={};let k;for(const O in this._eventsInProgress){const{handlerName:q,originalEvent:U}=this._eventsInProgress[O];this._handlersById[q].isActive()||(delete this._eventsInProgress[O],k=c[q]||U,I[`${O}end`]=k)}for(const O in I)this._fireEvent(O,I[O]);const D=vh(this._eventsInProgress);if(p&&(x||S)&&!D){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;O?(q(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:k})):(this._map.fire(new s.z("moveend",{originalEvent:k})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,c){this._map.fire(new s.z(t,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Km("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ym="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Qm extends s.E{constructor(t,c){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,c){return this.jumpTo({center:t},c)}panBy(t,c,p){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},c),p)}panTo(t,c,p){return this.easeTo(Object.assign({center:t},c),p)}getZoom(){return this.transform.zoom}setZoom(t,c){return this.jumpTo({zoom:t},c),this}zoomTo(t,c,p){return this.easeTo(Object.assign({zoom:t},c),p)}zoomIn(t,c){return this.zoomTo(this.getZoom()+1,t,c),this}zoomOut(t,c){return this.zoomTo(this.getZoom()-1,t,c),this}getBearing(){return this.transform.bearing}setBearing(t,c){return this.jumpTo({bearing:t},c),this}getPadding(){return this.transform.padding}setPadding(t,c){return this.jumpTo({padding:t},c),this}rotateTo(t,c,p){return this.easeTo(Object.assign({bearing:t},c),p)}resetNorth(t,c){return this.rotateTo(0,Object.assign({duration:1e3},t),c),this}resetNorthPitch(t,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),c),this}snapToNorth(t,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,c):this}getPitch(){return this.transform.pitch}setPitch(t,c){return this.jumpTo({pitch:t},c),this}cameraForBounds(t,c){t=s.aI.convert(t);const p=c&&c.bearing||0,x=c&&c.pitch||0,S=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,S,T,p,x,c)}_extendPadding(t){const c={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},c,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},c,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>t.aspect?p/(2*Math.tan(.5*t.fovX)*t.aspect):x/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,c,p,x,S,T){const I=t.clone(),k=this._extendCameraOptions(T);I.bearing=x,I.pitch=S;const D=s.aT.convert(c),O=s.aT.convert(p),q=.5*(D.lat+O.lat),U=.5*(D.lng+O.lng),G=s.eZ(q,U),J=s.aw([],G),Y=s.aw([],s.bI([],J,[0,1,0])),te=s.bI([],Y,J),le=[Y[0],Y[1],Y[2],0,te[0],te[1],te[2],0,J[0],J[1],J[2],0,0,0,0,1],ge=[G,s.eZ(D.lat,D.lng),s.eZ(O.lat,D.lng),s.eZ(O.lat,O.lng),s.eZ(D.lat,O.lng),s.eZ(q,D.lng),s.eZ(q,O.lng),s.eZ(D.lat,U),s.eZ(O.lat,U)];let pe=s.d9.fromPoints(ge.map(nt=>[s.bJ(Y,nt),s.bJ(te,nt),s.bJ(J,nt)]));const de=s.af([],pe.center,le);s.e_(de)===0&&s.e$(de,0,0,1),s.aw(de,de),s.c5(de,de,s.aD),I.center=s.f0(de);const Ne=I.getWorldToCameraMatrix(),Ce=s.bl(new Float64Array(16),Ne);pe=s.d9.applyTransform(pe,s.aB([],Ne,le));const ke=this._extendAABB(pe,I,k,x);if(!ke)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=ke,s.af(de,de,Ne);const Te=.5*(pe.max[2]-pe.min[2]),_e=this._minimumAABBFrustumDistance(I,pe),Me=s.c5([],[0,0,1],Te),Ue=s.d8(Me,de,Me),Ge=_e+(I.pitch===0?0:s.bG(de,Ue)),it=I.globeCenterInViewSpace,tt=s.av([],de,[it[0],it[1],it[2]]);s.aw(tt,tt),s.c5(tt,tt,Ge);const mt=s.d8([],de,tt);s.af(mt,mt,Ce);const Pt=s.eM/s.aD,Qe=s.ag(mt),Le=s.cf(Math.max(Qe*Pt-s.eM,Number.EPSILON),0),dt=Math.min(I.zoomFromMercatorZAdjusted(Le),k.maxZoom);return dt>.5*(s.c_+s.cL)?(I.setProjection({name:"mercator"}),I.zoom=dt,this._cameraForBounds(I,c,p,x,S,T)):{center:I.center,zoom:dt,bearing:x,pitch:S}}_extendAABB(t,c,p,x){const S=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=T,k=S,D=S,O=T,q=c.width-(k+D),U=c.height-(I+O),G=s.av([],t.max,t.min),J=Math.min(q/G[0],U/G[1]),Y=Math.min(c.scaleZoom(c.scale*J),p.maxZoom);if(isNaN(Y))return null;const te=c.scale/c.zoomScale(Y),le=new s.d9([t.min[0]-k*te,t.min[1]-O*te,t.min[2]],[t.max[0]+D*te,t.max[1]+I*te,t.max[2]]),ge=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.an(x));return le.center[0]-=ge.x*te,le.center[1]+=ge.y*te,le}queryTerrainElevation(t,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(s.ae.fromLngLat(t),null,c.exaggerated)):null}_cameraForBounds(t,c,p,x,S,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,c,p,x,S,T);const I=t.clone(),k=this._extendCameraOptions(T);I.bearing=x,I.pitch=S;const D=s.aT.convert(c),O=s.aT.convert(p),q=new s.aT(D.lng,O.lat),U=new s.aT(O.lng,D.lat),G=I.project(D),J=I.project(O),Y=this.queryTerrainElevation(D),te=this.queryTerrainElevation(O),le=this.queryTerrainElevation(q),ge=this.queryTerrainElevation(U),pe=[[G.x,G.y,Math.min(Y||0,te||0,le||0,ge||0)],[J.x,J.y,Math.max(Y||0,te||0,le||0,ge||0)]];let de=s.d9.fromPoints(pe);const Ne=I.getWorldToCameraMatrix(),Ce=s.bl(new Float64Array(16),Ne);de=s.d9.applyTransform(de,Ne);const ke=this._extendAABB(de,I,k,x);if(!ke)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=ke;const Te=.5*s.av([],de.max,de.min)[2],_e=this._minimumAABBFrustumDistance(I,de),Me=[0,0,1,0];s.aC(Me,Me,Ne),s.f1(Me,Me);const Ue=s.c5([],Me,_e+Te),Ge=s.d8([],de.center,Ue);s.af(de.center,de.center,Ce),s.af(Ge,Ge,Ce);const it=I.unproject(new s.P(de.center[0],de.center[1])),tt=s.f2(I.projection,it),mt=Math.pow(2,tt),Pt=Math.min(I._zoomFromMercatorZ(Ge[2]*I.pixelsPerMeter*mt/I.worldSize),k.maxZoom);return I.mercatorFromTransition&&Pt<.5*(s.c_+s.cL)?(I.setProjection({name:"globe"}),I.zoom=Pt,this._cameraForBounds(I,c,p,x,S,T)):{center:it,zoom:Pt,bearing:x,pitch:S}}fitBounds(t,c,p){const x=this.cameraForBounds(t,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(t,c,p,x,S){const T=s.P.convert(t),I=s.P.convert(c),k=new s.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),D=new s.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;const O=this.transform.pointLocation3D(k),q=this.transform.pointLocation3D(D),U=this.transform.pointLocation3D(new s.P(k.x,D.y)),G=this.transform.pointLocation3D(new s.P(D.x,k.y)),J=[Math.min(O.lng,q.lng,U.lng,G.lng),Math.min(O.lat,q.lat,U.lat,G.lat)],Y=[Math.max(O.lng,q.lng,U.lng,G.lng),Math.max(O.lat,q.lat,U.lat,G.lat)],te=x&&x.pitch?x.pitch:this.getPitch(),le=this._cameraForBounds(this.transform,J,Y,p,te,x);return this._fitInternal(le,x,S)}_fitInternal(t,c,p){return t?(c=Object.assign(t,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(t,c){this.stop();const p=t.preloadOnly?this.transform.clone():this.transform;let x=!1,S=!1,T=!1;"zoom"in t&&p.zoom!==+t.zoom&&(x=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=s.aT.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(S=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(T=!0,p.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!p.isPaddingEqual(I))if(t.retainPadding===!1){const k=p.clone();k.padding=I,p.setLocationAtPoint(p.center,k.centerPoint)}else p.padding=I;return t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",c)).fire(new s.z("move",c)),x&&this.fire(new s.z("zoomstart",c)).fire(new s.z("zoom",c)).fire(new s.z("zoomend",c)),S&&this.fire(new s.z("rotatestart",c)).fire(new s.z("rotate",c)).fire(new s.z("rotateend",c)),T&&this.fire(new s.z("pitchstart",c)).fire(new s.z("pitch",c)).fire(new s.z("pitchend",c)),this.fire(new s.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Ym),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(Ym),this;this.stop();const x=p.zoom,S=p.pitch,T=p.bearing;p.setFreeCameraOptions(t);const I=x!==p.zoom,k=S!==p.pitch,D=T!==p.bearing;return this.fire(new s.z("movestart",c)).fire(new s.z("move",c)),I&&this.fire(new s.z("zoomstart",c)).fire(new s.z("zoom",c)).fire(new s.z("zoomend",c)),D&&this.fire(new s.z("rotatestart",c)).fire(new s.z("rotate",c)).fire(new s.z("rotateend",c)),k&&this.fire(new s.z("pitchstart",c)).fire(new s.z("pitch",c)).fire(new s.z("pitchend",c)),this.fire(new s.z("moveend",c)),this}easeTo(t,c){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:s.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const p=this.transform,x=this.getZoom(),S=this.getBearing(),T=this.getPitch(),I=this.getPadding(),k="zoom"in t?+t.zoom:x,D="bearing"in t?this._normalizeBearing(t.bearing,S):S,O="pitch"in t?+t.pitch:T,q=this._extendPadding(t.padding),U=s.P.convert(t.offset);let G,J,Y;if(p.projection.name==="globe"){const Me=s.ae.fromLngLat(p.center),Ue=U.rotate(-p.angle);Me.x+=Ue.x/p.worldSize,Me.y+=Ue.y/p.worldSize;const Ge=Me.toLngLat(),it=s.aT.convert(t.center||Ge);this._normalizeCenter(it),G=p.centerPoint.add(Ue),J=new s.P(Me.x,Me.y).mult(p.worldSize),Y=new s.P(s.aF(it.lng),s.aJ(it.lat)).mult(p.worldSize).sub(J)}else{G=p.centerPoint.add(U);const Me=p.pointLocation(G),Ue=s.aT.convert(t.center||Me);this._normalizeCenter(Ue),J=p.project(Me),Y=p.project(Ue).sub(J)}const te=p.zoomScale(k-x);let le,ge;t.around&&(le=s.aT.convert(t.around),ge=p.locationPoint(le));const pe=this._zooming||k!==x,de=this._rotating||S!==D,Ne=this._pitching||O!==T,Ce=!p.isPaddingEqual(q),ke=t.retainPadding===!1?p.clone():p,Te=Me=>Ue=>{if(pe&&(Me.zoom=s.ak(x,k,Ue)),de&&(Me.bearing=s.ak(S,D,Ue)),Ne&&(Me.pitch=s.ak(T,O,Ue)),Ce&&(ke.interpolatePadding(I,q,Ue),G=ke.centerPoint.add(U)),le)Me.setLocationAtPoint(le,ge);else{const Ge=Me.zoomScale(Me.zoom-x),it=k>x?Math.min(2,te):Math.max(.5,te),tt=Math.pow(it,1-Ue),mt=Me.unproject(J.add(Y.mult(Ue*tt)).mult(Ge));Me.setLocationAtPoint(Me.renderWorldCopies?mt.wrap():mt,G)}return t.preloadOnly||this._fireMoveEvents(c),Me};if(t.preloadOnly){const Me=this._emulate(Te,t.duration,p);return this._preloadTiles(Me),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=de,this._pitching=Ne,this._padding=Ce,this._easeId=t.easeId,this._prepareEase(c,t.noMoveStart,_e),this._ease(Te(p),Me=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Me)},t),this}_prepareEase(t,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new s.z("movestart",t)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",t)),x&&this.fire(new s.z("rotateend",t)),S&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,c){if(this._prefersReducedMotion(t)){const nt=s.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(nt,c)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},t);const p=this.transform,x=this.getZoom(),S=this.getBearing(),T=this.getPitch(),I=this.getPadding(),k="zoom"in t?s.aA(+t.zoom,p.minZoom,p.maxZoom):x,D="bearing"in t?this._normalizeBearing(t.bearing,S):S,O="pitch"in t?+t.pitch:T,q=this._extendPadding(t.padding),U=p.zoomScale(k-x),G=s.P.convert(t.offset);let J=p.centerPoint.add(G);const Y=p.pointLocation(J),te=s.aT.convert(t.center||Y);this._normalizeCenter(te);const le=p.project(Y),ge=p.project(te).sub(le);let pe=t.curve;const de=Math.max(p.width,p.height),Ne=de/U,Ce=ge.mag();if("minZoom"in t){const nt=s.aA(Math.min(t.minZoom,x,k),p.minZoom,p.maxZoom),yt=de/p.zoomScale(nt-x);pe=Math.sqrt(yt/Ce*2)}const ke=pe*pe;function Te(nt){const yt=(Ne*Ne-de*de+(nt?-1:1)*ke*ke*Ce*Ce)/(2*(nt?Ne:de)*ke*Ce);return Math.log(Math.sqrt(yt*yt+1)-yt)}function _e(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function Me(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const Ue=Te(0);let Ge=function(nt){return Me(Ue)/Me(Ue+pe*nt)},it=function(nt){return de*((Me(Ue)*(_e(yt=Ue+pe*nt)/Me(yt))-_e(Ue))/ke)/Ce;var yt},tt=(Te(1)-Ue)/pe;if(Math.abs(Ce)<1e-6||!isFinite(tt)){if(Math.abs(de-Ne)<1e-6)return this.easeTo(t,c);const nt=Ne<de?-1:1;tt=Math.abs(Math.log(Ne/de))/pe,it=function(){return 0},Ge=function(yt){return Math.exp(nt*pe*yt)}}t.duration="duration"in t?+t.duration:1e3*tt/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const mt=S!==D,Pt=O!==T,Qe=!p.isPaddingEqual(q),Le=t.retainPadding===!1?p.clone():p,dt=nt=>yt=>{const Dt=yt*tt,Kt=1/Ge(Dt);nt.zoom=yt===1?k:x+nt.scaleZoom(Kt),mt&&(nt.bearing=s.ak(S,D,yt)),Pt&&(nt.pitch=s.ak(T,O,yt)),Qe&&(Le.interpolatePadding(I,q,yt),J=Le.centerPoint.add(G));const Ot=yt===1?te:nt.unproject(le.add(ge.mult(it(Dt))).mult(Kt));return nt.setLocationAtPoint(nt.renderWorldCopies?Ot.wrap():Ot,J),nt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(c),nt};if(t.preloadOnly){const nt=this._emulate(dt,t.duration,p);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=mt,this._pitching=Pt,this._padding=Qe,this._prepareEase(c,!1),this._ease(dt(p),()=>this._afterEase(c),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,c,p){p.animate===!1||p.duration===0?(t(1),c()):(this._easeStart=s.o.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,c){t=s.bT(t,-180,180);const p=Math.abs(t-c);return Math.abs(t-360-c)<p&&(t-=360),Math.abs(t+360-c)<p&&(t+=360),t}_normalizeCenter(t){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=t.lng-c.center.lng;t.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,c,p){const x=Math.ceil(15*c/1e3),S=[],T=t(p.clone());for(let I=0;I<=x;I++){const k=T(I/x);S.push(k.clone())}return S}_preloadTiles(t,c){}}class Jm{constructor(t={}){this.options=t,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const c=this.options&&this.options.compact,p=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=se("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const p=c.reduce((x,S,T)=>(S.value&&(x+=`${S.key}=${S.value}${T<c.length-1?"&":""}`),x),"?");t.href=`${s.e.FEEDBACK_URL}/${p}#${Wm(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const S=c[x];if(S.used){const T=S.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort((x,S)=>x.length-S.length),t=t.filter((x,S)=>{for(let T=S+1;T<t.length;T++)if(t[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const p=t.map(x=>(function(S){const T=new DOMParser().parseFromString(S,"text/html");return Array.from(T.body.querySelectorAll("*")).reverse().forEach(I=>{const k=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(...I.childNodes);const D=I.getAttribute("href");if(!D||!/^(https?:|mailto:)/i.test(D))return void I.replaceWith(T.createTextNode(k));const O=T.createElement("a");O.href=D,O.textContent=k,O.rel="noopener nofollow";const q=I.getAttribute("class");q&&(O.className=q),I.replaceWith(O)}),T.body.innerHTML})(x)).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class eg{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=se("div","mapboxgl-ctrl");const c=se("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const c in t){const p=t[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const c=t[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class tg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const c=++this._id;return this._queue.push({callback:t,id:c,cancelled:!1}),c}remove(t){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===t)return void(x.cancelled=!0)}run(t=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Zi{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const c=s.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,c,p){this._start=this.getValue(c),this._end=t,this._startTime=c,this._endTime=c+p}}const zf={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Gp extends s.z{constructor(t,c,p,x){const{point:S,lngLat:T,originalEvent:I,target:k}=t;super(t.type,{point:S,lngLat:T,originalEvent:I,target:k}),this.preventDefault=()=>{t.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class _l{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,c){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(t,s.b6(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const S=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,c)):S.size===0&&this.map.on(x,this.handleType),S.size===0&&this.interactionsByType.set(x,S),S.set(t,c),this.typeById.set(t,x)}get(t){const c=this.typeById.get(t);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(t):void 0}remove(t){const c=this.typeById.get(t);if(!c)return;this.typeById.delete(t),this.filters.delete(t);const p=this.interactionsByType.get(c);p&&(p.delete(t),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(t,c){const p=[];for(const[x,S]of c)S.target&&p.push({targetId:x,target:S.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(t,p,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());c.length&&(t.type="mouseenter",this.handleType(t,c));const p=new Map;for(const[x,{feature:S}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(S.id,S);p.size&&(t.type="mouseleave",this.handleType(t,Array.from(p.values())))}handleOut(t){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(t.type="mouseleave",this.handleType(t,c)),this.hoveredFeatures.clear()}handleType(t,c){const p=t.type==="mouseenter";if(p&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(t.type)).reverse(),S=!!c;c=c||this.queryTargets(t.point,x);let T=!1;const I=new Set;for(const k of c){for(const[D,O]of x){if(!O.target)continue;const q=k.variants?k.variants[D]:null;if(q){for(const U of q){if($n(U,k,I,D))continue;const G=new s.dx(k,U),J=Vn(U,k,D);S&&G.id!==void 0&&(G.state=this.map.getFeatureState(G));const Y=p?this.prevHoveredFeatures.get(J):null,te=new Gp(t,D,O,G),le=Y?Y.stop:O.handler(te);if(p&&this.hoveredFeatures.set(J,{feature:k,stop:le}),le!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[k,D]of x){const{handler:O,target:q}=D;if(!q&&O(new Gp(t,k,D,null))!==!1)break}}}function Ji(f,t){if(Array.isArray(f)&&Array.isArray(t)){const c=new Set(f),p=new Set(t);return c.size===p.size&&f.every(x=>p.has(x))}return s.by(f,t)}const $s={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Qs={showCompass:!0,showZoom:!0,visualizePitch:!1};class xo{constructor(t,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new bu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new yo({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(t,c){this.mouseRotate.mousedown(t,c),this.mousePitch&&this.mousePitch.mousedown(t,c),Re()}move(t,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(t,c),S=x&&x.bearingDelta;if(S&&p.setBearing(p.getBearing()+S),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,c),I=T&&T.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Be(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ct(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ct(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ht(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ht(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ko(f,t,c){if(f=new s.aT(f.lng,f.lat),t){const p=new s.aT(f.lng-360,f.lat),x=new s.aT(f.lng+360,f.lat),S=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),T=c.locationPoint3D(f).distSqr(t),I=t.x<0||t.y<0||t.x>c.width||t.y>c.height;c.locationPoint3D(p).distSqr(t)<T&&(I||Math.abs(p.lng-c.center.lng)<S)?f=p:c.locationPoint3D(x).distSqr(t)<T&&(I||Math.abs(x.lng-c.center.lng)<S)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const ha={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},os={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class hs extends s.E{constructor(t,c){super(),(t instanceof HTMLElement||c)&&(t=Object.assign({element:t},c)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:S=1,draggable:T=!1,clickTolerance:I=0,rotation:k=os.rotation,rotationAlignment:D=os.rotationAlignment,pitchAlignment:O=os.pitchAlignment,occludedOpacity:q=os.occludedOpacity,altitude:U=os.altitude}=t||{};this._anchor=p,this._color=x,this._scale=S,this._draggable=T,this._clickTolerance=I,this._rotation=k,this._rotationAlignment=D,this._pitchAlignment=O,this._occludedOpacity=q,this._altitude=U,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const G=this._element.classList;for(const Y in ha)G.remove(`mapboxgl-marker-anchor-${Y}`);G.add(`mapboxgl-marker-anchor-${this._anchor}`);const J=t&&t.className?t.className.trim().split(/\s+/):[];G.add(...J),this._popup=null}_createDefaultMarker(){const t=se("div"),c=oe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const p=oe("radialGradient",{id:"shadowGradient"},oe("defs",{},c));oe("stop",{offset:"10%","stop-opacity":.4},p),oe("stop",{offset:"100%","stop-opacity":.05},p),oe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return oe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),oe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),oe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||os.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const c=t.code,p=t.charCode||t.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const c=t.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,c=this._pos;if(!t||!c)return!1;const p=t.unproject(c,this._altitude),x=t.getFreeCameraOptions();if(!x.position)return!1;const S=x.position.toLngLat();return S.distanceTo(p)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const c=this._pos;if(!c||c.x<0||c.x>t.transform.width||c.y<0||c.y>t.transform.height)return void this._clearFadeTimer();const p=t.unproject(c,this._altitude);let x;t._showingGlobe()&&s.f5(t.transform,this._lngLat)?x=0:(x=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ha[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const t=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!t||p!=="map")return"";if(!c._showingGlobe()){const k=c.getPitch();return k?`rotateX(${k}deg)`:""}const x=s.cX(s.f6(c.transform,this._lngLat)),S=t.sub(s.f7(c.transform)),T=Math.abs(S.x)+Math.abs(S.y);if(T===0)return"";const I=x/T;return`rotateX(${-S.y*I}deg) rotateY(${S.x*I}deg)`}_calculateZTransform(){const t=this._pos,c=this._map;if(!c||!t)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const S=c.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=c.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(S);p=s.cX(Math.atan2(T.y,T.x))-90}else p=-c.getBearing();else if(x==="horizon"){const S=s.ah(4,6,c.getZoom()),T=s.f7(c.transform);T.y+=S*c.transform.height;const I=t.sub(T),k=s.cX(Math.atan2(I.y,I.x));p=(k>90?k-270:k+90)*(1-S)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Ko(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const S=this._clickTolerance||c._clickTolerance;if(t.point.dist(p)<S)return;this._isDragging=!0}this._pos=t.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const c=this._map,p=this._pos;c&&p&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(p),this._pointerdownPos=t.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const c=this._map;return c&&(t?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||os.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||os.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||os.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||os.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const vo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Tu={maxWidth:100,unit:"metric"},wh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Sh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Eu(f=new s.P(0,0),t="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new s.P(0,f);case"top-left":return new s.P(c,c);case"top-right":return new s.P(-c,c);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(c,-c);case"bottom-right":return new s.P(-c,-c);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[t]||[0,0])}return{version:M,supported:he.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends Qm{constructor(f){F.mark(L.create);const t=f;if((f=Object.assign({},$s,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.f3(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qh(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new tg,this._domRenderTaskQueue=new tg,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},zf,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zi(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Gt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Bl(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Xo(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Jm({customAttribution:f.customAttribution})),this._logoControl=new eg,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new s.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new s.z(`${c.dataType}dataloading`,c))}),this._interactions=new _l(this)}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),t&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(t=>t==="auto"?navigator.language:t):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,t=f.projection.name;let c;t==="globe"&&f.zoom>=s.cL?(f.setMercatorFromTransition(),c=!0):t==="mercator"&&f.zoom<s.cL&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;const c=this.transform.mercatorFromTransition;t=f.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(t||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,t){return this.transform.locationPoint3D(s.aT.convert(f),t)}unproject(f,t){return this.transform.pointLocation3D(s.P.convert(f),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,t,c){const p=x=>{let S=[];if(Array.isArray(t)){const T=t.filter(I=>this.getLayer(I));S=T.length?this.queryRenderedFeatures(x,{layers:T}):[]}else S=this.queryRenderedFeatures(x,{target:t});return S};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:c,targets:t,delegates:{mousemove:T=>{const I=p(T.point);I.length?x||(x=!0,c.call(this,new Us(f,this,T.originalEvent,{features:I}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:c,targets:t,delegates:{mousemove:I=>{p(I.point).length?x=!0:x&&(x=!1,c.call(this,new Us(f,this,I.originalEvent)))},mouseout:I=>{x&&(x=!1,c.call(this,new Us(f,this,I.originalEvent)))}}}}{const x=S=>{const T=p(S.point);T.length&&(S.features=T,c.call(this,S),delete S.features)};return{listener:c,targets:t,delegates:{[f]:x}}}}on(f,t,c){if(typeof t=="function"||c===void 0)return super.on(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(f,t,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,t,c){if(typeof t=="function"||c===void 0)return super.once(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(f,t,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,t,c){if(typeof t=="function"||c===void 0)return super.off(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(x=>{for(let S=0;S<x.length;S++){const T=x[S];if(T.listener===c&&Ji(T.targets,t)){for(const I in T.delegates)this.off(I,T.delegates[I]);return x.splice(S,1),this}}})(p),this}queryRenderedFeatures(f,t){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||t!==void 0||(t=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!t){const S=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return S.concat(T)}let c=!0;if(t.target&&(c=this._isTargetValid(t.target),c&&!t.layers))return this.style.queryRenderedFeatureset(f,t,this.transform);let p=!0;if(t.layers&&Array.isArray(t.layers)){for(const S of t.layers)if(!this._isValidId(S)){p=!1;break}if(p&&!t.target)return this.style.queryRenderedFeatures(f,t,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(f,t,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(f,t,this.transform))),x}querySourceFeatures(f,t){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,t)}queryRasterValue(f,t,c){return this._isValidId(f)?this.style.queryRasterValue(f,t,c):Promise.resolve(null)}isPointOnSurface(f){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,t){return this._interactions.add(f,t),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&f&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(f,(c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;s.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(f,t)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=Object.assign({},t);t&&t.config&&(c.initialConfig=t.config,delete c.config),this.style=new aa(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new aa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const t of f)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(f)}addSource(f,t){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,t,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,t,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:S,content:T}={}){this._lazyInitEmptyStyle();const I=s.I.from(f);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:k,height:D,data:O}=s.o.getImageData(t);this.style.addImage(I,{data:new s.q({width:k,height:D},O),pixelRatio:c,stretchX:x,stretchY:S,content:T,sdf:p,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:D}=t,O=t;this.style.addImage(I,{data:new s.q({width:k,height:D},new Uint8Array(O.data)),pixelRatio:c,stretchX:x,stretchY:S,content:T,sdf:p,usvg:!1,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f)}}updateImage(f,t){this._lazyInitEmptyStyle();const c=s.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.o.getImageData(t):t,{width:S,height:T,data:I}=x;if(S===void 0||T===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||T!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const k=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let D=!1;p.usvg?(p.data=new s.q({width:S,height:T},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,D=!0):p.data.replace(I,k),this.style.updateImage(c,p,D)}hasImage(f){return f?!!this.style&&!!this.style.getImage(s.I.from(f)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(s.I.from(f))}loadImage(f,t){s.n(this._requestManager.transformRequest(f,s.R.Image),(c,p)=>{t(c,p instanceof HTMLImageElement?s.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,t){this._lazyInitEmptyStyle(),this.style.addModel(f,t)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,t){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)):this}getSlot(f){const t=this.getLayer(f);return t&&t.slot||null}setSlot(f,t){return this.style.setSlot(f,t),this.style.mergeLayers(),this._update(!0)}addImport(f,t){return this.style.addImport(f,t).catch(c=>this.fire(new s.y(new Error("Failed to add import",c)))),this}updateImport(f,t){return typeof t!="string"&&t.id!==f?(this.removeImport(f),this.addImport(t)):(this.style.updateImport(f,t),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,t){return this.style.moveImport(f,t),this._update(!0)}moveLayer(f,t){return this._isValidId(f)?(this.style.moveLayer(f,t),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const t=this.style.getOwnLayer(f);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,t,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,t,c),this._update(!0)):this}setFilter(f,t,c={}){return this._isValidId(f)?(this.style.setFilter(f,t,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,t,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,t,c,p),this._update(!0)):this}getPaintProperty(f,t){return this._isValidId(f)?this.style.getPaintProperty(f,t):null}setLayoutProperty(f,t,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,t,c,p),this._update(!0)):this}getLayoutProperty(f,t){return this._isValidId(f)?this.style.getLayoutProperty(f,t):null}setLayerProperty(f,t,c,p={}){return this._isValidId(f)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,t,c,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,t){return this.style.setSchema(f,t),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,t){return this.style.setConfig(f,t),this._update(!0)}getConfigProperty(f,t){return this.style.getConfigProperty(f,t)}setConfigProperty(f,t,c){return this.style.setConfigProperty(f,t,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const t=f[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,t),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(f),this.transform):0}setFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,t),this._update())}removeFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,t),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.style.indoorManager.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.style.indoorManager.setActiveFloorsVisibility(f)}getIndoorTileOptions(f,t){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(f,t):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let c,p,x,S=this._container;for(;S&&(!p||!x);){const T=window.getComputedStyle(S).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),S=S.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(t/x):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=se("div","mapboxgl-canvas-container",f);this._canvas=se("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=se("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{p[x]=se("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const c=s.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);t!==-1&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const f=Object.assign({},he.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",f);t?(Sr(t,!0),this.painter=new Ca(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{if(c.dataType==="source"){const p=this.transform.elevation?this.transform.elevation._source():null;p&&c.sourceCacheId===p.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;this.fire(new s.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=s.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,D=this.transform.pitch,O=s.o.now(),q=new s.ac(k,{now:O,fadeDuration:S,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark(L.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const k=s.o.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const D=x.getQueryParameter(t,x.QUERY_RESULT)/1e6;x.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:k,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(k);this.fire(new s.z("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(k);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:D}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(I||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,F.mark(L.fullLoad),this._performanceMetricsCollection&&Sn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=f;const T=Math.abs(x-S);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(S),c(S);this._averageElevation.easeTo(S,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(S),c(S)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){At(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Rt||f.status===401)){const t=this.painter.context.gl;Sr(t,!1),this._logoControl instanceof eg&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),yn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Zr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&ir(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Ur(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(S){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,S,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),t.canvasCopies.map(x),t.timeStamps)}_canvasPixelComparison(f,t,c){let p=c[1]-c[0];const x=f.length/4;for(let S=0;S<t.length;S++){const T=t[S];let I=0;for(let k=0;k<T.length;k+=4)T[k]===f[k]&&T[k+1]===f[k+1]&&T[k+2]===f[k+2]&&T[k+3]===f[k+3]&&(I+=1);p+=(c[S+2]-c[S+1])*(1-I/x)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),pt.delete(this.painter.context.gl),Ci.remove(),Lr.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.o.frame(t=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(t)}))}_preloadTiles(f){const t=this.style?this.style.getSourceCaches():[];return s.bw(t,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,t){s.f4(f,t)}get version(){return M}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},Qs,f),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:t}):c.resetNorth({},{originalEvent:t}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),c=t===f.getMaxZoom(),p=t===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xo(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const c=se("button",f,this._container);return c.type="button",c.addEventListener("click",t),c}_setButtonTitle(f,t){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.E{constructor(f={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},vo,f),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=da(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>t(c.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),c=f.coords;return!!t&&(c.longitude<t.getWest()||c.longitude>t.getEast()||c.latitude<t.getSouth()||c.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const t=new s.aT(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new s.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=s.cf(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:f.code,message:f.message,PERMISSION_DENIED:f.PERMISSION_DENIED,POSITION_UNAVAILABLE:f.POSITION_UNAVAILABLE,TIMEOUT:f.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const f=this.options.positionOptions.timeout;f&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},f))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(f){return this.options.followUserLocation=f??vo.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const f=()=>{const t="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(t,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Jm,ScaleControl:class{constructor(f={}){this.options=Object.assign({},Tu,f),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,c=t._containerHeight/2,p=t._containerWidth/2-f/2,x=t.unproject([p,c]),S=t.unproject([p+f,c]),T=x.distanceTo(S);if(this.options.unit==="imperial"){const I=3.2808*T;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,t,c){this._map._requestDomTask(()=>{const p=(function(S){const T=Math.pow(10,`${Math.floor(S)}`.length-1);let I=S/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(k){const D=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*D)/D})(I),T*I})(t),x=p/t;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${wh[c]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Pm,Popup:class extends s.E{constructor(f){super(),this.options=Object.assign(Object.create(Sh),f),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const c=this._closeButton=se("button","mapboxgl-popup-close-button",t);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,c=this._container,p=this._pos;if(!t||!c||!p)return"bottom";const x=c.offsetWidth,S=c.offsetHeight,T=p.x<x/2,I=p.x>t.transform.width-x/2;if(p.y+f<S)return T?"top-left":I?"top-right":"top";if(p.y>t.transform.height-S){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,c=this._content;if(!t||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=se("div","mapboxgl-popup",t.getContainer()),this._tip=se("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ko(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof s.P?f:t.project(this._lngLat,this._altitude),S=Eu(this.options.offset),T=this._anchor=this._getAnchor(S.y),I=Eu(this.options.offset,T),k=x.add(I).round();t._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ha[T]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&t._showingGlobe()){const x=s.f5(t.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Ua);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:hs,Style:aa,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:Kh,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.fi.workerCount},set workerCount(f){s.fi.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.fh(f)},get workerUrl(){return s.fg.workerUrl},set workerUrl(f){s.fg.workerUrl=f},get workerClass(){return s.fg.workerClass},set workerClass(f){s.fg.workerClass=f},get workerParams(){return s.fg.workerParams},set workerParams(f){s.fg.workerParams=f},get dracoUrl(){return s.ff()},set dracoUrl(f){s.fe(f)},get meshoptUrl(){return s.fd()},set meshoptUrl(f){s.fc(f)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var C=y;return C}))})(_0)),_0.exports}var Dee=Lee();const mg=J0(Dee),Ez="pk.eyJ1IjoieXVkZW5nIiwiYSI6ImNtbDZ6OXVzcTBrdmUzZ3NjZWdiNmlycXEifQ.o9XaBJJQ8VglRRWN8epb2A";function W0(i){return i.map(n=>typeof n=="string"?n.trim():"").filter(Boolean).join(", ")}async function Cz(i,n=Ez){if(!i||!n)return null;const a=new URL(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(i)}.json`);a.searchParams.set("access_token",n),a.searchParams.set("limit","1");const d=await fetch(a.toString());if(!d.ok)return null;const v=(await d.json()).features?.[0]?.center;if(!v)return null;const[C,s]=v;return typeof C!="number"||typeof s!="number"?null:{lng:C,lat:s}}function Az({markers:i,className:n="",zoom:a=2,interactive:d=!0,resizeKey:y,onMarkerClick:v,onMapClick:C,showPopups:s=!0,showNavigation:M=!1,navigationVariant:L="default"}){const F=$.useRef(null),W=$.useRef(null),X=$.useRef([]),ee=Ez,he=i.length>0,se=$.useMemo(()=>he?[i[0].lng,i[0].lat]:[-98.5795,39.8283],[he,i]);$.useEffect(()=>{if(!F.current||W.current)return;mg.accessToken=ee;const ve=new mg.Map({container:F.current,style:"mapbox://styles/mapbox/standard",center:se,zoom:a,interactive:d,attributionControl:!0});return M&&L==="default"&&ve.addControl(new mg.NavigationControl,"bottom-right"),W.current=ve,()=>{X.current.forEach(me=>me.remove()),X.current=[],ve.remove(),W.current=null}},[ee,se,d,a]),$.useEffect(()=>{const ve=W.current;if(!ve||(X.current.forEach(Re=>Re.remove()),X.current=[],!he))return;const me=new mg.LngLatBounds;i.forEach(Re=>{const rt=(Re.items?.length??0)>1?document.createElement("div"):void 0;rt&&(rt.style.width="30px",rt.style.height="30px",rt.style.borderRadius="999px",rt.style.background="#0ea5e9",rt.style.color="white",rt.style.display="flex",rt.style.alignItems="center",rt.style.justifyContent="center",rt.style.fontSize="12px",rt.style.fontWeight="700",rt.style.boxShadow="0 4px 10px rgba(14, 165, 233, 0.35)",rt.textContent=String(Re.items?.length??""));const We=new mg.Marker({color:"#0ea5e9",element:rt}).setLngLat([Re.lng,Re.lat]),Ct=We.getElement();if(Ct.style.cursor="pointer",Ct.addEventListener("click",()=>{v?.(Re)}),!s){We.addTo(ve),X.current.push(We),me.extend([Re.lng,Re.lat]);return}if(Re.items?.length){const Ht=new mg.Popup({offset:18,closeButton:!1,closeOnClick:!0}),Zt=document.createElement("div");Zt.className="max-w-[260px]";const rr=document.createElement("div");rr.className="mb-2 text-xs font-semibold uppercase tracking-[0.3em] text-muted-foreground",rr.textContent=`${Re.items.length} labs at this address`,Zt.appendChild(rr);const $t=document.createElement("div");$t.className="space-y-3 max-h-56 overflow-y-auto pr-1",Re.items.forEach(Rt=>{const Gt=document.createElement("div");if(Gt.className="rounded-lg border border-border bg-background/95 p-2 shadow-sm",Rt.imageUrl){const Ut=document.createElement("img");Ut.src=Rt.imageUrl,Ut.alt=Rt.label?`${Rt.label} photo`:"Lab photo",Ut.className="mb-2 h-20 w-full rounded-md object-cover",Gt.appendChild(Ut)}const Ar=document.createElement("div");if(Ar.className="text-sm font-semibold text-foreground",Ar.textContent=Rt.label,Gt.appendChild(Ar),Rt.subtitle){const Ut=document.createElement("div");Ut.className="mt-1 text-xs text-muted-foreground",Ut.textContent=Rt.subtitle,Gt.appendChild(Ut)}if(Rt.href){const Ut=document.createElement("a");Ut.href=Rt.href,Ut.className="mt-2 inline-flex text-xs font-medium text-primary hover:underline",Ut.textContent="View lab",Gt.appendChild(Ut)}$t.appendChild(Gt)}),Zt.appendChild($t),Ht.setDOMContent(Zt),We.setPopup(Ht)}else if(Re.label||Re.subtitle||Re.href||Re.imageUrl){const Ht=new mg.Popup({offset:18,closeButton:!1,closeOnClick:!0}),Zt=document.createElement("div");if(Zt.className="max-w-[240px]",Re.imageUrl){const rr=document.createElement("img");rr.src=Re.imageUrl,rr.alt=Re.label?`${Re.label} photo`:"Lab photo",rr.className="mb-2 h-24 w-full rounded-lg object-cover",Zt.appendChild(rr)}if(Re.label){const rr=document.createElement("div");rr.className="text-sm font-semibold text-foreground",rr.textContent=Re.label,Zt.appendChild(rr)}if(Re.subtitle){const rr=document.createElement("div");rr.className="mt-1 text-xs text-muted-foreground",rr.textContent=Re.subtitle,Zt.appendChild(rr)}if(Re.href){const rr=document.createElement("a");rr.href=Re.href,rr.className="mt-2 inline-flex text-xs font-medium text-primary hover:underline",rr.textContent="View lab",Zt.appendChild(rr)}Ht.setDOMContent(Zt),We.setPopup(Ht)}We.addTo(ve),X.current.push(We),me.extend([Re.lng,Re.lat])}),i.length===1?ve.easeTo({center:[i[0].lng,i[0].lat],zoom:Math.max(12,a)}):ve.fitBounds(me,{padding:60,maxZoom:12,duration:700});const Se=Re=>{const Be=Re.originalEvent?.target;Be?.closest(".mapboxgl-marker")||Be?.closest(".labs-map-overlay")||C?.()};return ve.on("click",Se),()=>{ve.off("click",Se)}},[he,i,a]),$.useEffect(()=>{const ve=W.current;ve&&ve.resize()},[y]);const oe=M&&L==="glass-pill";return h.jsxs("div",{className:`relative ${n}`,children:[h.jsx("div",{ref:F,className:"h-full w-full"}),oe&&h.jsxs("div",{className:"absolute bottom-6 right-8 inline-flex items-center gap-2 rounded-full border border-white/25 bg-white/60 px-2 py-1 shadow-sm backdrop-blur-xl",children:[h.jsx("button",{type:"button",onClick:()=>W.current?.zoomIn(),className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/40 bg-white/70 text-sm font-semibold text-foreground transition hover:bg-white/90","aria-label":"Zoom in",children:"+"}),h.jsx("div",{className:"h-6 w-px bg-white/60"}),h.jsx("button",{type:"button",onClick:()=>W.current?.zoomOut(),className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/40 bg-white/70 text-sm font-semibold text-foreground transition hover:bg-white/90","aria-label":"Zoom out",children:""})]})]})}const Oee=["top","right","bottom","left"],vm=Math.min,Gc=Math.max,H0=Math.round,r0=Math.floor,Lh=i=>({x:i,y:i}),zee={left:"right",right:"left",bottom:"top",top:"bottom"},Fee={start:"end",end:"start"};function h2(i,n,a){return Gc(i,vm(n,a))}function ip(i,n){return typeof i=="function"?i(n):i}function sp(i){return i.split("-")[0]}function v_(i){return i.split("-")[1]}function ZE(i){return i==="x"?"y":"x"}function XE(i){return i==="y"?"height":"width"}const Bee=new Set(["top","bottom"]);function Nh(i){return Bee.has(sp(i))?"y":"x"}function KE(i){return ZE(Nh(i))}function Vee(i,n,a){a===void 0&&(a=!1);const d=v_(i),y=KE(i),v=XE(y);let C=y==="x"?d===(a?"end":"start")?"right":"left":d==="start"?"bottom":"top";return n.reference[v]>n.floating[v]&&(C=Z0(C)),[C,Z0(C)]}function Uee(i){const n=Z0(i);return[f2(i),n,f2(n)]}function f2(i){return i.replace(/start|end/g,n=>Fee[n])}const ER=["left","right"],CR=["right","left"],$ee=["top","bottom"],qee=["bottom","top"];function Gee(i,n,a){switch(i){case"top":case"bottom":return a?n?CR:ER:n?ER:CR;case"left":case"right":return n?$ee:qee;default:return[]}}function Wee(i,n,a,d){const y=v_(i);let v=Gee(sp(i),a==="start",d);return y&&(v=v.map(C=>C+"-"+y),n&&(v=v.concat(v.map(f2)))),v}function Z0(i){return i.replace(/left|right|bottom|top/g,n=>zee[n])}function Hee(i){return{top:0,right:0,bottom:0,left:0,...i}}function Iz(i){return typeof i!="number"?Hee(i):{top:i,right:i,bottom:i,left:i}}function X0(i){const{x:n,y:a,width:d,height:y}=i;return{width:d,height:y,top:a,left:n,right:n+d,bottom:a+y,x:n,y:a}}function AR(i,n,a){let{reference:d,floating:y}=i;const v=Nh(n),C=KE(n),s=XE(C),M=sp(n),L=v==="y",F=d.x+d.width/2-y.width/2,W=d.y+d.height/2-y.height/2,X=d[s]/2-y[s]/2;let ee;switch(M){case"top":ee={x:F,y:d.y-y.height};break;case"bottom":ee={x:F,y:d.y+d.height};break;case"right":ee={x:d.x+d.width,y:W};break;case"left":ee={x:d.x-y.width,y:W};break;default:ee={x:d.x,y:d.y}}switch(v_(n)){case"start":ee[C]-=X*(a&&L?-1:1);break;case"end":ee[C]+=X*(a&&L?-1:1);break}return ee}const Zee=async(i,n,a)=>{const{placement:d="bottom",strategy:y="absolute",middleware:v=[],platform:C}=a,s=v.filter(Boolean),M=await(C.isRTL==null?void 0:C.isRTL(n));let L=await C.getElementRects({reference:i,floating:n,strategy:y}),{x:F,y:W}=AR(L,d,M),X=d,ee={},he=0;for(let se=0;se<s.length;se++){const{name:oe,fn:ve}=s[se],{x:me,y:Se,data:Re,reset:Be}=await ve({x:F,y:W,initialPlacement:d,placement:X,strategy:y,middlewareData:ee,rects:L,platform:C,elements:{reference:i,floating:n}});F=me??F,W=Se??W,ee={...ee,[oe]:{...ee[oe],...Re}},Be&&he<=50&&(he++,typeof Be=="object"&&(Be.placement&&(X=Be.placement),Be.rects&&(L=Be.rects===!0?await C.getElementRects({reference:i,floating:n,strategy:y}):Be.rects),{x:F,y:W}=AR(L,X,M)),se=-1)}return{x:F,y:W,placement:X,strategy:y,middlewareData:ee}};async function fv(i,n){var a;n===void 0&&(n={});const{x:d,y,platform:v,rects:C,elements:s,strategy:M}=i,{boundary:L="clippingAncestors",rootBoundary:F="viewport",elementContext:W="floating",altBoundary:X=!1,padding:ee=0}=ip(n,i),he=Iz(ee),oe=s[X?W==="floating"?"reference":"floating":W],ve=X0(await v.getClippingRect({element:(a=await(v.isElement==null?void 0:v.isElement(oe)))==null||a?oe:oe.contextElement||await(v.getDocumentElement==null?void 0:v.getDocumentElement(s.floating)),boundary:L,rootBoundary:F,strategy:M})),me=W==="floating"?{x:d,y,width:C.floating.width,height:C.floating.height}:C.reference,Se=await(v.getOffsetParent==null?void 0:v.getOffsetParent(s.floating)),Re=await(v.isElement==null?void 0:v.isElement(Se))?await(v.getScale==null?void 0:v.getScale(Se))||{x:1,y:1}:{x:1,y:1},Be=X0(v.convertOffsetParentRelativeRectToViewportRelativeRect?await v.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:me,offsetParent:Se,strategy:M}):me);return{top:(ve.top-Be.top+he.top)/Re.y,bottom:(Be.bottom-ve.bottom+he.bottom)/Re.y,left:(ve.left-Be.left+he.left)/Re.x,right:(Be.right-ve.right+he.right)/Re.x}}const Xee=i=>({name:"arrow",options:i,async fn(n){const{x:a,y:d,placement:y,rects:v,platform:C,elements:s,middlewareData:M}=n,{element:L,padding:F=0}=ip(i,n)||{};if(L==null)return{};const W=Iz(F),X={x:a,y:d},ee=KE(y),he=XE(ee),se=await C.getDimensions(L),oe=ee==="y",ve=oe?"top":"left",me=oe?"bottom":"right",Se=oe?"clientHeight":"clientWidth",Re=v.reference[he]+v.reference[ee]-X[ee]-v.floating[he],Be=X[ee]-v.reference[ee],rt=await(C.getOffsetParent==null?void 0:C.getOffsetParent(L));let We=rt?rt[Se]:0;(!We||!await(C.isElement==null?void 0:C.isElement(rt)))&&(We=s.floating[Se]||v.floating[he]);const Ct=Re/2-Be/2,Ht=We/2-se[he]/2-1,Zt=vm(W[ve],Ht),rr=vm(W[me],Ht),$t=Zt,Rt=We-se[he]-rr,Gt=We/2-se[he]/2+Ct,Ar=h2($t,Gt,Rt),Ut=!M.arrow&&v_(y)!=null&&Gt!==Ar&&v.reference[he]/2-(Gt<$t?Zt:rr)-se[he]/2<0,Xt=Ut?Gt<$t?Gt-$t:Gt-Rt:0;return{[ee]:X[ee]+Xt,data:{[ee]:Ar,centerOffset:Gt-Ar-Xt,...Ut&&{alignmentOffset:Xt}},reset:Ut}}}),Kee=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(n){var a,d;const{placement:y,middlewareData:v,rects:C,initialPlacement:s,platform:M,elements:L}=n,{mainAxis:F=!0,crossAxis:W=!0,fallbackPlacements:X,fallbackStrategy:ee="bestFit",fallbackAxisSideDirection:he="none",flipAlignment:se=!0,...oe}=ip(i,n);if((a=v.arrow)!=null&&a.alignmentOffset)return{};const ve=sp(y),me=Nh(s),Se=sp(s)===s,Re=await(M.isRTL==null?void 0:M.isRTL(L.floating)),Be=X||(Se||!se?[Z0(s)]:Uee(s)),rt=he!=="none";!X&&rt&&Be.push(...Wee(s,se,he,Re));const We=[s,...Be],Ct=await fv(n,oe),Ht=[];let Zt=((d=v.flip)==null?void 0:d.overflows)||[];if(F&&Ht.push(Ct[ve]),W){const Gt=Vee(y,C,Re);Ht.push(Ct[Gt[0]],Ct[Gt[1]])}if(Zt=[...Zt,{placement:y,overflows:Ht}],!Ht.every(Gt=>Gt<=0)){var rr,$t;const Gt=(((rr=v.flip)==null?void 0:rr.index)||0)+1,Ar=We[Gt];if(Ar&&(!(W==="alignment"?me!==Nh(Ar):!1)||Zt.every(ut=>Nh(ut.placement)===me?ut.overflows[0]>0:!0)))return{data:{index:Gt,overflows:Zt},reset:{placement:Ar}};let Ut=($t=Zt.filter(Xt=>Xt.overflows[0]<=0).sort((Xt,ut)=>Xt.overflows[1]-ut.overflows[1])[0])==null?void 0:$t.placement;if(!Ut)switch(ee){case"bestFit":{var Rt;const Xt=(Rt=Zt.filter(ut=>{if(rt){const Mt=Nh(ut.placement);return Mt===me||Mt==="y"}return!0}).map(ut=>[ut.placement,ut.overflows.filter(Mt=>Mt>0).reduce((Mt,Qt)=>Mt+Qt,0)]).sort((ut,Mt)=>ut[1]-Mt[1])[0])==null?void 0:Rt[0];Xt&&(Ut=Xt);break}case"initialPlacement":Ut=s;break}if(y!==Ut)return{reset:{placement:Ut}}}return{}}}};function IR(i,n){return{top:i.top-n.height,right:i.right-n.width,bottom:i.bottom-n.height,left:i.left-n.width}}function PR(i){return Oee.some(n=>i[n]>=0)}const Yee=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(n){const{rects:a}=n,{strategy:d="referenceHidden",...y}=ip(i,n);switch(d){case"referenceHidden":{const v=await fv(n,{...y,elementContext:"reference"}),C=IR(v,a.reference);return{data:{referenceHiddenOffsets:C,referenceHidden:PR(C)}}}case"escaped":{const v=await fv(n,{...y,altBoundary:!0}),C=IR(v,a.floating);return{data:{escapedOffsets:C,escaped:PR(C)}}}default:return{}}}}},Pz=new Set(["left","top"]);async function Qee(i,n){const{placement:a,platform:d,elements:y}=i,v=await(d.isRTL==null?void 0:d.isRTL(y.floating)),C=sp(a),s=v_(a),M=Nh(a)==="y",L=Pz.has(C)?-1:1,F=v&&M?-1:1,W=ip(n,i);let{mainAxis:X,crossAxis:ee,alignmentAxis:he}=typeof W=="number"?{mainAxis:W,crossAxis:0,alignmentAxis:null}:{mainAxis:W.mainAxis||0,crossAxis:W.crossAxis||0,alignmentAxis:W.alignmentAxis};return s&&typeof he=="number"&&(ee=s==="end"?he*-1:he),M?{x:ee*F,y:X*L}:{x:X*L,y:ee*F}}const Jee=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(n){var a,d;const{x:y,y:v,placement:C,middlewareData:s}=n,M=await Qee(n,i);return C===((a=s.offset)==null?void 0:a.placement)&&(d=s.arrow)!=null&&d.alignmentOffset?{}:{x:y+M.x,y:v+M.y,data:{...M,placement:C}}}}},ete=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(n){const{x:a,y:d,placement:y}=n,{mainAxis:v=!0,crossAxis:C=!1,limiter:s={fn:oe=>{let{x:ve,y:me}=oe;return{x:ve,y:me}}},...M}=ip(i,n),L={x:a,y:d},F=await fv(n,M),W=Nh(sp(y)),X=ZE(W);let ee=L[X],he=L[W];if(v){const oe=X==="y"?"top":"left",ve=X==="y"?"bottom":"right",me=ee+F[oe],Se=ee-F[ve];ee=h2(me,ee,Se)}if(C){const oe=W==="y"?"top":"left",ve=W==="y"?"bottom":"right",me=he+F[oe],Se=he-F[ve];he=h2(me,he,Se)}const se=s.fn({...n,[X]:ee,[W]:he});return{...se,data:{x:se.x-a,y:se.y-d,enabled:{[X]:v,[W]:C}}}}}},tte=function(i){return i===void 0&&(i={}),{options:i,fn(n){const{x:a,y:d,placement:y,rects:v,middlewareData:C}=n,{offset:s=0,mainAxis:M=!0,crossAxis:L=!0}=ip(i,n),F={x:a,y:d},W=Nh(y),X=ZE(W);let ee=F[X],he=F[W];const se=ip(s,n),oe=typeof se=="number"?{mainAxis:se,crossAxis:0}:{mainAxis:0,crossAxis:0,...se};if(M){const Se=X==="y"?"height":"width",Re=v.reference[X]-v.floating[Se]+oe.mainAxis,Be=v.reference[X]+v.reference[Se]-oe.mainAxis;ee<Re?ee=Re:ee>Be&&(ee=Be)}if(L){var ve,me;const Se=X==="y"?"width":"height",Re=Pz.has(sp(y)),Be=v.reference[W]-v.floating[Se]+(Re&&((ve=C.offset)==null?void 0:ve[W])||0)+(Re?0:oe.crossAxis),rt=v.reference[W]+v.reference[Se]+(Re?0:((me=C.offset)==null?void 0:me[W])||0)-(Re?oe.crossAxis:0);he<Be?he=Be:he>rt&&(he=rt)}return{[X]:ee,[W]:he}}}},rte=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(n){var a,d;const{placement:y,rects:v,platform:C,elements:s}=n,{apply:M=()=>{},...L}=ip(i,n),F=await fv(n,L),W=sp(y),X=v_(y),ee=Nh(y)==="y",{width:he,height:se}=v.floating;let oe,ve;W==="top"||W==="bottom"?(oe=W,ve=X===(await(C.isRTL==null?void 0:C.isRTL(s.floating))?"start":"end")?"left":"right"):(ve=W,oe=X==="end"?"top":"bottom");const me=se-F.top-F.bottom,Se=he-F.left-F.right,Re=vm(se-F[oe],me),Be=vm(he-F[ve],Se),rt=!n.middlewareData.shift;let We=Re,Ct=Be;if((a=n.middlewareData.shift)!=null&&a.enabled.x&&(Ct=Se),(d=n.middlewareData.shift)!=null&&d.enabled.y&&(We=me),rt&&!X){const Zt=Gc(F.left,0),rr=Gc(F.right,0),$t=Gc(F.top,0),Rt=Gc(F.bottom,0);ee?Ct=he-2*(Zt!==0||rr!==0?Zt+rr:Gc(F.left,F.right)):We=se-2*($t!==0||Rt!==0?$t+Rt:Gc(F.top,F.bottom))}await M({...n,availableWidth:Ct,availableHeight:We});const Ht=await C.getDimensions(s.floating);return he!==Ht.width||se!==Ht.height?{reset:{rects:!0}}:{}}}};function Pw(){return typeof window<"u"}function b_(i){return kz(i)?(i.nodeName||"").toLowerCase():"#document"}function Yc(i){var n;return(i==null||(n=i.ownerDocument)==null?void 0:n.defaultView)||window}function Vh(i){var n;return(n=(kz(i)?i.ownerDocument:i.document)||window.document)==null?void 0:n.documentElement}function kz(i){return Pw()?i instanceof Node||i instanceof Yc(i).Node:!1}function Pd(i){return Pw()?i instanceof Element||i instanceof Yc(i).Element:!1}function zh(i){return Pw()?i instanceof HTMLElement||i instanceof Yc(i).HTMLElement:!1}function kR(i){return!Pw()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Yc(i).ShadowRoot}const nte=new Set(["inline","contents"]);function Nv(i){const{overflow:n,overflowX:a,overflowY:d,display:y}=kd(i);return/auto|scroll|overlay|hidden|clip/.test(n+d+a)&&!nte.has(y)}const ite=new Set(["table","td","th"]);function ste(i){return ite.has(b_(i))}const ote=[":popover-open",":modal"];function kw(i){return ote.some(n=>{try{return i.matches(n)}catch{return!1}})}const ate=["transform","translate","scale","rotate","perspective"],lte=["transform","translate","scale","rotate","perspective","filter"],cte=["paint","layout","strict","content"];function YE(i){const n=QE(),a=Pd(i)?kd(i):i;return ate.some(d=>a[d]?a[d]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!n&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!n&&(a.filter?a.filter!=="none":!1)||lte.some(d=>(a.willChange||"").includes(d))||cte.some(d=>(a.contain||"").includes(d))}function ute(i){let n=bm(i);for(;zh(n)&&!h_(n);){if(YE(n))return n;if(kw(n))return null;n=bm(n)}return null}function QE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const dte=new Set(["html","body","#document"]);function h_(i){return dte.has(b_(i))}function kd(i){return Yc(i).getComputedStyle(i)}function Nw(i){return Pd(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function bm(i){if(b_(i)==="html")return i;const n=i.assignedSlot||i.parentNode||kR(i)&&i.host||Vh(i);return kR(n)?n.host:n}function Nz(i){const n=bm(i);return h_(n)?i.ownerDocument?i.ownerDocument.body:i.body:zh(n)&&Nv(n)?n:Nz(n)}function pv(i,n,a){var d;n===void 0&&(n=[]),a===void 0&&(a=!0);const y=Nz(i),v=y===((d=i.ownerDocument)==null?void 0:d.body),C=Yc(y);if(v){const s=p2(C);return n.concat(C,C.visualViewport||[],Nv(y)?y:[],s&&a?pv(s):[])}return n.concat(y,pv(y,[],a))}function p2(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function jz(i){const n=kd(i);let a=parseFloat(n.width)||0,d=parseFloat(n.height)||0;const y=zh(i),v=y?i.offsetWidth:a,C=y?i.offsetHeight:d,s=H0(a)!==v||H0(d)!==C;return s&&(a=v,d=C),{width:a,height:d,$:s}}function JE(i){return Pd(i)?i:i.contextElement}function t_(i){const n=JE(i);if(!zh(n))return Lh(1);const a=n.getBoundingClientRect(),{width:d,height:y,$:v}=jz(n);let C=(v?H0(a.width):a.width)/d,s=(v?H0(a.height):a.height)/y;return(!C||!Number.isFinite(C))&&(C=1),(!s||!Number.isFinite(s))&&(s=1),{x:C,y:s}}const hte=Lh(0);function Rz(i){const n=Yc(i);return!QE()||!n.visualViewport?hte:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function fte(i,n,a){return n===void 0&&(n=!1),!a||n&&a!==Yc(i)?!1:n}function jg(i,n,a,d){n===void 0&&(n=!1),a===void 0&&(a=!1);const y=i.getBoundingClientRect(),v=JE(i);let C=Lh(1);n&&(d?Pd(d)&&(C=t_(d)):C=t_(i));const s=fte(v,a,d)?Rz(v):Lh(0);let M=(y.left+s.x)/C.x,L=(y.top+s.y)/C.y,F=y.width/C.x,W=y.height/C.y;if(v){const X=Yc(v),ee=d&&Pd(d)?Yc(d):d;let he=X,se=p2(he);for(;se&&d&&ee!==he;){const oe=t_(se),ve=se.getBoundingClientRect(),me=kd(se),Se=ve.left+(se.clientLeft+parseFloat(me.paddingLeft))*oe.x,Re=ve.top+(se.clientTop+parseFloat(me.paddingTop))*oe.y;M*=oe.x,L*=oe.y,F*=oe.x,W*=oe.y,M+=Se,L+=Re,he=Yc(se),se=p2(he)}}return X0({width:F,height:W,x:M,y:L})}function jw(i,n){const a=Nw(i).scrollLeft;return n?n.left+a:jg(Vh(i)).left+a}function Mz(i,n){const a=i.getBoundingClientRect(),d=a.left+n.scrollLeft-jw(i,a),y=a.top+n.scrollTop;return{x:d,y}}function pte(i){let{elements:n,rect:a,offsetParent:d,strategy:y}=i;const v=y==="fixed",C=Vh(d),s=n?kw(n.floating):!1;if(d===C||s&&v)return a;let M={scrollLeft:0,scrollTop:0},L=Lh(1);const F=Lh(0),W=zh(d);if((W||!W&&!v)&&((b_(d)!=="body"||Nv(C))&&(M=Nw(d)),zh(d))){const ee=jg(d);L=t_(d),F.x=ee.x+d.clientLeft,F.y=ee.y+d.clientTop}const X=C&&!W&&!v?Mz(C,M):Lh(0);return{width:a.width*L.x,height:a.height*L.y,x:a.x*L.x-M.scrollLeft*L.x+F.x+X.x,y:a.y*L.y-M.scrollTop*L.y+F.y+X.y}}function mte(i){return Array.from(i.getClientRects())}function gte(i){const n=Vh(i),a=Nw(i),d=i.ownerDocument.body,y=Gc(n.scrollWidth,n.clientWidth,d.scrollWidth,d.clientWidth),v=Gc(n.scrollHeight,n.clientHeight,d.scrollHeight,d.clientHeight);let C=-a.scrollLeft+jw(i);const s=-a.scrollTop;return kd(d).direction==="rtl"&&(C+=Gc(n.clientWidth,d.clientWidth)-y),{width:y,height:v,x:C,y:s}}const NR=25;function yte(i,n){const a=Yc(i),d=Vh(i),y=a.visualViewport;let v=d.clientWidth,C=d.clientHeight,s=0,M=0;if(y){v=y.width,C=y.height;const F=QE();(!F||F&&n==="fixed")&&(s=y.offsetLeft,M=y.offsetTop)}const L=jw(d);if(L<=0){const F=d.ownerDocument,W=F.body,X=getComputedStyle(W),ee=F.compatMode==="CSS1Compat"&&parseFloat(X.marginLeft)+parseFloat(X.marginRight)||0,he=Math.abs(d.clientWidth-W.clientWidth-ee);he<=NR&&(v-=he)}else L<=NR&&(v+=L);return{width:v,height:C,x:s,y:M}}const _te=new Set(["absolute","fixed"]);function xte(i,n){const a=jg(i,!0,n==="fixed"),d=a.top+i.clientTop,y=a.left+i.clientLeft,v=zh(i)?t_(i):Lh(1),C=i.clientWidth*v.x,s=i.clientHeight*v.y,M=y*v.x,L=d*v.y;return{width:C,height:s,x:M,y:L}}function jR(i,n,a){let d;if(n==="viewport")d=yte(i,a);else if(n==="document")d=gte(Vh(i));else if(Pd(n))d=xte(n,a);else{const y=Rz(i);d={x:n.x-y.x,y:n.y-y.y,width:n.width,height:n.height}}return X0(d)}function Lz(i,n){const a=bm(i);return a===n||!Pd(a)||h_(a)?!1:kd(a).position==="fixed"||Lz(a,n)}function vte(i,n){const a=n.get(i);if(a)return a;let d=pv(i,[],!1).filter(s=>Pd(s)&&b_(s)!=="body"),y=null;const v=kd(i).position==="fixed";let C=v?bm(i):i;for(;Pd(C)&&!h_(C);){const s=kd(C),M=YE(C);!M&&s.position==="fixed"&&(y=null),(v?!M&&!y:!M&&s.position==="static"&&!!y&&_te.has(y.position)||Nv(C)&&!M&&Lz(i,C))?d=d.filter(F=>F!==C):y=s,C=bm(C)}return n.set(i,d),d}function bte(i){let{element:n,boundary:a,rootBoundary:d,strategy:y}=i;const C=[...a==="clippingAncestors"?kw(n)?[]:vte(n,this._c):[].concat(a),d],s=C[0],M=C.reduce((L,F)=>{const W=jR(n,F,y);return L.top=Gc(W.top,L.top),L.right=vm(W.right,L.right),L.bottom=vm(W.bottom,L.bottom),L.left=Gc(W.left,L.left),L},jR(n,s,y));return{width:M.right-M.left,height:M.bottom-M.top,x:M.left,y:M.top}}function wte(i){const{width:n,height:a}=jz(i);return{width:n,height:a}}function Ste(i,n,a){const d=zh(n),y=Vh(n),v=a==="fixed",C=jg(i,!0,v,n);let s={scrollLeft:0,scrollTop:0};const M=Lh(0);function L(){M.x=jw(y)}if(d||!d&&!v)if((b_(n)!=="body"||Nv(y))&&(s=Nw(n)),d){const ee=jg(n,!0,v,n);M.x=ee.x+n.clientLeft,M.y=ee.y+n.clientTop}else y&&L();v&&!d&&y&&L();const F=y&&!d&&!v?Mz(y,s):Lh(0),W=C.left+s.scrollLeft-M.x-F.x,X=C.top+s.scrollTop-M.y-F.y;return{x:W,y:X,width:C.width,height:C.height}}function aT(i){return kd(i).position==="static"}function RR(i,n){if(!zh(i)||kd(i).position==="fixed")return null;if(n)return n(i);let a=i.offsetParent;return Vh(i)===a&&(a=a.ownerDocument.body),a}function Dz(i,n){const a=Yc(i);if(kw(i))return a;if(!zh(i)){let y=bm(i);for(;y&&!h_(y);){if(Pd(y)&&!aT(y))return y;y=bm(y)}return a}let d=RR(i,n);for(;d&&ste(d)&&aT(d);)d=RR(d,n);return d&&h_(d)&&aT(d)&&!YE(d)?a:d||ute(i)||a}const Tte=async function(i){const n=this.getOffsetParent||Dz,a=this.getDimensions,d=await a(i.floating);return{reference:Ste(i.reference,await n(i.floating),i.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}};function Ete(i){return kd(i).direction==="rtl"}const Cte={convertOffsetParentRelativeRectToViewportRelativeRect:pte,getDocumentElement:Vh,getClippingRect:bte,getOffsetParent:Dz,getElementRects:Tte,getClientRects:mte,getDimensions:wte,getScale:t_,isElement:Pd,isRTL:Ete};function Oz(i,n){return i.x===n.x&&i.y===n.y&&i.width===n.width&&i.height===n.height}function Ate(i,n){let a=null,d;const y=Vh(i);function v(){var s;clearTimeout(d),(s=a)==null||s.disconnect(),a=null}function C(s,M){s===void 0&&(s=!1),M===void 0&&(M=1),v();const L=i.getBoundingClientRect(),{left:F,top:W,width:X,height:ee}=L;if(s||n(),!X||!ee)return;const he=r0(W),se=r0(y.clientWidth-(F+X)),oe=r0(y.clientHeight-(W+ee)),ve=r0(F),Se={rootMargin:-he+"px "+-se+"px "+-oe+"px "+-ve+"px",threshold:Gc(0,vm(1,M))||1};let Re=!0;function Be(rt){const We=rt[0].intersectionRatio;if(We!==M){if(!Re)return C();We?C(!1,We):d=setTimeout(()=>{C(!1,1e-7)},1e3)}We===1&&!Oz(L,i.getBoundingClientRect())&&C(),Re=!1}try{a=new IntersectionObserver(Be,{...Se,root:y.ownerDocument})}catch{a=new IntersectionObserver(Be,Se)}a.observe(i)}return C(!0),v}function Ite(i,n,a,d){d===void 0&&(d={});const{ancestorScroll:y=!0,ancestorResize:v=!0,elementResize:C=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:M=!1}=d,L=JE(i),F=y||v?[...L?pv(L):[],...pv(n)]:[];F.forEach(ve=>{y&&ve.addEventListener("scroll",a,{passive:!0}),v&&ve.addEventListener("resize",a)});const W=L&&s?Ate(L,a):null;let X=-1,ee=null;C&&(ee=new ResizeObserver(ve=>{let[me]=ve;me&&me.target===L&&ee&&(ee.unobserve(n),cancelAnimationFrame(X),X=requestAnimationFrame(()=>{var Se;(Se=ee)==null||Se.observe(n)})),a()}),L&&!M&&ee.observe(L),ee.observe(n));let he,se=M?jg(i):null;M&&oe();function oe(){const ve=jg(i);se&&!Oz(se,ve)&&a(),se=ve,he=requestAnimationFrame(oe)}return a(),()=>{var ve;F.forEach(me=>{y&&me.removeEventListener("scroll",a),v&&me.removeEventListener("resize",a)}),W?.(),(ve=ee)==null||ve.disconnect(),ee=null,M&&cancelAnimationFrame(he)}}const Pte=Jee,kte=ete,Nte=Kee,jte=rte,Rte=Yee,MR=Xee,Mte=tte,Lte=(i,n,a)=>{const d=new Map,y={platform:Cte,...a},v={...y.platform,_c:d};return Zee(i,n,{...y,platform:v})};var Dte=typeof document<"u",Ote=function(){},x0=Dte?$.useLayoutEffect:Ote;function K0(i,n){if(i===n)return!0;if(typeof i!=typeof n)return!1;if(typeof i=="function"&&i.toString()===n.toString())return!0;let a,d,y;if(i&&n&&typeof i=="object"){if(Array.isArray(i)){if(a=i.length,a!==n.length)return!1;for(d=a;d--!==0;)if(!K0(i[d],n[d]))return!1;return!0}if(y=Object.keys(i),a=y.length,a!==Object.keys(n).length)return!1;for(d=a;d--!==0;)if(!{}.hasOwnProperty.call(n,y[d]))return!1;for(d=a;d--!==0;){const v=y[d];if(!(v==="_owner"&&i.$$typeof)&&!K0(i[v],n[v]))return!1}return!0}return i!==i&&n!==n}function zz(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function LR(i,n){const a=zz(i);return Math.round(n*a)/a}function lT(i){const n=$.useRef(i);return x0(()=>{n.current=i}),n}function zte(i){i===void 0&&(i={});const{placement:n="bottom",strategy:a="absolute",middleware:d=[],platform:y,elements:{reference:v,floating:C}={},transform:s=!0,whileElementsMounted:M,open:L}=i,[F,W]=$.useState({x:0,y:0,strategy:a,placement:n,middlewareData:{},isPositioned:!1}),[X,ee]=$.useState(d);K0(X,d)||ee(d);const[he,se]=$.useState(null),[oe,ve]=$.useState(null),me=$.useCallback(ut=>{ut!==rt.current&&(rt.current=ut,se(ut))},[]),Se=$.useCallback(ut=>{ut!==We.current&&(We.current=ut,ve(ut))},[]),Re=v||he,Be=C||oe,rt=$.useRef(null),We=$.useRef(null),Ct=$.useRef(F),Ht=M!=null,Zt=lT(M),rr=lT(y),$t=lT(L),Rt=$.useCallback(()=>{if(!rt.current||!We.current)return;const ut={placement:n,strategy:a,middleware:X};rr.current&&(ut.platform=rr.current),Lte(rt.current,We.current,ut).then(Mt=>{const Qt={...Mt,isPositioned:$t.current!==!1};Gt.current&&!K0(Ct.current,Qt)&&(Ct.current=Qt,nw.flushSync(()=>{W(Qt)}))})},[X,n,a,rr,$t]);x0(()=>{L===!1&&Ct.current.isPositioned&&(Ct.current.isPositioned=!1,W(ut=>({...ut,isPositioned:!1})))},[L]);const Gt=$.useRef(!1);x0(()=>(Gt.current=!0,()=>{Gt.current=!1}),[]),x0(()=>{if(Re&&(rt.current=Re),Be&&(We.current=Be),Re&&Be){if(Zt.current)return Zt.current(Re,Be,Rt);Rt()}},[Re,Be,Rt,Zt,Ht]);const Ar=$.useMemo(()=>({reference:rt,floating:We,setReference:me,setFloating:Se}),[me,Se]),Ut=$.useMemo(()=>({reference:Re,floating:Be}),[Re,Be]),Xt=$.useMemo(()=>{const ut={position:a,left:0,top:0};if(!Ut.floating)return ut;const Mt=LR(Ut.floating,F.x),Qt=LR(Ut.floating,F.y);return s?{...ut,transform:"translate("+Mt+"px, "+Qt+"px)",...zz(Ut.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:Mt,top:Qt}},[a,s,Ut.floating,F.x,F.y]);return $.useMemo(()=>({...F,update:Rt,refs:Ar,elements:Ut,floatingStyles:Xt}),[F,Rt,Ar,Ut,Xt])}const Fte=i=>{function n(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:i,fn(a){const{element:d,padding:y}=typeof i=="function"?i(a):i;return d&&n(d)?d.current!=null?MR({element:d.current,padding:y}).fn(a):{}:d?MR({element:d,padding:y}).fn(a):{}}}},Bte=(i,n)=>({...Pte(i),options:[i,n]}),Vte=(i,n)=>({...kte(i),options:[i,n]}),Ute=(i,n)=>({...Mte(i),options:[i,n]}),$te=(i,n)=>({...Nte(i),options:[i,n]}),qte=(i,n)=>({...jte(i),options:[i,n]}),Gte=(i,n)=>({...Rte(i),options:[i,n]}),Wte=(i,n)=>({...Fte(i),options:[i,n]});var Hte="Arrow",Fz=$.forwardRef((i,n)=>{const{children:a,width:d=10,height:y=5,...v}=i;return h.jsx(ss.svg,{...v,ref:n,width:d,height:y,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?a:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});Fz.displayName=Hte;var Zte=Fz;function Xte(i){const[n,a]=$.useState(void 0);return Qc(()=>{if(i){a({width:i.offsetWidth,height:i.offsetHeight});const d=new ResizeObserver(y=>{if(!Array.isArray(y)||!y.length)return;const v=y[0];let C,s;if("borderBoxSize"in v){const M=v.borderBoxSize,L=Array.isArray(M)?M[0]:M;C=L.inlineSize,s=L.blockSize}else C=i.offsetWidth,s=i.offsetHeight;a({width:C,height:s})});return d.observe(i,{box:"border-box"}),()=>d.unobserve(i)}else a(void 0)},[i]),n}var eC="Popper",[Bz,Vz]=Fh(eC),[Kte,Uz]=Bz(eC),$z=i=>{const{__scopePopper:n,children:a}=i,[d,y]=$.useState(null);return h.jsx(Kte,{scope:n,anchor:d,onAnchorChange:y,children:a})};$z.displayName=eC;var qz="PopperAnchor",Gz=$.forwardRef((i,n)=>{const{__scopePopper:a,virtualRef:d,...y}=i,v=Uz(qz,a),C=$.useRef(null),s=ta(n,C),M=$.useRef(null);return $.useEffect(()=>{const L=M.current;M.current=d?.current||C.current,L!==M.current&&v.onAnchorChange(M.current)}),d?null:h.jsx(ss.div,{...y,ref:s})});Gz.displayName=qz;var tC="PopperContent",[Yte,Qte]=Bz(tC),Wz=$.forwardRef((i,n)=>{const{__scopePopper:a,side:d="bottom",sideOffset:y=0,align:v="center",alignOffset:C=0,arrowPadding:s=0,avoidCollisions:M=!0,collisionBoundary:L=[],collisionPadding:F=0,sticky:W="partial",hideWhenDetached:X=!1,updatePositionStrategy:ee="optimized",onPlaced:he,...se}=i,oe=Uz(tC,a),[ve,me]=$.useState(null),Se=ta(n,Zr=>me(Zr)),[Re,Be]=$.useState(null),rt=Xte(Re),We=rt?.width??0,Ct=rt?.height??0,Ht=d+(v!=="center"?"-"+v:""),Zt=typeof F=="number"?F:{top:0,right:0,bottom:0,left:0,...F},rr=Array.isArray(L)?L:[L],$t=rr.length>0,Rt={padding:Zt,boundary:rr.filter(ere),altBoundary:$t},{refs:Gt,floatingStyles:Ar,placement:Ut,isPositioned:Xt,middlewareData:ut}=zte({strategy:"fixed",placement:Ht,whileElementsMounted:(...Zr)=>Ite(...Zr,{animationFrame:ee==="always"}),elements:{reference:oe.anchor},middleware:[Bte({mainAxis:y+Ct,alignmentAxis:C}),M&&Vte({mainAxis:!0,crossAxis:!1,limiter:W==="partial"?Ute():void 0,...Rt}),M&&$te({...Rt}),qte({...Rt,apply:({elements:Zr,rects:Qr,availableWidth:ir,availableHeight:Hr})=>{const{width:Ur,height:Ti}=Qr.reference,Sn=Zr.floating.style;Sn.setProperty("--radix-popper-available-width",`${ir}px`),Sn.setProperty("--radix-popper-available-height",`${Hr}px`),Sn.setProperty("--radix-popper-anchor-width",`${Ur}px`),Sn.setProperty("--radix-popper-anchor-height",`${Ti}px`)}}),Re&&Wte({element:Re,padding:s}),tre({arrowWidth:We,arrowHeight:Ct}),X&&Gte({strategy:"referenceHidden",...Rt})]}),[Mt,Qt]=Xz(Ut),ze=vc(he);Qc(()=>{Xt&&ze?.()},[Xt,ze]);const It=ut.arrow?.x,xr=ut.arrow?.y,Lr=ut.arrow?.centerOffset!==0,[yn,Yr]=$.useState();return Qc(()=>{ve&&Yr(window.getComputedStyle(ve).zIndex)},[ve]),h.jsx("div",{ref:Gt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ar,transform:Xt?Ar.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:yn,"--radix-popper-transform-origin":[ut.transformOrigin?.x,ut.transformOrigin?.y].join(" "),...ut.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:h.jsx(Yte,{scope:a,placedSide:Mt,onArrowChange:Be,arrowX:It,arrowY:xr,shouldHideArrow:Lr,children:h.jsx(ss.div,{"data-side":Mt,"data-align":Qt,...se,ref:Se,style:{...se.style,animation:Xt?void 0:"none"}})})})});Wz.displayName=tC;var Hz="PopperArrow",Jte={top:"bottom",right:"left",bottom:"top",left:"right"},Zz=$.forwardRef(function(n,a){const{__scopePopper:d,...y}=n,v=Qte(Hz,d),C=Jte[v.placedSide];return h.jsx("span",{ref:v.onArrowChange,style:{position:"absolute",left:v.arrowX,top:v.arrowY,[C]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[v.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[v.placedSide],visibility:v.shouldHideArrow?"hidden":void 0},children:h.jsx(Zte,{...y,ref:a,style:{...y.style,display:"block"}})})});Zz.displayName=Hz;function ere(i){return i!==null}var tre=i=>({name:"transformOrigin",options:i,fn(n){const{placement:a,rects:d,middlewareData:y}=n,C=y.arrow?.centerOffset!==0,s=C?0:i.arrowWidth,M=C?0:i.arrowHeight,[L,F]=Xz(a),W={start:"0%",center:"50%",end:"100%"}[F],X=(y.arrow?.x??0)+s/2,ee=(y.arrow?.y??0)+M/2;let he="",se="";return L==="bottom"?(he=C?W:`${X}px`,se=`${-M}px`):L==="top"?(he=C?W:`${X}px`,se=`${d.floating.height+M}px`):L==="right"?(he=`${-M}px`,se=C?W:`${ee}px`):L==="left"&&(he=`${d.floating.width+M}px`,se=C?W:`${ee}px`),{data:{x:he,y:se}}}});function Xz(i){const[n,a="center"]=i.split("-");return[n,a]}var rre=$z,nre=Gz,ire=Wz,sre=Zz,cT="rovingFocusGroup.onEntryFocus",ore={bubbles:!1,cancelable:!0},jv="RovingFocusGroup",[m2,Kz,are]=sw(jv),[lre,Yz]=Fh(jv,[are]),[cre,ure]=lre(jv),Qz=$.forwardRef((i,n)=>h.jsx(m2.Provider,{scope:i.__scopeRovingFocusGroup,children:h.jsx(m2.Slot,{scope:i.__scopeRovingFocusGroup,children:h.jsx(dre,{...i,ref:n})})}));Qz.displayName=jv;var dre=$.forwardRef((i,n)=>{const{__scopeRovingFocusGroup:a,orientation:d,loop:y=!1,dir:v,currentTabStopId:C,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:M,onEntryFocus:L,preventScrollOnEntryFocus:F=!1,...W}=i,X=$.useRef(null),ee=ta(n,X),he=qE(v),[se,oe]=Rg({prop:C,defaultProp:s??null,onChange:M,caller:jv}),[ve,me]=$.useState(!1),Se=vc(L),Re=Kz(a),Be=$.useRef(!1),[rt,We]=$.useState(0);return $.useEffect(()=>{const Ct=X.current;if(Ct)return Ct.addEventListener(cT,Se),()=>Ct.removeEventListener(cT,Se)},[Se]),h.jsx(cre,{scope:a,orientation:d,dir:he,loop:y,currentTabStopId:se,onItemFocus:$.useCallback(Ct=>oe(Ct),[oe]),onItemShiftTab:$.useCallback(()=>me(!0),[]),onFocusableItemAdd:$.useCallback(()=>We(Ct=>Ct+1),[]),onFocusableItemRemove:$.useCallback(()=>We(Ct=>Ct-1),[]),children:h.jsx(ss.div,{tabIndex:ve||rt===0?-1:0,"data-orientation":d,...W,ref:ee,style:{outline:"none",...i.style},onMouseDown:ci(i.onMouseDown,()=>{Be.current=!0}),onFocus:ci(i.onFocus,Ct=>{const Ht=!Be.current;if(Ct.target===Ct.currentTarget&&Ht&&!ve){const Zt=new CustomEvent(cT,ore);if(Ct.currentTarget.dispatchEvent(Zt),!Zt.defaultPrevented){const rr=Re().filter(Ut=>Ut.focusable),$t=rr.find(Ut=>Ut.active),Rt=rr.find(Ut=>Ut.id===se),Ar=[$t,Rt,...rr].filter(Boolean).map(Ut=>Ut.ref.current);tF(Ar,F)}}Be.current=!1}),onBlur:ci(i.onBlur,()=>me(!1))})})}),Jz="RovingFocusGroupItem",eF=$.forwardRef((i,n)=>{const{__scopeRovingFocusGroup:a,focusable:d=!0,active:y=!1,tabStopId:v,children:C,...s}=i,M=hm(),L=v||M,F=ure(Jz,a),W=F.currentTabStopId===L,X=Kz(a),{onFocusableItemAdd:ee,onFocusableItemRemove:he,currentTabStopId:se}=F;return $.useEffect(()=>{if(d)return ee(),()=>he()},[d,ee,he]),h.jsx(m2.ItemSlot,{scope:a,id:L,focusable:d,active:y,children:h.jsx(ss.span,{tabIndex:W?0:-1,"data-orientation":F.orientation,...s,ref:n,onMouseDown:ci(i.onMouseDown,oe=>{d?F.onItemFocus(L):oe.preventDefault()}),onFocus:ci(i.onFocus,()=>F.onItemFocus(L)),onKeyDown:ci(i.onKeyDown,oe=>{if(oe.key==="Tab"&&oe.shiftKey){F.onItemShiftTab();return}if(oe.target!==oe.currentTarget)return;const ve=pre(oe,F.orientation,F.dir);if(ve!==void 0){if(oe.metaKey||oe.ctrlKey||oe.altKey||oe.shiftKey)return;oe.preventDefault();let Se=X().filter(Re=>Re.focusable).map(Re=>Re.ref.current);if(ve==="last")Se.reverse();else if(ve==="prev"||ve==="next"){ve==="prev"&&Se.reverse();const Re=Se.indexOf(oe.currentTarget);Se=F.loop?mre(Se,Re+1):Se.slice(Re+1)}setTimeout(()=>tF(Se))}}),children:typeof C=="function"?C({isCurrentTabStop:W,hasTabStop:se!=null}):C})})});eF.displayName=Jz;var hre={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function fre(i,n){return n!=="rtl"?i:i==="ArrowLeft"?"ArrowRight":i==="ArrowRight"?"ArrowLeft":i}function pre(i,n,a){const d=fre(i.key,a);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(d))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(d)))return hre[d]}function tF(i,n=!1){const a=document.activeElement;for(const d of i)if(d===a||(d.focus({preventScroll:n}),document.activeElement!==a))return}function mre(i,n){return i.map((a,d)=>i[(n+d)%i.length])}var gre=Qz,yre=eF,g2=["Enter"," "],_re=["ArrowDown","PageUp","Home"],rF=["ArrowUp","PageDown","End"],xre=[..._re,...rF],vre={ltr:[...g2,"ArrowRight"],rtl:[...g2,"ArrowLeft"]},bre={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Rv="Menu",[mv,wre,Sre]=sw(Rv),[Dg,nF]=Fh(Rv,[Sre,Vz,Yz]),Rw=Vz(),iF=Yz(),[Tre,Og]=Dg(Rv),[Ere,Mv]=Dg(Rv),sF=i=>{const{__scopeMenu:n,open:a=!1,children:d,dir:y,onOpenChange:v,modal:C=!0}=i,s=Rw(n),[M,L]=$.useState(null),F=$.useRef(!1),W=vc(v),X=qE(y);return $.useEffect(()=>{const ee=()=>{F.current=!0,document.addEventListener("pointerdown",he,{capture:!0,once:!0}),document.addEventListener("pointermove",he,{capture:!0,once:!0})},he=()=>F.current=!1;return document.addEventListener("keydown",ee,{capture:!0}),()=>{document.removeEventListener("keydown",ee,{capture:!0}),document.removeEventListener("pointerdown",he,{capture:!0}),document.removeEventListener("pointermove",he,{capture:!0})}},[]),h.jsx(rre,{...s,children:h.jsx(Tre,{scope:n,open:a,onOpenChange:W,content:M,onContentChange:L,children:h.jsx(Ere,{scope:n,onClose:$.useCallback(()=>W(!1),[W]),isUsingKeyboardRef:F,dir:X,modal:C,children:d})})})};sF.displayName=Rv;var Cre="MenuAnchor",rC=$.forwardRef((i,n)=>{const{__scopeMenu:a,...d}=i,y=Rw(a);return h.jsx(nre,{...y,...d,ref:n})});rC.displayName=Cre;var nC="MenuPortal",[Are,oF]=Dg(nC,{forceMount:void 0}),aF=i=>{const{__scopeMenu:n,forceMount:a,children:d,container:y}=i,v=Og(nC,n);return h.jsx(Are,{scope:n,forceMount:a,children:h.jsx(Bh,{present:a||v.open,children:h.jsx(aw,{asChild:!0,container:y,children:d})})})};aF.displayName=nC;var Mu="MenuContent",[Ire,iC]=Dg(Mu),lF=$.forwardRef((i,n)=>{const a=oF(Mu,i.__scopeMenu),{forceMount:d=a.forceMount,...y}=i,v=Og(Mu,i.__scopeMenu),C=Mv(Mu,i.__scopeMenu);return h.jsx(mv.Provider,{scope:i.__scopeMenu,children:h.jsx(Bh,{present:d||v.open,children:h.jsx(mv.Slot,{scope:i.__scopeMenu,children:C.modal?h.jsx(Pre,{...y,ref:n}):h.jsx(kre,{...y,ref:n})})})})}),Pre=$.forwardRef((i,n)=>{const a=Og(Mu,i.__scopeMenu),d=$.useRef(null),y=ta(n,d);return $.useEffect(()=>{const v=d.current;if(v)return D3(v)},[]),h.jsx(sC,{...i,ref:y,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:ci(i.onFocusOutside,v=>v.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)})}),kre=$.forwardRef((i,n)=>{const a=Og(Mu,i.__scopeMenu);return h.jsx(sC,{...i,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>a.onOpenChange(!1)})}),Nre=r_("MenuContent.ScrollLock"),sC=$.forwardRef((i,n)=>{const{__scopeMenu:a,loop:d=!1,trapFocus:y,onOpenAutoFocus:v,onCloseAutoFocus:C,disableOutsidePointerEvents:s,onEntryFocus:M,onEscapeKeyDown:L,onPointerDownOutside:F,onFocusOutside:W,onInteractOutside:X,onDismiss:ee,disableOutsideScroll:he,...se}=i,oe=Og(Mu,a),ve=Mv(Mu,a),me=Rw(a),Se=iF(a),Re=wre(a),[Be,rt]=$.useState(null),We=$.useRef(null),Ct=ta(n,We,oe.onContentChange),Ht=$.useRef(0),Zt=$.useRef(""),rr=$.useRef(0),$t=$.useRef(null),Rt=$.useRef("right"),Gt=$.useRef(0),Ar=he?OE:$.Fragment,Ut=he?{as:Nre,allowPinchZoom:!0}:void 0,Xt=Mt=>{const Qt=Zt.current+Mt,ze=Re().filter(Zr=>!Zr.disabled),It=document.activeElement,xr=ze.find(Zr=>Zr.ref.current===It)?.textValue,Lr=ze.map(Zr=>Zr.textValue),yn=$re(Lr,Qt,xr),Yr=ze.find(Zr=>Zr.textValue===yn)?.ref.current;(function Zr(Qr){Zt.current=Qr,window.clearTimeout(Ht.current),Qr!==""&&(Ht.current=window.setTimeout(()=>Zr(""),1e3))})(Qt),Yr&&setTimeout(()=>Yr.focus())};$.useEffect(()=>()=>window.clearTimeout(Ht.current),[]),I3();const ut=$.useCallback(Mt=>Rt.current===$t.current?.side&&Gre(Mt,$t.current?.area),[]);return h.jsx(Ire,{scope:a,searchRef:Zt,onItemEnter:$.useCallback(Mt=>{ut(Mt)&&Mt.preventDefault()},[ut]),onItemLeave:$.useCallback(Mt=>{ut(Mt)||(We.current?.focus(),rt(null))},[ut]),onTriggerLeave:$.useCallback(Mt=>{ut(Mt)&&Mt.preventDefault()},[ut]),pointerGraceTimerRef:rr,onPointerGraceIntentChange:$.useCallback(Mt=>{$t.current=Mt},[]),children:h.jsx(Ar,{...Ut,children:h.jsx(DE,{asChild:!0,trapped:y,onMountAutoFocus:ci(v,Mt=>{Mt.preventDefault(),We.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:C,children:h.jsx(ow,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:L,onPointerDownOutside:F,onFocusOutside:W,onInteractOutside:X,onDismiss:ee,children:h.jsx(gre,{asChild:!0,...Se,dir:ve.dir,orientation:"vertical",loop:d,currentTabStopId:Be,onCurrentTabStopIdChange:rt,onEntryFocus:ci(M,Mt=>{ve.isUsingKeyboardRef.current||Mt.preventDefault()}),preventScrollOnEntryFocus:!0,children:h.jsx(ire,{role:"menu","aria-orientation":"vertical","data-state":TF(oe.open),"data-radix-menu-content":"",dir:ve.dir,...me,...se,ref:Ct,style:{outline:"none",...se.style},onKeyDown:ci(se.onKeyDown,Mt=>{const ze=Mt.target.closest("[data-radix-menu-content]")===Mt.currentTarget,It=Mt.ctrlKey||Mt.altKey||Mt.metaKey,xr=Mt.key.length===1;ze&&(Mt.key==="Tab"&&Mt.preventDefault(),!It&&xr&&Xt(Mt.key));const Lr=We.current;if(Mt.target!==Lr||!xre.includes(Mt.key))return;Mt.preventDefault();const Yr=Re().filter(Zr=>!Zr.disabled).map(Zr=>Zr.ref.current);rF.includes(Mt.key)&&Yr.reverse(),Vre(Yr)}),onBlur:ci(i.onBlur,Mt=>{Mt.currentTarget.contains(Mt.target)||(window.clearTimeout(Ht.current),Zt.current="")}),onPointerMove:ci(i.onPointerMove,gv(Mt=>{const Qt=Mt.target,ze=Gt.current!==Mt.clientX;if(Mt.currentTarget.contains(Qt)&&ze){const It=Mt.clientX>Gt.current?"right":"left";Rt.current=It,Gt.current=Mt.clientX}}))})})})})})})});lF.displayName=Mu;var jre="MenuGroup",oC=$.forwardRef((i,n)=>{const{__scopeMenu:a,...d}=i;return h.jsx(ss.div,{role:"group",...d,ref:n})});oC.displayName=jre;var Rre="MenuLabel",cF=$.forwardRef((i,n)=>{const{__scopeMenu:a,...d}=i;return h.jsx(ss.div,{...d,ref:n})});cF.displayName=Rre;var Y0="MenuItem",DR="menu.itemSelect",Mw=$.forwardRef((i,n)=>{const{disabled:a=!1,onSelect:d,...y}=i,v=$.useRef(null),C=Mv(Y0,i.__scopeMenu),s=iC(Y0,i.__scopeMenu),M=ta(n,v),L=$.useRef(!1),F=()=>{const W=v.current;if(!a&&W){const X=new CustomEvent(DR,{bubbles:!0,cancelable:!0});W.addEventListener(DR,ee=>d?.(ee),{once:!0}),T2(W,X),X.defaultPrevented?L.current=!1:C.onClose()}};return h.jsx(uF,{...y,ref:M,disabled:a,onClick:ci(i.onClick,F),onPointerDown:W=>{i.onPointerDown?.(W),L.current=!0},onPointerUp:ci(i.onPointerUp,W=>{L.current||W.currentTarget?.click()}),onKeyDown:ci(i.onKeyDown,W=>{const X=s.searchRef.current!=="";a||X&&W.key===" "||g2.includes(W.key)&&(W.currentTarget.click(),W.preventDefault())})})});Mw.displayName=Y0;var uF=$.forwardRef((i,n)=>{const{__scopeMenu:a,disabled:d=!1,textValue:y,...v}=i,C=iC(Y0,a),s=iF(a),M=$.useRef(null),L=ta(n,M),[F,W]=$.useState(!1),[X,ee]=$.useState("");return $.useEffect(()=>{const he=M.current;he&&ee((he.textContent??"").trim())},[v.children]),h.jsx(mv.ItemSlot,{scope:a,disabled:d,textValue:y??X,children:h.jsx(yre,{asChild:!0,...s,focusable:!d,children:h.jsx(ss.div,{role:"menuitem","data-highlighted":F?"":void 0,"aria-disabled":d||void 0,"data-disabled":d?"":void 0,...v,ref:L,onPointerMove:ci(i.onPointerMove,gv(he=>{d?C.onItemLeave(he):(C.onItemEnter(he),he.defaultPrevented||he.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ci(i.onPointerLeave,gv(he=>C.onItemLeave(he))),onFocus:ci(i.onFocus,()=>W(!0)),onBlur:ci(i.onBlur,()=>W(!1))})})})}),Mre="MenuCheckboxItem",dF=$.forwardRef((i,n)=>{const{checked:a=!1,onCheckedChange:d,...y}=i;return h.jsx(gF,{scope:i.__scopeMenu,checked:a,children:h.jsx(Mw,{role:"menuitemcheckbox","aria-checked":Q0(a)?"mixed":a,...y,ref:n,"data-state":lC(a),onSelect:ci(y.onSelect,()=>d?.(Q0(a)?!0:!a),{checkForDefaultPrevented:!1})})})});dF.displayName=Mre;var hF="MenuRadioGroup",[Lre,Dre]=Dg(hF,{value:void 0,onValueChange:()=>{}}),fF=$.forwardRef((i,n)=>{const{value:a,onValueChange:d,...y}=i,v=vc(d);return h.jsx(Lre,{scope:i.__scopeMenu,value:a,onValueChange:v,children:h.jsx(oC,{...y,ref:n})})});fF.displayName=hF;var pF="MenuRadioItem",mF=$.forwardRef((i,n)=>{const{value:a,...d}=i,y=Dre(pF,i.__scopeMenu),v=a===y.value;return h.jsx(gF,{scope:i.__scopeMenu,checked:v,children:h.jsx(Mw,{role:"menuitemradio","aria-checked":v,...d,ref:n,"data-state":lC(v),onSelect:ci(d.onSelect,()=>y.onValueChange?.(a),{checkForDefaultPrevented:!1})})})});mF.displayName=pF;var aC="MenuItemIndicator",[gF,Ore]=Dg(aC,{checked:!1}),yF=$.forwardRef((i,n)=>{const{__scopeMenu:a,forceMount:d,...y}=i,v=Ore(aC,a);return h.jsx(Bh,{present:d||Q0(v.checked)||v.checked===!0,children:h.jsx(ss.span,{...y,ref:n,"data-state":lC(v.checked)})})});yF.displayName=aC;var zre="MenuSeparator",_F=$.forwardRef((i,n)=>{const{__scopeMenu:a,...d}=i;return h.jsx(ss.div,{role:"separator","aria-orientation":"horizontal",...d,ref:n})});_F.displayName=zre;var Fre="MenuArrow",xF=$.forwardRef((i,n)=>{const{__scopeMenu:a,...d}=i,y=Rw(a);return h.jsx(sre,{...y,...d,ref:n})});xF.displayName=Fre;var Bre="MenuSub",[qie,vF]=Dg(Bre),Ax="MenuSubTrigger",bF=$.forwardRef((i,n)=>{const a=Og(Ax,i.__scopeMenu),d=Mv(Ax,i.__scopeMenu),y=vF(Ax,i.__scopeMenu),v=iC(Ax,i.__scopeMenu),C=$.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:M}=v,L={__scopeMenu:i.__scopeMenu},F=$.useCallback(()=>{C.current&&window.clearTimeout(C.current),C.current=null},[]);return $.useEffect(()=>F,[F]),$.useEffect(()=>{const W=s.current;return()=>{window.clearTimeout(W),M(null)}},[s,M]),h.jsx(rC,{asChild:!0,...L,children:h.jsx(uF,{id:y.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":y.contentId,"data-state":TF(a.open),...i,ref:iw(n,y.onTriggerChange),onClick:W=>{i.onClick?.(W),!(i.disabled||W.defaultPrevented)&&(W.currentTarget.focus(),a.open||a.onOpenChange(!0))},onPointerMove:ci(i.onPointerMove,gv(W=>{v.onItemEnter(W),!W.defaultPrevented&&!i.disabled&&!a.open&&!C.current&&(v.onPointerGraceIntentChange(null),C.current=window.setTimeout(()=>{a.onOpenChange(!0),F()},100))})),onPointerLeave:ci(i.onPointerLeave,gv(W=>{F();const X=a.content?.getBoundingClientRect();if(X){const ee=a.content?.dataset.side,he=ee==="right",se=he?-5:5,oe=X[he?"left":"right"],ve=X[he?"right":"left"];v.onPointerGraceIntentChange({area:[{x:W.clientX+se,y:W.clientY},{x:oe,y:X.top},{x:ve,y:X.top},{x:ve,y:X.bottom},{x:oe,y:X.bottom}],side:ee}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>v.onPointerGraceIntentChange(null),300)}else{if(v.onTriggerLeave(W),W.defaultPrevented)return;v.onPointerGraceIntentChange(null)}})),onKeyDown:ci(i.onKeyDown,W=>{const X=v.searchRef.current!=="";i.disabled||X&&W.key===" "||vre[d.dir].includes(W.key)&&(a.onOpenChange(!0),a.content?.focus(),W.preventDefault())})})})});bF.displayName=Ax;var wF="MenuSubContent",SF=$.forwardRef((i,n)=>{const a=oF(Mu,i.__scopeMenu),{forceMount:d=a.forceMount,...y}=i,v=Og(Mu,i.__scopeMenu),C=Mv(Mu,i.__scopeMenu),s=vF(wF,i.__scopeMenu),M=$.useRef(null),L=ta(n,M);return h.jsx(mv.Provider,{scope:i.__scopeMenu,children:h.jsx(Bh,{present:d||v.open,children:h.jsx(mv.Slot,{scope:i.__scopeMenu,children:h.jsx(sC,{id:s.contentId,"aria-labelledby":s.triggerId,...y,ref:L,align:"start",side:C.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:F=>{C.isUsingKeyboardRef.current&&M.current?.focus(),F.preventDefault()},onCloseAutoFocus:F=>F.preventDefault(),onFocusOutside:ci(i.onFocusOutside,F=>{F.target!==s.trigger&&v.onOpenChange(!1)}),onEscapeKeyDown:ci(i.onEscapeKeyDown,F=>{C.onClose(),F.preventDefault()}),onKeyDown:ci(i.onKeyDown,F=>{const W=F.currentTarget.contains(F.target),X=bre[C.dir].includes(F.key);W&&X&&(v.onOpenChange(!1),s.trigger?.focus(),F.preventDefault())})})})})})});SF.displayName=wF;function TF(i){return i?"open":"closed"}function Q0(i){return i==="indeterminate"}function lC(i){return Q0(i)?"indeterminate":i?"checked":"unchecked"}function Vre(i){const n=document.activeElement;for(const a of i)if(a===n||(a.focus(),document.activeElement!==n))return}function Ure(i,n){return i.map((a,d)=>i[(n+d)%i.length])}function $re(i,n,a){const y=n.length>1&&Array.from(n).every(L=>L===n[0])?n[0]:n,v=a?i.indexOf(a):-1;let C=Ure(i,Math.max(v,0));y.length===1&&(C=C.filter(L=>L!==a));const M=C.find(L=>L.toLowerCase().startsWith(y.toLowerCase()));return M!==a?M:void 0}function qre(i,n){const{x:a,y:d}=i;let y=!1;for(let v=0,C=n.length-1;v<n.length;C=v++){const s=n[v],M=n[C],L=s.x,F=s.y,W=M.x,X=M.y;F>d!=X>d&&a<(W-L)*(d-F)/(X-F)+L&&(y=!y)}return y}function Gre(i,n){if(!n)return!1;const a={x:i.clientX,y:i.clientY};return qre(a,n)}function gv(i){return n=>n.pointerType==="mouse"?i(n):void 0}var Wre=sF,Hre=rC,Zre=aF,Xre=lF,Kre=oC,Yre=cF,Qre=Mw,Jre=dF,ene=fF,tne=mF,rne=yF,nne=_F,ine=xF,sne=bF,one=SF,Lw="DropdownMenu",[ane]=Fh(Lw,[nF]),Yl=nF(),[lne,EF]=ane(Lw),CF=i=>{const{__scopeDropdownMenu:n,children:a,dir:d,open:y,defaultOpen:v,onOpenChange:C,modal:s=!0}=i,M=Yl(n),L=$.useRef(null),[F,W]=Rg({prop:y,defaultProp:v??!1,onChange:C,caller:Lw});return h.jsx(lne,{scope:n,triggerId:hm(),triggerRef:L,contentId:hm(),open:F,onOpenChange:W,onOpenToggle:$.useCallback(()=>W(X=>!X),[W]),modal:s,children:h.jsx(Wre,{...M,open:F,onOpenChange:W,dir:d,modal:s,children:a})})};CF.displayName=Lw;var AF="DropdownMenuTrigger",IF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,disabled:d=!1,...y}=i,v=EF(AF,a),C=Yl(a);return h.jsx(Hre,{asChild:!0,...C,children:h.jsx(ss.button,{type:"button",id:v.triggerId,"aria-haspopup":"menu","aria-expanded":v.open,"aria-controls":v.open?v.contentId:void 0,"data-state":v.open?"open":"closed","data-disabled":d?"":void 0,disabled:d,...y,ref:iw(n,v.triggerRef),onPointerDown:ci(i.onPointerDown,s=>{!d&&s.button===0&&s.ctrlKey===!1&&(v.onOpenToggle(),v.open||s.preventDefault())}),onKeyDown:ci(i.onKeyDown,s=>{d||(["Enter"," "].includes(s.key)&&v.onOpenToggle(),s.key==="ArrowDown"&&v.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});IF.displayName=AF;var cne="DropdownMenuPortal",PF=i=>{const{__scopeDropdownMenu:n,...a}=i,d=Yl(n);return h.jsx(Zre,{...d,...a})};PF.displayName=cne;var kF="DropdownMenuContent",NF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=EF(kF,a),v=Yl(a),C=$.useRef(!1);return h.jsx(Xre,{id:y.contentId,"aria-labelledby":y.triggerId,...v,...d,ref:n,onCloseAutoFocus:ci(i.onCloseAutoFocus,s=>{C.current||y.triggerRef.current?.focus(),C.current=!1,s.preventDefault()}),onInteractOutside:ci(i.onInteractOutside,s=>{const M=s.detail.originalEvent,L=M.button===0&&M.ctrlKey===!0,F=M.button===2||L;(!y.modal||F)&&(C.current=!0)}),style:{...i.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});NF.displayName=kF;var une="DropdownMenuGroup",dne=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(Kre,{...y,...d,ref:n})});dne.displayName=une;var hne="DropdownMenuLabel",jF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(Yre,{...y,...d,ref:n})});jF.displayName=hne;var fne="DropdownMenuItem",RF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(Qre,{...y,...d,ref:n})});RF.displayName=fne;var pne="DropdownMenuCheckboxItem",MF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(Jre,{...y,...d,ref:n})});MF.displayName=pne;var mne="DropdownMenuRadioGroup",gne=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(ene,{...y,...d,ref:n})});gne.displayName=mne;var yne="DropdownMenuRadioItem",LF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(tne,{...y,...d,ref:n})});LF.displayName=yne;var _ne="DropdownMenuItemIndicator",DF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(rne,{...y,...d,ref:n})});DF.displayName=_ne;var xne="DropdownMenuSeparator",OF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(nne,{...y,...d,ref:n})});OF.displayName=xne;var vne="DropdownMenuArrow",bne=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(ine,{...y,...d,ref:n})});bne.displayName=vne;var wne="DropdownMenuSubTrigger",zF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(sne,{...y,...d,ref:n})});zF.displayName=wne;var Sne="DropdownMenuSubContent",FF=$.forwardRef((i,n)=>{const{__scopeDropdownMenu:a,...d}=i,y=Yl(a);return h.jsx(one,{...y,...d,ref:n,style:{...i.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});FF.displayName=Sne;var Tne=CF,Ene=IF,Cne=PF,BF=NF,VF=jF,UF=RF,$F=MF,qF=LF,GF=DF,WF=OF,HF=zF,ZF=FF;const Ane=Tne,Ine=Ene,Pne=$.forwardRef(({className:i,inset:n,children:a,...d},y)=>h.jsxs(HF,{ref:y,className:Ki("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",i),...d,children:[a,h.jsx(GM,{className:"ml-auto h-4 w-4"})]}));Pne.displayName=HF.displayName;const kne=$.forwardRef(({className:i,...n},a)=>h.jsx(ZF,{ref:a,className:Ki("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...n}));kne.displayName=ZF.displayName;const XF=$.forwardRef(({className:i,sideOffset:n=4,...a},d)=>h.jsx(Cne,{children:h.jsx(BF,{ref:d,sideOffset:n,className:Ki("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...a})}));XF.displayName=BF.displayName;const KF=$.forwardRef(({className:i,inset:n,...a},d)=>h.jsx(UF,{ref:d,className:Ki("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",i),...a}));KF.displayName=UF.displayName;const YF=$.forwardRef(({className:i,children:n,checked:a,...d},y)=>h.jsxs($F,{ref:y,className:Ki("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),checked:a,...d,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(GF,{children:h.jsx(A$,{className:"h-4 w-4"})})}),n]}));YF.displayName=$F.displayName;const Nne=$.forwardRef(({className:i,children:n,...a},d)=>h.jsxs(qF,{ref:d,className:Ki("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...a,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(GF,{children:h.jsx(P$,{className:"h-2 w-2 fill-current"})})}),n]}));Nne.displayName=qF.displayName;const QF=$.forwardRef(({className:i,inset:n,...a},d)=>h.jsx(VF,{ref:d,className:Ki("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",i),...a}));QF.displayName=VF.displayName;const y2=$.forwardRef(({className:i,...n},a)=>h.jsx(WF,{ref:a,className:Ki("-mx-1 my-1 h-px bg-muted",i),...n}));y2.displayName=WF.displayName;const Dw=["Monthly rent","Hourly rate","Equipment use rate","Day rate"],f_=["Research Lab","Core Facility / Platform","CRO (Contract Research Organization)","CDMO / CMO","Clinical Site / Hospital Lab","Biobank","Testing / Certification Lab","Bioinformatics / Data","Regulatory / QA / Consulting"],JF=i=>{if(typeof i!="string")return i;const n=i.trim();if(n)return/^https?:\/\//i.test(n)?n:`https://${n}`},_2=x_({name:Wi().min(1,"Asset name is required"),url:Wi().min(1,"Asset URL is required")}),jne=_2.extend({website:qy(JF,Wi().url("Partner website must be a valid URL").optional().nullable())}),Rne=x_({name:Wi().min(1,"Name is required"),title:Wi().min(1,"Title is required"),linkedin:Wi().url("LinkedIn must be a valid URL").optional().nullable(),website:Wi().url("Website must be a valid URL").optional().nullable(),teamName:Wi().min(1).optional().nullable(),roleRank:kv().int().min(1).max(99).optional().nullable(),isLead:dm().optional().default(!1)}),Mne=x_({name:Wi().min(1,"Technique name is required"),description:Wi().min(1).max(2e3).optional().nullable()}),eB=x_({name:Wi().min(1,"Lab name is required"),labManager:qy(i=>typeof i=="string"&&i.trim()===""?null:i,Wi().min(1,"Lab manager name is required").optional().nullable()),contactEmail:qy(i=>typeof i=="string"&&i.trim()===""?null:i,Wi().email("Valid contact email is required").optional().nullable()),ownerUserId:Wi().uuid().optional().nullable(),descriptionShort:Wi().max(350).optional().nullable(),descriptionLong:Wi().max(8e3).optional().nullable(),orgRole:qy(i=>typeof i=="string"&&i.trim()===""?null:i,h0(f_).optional().nullable()),offersLabSpace:dm().default(!1),addressLine1:Wi().min(1).optional().nullable(),addressLine2:Wi().min(1).optional().nullable(),city:Wi().min(1).optional().nullable(),state:Wi().min(1).optional().nullable(),postalCode:Wi().min(1).optional().nullable(),country:Wi().min(1).optional().nullable(),siretNumber:Wi().min(4).optional().nullable(),logoUrl:Wi().url("Logo must be a valid URL").optional().nullable(),website:qy(JF,Wi().url("Website must be a valid URL").optional().nullable()),linkedin:Wi().url("LinkedIn must be a valid URL").optional().nullable(),partnerLogos:Zl(jne).default([]),compliance:Zl(Wi().min(1)).default([]),complianceDocs:Zl(_2).default([]),halStructureId:Wi().min(1).optional().nullable(),halPersonId:Wi().min(1).optional().nullable(),teamMembers:Zl(Rne).default([]),auditPassed:dm().default(!1),auditPassedAt:Wi().optional().nullable(),labStatus:h0(["listed","confirmed","verified_passive","verified_active","premier"]).default("listed"),isVisible:dm().default(!0),equipment:Zl(Wi().min(1)).default([]),priorityEquipment:Zl(Wi().min(1)).max(3).default([]),techniques:Zl(Mne).default([]),focusAreas:Zl(Wi().min(1)).default([]),offers:Zl(h0(Dw)).default([]),photos:Zl(_2).min(0),field:Wi().min(1).optional().nullable(),public:dm().optional().nullable(),alternateNames:Zl(Wi().min(1)).default([]),tags:Zl(Wi().min(1)).default([])}),Lne=eB.extend({id:kv().int().positive()});eB.partial().refine(i=>Object.keys(i).length>0,{message:"At least one field must be provided for an update"});Zl(Lne);function Dne(){const{labs:i,isLoading:n,error:a,refresh:d}=Em(),{user:y}=Ma(),[,v]=Al(),[C,s]=$.useState(""),[M,L]=$.useState([]),[F,W]=$.useState(new Set),[X,ee]=$.useState(!1),[he,se]=$.useState(!0),[oe,ve]=$.useState(null),[me,Se]=$.useState(!1),[Re,Be]=$.useState(!1),[rt,We]=$.useState([]),[Ct,Ht]=$.useState(!1),[Zt,rr]=$.useState(null),[$t,Rt]=$.useState([]),[Gt,Ar]=$.useState(null),Ut=$.useRef({searchTerm:"",selectedOrgRoles:[],favoritesOnly:!1,verifiedOnly:!0,showMap:!1}),Xt=$.useRef(0),ut=()=>Ar(null),Mt=$.useRef(new Map),Qt=pt=>(pt?.labStatus??"listed").toLowerCase(),ze=pt=>["verified_passive","verified_active","premier"].includes((pt||"").toLowerCase()),It="labs-ui-state",xr=pt=>typeof pt=="string"&&f_.includes(pt),Lr=$.useMemo(()=>i.filter(pt=>pt.isVisible!==!1),[i]),yn=Lr.length,Yr=Lr.filter(pt=>ze(pt.labStatus)).length,Zr=$.useMemo(()=>f_.filter(pt=>Lr.some(Sr=>Sr.orgRole===pt)),[Lr]),Qr=pt=>[pt.city,pt.country].filter(Boolean).join(", "),ir=pt=>pt.toLowerCase().replace(/[()/,-]/g," ").replace(/\s+/g," ").trim(),Hr=$.useMemo(()=>{const pt=new Set;return Lr.forEach(Sr=>{Sr.equipment.forEach(Dr=>pt.add(Dr.toLowerCase()))}),pt.size},[Lr]),Ur=(pt,Sr=1200)=>pt.startsWith("data:")?pt:`${pt}${pt.includes("?")?"&":"?"}auto=format&fit=crop&w=${Sr}&q=${Sr>=1600?80:75}`;$.useEffect(()=>{if(typeof window>"u")return;const pt=window.sessionStorage.getItem(It);if(pt)try{const Sr=JSON.parse(pt);if(typeof Sr.searchTerm=="string"&&s(Sr.searchTerm),Array.isArray(Sr.selectedOrgRoles)){const Dr=Sr.selectedOrgRoles.filter(xr);L(Dr)}else xr(Sr.orgRoleFilter)&&L([Sr.orgRoleFilter]);typeof Sr.favoritesOnly=="boolean"&&ee(Sr.favoritesOnly),typeof Sr.verifiedOnly=="boolean"&&se(Sr.verifiedOnly),typeof Sr.showMap=="boolean"&&Be(Sr.showMap),typeof Sr.scrollY=="number"&&requestAnimationFrame(()=>window.scrollTo(0,Sr.scrollY))}catch{}},[]),$.useEffect(()=>{Ut.current={searchTerm:C,selectedOrgRoles:M,favoritesOnly:X,verifiedOnly:he,showMap:Re}},[C,M,X,he,Re]),$.useEffect(()=>{if(typeof window>"u")return;const pt=()=>{Xt.current=window.scrollY};return window.addEventListener("scroll",pt,{passive:!0}),()=>window.removeEventListener("scroll",pt)},[]);const Ti=()=>{if(typeof window>"u")return;const pt={...Ut.current,scrollY:Xt.current};window.sessionStorage.setItem(It,JSON.stringify(pt))};$.useEffect(()=>{Ti()},[C,M,X,he,Re]),$.useEffect(()=>()=>{Ti()},[]),$.useEffect(()=>{let pt=!0;async function Sr(){if(!y){W(new Set);return}try{Se(!0);const{data:Dr}=await fn.auth.getSession(),Vr=Dr.session?.access_token;if(!Vr){W(new Set);return}const Ke=await fetch("/api/favorites",{headers:{Authorization:`Bearer ${Vr}`}});if(!Ke.ok)throw new Error("Unable to load favorites");const Je=await Ke.json();pt&&W(new Set(Je.labIds??[]))}catch(Dr){pt&&ve(Dr.message||"Unable to load favorites")}finally{pt&&Se(!1)}}return Sr(),()=>{pt=!1}},[y?.id]);const Sn=async pt=>{if(!y){ve("Sign in to favorite labs.");return}ve(null);try{const{data:Sr}=await fn.auth.getSession(),Dr=Sr.session?.access_token;if(!Dr)throw new Error("Please sign in again.");const Vr=F.has(pt),Ke=Vr?"DELETE":"POST",Je=await fetch(`/api/labs/${pt}/favorite`,{method:Ke,headers:{Authorization:`Bearer ${Dr}`}});if(!Je.ok){const jt=await Je.json().catch(()=>({}));throw new Error(jt?.message||"Unable to update favorite")}W(jt=>{const yr=new Set(jt);return Vr?yr.delete(pt):yr.add(pt),yr})}catch(Sr){ve(Sr.message||"Unable to update favorite")}},Ci=$.useMemo(()=>{const pt=C.trim().toLowerCase(),Sr=ir(pt);let Dr=pt?Lr.filter(Vr=>{const Ke=[Vr.name,...Vr.alternateNames??[],Qr(Vr),Vr.equipment.join(" "),Vr.focusAreas.join(" "),(Vr.tags??[]).join(" ")].filter(Boolean).join(" "),Je=Ke.toLowerCase(),jt=ir(Ke);return Je.includes(pt)||jt.includes(Sr)}):Lr;return M.length>0&&(Dr=Dr.filter(Vr=>Vr.orgRole?M.includes(Vr.orgRole):!1)),he&&(Dr=Dr.filter(Vr=>ze(Qt(Vr)))),X&&(Dr=Dr.filter(Vr=>F.has(Vr.id))),[...Dr].sort((Vr,Ke)=>{const Je=Qt(Vr)==="premier",jt=Qt(Ke)==="premier";return Je===jt?0:Je?-1:1})},[Lr,C,M,X,F,he]),At=M.length>0;return $.useEffect(()=>{if(!Re)return;let pt=!0;return(async()=>{Ht(!0),rr(null);const Dr=[],Vr=new Map,Ke=[];for(const Je of Ci){const jt=W0([Je.addressLine1,Je.addressLine2,Je.city,Je.state,Je.postalCode,Je.country])||Qr(Je)||"Address not set",yr=Mt.current.get(Je.id);if(yr){const Gi=`${yr.lat.toFixed(5)}|${yr.lng.toFixed(5)}`,yi=Vr.get(Gi);yi?(yi.items=yi.items??[],yi.items.push({id:Je.id,label:Je.name,subtitle:Qr(Je)||"Location not set",address:jt,href:`/labs/${Je.id}`,imageUrl:Je.logoUrl?Ur(Je.logoUrl,300):void 0})):Vr.set(Gi,{...yr,items:[{id:Je.id,label:Je.name,subtitle:Qr(Je)||"Location not set",address:jt,href:`/labs/${Je.id}`,imageUrl:Je.logoUrl?Ur(Je.logoUrl,300):void 0}]});continue}const pr=W0([Je.addressLine1,Je.addressLine2,Je.city,Je.state,Je.postalCode,Je.country]);if(!pr){Ke.push(Je.name);continue}const Jt=await Cz(pr);if(!Jt){Ke.push(Je.name);continue}const Or={id:Je.id,...Jt,label:Je.name,subtitle:Qr(Je)||"Location not set",address:jt,href:`/labs/${Je.id}`,imageUrl:Je.logoUrl?Ur(Je.logoUrl,300):void 0};Mt.current.set(Je.id,Or);const sn=`${Or.lat.toFixed(5)}|${Or.lng.toFixed(5)}`,Mn=Vr.get(sn);Mn?(Mn.items=Mn.items??[],Mn.items.push({id:Je.id,label:Je.name,subtitle:Or.subtitle,address:jt,href:Or.href,imageUrl:Or.imageUrl})):Vr.set(sn,{...Or,items:[{id:Je.id,label:Je.name,subtitle:Or.subtitle,address:jt,href:Or.href,imageUrl:Or.imageUrl}]})}Vr.forEach(Je=>{if(Je.items&&Je.items.length>1)Je.label=`${Je.items.length} labs`,Je.subtitle="Shared address",Je.imageUrl=void 0,Je.href=void 0;else if(Je.items?.length===1){const[jt]=Je.items;Je.label=jt.label,Je.subtitle=jt.subtitle,Je.imageUrl=jt.imageUrl,Je.href=jt.href}Dr.push(Je)}),pt&&(Dr.length===0&&rr("No lab locations available yet."),Ke.length>0&&console.info("[Labs map] Missing/ungeocoded labs:",Ke),We(Dr),Rt(Ke),Ht(!1))})(),()=>{pt=!1}},[Ci,Re]),$.useEffect(()=>{Re||Ar(null)},[Re]),h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-12 lg:py-16",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6},className:"max-w-3xl",children:[h.jsx("span",{className:"text-sm uppercase tracking-[0.35em] text-muted-foreground",children:"Partner Labs"}),h.jsx("h1",{className:"mt-4 text-4xl md:text-5xl font-semibold leading-tight",children:"Rent bench space inside vetted labs aligned with Glass."}),h.jsx("p",{className:"mt-4 text-lg text-muted-foreground leading-relaxed",children:"Each partner lab lists core equipment, focus areas, and compliance posture so your team can spin up work quickly with the right infrastructure in place."})]}),h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mt-10 flex flex-wrap items-start gap-4 md:gap-6",children:[h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm flex-1 min-w-[240px] max-w-sm",children:h.jsx("div",{className:"flex items-center gap-3 justify-between",children:h.jsxs("div",{children:[h.jsx("p",{className:"text-xs font-medium uppercase tracking-[0.3em] text-muted-foreground",children:"Network size"}),h.jsxs("p",{className:"mt-2 text-3xl font-semibold text-foreground",children:[yn," labs"]}),h.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Vetted partners with GLASS-Connect alignment."})]})})}),h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm flex-1 min-w-[240px] max-w-sm",children:h.jsx("div",{className:"flex items-center gap-3 justify-between",children:h.jsxs("div",{children:[h.jsx("p",{className:"text-xs font-medium uppercase tracking-[0.3em] text-muted-foreground",children:"Verified labs"}),h.jsxs("p",{className:"mt-2 text-3xl font-semibold text-foreground",children:[Yr," verified"]}),h.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Completed verification to boost trust and routing."})]})})})]}),h.jsxs("p",{className:"mt-6 text-sm text-muted-foreground",children:["Across the network you'll find ",Hr,"+ distinct pieces of specialized equipment, supporting a broad range of wet lab, fabrication, and analytics workflows."]}),h.jsxs("div",{className:"mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsxs("button",{type:"button",onClick:()=>Be(pt=>!pt),className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-medium transition ${Re?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,children:[h.jsx(Ad,{className:"h-4 w-4"}),Re?"Hide map":"Map"]}),y&&h.jsxs("button",{type:"button",onClick:()=>ee(pt=>!pt),className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-medium transition ${X?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,disabled:me,children:[h.jsx(k2,{className:"h-4 w-4"}),X?"Showing favorites":"Favorites"]})]}),h.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/70 p-1 w-fit",children:[h.jsxs("button",{type:"button",onClick:()=>se(!0),className:`inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-medium transition ${he?"bg-primary/10 text-primary":"text-muted-foreground hover:text-primary"}`,children:[h.jsx(xc,{className:"h-3.5 w-3.5"}),"GLASS verified"]}),h.jsxs("button",{type:"button",onClick:()=>se(!1),className:`inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-medium transition ${he?"text-muted-foreground hover:text-primary":"bg-primary/10 text-primary"}`,children:[h.jsx(Ux,{className:"h-3.5 w-3.5"}),"Include unverified"]})]})]}),h.jsxs("div",{className:"flex flex-col gap-2 sm:ml-auto sm:flex-row sm:items-center sm:gap-3",children:[h.jsx("div",{className:"w-full sm:w-auto",children:h.jsxs(Ane,{children:[h.jsx(Ine,{asChild:!0,children:h.jsxs("button",{type:"button",className:`inline-flex w-full items-center justify-between gap-2 rounded-full border px-4 py-2 text-sm font-medium transition sm:w-auto ${At?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,children:[h.jsxs("span",{className:"inline-flex items-center gap-2",children:[h.jsx(B$,{className:"h-4 w-4"}),"Filter"]}),At?h.jsx("span",{className:"inline-flex min-w-5 items-center justify-center rounded-full bg-primary/15 px-1.5 text-[11px] leading-5",children:M.length}):h.jsx(qM,{className:"h-4 w-4"})]})}),h.jsxs(XF,{align:"start",className:"w-80",children:[h.jsx(QF,{children:"Organization roles"}),h.jsx(y2,{}),Zr.map(pt=>h.jsx(YF,{checked:M.includes(pt),onCheckedChange:Sr=>{L(Dr=>Sr?Dr.includes(pt)?Dr:[...Dr,pt]:Dr.filter(Vr=>Vr!==pt))},onSelect:Sr=>Sr.preventDefault(),children:pt},pt)),h.jsx(y2,{}),h.jsx(KF,{onSelect:()=>L([]),disabled:M.length===0,children:"Clear filters"})]})]})}),h.jsxs("div",{className:"relative w-full sm:w-80",children:[h.jsx("input",{type:"search",value:C,onChange:pt=>s(pt.target.value),placeholder:"Search by name, city, or equipment",className:"w-full rounded-full border border-border bg-card/80 pl-10 pr-4 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx(XM,{className:"pointer-events-none absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"})]})]})]}),oe&&h.jsx("p",{className:"mt-2 text-xs text-destructive",children:oe}),Re&&h.jsxs("div",{className:"mt-6 space-y-3",children:[h.jsxs("div",{className:"relative",children:[h.jsx(Az,{markers:rt,resizeKey:Re,className:"h-[520px] w-full rounded-3xl border border-border",interactive:!0,showPopups:!1,showNavigation:!0,navigationVariant:"glass-pill",onMarkerClick:pt=>Ar(pt),onMapClick:ut}),h.jsxs("div",{className:"absolute right-4 top-4 inline-flex items-center rounded-full border border-border/70 bg-white/70 px-3 py-1 text-xs font-medium text-foreground shadow-sm backdrop-blur",children:["Showing ",Ci.length," of ",yn," labs"]}),h.jsx(dL,{mode:"wait",children:(Gt?.items?.length??0)>0&&h.jsx(Jn.div,{className:"absolute left-4 top-4 bottom-4 w-80 max-w-[calc(100%-2rem)] labs-map-overlay",initial:{opacity:0,x:-12},animate:{opacity:1,x:0},exit:{opacity:0,x:-12},transition:{duration:.25,ease:"easeOut"},children:h.jsxs("div",{className:"h-full rounded-2xl border border-white/20 bg-white/55 p-2 shadow-lg backdrop-blur-xl",children:[h.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold tracking-[0.2em] text-muted-foreground",children:[h.jsx("span",{className:"pl-1",children:"Location lab"}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsxs("span",{children:[Gt?.items?.length," labs"]}),h.jsx("button",{type:"button",onClick:ut,className:"inline-flex h-5 w-5 items-center justify-center rounded-full border border-border/70 text-[10px] text-muted-foreground hover:border-primary hover:text-primary transition","aria-label":"Close list",children:""})]})]}),h.jsx("div",{className:"mt-2 grid gap-3 overflow-y-auto pr-1 pb-1 max-h-[calc(100%-2rem)]",children:(Gt?.items??[]).map(pt=>h.jsx(xn,{href:pt.href??"#",children:h.jsxs("a",{className:"group relative block w-full max-w-[300px] h-28 overflow-hidden rounded-xl border border-white/25 bg-white/20 transition-all duration-300 ease-out backdrop-blur-2xl mx-auto hover:border-white/70 hover:scale-[1.02]",onClick:()=>{typeof window>"u"||window.sessionStorage.setItem("labs-return-target","map")},children:[h.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-r from-sky-100/90 via-white/80 to-white/90 opacity-0 transition-opacity duration-500 ease-in-out group-hover:opacity-100"}),h.jsxs("div",{className:"relative z-10 flex h-full flex-col px-3 pt-3 pb-3",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[pt.imageUrl&&h.jsx("img",{src:pt.imageUrl,alt:`${pt.label} avatar`,className:"h-11 w-11 rounded-full border border-border/60 object-cover",loading:"lazy"}),h.jsx("div",{className:"min-w-0",children:h.jsx("p",{className:"text-sm font-semibold text-foreground break-words leading-snug",children:pt.label})})]}),h.jsx("p",{className:"mt-auto text-xs text-muted-foreground leading-snug",children:pt.address||pt.subtitle||"Address not set"})]})]})},pt.id))})]})},Gt?.id??"marker")})]}),Ct&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Resolving lab locations"}),Zt&&h.jsx("p",{className:"text-xs text-muted-foreground",children:Zt}),!Ct&&!Zt&&h.jsxs("p",{className:"text-xs text-muted-foreground",children:[rt.length," mapped, ",$t.length," missing address or not found."]}),$t.length>0&&h.jsxs("div",{className:"text-xs text-muted-foreground",children:["Missing: ",$t.join(", ")]})]}),a&&h.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:[h.jsx("span",{children:a}),h.jsx("button",{type:"button",onClick:d,className:"rounded-full border border-destructive/40 px-3 py-1 text-xs font-medium uppercase tracking-[0.3em]",children:"Retry"})]}),h.jsx("div",{className:"mt-12",children:n&&i.length===0?h.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/70 p-10 text-center text-muted-foreground",children:"Loading labs"}):i.length===0?h.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/70 p-10 text-center text-muted-foreground",children:a?"We couldn't load the lab directory. Please retry.":"No partner labs are available yet. Check back soon."}):Ci.length===0?h.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/70 p-10 text-center text-muted-foreground",children:"No labs match that search. Try a different name, city, or equipment keyword."}):h.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:Ci.map((pt,Sr)=>{const Dr=Qt(pt),Vr=Dr==="premier",Ke=ze(Dr),Je=pt.auditPassed!==void 0&&pt.auditPassed!==null,jt=["true",!0,1,"1"].includes(pt.auditPassed),yr=Ke&&Je&&!jt,pr=["true","1",!0,1].includes(pt.offersLabSpace),Jt=yr?"bg-amber-50 text-amber-700":Ke?"bg-emerald-50 text-emerald-700":Dr==="confirmed"?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-700",Or=yr?"Pending":Ke?"Verified":Dr==="confirmed"?"Confirmed":"Listed";return h.jsxs(Jn.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},whileHover:{scale:1.02},transition:{duration:.5,delay:.1*(Sr%3),ease:"easeOut"},className:`group relative flex h-full flex-col rounded-3xl border overflow-hidden will-change-transform cursor-pointer ${Vr?"border-2 border-primary/80 shadow-lg":"border-border"} bg-card/80 p-8`,role:"link",tabIndex:0,onClick:sn=>{sn.target.closest("button")||v(`/labs/${pt.id}`)},onKeyDown:sn=>{sn.key!=="Enter"&&sn.key!==" "||(sn.preventDefault(),v(`/labs/${pt.id}`))},children:[h.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-sky-200/80 via-white/70 to-white/80 opacity-0 transition-opacity duration-300 ease-out group-hover:opacity-100"}),h.jsxs("div",{className:"relative z-10 flex h-full flex-col",children:[(pt.photos.length>0||!0)&&h.jsxs("div",{className:"relative mb-6 overflow-hidden rounded-2xl border border-border/60 bg-background/40",children:[h.jsx("img",{src:pt.photos.length>0?Ur(pt.photos[0].url):"/images/team-placeholder.png",alt:pt.photos.length>0?`${pt.name} preview - ${pt.photos[0].name}`:`${pt.name} placeholder`,className:`h-48 w-full object-cover ${pt.photos.length>0?"":"object-bottom"}`,loading:"lazy"}),h.jsx("span",{className:`absolute right-3 top-3 inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium ${Jt}`,children:Ke&&!yr?h.jsxs(h.Fragment,{children:[h.jsx(cw,{className:"h-3.5 w-3.5"}),Or]}):h.jsxs(h.Fragment,{children:[h.jsx(Ux,{className:"h-3.5 w-3.5"}),Or]})}),pt.logoUrl&&h.jsx("div",{className:"absolute bottom-3 left-3 h-12 w-12 overflow-hidden rounded-full bg-white text-[11px] text-muted-foreground flex items-center justify-center ring-1 ring-white/80 shadow-sm",children:pt.logoUrl?h.jsx("img",{src:pt.logoUrl,alt:`${pt.name} logo`,className:"h-full w-full object-cover"}):"Logo"})]}),h.jsxs("div",{className:"flex items-start justify-between gap-4",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("h3",{className:"text-xl font-semibold text-foreground",children:pt.name}),h.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(Ad,{className:"h-4 w-4 text-primary"}),h.jsx("span",{children:Qr(pt)||"Location not set"})]}),pt.orgRole&&h.jsx("span",{className:"mt-2 inline-flex items-center rounded-full border border-border px-2.5 py-1 text-[11px] text-muted-foreground",children:pt.orgRole})]}),h.jsxs("div",{className:"flex flex-col items-end gap-2 text-right",children:[h.jsx("button",{type:"button",onClick:()=>Sn(pt.id),className:`inline-flex h-8 w-8 items-center justify-center rounded-full border transition ${F.has(pt.id)?"border-red-500 bg-red-50 text-red-500":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,"aria-label":F.has(pt.id)?"Unfavorite lab":"Favorite lab",disabled:me,children:h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:F.has(pt.id)?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:"h-4 w-4",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21s-6.5-4.35-9-8.5C1 7.5 3.5 4 7 4c1.9 0 3.2 1.2 4 2.4C11.8 5.2 13.1 4 15 4c3.5 0 6 3.5 4 8.5-2.5 4.15-9 8.5-9 8.5Z"})})}),pr&&h.jsx("span",{className:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] font-medium bg-primary/10 text-primary",children:"Offers lab space"})]})]}),h.jsxs("div",{className:"mt-5 grid gap-4",children:[pt.focusAreas.length>0&&h.jsxs("div",{children:[h.jsx("h4",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-muted-foreground",children:"Focus"}),h.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:pt.focusAreas.slice(0,3).map(sn=>h.jsx("span",{className:"rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground",children:sn},sn))})]}),pt.equipment.length>0&&h.jsxs("div",{children:[h.jsx("h4",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-muted-foreground",children:"Equipment"}),h.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground",children:pt.equipment.slice(0,3).map(sn=>h.jsx("span",{className:"rounded-full bg-muted/60 px-3 py-1",children:sn},sn))})]}),pt.photos.length>1&&h.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:h.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border px-3 py-1",children:[h.jsx(D$,{className:"h-3.5 w-3.5 text-primary"}),pt.photos.length," photos provided"]})})]})]})]},pt.id)})})})]})})}function One(){return h.jsxs("main",{className:"container mx-auto px-4 py-10 pt-24",children:[h.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Terms of Use"}),h.jsx("p",{children:"Welcome to GLASS-Connect. By accessing or using our website, you agree to the following terms and conditions. Please read them carefully."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"1. Acceptance of Terms"}),h.jsx("p",{children:"By using Glass, you agree to comply with and be legally bound by these Terms of Use."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"2. Use of the Platform"}),h.jsx("p",{children:"Our platform is currently a read-only landing site without payment processing or user accounts. You may browse the site and access publicly available information."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"3. Intellectual Property"}),h.jsx("p",{children:"All content, logos, and trademarks on this site are the property of Glass unless otherwise stated."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"4. Contact"}),h.jsxs("p",{children:["If you have any questions, contact us at ",h.jsx("a",{href:"mailto:contact@glass-funding.com",className:"text-blue-600 underline",children:"contact@glass-funding.com"}),"."]}),h.jsx("p",{className:"mt-10 text-sm text-gray-500",children:"Last updated: July 2025"})]})}function zne(){return h.jsxs("main",{className:"container mx-auto px-4 py-10 pt-24",children:[h.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Privacy Policy"}),h.jsx("p",{children:"This Privacy Policy describes how GLASS-Connect collects and uses information through our website."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"1. Data We Collect"}),h.jsx("p",{children:"We collect information you submit through our contact form (name, email, and message). We do not use cookies or tracking technologies."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"2. Use of Information"}),h.jsx("p",{children:"Your information is used only to respond to inquiries. We do not share it with third parties unless legally required."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"3. Your Rights"}),h.jsx("p",{children:"In accordance with the GDPR, you have the right to access, correct, or delete your personal data by contacting us."}),h.jsx("h2",{className:"text-xl font-semibold mt-6 mb-2",children:"4. Contact"}),h.jsxs("p",{children:["For privacy concerns, contact ",h.jsx("a",{href:"mailto:contact@glass-funding.com",className:"text-blue-600 underline",children:"contact@glass-funding.com"}),"."]}),h.jsx("p",{className:"mt-10 text-sm text-gray-500",children:"Last updated: July 2025"})]})}function Fne(){return h.jsxs("div",{className:"px-4",children:[h.jsx("p",{className:"text-center text-lg mb-6",children:"Join our waitlist today and be among the first to access Glass. By signing up, youll receive early updates and exclusive platform news."}),h.jsx(Sw,{})]})}const Bne=[{title:"GLASS-Connect Overview",description:"A concise overview of GLASS-Connect, our mission, and how the platform helps labs share capabilities and connect with collaborators.",file:"/OnePageIntroduction.pdf"}];function Vne(){return h.jsx("div",{className:"min-h-screen bg-background",children:h.jsxs("div",{className:"container mx-auto px-4 pb-16",children:[h.jsx(Jn.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-4xl md:text-5xl font-bold text-center mb-10",children:"Glass One-Pagers"}),h.jsx(Jn.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"max-w-3xl mx-auto text-center text-muted-foreground mb-16",children:"Explore shareable one-pagers that highlight GLASS-Connect and our approach to connecting labs with collaborators."}),h.jsx("div",{className:"space-y-12",children:Bne.map((i,n)=>h.jsxs(Jn.article,{initial:{opacity:0,y:24},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{duration:.6,delay:n*.1},className:"bg-card border rounded-2xl shadow-sm overflow-hidden",children:[h.jsxs("div",{className:"p-8 space-y-4",children:[h.jsx("h2",{className:"text-2xl md:text-3xl font-semibold",children:i.title}),h.jsx("p",{className:"text-muted-foreground text-lg",children:i.description}),h.jsxs("div",{className:"flex flex-wrap gap-3",children:[h.jsx("a",{href:i.file,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center rounded-full bg-primary px-6 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90",children:"View PDF"}),h.jsx("a",{href:i.file,download:!0,className:"inline-flex items-center justify-center rounded-full border border-input px-6 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground",children:"Download"})]})]}),h.jsx("div",{className:"border-t border-border bg-muted/40",children:h.jsx("object",{data:i.file,type:"application/pdf",className:"hidden w-full md:block lg:h-[720px] md:h-[640px]",children:h.jsxs("p",{className:"p-6 text-muted-foreground",children:["Your browser is unable to display the PDF. You can still"," ",h.jsx("a",{href:i.file,target:"_blank",rel:"noopener noreferrer",className:"underline",children:"open the document in a new tab"})," ","or download it for offline viewing."]})})})]},i.title))})]})})}const Une=[{title:"Phase 0  Foundation",copy:"Build the core GLASS-Connect directory with structured lab profiles, capability tags, and ownership so every listing stays accurate."},{title:"Phase 1  Verified Profiles",copy:"Launch remote/on-site verification, richer filtering (methods, equipment, availability), and clearer contact preferences for each lab."},{title:"Phase 2  Requests & Routing",copy:"Add scoped request forms, calendar-aware introductions, and response SLAs so collaborators hear back quickly from the right contact."},{title:"Phase 3  Integrations & API",copy:"Ship export/API access for operators, light CRM hooks, and data freshness signals so networks can keep many labs current with less effort."}],$ne=[{title:"Network search",copy:"Tagging, filtering, and sorting improvements for labs across institutions and partners."},{title:"Profile polish",copy:"Cleaner capability blocks, equipment highlights, and collaboration preferences visible at a glance."},{title:"Verified badge",copy:"Remote verification pilot to improve trust and reduce back-and-forth for partners."}];function qne(){return h.jsx("div",{className:"min-h-screen bg-background pb-32",children:h.jsxs("div",{className:"container mx-auto px-4",children:[h.jsxs("div",{className:"max-w-3xl",children:[h.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Product Roadmap"}),h.jsx("p",{className:"text-lg text-muted-foreground",children:"Were building GLASS-Connect to make lab discovery and collaboration straightforward. Below is the current plan and whats already shipped to turn GLASS-Connect into the trusted hub for listing, verifying, and connecting labs."})]}),h.jsxs("div",{className:"mt-16 grid grid-cols-1 gap-12 lg:grid-cols-[minmax(0,_1.1fr)_minmax(0,_0.9fr)] lg:items-start",children:[h.jsxs("div",{className:"bg-card border border-border rounded-3xl shadow-sm p-8 lg:p-10 h-full",children:[h.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Roadmap Overview"}),h.jsx("div",{className:"space-y-10 text-muted-foreground leading-relaxed",children:Une.map(i=>h.jsxs("div",{children:[h.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:i.title}),h.jsx("p",{children:i.copy})]},i.title))}),h.jsxs("div",{className:"mt-10 border-t border-border pt-8",children:[h.jsx("h3",{className:"text-2xl font-semibold mb-4 text-foreground",children:"Our Long-Term Vision"}),h.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"GLASS-Connect aims to become the trusted bridge between labs and collaboratorsone place to find verified capabilities, contact real humans, and keep network data current without heavy tooling."})]})]}),h.jsxs("div",{className:"bg-card/80 border border-border rounded-3xl shadow-sm p-8",children:[h.jsx("h2",{className:"text-xl font-semibold mb-4 text-foreground",children:"Recent progress"}),h.jsx("div",{className:"space-y-4 text-muted-foreground",children:$ne.map(i=>h.jsxs("div",{className:"rounded-2xl border border-border/70 bg-background p-4",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:i.title}),h.jsx("p",{className:"mt-2 text-sm leading-relaxed",children:i.copy})]},i.title))})]})]}),h.jsx("div",{className:"h-24"})]})})}const OR=[{id:"glass-web",name:"GLASS-Connect Directory",status:"Operational",uptime:"99.98%",lastIncident:"45 days ago",description:"Main lab-listing and discovery experience for labs and partners."},{id:"profiles",name:"Profile Edits",status:"Operational",uptime:"100%",lastIncident:"92 days ago",description:"Saving and publishing lab profile updates across the network."},{id:"routing",name:"Request Routing",status:"Degraded Performance",uptime:"99.2%",lastIncident:"Today",description:"Email and in-app handoffs for inbound collaboration requests.",note:"Delays of up to 2 hours while we upgrade the messaging queue."},{id:"workspace",name:"Operator Workspace",status:"Operational",uptime:"99.9%",lastIncident:"18 days ago",description:"Multi-lab management dashboards for network operators and admins."}],Gne=[{date:"Today",severity:"minor",title:"Request routing queue delays",description:"Messages are sending successfully but slower than usual while we deploy enhanced analytics. We expect normal operation by 18:00 UTC."},{date:"May 5",severity:"maintenance",title:"Planned maintenance: Workspace exports",description:"Completed scheduled maintenance from 01:0003:00 UTC. Data exports were unavailable during this window."},{date:"Apr 17",severity:"resolved",title:"Resolved: Profile webhook retries",description:"Some partners experienced delayed webhook confirmations. The backlog was cleared within 30 minutes and no updates were lost."}];function zR(i){return i.toLowerCase().includes("degraded")?"text-amber-500":i.toLowerCase().includes("maintenance")?"text-blue-500":i.toLowerCase().includes("operational")?"text-emerald-500":"text-muted-foreground"}function Wne(i){return i==="minor"?h.jsx(j2,{className:"h-4 w-4 text-amber-500"}):i==="maintenance"?h.jsx(k$,{className:"h-4 w-4 text-blue-500"}):h.jsx(WM,{className:"h-4 w-4 text-emerald-500"})}function Hne(){const i=OR.every(n=>!n.status.toLowerCase().includes("degraded"));return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 pb-20",children:[h.jsxs("div",{className:"max-w-4xl",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"System status"}),h.jsx("h1",{className:"mt-5 text-4xl font-semibold text-foreground",children:i?"All systems are operational.":"Some services are experiencing delays."}),h.jsxs("p",{className:"mt-4 text-lg text-muted-foreground leading-relaxed",children:["This page reports live availability across GLASS-Connect infrastructure. We refresh these metrics every 60 seconds. For urgent issues, reach the team at"," ",h.jsx("a",{className:"text-primary hover:text-primary/80 transition",href:"mailto:support@glass.demo",children:"support@glass.demo"}),"."]})]}),h.jsx("div",{className:"mt-10 grid gap-6",children:OR.map(n=>h.jsx("div",{className:"rounded-3xl border border-border bg-card/90 p-6 shadow-sm",children:h.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[h.jsxs("div",{children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(vT,{className:`h-4 w-4 ${zR(n.status)}`}),h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:n.name})]}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:n.description}),n.note?h.jsx("p",{className:"mt-2 rounded-2xl border border-amber-300/50 bg-amber-100/20 px-3 py-2 text-xs text-amber-700",children:n.note}):null]}),h.jsxs("div",{className:"grid gap-1 text-right text-sm text-muted-foreground",children:[h.jsx("span",{className:`font-semibold ${zR(n.status)}`,children:n.status}),h.jsxs("span",{children:["30-day uptime: ",n.uptime]}),h.jsxs("span",{children:["Last incident: ",n.lastIncident]})]})]})},n.id))}),h.jsxs("div",{className:"mt-12",children:[h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Recent updates"}),h.jsx("div",{className:"mt-4 space-y-4",children:Gne.map(n=>h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-5 shadow-sm",children:[h.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-[0.25em] text-muted-foreground",children:[Wne(n.severity),h.jsx("span",{children:n.date})]}),h.jsx("p",{className:"text-sm font-medium text-muted-foreground md:text-right",children:n.severity==="maintenance"?"Scheduled maintenance":n.severity==="minor"?"Minor":"Resolved"})]}),h.jsx("h3",{className:"mt-3 text-lg font-semibold text-foreground",children:n.title}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground leading-relaxed",children:n.description})]},n.date+n.title))})]}),h.jsxs("div",{className:"mt-12 rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground shadow-sm",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Need more detail?"}),h.jsxs("p",{className:"mt-2",children:["Follow"," ",h.jsx(xn,{href:"/roadmap",children:h.jsx("a",{className:"text-primary hover:text-primary/80 transition",children:"our public roadmap"})})," ","for transparency on upcoming releases, or reach out to"," ",h.jsx("a",{className:"text-primary hover:text-primary/80 transition",href:"mailto:ops@glass.demo",children:"ops@glass.demo"})," ","for enterprise status reports."]})]})]})})}function Zne(){return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 pb-20 flex flex-col items-center text-center",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"500 error"}),h.jsx(j2,{className:"mt-6 h-12 w-12 text-amber-500"}),h.jsx("h1",{className:"mt-4 text-4xl md:text-5xl font-semibold text-foreground max-w-3xl",children:"Something went wrong on our side."}),h.jsx("p",{className:"mt-4 max-w-2xl text-lg text-muted-foreground leading-relaxed",children:"We're already looking into it. Refresh the page to try again, or head back to a safe spot while we resolve the issue."}),h.jsxs("div",{className:"mt-10 flex flex-col gap-3 sm:flex-row",children:[h.jsx("button",{type:"button",onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Retry"}),h.jsx(xn,{href:"/status",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full border border-border bg-background px-5 py-2 text-sm font-medium text-foreground hover:text-primary transition",children:"View system status"})})]}),h.jsxs("p",{className:"mt-8 text-sm text-muted-foreground",children:["If the problem continues, email"," ",h.jsx("a",{className:"text-primary hover:text-primary/80 transition",href:"mailto:support@glass.org",children:"support@glass.org"})," ","with a screenshot and we'll help out."]})]})})}function Xne(){return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 pb-20 flex flex-col items-center text-center",children:[h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Scheduled maintenance"}),h.jsx(U$,{className:"mt-6 h-12 w-12 text-primary"}),h.jsx("h1",{className:"mt-4 text-4xl md:text-5xl font-semibold text-foreground max-w-3xl",children:"We're upgrading our systems to serve you better."}),h.jsxs("p",{className:"mt-4 max-w-2xl text-lg text-muted-foreground leading-relaxed",children:["The Glass platform is temporarily unavailable while we roll out new improvements. We expect to be back online by"," ",h.jsx("span",{className:"font-semibold text-foreground",children:"18:00 UTC"}),". Your data and ongoing donations are safe."]}),h.jsxs("div",{className:"mt-10 flex flex-col gap-3 sm:flex-row",children:[h.jsx(xn,{href:"/status",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",children:"Track system status"})}),h.jsx("a",{href:"mailto:support@glass.org",className:"inline-flex items-center justify-center rounded-full border border-border bg-background px-5 py-2 text-sm font-medium text-foreground hover:text-primary transition",children:"Contact support"})]}),h.jsxs("p",{className:"mt-8 text-sm text-muted-foreground",children:["Need an update for your team? We'll share real-time notices on"," ",h.jsx("a",{className:"text-primary hover:text-primary/80 transition",href:"https://status.glass.org",children:"status.glass.org"}),"."]})]})})}const FR="glass-consent",BR=1,tB=$.createContext(null);function Kne({children:i}){const[n,a]=$.useState(null),[d,y]=$.useState(!1),[v,C]=$.useState(!1);$.useEffect(()=>{try{const X=localStorage.getItem(FR);if(X){const ee=JSON.parse(X);ee?.version===BR&&a(ee)}}catch{}finally{C(!0)}},[]);const s=X=>{const ee={...X,version:BR,updatedAt:new Date().toISOString()};a(ee);try{localStorage.setItem(FR,JSON.stringify(ee))}catch{}},M=()=>{s({functional:!0,analytics:!0}),y(!1)},L=()=>{s({functional:!1,analytics:!1}),y(!1)},F=X=>{s(X),y(!1)},W=$.useMemo(()=>({consent:n,hasFunctionalConsent:!!n?.functional,hasAnalyticsConsent:!!n?.analytics,needsConsent:v&&!n,showPreferences:d,openPreferences:()=>y(!0),closePreferences:()=>y(!1),acceptAll:M,declineAll:L,savePreferences:F}),[n,v,d]);return h.jsx(tB.Provider,{value:W,children:i})}function w_(){const i=$.useContext(tB);if(!i)throw new Error("useConsent must be used within a ConsentProvider.");return i}let Yne=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((n,a)=>(a&=63,a<36?n+=a.toString(36):a<62?n+=(a-26).toString(36).toUpperCase():a>62?n+="-":n+="_",n),"");function Qne({params:i}){const{labs:n,isLoading:a}=Em(),{user:d}=Ma(),{hasAnalyticsConsent:y}=w_(),v=n.find(ot=>ot.id===Number(i.id)),C=v?.id,[s,M]=$.useState("Back to labs"),[L,F]=$.useState(!1),[W,X]=$.useState(!1),[ee,he]=$.useState(!1),[se,oe]=$.useState(!1);$.useEffect(()=>{let ot=!0;async function br(){if(!d){F(!1),X(!1),he(!1),oe(!1);return}const{data:pn,error:Vn}=await fn.from("profiles").select("*").eq("user_id",d.id).maybeSingle();if(!ot)return;if(Vn){F(!1),X(!1),he(!1),oe(!1);return}const $n=!!pn?.is_admin,jo=!!pn?.can_create_lab,Il=!!pn?.can_manage_multiple_labs,eu=!!pn?.can_broker_requests;F($n||jo||Il),X($n),he(Il),oe(eu)}return br(),()=>{ot=!1}},[d?.id]);const[ve,me]=$.useState(!1),[Se,Re]=$.useState(!1),[Be,rt]=$.useState(null),[We,Ct]=$.useState(!1),[Ht,Zt]=$.useState(!1),[rr,$t]=$.useState("publications"),[Rt,Gt]=$.useState(!1),[Ar,Ut]=$.useState(!1),[Xt,ut]=$.useState(null),[Mt,Qt]=$.useState(!1),[ze,It]=$.useState(null);$.useEffect(()=>{if(typeof window>"u")return;const ot="labs-return-target";window.sessionStorage.getItem(ot)==="map"&&M("Back to maps"),window.sessionStorage.removeItem(ot)},[]);const[xr,Lr]=$.useState(!1),[yn,Yr]=$.useState(null),[Zr,Qr]=$.useState([]),[ir,Hr]=$.useState(!1),[Ur,Ti]=$.useState(null);$.useEffect(()=>{if(!v)return;let ot=!0;return(async()=>{Lr(!0),Yr(null);const pn=W0([v.addressLine1,v.addressLine2,v.city,v.state,v.postalCode,v.country]);if(!pn){It(null),Yr("No address on file for this lab."),Lr(!1);return}const Vn=await Cz(pn);if(ot){if(!Vn){It(null),Yr("Unable to locate this address."),Lr(!1);return}It({id:v.id,...Vn,label:v.name}),Lr(!1)}})(),()=>{ot=!1}},[v]);const[Sn,Ci]=$.useState(!1),[At,pt]=$.useState(!1),[Sr,Dr]=$.useState(""),[Vr,Ke]=$.useState(d?.email||""),[Je,jt]=$.useState(""),[yr,pr]=$.useState(""),[Jt,Or]=$.useState(""),[sn,Mn]=$.useState(!1),[Gi,yi]=$.useState(null),[vt,or]=$.useState(null),[dn,Ln]=$.useState(!1),[Bn,Ze]=$.useState(!1),[ur,kr]=$.useState(null),[An,ki]=$.useState(null),[Yn,Ri]=$.useState({requesterName:"",requesterEmail:d?.email||"",organization:"",roleTitle:"",projectSummary:"",workTimeline:"",weeklyHoursNeeded:"",teamSize:"",equipmentNeeds:"",complianceNotes:"",specialRequirements:"",referencesOrLinks:"",preferredContactMethods:["email"]}),[ui,_i]=$.useState(!1),[Ds,oo]=$.useState(!1),[Is,ao]=$.useState(null),[No,Nt]=$.useState(null),[us,ks]=$.useState({contactName:"",contactEmail:d?.email||"",targetLabs:v?.name||"",collaborationFocus:"",resourcesOffered:"",desiredTimeline:"",additionalNotes:"",preferredContact:"email"}),[fo,vn]=$.useState([]),[$e,ne]=$.useState(!1),[ce,be]=$.useState(null);$.useEffect(()=>{d?.email&&(Ke(ot=>ot||d.email),Ri(ot=>ot.requesterEmail?ot:{...ot,requesterEmail:d.email}),ks(ot=>ot.contactEmail?ot:{...ot,contactEmail:d.email}))},[d?.email]),$.useEffect(()=>{v?.name&&ks(ot=>ot.targetLabs?ot:{...ot,targetLabs:v.name})},[v?.name]),$.useEffect(()=>{if(!C)return;let ot=!0;async function br(){ne(!0);try{const pn=await fetch(`/api/labs/${C}/teams`);if(!pn.ok){const $n=await pn.json().catch(()=>({}));throw new Error($n?.message||"Unable to load teams")}const Vn=await pn.json();ot&&(vn(Vn??[]),be(null))}catch(pn){ot&&be(pn instanceof Error?pn.message:"Unable to load teams")}finally{ot&&ne(!1)}}return br(),()=>{ot=!1}},[C]);const De=async()=>{if(!d){rt("Sign in to favorite labs.");return}Re(!0),rt(null);try{const{data:ot}=await fn.auth.getSession(),br=ot.session?.access_token;if(!br){rt("Please sign in again.");return}const pn=ve?"DELETE":"POST",Vn=await fetch(`/api/labs/${v.id}/favorite`,{method:pn,headers:{Authorization:`Bearer ${br}`}});if(!Vn.ok){const jo=await Vn.json().catch(()=>({}));throw new Error(jo?.message||"Unable to update favorite")}const $n=await Vn.json();me(!!$n?.favorited)}catch(ot){rt(ot instanceof Error?ot.message:"Unable to update favorite")}finally{Re(!1)}};if($.useEffect(()=>{let ot=!0;async function br(){if(!d||!C){me(!1);return}try{const{data:pn}=await fn.auth.getSession(),Vn=pn.session?.access_token;if(!Vn)return;const $n=await fetch(`/api/labs/${C}/favorite`,{headers:{Authorization:`Bearer ${Vn}`}});if(!$n.ok)return;const jo=await $n.json();ot&&me(!!jo?.favorited)}catch{}}return br(),()=>{ot=!1}},[C,d?.id]),$.useEffect(()=>{if(!Ht||!C)return;let ot=!0;Hr(!0),Ti(null);const br=rr==="patents"?`/api/labs/${C}/hal-patents`:`/api/labs/${C}/hal-publications`;return fetch(br).then(async pn=>{if(!pn.ok){const Vn=await pn.text();throw new Error(Vn||`Unable to load ${rr}`)}return pn.json()}).then(pn=>{ot&&Qr(pn?.items??[])}).catch(pn=>{ot&&Ti(pn instanceof Error?pn.message:`Unable to load ${rr}`)}).finally(()=>{ot&&Hr(!1)}),()=>{ot=!1}},[Ht,rr,C]),$.useEffect(()=>{if(!y||Sn||!C)return;const ot="glass-view-session";let br=localStorage.getItem(ot);br||(br=Yne(),localStorage.setItem(ot,br));const pn=`glass-view-${C}`,Vn=localStorage.getItem(pn),$n=Date.now();if(Vn&&$n-Number(Vn)<3600*1e3){Ci(!0);return}(async()=>{try{const{data:jo}=await fn.auth.getSession(),Il=jo.session?.access_token;await fetch(`/api/labs/${C}/view`,{method:"POST",headers:{"Content-Type":"application/json",...Il?{Authorization:`Bearer ${Il}`}:{}},body:JSON.stringify({labId:C,sessionId:br,referrer:document.referrer||null})}),localStorage.setItem(pn,String($n)),Ci(!0)}catch{}})()},[C,Sn,y]),a&&!v)return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 py-12",children:h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-8 text-muted-foreground",children:"Loading lab"})})});if(!v)return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 py-12",children:h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-8 text-muted-foreground",children:"Lab not found."})})});const Ee=(ot,br=1600)=>ot.startsWith("data:")?ot:`${ot}${ot.includes("?")?"&":"?"}auto=format&fit=crop&w=${br}&q=80`,Fe=(v.labStatus||"listed").toLowerCase(),et=Fe==="premier",qe=["verified_passive","verified_active","premier"].includes(Fe),fe=v?.logoUrl??v?.logo_url??null,Ve=et?"premier":qe?"verified":Fe,Xe=qe,ct=v.offersLabSpace===!0||v.offersLabSpace==="true"||v.offersLabSpace===1||v.offersLabSpace==="1",tr=(()=>{const ot=new Map;for(const br of v.teamMembers){const pn=br.teamName?.trim()||"Team",Vn=ot.get(pn)??[];Vn.push(br),ot.set(pn,Vn)}return Array.from(ot.entries()).sort(([br],[pn])=>br==="Team"?1:pn==="Team"?-1:br.localeCompare(pn))})(),cr=Ve==="verified"||Ve==="premier"?"bg-emerald-50 text-emerald-700":Ve==="confirmed"?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-700",Nr=Ve==="premier"?"Premier":Ve==="verified"?"Verified":Ve==="confirmed"?"Confirmed":"Added by GLASS",Ir="Profile details compiled by GLASS from publicly available sources.",jr="contact@glass-funding.com",Rr=Ve==="listed",ni=typeof v.contactEmail=="string"?v.contactEmail.trim().toLowerCase():"",$i=typeof d?.email=="string"?d.email.trim().toLowerCase():"",gn=!(!!d?.id&&!!v.ownerUserId&&v.ownerUserId===d?.id||!!ni&&!!$i&&ni===$i)&&(L||se),Ni=v.partnerLogos??[],In=v.techniques??[],di=v.equipment??[],Oi=v.priorityEquipment??[],js=Oi.length>0?Oi:di.slice(0,3),bs=new Set(js),Qi=di.filter(ot=>!bs.has(ot)),po=v.website||null,Hi=v.linkedin||null,ws=W0([v.addressLine1,v.addressLine2,v.city,v.state,v.postalCode,v.country]),ra=async()=>{if(!Yn.requesterName.trim()||!Yn.requesterEmail.trim()||!Yn.projectSummary.trim()){kr("Name, email, and project summary are required.");return}if(!Yn.organization.trim()||!Yn.roleTitle.trim()){kr("Organization and role/title are required.");return}if(!Yn.workTimeline.trim()||!Yn.weeklyHoursNeeded.trim()||!Yn.teamSize.trim()){kr("Timeline, weekly hours, and team size are required.");return}if(Yn.projectSummary.trim().length<50){kr("Project summary must be at least 50 characters.");return}if(Yn.projectSummary.trim().length>1e3){kr("Project summary must be under 1000 characters.");return}if(!Yn.preferredContactMethods.length){kr("Select at least one preferred contact method.");return}Ze(!0),kr(null),ki(null);try{const ot=await fetch("/api/lab-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...Yn,labId:v.id,labName:v.name})});if(!ot.ok){const br=await ot.text();throw new Error(br||"Unable to submit request")}ki("Sent! The lab and our team have been notified."),Ri(br=>({...br,requesterName:"",requesterEmail:d?.email||"",organization:"",roleTitle:"",projectSummary:"",workTimeline:"",weeklyHoursNeeded:"",teamSize:"",equipmentNeeds:"",complianceNotes:"",specialRequirements:"",referencesOrLinks:"",preferredContactMethods:["email"]})),Ln(!1)}catch(ot){kr(ot?.message||"Unable to submit request")}finally{Ze(!1)}},Uo=async()=>{if(!us.contactName.trim()||!us.contactEmail.trim()||!us.collaborationFocus.trim()){ao("Name, email, and collaboration focus are required.");return}oo(!0),ao(null),Nt(null);try{const ot=await fetch("/api/lab-collaborations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...us,labId:v.id,targetLabs:us.targetLabs||v.name})});if(!ot.ok){const br=await ot.text();throw new Error(br||"Unable to submit collaboration")}Nt("Sent! We'll notify the lab team."),ks({contactName:"",contactEmail:d?.email||"",targetLabs:v.name,collaborationFocus:"",resourcesOffered:"",desiredTimeline:"",additionalNotes:"",preferredContact:"email"}),_i(!1)}catch(ot){ao(ot?.message||"Unable to submit collaboration")}finally{oo(!1)}},lo=async()=>{if(!Sr.trim()||!Vr.trim()||!Jt.trim()){yi("Please add your name, email, and a brief message.");return}Mn(!0),yi(null),or(null);try{const ot=await fetch(`/api/labs/${v.id}/investor`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Sr.trim(),email:Vr.trim(),company:Je.trim()||null,website:yr.trim()||null,message:Jt.trim()})});if(!ot.ok){const br=await ot.text();throw new Error(br||"Unable to send inquiry")}or("Sent! The lab has been notified."),Dr(""),Ke(d?.email||""),jt(""),pr(""),Or(""),pt(!1)}catch(ot){yi(ot?.message||"Unable to send inquiry")}finally{Mn(!1)}};return a&&n.length===0?h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 max-w-3xl text-center space-y-6",children:[h.jsx("h1",{className:"text-4xl font-semibold text-foreground",children:"Loading lab details"}),h.jsx("p",{className:"text-muted-foreground",children:"Pulling the latest information from the lab directory."})]})}):v?h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-12 lg:py-16 max-w-5xl",children:[h.jsxs(xn,{href:"/labs",className:"inline-flex items-center gap-2 text-sm text-muted-foreground transition hover:text-primary",children:[h.jsx(n_,{className:"h-4 w-4"}),s]}),h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6},className:"mt-8 rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-10",children:[h.jsxs("header",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary",children:[h.jsx(Ad,{className:"h-3.5 w-3.5"}),[v.city,v.country].filter(Boolean).join(", ")||"Location not set"]}),v.orgRole&&h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground",children:v.orgRole}),h.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium ${cr}`,title:Rr?Ir:void 0,children:Ve==="verified"?h.jsxs(h.Fragment,{children:[h.jsx(cw,{className:"h-3.5 w-3.5"}),Nr]}):h.jsxs(h.Fragment,{children:[h.jsx(Ux,{className:"h-3.5 w-3.5"}),Nr]})}),ct&&h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground",children:[h.jsx(O$,{className:"h-3.5 w-3.5 text-primary"}),"Offers lab space"]}),h.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[Rr&&h.jsx("button",{type:"button",onClick:()=>Qt(ot=>!ot),className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-1.5 text-xs font-medium text-foreground transition hover:border-primary hover:text-primary",children:"Claim this lab"}),h.jsx("button",{type:"button",onClick:De,disabled:Se,className:`inline-flex h-8 w-8 items-center justify-center rounded-full border transition disabled:opacity-60 disabled:cursor-not-allowed ${ve?"border-red-500 bg-red-50 text-red-500":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,"aria-label":ve?"Unfavorite lab":"Favorite lab",children:h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:ve?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:"h-4 w-4",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21s-6.5-4.35-9-8.5C1 7.5 3.5 4 7 4c1.9 0 3.2 1.2 4 2.4C11.8 5.2 13.1 4 15 4c3.5 0 6 3.5 4 8.5-2.5 4.15-9 8.5-9 8.5Z"})})})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[(fe||et)&&h.jsx("div",{className:"h-12 w-12 overflow-hidden rounded-full border border-dashed border-border bg-muted/30 text-[11px] text-muted-foreground flex items-center justify-center flex-shrink-0",children:fe?h.jsx("img",{src:fe,alt:`${v.name} logo`,className:"h-full w-full object-cover"}):"Logo"}),h.jsx("h1",{className:"text-4xl font-semibold text-foreground",children:v.name})]}),v.descriptionShort?h.jsx("p",{className:"text-muted-foreground text-base leading-relaxed text-justify",children:v.descriptionShort}):h.jsx("p",{className:"text-muted-foreground text-base leading-relaxed",children:"Review compliance, offers, and baseline expectations before requesting space."}),Rr&&Mt&&h.jsxs("div",{className:"rounded-2xl border border-border bg-muted/30 px-4 py-3 text-sm text-muted-foreground",children:["To claim this lab, email"," ",h.jsx("a",{className:"text-primary underline",href:`mailto:${jr}`,children:jr})," ","and tell us youd like to claim the listing."]}),Be&&h.jsx("span",{className:"text-xs text-destructive",children:Be})]}),v.photos.length>0&&h.jsx("div",{className:"mt-2 overflow-x-auto pb-2",children:h.jsx("div",{className:"flex gap-4 min-w-full",children:v.photos.map((ot,br)=>{const pn=`${v.name} photo ${br+1} - ${ot.name}`;return h.jsx("button",{type:"button",onClick:()=>ut({index:br}),className:"min-w-[320px] max-w-[420px] h-64 overflow-hidden rounded-3xl border border-border/80 bg-background/40 flex-shrink-0 cursor-zoom-in","aria-label":`Open ${pn}`,children:h.jsx("img",{src:Ee(ot.url,1200),alt:pn,className:"h-full w-full object-cover",loading:br===0?"eager":"lazy"})},ot.url)})})}),h.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[h.jsxs("div",{className:"rounded-2xl border border-border/80 bg-background/50 p-6 space-y-3",children:[h.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.25em] text-muted-foreground",children:"Lab leadership"}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(fm,{className:"h-4 w-4 text-primary"}),v.labManager]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(YM,{className:"h-4 w-4 text-primary"}),po||Hi?"Connect with the team":"Social links not provided yet"]}),(po||Hi)&&h.jsxs("div",{className:"flex flex-wrap gap-2",children:[po&&h.jsxs("a",{href:po,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground transition hover:border-primary hover:text-primary",children:[h.jsx(R$,{className:"h-3.5 w-3.5 text-primary"}),"Website"]}),Hi&&h.jsxs("a",{href:Hi,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground transition hover:border-primary hover:text-primary",children:[h.jsx(N2,{className:"h-3.5 w-3.5 text-primary"}),"LinkedIn"]})]})]}),h.jsxs("div",{className:"rounded-2xl border border-border/80 bg-background/50 p-6 space-y-3 md:col-span-2",children:[h.jsx("span",{className:"text-xs font-semibold uppercase tracking-[0.25em] text-muted-foreground",children:"Focus areas"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Primary scientific domains supported by the lab team."}),h.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-muted-foreground",children:v.focusAreas.map(ot=>h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1",children:ot},ot))})]})]}),v.descriptionLong&&h.jsxs("div",{className:"mt-6 rounded-2xl border border-border/80 bg-background/50 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"About this lab"}),h.jsx("p",{className:"mt-3 text-sm text-muted-foreground leading-relaxed text-justify whitespace-pre-line",children:v.descriptionLong})]}),ct&&h.jsxs("section",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Pricing & availability offers"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Labs may extend multiple engagement models; choose the approach that best matches your run plan."}),h.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:v.offers.map(ot=>h.jsx("span",{className:"rounded-full bg-muted/60 px-3 py-1 text-xs font-medium text-muted-foreground",children:ot},ot))})]}),h.jsxs("section",{className:"grid gap-6 lg:grid-cols-2",children:[h.jsxs("div",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Compliance posture"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Compliance certifications and baseline expectations for this lab."}),h.jsx("div",{className:"mt-4 flex flex-wrap gap-2 text-sm text-muted-foreground",children:v.compliance.map(ot=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1",children:[h.jsx(xc,{className:"h-3.5 w-3.5 text-primary"}),ot]},ot))}),v.complianceDocs.length>0&&h.jsxs("div",{className:"mt-4 space-y-2",children:[h.jsx("h4",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-muted-foreground",children:"Supporting documents"}),h.jsx("ul",{className:"space-y-2 text-sm text-muted-foreground",children:v.complianceDocs.map(ot=>h.jsx("li",{children:h.jsxs("a",{href:ot.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 hover:border-primary hover:text-primary transition",children:[h.jsx(xc,{className:"h-3.5 w-3.5 text-primary"}),ot.name]})},ot.url))})]})]}),h.jsxs("div",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Equipment inventory"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Priority equipment is highlighted first, followed by the full list."}),h.jsx("div",{className:"mt-4 grid gap-2 text-sm text-muted-foreground",children:js.map(ot=>h.jsxs("div",{className:"inline-flex items-center gap-2",children:[h.jsx(Bx,{className:"h-4 w-4 text-primary"}),h.jsx("span",{className:"font-semibold text-primary",children:ot})]},ot))}),h.jsxs("div",{className:"mt-4 grid gap-2 text-sm text-muted-foreground",children:[(We?Qi:Qi.slice(0,6)).map(ot=>h.jsxs("div",{className:"inline-flex items-center gap-2",children:[h.jsx(Bx,{className:"h-4 w-4 text-primary"}),ot]},ot)),di.length===0&&h.jsx("span",{children:"No equipment listed yet."})]}),Qi.length>6&&h.jsx("button",{type:"button",onClick:()=>Ct(ot=>!ot),className:"mt-4 inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:We?"Show fewer":`Show ${Qi.length-6} more`})]})]}),h.jsxs("section",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Techniques & expertise"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Detailed methods and domains where this lab specializes."}),h.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[In.map(ot=>h.jsxs("div",{className:"rounded-2xl border border-border px-4 py-3",children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:ot.name}),ot.description&&h.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:ot.description})]},ot.name)),In.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"No techniques listed yet."})]})]}),v.teamMembers.length>0&&h.jsx("section",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Team members"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Meet the people leading the lab."})]}),h.jsxs("button",{type:"button",onClick:()=>Gt(!0),className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:["View team",h.jsx(Sl,{className:"h-4 w-4"})]})]})}),fo.length>0&&h.jsxs("section",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Research teams"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Teams linked to this lab and their scientific focus."})]}),h.jsxs("button",{type:"button",onClick:()=>Ut(!0),className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:["View teams",h.jsx(Sl,{className:"h-4 w-4"})]})]}),h.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[fo.slice(0,3).map(ot=>h.jsx("span",{className:"inline-flex items-center rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:ot.name},ot.id)),fo.length>3&&h.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",fo.length-3," more"]})]})]}),ce&&h.jsx("p",{className:"text-sm text-destructive",children:ce}),(v.halStructureId||v.halPersonId)&&h.jsx("section",{className:"rounded-2xl border border-border/80 bg-background/50 p-6",children:h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Publications & patents"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"View the lab's publications and patents from HAL."})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsxs("button",{type:"button",onClick:()=>{$t("publications"),Zt(!0)},className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:["View publications",h.jsx(Sl,{className:"h-4 w-4"})]}),h.jsxs("button",{type:"button",onClick:()=>{$t("patents"),Zt(!0)},className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:["View patents",h.jsx(Sl,{className:"h-4 w-4"})]})]})]})}),Ni.length>0&&(et||W||ee&&v.ownerUserId&&v.ownerUserId===d?.id)&&h.jsxs("div",{className:"mt-8 rounded-2xl border border-primary/40 bg-primary/5 p-4",children:[h.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Featured partners"}),h.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:Ni.map((ot,br)=>{const pn=h.jsx("div",{className:"h-20 w-32 overflow-hidden rounded-xl border border-primary/40 bg-background flex-shrink-0",title:ot.name,children:h.jsx("img",{src:ot.url,alt:ot.name,className:"h-full w-full object-cover"})});return ot.website?h.jsx("a",{href:ot.website,target:"_blank",rel:"noopener noreferrer",className:"inline-flex",children:pn},`${ot.url}-${br}`):h.jsx("div",{children:pn},`${ot.url}-${br}`)})})]}),Ht&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-3xl rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:rr==="patents"?"HAL patents":"HAL publications"}),h.jsx("button",{type:"button",onClick:()=>Zt(!1),className:"rounded-full border border-border px-3 py-1 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Close"})]}),h.jsxs("div",{className:"mt-4 space-y-3 max-h-[60vh] overflow-y-auto pr-1",children:[ir&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Loading ",rr==="patents"?"patents":"publications",""]}),Ur&&h.jsx("p",{className:"text-sm text-destructive",children:Ur}),!ir&&!Ur&&Zr.length===0&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:["No ",rr==="patents"?"patents":"publications"," found for this lab."]}),Zr.map(ot=>h.jsxs("a",{href:ot.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between gap-3 rounded-xl border border-border px-3 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary transition",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"truncate text-foreground",children:ot.title}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[ot.year?`${ot.year}  `:"",ot.doi||ot.url]})]}),h.jsx(Sl,{className:"h-4 w-4 flex-shrink-0"})]},`${ot.url}-${ot.title}`))]})]})}),Rt&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-2xl rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Lab team"}),h.jsx("button",{type:"button",onClick:()=>Gt(!1),className:"rounded-full border border-border px-3 py-1 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Close"})]}),h.jsxs("div",{className:"mt-4 space-y-6 max-h-[60vh] overflow-y-auto pr-1",children:[v.teamMembers.find(ot=>ot.isLead)&&h.jsxs("div",{className:"rounded-2xl border border-primary/40 bg-primary/5 px-4 py-3",children:[h.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Lead"}),v.teamMembers.filter(ot=>ot.isLead).map(ot=>h.jsx("div",{className:"mt-3 flex flex-wrap items-center gap-3",children:h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:ot.name}),h.jsx("span",{className:"mt-1 inline-flex items-center rounded-full border border-border px-2 py-0.5 text-[11px] text-muted-foreground",children:ot.title}),(ot.linkedin||ot.website)&&h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground",children:[ot.linkedin&&h.jsxs("a",{href:ot.linkedin,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["LinkedIn",h.jsx(Sl,{className:"h-3 w-3"})]}),ot.website&&h.jsxs("a",{href:ot.website,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["Website",h.jsx(Sl,{className:"h-3 w-3"})]})]})]})},`${ot.name}-${ot.title}`))]}),tr.map(([ot,br])=>h.jsxs("div",{className:"space-y-3",children:[h.jsxs("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:[ot,"  ",br.length]}),br.map(pn=>pn.isLead?null:h.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-border px-4 py-3",children:h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:pn.name}),h.jsx("span",{className:"mt-1 inline-flex items-center rounded-full border border-border px-2 py-0.5 text-[11px] text-muted-foreground",children:pn.title}),(pn.linkedin||pn.website)&&h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground",children:[pn.linkedin&&h.jsxs("a",{href:pn.linkedin,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["LinkedIn",h.jsx(Sl,{className:"h-3 w-3"})]}),pn.website&&h.jsxs("a",{href:pn.website,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["Website",h.jsx(Sl,{className:"h-3 w-3"})]})]})]})},`${pn.name}-${pn.title}`))]},ot))]})]})}),Ar&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-3xl rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Research teams"}),h.jsx("button",{type:"button",onClick:()=>Ut(!1),className:"rounded-full border border-border px-3 py-1 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Close"})]}),h.jsxs("div",{className:"mt-4 space-y-3 max-h-[60vh] overflow-y-auto pr-1",children:[$e&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading teams"}),ce&&h.jsx("p",{className:"text-sm text-destructive",children:ce}),!$e&&!ce&&fo.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"No teams linked to this lab yet."}),fo.map(ot=>h.jsxs(xn,{href:`/teams/${ot.id}`,className:"flex items-center justify-between gap-3 rounded-xl border border-border px-3 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary transition",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"truncate text-foreground",children:ot.name}),ot.descriptionShort&&h.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:ot.descriptionShort})]}),h.jsx(Sl,{className:"h-4 w-4 flex-shrink-0"})]},ot.id))]})]})}),Xt&&h.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8 backdrop-blur",onClick:()=>ut(null),children:h.jsxs("div",{className:"relative w-full max-w-5xl overflow-hidden rounded-3xl border border-white/30 bg-white/25 shadow-2xl backdrop-blur-2xl",onClick:ot=>ot.stopPropagation(),children:[h.jsx("button",{type:"button",onClick:()=>ut(null),className:"absolute right-4 top-4 z-10 inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/40 bg-white/25 text-sm text-white/90 backdrop-blur transition hover:bg-white/40","aria-label":"Close",children:""}),h.jsxs("div",{className:"relative flex items-center justify-center bg-white/10 p-4",children:[h.jsx("button",{type:"button",onClick:()=>ut(ot=>{if(!ot)return ot;const br=v.photos.length;return{index:(ot.index-1+br)%br}}),className:"absolute left-4 top-1/2 -translate-y-1/2 inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/40 bg-white/25 text-white/90 backdrop-blur transition hover:bg-white/40","aria-label":"Previous photo",children:""}),h.jsx("img",{src:Ee(v.photos[Xt.index].url,2e3),alt:`${v.name} photo ${Xt.index+1} - ${v.photos[Xt.index].name}`,className:"max-h-[75vh] w-auto max-w-full object-contain rounded-2xl"}),h.jsx("button",{type:"button",onClick:()=>ut(ot=>{if(!ot)return ot;const br=v.photos.length;return{index:(ot.index+1)%br}}),className:"absolute right-4 top-1/2 -translate-y-1/2 inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/40 bg-white/25 text-white/90 backdrop-blur transition hover:bg-white/40","aria-label":"Next photo",children:""})]})]})}),h.jsxs("div",{className:"rounded-2xl border border-border/80 bg-background/60 p-6 space-y-4",children:[h.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Lab location"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"A quick visual for where this lab is based."})]}),ws?h.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ws)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex max-w-full rounded-full border border-border bg-background/90 px-3 py-1 text-[11px] font-medium text-muted-foreground shadow-sm backdrop-blur transition hover:border-primary hover:text-primary",children:ws}):h.jsx("div",{className:"inline-flex max-w-full rounded-full border border-border bg-background/90 px-3 py-1 text-[11px] font-medium text-muted-foreground shadow-sm backdrop-blur",children:"Address not set"})]}),h.jsx("div",{className:"relative",children:h.jsx(Az,{markers:ze?[ze]:[],resizeKey:ze?.id??v?.id??"lab",interactive:!1,className:"h-56 w-full rounded-2xl border border-border",zoom:12})}),xr&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Loading location"}),yn&&h.jsx("p",{className:"text-xs text-muted-foreground",children:yn})]}),h.jsxs("footer",{className:"flex flex-wrap gap-3 mt-6",children:[Xe&&h.jsx("button",{type:"button",onClick:()=>{Ln(!0),kr(null),ki(null)},className:"inline-flex items-center justify-center rounded-full border border-primary px-4 py-2 text-sm font-medium text-primary transition hover:bg-primary/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Request lab time"}),et&&h.jsx("button",{type:"button",onClick:()=>{pt(!0),yi(null),or(null)},className:"inline-flex items-center justify-center rounded-full border border-primary/70 px-4 py-2 text-sm font-medium text-primary transition hover:bg-primary/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Contact for investment"}),gn&&h.jsx("button",{type:"button",onClick:()=>{_i(!0),ao(null),Nt(null)},className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Collaborate"}),h.jsx(xn,{href:"/labs",className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:bg-muted/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Explore other labs"})]}),At&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"relative w-full max-w-lg rounded-2xl border border-border bg-card p-6 shadow-2xl",children:[h.jsx("button",{type:"button",className:"absolute right-4 top-4 text-muted-foreground hover:text-foreground",onClick:()=>pt(!1),children:""}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Investor inquiry"}),h.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["Reach out to ",v.name,". Well forward this to their team."]}),h.jsxs("div",{className:"mt-4 grid gap-3",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Name"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Sr,onChange:ot=>Dr(ot.target.value)})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Vr,onChange:ot=>Ke(ot.target.value)})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Company (optional)"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Je,onChange:ot=>jt(ot.target.value)})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Website (optional)"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:yr,onChange:ot=>pr(ot.target.value),placeholder:"https://example.com"})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Message"}),h.jsx("textarea",{className:"min-h-[120px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Jt,onChange:ot=>Or(ot.target.value),placeholder:"Brief intro and what youre interested in."})]}),Gi&&h.jsx("p",{className:"text-sm text-destructive",children:Gi}),vt&&h.jsx("p",{className:"text-sm text-emerald-600",children:vt}),h.jsxs("div",{className:"flex items-center justify-end gap-3",children:[h.jsx("button",{type:"button",className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary transition",onClick:()=>pt(!1),disabled:sn,children:"Cancel"}),h.jsx("button",{type:"button",className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition disabled:opacity-70",onClick:lo,disabled:sn,children:sn?"Sending":"Send inquiry"})]})]})]})}),dn&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"relative w-full max-w-2xl rounded-2xl border border-border bg-card p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx("button",{type:"button",className:"absolute right-4 top-4 text-muted-foreground hover:text-foreground",onClick:()=>Ln(!1),children:""}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Request lab time"}),h.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["Tell ",v.name," what you need. Well route this to their team."]}),h.jsxs("div",{className:"mt-4 grid gap-3",children:[h.jsxs("div",{className:"grid gap-1 md:grid-cols-2 md:gap-4",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Your name"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.requesterName,onChange:ot=>Ri(br=>({...br,requesterName:ot.target.value}))})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.requesterEmail,onChange:ot=>Ri(br=>({...br,requesterEmail:ot.target.value}))})]})]}),h.jsxs("div",{className:"grid gap-1 md:grid-cols-2 md:gap-4",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Organization"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.organization,onChange:ot=>Ri(br=>({...br,organization:ot.target.value}))})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Role / Title"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.roleTitle,onChange:ot=>Ri(br=>({...br,roleTitle:ot.target.value}))})]})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Project summary"}),h.jsx("textarea",{className:"min-h-[100px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.projectSummary,onChange:ot=>Ri(br=>({...br,projectSummary:ot.target.value})),placeholder:"We need access to a GMP-ready wet lab for 8 weeks to validate a biosensor prototype."}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Minimum 50 characters. Max 1000 characters."})]}),h.jsxs("div",{className:"grid gap-1 md:grid-cols-2 md:gap-4",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Timeline"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.workTimeline,onChange:ot=>Ri(br=>({...br,workTimeline:ot.target.value})),placeholder:"Start in 46 weeks"})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Weekly hours needed"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.weeklyHoursNeeded,onChange:ot=>Ri(br=>({...br,weeklyHoursNeeded:ot.target.value})),placeholder:"2030 hrs/week"})]})]}),h.jsxs("div",{className:"grid gap-1 md:grid-cols-2 md:gap-4",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Team size"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.teamSize,onChange:ot=>Ri(br=>({...br,teamSize:ot.target.value})),placeholder:"3 researchers"})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Equipment needs"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.equipmentNeeds,onChange:ot=>Ri(br=>({...br,equipmentNeeds:ot.target.value})),placeholder:"HPLC, centrifuge, biosafety hood"})]})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Special requirements"}),h.jsx("textarea",{className:"min-h-[80px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.specialRequirements,onChange:ot=>Ri(br=>({...br,specialRequirements:ot.target.value})),placeholder:"BSL-2 room access, temperature-controlled storage"})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Links"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Yn.referencesOrLinks,onChange:ot=>Ri(br=>({...br,referencesOrLinks:ot.target.value})),placeholder:"Optional links to docs or examples"})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Preferred contact"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"email",label:"Email"},{value:"video_call",label:"Video call"},{value:"phone",label:"Phone"}].map(ot=>{const br=Yn.preferredContactMethods.includes(ot.value);return h.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition ${br?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary/50 hover:text-primary"}`,children:[h.jsx("input",{type:"checkbox",className:"rounded border-border text-primary",checked:br,onChange:pn=>Ri(Vn=>({...Vn,preferredContactMethods:pn.target.checked?[...Vn.preferredContactMethods,ot.value]:Vn.preferredContactMethods.filter($n=>$n!==ot.value)}))}),ot.label]},ot.value)})})]}),ur&&h.jsx("p",{className:"text-sm text-destructive",children:ur}),An&&h.jsx("p",{className:"text-sm text-emerald-600",children:An}),h.jsxs("div",{className:"flex items-center justify-end gap-3",children:[h.jsx("button",{type:"button",className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary transition",onClick:()=>Ln(!1),disabled:Bn,children:"Cancel"}),h.jsx("button",{type:"button",className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition disabled:opacity-70",onClick:ra,disabled:Bn,children:Bn?"Sending":"Send request"})]})]})]})}),ui&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"relative w-full max-w-2xl rounded-2xl border border-border bg-card p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx("button",{type:"button",className:"absolute right-4 top-4 text-muted-foreground hover:text-foreground",onClick:()=>_i(!1),children:""}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Collaboration inquiry"}),h.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["Share how youd like to collaborate with ",v.name,"."]}),h.jsxs("div",{className:"mt-4 grid gap-3",children:[h.jsxs("div",{className:"grid gap-1 md:grid-cols-2 md:gap-4",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Your name"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.contactName,onChange:ot=>ks(br=>({...br,contactName:ot.target.value}))})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.contactEmail,onChange:ot=>ks(br=>({...br,contactEmail:ot.target.value}))})]})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Target labs"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.targetLabs,onChange:ot=>ks(br=>({...br,targetLabs:ot.target.value}))})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Collaboration focus"}),h.jsx("textarea",{className:"min-h-[100px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.collaborationFocus,onChange:ot=>ks(br=>({...br,collaborationFocus:ot.target.value})),placeholder:"What would you like to collaborate on?"})]}),h.jsxs("div",{className:"grid gap-1 md:grid-cols-2 md:gap-4",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Resources offered"}),h.jsx("textarea",{className:"min-h-[80px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.resourcesOffered,onChange:ot=>ks(br=>({...br,resourcesOffered:ot.target.value}))})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Timeline"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.desiredTimeline,onChange:ot=>ks(br=>({...br,desiredTimeline:ot.target.value}))})]})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Additional notes"}),h.jsx("textarea",{className:"min-h-[80px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.additionalNotes,onChange:ot=>ks(br=>({...br,additionalNotes:ot.target.value}))})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Preferred contact"}),h.jsxs("select",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:us.preferredContact,onChange:ot=>ks(br=>({...br,preferredContact:ot.target.value})),children:[h.jsx("option",{value:"email",children:"Email"}),h.jsx("option",{value:"video_call",children:"Video call"}),h.jsx("option",{value:"in_person",children:"In person"})]})]}),Is&&h.jsx("p",{className:"text-sm text-destructive",children:Is}),No&&h.jsx("p",{className:"text-sm text-emerald-600",children:No}),h.jsxs("div",{className:"flex items-center justify-end gap-3",children:[h.jsx("button",{type:"button",className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary transition",onClick:()=>_i(!1),disabled:Ds,children:"Cancel"}),h.jsx("button",{type:"button",className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition disabled:opacity-70",onClick:Uo,disabled:Ds,children:Ds?"Sending":"Send collaboration"})]})]})]})}),Rr&&h.jsx("p",{className:"mt-10 text-xs text-muted-foreground",children:Ir})]})]})}):h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 max-w-3xl text-center space-y-6",children:[h.jsx("h1",{className:"text-4xl font-semibold text-foreground",children:"Lab not found"}),h.jsx("p",{className:"text-muted-foreground",children:"We could not find the lab you were looking for. It may have been removed or you might have followed an outdated link."}),h.jsx(xn,{href:"/labs",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Browse labs"})})]})})}const VR={requesterName:"",requesterEmail:"",organization:"",roleTitle:"",projectSummary:"",workTimeline:"",weeklyHoursNeeded:"",teamSize:"",equipmentNeeds:"",complianceNotes:"",specialRequirements:"",referencesOrLinks:"",preferredContactMethods:["email"]};function Jne({params:i}){const{labs:n,isLoading:a}=Em(),d=Number(i.id),y=$.useMemo(()=>n.find(oe=>oe.id===d),[n,d]),v="w-full rounded-2xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",[C,s]=$.useState(VR),[M,L]=$.useState(!1),[F,W]=$.useState(null),[X,ee]=$.useState(null),he=(oe,ve)=>{s(me=>({...me,[oe]:ve}))},se=async oe=>{if(oe.preventDefault(),!!y){if(!C.preferredContactMethods.length){W("Select at least one contact method.");return}L(!0),W(null);try{const ve=await fetch("/api/lab-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...C,labId:y.id,labName:y.name})});if(!ve.ok){const Se=await ve.json().catch(()=>({message:"Unable to submit"}));throw new Error(Se?.message??"Unable to submit request")}const me=await ve.json();ee(me.id),s(VR)}catch(ve){W(ve instanceof Error?ve.message:"Unable to submit request")}finally{L(!1)}}};return a&&!y?h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-24 text-center",children:[h.jsx(ST,{className:"mx-auto h-8 w-8 animate-spin text-muted-foreground"}),h.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading lab details"})]})}):y?h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 lg:py-20 max-w-4xl",children:[h.jsx(xn,{href:`/labs/${y.id}`,children:h.jsxs("a",{className:"inline-flex items-center gap-2 text-sm text-muted-foreground transition hover:text-primary",children:[" Back to ",y.name]})}),h.jsxs(Jn.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.5},className:"mt-6 rounded-3xl border border-border bg-card/80 p-8 shadow-sm",children:[h.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground",children:"Lab intake"}),h.jsxs("h1",{className:"mt-3 text-3xl font-semibold text-foreground",children:["Request time at ",y.name]}),h.jsx("p",{className:"mt-2 text-muted-foreground",children:"Glass reviews every submission for spam or quality issues before sharing them with the lab. Approved requests are batched and delivered on the cadence you choose."})]}),h.jsxs("div",{className:"rounded-2xl border border-primary/30 bg-primary/5 px-4 py-3 text-sm text-foreground",children:[h.jsxs("p",{className:"font-semibold flex items-center gap-2",children:[h.jsx(xc,{className:"h-4 w-4 text-primary"})," Help labs trust the outreach"]}),h.jsx("p",{className:"mt-1 text-muted-foreground",children:"Share proof of prior collaboration or a partner reference so Glass can pre-screen requests before sending them."})]})]}),X?h.jsx("div",{className:"mt-8 rounded-2xl border border-emerald-200 bg-emerald-50/70 px-6 py-5 text-sm text-emerald-900",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(cw,{className:"h-5 w-5"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium",children:"Request queued for review"}),h.jsxs("p",{className:"mt-1 text-emerald-900/80",children:["Your submission #",X," is pending internal moderation. Well route approved requests to ",y.labManager,"."]})]})]})}):null,F&&h.jsxs("div",{className:"mt-6 flex items-center gap-3 rounded-2xl border border-destructive/40 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:[h.jsx(j2,{className:"h-4 w-4"}),h.jsx("span",{children:F})]}),h.jsxs("form",{className:"mt-10 space-y-6",onSubmit:se,children:[h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsx(Uc,{label:"Your name",required:!0,children:h.jsx("input",{type:"text",value:C.requesterName,onChange:oe=>he("requesterName",oe.target.value),className:v,placeholder:"Jordan Reyes",required:!0})}),h.jsx(Uc,{label:"Work email",required:!0,children:h.jsx("input",{type:"email",value:C.requesterEmail,onChange:oe=>he("requesterEmail",oe.target.value),className:v,placeholder:"jordan@teamglass.bio",required:!0})})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsx(Uc,{label:"Organization / team",required:!0,children:h.jsx("input",{type:"text",value:C.organization,onChange:oe=>he("organization",oe.target.value),className:v,placeholder:"Atlas Applied Biology",required:!0})}),h.jsx(Uc,{label:"Role / title",required:!0,children:h.jsx("input",{type:"text",value:C.roleTitle,onChange:oe=>he("roleTitle",oe.target.value),className:v,placeholder:"Program Lead",required:!0})})]}),h.jsx(Uc,{label:"Project summary",description:"Help the lab understand why you need space and what success looks like.",required:!0,children:h.jsx("textarea",{value:C.projectSummary,onChange:oe=>he("projectSummary",oe.target.value),className:`${v} min-h-[140px]`,placeholder:"Outline your experiment goals, team, and safety posture.",required:!0})}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[h.jsx(Uc,{label:"Desired start",required:!0,children:h.jsxs("select",{className:v,value:C.workTimeline,onChange:oe=>he("workTimeline",oe.target.value),required:!0,children:[h.jsx("option",{value:"",disabled:!0,children:"Select timeline"}),h.jsx("option",{value:"next_2_weeks",children:"Within 2 weeks"}),h.jsx("option",{value:"next_month",children:"Within a month"}),h.jsx("option",{value:"next_quarter",children:"Next quarter"}),h.jsx("option",{value:"flexible",children:"Flexible / exploratory"})]})}),h.jsx(Uc,{label:"Weekly hours",required:!0,children:h.jsx("input",{type:"text",className:v,value:C.weeklyHoursNeeded,onChange:oe=>he("weeklyHoursNeeded",oe.target.value),placeholder:"20 bench hours",required:!0})}),h.jsx(Uc,{label:"Team size",required:!0,children:h.jsx("input",{type:"text",className:v,value:C.teamSize,onChange:oe=>he("teamSize",oe.target.value),placeholder:"3 researchers",required:!0})})]}),h.jsx(Uc,{label:"Equipment & process needs",description:"List any instruments, cleanroom access, or SOP support you expect.",children:h.jsx("textarea",{className:`${v} min-h-[100px]`,value:C.equipmentNeeds,onChange:oe=>he("equipmentNeeds",oe.target.value),placeholder:"BSL-2 hood, sequencing core time, GMP-aligned QA support..."})}),h.jsx(Uc,{label:"Compliance or special requirements",description:"Share certifications, biosafety requirements, or onboarding needs.",children:h.jsx("textarea",{className:v,value:C.complianceNotes,onChange:oe=>he("complianceNotes",oe.target.value),placeholder:"BSL-2+ handling, cleanroom training, DEA registration..."})}),h.jsx(Uc,{label:"Special requests",description:"Optional context for lab operations, security, or scheduling.",children:h.jsx("textarea",{className:v,value:C.specialRequirements,onChange:oe=>he("specialRequirements",oe.target.value),placeholder:"Preferred shift, shipping logistics, storage requirements..."})}),h.jsx(Uc,{label:"References, decks, or links",children:h.jsx("textarea",{className:v,value:C.referencesOrLinks,onChange:oe=>he("referencesOrLinks",oe.target.value),placeholder:"Paste Notion docs, pitch decks, public updates, etc."})}),h.jsx(Uc,{label:"Contact preferences",description:"Choose how you want the lab to reach you.",required:!0,children:h.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"email",label:"Email"},{value:"video_call",label:"Video call"},{value:"phone",label:"Phone"}].map(oe=>{const ve=C.preferredContactMethods.includes(oe.value);return h.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition ${ve?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary/50 hover:text-primary"}`,children:[h.jsx("input",{type:"checkbox",className:"rounded border-border text-primary",checked:ve,onChange:me=>he("preferredContactMethods",me.target.checked?[...C.preferredContactMethods,oe.value]:C.preferredContactMethods.filter(Se=>Se!==oe.value))}),oe.label]},oe.value)})})}),h.jsx("div",{className:"flex flex-wrap gap-3",children:h.jsxs("button",{type:"submit",disabled:M,className:"inline-flex items-center gap-2 rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-60",children:[M&&h.jsx(ST,{className:"h-4 w-4 animate-spin"}),"Submit request"]})})]})]})]})}):h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-24 max-w-3xl text-center space-y-6",children:[h.jsx("h1",{className:"text-4xl font-semibold text-foreground",children:"Lab not found"}),h.jsx("p",{className:"text-muted-foreground",children:"The lab you selected doesnt exist or has been removed. Head back to the directory to choose another partner."}),h.jsx(xn,{href:"/labs",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Browse labs"})})]})})}function Uc({label:i,description:n,required:a,children:d}){return h.jsxs("div",{className:"space-y-2",children:[h.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:h.jsxs("span",{children:[i,a?" *":""]})}),n?h.jsx("p",{className:"text-xs text-muted-foreground",children:n}):null,d]})}function eie({params:i}){const n=Number(i.id),{labs:a}=Em(),d=a.find(Zt=>Zt.id===n),{user:y}=Ma(),[v,C]=$.useState(""),[s,M]=$.useState(""),[L,F]=$.useState(""),[W,X]=$.useState(""),[ee,he]=$.useState(""),[se,oe]=$.useState(""),[ve,me]=$.useState(""),[Se,Re]=$.useState("email"),[Be,rt]=$.useState(null),[We,Ct]=$.useState(!1);$.useEffect(()=>{d&&!L&&F(d.name)},[d]),$.useEffect(()=>{y?.email&&!s&&M(y.email);const Zt=y?.user_metadata?.display_name||y?.user_metadata?.full_name||y?.user_metadata?.name||"";Zt&&!v&&C(Zt)},[y?.email,y?.user_metadata,s,v]);const Ht=async Zt=>{Zt.preventDefault(),Ct(!0),rt(null);try{const rr={labId:n,contactName:v.trim(),contactEmail:s.trim(),targetLabs:L.trim(),collaborationFocus:W.trim(),resourcesOffered:ee.trim(),desiredTimeline:se.trim(),additionalNotes:ve.trim(),preferredContact:Se},$t=await fetch("/api/lab-collaborations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(rr)});if(!$t.ok){const Rt=(await $t.json().catch(()=>({})))?.message||"Submission failed";throw new Error(Rt)}rt("Submitted. We'll notify the lab team."),C(""),M(""),F(""),X(""),he(""),oe(""),me(""),Re("email")}catch(rr){rt(rr instanceof Error?rr.message:"Submission failed")}finally{Ct(!1)}};return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 pb-20 max-w-2xl",children:[h.jsx(xn,{href:`/labs/${n}`,className:"text-sm text-muted-foreground hover:text-primary",children:"Back to lab"}),h.jsx("h1",{className:"mt-4 text-2xl font-semibold text-foreground",children:"Propose a collaboration"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:d?h.jsxs(h.Fragment,{children:["Youre collaborating with ",h.jsx("span",{className:"font-medium text-foreground",children:d.name}),"."]}):h.jsx(h.Fragment,{children:"Share a brief overview so the lab can assess fit quickly."})}),h.jsxs("form",{className:"mt-6 grid gap-4",onSubmit:Ht,children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Your name"}),h.jsx("input",{className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm",value:v,onChange:Zt=>C(Zt.target.value),required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email"}),h.jsx("input",{type:"email",className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm",value:s,onChange:Zt=>M(Zt.target.value),required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Target labs (optional)"}),h.jsx("input",{className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm",value:L,onChange:Zt=>F(Zt.target.value)})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Collaboration focus"}),h.jsx("textarea",{className:"mt-2 w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm",rows:4,value:W,onChange:Zt=>X(Zt.target.value),required:!0})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Resources offered (optional)"}),h.jsx("input",{className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm",value:ee,onChange:Zt=>he(Zt.target.value)})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Desired timeline (optional)"}),h.jsx("input",{className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm",value:se,onChange:Zt=>oe(Zt.target.value)})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Preferred contact method"}),h.jsxs("select",{className:"mt-2 w-full rounded-full border border-border bg-background px-4 py-2 text-sm",value:Se,onChange:Zt=>Re(Zt.target.value),children:[h.jsx("option",{value:"email",children:"Email"}),h.jsx("option",{value:"video_call",children:"Video call"}),h.jsx("option",{value:"in_person",children:"In person"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Additional notes (optional)"}),h.jsx("textarea",{className:"mt-2 w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm",rows:4,value:ve,onChange:Zt=>me(Zt.target.value)})]}),Be&&h.jsx("p",{className:"text-sm text-muted-foreground",children:Be}),h.jsx("button",{disabled:We,className:"inline-flex items-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground",children:We?"Submitting":"Submit proposal"})]})]})})}const uT={name:"",labManager:"",contactEmail:"",logoUrl:"",descriptionShort:"",descriptionLong:"",offersLabSpace:"no",siretNumber:"",addressLine1:"",addressLine2:"",city:"",state:"",postalCode:"",country:"",website:"",linkedin:"",partnerLogos:[],compliance:"",verification:"no",labStatus:"listed",orgRole:"",equipment:"",focusAreas:"",halStructureId:"",halPersonId:"",offers:[],photoUrlInput:"",complianceDocUrlInput:"",isVisible:"yes"};function tie(i){return{name:i.name,labManager:i.labManager,contactEmail:i.contactEmail,logoUrl:i.logoUrl||"",descriptionShort:i.descriptionShort||"",descriptionLong:i.descriptionLong||"",offersLabSpace:i.offersLabSpace?"yes":"no",siretNumber:i.siretNumber||"",addressLine1:i.addressLine1||"",addressLine2:i.addressLine2||"",city:i.city||"",state:i.state||"",postalCode:i.postalCode||"",country:i.country||"",website:i.website||"",linkedin:i.linkedin||"",partnerLogos:i.partnerLogos||[],compliance:i.compliance.join(", "),verification:i.auditPassed?"yes":"no",labStatus:i.labStatus||"listed",orgRole:i.orgRole||"",equipment:i.equipment.join(", "),focusAreas:i.focusAreas.join(", "),halStructureId:i.halStructureId||"",halPersonId:i.halPersonId||"",offers:[...i.offers],photoUrlInput:"",complianceDocUrlInput:"",isVisible:i.isVisible===!1?"no":"yes"}}function dT(i){return i.split(",").map(n=>n.trim()).filter(Boolean)}function rie(i){const n=Array.from(i);return Promise.all(n.map(a=>new Promise((d,y)=>{const v=new FileReader;v.onload=()=>{if(typeof v.result!="string"){y(new Error("Unsupported file format"));return}d({name:a.name,url:v.result})},v.onerror=()=>{y(v.error??new Error("Failed to read file"))},v.readAsDataURL(a)})))}function nie(i,n,a,d){return{name:i.name.trim(),labManager:i.labManager.trim(),contactEmail:i.contactEmail.trim(),logoUrl:i.logoUrl.trim()||null,descriptionShort:i.descriptionShort.trim()||null,descriptionLong:i.descriptionLong.trim()||null,offersLabSpace:i.offersLabSpace==="yes",siretNumber:i.siretNumber.trim()||null,addressLine1:i.addressLine1.trim()||null,addressLine2:i.addressLine2.trim()||null,city:i.city.trim()||null,state:i.state.trim()||null,postalCode:i.postalCode.trim()||null,country:i.country.trim()||null,website:i.website.trim()||null,linkedin:i.linkedin.trim()||null,partnerLogos:d,compliance:dT(i.compliance),auditPassed:i.verification==="yes",labStatus:i.labStatus,orgRole:i.orgRole||null,equipment:dT(i.equipment),focusAreas:dT(i.focusAreas),offers:i.offers,photos:n,complianceDocs:a,isVisible:i.isVisible==="yes",halStructureId:i.halStructureId.trim()||null,halPersonId:i.halPersonId.trim()||null}}function rB({embedded:i=!1}){const{labs:n,addLab:a,updateLab:d,removeLab:y,isLoading:v,error:C,refresh:s}=Em(),[M,L]=$.useState(null),[F,W]=$.useState(uT),[X,ee]=$.useState(null),[he,se]=$.useState([]),[oe,ve]=$.useState([]),[me,Se]=$.useState([]),[Re,Be]=$.useState(!1),[rt,We]=$.useState(null),[Ct,Ht]=$.useState(!1),[Zt,rr]=$.useState(null),[$t,Rt]=$.useState("");$.useEffect(()=>{s(!0).catch(()=>{})},[s]);const Gt=$.useMemo(()=>{const At=$t.trim().toLowerCase();return At?n.filter(pt=>{const Sr=[pt.city,pt.country].filter(Boolean).join(", ");return[pt.name,...pt.alternateNames??[],Sr,pt.labManager,pt.contactEmail,pt.orgRole].filter(Boolean).join(" ").toLowerCase().includes(At)}):n},[n,$t]),Ar=()=>{L("new"),W(uT),ee(null),se([]),ve([]),Se([]),rr(null)},Ut=At=>{L(At.id),W(tie(At)),ee(null),se(At.photos),ve(At.complianceDocs),Se(At.partnerLogos||[]),rr(null)},Xt=()=>{L(null),W(uT),se([]),ve([]),Se([])},ut=(At,pt)=>{W(Sr=>({...Sr,[At]:pt}))},Mt=async At=>{try{ee(null),await d(At.id,{isVisible:!(At.isVisible??!0)}),await s(!0),ee({type:"success",text:`Marked ${At.name} as ${At.isVisible===!1?"visible":"hidden"}`})}catch(pt){ee({type:"error",text:pt instanceof Error?pt.message:"Unable to update visibility"})}},Qt=At=>{W(pt=>{const Sr=pt.offers.includes(At)?pt.offers.filter(Dr=>Dr!==At):[...pt.offers,At];return{...pt,offers:Sr}})},ze=async At=>{const pt=At.target.files?.[0];if(pt){rr(null),Ht(!0);try{const Sr=pt.name.split(".").pop()||"png",Vr=`logos/${(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${Sr}`}`,{error:Ke}=await fn.storage.from("lab-logos").upload(Vr,pt,{upsert:!0,contentType:pt.type});if(Ke)throw Ke;const{data:Je}=fn.storage.from("lab-logos").getPublicUrl(Vr),jt=Je.publicUrl;W(yr=>({...yr,logoUrl:jt})),ee({type:"success",text:"Logo uploaded"})}catch(Sr){rr(Sr?.message||"Unable to upload logo")}finally{Ht(!1)}}},It=async At=>{const pt=At.target.files?.[0];if(pt){ee(null);try{const Sr=pt.name.split(".").pop()||"png",Dr=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${Sr}`,Ke=`${typeof M=="number"?`labs/${M}/partners`:"partners"}/${Dr}`,{error:Je}=await fn.storage.from("lab-logos").upload(Ke,pt,{upsert:!0,contentType:pt.type});if(Je)throw Je;const{data:jt}=fn.storage.from("lab-logos").getPublicUrl(Ke),yr=jt.publicUrl;Se(pr=>[...pr,{name:pt.name,url:yr,website:null}]),ee({type:"success",text:"Partner logo uploaded"})}catch(Sr){ee({type:"error",text:Sr?.message||"Unable to upload partner logo"})}}},xr=()=>{const At=F.photoUrlInput.trim();At&&(se(pt=>[...pt,{name:At.split("/").pop()??`Photo ${pt.length+1}`,url:At}]),W(pt=>({...pt,photoUrlInput:""})))},Lr=()=>{const At=F.complianceDocUrlInput.trim();At&&(ve(pt=>[...pt,{name:At.split("/").pop()??`Document ${pt.length+1}`,url:At}]),W(pt=>({...pt,complianceDocUrlInput:""})))},yn=async At=>{const pt=At.target.files;if(!(!pt||pt.length===0))try{const Sr=await rie(pt);se(Dr=>[...Dr,...Sr]),ee(null)}catch(Sr){ee({type:"error",text:Sr instanceof Error?Sr.message:"Unable to process photo uploads"})}finally{At.target.value=""}},Yr=async At=>{const pt=At.target.files;if(!pt||pt.length===0)return;const Sr=typeof M=="number"?`labs/${M}/docs`:"docs",Dr=[];try{for(const Vr of Array.from(pt)){const Ke=Vr.name.split(".").pop()||"pdf",Je=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${Ke}`,jt=`${Sr}/${Je}`,{error:yr}=await fn.storage.from("lab-pdfs").upload(jt,Vr,{upsert:!0,contentType:Vr.type});if(yr)throw yr;const{data:pr}=fn.storage.from("lab-pdfs").getPublicUrl(jt);Dr.push({name:Vr.name,url:pr.publicUrl})}Dr.length&&(ve(Vr=>[...Vr,...Dr]),ee({type:"success",text:"Documents uploaded"}))}catch(Vr){ee({type:"error",text:Vr instanceof Error?Vr.message:"Unable to upload documents"})}finally{At.target.value=""}},Zr=At=>{se(pt=>pt.filter(Sr=>Sr.url!==At.url))},Qr=At=>{ve(pt=>pt.filter(Sr=>Sr.url!==At.url))},ir=At=>{Se(pt=>pt.filter(Sr=>Sr.url!==At.url))},Hr=()=>{if(!F.name.trim())throw new Error("Lab name is required");if(!F.contactEmail.trim())throw new Error("Contact email is required");if(he.length===0)throw new Error("Please upload or link at least one lab photo.")},Ur=async At=>{At.preventDefault();try{Be(!0),Hr();const pt=nie(F,he,oe,me);if(M==="new"){const Sr=await a(pt);ee({type:"success",text:`Created ${Sr.name}`})}else typeof M=="number"&&(await d(M,pt),ee({type:"success",text:"Lab details updated"}));Xt(),await s(!0)}catch(pt){ee({type:"error",text:pt instanceof Error?pt.message:"Unable to save lab details"})}finally{Be(!1)}},Ti=async At=>{try{We(At),await y(At),M===At&&Xt(),ee({type:"success",text:"Lab removed from the directory"})}catch(pt){ee({type:"error",text:pt instanceof Error?pt.message:"Unable to remove lab"})}finally{We(null)}},Sn=i?"bg-transparent":"bg-background min-h-screen",Ci=i?"w-full px-0 py-0":"container mx-auto px-4 py-20 lg:py-24";return h.jsx("section",{className:Sn,children:h.jsxs("div",{className:Ci,children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("span",{className:"text-sm uppercase tracking-[0.35em] text-muted-foreground",children:"Lab directory"}),h.jsxs("h1",{className:"mt-3 flex items-center gap-2 text-4xl font-semibold text-foreground",children:[h.jsx(xc,{className:"h-6 w-6 text-primary"}),"Admin: manage partner labs"]}),h.jsx("p",{className:"mt-2 max-w-2xl text-muted-foreground",children:"Keep the lab rental directory current by updating contacts, compliance, and equipment details. Edits go live instantly for the lab browsing experience."})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[h.jsxs("div",{className:"relative w-full sm:w-64",children:[h.jsx("input",{type:"search",value:$t,onChange:At=>Rt(At.target.value),placeholder:"Search by name, alternate name, contact, or role",className:"w-full rounded-full border border-border bg-card/80 px-4 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx(Ad,{className:"pointer-events-none absolute right-3 top-2.5 h-4 w-4 text-muted-foreground"})]}),h.jsx(xn,{href:"/lab-profile",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:bg-muted/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Lab profile guide"})}),h.jsxs("button",{type:"button",onClick:Ar,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:[h.jsx(Vx,{className:"h-4 w-4"}),"Add lab"]})]})]}),X&&h.jsx(Jn.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:`mt-6 rounded-2xl border p-4 text-sm ${X.type==="success"?"border-emerald-200 bg-emerald-50 text-emerald-900":"border-red-300 bg-red-50 text-red-900"}`,children:X.text}),C&&h.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:[h.jsx("span",{children:C}),h.jsx("button",{type:"button",onClick:s,className:"rounded-full border border-destructive/40 px-3 py-1 text-xs font-medium uppercase tracking-[0.2em]",children:"Retry"})]}),h.jsxs("div",{className:"mt-10 grid gap-8 lg:grid-cols-[1.05fr_1fr]",children:[h.jsx(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-4",children:n.length===0?h.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 p-10 text-center text-muted-foreground",children:v?"Loading lab directory":C?"Unable to load the lab directory right now.":"No labs in the directory yet. Use Add lab to create your first listing."}):Gt.length===0?h.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 p-10 text-center text-muted-foreground",children:"No labs match that search."}):Gt.map(At=>{const pt=(At.labStatus||"listed").toLowerCase(),Sr=["verified_passive","verified_active","premier"].includes(pt),Dr=pt==="premier"?"Premier":Sr?"Verified":pt==="confirmed"?"Confirmed":"Listed";return h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:At.name}),h.jsxs("div",{className:"mt-1 inline-flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(Ad,{className:"h-4 w-4 text-primary"}),[At.city,At.country].filter(Boolean).join(", ")||"Location not set"]})]}),h.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[h.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium ${Sr?"bg-emerald-50 text-emerald-700":pt==="confirmed"?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-700"}`,children:Sr?h.jsxs(h.Fragment,{children:[h.jsx(cw,{className:"h-3.5 w-3.5"}),Dr]}):h.jsxs(h.Fragment,{children:[h.jsx(Ux,{className:"h-3.5 w-3.5"}),Dr]})}),h.jsx("button",{type:"button",onClick:()=>Mt(At),className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium transition ${At.isVisible===!1?"bg-slate-200 text-slate-800 hover:bg-slate-300":"bg-emerald-50 text-emerald-700 hover:bg-emerald-100"}`,title:At.isVisible===!1?"Currently hidden. Click to show.":"Currently visible. Click to hide.",children:At.isVisible===!1?"Hidden  click to show":"Visible  click to hide"})]})]}),h.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-muted-foreground",children:[h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx(fm,{className:"h-4 w-4 text-primary"}),h.jsx("span",{children:At.labManager})]}),h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx(bv,{className:"h-4 w-4 text-primary"}),h.jsx("span",{className:"break-all",children:At.contactEmail})]})]}),h.jsxs("dl",{className:"mt-4 grid gap-3 text-xs text-muted-foreground md:grid-cols-2",children:[h.jsxs("div",{className:"flex flex-col gap-1",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Compliance"}),h.jsx("span",{children:At.compliance.join(", ")||""})]}),h.jsxs("div",{className:"flex flex-col gap-1",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Focus areas"}),h.jsx("span",{children:At.focusAreas.join(", ")||""})]}),h.jsxs("div",{className:"flex flex-col gap-1",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Organization role"}),h.jsx("span",{children:At.orgRole||""})]}),h.jsxs("div",{className:"flex flex-col gap-1 md:col-span-2",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Equipment"}),h.jsx("span",{children:At.equipment.join(", ")||""})]}),h.jsxs("div",{className:"flex flex-col gap-1",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Photos"}),h.jsx("span",{children:At.photos.length?`${At.photos.length} supplied`:""})]}),h.jsxs("div",{className:"flex flex-col gap-1",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Compliance docs"}),h.jsx("span",{children:At.complianceDocs.length?`${At.complianceDocs.length} uploaded`:""})]})]}),h.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[h.jsxs("button",{type:"button",onClick:()=>Ut(At),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1.5 text-xs font-medium text-muted-foreground transition hover:border-primary hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:[h.jsx(z$,{className:"h-3.5 w-3.5"}),"Edit"]}),h.jsxs("button",{type:"button",onClick:()=>Ti(At.id),disabled:rt===At.id,className:"inline-flex items-center gap-2 rounded-full border border-destructive/40 px-3 py-1.5 text-xs font-medium text-destructive transition hover:bg-destructive/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-destructive disabled:cursor-not-allowed disabled:opacity-60",children:[h.jsx(TT,{className:"h-3.5 w-3.5"}),rt===At.id?"Removing":"Remove"]})]})]},At.id)})}),h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:M==="new"?"Add a lab partner":M?"Edit lab details":"Select a lab"}),M&&h.jsxs("button",{type:"button",onClick:()=>{Xt(),ee(null)},className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground transition hover:text-primary hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:[h.jsx(Jf,{className:"h-3.5 w-3.5"}),"Cancel"]})]}),M?h.jsxs("form",{className:"mt-6 space-y-5",onSubmit:Ur,children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-name",children:"Lab name"}),h.jsx("input",{id:"lab-name",type:"text",value:F.name,onChange:At=>ut("name",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Atlas Applied Biology",required:!0})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-manager",children:"Lab manager"}),h.jsx("input",{id:"lab-manager",type:"text",value:F.labManager,onChange:At=>ut("labManager",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Naomi Chen"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-email",children:"Contact email"}),h.jsx("input",{id:"lab-email",type:"email",value:F.contactEmail,onChange:At=>ut("contactEmail",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"labs+atlas@glass.demo",required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-logo",children:"Logo (stored in Supabase)"}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("input",{id:"lab-logo",type:"file",accept:"image/*",onChange:ze,className:"w-full rounded-xl border border-dashed border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),F.logoUrl&&h.jsxs("button",{type:"button",onClick:()=>W(At=>({...At,logoUrl:""})),className:"inline-flex items-center gap-1 rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground transition hover:border-destructive hover:text-destructive",children:[h.jsx(Jf,{className:"h-3 w-3"}),"Remove"]})]}),Ct&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading logo"}),Zt&&h.jsx("p",{className:"text-xs text-destructive",children:Zt}),F.logoUrl&&h.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("img",{src:F.logoUrl,alt:`${F.name||"Lab"} logo`,className:"h-10 w-10 rounded-full object-cover"}),h.jsx("span",{className:"text-xs text-muted-foreground break-all max-w-[200px] truncate",children:F.logoUrl})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload saves to the `lab-logos` bucket. Keep files small (e.g., 300x300)."})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Partner logos (premier/custom feature)"}),h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsx("input",{type:"file",accept:"image/*",onChange:It,className:"w-full rounded-xl border border-dashed border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Stored in `lab-logos` under partners/ folders."}),me.length>0&&h.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:me.map(At=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2 flex-shrink-0",children:[h.jsx("img",{src:At.url,alt:At.name,className:"h-10 w-10 rounded object-cover"}),h.jsx("input",{className:"w-48 rounded-lg border border-border bg-background px-2 py-1 text-xs text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Partner website",value:At.website??"",onChange:pt=>{const Sr=pt.target.value;Se(Dr=>Dr.map(Vr=>Vr.url===At.url?{...Vr,website:Sr}:Vr))}}),h.jsx("button",{type:"button",onClick:()=>ir(At),className:"text-xs text-muted-foreground hover:text-destructive",children:"Remove"})]},At.url))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-description-short",children:"Short description"}),h.jsx("textarea",{id:"lab-description-short",value:F.descriptionShort,onChange:At=>ut("descriptionShort",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"One or two sentences under the lab title.",rows:3}),h.jsx("label",{className:"text-sm font-medium text-foreground mt-4",htmlFor:"lab-description-long",children:"Long description"}),h.jsx("textarea",{id:"lab-description-long",value:F.descriptionLong,onChange:At=>ut("descriptionLong",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Longer overview shown later on the page.",rows:6})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-offers-space",children:"Offers lab space?"}),h.jsxs("select",{id:"lab-offers-space",value:F.offersLabSpace,onChange:At=>ut("offersLabSpace",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[h.jsx("option",{value:"yes",children:"Yes, accepting bench/space requests"}),h.jsx("option",{value:"no",children:"No, visibility only"})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Controls whether pricing/offers show on the lab page."})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-address1",children:"Address line 1 (internal)"}),h.jsx("input",{id:"lab-address1",type:"text",value:F.addressLine1,onChange:At=>ut("addressLine1",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"123 Bio Ave"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-address2",children:"Address line 2 (internal)"}),h.jsx("input",{id:"lab-address2",type:"text",value:F.addressLine2,onChange:At=>ut("addressLine2",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Suite, floor, etc."})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-hal-id",children:"HAL structure ID (optional)"}),h.jsx("input",{id:"lab-hal-id",type:"text",value:F.halStructureId,onChange:At=>ut("halStructureId",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"struct-123456"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-hal-person-id",children:"HAL person ID (optional)"}),h.jsx("input",{id:"lab-hal-person-id",type:"text",value:F.halPersonId,onChange:At=>ut("halPersonId",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"123456"})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-city",children:"City (internal)"}),h.jsx("input",{id:"lab-city",type:"text",value:F.city,onChange:At=>ut("city",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Boston"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-state",children:"State/Region (internal)"}),h.jsx("input",{id:"lab-state",type:"text",value:F.state,onChange:At=>ut("state",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"MA"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-postal",children:"Postal code (internal)"}),h.jsx("input",{id:"lab-postal",type:"text",value:F.postalCode,onChange:At=>ut("postalCode",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"02118"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-country",children:"Country (internal)"}),h.jsx("input",{id:"lab-country",type:"text",value:F.country,onChange:At=>ut("country",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"United States"})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-website",children:"Website (optional)"}),h.jsx("input",{id:"lab-website",type:"url",value:F.website,onChange:At=>ut("website",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"https://labs.example.com"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-linkedin",children:"LinkedIn (optional)"}),h.jsx("input",{id:"lab-linkedin",type:"url",value:F.linkedin,onChange:At=>ut("linkedin",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"https://www.linkedin.com/company/example"})]})]}),h.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-siret",children:"SIRET (internal)"}),h.jsx("input",{id:"lab-siret",type:"text",value:F.siretNumber,onChange:At=>ut("siretNumber",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"14-digit SIRET"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Internal use only; not shown publicly."})]})}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-verification",children:"Audit status"}),h.jsxs("select",{id:"lab-verification",value:F.verification,onChange:At=>ut("verification",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[h.jsx("option",{value:"yes",children:"Audit passed"}),h.jsx("option",{value:"no",children:"Audit pending"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-status",children:"Lab status"}),h.jsxs("select",{id:"lab-status",value:F.labStatus,onChange:At=>ut("labStatus",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[h.jsx("option",{value:"listed",children:"Listed (unverified)"}),h.jsx("option",{value:"confirmed",children:"Confirmed"}),h.jsx("option",{value:"verified_passive",children:"Verified  passive"}),h.jsx("option",{value:"verified_active",children:"Verified  active"}),h.jsx("option",{value:"premier",children:"Premier"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-org-role",children:"Organization role"}),h.jsxs("select",{id:"lab-org-role",value:F.orgRole,onChange:At=>ut("orgRole",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[h.jsx("option",{value:"",children:"Select role type"}),f_.map(At=>h.jsx("option",{value:At,children:At},At))]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-visibility",children:"Visibility"}),h.jsxs("select",{id:"lab-visibility",value:F.isVisible,onChange:At=>ut("isVisible",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[h.jsx("option",{value:"yes",children:"Visible in directory"}),h.jsx("option",{value:"no",children:"Hidden (admin only)"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-compliance",children:"Compliance (comma separated)"}),h.jsx("input",{id:"lab-compliance",type:"text",value:F.compliance,onChange:At=>ut("compliance",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"BSL-2, ISO 7 Cleanroom"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Example: BSL-2, ISO 7 Cleanroom, GMP-aligned SOPs."})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-complianceDocs",children:"Compliance certificates (PDF)"}),h.jsx("input",{id:"lab-complianceDocs",type:"file",accept:"application/pdf",multiple:!0,onChange:Yr,className:"w-full rounded-xl border border-dashed border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploads are stored in the Supabase bucket `lab-pdfs`."}),h.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:oe.map(At=>h.jsxs("button",{type:"button",onClick:()=>Qr(At),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 transition hover:border-destructive hover:text-destructive",children:[h.jsx(HM,{className:"h-3 w-3 text-primary"}),At.name,h.jsx(Jf,{className:"h-3 w-3"})]},At.url))}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("input",{type:"url",value:F.complianceDocUrlInput,onChange:At=>ut("complianceDocUrlInput",At.target.value),className:"flex-1 rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"https://example.com/certificate.pdf"}),h.jsxs("button",{type:"button",onClick:Lr,className:"inline-flex items-center gap-2 rounded-xl border border-border px-3 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:[h.jsx(V$,{className:"h-4 w-4"}),"Add URL"]})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload or link to safety certifications. These appear alongside compliance notes for researchers."})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-focusAreas",children:"Focus areas (comma separated)"}),h.jsx("input",{id:"lab-focusAreas",type:"text",value:F.focusAreas,onChange:At=>ut("focusAreas",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Cell therapy, Process development"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("span",{className:"text-sm font-medium text-foreground",children:"Offers"}),h.jsx("div",{className:"flex flex-wrap gap-3",children:Dw.map(At=>h.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx("input",{type:"checkbox",checked:F.offers.includes(At),onChange:()=>Qt(At),className:"h-4 w-4 rounded border-border text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary"}),At]},At))})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-equipment",children:"Equipment (comma separated)"}),h.jsx("textarea",{id:"lab-equipment",value:F.equipment,onChange:At=>ut("equipment",At.target.value),className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Single-use bioreactors, Cryostorage, Sequencing core",rows:3}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"List flagship instrumentation available to teams."})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"lab-photos",children:"Lab photos"}),h.jsx("input",{id:"lab-photos",type:"file",accept:"image/*",multiple:!0,onChange:yn,className:"w-full rounded-xl border border-dashed border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:he.map(At=>h.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-border",children:[h.jsx("img",{src:At.url,alt:At.name,className:"h-24 w-full object-cover"}),h.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-xs text-muted-foreground bg-background/80",children:[h.jsx("span",{className:"truncate",children:At.name}),h.jsx("button",{type:"button",onClick:()=>Zr(At),className:"rounded-full border border-border px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] transition hover:border-destructive hover:text-destructive",children:"Remove"})]})]},At.url))}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("input",{type:"url",value:F.photoUrlInput,onChange:At=>ut("photoUrlInput",At.target.value),className:"flex-1 rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"https://example.com/photo.jpg"}),h.jsxs("button",{type:"button",onClick:xr,className:"inline-flex items-center gap-2 rounded-xl border border-border px-3 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:[h.jsx(L$,{className:"h-4 w-4"}),"Add URL"]})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload photos directly or link to hosted images. The first photo is used for the public thumbnail."})]}),h.jsxs("div",{className:"flex flex-wrap gap-3 pt-2",children:[h.jsxs("button",{type:"submit",disabled:Re,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary disabled:opacity-60 disabled:cursor-not-allowed",children:[h.jsx(F$,{className:"h-4 w-4"}),Re?"Saving":"Save changes"]}),h.jsxs("button",{type:"button",onClick:()=>{Xt(),ee(null)},className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:bg-muted/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:[h.jsx(Jf,{className:"h-4 w-4"}),"Cancel"]})]})]}):h.jsx("div",{className:"mt-16 text-center text-sm text-muted-foreground",children:"Select a lab from the list or choose Add lab to create a new listing."})]})]})]})})}function UR(){return h.jsx("div",{className:"max-w-4xl mx-auto px-4 pb-20 space-y-6",children:h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground mb-2",children:"Beta update"}),h.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Pricing is paused during beta"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"All early adopters get free access while we finish verification and invite-only premier onboarding. We'll announce public plans later."}),h.jsxs("div",{className:"mt-6 space-y-3 text-sm text-muted-foreground",children:[h.jsx("div",{className:"rounded-2xl border border-dashed border-primary/30 bg-primary/5 px-4 py-3 text-primary",children:"Premier is invite-only for now. Reach out if you need visibility perks or verification."}),h.jsx("p",{children:"Need something specific? Email us and we'll sort it out one-on-one."})]}),h.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3",children:[h.jsx(xn,{href:"/labs",className:"rounded-full bg-primary px-5 py-2 text-primary-foreground text-sm font-medium hover:bg-primary/90 text-center",children:"Explore labs"}),h.jsx(xn,{href:"/contact",className:"rounded-full border px-5 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary text-center",children:"Contact us"})]})]})})}function iie(){return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-24 lg:py-28 max-w-4xl",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6},className:"space-y-6",children:[h.jsx("span",{className:"text-sm uppercase tracking-[0.35em] text-muted-foreground",children:"Lab profile setup"}),h.jsx("h1",{className:"text-4xl md:text-5xl font-semibold leading-tight text-foreground",children:"Share the essentials about your lab before it appears in listings."}),h.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed",children:"Lab managers can use this guide to collect everything needed for the public listing and verification badge. Once you have the details and documents ready, jump into the editor to publish or update your profile."})]}),h.jsxs(Jn.div,{initial:{opacity:0,y:22},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mt-12 grid gap-6 md:grid-cols-2",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(bT,{className:"h-5 w-5 text-primary"}),h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"What to prepare"})]}),h.jsxs("ul",{className:"space-y-3 text-sm text-muted-foreground leading-relaxed",children:[h.jsx("li",{children:"Core lab details: location, lab manager, contact email, and equipment list."}),h.jsx("li",{children:"Focus areas and booking offers (monthly, hourly, day rates, or equipment-only access)."}),h.jsx("li",{children:"Minimum stay expectations and any special onboarding notes for new teams."})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(N$,{className:"h-5 w-5 text-primary"}),h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Upload requirements"})]}),h.jsxs("ul",{className:"space-y-3 text-sm text-muted-foreground leading-relaxed",children:[h.jsx("li",{children:"High-quality photos of the facility and key equipment (at least one required)."}),h.jsx("li",{children:"Optional hosted photo URLs if your lab already has imagery online."}),h.jsx("li",{children:"Safety/compliance certificates (PDF) to display alongside credential summaries."})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm space-y-4 md:col-span-2",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(xc,{className:"h-5 w-5 text-primary"}),h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Verification badge checklist"})]}),h.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"After you submit your profile, Glass coordinates a location-based site visit. A representative will confirm the equipment, access controls, and safety documentation on file. Keep digital copies handy for the visit and make sure the listed contact can host the walkthrough."}),h.jsx("div",{className:"mt-4 rounded-2xl border border-border bg-background/60 p-5 text-sm text-muted-foreground",children:h.jsx("p",{children:"Remember: rental agreements, insurance coverage, and day-to-day operations stay between your team and the researchers. Glass provides the marketplace and verification layer, but does not intermediate leases or liability."})})]})]}),h.jsxs(Jn.div,{initial:{opacity:0,y:22},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mt-12 flex flex-wrap gap-3",children:[h.jsx(xn,{href:"/lab/manage",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Open lab editor"})}),h.jsx("a",{href:"mailto:support@glass.demo",className:"inline-flex items-center justify-center rounded-full border border-border px-5 py-2 text-sm font-medium text-muted-foreground transition hover:bg-muted/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:"Contact the Glass team"})]})]})})}function sie(){return JR.useSyncExternalStore(oie,()=>!0,()=>!1)}function oie(){return()=>{}}var cC="Avatar",[aie]=Fh(cC),[lie,nB]=aie(cC),iB=$.forwardRef((i,n)=>{const{__scopeAvatar:a,...d}=i,[y,v]=$.useState("idle");return h.jsx(lie,{scope:a,imageLoadingStatus:y,onImageLoadingStatusChange:v,children:h.jsx(ss.span,{...d,ref:n})})});iB.displayName=cC;var sB="AvatarImage",oB=$.forwardRef((i,n)=>{const{__scopeAvatar:a,src:d,onLoadingStatusChange:y=()=>{},...v}=i,C=nB(sB,a),s=cie(d,v),M=vc(L=>{y(L),C.onImageLoadingStatusChange(L)});return Qc(()=>{s!=="idle"&&M(s)},[s,M]),s==="loaded"?h.jsx(ss.img,{...v,ref:n,src:d}):null});oB.displayName=sB;var aB="AvatarFallback",lB=$.forwardRef((i,n)=>{const{__scopeAvatar:a,delayMs:d,...y}=i,v=nB(aB,a),[C,s]=$.useState(d===void 0);return $.useEffect(()=>{if(d!==void 0){const M=window.setTimeout(()=>s(!0),d);return()=>window.clearTimeout(M)}},[d]),C&&v.imageLoadingStatus!=="loaded"?h.jsx(ss.span,{...y,ref:n}):null});lB.displayName=aB;function $R(i,n){return i?n?(i.src!==n&&(i.src=n),i.complete&&i.naturalWidth>0?"loaded":"loading"):"error":"idle"}function cie(i,{referrerPolicy:n,crossOrigin:a}){const d=sie(),y=$.useRef(null),v=d?(y.current||(y.current=new window.Image),y.current):null,[C,s]=$.useState(()=>$R(v,i));return Qc(()=>{s($R(v,i))},[v,i]),Qc(()=>{const M=W=>()=>{s(W)};if(!v)return;const L=M("loaded"),F=M("error");return v.addEventListener("load",L),v.addEventListener("error",F),n&&(v.referrerPolicy=n),typeof a=="string"&&(v.crossOrigin=a),()=>{v.removeEventListener("load",L),v.removeEventListener("error",F)}},[v,a,n]),C}var cB=iB,uB=oB,dB=lB;const uC=$.forwardRef(({className:i,...n},a)=>h.jsx(cB,{ref:a,className:Ki("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",i),...n}));uC.displayName=cB.displayName;const dC=$.forwardRef(({className:i,...n},a)=>h.jsx(uB,{ref:a,className:Ki("aspect-square h-full w-full",i),...n}));dC.displayName=uB.displayName;const hC=$.forwardRef(({className:i,...n},a)=>h.jsx(dB,{ref:a,className:Ki("flex h-full w-full items-center justify-center rounded-full bg-muted",i),...n}));hC.displayName=dB.displayName;function hB({embedded:i=!1}){const n="w-full rounded-2xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",{user:a,loading:d,signOut:y}=Ma(),[v,C]=$.useState(null),[s,M]=$.useState(!0),[L,F]=$.useState(!1),[W,X]=$.useState(null),[ee,he]=$.useState(""),[se,oe]=$.useState(""),[ve,me]=$.useState(""),[Se,Re]=$.useState(""),[Be,rt]=$.useState(null),[We,Ct]=$.useState(!1),[Ht,Zt]=$.useState(""),[rr,$t]=$.useState(""),[Rt,Gt]=$.useState(""),[Ar,Ut]=$.useState(""),[Xt,ut]=$.useState(""),[Mt,Qt]=$.useState("France"),[ze,It]=$.useState(!1);$.useEffect(()=>{async function ir(){if(!a){C(null),M(!1);return}const{data:Ur,error:Ti}=await fn.from("profiles").select("user_id,email,display_name,role,subscription_status,name,avatar_url,created_at,updated_at,legal_full_name,address_line1,address_line2,city,postal_code,country").eq("user_id",a.id).maybeSingle();Ti?(console.error("Error fetching profile:",Ti.message),C(null)):(C(Ur||null),Ur?(he(Ur.name??""),oe(Ur.display_name??""),me(Ur.role??""),Re(Ur.subscription_status??""),rt(Ur.avatar_url??null),Zt(Ur.legal_full_name??""),$t(Ur.address_line1??""),Gt(Ur.address_line2??""),Ut(Ur.city??""),ut(Ur.postal_code??""),Qt(Ur.country??Mt)):(me("user"),Re("none"))),M(!1)}d||ir();const{data:Hr}=fn.auth.onAuthStateChange((Ur,Ti)=>{Ti?.user?ir():C(null)});return()=>{try{Hr?.subscription?.unsubscribe?.(),Hr?.unsubscribe?.()}catch{}}},[d,a?.id]);const xr=async()=>{await y()},Lr=async()=>{if(X(null),F(!0),!a){X("You must be logged in to save your profile."),F(!1);return}try{const ir={user_id:a.id,email:a.email,name:ee||null,display_name:se||null,avatar_url:Be||null,legal_full_name:Ht||null,address_line1:rr||null,address_line2:Rt||null,city:Ar||null,postal_code:Xt||null,country:Mt||null},{error:Hr}=await fn.from("profiles").upsert(ir,{onConflict:"user_id"});if(Hr)throw Hr;C(Ur=>({...Ur??{},...ir}))}catch(ir){console.error(ir),X(ir.message||"Failed to save profile.")}finally{F(!1)}},yn=async()=>{if(!a?.email){X("No email found for this account.");return}It(!0),X(null);try{const{error:ir}=await fn.auth.resetPasswordForEmail(a.email,{redirectTo:`${window.location.origin}/account/edit`});if(ir)throw ir}catch(ir){X(ir.message||"Failed to send reset email.")}finally{It(!1)}};async function Yr(ir){const Hr=ir.target.files?.[0];if(!(!Hr||!a)){Ct(!0),X(null);try{const Ur=Hr.name.split(".").pop()?.toLowerCase()||"png",Ti=`${a.id}/avatar.${Ur}`,{error:Sn}=await fn.storage.from("avatars").upload(Ti,Hr,{cacheControl:"3600",upsert:!0,contentType:Hr.type});if(Sn)throw Sn;const{data:Ci}=fn.storage.from("avatars").getPublicUrl(Ti),At=Ci.publicUrl;rt(At);const{error:pt}=await fn.from("profiles").upsert({user_id:a.id,email:a.email,avatar_url:At},{onConflict:"user_id"});if(pt)throw pt}catch(Ur){console.error(Ur),X(Ur.message||"Failed to upload avatar.")}finally{Ct(!1)}}}const Zr=i?"bg-transparent":"bg-background min-h-screen",Qr=i?"w-full px-0 py-0":"container mx-auto px-4 py-20 lg:py-24 max-w-5xl";return h.jsx("section",{className:Zr,children:h.jsxs("div",{className:Qr,children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{className:"max-w-2xl space-y-4",children:[h.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground"}),h.jsxs("h1",{className:"flex items-center gap-2 text-4xl font-semibold text-foreground",children:[h.jsx(Qk,{className:"h-6 w-6 text-primary"}),"Your Glass profile"]}),h.jsx("p",{className:"text-muted-foreground",children:"This page will eventually show your verified status, saved labs, requests, and billing."})]}),h.jsx("button",{type:"button",onClick:yn,disabled:ze,className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:text-primary hover:border-primary disabled:opacity-60",children:ze?"Sending reset":"Reset password"})]}),h.jsxs("div",{className:"mt-12 grid gap-8 lg:grid-cols-2",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5},className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm",children:[h.jsxs("h2",{className:"flex items-center gap-2 text-xl font-semibold text-foreground",children:[h.jsx(Qk,{className:"h-5 w-5 text-primary"}),"Profile Info"]}),s||d?h.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading profile..."}):v?h.jsxs("div",{className:"mt-4 space-y-2 text-sm text-foreground",children:[h.jsxs("p",{children:[h.jsx("strong",{children:"Name:"})," ",v.name||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Display name:"})," ",v.display_name||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Email:"})," ",a?.email||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Role:"})," ",v.role||ve||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Subscription:"})," ",v.subscription_status||Se||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Legal name:"})," ",v.legal_full_name||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Company:"})," ",v.company_name||""]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Address:"})," ",v.address_line1||v.address_line2||v.city||v.postal_code||v.country?`${v.address_line1??""} ${v.address_line2??""} ${v.postal_code??""} ${v.city??""} ${v.country??""}`:""]}),h.jsx("button",{className:"mt-4 inline-flex items-center justify-center rounded-full bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700",onClick:xr,children:"Sign out"})]}):h.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"You are not signed in or profile not created yet."})]}),h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm",children:[h.jsxs("h2",{className:"flex items-center gap-2 text-xl font-semibold text-foreground",children:[h.jsx(QM,{className:"h-5 w-5 text-primary"}),v?"Edit your profile":"Create your profile"]}),W&&h.jsx("p",{className:"text-sm text-destructive mt-2",children:W}),h.jsxs("form",{className:"mt-6 space-y-4",onSubmit:ir=>ir.preventDefault(),children:[h.jsx(ku,{label:"Avatar",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs(uC,{className:"h-14 w-14",children:[h.jsx(dC,{src:Be??void 0,alt:se||ee||"Avatar"}),h.jsx(hC,{className:"text-base font-semibold bg-muted",children:(se||ee||a?.email||"?").slice(0,2).toUpperCase()})]}),h.jsxs("label",{className:"inline-flex items-center rounded-full border px-3 py-2 text-xs font-medium cursor-pointer hover:border-primary hover:text-primary",children:[h.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Yr}),We?"Uploading":"Upload photo"]})]})}),h.jsx(ku,{label:"Full name",children:h.jsx("input",{className:n,value:ee,onChange:ir=>he(ir.target.value)})}),h.jsx(ku,{label:"Display name",children:h.jsx("input",{className:n,value:se,onChange:ir=>oe(ir.target.value)})}),h.jsx(ku,{label:"Legal full name (for receipts)",children:h.jsx("input",{className:n,value:Ht,onChange:ir=>Zt(ir.target.value),placeholder:"Legal name for individual receipts"})}),h.jsx(ku,{label:"Address line 1",children:h.jsx("input",{className:n,value:rr,onChange:ir=>$t(ir.target.value),placeholder:"Street and number"})}),h.jsx(ku,{label:"Address line 2 (optional)",children:h.jsx("input",{className:n,value:Rt,onChange:ir=>Gt(ir.target.value),placeholder:"Apartment, suite, etc."})}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsx(ku,{label:"City",children:h.jsx("input",{className:n,value:Ar,onChange:ir=>Ut(ir.target.value)})}),h.jsx(ku,{label:"Postal code",children:h.jsx("input",{className:n,value:Xt,onChange:ir=>ut(ir.target.value)})})]}),h.jsx(ku,{label:"Country",children:h.jsx("input",{className:n,value:Mt,onChange:ir=>Qt(ir.target.value)})}),h.jsx(ku,{label:"Email",children:h.jsx("input",{className:n,value:a?.email??"",disabled:!0})}),h.jsx(ku,{label:"Role",children:h.jsx("input",{className:n,value:ve,disabled:!0})}),h.jsx(ku,{label:"Subscription status",children:h.jsx("input",{className:n,value:Se,disabled:!0})}),h.jsx("button",{type:"button",className:"inline-flex w-full items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition",onClick:Lr,disabled:L,children:L?"Saving...":"Save profile"})]})]})]})]})})}function ku({label:i,children:n}){return h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:i}),n]})}function fB({embedded:i=!1}){const{user:n}=Ma(),[a,d]=$.useState({labs:[],collaborations:[],contacts:[]}),[y,v]=$.useState(!0),[C,s]=$.useState(null),[M,L]=$.useState("collaboration"),[F,W]=$.useState(new Set),[X,ee]=$.useState(new Set);$.useEffect(()=>{(async()=>{s(null),v(!0);try{const{data:Se}=await fn.auth.getSession(),Re=Se.session?.access_token,Be=await fetch("/api/my-labs/requests",{headers:Re?{Authorization:`Bearer ${Re}`}:{}}),rt=Be.headers.get("content-type")||"";if(!Be.ok||!rt.includes("application/json")){const Ct=await Be.text();throw new Error(Ct||"Unable to load requests")}const We=await Be.json();d(We)}catch(Se){s(Se.message||"Unable to load requests")}finally{v(!1)}})()},[n?.id]);const he=async(Se,Re)=>{let Be=!0;if(W(rt=>{const We=new Set(rt);return We.has(Se)?(We.delete(Se),Be=!1):(We.add(Se),Be=!0),We}),Be&&Re.contact_email&&!X.has(Se))try{const{data:rt}=await fn.auth.getSession(),We=rt.session?.access_token;await fetch("/api/my-labs/requests/viewed",{method:"POST",headers:{"Content-Type":"application/json",...We?{Authorization:`Bearer ${We}`}:{}},body:JSON.stringify({contactEmail:Re.contact_email,labName:Re.lab_name,type:M==="collaboration"?"collaboration":"rental"})}),ee(Ct=>{const Ht=new Set(Ct);return Ht.add(Se),Ht})}catch{}},se=Se=>{const Re=Se.id??`${Se.lab_id??""}-${Se.lab_name??""}-${Se.contact_email??""}-${Se.created_at??""}`,Be=Se.created_at?new Date(Se.created_at).toLocaleString():null,rt=F.has(Re);return h.jsxs("div",{className:"rounded-2xl border border-border bg-card/70",children:[h.jsxs("button",{type:"button",onClick:()=>he(Re,Se),className:"flex w-full items-center justify-between gap-4 px-4 py-3 text-left hover:bg-muted/50 transition",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4",children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:Se.lab_name||"Unknown lab"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:Se.contact_name||"Unknown contact"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[Be&&h.jsx("p",{className:"text-[11px] text-muted-foreground whitespace-nowrap",children:Be}),h.jsx("span",{className:"text-xs text-primary",children:rt?"Hide":"View"})]})]}),rt&&h.jsxs("div",{className:"border-t border-border px-4 py-4 space-y-4 text-sm text-foreground",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Contact"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:Se.contact_email||"No email provided"}),Se.preferred_contact&&h.jsxs("p",{className:"text-xs text-muted-foreground",children:["Preferred: ",Se.preferred_contact==="video_call"?"Video call":Se.preferred_contact==="in_person"?"In person":"Email"]})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Request"}),Se.collaboration_focus&&h.jsxs("p",{children:[h.jsx("span",{className:"font-medium",children:"Focus:"})," ",Se.collaboration_focus]}),Se.desired_timeline&&h.jsxs("p",{children:[h.jsx("span",{className:"font-medium",children:"Timeline:"})," ",Se.desired_timeline]}),Se.target_labs&&h.jsxs("p",{children:[h.jsx("span",{className:"font-medium",children:"Target labs:"})," ",Se.target_labs]}),Se.resources_offered&&h.jsxs("p",{children:[h.jsx("span",{className:"font-medium",children:"Resources offered:"})," ",Se.resources_offered]})]}),Se.additional_notes&&h.jsxs("div",{className:"grid gap-1",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Notes"}),h.jsx("p",{children:Se.additional_notes})]}),Se.message&&!Se.collaboration_focus&&h.jsxs("div",{className:"grid gap-1",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Message"}),h.jsx("p",{children:Se.message})]}),h.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[Se.contact_email&&h.jsx("a",{href:`mailto:${encodeURIComponent(Se.contact_email)}?subject=Re:%20${encodeURIComponent(Se.lab_name||"your request")}`,className:"inline-flex items-center rounded-full border border-border px-3 py-1.5 text-xs font-medium text-primary hover:border-primary",children:"Reply via email"}),h.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-border px-3 py-1.5 text-xs font-medium text-muted-foreground hover:border-primary",onClick:()=>{if(Se.contact_email){const We=`Video call with ${Se.contact_name??"contact"} (${Se.contact_email})`;navigator.clipboard?.writeText(We)}},children:"Schedule call"}),h.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-border px-3 py-1.5 text-xs font-medium text-muted-foreground hover:border-primary",onClick:()=>{if(Se.contact_email){const We=`${Se.contact_name??"Contact"} <${Se.contact_email}>`;navigator.clipboard?.writeText(We)}},children:"Copy contact"})]})]})]},Re)},oe=M==="collaboration"?a.collaborations:a.contacts,ve=i?"bg-transparent":"bg-background min-h-screen",me=i?"w-full px-0 py-0":"container mx-auto px-4 py-20 lg:py-24 max-w-5xl";return h.jsx("section",{className:ve,children:h.jsxs("div",{className:me,children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Requests"}),h.jsxs("h1",{className:"flex items-center gap-2 text-3xl font-semibold text-foreground",children:[h.jsx(bv,{className:"h-5 w-5 text-primary"}),"Inbox"]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Collaboration or rental requests linked to your labs."})]}),h.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[h.jsxs("button",{type:"button",className:`rounded-full border px-4 py-2 text-sm font-medium transition ${M==="collaboration"?"border-primary bg-primary/10 text-primary":"border-border text-foreground hover:border-primary/60"}`,onClick:()=>L("collaboration"),children:["Collaboration (",a.collaborations.length,")"]}),h.jsxs("button",{type:"button",className:`rounded-full border px-4 py-2 text-sm font-medium transition ${M==="contact"?"border-primary bg-primary/10 text-primary":"border-border text-foreground hover:border-primary/60"}`,onClick:()=>L("contact"),children:["Renting / contact (",a.contacts.length,")"]})]}),h.jsx(Jn.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.4},className:"mt-6 rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:y?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading requests"}):C?h.jsx("p",{className:"text-sm text-destructive",children:C}):a.labs.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:"No labs linked to your account yet."}):oe.length===0?h.jsxs("p",{className:"text-sm text-muted-foreground",children:["No ",M," requests yet."]}):h.jsx("div",{className:"grid gap-3",children:oe.map(se)})})]})})}function pB({embedded:i=!1}){const{user:n}=Ma(),[a,d]=$.useState([]),[y,v]=$.useState(!0),[C,s]=$.useState(null),[M,L]=$.useState(""),[F,W]=$.useState({canCreateLab:!1,canManageMultipleLabs:!1});$.useEffect(()=>{(async()=>{s(null);try{const{data:me}=await fn.auth.getSession(),Se=me.session?.access_token,Re=await fetch("/api/my-labs",{headers:Se?{Authorization:`Bearer ${Se}`}:{}});if(!Re.ok){const We=await Re.text();throw new Error(We||"Unable to load labs")}const Be=await Re.json();d(Be??[]);const{data:rt}=await fn.from("profiles").select("can_create_lab, can_manage_multiple_labs").eq("user_id",n?.id).maybeSingle();W({canCreateLab:!!rt?.can_create_lab,canManageMultipleLabs:!!rt?.can_manage_multiple_labs})}catch(me){s(me.message||"Unable to load labs")}finally{v(!1)}})()},[n?.id]);const X=$.useMemo(()=>{const me=M.trim().toLowerCase();return me?a.filter(Se=>{const Re=(Se.lab_equipment??[]).map(We=>We.item).join(" "),Be=[Se.city,Se.country].filter(Boolean).join(", ");return[Se.name,...Se.alternate_names??[],Se.org_role,Be,Re].filter(Boolean).join(" ").toLowerCase().includes(me)}):a},[a,M]),ee=F.canCreateLab&&(F.canManageMultipleLabs||a.length===0),he=me=>{const Re=(me.lab_status||"listed").toLowerCase()==="premier",Be=me.is_visible===!1;return h.jsxs("div",{className:"flex flex-col items-end gap-1",children:[Re?h.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-[11px] font-medium text-primary",children:"Premier"}):null,Be?h.jsx("span",{className:"rounded-full bg-amber-100 px-3 py-1 text-[11px] font-medium text-amber-800",children:"Not visible"}):null]})},se=me=>me.logo_url?me.logo_url:me.lab_photos?.[0]?.url||null,oe=i?"bg-transparent":"bg-background min-h-screen",ve=i?"w-full px-0 py-0":"container mx-auto px-4 py-20 lg:py-24 max-w-6xl";return h.jsx("section",{className:oe,children:h.jsxs("div",{className:ve,children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsxs("div",{className:"space-y-1",children:[h.jsxs("h1",{className:"flex items-center gap-2 text-3xl font-semibold text-foreground",children:[h.jsx(wT,{className:"h-5 w-5 text-primary"}),"Manage your labs"]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Pick a lab to edit. Premier labs keep their analytics and partner features."})]}),h.jsxs("div",{className:"relative w-full sm:w-80",children:[h.jsx("input",{type:"search",value:M,onChange:me=>L(me.target.value),placeholder:"Search by name, alternate name, or city",className:"w-full rounded-full border border-border bg-card/80 px-4 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx(Ad,{className:"pointer-events-none absolute right-3 top-2.5 h-4 w-4 text-muted-foreground"})]})]}),y?h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Loading labs"}):C?h.jsx("p",{className:"mt-6 text-sm text-destructive",children:C}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"mt-8 grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex h-full flex-col rounded-3xl border border-dashed border-border bg-card/60 shadow-sm overflow-hidden",children:[h.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-3 p-6 text-center",children:[h.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10 text-primary",children:h.jsx(Vx,{className:"h-6 w-6"})}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Add a new lab"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:ee?"Create another lab profile and manage its details.":"Multi-lab management is available on Custom tier."})]}),h.jsx("div",{className:"p-4",children:ee?h.jsx(xn,{href:"/lab/manage/new",className:"inline-flex w-full items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Add lab"}):h.jsx(xn,{href:"/payments?plan=custom#custom",className:"inline-flex w-full items-center justify-center rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"Upgrade to Custom"})})]},"add-lab"),X.map(me=>h.jsxs(Jn.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex h-full flex-col rounded-3xl border border-border bg-card/80 shadow-sm overflow-hidden",children:[se(me)&&h.jsx("div",{className:"h-36 w-full overflow-hidden border-b border-border/60 bg-background/40",children:h.jsx("img",{src:se(me),alt:me.name,className:"h-full w-full object-cover"})}),h.jsxs("div",{className:"p-4 space-y-2 flex-1 flex flex-col",children:[h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:me.name}),me.org_role&&h.jsx("p",{className:"mt-1 text-[11px] font-medium uppercase tracking-[0.15em] text-muted-foreground",children:me.org_role}),h.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[h.jsx(Ad,{className:"h-3.5 w-3.5 text-primary"}),h.jsx("span",{children:[me.city,me.country].filter(Boolean).join(", ")||"Location not set"})]})]}),he(me)]}),me.lab_equipment&&me.lab_equipment.length>0&&h.jsx("div",{className:"flex flex-wrap gap-2 text-[11px] text-muted-foreground",children:me.lab_equipment.slice(0,3).map(Se=>h.jsx("span",{className:"rounded-full border border-border px-2 py-1",children:Se.item},Se.item))}),h.jsx("div",{className:"pt-2",children:h.jsx(xn,{href:`/lab/manage/${me.id}`,children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Manage"})})})]})]},me.id))]}),X.length===0&&h.jsxs("p",{className:"mt-6 text-sm text-muted-foreground",children:["No labs match that search. ",a.length===0?"No lab is linked to your account yet.":""]})]})]})})}function mB({embedded:i=!1,onBack:n}){const{user:a}=Ma(),[d,y]=$.useState([]),[v,C]=$.useState(!0),[s,M]=$.useState(null),[L,F]=$.useState("");$.useEffect(()=>{let he=!0;return(async()=>{M(null);try{const{data:se}=await fn.auth.getSession(),oe=se.session?.access_token,ve=await fetch("/api/my-teams",{headers:oe?{Authorization:`Bearer ${oe}`}:{}});if(!ve.ok){const Se=await ve.text();throw new Error(Se||"Unable to load teams")}const me=await ve.json();he&&y(me??[])}catch(se){he&&M(se.message||"Unable to load teams")}finally{he&&C(!1)}})(),()=>{he=!1}},[a?.id]);const W=$.useMemo(()=>{const he=L.trim().toLowerCase();return he?d.filter(se=>{const oe=se.labs.map(me=>me.name).join(" ");return[se.name,se.field,se.descriptionShort,se.descriptionLong,se.equipment.join(" "),se.focusAreas.join(" "),oe].filter(Boolean).join(" ").toLowerCase().includes(he)}):d},[d,L]),X=i?"bg-transparent":"bg-background min-h-screen",ee=i?"w-full px-0 py-0":"container mx-auto px-4 py-20 lg:py-24 max-w-6xl";return h.jsx("section",{className:X,children:h.jsxs("div",{className:ee,children:[i&&n&&h.jsxs("button",{type:"button",onClick:n,className:"mb-4 inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:[h.jsx(n_,{className:"h-3.5 w-3.5"}),"Back"]}),h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsxs("div",{className:"space-y-1",children:[h.jsxs("h1",{className:"flex items-center gap-2 text-3xl font-semibold text-foreground",children:[h.jsx(fm,{className:"h-5 w-5 text-primary"}),"Manage your teams"]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Create and update research teams linked to labs."})]}),h.jsx("div",{className:"relative w-full sm:w-80",children:h.jsx("input",{type:"search",value:L,onChange:he=>F(he.target.value),placeholder:"Search teams",className:"w-full rounded-full border border-border bg-card/80 px-4 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"})})]}),v?h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Loading teams..."}):s?h.jsx("p",{className:"mt-6 text-sm text-destructive",children:s}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"mt-8 grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex h-full flex-col rounded-3xl border border-dashed border-border bg-card/60 shadow-sm overflow-hidden",children:[h.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-3 p-6 text-center",children:[h.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10 text-primary",children:h.jsx(Vx,{className:"h-6 w-6"})}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Add a new team"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Build a dedicated profile for a research team."})]}),h.jsx("div",{className:"p-4",children:h.jsx(xn,{href:"/team/manage/new",className:"inline-flex w-full items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Add team"})})]},"add-team"),W.map(he=>h.jsxs(Jn.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex h-full flex-col rounded-3xl border border-border bg-card/80 shadow-sm overflow-hidden",children:[he.logoUrl&&h.jsx("div",{className:"h-32 w-full overflow-hidden border-b border-border/60 bg-background/40",children:h.jsx("img",{src:he.logoUrl,alt:he.name,className:"h-full w-full object-cover"})}),h.jsxs("div",{className:"p-4 space-y-3 flex-1 flex flex-col",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:he.name}),he.descriptionShort&&h.jsx("p",{className:"mt-1 text-sm text-muted-foreground line-clamp-2",children:he.descriptionShort})]}),h.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[h.jsx(fm,{className:"h-3.5 w-3.5 text-primary"}),he.members.length," members"]}),h.jsx("div",{className:"pt-2 mt-auto",children:h.jsx(xn,{href:`/team/manage/${he.id}`,children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Manage"})})})]})]},he.id))]}),W.length===0&&h.jsxs("p",{className:"mt-6 text-sm text-muted-foreground",children:["No teams match that search. ",d.length===0?"No teams are linked to your account yet.":""]})]})]})})}function gB({embedded:i=!1}){const{user:n}=Ma(),{labs:a}=Em(),[d,y]=$.useState([]),[v,C]=$.useState(!0),[s,M]=$.useState(null);$.useEffect(()=>{let X=!0;async function ee(){C(!0),M(null);try{const{data:he}=await fn.auth.getSession(),se=he.session?.access_token,oe=se?{Authorization:`Bearer ${se}`}:{},ve=await fetch("/api/favorites",{headers:oe}),me=ve.headers.get("content-type")||"";if(!ve.ok||!me.includes("application/json"))throw new Error("Unable to load favorites");const Se=await ve.json(),Re=Array.isArray(Se?.labIds)?Se.labIds:[];X&&y(Re.map(Be=>Number(Be)).filter(Be=>!Number.isNaN(Be)))}catch(he){X&&M(he.message||"Unable to load favorites")}finally{X&&C(!1)}}return n?ee():C(!1),()=>{X=!1}},[n]);const L=$.useMemo(()=>d.length?a.filter(X=>d.includes(X.id)):[],[d,a]),F=i?"bg-transparent":"bg-background min-h-screen",W=i?"w-full px-0 py-0":"container mx-auto max-w-5xl px-4 py-16 lg:py-20";return h.jsx("section",{className:F,children:h.jsxs("div",{className:W,children:[h.jsx("div",{className:"flex items-center justify-between gap-3",children:h.jsxs("div",{children:[h.jsxs("h1",{className:"flex items-center gap-2 text-2xl font-semibold text-foreground",children:[h.jsx(k2,{className:"h-5 w-5 text-primary"}),"Favorites"]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Labs you have favorited for quick access."})]})}),h.jsxs("div",{className:"mt-8",children:[v&&h.jsx("div",{className:"rounded-2xl border border-border bg-card/70 px-4 py-6 text-sm text-muted-foreground",children:"Loading favorites"}),s&&h.jsx("div",{className:"rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:s}),!v&&!s&&L.length===0&&h.jsx("div",{className:"rounded-2xl border border-border bg-card/70 px-4 py-6 text-sm text-muted-foreground",children:"You have no favorites yet. Browse labs and tap the heart to save them."}),L.length>0&&h.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:L.map(X=>{const ee=(X.labStatus||"listed").toLowerCase(),he=ee==="premier";return h.jsxs("div",{className:"rounded-2xl border border-border bg-card/80 p-4 shadow-sm flex h-full flex-col gap-3",children:[h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-foreground",children:X.name}),h.jsx("p",{className:"text-xs text-muted-foreground",children:[X.city,X.country].filter(Boolean).join(", ")||"Location not set"})]}),he&&h.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-[11px] font-medium text-primary",children:"Premium"})]}),h.jsxs("div",{className:"mt-auto space-y-3",children:[h.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[h.jsx("span",{children:X.isVisible===!1?"Hidden":"Visible"}),h.jsx("span",{className:"font-medium text-primary",children:ee})]}),h.jsx(xn,{href:`/labs/${X.id}`,className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"View lab"})]})]},X.id)})})]})]})})}function uie(){const[i]=Al(),{user:n,loading:a}=Ma(),{labs:d,updateLab:y}=Em();xv();const[v,C]=$.useState(null),[s,M]=$.useState(!0),[L,F]=$.useState(null),[W,X]=$.useState(!1),[ee,he]=$.useState([]),[se,oe]=$.useState(null),[ve,me]=$.useState(0),[Se,Re]=$.useState(0),[Be,rt]=$.useState([]),[We,Ct]=$.useState(!1),[Ht,Zt]=$.useState(!1),[rr,$t]=$.useState(null),[Rt,Gt]=$.useState(null),[Ar,Ut]=$.useState(""),[Xt,ut]=$.useState(""),[Mt,Qt]=$.useState("update"),[ze,It]=$.useState(null),[xr,Lr]=$.useState([]),[yn,Yr]=$.useState(!1),[Zr,Qr]=$.useState(!0),[ir,Hr]=$.useState([]),[Ur,Ti]=$.useState(!1),[Sn,Ci]=$.useState(null),[At,pt]=$.useState(!1),[Sr,Dr]=$.useState(null),Vr=_t=>_t===!0||_t==="true"||_t===1||_t==="1",[Ke,Je]=$.useState(!1),[jt,yr]=$.useState(null),[pr,Jt]=$.useState(!1),[Or,sn]=$.useState(null),[Mn,Gi]=$.useState(null),[yi,vt]=$.useState({addressLine1:"",addressLine2:"",city:"",state:"",postalCode:"",country:""}),[or,dn]=$.useState(""),[Ln,Bn]=$.useState(""),[Ze,ur]=$.useState(null),[kr,An]=$.useState(null),[ki,Yn]=$.useState(null),[Ri,ui]=$.useState(!1),[_i,Ds]=$.useState("overview"),[oo,Is]=$.useState("overview"),[ao,No]=$.useState({}),[Nt,us]=$.useState({}),[ks,fo]=$.useState({}),[vn,$e]=$.useState({}),[ne,ce]=$.useState({}),[be,De]=$.useState({}),[Ee,Fe]=$.useState({}),[et,qe]=$.useState({}),[fe,Ve]=$.useState({}),[Xe,ct]=$.useState(!1),tr=$.useMemo(()=>Object.values(ne).reduce((_t,Tr)=>_t+(Tr?.length??0),0),[ne]),cr=$.useMemo(()=>Object.values(ne).filter(_t=>(_t?.length??0)>0).length,[ne]),Nr=$.useMemo(()=>Object.values(ao).reduce((_t,Tr)=>_t+(Tr?.length??0),0),[ao]),Ir=$.useMemo(()=>Object.values(ao).filter(_t=>(_t?.length??0)>0).length,[ao]),jr=$.useMemo(()=>v?.display_name||v?.name||null,[v?.display_name,v?.name]),Rr=s||a,ni=$.useMemo(()=>Rr?"":jr||"Your Account",[Rr,jr]),$i=$.useMemo(()=>v?.email||n?.email||"",[v?.email,n?.email]),rs=$.useMemo(()=>jr||$i||"Your Account",[jr,$i]),Yi=$.useMemo(()=>jr||$i||"Unknown",[jr,$i]),Ii=$.useMemo(()=>{const Tr=(jr||n?.email||"?").replace(/@.*/,"").trim().split(/\s+/);return(Tr.length>=2?Tr[0][0]+Tr[1][0]:Tr[0][0]).toUpperCase()},[jr,n?.email]),gn=async _t=>{if(!(!_t||!n)){Dr(null),pt(!0);try{const Tr=_t.name.split(".").pop()?.toLowerCase()||"png",an=`${n.id}/${Date.now()}.${Tr}`,{error:Gn}=await fn.storage.from("avatars").upload(an,_t,{upsert:!0,contentType:_t.type});if(Gn)throw Gn;const{data:Ei}=fn.storage.from("avatars").getPublicUrl(an),_s=Ei.publicUrl,{error:na}=await fn.from("profiles").upsert({user_id:n.id,email:n.email,avatar_url:_s},{onConflict:"user_id"});if(na)throw na;C(Zs=>Zs&&{...Zs,avatar_url:_s})}catch(Tr){Dr(Tr?.message||"Failed to upload avatar.")}finally{pt(!1)}}};$.useEffect(()=>{async function _t(){if(!n){C(null),M(!1);return}const{data:Tr,error:an}=await fn.from("profiles").select(["user_id","email","display_name","name","is_admin","can_create_lab","can_manage_multiple_labs","can_manage_teams","can_manage_multiple_teams","can_post_news","can_broker_requests","can_receive_investor","avatar_url","created_at","updated_at"].join(",")).eq("user_id",n.id).maybeSingle();an?(F(an.message),C(null)):C(Tr??null),M(!1)}a||_t()},[a,n?.id]),$.useEffect(()=>{async function _t(){if(!n){he([]);return}X(!0);try{const{data:Tr}=await fn.auth.getSession(),an=Tr.session?.access_token,Gn=an?{Authorization:`Bearer ${an}`}:{},Ei=await fetch("/api/my-labs/analytics",{headers:Gn});if(Ei.ok){const _s=await Ei.json();he(_s?.labs??[]),oe(null)}else{const _s=await Ei.text();oe(_s||"Unable to load analytics")}try{const _s=await fetch("/api/my-labs/requests",{headers:Gn}),na=_s.headers.get("content-type")||"";if(_s.ok&&na.includes("application/json")){const Zs=await _s.json();me(Array.isArray(Zs?.collaborations)?Zs.collaborations.length:0),Re(Array.isArray(Zs?.contacts)?Zs.contacts.length:0)}}catch{}try{const _s=await fetch("/api/favorites",{headers:Gn}),na=_s.headers.get("content-type")||"";if(_s.ok&&na.includes("application/json")){const Zs=await _s.json(),qo=Array.isArray(Zs?.labIds)?Zs.labIds:[];rt(qo.map(Ql=>Number(Ql)).filter(Ql=>!Number.isNaN(Ql)))}}catch{}}catch(Tr){oe(Tr.message||"Unable to load dashboard data")}finally{X(!1)}}a||_t()},[a,n?.id]);const Ni=_t=>(_t.labStatus||_t.lab_status||"listed").toLowerCase(),In=_t=>Ni(_t)==="premier",di=ee.filter(_t=>_t.isVisible!==!1).length,Oi=ee.filter(_t=>_t.isVisible===!1).length,js=ee.filter(In),bs=ee.reduce((_t,Tr)=>_t+(Tr.views7d||0),0),Qi=ee.reduce((_t,Tr)=>_t+(Tr.views30d||0),0),po=ee.reduce((_t,Tr)=>_t+(Tr.favorites||0),0),Hi=ee.reduce((_t,Tr)=>Tr.views30d>(_t?.views30d??-1)?Tr:_t,ee.length?ee[0]:null),ws=ee.reduce((_t,Tr)=>Tr.favorites>(_t?.favorites??-1)?Tr:_t,ee.length?ee[0]:null),ra=Be.length?d.filter(_t=>Be.includes(_t.id)):[],Uo=js.length>0,lo=Vr(v?.can_create_lab),ot=lo&&Uo,br=_t=>{const an=ee.find(_s=>_s.id===_t)?.labStatus;if(an)return["verified_passive","verified_active","premier"].includes(an);const Gn=d.find(_s=>_s.id===_t),Ei=Gn?.labStatus??Gn?.lab_status;return["verified_passive","verified_active","premier"].includes(Ei)},pn=$.useMemo(()=>ee.filter(In),[ee]),Vn=$.useMemo(()=>d.filter(_t=>_t.ownerUserId===n?.id||_t.owner_user_id===n?.id||ee.some(Tr=>Tr.id===_t.id)),[d,ee,n?.id]),$n=$.useMemo(()=>Vn.filter(_t=>!br(_t.id)),[Vn]),jo=Vr(v?.can_create_lab),Il={name:"",title:"",linkedin:"",website:"",teamName:"",roleRank:"",isLead:!1};$.useEffect(()=>{if(ze)return;const _t=Vn[0]?.id??ee[0]?.id??null;_t&&It(_t)},[Vn,ee,ze]),$.useEffect(()=>{if(!Vn.length){No({}),ce({});return}No(Vn.reduce((_t,Tr)=>(_t[Tr.id]=Array.isArray(Tr.equipment)?Tr.equipment:[],_t),{})),ce(Vn.reduce((_t,Tr)=>(_t[Tr.id]=Array.isArray(Tr.teamMembers)?Tr.teamMembers:[],_t),{})),De(_t=>{const Tr={..._t};return Vn.forEach(an=>{Tr[an.id]||(Tr[an.id]={...Il})}),Tr}),Fe(_t=>{const Tr={..._t};return Vn.forEach(an=>{Tr[an.id]===void 0&&(Tr[an.id]=null)}),Tr})},[Vn]);async function eu(_t){if(!(!_t||!_t.length)){$t(null),Yr(!0);try{const Tr=Array.from(_t).slice(0,4-xr.length),an=[];for(const Gn of Tr){const Ei=Gn.name.replace(/\s+/g,"-").toLowerCase(),_s=`news/${n?.id??"anon"}/${Date.now()}-${Ei}`,{error:na}=await fn.storage.from("lab-news").upload(_s,Gn,{upsert:!0,contentType:Gn.type});if(na)throw na;const{data:Zs}=fn.storage.from("lab-news").getPublicUrl(_s);Zs?.publicUrl&&an.push({url:Zs.publicUrl,name:Gn.name})}Lr(Gn=>[...Gn,...an].slice(0,4))}catch(Tr){$t(Tr?.message||"Unable to upload photos")}finally{Yr(!1)}}}async function Rd(){if(!ze){$t("Select a lab to post this update.");return}if(!Ar.trim()||!Xt.trim()){$t("Title and summary are required.");return}Zt(!0),$t(null),Gt(null);try{const{data:_t}=await fn.auth.getSession(),Tr=_t.session?.access_token,an={"Content-Type":"application/json",...Tr?{Authorization:`Bearer ${Tr}`}:{}},Gn=await fetch("/api/news",{method:"POST",headers:an,body:JSON.stringify({labId:ze,title:Ar.trim(),summary:Xt.trim(),category:Mt,images:xr,authorId:n?.id??null})});if(!Gn.ok){const Ei=await Gn.text();throw new Error(Ei||"Unable to post news")}Gt("Sent! We'll review and publish it soon."),Ut(""),ut(""),Lr([]),Ct(!1)}catch(_t){$t(_t?.message||"Unable to post news")}finally{Zt(!1)}}const Lu=async(_t,Tr)=>{if(jo){fo(an=>({...an,[_t]:!0})),$e(an=>({...an,[_t]:null}));try{const an=await y(_t,{equipment:Tr});No(Gn=>({...Gn,[_t]:Array.isArray(an.equipment)?an.equipment:Tr}))}catch(an){$e(Gn=>({...Gn,[_t]:an?.message||"Unable to update equipment"}))}finally{fo(an=>({...an,[_t]:!1}))}}},Rs=async _t=>{const Tr=(Nt[_t]??"").trim();if(!Tr)return;const an=ao[_t]??[],Gn=Array.from(new Set([...an,Tr]));us(Ei=>({...Ei,[_t]:""})),No(Ei=>({...Ei,[_t]:Gn})),await Lu(_t,Gn)},$o=async(_t,Tr)=>{const Gn=(ao[_t]??[]).filter(Ei=>Ei!==Tr);No(Ei=>({...Ei,[_t]:Gn})),await Lu(_t,Gn)};async function La(){if(!or.trim()||!Ln.trim()){An("Topic and details are required.");return}ui(!0),An(null),Yn(null);try{const _t=await fetch("/api/legal-assist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:or.trim(),details:Ln.trim(),labId:Ze||void 0,name:Yi,email:v?.email||n?.email||""})});if(!_t.ok){const Tr=await _t.text();throw new Error(Tr||"Unable to send request")}Yn("Sent! Well connect you with our legal contact shortly."),dn(""),Bn(""),ur(ee[0]?.id??null)}catch(_t){An(_t?.message||"Unable to send request")}finally{ui(!1)}}$.useEffect(()=>{async function _t(){if(n){Ti(!0),Ci(null);try{const{data:Tr}=await fn.auth.getSession(),an=Tr.session?.access_token,Gn=an?{Authorization:`Bearer ${an}`}:{},Ei=await fetch("/api/news/mine",{headers:Gn}),_s=Ei.headers.get("content-type")||"";if(!Ei.ok||!_s.includes("application/json"))throw await Ei.text(),new Error("Unable to load news");const na=await Ei.json();Hr(Array.isArray(na?.news)?na.news:[])}catch(Tr){Ci(Tr?.message||"Unable to load news"),Hr([])}finally{Ti(!1)}}}a||_t()},[a,n?.id]),$.useEffect(()=>{try{const _t=new URLSearchParams(window.location.search),Tr=_t.get("tab"),an=_t.get("sub"),Gn=["overview","edit","requests","manageLab","manageTeams","adminLabs","favorites","legal"],Ei=["overview","labs","equipment","team","activity"];Tr&&Gn.includes(Tr)&&(Ds(Tr),Tr==="overview"&&an&&Ei.includes(an)&&Is(an))}catch{}},[i]),v&&Vr(v.can_broker_requests),v&&Vr(v.can_create_lab),v&&Vr(v.can_manage_teams),v&&Vr(v.is_admin),`${ra.length}`,v&&(Vr(v.can_create_lab)||Vr(v.can_manage_teams));const Fs=[{id:"overview",label:"Dashboard",icon:vT},{id:"labs",label:"Labs",icon:wT},{id:"team",label:"Team",icon:fm},{id:"activity",label:"Activity",icon:bT}];return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-20 lg:py-24 max-w-5xl",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs("label",{className:"group relative cursor-pointer",children:[h.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:_t=>{const Tr=_t.target.files?.[0]??null;gn(Tr),_t.target&&(_t.target.value="")},disabled:At}),h.jsxs(uC,{className:"h-14 w-14",children:[h.jsx(dC,{src:v?.avatar_url??void 0,alt:rs}),h.jsx(hC,{className:"text-base font-semibold bg-gradient-to-br from-indigo-500/20 to-pink-500/20 text-foreground",children:Ii})]}),h.jsx("span",{className:"pointer-events-none absolute inset-0 rounded-full bg-black/0 transition group-hover:bg-black/10"}),h.jsx("span",{className:"pointer-events-none absolute left-1/2 top-full mt-2 w-max -translate-x-1/2 rounded-full bg-foreground px-3 py-1 text-[10px] font-medium uppercase tracking-[0.2em] text-background opacity-0 transition group-hover:opacity-100",children:"Click to upload"}),At&&h.jsx("span",{className:"pointer-events-none absolute inset-0 flex items-center justify-center rounded-full bg-background/70 text-[10px] font-medium text-muted-foreground",children:"Uploading"})]}),h.jsxs("div",{className:"space-y-1",children:[h.jsx("div",{className:"flex flex-wrap items-center gap-2",children:h.jsx("h1",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:Rr?h.jsx("span",{className:"inline-block h-7 w-40 rounded bg-muted animate-pulse"}):ni})}),Rr?h.jsx("span",{className:"inline-block h-3 w-36 rounded bg-muted animate-pulse"}):h.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground",children:$i}),Sr&&h.jsx("p",{className:"text-xs text-destructive",children:Sr})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[v&&Vr(v.can_broker_requests)&&h.jsx("button",{type:"button",onClick:()=>Ds("requests"),className:`inline-flex h-10 w-10 items-center justify-center rounded-full border transition ${_i==="requests"?"border-primary/50 bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,"aria-label":"Requests",title:"Requests",children:h.jsx(bv,{className:"h-5 w-5"})}),h.jsx("button",{type:"button",onClick:()=>Ds("favorites"),className:`inline-flex h-10 w-10 items-center justify-center rounded-full border transition ${_i==="favorites"?"border-primary/50 bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,"aria-label":"Favorites",title:"Favorites",children:h.jsx(k2,{className:"h-5 w-5"})}),$n.length>0&&h.jsx("button",{type:"button",onClick:()=>{yr($n[0]?.id??null),Je(!0),sn(null)},className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Get Verified by GLASS"})]})]}),We&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-10",children:h.jsxs("div",{className:"relative w-full max-w-2xl rounded-3xl border border-border bg-card p-6 shadow-2xl",children:[h.jsx("button",{type:"button",className:"absolute right-4 top-4 text-muted-foreground hover:text-foreground",onClick:()=>Ct(!1),children:""}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Post a lab update"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"For premier/custom labs. Well review and feature these on the main page."}),h.jsxs("div",{className:"mt-4 grid gap-4",children:[h.jsxs("div",{className:"grid gap-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Lab"}),h.jsx("select",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:ze??"",onChange:_t=>It(Number(_t.target.value)),children:pn.map(_t=>h.jsx("option",{value:_t.id,children:_t.name},_t.id))})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Title"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"New equipment, collaboration call, milestone",value:Ar,onChange:_t=>Ut(_t.target.value)})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Summary"}),h.jsx("textarea",{className:"min-h-[120px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"Quick blurb for the homepage ticker.",value:Xt,onChange:_t=>ut(_t.target.value)})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Category"}),h.jsxs("select",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Mt,onChange:_t=>Qt(_t.target.value),children:[h.jsx("option",{value:"update",children:"Update"}),h.jsx("option",{value:"equipment",children:"New equipment"}),h.jsx("option",{value:"project",children:"New project"}),h.jsx("option",{value:"collaboration",children:"Collaboration request"}),h.jsx("option",{value:"announcement",children:"Announcement"})]})]}),h.jsxs("div",{className:"grid gap-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Photos (up to 4)"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:xr.map(_t=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("span",{className:"text-xs text-foreground break-all max-w-[160px] truncate",children:_t.name}),h.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-destructive",onClick:()=>Lr(Tr=>Tr.filter(an=>an.url!==_t.url)),children:"Remove"})]},_t.url))}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs("label",{className:"inline-flex cursor-pointer items-center gap-3",children:[h.jsx("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Upload photos"}),h.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:async _t=>{await eu(_t.target.files),_t.target&&(_t.target.value="")},disabled:xr.length>=4||yn})]}),yn&&h.jsx("span",{className:"text-xs text-muted-foreground",children:"Uploading"})]})]}),rr&&h.jsx("p",{className:"text-sm text-destructive",children:rr}),Rt&&h.jsx("p",{className:"text-sm text-emerald-600",children:Rt}),h.jsxs("div",{className:"flex items-center justify-end gap-3",children:[h.jsx("button",{type:"button",className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary",onClick:()=>Ct(!1),disabled:Ht,children:"Cancel"}),h.jsx("button",{type:"button",onClick:Rd,className:"rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-70",disabled:Ht,children:Ht?"Posting":"Post update"})]})]})]})}),h.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[220px_1fr]",children:[h.jsxs("aside",{className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Overview"}),h.jsx("div",{className:"space-y-1",children:Fs.map(_t=>{const Tr=_i==="overview"&&oo===_t.id||_i==="overview"&&oo==="equipment"&&_t.id==="labs"||_i==="manageLab"&&_t.id==="labs"||_i==="manageTeams"&&_t.id==="team",an=_t.icon;return h.jsx("button",{type:"button",onClick:()=>{Ds("overview"),Is(_t.id)},className:`w-full rounded-xl border px-3 py-2 text-left text-sm font-medium transition ${Tr?"border-primary/40 bg-primary/10 text-primary":"border-transparent text-muted-foreground hover:border-border hover:bg-muted/60 hover:text-foreground"}`,children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx(an,{className:"h-4 w-4"}),_t.label]})},_t.id)})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Account"}),h.jsxs("div",{className:"space-y-1",children:[h.jsx("button",{type:"button",onClick:()=>Ds("edit"),className:`w-full rounded-xl border px-3 py-2 text-left text-sm font-medium transition ${_i==="edit"?"border-primary/40 bg-primary/10 text-primary":"border-transparent text-muted-foreground hover:border-border hover:bg-muted/60 hover:text-foreground"}`,children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx(QM,{className:"h-4 w-4"}),"Edit account"]})}),v&&(Vr(v.can_create_lab)||Vr(v.can_manage_teams))&&h.jsx("button",{type:"button",onClick:()=>Ds("legal"),className:`w-full rounded-xl border px-3 py-2 text-left text-sm font-medium transition ${_i==="legal"?"border-primary/40 bg-primary/10 text-primary":"border-transparent text-muted-foreground hover:border-border hover:bg-muted/60 hover:text-foreground"}`,children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx(xc,{className:"h-4 w-4"}),"Legal assistance"]})}),v&&Vr(v.is_admin)&&h.jsx("button",{type:"button",onClick:()=>Ds("adminLabs"),className:`w-full rounded-xl border px-3 py-2 text-left text-sm font-medium transition ${_i==="adminLabs"?"border-primary/40 bg-primary/10 text-primary":"border-transparent text-muted-foreground hover:border-border hover:bg-muted/60 hover:text-foreground"}`,children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx(Ux,{className:"h-4 w-4"}),"Admin labs"]})})]})]})]}),h.jsxs("div",{className:"space-y-8",children:[$n.length>0&&h.jsx("div",{className:"flex justify-end",children:h.jsx("button",{type:"button",onClick:()=>{yr($n[0]?.id??null),Je(!0),sn(null)},className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Get Verified by GLASS"})}),_i==="overview"&&h.jsxs(h.Fragment,{children:[oo==="overview"&&h.jsx(h.Fragment,{children:lo?h.jsx("div",{className:"flex flex-col gap-6 lg:flex-row",children:h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex-1 rounded-3xl border border-border bg-gradient-to-br from-primary/5 via-background to-primary/10 p-8 shadow-sm",children:[h.jsxs("div",{className:"flex items-center justify-between gap-3 cursor-pointer select-none",onClick:()=>Qr(_t=>!_t),children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-primary/10 text-primary",children:h.jsx(vT,{className:"h-4 w-4"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Dashboard"}),h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Your activity at a glance"})]})]}),h.jsx("span",{className:"rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground",children:Zr?"Collapse":"Expand"})]}),Zr&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[h.jsx(Ry,{label:"Labs linked",value:ee.length.toString(),hint:Oi?`${Oi} hidden`:""}),h.jsx(Ry,{label:"Views (7d total)",value:bs.toString()}),h.jsx(Ry,{label:"Views (30d total)",value:Qi.toString()}),h.jsx(Ry,{label:"Favorites total",value:po.toString()}),h.jsx(Ry,{label:"Collab requests",value:ve.toString()}),h.jsx(Ry,{label:"Rent/contact requests",value:Se.toString()}),se&&h.jsx("div",{className:"col-span-full rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:se})]}),ee.length>0&&h.jsxs("div",{className:"mt-8 grid gap-4 md:grid-cols-2",children:[Hi&&h.jsx(n0,{title:"Best performing",subtitle:"Most views (30d)",primary:`${Hi.views30d} views`,secondary:Hi.name,badge:In(Hi)?"Premium":void 0}),ws&&h.jsx(n0,{title:"Most favorited",subtitle:"Total favorites",primary:`${ws.favorites} favorites`,secondary:ws.name,badge:In(ws)?"Premium":void 0})]}),ee.length>0&&h.jsxs("div",{className:"mt-8",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Linked labs"}),h.jsx("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:ee.map(_t=>{const Tr=Ni(_t),an=Tr==="premier";return h.jsxs("div",{className:"rounded-2xl border border-border bg-background/60 px-4 py-3 text-sm flex flex-col gap-2",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold text-foreground",children:_t.name}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[an?"Premier":Tr,"  ",_t.isVisible===!1?"Hidden":"Visible"]})]}),h.jsx(xn,{href:`/lab/manage/${_t.id}`,className:"text-xs font-medium text-primary hover:underline",children:"Manage"})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[h.jsxs("span",{className:"rounded-full border border-border px-2 py-1",children:["7d views: ",_t.views7d]}),h.jsxs("span",{className:"rounded-full border border-border px-2 py-1",children:["30d views: ",_t.views30d]}),h.jsxs("span",{className:"rounded-full border border-border px-2 py-1",children:["Favorites: ",_t.favorites]})]})]},_t.id)})})]})]})]})}):h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground",children:"Your dashboard unlocks once you have a premier lab or a multi-lab account."})}),oo==="labs"&&h.jsx(Jn.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-start justify-between gap-4",children:[h.jsxs("div",{children:[h.jsxs("h3",{className:"flex items-center gap-2 text-xl font-semibold text-foreground",children:[h.jsx(wT,{className:"h-5 w-5 text-primary"}),"Your lab overview"]}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"A structured snapshot of your linked labs, visibility, and equipment."})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("button",{type:"button",onClick:()=>Is("equipment"),className:"inline-flex items-center justify-center rounded-full border border-border bg-background px-4 py-2 text-xs font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"Add equipments"}),h.jsx("button",{type:"button",onClick:()=>Ds("manageLab"),className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground transition hover:bg-primary/90",children:"Manage labs"})]})]}),h.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[h.jsx(sm,{label:"Labs linked",value:ee.length.toString()}),h.jsx(sm,{label:"Visible",value:di.toString()}),h.jsx(sm,{label:"Hidden",value:Oi.toString()}),h.jsx(sm,{label:"Equipment",value:Nr.toString()}),h.jsx(sm,{label:"Labs with equipment",value:Ir.toString()})]}),ee.length>0&&h.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[Hi&&h.jsx(n0,{title:"Best performing",subtitle:"Most views (30d)",primary:`${Hi.views30d} views`,secondary:Hi.name,badge:In(Hi)?"Premium":void 0}),ws&&h.jsx(n0,{title:"Most favorited",subtitle:"Total favorites",primary:`${ws.favorites} favorites`,secondary:ws.name,badge:In(ws)?"Premium":void 0})]})]})}),oo==="equipment"&&h.jsxs(Jn.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsxs("button",{type:"button",onClick:()=>Is("labs"),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:[h.jsx(n_,{className:"h-3 w-3"}),"Back"]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(E$,{className:"h-4 w-4 text-primary"}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Equipment"})]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage equipment lists for each lab."})]}),Vn.length===0?h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground",children:"Add a lab profile to start listing equipment and capabilities."}):Vn.map(_t=>{const Tr=ao[_t.id]??[];return h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm space-y-4",children:[h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Equipment"}),h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:_t.name})]}),h.jsx("div",{className:"flex flex-wrap gap-2",children:Tr.length?Tr.map(an=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[an,jo&&h.jsx("button",{type:"button",onClick:()=>$o(_t.id,an),className:"text-muted-foreground hover:text-destructive",children:""})]},an)):h.jsx("p",{className:"text-sm text-muted-foreground",children:"No equipment listed yet."})}),jo&&h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("input",{className:"w-full max-w-sm rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"Add equipment and press Enter",value:Nt[_t.id]??"",onChange:an=>us(Gn=>({...Gn,[_t.id]:an.target.value})),onKeyDown:an=>{an.key==="Enter"&&(an.preventDefault(),Rs(_t.id))}}),h.jsx("button",{type:"button",onClick:()=>Rs(_t.id),className:"rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground transition hover:bg-primary/90",children:"Add equipment"}),ks[_t.id]&&h.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving"})]}),vn[_t.id]&&h.jsx("p",{className:"text-xs text-destructive",children:vn[_t.id]})]},_t.id)})]}),oo==="team"&&h.jsx(Jn.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:[h.jsxs("div",{className:"flex items-start justify-between gap-4",children:[h.jsxs("div",{children:[h.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[h.jsx(fm,{className:"h-4 w-4 text-primary"}),"Your team overview"]}),h.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Quick snapshot of team members across labs."})]}),h.jsx("button",{type:"button",onClick:()=>Ds("manageTeams"),className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground transition hover:bg-primary/90",children:"Manage teams"})]}),h.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[h.jsx(sm,{label:"Team members",value:tr.toString()}),h.jsx(sm,{label:"Labs with team",value:cr.toString()}),h.jsx(sm,{label:"Labs linked",value:ee.length.toString()})]})]})}),oo==="activity"&&h.jsx(Jn.div,{initial:{opacity:0,y:14},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:ot?h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:[h.jsx("div",{className:"mb-4 flex items-center justify-between gap-3",children:h.jsxs("div",{children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"News"}),h.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[h.jsx(bT,{className:"h-4 w-4 text-primary"}),"Recent updates from your labs"]})]})}),Ur&&h.jsx("div",{className:"rounded-2xl border border-border bg-background/70 px-4 py-3 text-sm text-muted-foreground",children:"Loading news"}),Sn&&h.jsxs("div",{className:"rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:[Sn,". You can still post a new update below."]}),!Ur&&h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("div",{className:"flex gap-4 min-w-full",children:[h.jsxs("div",{className:"min-w-[260px] rounded-2xl border border-dashed border-border bg-background/60 px-4 py-4 flex flex-col justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground mb-1",children:"Share an update"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Post equipment arrivals, collaborations, or milestones."})]}),h.jsx("button",{type:"button",onClick:()=>{Ct(!0),$t(null)},className:"mt-3 inline-flex items-center justify-center rounded-full bg-primary px-3 py-2 text-xs font-medium text-primary-foreground transition hover:bg-primary/90",children:"Create post"})]}),ir.length>0&&ir.map(_t=>{const Tr=_t.labs?.name||`Lab ${_t.lab_id}`,an=_t.created_at?new Date(_t.created_at).toLocaleDateString():"";return h.jsxs("div",{className:"min-w-[260px] max-w-[280px] rounded-2xl border border-border bg-background/70 p-4 flex flex-col gap-3",children:[h.jsx("div",{className:"flex items-center text-xs text-muted-foreground",children:h.jsx("span",{className:"rounded-full bg-muted/60 px-2 py-1 text-[11px] capitalize",children:_t.category||"update"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground line-clamp-2",children:_t.title}),h.jsx("p",{className:"mt-1 text-xs text-muted-foreground line-clamp-3",children:_t.summary})]}),h.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[h.jsx("span",{className:"truncate",children:Tr}),h.jsx("span",{className:"text-[11px]",children:an})]}),h.jsx("div",{className:"flex items-center gap-2",children:_t.images?.slice(0,2).map(Gn=>h.jsx("img",{src:Gn.url,alt:Gn.name||"news",className:"h-14 w-14 rounded-lg object-cover border border-border"},Gn.url))})]},_t.id)})]})})]}):h.jsx("div",{className:"rounded-3xl border border-border bg-card/80 p-6 text-sm text-muted-foreground",children:"News updates are available for premier and multi-lab accounts."})})]}),_i==="edit"&&h.jsx(hB,{embedded:!0}),_i==="requests"&&h.jsx(fB,{embedded:!0}),_i==="manageLab"&&h.jsxs("div",{className:"space-y-4",children:[h.jsx("div",{children:h.jsxs("button",{type:"button",onClick:()=>{Ds("overview"),Is("labs")},className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:[h.jsx(n_,{className:"h-3 w-3"}),"Back"]})}),h.jsx(pB,{embedded:!0})]}),_i==="manageTeams"&&h.jsx(mB,{embedded:!0,onBack:()=>{Ds("overview"),Is("team")}}),_i==="adminLabs"&&h.jsx(rB,{embedded:!0}),_i==="favorites"&&h.jsx(gB,{embedded:!0}),_i==="legal"&&h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-6 shadow-sm",children:[h.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[h.jsx(xc,{className:"h-4 w-4 text-primary"}),"Connect with legal support"]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Well connect you with our legal expert for contract help."}),h.jsxs("div",{className:"mt-4 grid gap-3",children:[h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Topic"}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:or,onChange:_t=>dn(_t.target.value)})]}),h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Details"}),h.jsx("textarea",{className:"min-h-[120px] w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Ln,onChange:_t=>Bn(_t.target.value),placeholder:"Share context and any timelines."})]}),ee.length>0&&h.jsxs("div",{className:"grid gap-1",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Related lab"}),h.jsxs("select",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:outline-none",value:Ze??"",onChange:_t=>ur(Number(_t.target.value)),children:[h.jsx("option",{value:"",children:"Select lab (optional)"}),ee.map(_t=>h.jsx("option",{value:_t.id,children:_t.name},_t.id))]})]}),kr&&h.jsx("p",{className:"text-sm text-destructive",children:kr}),ki&&h.jsx("p",{className:"text-sm text-emerald-600",children:ki}),h.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-3",children:[h.jsx("button",{type:"button",className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary",onClick:()=>{An(null),Yn(null),dn(""),Bn(""),ur(ee[0]?.id??null)},disabled:Ri,children:"Clear"}),h.jsx("button",{type:"button",onClick:La,className:"rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-70",disabled:Ri,children:Ri?"Sending":"Send"})]})]})]})]})]})]})})}function sm({label:i,value:n}){return h.jsxs("div",{className:"rounded-2xl border border-border/70 bg-background/70 px-4 py-3",children:[h.jsx("p",{className:"text-sm font-medium text-foreground/80",children:i}),h.jsx("p",{className:"mt-1 text-sm font-medium text-foreground",children:n})]})}function Ry({label:i,value:n,hint:a}){return h.jsxs("div",{className:"rounded-2xl border border-border bg-background/70 px-4 py-3",children:[h.jsx("p",{className:"text-sm font-medium text-foreground/80",children:i}),h.jsx("p",{className:"mt-1 text-2xl font-semibold text-foreground",children:n}),a?h.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:a}):null]})}function n0({title:i,subtitle:n,primary:a,secondary:d,badge:y}){return h.jsxs("div",{className:"rounded-2xl border border-border bg-background/70 px-4 py-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-foreground/80",children:i}),h.jsx("p",{className:"text-sm text-muted-foreground",children:n})]}),y?h.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-[11px] font-medium text-primary",children:y}):null]}),h.jsx("p",{className:"mt-2 text-2xl font-semibold text-foreground",children:a}),h.jsx("p",{className:"text-sm text-muted-foreground truncate",children:d})]})}const yB=$.createContext(void 0);async function i0(i,n){const{headers:a,...d}=n??{},y=await fetch(i,{...d,headers:{"Content-Type":"application/json",...a??{}}});if(!y.ok){let v="Request failed";try{const C=await y.json();C?.message&&(v=C.message)}catch{}throw new Error(v)}if(y.status!==204)return await y.json()}function die({children:i}){const[n,a]=$.useState([]),[d,y]=$.useState(!0),[v,C]=$.useState(null),[s,M]=$.useState(!1),L=$.useCallback(async(se=!1)=>{y(!0);try{M(se);const oe=await i0(se?"/api/teams?includeHidden=true":"/api/teams"),ve=se?oe:oe.filter(me=>me.isVisible!==!1);a(ve),C(null)}catch(oe){const ve=oe instanceof Error?oe.message:"Unable to load teams";C(ve)}finally{y(!1)}},[]);$.useEffect(()=>{L(s)},[L,s]);const F=$.useCallback(async se=>{const oe=await i0("/api/teams",{method:"POST",body:JSON.stringify(se)});return a(ve=>{const me=[...ve,oe];return s?me:me.filter(Se=>Se.isVisible!==!1)}),oe},[s]),W=$.useCallback(async(se,oe)=>{const ve=await i0(`/api/teams/${se}`,{method:"PUT",body:JSON.stringify(oe)});return a(me=>{const Se=me.map(Re=>Re.id===se?ve:Re);return s?Se:Se.filter(Re=>Re.isVisible!==!1)}),ve},[s]),X=$.useCallback(async se=>{await i0(`/api/teams/${se}`,{method:"DELETE"}),a(oe=>oe.filter(ve=>ve.id!==se))},[]),ee=$.useCallback(async(se=s)=>{await L(se)},[L,s]),he=$.useMemo(()=>({teams:n,isLoading:d,error:v,refresh:ee,addTeam:F,updateTeam:W,removeTeam:X}),[n,d,v,ee,F,W,X]);return h.jsx(yB.Provider,{value:he,children:i})}function hie(){const i=$.useContext(yB);if(!i)throw new Error("useTeams must be used within a TeamsProvider");return i}function fie(){const{teams:i,isLoading:n,error:a,refresh:d}=hie(),[y,v]=$.useState(""),[,C]=Al(),s=X=>X.split(" ").map(ee=>ee.trim()[0]).filter(Boolean).slice(0,2).join("").toUpperCase(),M=$.useMemo(()=>i.filter(X=>X.isVisible!==!1),[i]),L=M.length,F=X=>{const ee=X.labs[0];return ee?[ee.city,ee.country].filter(Boolean).join(", "):""},W=$.useMemo(()=>{const X=y.trim().toLowerCase();return X?M.filter(ee=>{const he=ee.labs.map(ve=>[ve.name,ve.city,ve.country].filter(Boolean).join(" ")).join(" "),se=ee.techniques.map(ve=>ve.name).join(" ");return[ee.name,ee.field,ee.descriptionShort,ee.descriptionLong,ee.equipment.join(" "),ee.priorityEquipment.join(" "),ee.focusAreas.join(" "),se,he].filter(Boolean).join(" ").toLowerCase().includes(X)}):M},[M,y]);return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-12 lg:py-16",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.6},className:"max-w-3xl",children:[h.jsx("span",{className:"text-sm uppercase tracking-[0.35em] text-muted-foreground",children:"Research Teams"}),h.jsx("h1",{className:"mt-4 text-4xl md:text-5xl font-semibold leading-tight",children:"Explore specialized teams and their scientific focus."}),h.jsx("p",{className:"mt-4 text-lg text-muted-foreground leading-relaxed",children:"Teams highlight their core equipment, techniques, and focus areas so partners can match with the right expertise quickly."})]}),h.jsxs("div",{className:"mt-8 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[h.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",W.length," of ",L," teams"]}),h.jsxs("div",{className:"relative w-full sm:w-80",children:[h.jsx("input",{type:"search",value:y,onChange:X=>v(X.target.value),placeholder:"Search teams by name, field, or technique",className:"w-full rounded-full border border-border bg-card/80 px-4 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"}),h.jsx(Ad,{className:"pointer-events-none absolute right-3 top-2.5 h-4 w-4 text-muted-foreground"})]})]}),n?h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Loading teams..."}):a?h.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:[h.jsx("span",{children:a}),h.jsx("button",{type:"button",onClick:()=>d(),className:"rounded-full border border-destructive/40 px-3 py-1 text-xs font-medium text-destructive",children:"Retry"})]}):h.jsx("div",{className:"mt-8 grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:W.slice().sort((X,ee)=>{const he=(X.photos?.[0]?.url??"").trim().length>0,se=(ee.photos?.[0]?.url??"").trim().length>0;return he===se?0:he?-1:1}).map(X=>{const ee=X.priorityEquipment.length>0?X.priorityEquipment.slice(0,3):X.equipment.slice(0,3),he=F(X),se=(X.photos?.[0]?.url??"").trim().length>0,oe=se?X.photos[0]?.url:"/images/team-placeholder.png",ve=X.logoUrl||X.labs[0]?.logoUrl||null;return h.jsxs(Jn.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},whileHover:{scale:1.02},className:"group relative flex h-full min-h-[420px] flex-col overflow-hidden rounded-3xl border border-border bg-card/80 shadow-sm will-change-transform cursor-pointer",role:"link",tabIndex:0,onClick:()=>C(`/teams/${X.id}`),onKeyDown:me=>{me.key!=="Enter"&&me.key!==" "||(me.preventDefault(),C(`/teams/${X.id}`))},children:[h.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-white/80 via-white/70 to-sky-100/80 opacity-0 transition-opacity duration-300 ease-out group-hover:opacity-100"}),h.jsxs("div",{className:"relative z-10 flex h-full flex-col",children:[oe&&h.jsx("div",{className:"h-36 w-full overflow-hidden border-b border-border/60 bg-background/40",children:h.jsx("img",{src:oe,alt:X.name,className:`h-full w-full object-cover ${se?"":"object-bottom"}`})}),h.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-6",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("div",{className:"flex items-start justify-between gap-3",children:h.jsxs("div",{children:[h.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border/70 bg-white/70 px-3 py-1.5 text-[11px] font-medium text-muted-foreground",children:[h.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center overflow-hidden rounded-full border border-white/80 bg-white text-[10px] text-muted-foreground",children:ve?h.jsx("img",{src:ve,alt:`${X.name} avatar`,className:"h-full w-full object-cover"}):s(X.name)}),"Team"]}),h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:X.name})]}),X.descriptionShort&&h.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:X.descriptionShort}),X.field&&h.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[h.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-[0.25em] text-muted-foreground",children:"Focus on"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:X.field.split("/").map(me=>me.trim()).filter(Boolean).map(me=>h.jsx("span",{className:"rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground",children:me},me))})]})]})}),h.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:ee.map(me=>h.jsx("span",{className:"rounded-full border border-border px-2 py-1",children:me},me))})]}),h.jsx("div",{className:"mt-auto space-y-2",children:h.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[h.jsxs("span",{className:"inline-flex items-center gap-1",children:[h.jsx(fm,{className:"h-3.5 w-3.5 text-primary"}),X.members.length," members"]}),he&&h.jsxs("span",{className:"inline-flex items-center gap-1",children:[h.jsx(Ad,{className:"h-3.5 w-3.5 text-primary"}),he]}),X.techniques.length>0&&h.jsxs("span",{className:"inline-flex items-center gap-1",children:[h.jsx(Bx,{className:"h-3.5 w-3.5 text-primary"}),X.techniques.length," techniques"]})]})})]})]})]},X.id)})})]})})}function pie({params:i}){const n=Number(i.id),[a,d]=$.useState(null),[y,v]=$.useState(!0),[C,s]=$.useState(null),[M,L]=$.useState(!1),[F,W]=$.useState(!1),[X,ee]=$.useState(null);$.useEffect(()=>{let We=!0;async function Ct(){if(Number.isNaN(n)){s("Invalid team id"),v(!1);return}v(!0);try{const Ht=await fetch(`/api/teams/${n}`);if(!Ht.ok){const rr=await Ht.json().catch(()=>({}));throw new Error(rr?.message||"Unable to load team")}const Zt=await Ht.json();We&&(d(Zt),s(null))}catch(Ht){We&&s(Ht instanceof Error?Ht.message:"Unable to load team")}finally{We&&v(!1)}}return Ct(),()=>{We=!1}},[n]);const he=a?.photos??[],se=a?.members??[],oe=a?.techniques??[],ve=a?.equipment??[],me=a?.focusAreas??[],Se=$.useMemo(()=>a?a.priorityEquipment.length>0?a.priorityEquipment:ve.slice(0,3):[],[a,ve]),Re=$.useMemo(()=>{if(!a)return[];const We=new Set(a.priorityEquipment);return ve.filter(Ct=>!We.has(Ct))},[a,ve]),Be=se.filter(We=>We.isLead),rt=se.filter(We=>!We.isLead);return y?h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 py-20 lg:py-24",children:h.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading team..."})})}):C||!a?h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 py-20 lg:py-24",children:h.jsx("p",{className:"text-sm text-destructive",children:C||"Team not found."})})}):h.jsxs("section",{className:"bg-background min-h-screen",children:[h.jsxs("div",{className:"container mx-auto px-4 py-12 lg:py-16 max-w-6xl",children:[h.jsxs(xn,{href:"/teams",className:"text-sm text-muted-foreground hover:text-primary inline-flex items-center gap-2",children:[h.jsx(n_,{className:"h-4 w-4"}),"Back to teams"]}),h.jsxs("div",{className:"mt-6 flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-3",children:[h.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[h.jsx("h1",{className:"text-3xl md:text-4xl font-semibold text-foreground",children:a.name}),a.field&&h.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary",children:a.field})]}),a.descriptionShort&&h.jsx("p",{className:"text-base text-muted-foreground max-w-2xl",children:a.descriptionShort}),h.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[h.jsxs("span",{className:"inline-flex items-center gap-1",children:[h.jsx(fm,{className:"h-4 w-4 text-primary"}),se.length," members"]}),a.labs[0]?.city&&h.jsxs("span",{className:"inline-flex items-center gap-1",children:[h.jsx(Ad,{className:"h-4 w-4 text-primary"}),[a.labs[0].city,a.labs[0].country].filter(Boolean).join(", ")]}),oe.length>0&&h.jsxs("span",{className:"inline-flex items-center gap-1",children:[h.jsx(Bx,{className:"h-4 w-4 text-primary"}),oe.length," techniques"]})]}),a.website&&h.jsxs("a",{href:a.website,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-foreground transition hover:border-primary hover:text-primary",children:["Visit team website",h.jsx(Sl,{className:"h-3.5 w-3.5"})]})]}),a.logoUrl&&h.jsx("div",{className:"h-32 w-32 overflow-hidden rounded-3xl border border-border bg-background/80",children:h.jsx("img",{src:a.logoUrl,alt:a.name,className:"h-full w-full object-cover"})})]}),he.length>0&&h.jsxs("div",{className:"mt-8 rounded-3xl border border-border bg-card/70 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Team gallery"}),h.jsx("div",{className:"mt-4 flex gap-4 overflow-x-auto pb-2",children:he.map((We,Ct)=>{const Ht=`${a.name} photo - ${We.name}`;return h.jsx("button",{type:"button",onClick:()=>ee({index:Ct}),className:"h-40 w-60 flex-shrink-0 overflow-hidden rounded-2xl border border-border bg-background cursor-zoom-in","aria-label":`Open ${Ht}`,children:h.jsx("img",{src:We.url,alt:Ht,className:"h-full w-full object-cover"})},We.url)})})]}),a.descriptionLong&&h.jsxs("div",{className:"mt-8 rounded-3xl border border-border bg-card/70 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"About this team"}),h.jsx("p",{className:"mt-3 text-sm text-muted-foreground leading-relaxed whitespace-pre-line",children:a.descriptionLong})]}),h.jsxs("section",{className:"mt-8 rounded-3xl border border-border bg-card/70 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Equipment"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Priority equipment is highlighted first, followed by the full list."}),h.jsx("div",{className:"mt-4 flex flex-wrap gap-2 text-sm text-muted-foreground",children:Se.map(We=>h.jsx("span",{className:"rounded-full border border-primary/40 bg-primary/5 px-3 py-1 font-semibold text-primary",children:We},We))}),h.jsxs("div",{className:"mt-4 grid gap-2 text-sm text-muted-foreground",children:[(F?Re:Re.slice(0,6)).map(We=>h.jsxs("div",{className:"inline-flex items-center gap-2",children:[h.jsx(Bx,{className:"h-4 w-4 text-primary"}),We]},We)),ve.length===0&&h.jsx("span",{children:"No equipment listed yet."})]}),Re.length>6&&h.jsx("button",{type:"button",onClick:()=>W(We=>!We),className:"mt-4 inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:F?"Show fewer":`Show ${Re.length-6} more`})]}),h.jsxs("section",{className:"mt-8 rounded-3xl border border-border bg-card/70 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Techniques & expertise"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Detailed methods and domains where the team delivers value."}),h.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[oe.map(We=>h.jsxs("div",{className:"rounded-2xl border border-border px-4 py-3",children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:We.name}),We.description&&h.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:We.description})]},We.name)),oe.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"No techniques listed yet."})]})]}),h.jsxs("section",{className:"mt-8 grid gap-6 lg:grid-cols-2",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Focus areas"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Scientific domains the team supports."}),h.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-sm text-muted-foreground",children:[me.map(We=>h.jsx("span",{className:"rounded-full border border-border px-3 py-1",children:We},We)),me.length===0&&h.jsx("span",{children:"No focus areas listed yet."})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Team members"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Meet the people leading this research team."})]}),h.jsxs("button",{type:"button",onClick:()=>L(!0),className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:["View team",h.jsx(Sl,{className:"h-4 w-4"})]})]}),Be.length>0&&h.jsxs("div",{className:"mt-4 rounded-2xl border border-primary/30 bg-primary/5 px-4 py-3",children:[h.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Lead"}),Be.map(We=>h.jsxs("p",{className:"mt-2 text-sm font-medium text-foreground",children:[We.name," - ",We.role]},We.name))]})]})]}),a.labs.length>0&&h.jsxs("section",{className:"mt-8 rounded-3xl border border-border bg-card/70 p-6",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Connected labs"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"The labs this team is linked to."}),h.jsx("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:a.labs.map(We=>h.jsxs(xn,{href:`/labs/${We.id}`,className:"flex items-center gap-3 rounded-2xl border border-border px-4 py-3 text-sm text-muted-foreground transition hover:border-primary hover:text-primary",children:[We.logoUrl&&h.jsx("img",{src:We.logoUrl,alt:We.name,className:"h-10 w-10 rounded-full border border-border object-cover"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:We.name}),h.jsx("p",{className:"text-xs text-muted-foreground",children:[We.city,We.country].filter(Boolean).join(", ")})]})]},We.id))})]})]}),M&&h.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-3xl rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Team members"}),h.jsx("button",{type:"button",onClick:()=>L(!1),className:"rounded-full border border-border px-3 py-1 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Close"})]}),h.jsxs("div",{className:"mt-4 space-y-4 max-h-[60vh] overflow-y-auto pr-1",children:[Be.map(We=>h.jsxs("div",{className:"rounded-2xl border border-primary/30 bg-primary/5 px-4 py-3",children:[h.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Lead"}),h.jsx("p",{className:"mt-2 text-sm font-medium text-foreground",children:We.name}),h.jsx("p",{className:"text-xs text-muted-foreground",children:We.role}),(We.linkedin||We.website)&&h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground",children:[We.linkedin&&h.jsxs("a",{href:We.linkedin,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["LinkedIn",h.jsx(Sl,{className:"h-3 w-3"})]}),We.website&&h.jsxs("a",{href:We.website,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["Website",h.jsx(Sl,{className:"h-3 w-3"})]})]})]},We.name)),rt.map(We=>h.jsxs("div",{className:"rounded-2xl border border-border px-4 py-3",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:We.name}),h.jsx("p",{className:"text-xs text-muted-foreground",children:We.role}),(We.linkedin||We.website)&&h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground",children:[We.linkedin&&h.jsxs("a",{href:We.linkedin,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["LinkedIn",h.jsx(Sl,{className:"h-3 w-3"})]}),We.website&&h.jsxs("a",{href:We.website,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1 hover:border-primary hover:text-primary",children:["Website",h.jsx(Sl,{className:"h-3 w-3"})]})]})]},We.name)),Be.length===0&&rt.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"No members listed yet."})]})]})}),X&&h.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8 backdrop-blur",onClick:()=>ee(null),children:h.jsxs("div",{className:"relative w-full max-w-5xl overflow-hidden rounded-3xl border border-white/30 bg-white/25 shadow-2xl backdrop-blur-2xl",onClick:We=>We.stopPropagation(),children:[h.jsx("button",{type:"button",onClick:()=>ee(null),className:"absolute right-4 top-4 z-10 inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/40 bg-white/25 text-sm text-white/90 backdrop-blur transition hover:bg-white/40","aria-label":"Close",children:""}),h.jsxs("div",{className:"relative flex items-center justify-center bg-white/10 p-4",children:[h.jsx("button",{type:"button",onClick:()=>ee(We=>{if(!We)return We;const Ct=he.length;return{index:(We.index-1+Ct)%Ct}}),className:"absolute left-4 top-1/2 -translate-y-1/2 inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/40 bg-white/25 text-white/90 backdrop-blur transition hover:bg-white/40","aria-label":"Previous photo",children:""}),h.jsx("img",{src:he[X.index]?.url??"",alt:`${a.name} photo ${X.index+1} - ${he[X.index]?.name??""}`,className:"max-h-[75vh] w-auto max-w-full object-contain rounded-2xl"}),h.jsx("button",{type:"button",onClick:()=>ee(We=>{if(!We)return We;const Ct=he.length;return{index:(We.index+1)%Ct}}),className:"absolute right-4 top-1/2 -translate-y-1/2 inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/40 bg-white/25 text-white/90 backdrop-blur transition hover:bg-white/40","aria-label":"Next photo",children:""})]})]})})]})}const qR={name:"",role:"",email:"",linkedin:"",website:"",isLead:!1},GR={name:"",description:""},om=2,wx=i=>{const n=i?.toString().trim()??"";return n?/^https?:\/\//i.test(n)?n:`https://${n}`:null};function WR({params:i}){const{user:n}=Ma(),{hasFunctionalConsent:a}=w_(),[,d]=Al(),y=i?.id!==void 0,v=y?Number(i.id):null,C=y,[s,M]=$.useState({name:"",descriptionShort:"",descriptionLong:"",field:"",website:"",linkedin:"",logoUrl:"",equipment:[],priorityEquipment:[],focusAreas:[],techniques:[],members:[],labIds:[],photos:[]}),[L,F]=$.useState(""),[W,X]=$.useState(""),[ee,he]=$.useState(qR),[se,oe]=$.useState(GR),[ve,me]=$.useState(""),[Se,Re]=$.useState(!1),[Be,rt]=$.useState(null),[We,Ct]=$.useState(!1),[Ht,Zt]=$.useState(null),[rr,$t]=$.useState(!1),Rt=$.useMemo(()=>`team-draft:${v??"new"}`,[v]),[Gt,Ar]=$.useState([]),[Ut,Xt]=$.useState([]),[ut,Mt]=$.useState([]),[Qt,ze]=$.useState(""),[It,xr]=$.useState(null),[Lr,yn]=$.useState(null),[Yr,Zr]=$.useState(!0),[Qr,ir]=$.useState(!1),[Hr,Ur]=$.useState(null),[Ti,Sn]=$.useState(null);$.useEffect(()=>{let vt=!0;async function or(){try{const dn=await fetch("/api/labs?includeHidden=true");if(!dn.ok)return;const Ln=await dn.json();vt&&Ar(Ln??[])}catch{}}return or(),()=>{vt=!1}},[]),$.useEffect(()=>{let vt=!0;async function or(){if(!C){Zr(!1);return}if(v===null||Number.isNaN(v)){Ur("Invalid team id."),Zr(!1);return}Zr(!0);try{const{data:dn}=await fn.auth.getSession(),Ln=dn.session?.access_token,Bn=await fetch(`/api/my-team/${v}`,{headers:Ln?{Authorization:`Bearer ${Ln}`}:{}});if(!Bn.ok){const kr=await Bn.json().catch(()=>({}));throw new Error(kr?.message||"Unable to load team")}const Ze=await Bn.json();if(!vt)return;const ur={name:Ze.name,descriptionShort:Ze.descriptionShort??"",descriptionLong:Ze.descriptionLong??"",field:Ze.field??"",website:Ze.website??"",linkedin:Ze.linkedin??"",logoUrl:Ze.logoUrl??"",equipment:Ze.equipment??[],priorityEquipment:Ze.priorityEquipment??[],focusAreas:Ze.focusAreas??[],techniques:Ze.techniques??[],members:Ze.members??[],labIds:Ze.labIds??[],photos:Ze.photos??[]};M(ur),Xt(Ze.labs??[]),Ur(null)}catch(dn){vt&&Ur(dn instanceof Error?dn.message:"Unable to load team")}finally{vt&&Zr(!1)}}return or(),()=>{vt=!1}},[C,v]),$.useEffect(()=>{if(!(!a||Yr||rr))try{const vt=localStorage.getItem(Rt);if(!vt){$t(!0);return}const or=JSON.parse(vt);or?.form&&M(dn=>({...dn,...or.form})),or?.equipmentInput!==void 0&&F(or.equipmentInput),or?.focusInput!==void 0&&X(or.focusInput),or?.memberInput&&he(or.memberInput),or?.techniqueInput&&oe(or.techniqueInput),or?.photoUrlInput!==void 0&&me(or.photoUrlInput)}catch{}finally{$t(!0)}},[Rt,rr,Yr,a]),$.useEffect(()=>{if(!a||!rr)return;const vt=window.setTimeout(()=>{const or={form:s,equipmentInput:L,focusInput:W,memberInput:ee,techniqueInput:se,photoUrlInput:ve};localStorage.setItem(Rt,JSON.stringify(or))},250);return()=>window.clearTimeout(vt)},[Rt,rr,s,L,W,ee,se,ve,a]),$.useEffect(()=>{if(!C||!v)return;let vt=!0;async function or(){try{const{data:dn}=await fn.auth.getSession(),Ln=dn.session?.access_token,Bn=await fetch(`/api/teams/${v}/link-requests`,{headers:Ln?{Authorization:`Bearer ${Ln}`}:{}});if(!Bn.ok){const ur=await Bn.json().catch(()=>({}));throw new Error(ur?.message||"Unable to load link requests")}const Ze=await Bn.json();vt&&Mt(Ze??[])}catch(dn){vt&&xr(dn instanceof Error?dn.message:"Unable to load link requests")}}return or(),()=>{vt=!1}},[C,v]);const Ci=(vt,or)=>{const dn=or.trim();dn&&M(Ln=>{const Bn=new Set(Ln[vt]);return Bn.add(dn),{...Ln,[vt]:Array.from(Bn)}})},At=(vt,or)=>{M(dn=>{const Ln=dn[vt].filter(Ze=>Ze!==or),Bn={...dn,[vt]:Ln};return vt==="equipment"&&(Bn.priorityEquipment=dn.priorityEquipment.filter(Ze=>Ze!==or)),Bn})},pt=vt=>{M(or=>{const dn=new Set(or.priorityEquipment);if(dn.has(vt))dn.delete(vt);else{if(dn.size>=3)return or;dn.add(vt)}return{...or,priorityEquipment:Array.from(dn)}})},Sr=()=>{if(!ee.name.trim()||!ee.role.trim()){Ur("Team member name and role are required.");return}const vt={...ee,name:ee.name.trim(),role:ee.role.trim(),email:ee.email?.toString().trim()||null,linkedin:wx(ee.linkedin?.toString()??null),website:wx(ee.website?.toString()??null),isLead:!!ee.isLead};M(or=>({...or,members:[...or.members,vt]})),he(qR),Ur(null)},Dr=vt=>{M(or=>({...or,members:or.members.filter((dn,Ln)=>Ln!==vt)}))},Vr=()=>{if(!se.name.trim()){Ur("Technique name is required.");return}const vt={name:se.name.trim(),description:se.description?.toString().trim()||null};M(or=>({...or,techniques:[...or.techniques,vt]})),oe(GR),Ur(null)},Ke=vt=>{M(or=>({...or,techniques:or.techniques.filter((dn,Ln)=>Ln!==vt)}))},Je=()=>{const vt=ve.trim();if(!vt)return;if(s.photos.length>=om){rt(`Limit ${om} photos per team.`);return}const or={name:vt.split("/").pop()??`Photo ${s.photos.length+1}`,url:vt};M(dn=>({...dn,photos:[...dn.photos,or]})),me(""),rt(null)},jt=vt=>{M(or=>({...or,photos:or.photos.filter(dn=>dn.url!==vt.url)}))};async function yr(vt){const or=vt.target.files?.[0];if(or){if(s.photos.length>=om){rt(`Limit ${om} photos per team.`);return}rt(null),Re(!0);try{const dn=or.name.split(".").pop()||"jpg",Ln=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${dn}`,Ze=`teams/${C&&v?v:"new"}/photos/${Ln}`,{error:ur}=await fn.storage.from("team-photos").upload(Ze,or,{upsert:!0,contentType:or.type});if(ur)throw ur;const{data:kr}=fn.storage.from("team-photos").getPublicUrl(Ze),An=kr.publicUrl,ki={name:or.name,url:An};M(Yn=>({...Yn,photos:[...Yn.photos,ki]}))}catch(dn){rt(dn?.message||"Unable to upload photo")}finally{Re(!1),vt.target&&(vt.target.value="")}}}async function pr(vt){const or=vt.target.files?.[0];if(or){Zt(null),Ct(!0);try{const dn=or.name.split(".").pop()||"png",Ln=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${dn}`,Ze=`teams/${C&&v?v:"new"}/logo/${Ln}`,{error:ur}=await fn.storage.from("team-logos").upload(Ze,or,{upsert:!0,contentType:or.type});if(ur)throw ur;const{data:kr}=fn.storage.from("team-logos").getPublicUrl(Ze);M(An=>({...An,logoUrl:kr.publicUrl})),Sn("Logo uploaded.")}catch(dn){Zt(dn?.message||"Unable to upload logo")}finally{Ct(!1),vt.target&&(vt.target.value="")}}}const Jt=async()=>{if(!n){Ur("Sign in to save a team.");return}if(!s.name.trim()){Ur("Team name is required.");return}ir(!0),Ur(null),Sn(null);try{const{data:vt}=await fn.auth.getSession(),or=vt.session?.access_token,dn={...s,name:s.name.trim(),descriptionShort:s.descriptionShort.trim()||null,descriptionLong:s.descriptionLong.trim()||null,field:s.field.trim()||null,website:wx(s.website),linkedin:wx(s.linkedin),logoUrl:wx(s.logoUrl)};if(C&&(v===null||Number.isNaN(v)))throw new Error("Invalid team id.");const Ln=await fetch(C?`/api/my-team/${v}`:"/api/teams",{method:C?"PUT":"POST",headers:{"Content-Type":"application/json",...or?{Authorization:`Bearer ${or}`}:{}},body:JSON.stringify(dn)});if(!Ln.ok){const Ze=await Ln.json().catch(()=>({}));throw new Error(Ze?.message||"Unable to save team")}const Bn=await Ln.json();Sn(C?"Team updated.":"Team created."),C||d("/account?tab=manageTeams")}catch(vt){Ur(vt instanceof Error?vt.message:"Unable to save team")}finally{ir(!1)}},Or=$.useMemo(()=>Gt.map(vt=>({...vt,location:[vt.city,vt.country].filter(Boolean).join(", ")})),[Gt]),sn=$.useMemo(()=>new Set(Ut.map(vt=>vt.id)),[Ut]),Mn=$.useMemo(()=>new Set(ut.filter(vt=>vt.status==="pending").map(vt=>vt.lab_id)),[ut]),Gi=$.useMemo(()=>Or.filter(vt=>!sn.has(vt.id)&&!Mn.has(vt.id)),[Or,sn,Mn]),yi=async()=>{if(!(!C||!v)){if(!Qt){xr("Choose a lab to request.");return}xr(null),yn(null);try{const{data:vt}=await fn.auth.getSession(),or=vt.session?.access_token,dn=await fetch(`/api/teams/${v}/link-requests`,{method:"POST",headers:{"Content-Type":"application/json",...or?{Authorization:`Bearer ${or}`}:{}},body:JSON.stringify({labId:Qt})});if(!dn.ok){const Bn=await dn.json().catch(()=>({}));throw new Error(Bn?.message||"Unable to send request")}yn("Request sent to lab owner."),ze("");const Ln=await fetch(`/api/teams/${v}/link-requests`,{headers:or?{Authorization:`Bearer ${or}`}:{}});if(Ln.ok){const Bn=await Ln.json();Mt(Bn??[])}}catch(vt){xr(vt instanceof Error?vt.message:"Unable to send request")}}};return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-16 lg:py-20 max-w-5xl",children:[h.jsxs(xn,{href:"/account?tab=manageTeams",className:"text-sm text-muted-foreground hover:text-primary inline-flex items-center gap-2",children:[h.jsx(n_,{className:"h-4 w-4"}),"Back to teams"]}),h.jsxs("div",{className:"mt-4 flex items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:C?"Edit team profile":"Create a new team"}),h.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Highlight expertise, techniques, and linked labs."})]}),h.jsx("button",{type:"button",onClick:Jt,disabled:Qr,className:"inline-flex items-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-60",children:Qr?"Saving...":C?"Save team":"Create team"})]}),Yr?h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Loading team..."}):h.jsxs("div",{className:"mt-8 space-y-8",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Basics"}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Team name"}),h.jsx("input",{value:s.name,onChange:vt=>M(or=>({...or,name:vt.target.value})),className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Team name"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Field"}),h.jsx("input",{value:s.field,onChange:vt=>M(or=>({...or,field:vt.target.value})),className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Field of science"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Website"}),h.jsx("input",{value:s.website,onChange:vt=>M(or=>({...or,website:vt.target.value})),className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"team-website.com"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"LinkedIn"}),h.jsx("input",{value:s.linkedin,onChange:vt=>M(or=>({...or,linkedin:vt.target.value})),className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"linkedin.com/company/..."})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Logo URL"}),h.jsx("input",{value:s.logoUrl,onChange:vt=>M(or=>({...or,logoUrl:vt.target.value})),className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"https://"}),h.jsxs("label",{className:"inline-flex items-center gap-3",children:[h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose logo",h.jsx("input",{type:"file",accept:"image/*",onChange:pr,className:"hidden"})]}),We&&h.jsx("span",{className:"text-xs text-muted-foreground",children:"Uploading logo..."})]}),Ht&&h.jsx("p",{className:"text-xs text-destructive",children:Ht})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Short description"}),h.jsx("textarea",{value:s.descriptionShort,onChange:vt=>M(or=>({...or,descriptionShort:vt.target.value})),rows:3,className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"One-paragraph summary used in listings."})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Long description"}),h.jsx("textarea",{value:s.descriptionLong,onChange:vt=>M(or=>({...or,descriptionLong:vt.target.value})),rows:5,className:"w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Full team narrative and specialization details."})]})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Team photos"}),h.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.photos.length,"/",om]})]}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Add up to ",om," photos to showcase the team."]}),h.jsx("div",{className:"flex flex-wrap gap-3",children:s.photos.map(vt=>h.jsxs("div",{className:"group relative h-28 w-40 overflow-hidden rounded-2xl border border-border bg-background",children:[h.jsx("img",{src:vt.url,alt:vt.name,className:"h-full w-full object-cover"}),h.jsx("button",{type:"button",onClick:()=>jt(vt),className:"absolute right-2 top-2 rounded-full border border-border bg-background/80 px-2 py-1 text-xs text-muted-foreground opacity-0 transition group-hover:opacity-100",children:"Remove"})]},vt.url))}),h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[h.jsx("input",{type:"file",accept:"image/*",onChange:yr,disabled:Se||s.photos.length>=om,className:"w-full rounded-2xl border border-border bg-background px-3 py-2 text-sm text-muted-foreground file:mr-3 file:rounded-full file:border-0 file:bg-primary/10 file:px-4 file:py-2 file:text-sm file:font-medium file:text-primary hover:file:bg-primary/20"}),h.jsx("span",{className:"text-xs text-muted-foreground",children:"or"}),h.jsxs("div",{className:"flex flex-1 gap-2",children:[h.jsx("input",{value:ve,onChange:vt=>me(vt.target.value),className:"flex-1 rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Paste photo URL"}),h.jsx("button",{type:"button",onClick:Je,disabled:s.photos.length>=om,className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Add"})]})]}),Be&&h.jsx("p",{className:"text-sm text-destructive",children:Be})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Equipment"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:s.equipment.map(vt=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[vt,h.jsx("button",{type:"button",onClick:()=>At("equipment",vt),className:"text-muted-foreground hover:text-primary",children:"x"})]},vt))}),h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[h.jsx("input",{value:L,onChange:vt=>F(vt.target.value),onKeyDown:vt=>{vt.key==="Enter"&&(vt.preventDefault(),Ci("equipment",L),F(""))},className:"flex-1 rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Add equipment and press Enter"}),h.jsx("button",{type:"button",onClick:()=>{Ci("equipment",L),F("")},className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Add"})]}),h.jsxs("div",{className:"mt-4",children:[h.jsx("p",{className:"text-sm text-muted-foreground",children:"Select up to three priority items."}),h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.equipment.map(vt=>{const or=s.priorityEquipment.includes(vt);return h.jsxs("button",{type:"button",onClick:()=>pt(vt),className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs ${or?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary"}`,children:[h.jsx(YM,{className:"h-3.5 w-3.5"}),vt]},vt)}),s.equipment.length===0&&h.jsx("span",{className:"text-xs text-muted-foreground",children:"Add equipment to enable prioritization."})]})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Techniques"}),h.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:s.techniques.map((vt,or)=>h.jsx("div",{className:"rounded-2xl border border-border px-4 py-3",children:h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:vt.name}),vt.description&&h.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:vt.description})]}),h.jsx("button",{type:"button",onClick:()=>Ke(or),className:"text-muted-foreground hover:text-primary",children:h.jsx(TT,{className:"h-4 w-4"})})]})},`${vt.name}-${or}`))}),h.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[h.jsx("input",{value:se.name,onChange:vt=>oe(or=>({...or,name:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Technique name"}),h.jsx("input",{value:se.description??"",onChange:vt=>oe(or=>({...or,description:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Short description"}),h.jsxs("button",{type:"button",onClick:Vr,className:"md:col-span-2 inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:[h.jsx(Vx,{className:"h-4 w-4 mr-2"}),"Save technique"]})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Focus areas"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:s.focusAreas.map(vt=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[vt,h.jsx("button",{type:"button",onClick:()=>At("focusAreas",vt),className:"text-muted-foreground hover:text-primary",children:"x"})]},vt))}),h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[h.jsx("input",{value:W,onChange:vt=>X(vt.target.value),onKeyDown:vt=>{vt.key==="Enter"&&(vt.preventDefault(),Ci("focusAreas",W),X(""))},className:"flex-1 rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Add focus area and press Enter"}),h.jsx("button",{type:"button",onClick:()=>{Ci("focusAreas",W),X("")},className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Add"})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Team members"}),h.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:s.members.map((vt,or)=>h.jsx("div",{className:"rounded-2xl border border-border px-4 py-3",children:h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:vt.name}),h.jsx("p",{className:"text-xs text-muted-foreground",children:vt.role}),(vt.linkedin||vt.website)&&h.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:[vt.linkedin,vt.website].filter(Boolean).join(" - ")}),vt.isLead&&h.jsx("span",{className:"mt-2 inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[11px] text-primary",children:"Lead"})]}),h.jsx("button",{type:"button",onClick:()=>Dr(or),className:"text-muted-foreground hover:text-primary",children:h.jsx(TT,{className:"h-4 w-4"})})]})},`${vt.name}-${or}`))}),h.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[h.jsx("input",{value:ee.name,onChange:vt=>he(or=>({...or,name:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Member name"}),h.jsx("input",{value:ee.role,onChange:vt=>he(or=>({...or,role:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Role or title"}),h.jsx("input",{value:ee.email??"",onChange:vt=>he(or=>({...or,email:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Email (optional)"}),h.jsx("input",{value:ee.linkedin??"",onChange:vt=>he(or=>({...or,linkedin:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"LinkedIn (optional)"}),h.jsx("input",{value:ee.website??"",onChange:vt=>he(or=>({...or,website:vt.target.value})),className:"rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",placeholder:"Website (optional)"}),h.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx("input",{type:"checkbox",checked:ee.isLead??!1,onChange:vt=>he(or=>({...or,isLead:vt.target.checked}))}),"Mark as team lead"]}),h.jsxs("button",{type:"button",onClick:Sr,className:"md:col-span-2 inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:[h.jsx(Vx,{className:"h-4 w-4 mr-2"}),"Save team member"]})]})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Linked labs"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Link requests require approval from the lab owner."}),Ut.length>0&&h.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:Ut.map(vt=>h.jsxs("div",{className:"rounded-2xl border border-border px-4 py-3",children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:vt.name}),vt.city||vt.country?h.jsx("p",{className:"text-xs text-muted-foreground",children:[vt.city,vt.country].filter(Boolean).join(", ")}):null]},vt.id))}),ut.length>0&&h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Pending & recent requests"}),ut.map(vt=>h.jsx("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-border px-4 py-3 text-sm",children:h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:vt.labs?.name??`Lab #${vt.lab_id}`}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:["Status: ",vt.status]})]})},vt.id))]}),h.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr_auto] items-end",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:"Request a lab link"}),h.jsxs("select",{value:Qt,onChange:vt=>ze(vt.target.value?Number(vt.target.value):""),className:"mt-2 w-full rounded-2xl border border-border bg-background px-4 py-2 text-sm text-foreground",children:[h.jsx("option",{value:"",children:"Choose a lab"}),Gi.map(vt=>h.jsx("option",{value:vt.id,children:vt.name},vt.id))]})]}),h.jsx("button",{type:"button",onClick:yi,className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",disabled:!C,children:"Send request"})]}),Gi.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"No new labs available to request."}),It&&h.jsx("p",{className:"text-sm text-destructive",children:It}),Lr&&h.jsx("p",{className:"text-sm text-primary",children:Lr})]})]}),Hr&&h.jsx("p",{className:"mt-4 text-sm text-destructive",children:Hr}),Ti&&h.jsx("p",{className:"mt-4 text-sm text-primary",children:Ti})]})})}const Ls="w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",mie=["1 = Lab Director","2 = Deputy Director","3 = Team Leader","4 = Researcher","5 = Postdoc","6 = PhD Student","7 = Research/Technical support"],HR=["Basics","Branding","Company details","Compliance","Team","Photos","Offers"];function gie({params:i}){const n=Number(i?.id),{user:a}=Ma(),{hasFunctionalConsent:d}=w_(),[,y]=Al(),[v,C]=$.useState(!0),[s,M]=$.useState(!1),[L,F]=$.useState(null),[W,X]=$.useState(null),[ee,he]=$.useState("listed"),[se,oe]=$.useState({canCreateLab:!1,canManageMultipleLabs:!1,canManageTeams:!1,canManageMultipleTeams:!1,canPostNews:!1,canBrokerRequests:!1,canReceiveInvestor:!1}),[ve,me]=$.useState(null),[Se,Re]=$.useState(null),[Be,rt]=$.useState(Number.isNaN(n)?null:n),[We,Ct]=$.useState(!0),[Ht,Zt]=$.useState([]),[rr,$t]=$.useState(""),[Rt,Gt]=$.useState([]),[Ar,Ut]=$.useState(!1),[Xt,ut]=$.useState(null),[Mt,Qt]=$.useState("Basics"),[ze,It]=$.useState({name:"",labManager:"",contactEmail:"",logoUrl:"",siretNumber:"",offersLabSpace:!1,descriptionShort:"",descriptionLong:"",orgRole:"",addressLine1:"",addressLine2:"",city:"",state:"",postalCode:"",country:"",website:"",linkedin:"",partnerLogos:[],complianceTags:[],halStructureId:"",halPersonId:"",teamMembers:[],equipmentTags:[],priorityEquipmentTags:[],techniques:[],focusTags:[],offers:[]}),[xr,Lr]=$.useState(!1),[yn,Yr]=$.useState(null),[Zr,Qr]=$.useState([]),[ir,Hr]=$.useState({name:"",title:"",linkedin:"",website:"",teamName:"",roleRank:""}),[Ur,Ti]=$.useState({field:"complianceTags",value:""}),[Sn,Ci]=$.useState({name:"",description:""}),[At,pt]=$.useState(!1),[Sr,Dr]=$.useState(null),[Vr,Ke]=$.useState(!1),[Je,jt]=$.useState(!1),[yr,pr]=$.useState(!1),[Jt,Or]=$.useState(null),[sn,Mn]=$.useState(!1),[Gi,yi]=$.useState(!1),[vt,or]=$.useState(!1),[dn,Ln]=$.useState([]),[Bn,Ze]=$.useState(!1),[ur,kr]=$.useState(null),An=$.useMemo(()=>`my-lab-draft:${n||"unknown"}`,[n]),ki=["verified_passive","verified_active","premier"].includes((ee||"listed").toLowerCase()),Yn=(ee||"").toLowerCase()==="premier"||se.canManageMultipleLabs;$.useEffect(()=>{(async()=>{F(null),X(null);try{if(!Be)throw new Error("No lab selected. Go back and choose a lab.");const{data:fe}=await fn.auth.getSession(),Ve=fe.session?.access_token;await Ee(Be,Ve)}catch(fe){F(fe.message||"Unable to load your lab")}finally{C(!1)}})()},[a?.id,Be]),$.useEffect(()=>{if(!Be)return;let fe=!0;async function Ve(){Ze(!0),kr(null);try{const{data:Xe}=await fn.auth.getSession(),ct=Xe.session?.access_token,tr=await fetch(`/api/labs/${Be}/team-link-requests`,{headers:ct?{Authorization:`Bearer ${ct}`}:{}});if(!tr.ok){const Nr=await tr.json().catch(()=>({}));throw new Error(Nr?.message||"Unable to load team link requests")}const cr=await tr.json();fe&&Ln(cr??[])}catch(Xe){fe&&kr(Xe.message||"Unable to load team link requests")}finally{fe&&Ze(!1)}}return Ve(),()=>{fe=!1}},[Be]);const Ri=async(fe,Ve)=>{if(Be){kr(null);try{const{data:Xe}=await fn.auth.getSession(),ct=Xe.session?.access_token,tr=await fetch(`/api/labs/${Be}/team-link-requests/${fe}`,{method:"POST",headers:{"Content-Type":"application/json",...ct?{Authorization:`Bearer ${ct}`}:{}},body:JSON.stringify({status:Ve})});if(!tr.ok){const cr=await tr.json().catch(()=>({}));throw new Error(cr?.message||"Unable to update request")}Ln(cr=>cr.map(Nr=>Nr.id===fe?{...Nr,status:Ve}:Nr))}catch(Xe){kr(Xe.message||"Unable to update request")}}};$.useEffect(()=>{if(!(!d||v||sn||!Be))try{const fe=localStorage.getItem(An);if(!fe){Mn(!0);return}const Ve=JSON.parse(fe);Ve?.form&&It(Xe=>{const ct={...Xe};for(const[tr,cr]of Object.entries(Ve.form))if(cr!=null){if(typeof cr=="string"){cr.trim().length>0&&(ct[tr]=cr);continue}if(Array.isArray(cr)){cr.length>0&&(ct[tr]=cr);continue}ct[tr]=cr}return ct}),Array.isArray(Ve?.photos)&&Ve.photos.length>0&&Zt(Ve.photos),Array.isArray(Ve?.partnerLogos)&&Ve.partnerLogos.length>0&&Qr(Ve.partnerLogos),Array.isArray(Ve?.complianceDocs)&&Ve.complianceDocs.length>0&&Gt(Ve.complianceDocs),typeof Ve?.activeTab=="string"&&HR.includes(Ve.activeTab)&&Qt(Ve.activeTab)}catch{}finally{Mn(!0)}},[An,sn,Be,v,d]),$.useEffect(()=>{if(!d||!sn||!Be)return;const fe=window.setTimeout(()=>{const Ve={form:ze,photos:Ht,partnerLogos:Zr,complianceDocs:Rt,activeTab:Mt};localStorage.setItem(An,JSON.stringify(Ve))},250);return()=>window.clearTimeout(fe)},[An,sn,ze,Ht,Zr,Rt,Mt,Be,d]);async function ui(fe){const Ve=fe.target.files?.[0];if(Ve){Yr(null),Lr(!0);try{const Xe=Ve.name.split(".").pop()||"png",tr=`logos/${(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${Xe}`}`,{error:cr}=await fn.storage.from("lab-logos").upload(tr,Ve,{upsert:!0,contentType:Ve.type});if(cr)throw cr;const{data:Nr}=fn.storage.from("lab-logos").getPublicUrl(tr),Ir=Nr.publicUrl;It(jr=>({...jr,logoUrl:Ir})),X("Logo uploaded")}catch(Xe){Yr(Xe?.message||"Unable to upload logo")}finally{Lr(!1)}}}async function _i(fe){const Ve=fe.target.files?.[0];if(Ve){X(null);try{const Xe=Ve.name.split(".").pop()||"png",ct=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${Xe}`,cr=`${Be?`labs/${Be}/partners`:"partners"}/${ct}`,{error:Nr}=await fn.storage.from("lab-logos").upload(cr,Ve,{upsert:!0,contentType:Ve.type});if(Nr)throw Nr;const{data:Ir}=fn.storage.from("lab-logos").getPublicUrl(cr),jr=Ir.publicUrl,Rr={name:Ve.name,url:jr,website:null};Qr(ni=>[...ni,Rr]),It(ni=>({...ni,partnerLogos:[...ni.partnerLogos,Rr]})),X("Partner logo uploaded")}catch(Xe){X(Xe?.message||"Unable to upload partner logo")}}}const Ds=fe=>{Qr(Ve=>Ve.filter(Xe=>Xe.url!==fe)),It(Ve=>({...Ve,partnerLogos:Ve.partnerLogos.filter(Xe=>Xe.url!==fe)}))},oo=(fe,Ve)=>{Qr(Xe=>Xe.map(ct=>ct.url===fe?{...ct,...Ve}:ct)),It(Xe=>({...Xe,partnerLogos:Xe.partnerLogos.map(ct=>ct.url===fe?{...ct,...Ve}:ct)}))},Is=()=>{const fe=rr.trim();fe&&(Zt(Ve=>[...Ve,{name:fe.split("/").pop()??`Photo ${Ve.length+1}`,url:fe}]),$t(""))},ao=fe=>{Zt(Ve=>Ve.filter(Xe=>Xe.url!==fe.url))};async function No(fe){const Ve=fe.target.files?.[0];if(!(!Ve||!Be)){Dr(null),pt(!0);try{const Xe=Ve.name.split(".").pop()||"jpg",ct=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${Xe}`,tr=`labs/${Be}/photos/${ct}`,{error:cr}=await fn.storage.from("lab-photos").upload(tr,Ve,{upsert:!0,contentType:Ve.type});if(cr)throw cr;const{data:Nr}=fn.storage.from("lab-photos").getPublicUrl(tr),Ir=Nr.publicUrl,jr={name:Ve.name,url:Ir};Zt(Rr=>[...Rr,jr]),X("Photo uploaded")}catch(Xe){Dr(Xe?.message||"Unable to upload photo")}finally{pt(!1),fe.target&&(fe.target.value="")}}}async function Nt(fe){const Ve=fe.target.files;if(!(!Ve||Ve.length===0)&&Be){ut(null),Ut(!0);try{for(const Xe of Array.from(Ve)){const ct=Xe.name.split(".").pop()||"pdf",tr=(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`)+`.${ct}`,cr=`labs/${Be}/compliance/${tr}`,{error:Nr}=await fn.storage.from("lab-pdfs").upload(cr,Xe,{upsert:!0,contentType:Xe.type});if(Nr)throw Nr;const{data:Ir}=fn.storage.from("lab-pdfs").getPublicUrl(cr);Gt(jr=>[...jr,{name:Xe.name,url:Ir.publicUrl}])}}catch(Xe){ut(Xe?.message||"Unable to upload compliance documents")}finally{Ut(!1),fe.target&&(fe.target.value="")}}}const us=(fe,Ve)=>{const Xe=Ve.trim();Xe&&It(ct=>ct[fe].includes(Xe)?ct:{...ct,[fe]:[...ct[fe],Xe]})},ks=(fe,Ve)=>{It(Xe=>{const ct=Xe[fe].filter(tr=>tr!==Ve);return fe==="equipmentTags"?{...Xe,equipmentTags:ct,priorityEquipmentTags:Xe.priorityEquipmentTags.filter(tr=>tr!==Ve)}:{...Xe,[fe]:ct}})},fo=fe=>Ve=>{Ve.key==="Enter"&&(Ve.preventDefault(),us(fe,Ur.value||Ve.target.value),Ti({field:fe,value:""}))},vn=fe=>{It(Ve=>{const Xe=new Set(Ve.priorityEquipmentTags);if(Xe.has(fe))Xe.delete(fe);else{if(Xe.size>=3)return Ve;Xe.add(fe)}return{...Ve,priorityEquipmentTags:Array.from(Xe)}})},$e=()=>{const fe=Sn.name.trim();if(!fe)return;const Ve=Sn.description?.toString().trim()||null;It(Xe=>({...Xe,techniques:[...Xe.techniques,{name:fe,description:Ve}]})),Ci({name:"",description:""})},ne=fe=>{It(Ve=>({...Ve,techniques:Ve.techniques.filter((Xe,ct)=>ct!==fe)}))},ce=()=>{const fe=ir.name.trim(),Ve=ir.title.trim();if(!fe||!Ve)return;const Xe=ir.linkedin.trim(),ct=ir.website.trim(),tr=ir.teamName.trim(),cr=ir.roleRank.trim(),Nr=cr?Number(cr):null;It(Ir=>({...Ir,teamMembers:[...Ir.teamMembers,{name:fe,title:Ve,linkedin:Xe||null,website:ct||null,teamName:tr||null,roleRank:Nr&&!Number.isNaN(Nr)?Nr:null,isLead:Ir.teamMembers.length===0}]})),Hr({name:"",title:"",linkedin:"",website:"",teamName:"",roleRank:""})},be=(fe,Ve)=>{It(Xe=>({...Xe,teamMembers:Xe.teamMembers.filter(ct=>!(ct.name===fe&&ct.title===Ve))}))},De=(fe,Ve)=>{It(Xe=>({...Xe,teamMembers:Xe.teamMembers.map(ct=>({...ct,isLead:ct.name===fe&&ct.title===Ve}))}))};async function Ee(fe,Ve){try{C(!0),F(null);const Xe=await fetch(`/api/my-lab/${fe}`,{headers:Ve?{Authorization:`Bearer ${Ve}`}:{}});if(!Xe.ok){const tr=await Xe.text();throw new Error(tr||"Unable to load lab")}const ct=await Xe.json();rt(ct.id),he((ct.labStatus||"listed").toLowerCase()),Ct(ct.isVisible!==!1),It({name:ct.name||"",labManager:ct.labManager||"",contactEmail:ct.contactEmail||a?.email||"",logoUrl:ct.logoUrl||"",siretNumber:ct.siretNumber||"",offersLabSpace:ct.offersLabSpace??!0,descriptionShort:ct.descriptionShort||"",descriptionLong:ct.descriptionLong||"",orgRole:ct.orgRole||"",addressLine1:ct.addressLine1||"",addressLine2:ct.addressLine2||"",city:ct.city||"",state:ct.state||"",postalCode:ct.postalCode||"",country:ct.country||"",website:ct.website||"",linkedin:ct.linkedin||"",partnerLogos:ct.partnerLogos||[],complianceTags:ct.compliance||[],halStructureId:ct.halStructureId||"",halPersonId:ct.halPersonId||"",teamMembers:ct.teamMembers||[],equipmentTags:ct.equipment||[],priorityEquipmentTags:ct.priorityEquipment||[],techniques:ct.techniques||[],focusTags:ct.focusAreas||[],offers:ct.offers||[]}),Qr(ct.partnerLogos||[]),Zt(ct.photos||[]),Gt(ct.complianceDocs||[]),me(null),Re(null);try{const tr=await fetch("/api/my-lab/analytics",{headers:Ve?{Authorization:`Bearer ${Ve}`}:{}});if(tr.ok){const cr=await tr.json();me({views7d:cr.views7d??0,views30d:cr.views30d??0,favorites:cr.favorites??0,recentFavorites:(cr.recentFavorites??[]).map(Nr=>({userId:Nr.userId,createdAt:Nr.createdAt}))})}else if(tr.status!==403){const cr=await tr.text();Re(cr||"Unable to load analytics")}}catch(tr){Re(tr.message||"Unable to load analytics")}}catch(Xe){F(Xe.message||"Unable to load your lab")}finally{C(!1)}}$.useEffect(()=>{a?.id&&fn.from("profiles").select(["can_create_lab","can_manage_multiple_labs","can_manage_teams","can_manage_multiple_teams","can_post_news","can_broker_requests","can_receive_investor","is_admin"].join(",")).eq("user_id",a.id).maybeSingle().then(({data:fe})=>{oe({canCreateLab:!!fe?.can_create_lab,canManageMultipleLabs:!!fe?.can_manage_multiple_labs,canManageTeams:!!fe?.can_manage_teams,canManageMultipleTeams:!!fe?.can_manage_multiple_teams,canPostNews:!!fe?.can_post_news,canBrokerRequests:!!fe?.can_broker_requests,canReceiveInvestor:!!fe?.can_receive_investor})}).catch(()=>{})},[a?.id]);async function Fe(){M(!0),F(null);try{const{data:fe}=await fn.auth.getSession(),Ve=fe.session?.access_token;if(!Be)throw new Error("Select a lab first");const Xe=await fetch(`/api/my-lab/${Be}`,{method:"PUT",headers:{"Content-Type":"application/json",...Ve?{Authorization:`Bearer ${Ve}`}:{}},body:JSON.stringify({name:ze.name,labManager:ze.labManager,contactEmail:ze.contactEmail,logoUrl:ze.logoUrl||null,siretNumber:ze.siretNumber||null,offersLabSpace:ze.offersLabSpace,descriptionShort:ze.descriptionShort||null,descriptionLong:ze.descriptionLong||null,orgRole:ze.orgRole||null,ownerUserId:a?.id||null,addressLine1:ze.addressLine1||null,addressLine2:ze.addressLine2||null,city:ze.city||null,state:ze.state||null,postalCode:ze.postalCode||null,country:ze.country||null,website:ze.website||null,linkedin:ze.linkedin||null,photos:Ht,partnerLogos:ze.partnerLogos,compliance:ze.complianceTags,complianceDocs:Rt,halStructureId:ze.halStructureId||null,halPersonId:ze.halPersonId||null,teamMembers:ze.teamMembers,equipment:ze.equipmentTags,priorityEquipment:ze.priorityEquipmentTags.filter(ct=>ze.equipmentTags.includes(ct)).slice(0,3),techniques:ze.techniques,focusAreas:ze.focusTags,offers:ze.offers})});if(!Xe.ok){let ct="Failed to save";if((Xe.headers.get("content-type")||"").includes("application/json"))try{ct=(await Xe.json()).message||ct}catch{}else try{ct=await Xe.text()}catch{}throw new Error(ct)}return d&&localStorage.removeItem(An),!0}catch(fe){return F(fe.message||"Failed to save"),!1}finally{M(!1)}}async function et(){await Fe()&&y("/account?tab=manageLab")}async function qe(){if(Be){pr(!0),Or(null);try{const{data:fe}=await fn.auth.getSession(),Ve=fe.session?.access_token,Xe=await fetch(`/api/my-lab/${Be}`,{method:"DELETE",headers:Ve?{Authorization:`Bearer ${Ve}`}:{}});if(!Xe.ok){let ct="Failed to delete lab";if((Xe.headers.get("content-type")||"").includes("application/json"))try{ct=(await Xe.json()).message||ct}catch{}else try{ct=await Xe.text()}catch{}throw new Error(ct)}d&&localStorage.removeItem(An),y("/account?tab=manageLab")}catch(fe){Or(fe.message||"Failed to delete lab")}finally{pr(!1)}}}return h.jsxs("section",{className:"bg-background min-h-screen",children:[h.jsxs("div",{className:"container mx-auto px-4 py-20 lg:py-24 max-w-3xl",children:[h.jsx(xn,{href:"/account?tab=manageLab",className:"text-sm text-muted-foreground hover:text-primary inline-flex items-center gap-1 mb-4 rounded-full border border-border px-3 py-1",children:" Back to manage labs"}),h.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:"Manage my lab"}),h.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Update basic details for your lab."}),Be&&We===!1&&h.jsx("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full bg-amber-100 px-3 py-1 text-xs font-medium text-amber-800",children:"This lab is hidden from the public directory"}),!Be&&h.jsxs("p",{className:"mt-4 text-sm text-destructive",children:["No lab selected. Go back and choose a lab to manage.",h.jsx(xn,{href:"/account?tab=manageLab",children:h.jsx("a",{className:"ml-2 underline text-primary",children:"Back to lab selection"})})]}),ve&&h.jsxs("div",{className:"mt-4 rounded-2xl border border-border bg-card/70 p-4 text-sm",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.25em] text-muted-foreground",children:"Premier / Custom analytics"}),h.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[h.jsxs("div",{className:"rounded-xl border border-border bg-background/60 p-3",children:[h.jsx("p",{className:"text-xs text-muted-foreground",children:"Views (7d)"}),h.jsx("p",{className:"text-xl font-semibold text-foreground",children:ve.views7d})]}),h.jsxs("div",{className:"rounded-xl border border-border bg-background/60 p-3",children:[h.jsx("p",{className:"text-xs text-muted-foreground",children:"Views (30d)"}),h.jsx("p",{className:"text-xl font-semibold text-foreground",children:ve.views30d})]}),h.jsxs("div",{className:"rounded-xl border border-border bg-background/60 p-3",children:[h.jsx("p",{className:"text-xs text-muted-foreground",children:"Favorites"}),h.jsx("p",{className:"text-xl font-semibold text-foreground",children:ve.favorites})]})]}),ve.recentFavorites.length>0&&h.jsxs("div",{className:"mt-3",children:[h.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Recent favorites"}),h.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:ve.recentFavorites.map(fe=>h.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border px-3 py-1",title:new Date(fe.createdAt).toLocaleString(),children:["User ",fe.userId.slice(0,6)," favorited"]},`${fe.userId}-${fe.createdAt}`))})]}),Se&&h.jsx("p",{className:"mt-2 text-xs text-destructive",children:Se})]}),v?h.jsx("p",{className:"mt-6 text-sm text-muted-foreground",children:"Loading"}):L?h.jsx("p",{className:"mt-6 text-sm text-destructive",children:L}):h.jsxs(Jn.form,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.4},className:"mt-8 space-y-8",onSubmit:fe=>{fe.preventDefault(),jt(!0)},children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[h.jsx("div",{className:"flex flex-wrap gap-2",children:HR.map(fe=>h.jsx("button",{type:"button",onClick:()=>Qt(fe),className:`rounded-full border px-4 py-1.5 text-sm font-medium transition ${Mt===fe?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary/50 hover:text-primary"}`,children:fe},fe))}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("button",{type:"button",onClick:()=>Ke(!0),className:"rounded-full border border-destructive/50 px-4 py-2 text-sm font-medium text-destructive hover:border-destructive",children:"Delete lab"}),h.jsx("button",{className:"rounded-full bg-primary px-4 py-2 text-primary-foreground",type:"button",onClick:()=>jt(!0),disabled:s,children:s?"Saving":"Save"})]})]}),Mt==="Basics"&&h.jsxs(am,{title:"Basics",children:[h.jsx(Ws,{label:"Lab name",children:h.jsx("input",{className:Ls,value:ze.name,onChange:fe=>It({...ze,name:fe.target.value})})}),h.jsx(Ws,{label:"Lab manager",children:h.jsx("input",{className:Ls,value:ze.labManager,onChange:fe=>It({...ze,labManager:fe.target.value})})}),h.jsx(Ws,{label:"Contact email",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("input",{className:Ls,value:ze.contactEmail,disabled:!0}),h.jsx("span",{className:"text-muted-foreground","aria-hidden":"true",children:h.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-4 w-4",children:[h.jsx("rect",{x:"5",y:"11",width:"14",height:"9",rx:"2"}),h.jsx("path",{d:"M8 11v-2a4 4 0 0 1 8 0v2"})]})})]})}),h.jsx(Ws,{label:"Short description",children:h.jsx("textarea",{className:Ls,rows:4,value:ze.descriptionShort,onChange:fe=>It({...ze,descriptionShort:fe.target.value}),placeholder:"Short intro under your lab name."})}),h.jsx(Ws,{label:"Long description (optional)",children:h.jsx("textarea",{className:Ls,rows:6,value:ze.descriptionLong,onChange:fe=>It({...ze,descriptionLong:fe.target.value}),placeholder:"Longer overview shown later on the page."})}),h.jsx(Ws,{label:"Organization role (optional)",children:h.jsxs("select",{className:Ls,value:ze.orgRole,onChange:fe=>It({...ze,orgRole:fe.target.value}),children:[h.jsx("option",{value:"",children:"Select role type"}),f_.map(fe=>h.jsx("option",{value:fe,children:fe},fe))]})}),h.jsx(Ws,{label:"HAL structure ID (optional)",children:h.jsx("input",{className:Ls,value:ze.halStructureId,onChange:fe=>It({...ze,halStructureId:fe.target.value}),placeholder:"e.g., struct-123456"})}),h.jsx(Ws,{label:"HAL person ID (optional)",children:h.jsx("input",{className:Ls,value:ze.halPersonId,onChange:fe=>It({...ze,halPersonId:fe.target.value}),placeholder:"e.g., 123456"})}),h.jsxs("label",{className:"flex items-center gap-3 text-sm text-foreground",children:[h.jsx("input",{type:"checkbox",checked:ze.offersLabSpace,onChange:fe=>It({...ze,offersLabSpace:fe.target.checked})}),"Offers lab space (enables pricing/offers on your page)"]})]}),Mt==="Branding"&&h.jsxs(am,{title:"Branding & Links",children:[h.jsx(Ws,{label:"Website (optional)",children:h.jsx("input",{className:Ls,value:ze.website,onChange:fe=>It({...ze,website:fe.target.value}),placeholder:"https://labs.example.com"})}),h.jsx(Ws,{label:"LinkedIn (optional)",children:h.jsx("input",{className:Ls,value:ze.linkedin,onChange:fe=>It({...ze,linkedin:fe.target.value}),placeholder:"https://www.linkedin.com/company/example"})})]}),Mt==="Company details"&&h.jsxs(am,{title:"Company details",children:[h.jsx(Ws,{label:"Address line 1",children:h.jsx("input",{className:Ls,value:ze.addressLine1,onChange:fe=>It({...ze,addressLine1:fe.target.value})})}),h.jsx(Ws,{label:"Address line 2",children:h.jsx("input",{className:Ls,value:ze.addressLine2,onChange:fe=>It({...ze,addressLine2:fe.target.value})})}),h.jsx(Ws,{label:"SIRET",children:h.jsx("input",{className:Ls,value:ze.siretNumber,onChange:fe=>It({...ze,siretNumber:fe.target.value})})}),h.jsx(Ws,{label:"City",children:h.jsx("input",{className:Ls,value:ze.city,onChange:fe=>It({...ze,city:fe.target.value})})}),h.jsx(Ws,{label:"State/Region",children:h.jsx("input",{className:Ls,value:ze.state,onChange:fe=>It({...ze,state:fe.target.value})})}),h.jsx(Ws,{label:"Postal code",children:h.jsx("input",{className:Ls,value:ze.postalCode,onChange:fe=>It({...ze,postalCode:fe.target.value})})}),h.jsx(Ws,{label:"Country",children:h.jsx("input",{className:Ls,value:ze.country,onChange:fe=>It({...ze,country:fe.target.value})})})]}),Mt==="Team"&&h.jsxs(h.Fragment,{children:[h.jsxs(am,{title:"Team link requests",children:[Bn&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading requests..."}),ur&&h.jsx("p",{className:"text-sm text-destructive",children:ur}),!Bn&&dn.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"No pending team link requests."}),h.jsx("div",{className:"space-y-3",children:dn.map(fe=>h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-xl border border-border bg-muted/30 px-3 py-3",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:fe.teams?.name||`Team #${fe.team_id}`}),fe.teams?.description_short&&h.jsx("p",{className:"text-xs text-muted-foreground",children:fe.teams.description_short}),h.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Status: ",fe.status]})]}),fe.status==="pending"&&h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{type:"button",onClick:()=>Ri(fe.id,"approved"),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-primary hover:text-primary",children:"Approve"}),h.jsx("button",{type:"button",onClick:()=>Ri(fe.id,"declined"),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-destructive hover:text-destructive",children:"Decline"})]})]},fe.id))})]}),h.jsx(am,{title:"Team members",children:h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:Ls,placeholder:"Full name",value:ir.name,onChange:fe=>Hr(Ve=>({...Ve,name:fe.target.value}))}),h.jsx("input",{className:Ls,placeholder:"Title",value:ir.title,onChange:fe=>Hr(Ve=>({...Ve,title:fe.target.value}))})]}),h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:Ls,placeholder:"Team / group (optional)",value:ir.teamName,onChange:fe=>Hr(Ve=>({...Ve,teamName:fe.target.value}))}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("input",{className:`${Ls} flex-1`,placeholder:"Role rank (1-7)",value:ir.roleRank,onChange:fe=>Hr(Ve=>({...Ve,roleRank:fe.target.value}))}),h.jsxs("div",{className:"relative",children:[h.jsx("button",{type:"button",onClick:()=>or(fe=>!fe),onMouseEnter:()=>yi(!0),onMouseLeave:()=>yi(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-border text-xs font-semibold text-muted-foreground hover:border-primary hover:text-primary","aria-label":"Role rank guidance",children:"i"}),(vt||Gi)&&h.jsxs("div",{className:"absolute right-0 top-full z-10 mt-2 w-56 rounded-2xl border border-border bg-background/95 p-3 text-xs text-muted-foreground shadow-lg",children:[h.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Rank guide"}),h.jsx("ul",{className:"mt-2 space-y-1",children:mie.map(fe=>h.jsx("li",{children:fe},fe))})]})]})]})]}),h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:Ls,placeholder:"LinkedIn (optional)",value:ir.linkedin,onChange:fe=>Hr(Ve=>({...Ve,linkedin:fe.target.value}))}),h.jsx("input",{className:Ls,placeholder:"Website (optional)",value:ir.website,onChange:fe=>Hr(Ve=>({...Ve,website:fe.target.value}))})]}),h.jsx("button",{type:"button",onClick:ce,className:"inline-flex items-center rounded-full border border-border px-3 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary",children:"Save team member"}),h.jsx("div",{className:"space-y-2",children:ze.teamMembers.map(fe=>h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-xl border border-border bg-muted/30 px-3 py-2",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsxs("p",{className:"text-sm font-medium text-foreground",children:[fe.name,fe.isLead&&h.jsx("span",{className:"ml-2 text-xs text-primary",children:"Lead"})]}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[fe.title,fe.roleRank?`  Rank ${fe.roleRank}`:""]}),fe.teamName&&h.jsxs("p",{className:"text-xs text-muted-foreground",children:["Team: ",fe.teamName]}),(fe.linkedin||fe.website)&&h.jsx("p",{className:"text-xs text-muted-foreground",children:fe.linkedin||fe.website})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("button",{type:"button",onClick:()=>De(fe.name,fe.title),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-primary hover:text-primary",children:"Set lead"}),h.jsx("button",{type:"button",onClick:()=>be(fe.name,fe.title),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-destructive hover:text-destructive",children:"Remove"})]})]},`${fe.name}-${fe.title}`))})]})})]}),Mt==="Compliance"&&h.jsxs(am,{title:"Compliance & capabilities",children:[h.jsx(Ws,{label:"Compliance",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("input",{className:Ls,placeholder:"Add compliance and press Enter",value:Ur.field==="complianceTags"?Ur.value:"",onChange:fe=>Ti({field:"complianceTags",value:fe.target.value}),onKeyDown:fo("complianceTags")}),h.jsx("div",{className:"flex flex-wrap gap-2",children:ze.complianceTags.map(fe=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[fe,h.jsx("button",{type:"button",onClick:()=>ks("complianceTags",fe),className:"text-muted-foreground hover:text-destructive",children:""})]},fe))})]})}),h.jsx(Ws,{label:"Compliance documents (PDF)",children:h.jsxs("div",{className:"space-y-3",children:[h.jsx("div",{className:"flex flex-wrap gap-2",children:Rt.map(fe=>h.jsxs("button",{type:"button",onClick:()=>Gt(Ve=>Ve.filter(Xe=>Xe.url!==fe.url)),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground transition hover:border-destructive hover:text-destructive",children:[h.jsx(HM,{className:"h-3 w-3 text-primary"}),fe.name,h.jsx(Jf,{className:"h-3 w-3"})]},fe.url))}),h.jsx("label",{className:"inline-flex items-center gap-3",children:h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"application/pdf",multiple:!0,onChange:Nt,className:"hidden"})]})}),Ar&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading"}),Xt&&h.jsx("p",{className:"text-xs text-destructive",children:Xt}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload PDF compliance certificates."})]})}),h.jsx(Ws,{label:"Equipment",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("input",{className:Ls,placeholder:"Add equipment and press Enter",value:Ur.field==="equipmentTags"?Ur.value:"",onChange:fe=>Ti({field:"equipmentTags",value:fe.target.value}),onKeyDown:fo("equipmentTags")}),h.jsx("div",{className:"flex flex-wrap gap-2",children:ze.equipmentTags.map(fe=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[fe,h.jsx("button",{type:"button",onClick:()=>ks("equipmentTags",fe),className:"text-muted-foreground hover:text-destructive",children:""})]},fe))}),h.jsxs("div",{className:"pt-2",children:[h.jsx("p",{className:"text-xs text-muted-foreground",children:"Select up to three priority items."}),h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[ze.equipmentTags.map(fe=>{const Ve=ze.priorityEquipmentTags.includes(fe);return h.jsx("button",{type:"button",onClick:()=>vn(fe),className:`rounded-full border px-3 py-1 text-xs ${Ve?"border-primary bg-primary/10 font-semibold text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,children:fe},`priority-${fe}`)}),ze.equipmentTags.length===0&&h.jsx("span",{className:"text-xs text-muted-foreground",children:"Add equipment to enable prioritization."})]})]})]})}),h.jsx(Ws,{label:"Techniques",children:h.jsxs("div",{className:"space-y-3",children:[h.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:ze.techniques.map((fe,Ve)=>h.jsx("div",{className:"rounded-2xl border border-border px-4 py-3",children:h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:fe.name}),fe.description&&h.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:fe.description})]}),h.jsx("button",{type:"button",onClick:()=>ne(Ve),className:"text-muted-foreground hover:text-destructive",children:""})]})},`${fe.name}-${Ve}`))}),h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:Ls,placeholder:"Technique name",value:Sn.name,onChange:fe=>Ci(Ve=>({...Ve,name:fe.target.value}))}),h.jsx("input",{className:Ls,placeholder:"Short description",value:Sn.description??"",onChange:fe=>Ci(Ve=>({...Ve,description:fe.target.value}))}),h.jsx("button",{type:"button",onClick:$e,className:"md:col-span-2 inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Save technique"})]})]})}),h.jsx(Ws,{label:"Focus areas",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("input",{className:Ls,placeholder:"Add focus area and press Enter",value:Ur.field==="focusTags"?Ur.value:"",onChange:fe=>Ti({field:"focusTags",value:fe.target.value}),onKeyDown:fo("focusTags")}),h.jsx("div",{className:"flex flex-wrap gap-2",children:ze.focusTags.map(fe=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[fe,h.jsx("button",{type:"button",onClick:()=>ks("focusTags",fe),className:"text-muted-foreground hover:text-destructive",children:""})]},fe))})]})})]}),Mt==="Photos"&&h.jsxs(am,{title:"Photos",children:[ki&&h.jsx(Ws,{label:"Logo (verified labs)",children:h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsxs("label",{className:"inline-flex items-center gap-3",children:[h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"image/*",onChange:ui,className:"hidden"})]}),ze.logoUrl&&h.jsx("button",{type:"button",onClick:()=>It({...ze,logoUrl:""}),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-destructive hover:text-destructive",children:"Remove"})]}),xr&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading logo"}),yn&&h.jsx("p",{className:"text-xs text-destructive",children:yn}),ze.logoUrl&&h.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("img",{src:ze.logoUrl,alt:`${ze.name||"Lab"} logo`,className:"h-10 w-10 rounded-full object-cover"}),h.jsx("span",{className:"text-xs text-muted-foreground break-all max-w-[200px] truncate",children:ze.logoUrl})]})]})}),Yn?h.jsx(Ws,{label:"Partner logos (premier or multi-lab feature)",children:h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsx("label",{className:"inline-flex items-center gap-3",children:h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"image/*",onChange:_i,className:"hidden"})]})}),Zr.length>0&&h.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:Zr.map(fe=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2 flex-shrink-0",children:[h.jsx("img",{src:fe.url,alt:fe.name,className:"h-10 w-10 rounded object-cover"}),h.jsx("input",{className:"w-48 rounded-lg border border-border bg-background px-2 py-1 text-xs text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Partner website",value:fe.website??"",onChange:Ve=>oo(fe.url,{website:Ve.target.value})}),h.jsx("button",{type:"button",onClick:()=>Ds(fe.url),className:"text-xs text-muted-foreground hover:text-destructive",children:"Remove"})]},fe.url))}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Stored in `lab-logos` under partners/ folders. Shown for premier labs."})]})}):h.jsx("p",{className:"text-xs text-muted-foreground",children:"Partner logos are available on the premier plan or multi-lab accounts."}),h.jsx(Ws,{label:"Lab photos",children:h.jsxs("div",{className:"flex flex-col gap-2",children:[h.jsxs("div",{className:"flex flex-wrap gap-2",children:[h.jsx("label",{className:"inline-flex items-center gap-3",children:h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Upload file",h.jsx("input",{type:"file",accept:"image/*",onChange:No,className:"hidden"})]})}),h.jsxs("div",{className:"flex flex-1 gap-2",children:[h.jsx("input",{className:"input flex-1",value:rr,onChange:fe=>$t(fe.target.value),placeholder:"https://images.example.com/photo.jpg"}),h.jsx("button",{type:"button",onClick:Is,className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Add"})]})]}),At&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading photo"}),Sr&&h.jsx("p",{className:"text-xs text-destructive",children:Sr})]})}),Ht.length>0&&h.jsx("div",{className:"flex flex-wrap gap-3",children:Ht.map(fe=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("img",{src:fe.url,alt:fe.name,className:"h-14 w-20 rounded object-cover"}),h.jsx("button",{type:"button",onClick:()=>ao(fe),className:"text-xs text-muted-foreground hover:text-destructive",children:"Remove"})]},fe.url))})]}),Mt==="Offers"&&h.jsx(am,{title:"Offers",children:h.jsx(Ws,{label:"Offers",children:h.jsx("div",{className:"flex flex-wrap gap-3",children:Dw.map(fe=>h.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[h.jsx("input",{type:"checkbox",checked:ze.offers.includes(fe),onChange:Ve=>{It(Xe=>{const ct=Ve.target.checked?[...Xe.offers,fe]:Xe.offers.filter(tr=>tr!==fe);return{...Xe,offers:ct}})}}),fe]},fe))})})})]}),W&&h.jsx("p",{className:"mt-4 text-sm text-emerald-600",children:W}),Jt&&h.jsx("p",{className:"mt-4 text-sm text-destructive",children:Jt})]}),Je&&h.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-md rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Save changes?"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"This will update the lab profile for everyone who can see it."}),h.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-2",children:[h.jsx("button",{type:"button",onClick:()=>jt(!1),className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary",disabled:s,children:"Cancel"}),h.jsx("button",{type:"button",onClick:()=>{jt(!1),et()},className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-60",disabled:s,children:s?"Saving":"Save now"})]})]})}),Vr&&h.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-md rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Delete this lab?"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"This permanently deletes the lab profile and its related data. This action cannot be undone."}),h.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-2",children:[h.jsx("button",{type:"button",onClick:()=>Ke(!1),className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary",disabled:yr,children:"Cancel"}),h.jsx("button",{type:"button",onClick:()=>{Ke(!1),qe()},className:"rounded-full bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition hover:bg-destructive/90 disabled:opacity-60",disabled:yr,children:yr?"Deleting":"Yes, delete"})]})]})})]})}function am({title:i,children:n}){return h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-5 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:i}),h.jsx("div",{className:"grid gap-4",children:n})]})}function Ws({label:i,children:n}){return h.jsxs("div",{className:"grid gap-2",children:[h.jsx("label",{className:"text-sm font-medium text-foreground",children:i}),n]})}function yie(){return $.useEffect(()=>{(async()=>{try{await fn.auth.signOut()}finally{window.location.replace("/")}})()},[]),null}const ZR={ownerName:"",organization:"",labsManaged:"",email:"",phone:"",message:""};function _ie(){const{user:i,loading:n}=Ma(),[a,d]=Al(),[y,v]=$.useState(ZR),[C,s]=$.useState("idle"),[M,L]=$.useState(null),[F,W]=$.useState("idle"),[X,ee]=$.useState(null),[he,se]=$.useState(null),oe=typeof window<"u"?window.location.search:"",ve=$.useMemo(()=>{try{return new URLSearchParams(oe).get("plan")}catch{return null}},[oe]),me=(ve??"").toLowerCase(),Se=me==="base"||me==="free",Re=me==="verified"||me==="premier"||me==="custom",Be=me==="custom"||me==="enterprise",rt=i?.user_metadata?.full_name||i?.user_metadata?.name||i?.user_metadata?.fullName||i?.user_metadata?.display_name||i?.user_metadata?.displayName||"",We=`/api/stripe/checkout?plan=${me||"base"}`;$.useEffect(()=>{if(n)return;if(!ve||!["base","free","verified","premier","custom","enterprise"].includes(me)){d("/subscriptions");return}if(!i){const Rt=encodeURIComponent(`/payments?plan=${me}`);d(`/login?next=${Rt}`);return}},[i,ve,me,n,d]),$.useEffect(()=>{if(!i)return;async function $t(){const{data:Rt,error:Gt}=await fn.from("profiles").select("name").eq("user_id",i.id).maybeSingle();!Gt&&Rt?.name?(se(Rt.name),v(Ar=>({...Ar,ownerName:Ar.ownerName||Rt.name}))):se(null)}$t(),v(Rt=>({...Rt,ownerName:Rt.ownerName||rt||i?.email?.split("@")[0]||"",email:Rt.email||i.email||"",phone:Rt.phone||i.user_metadata?.phone||i.phone||""}))},[i,rt]);const Ct=$t=>Rt=>{v(Gt=>({...Gt,[$t]:Rt.target.value}))},Ht=async $t=>{$t.preventDefault(),s("loading"),L(null);try{const Rt=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:y.ownerName||y.organization,email:y.email,message:[`Organization: ${y.organization}`,`Labs managed: ${y.labsManaged}`,"",y.message||"No additional context provided."].join(`
`)})});if(!Rt.ok){const Gt=await Rt.json().catch(()=>({message:"Unable to send request"}));throw new Error(Gt?.message??"Unable to send request")}s("success"),v(ZR)}catch(Rt){s("error"),L(Rt instanceof Error?Rt.message:"Unable to send request")}},Zt=async()=>{W("loading"),ee(null);try{if(!(await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:y.ownerName||rt||i?.email||"GLASS-Connect user",email:i?.email,message:`Confirming free plan signup for ${i?.email||"unknown"} on GLASS-Connect.`})})).ok)throw new Error("Unable to send confirmation");W("success")}catch($t){W("error"),ee($t instanceof Error?$t.message:"Unable to send confirmation")}},rr="w-full rounded-2xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary";return n||!i||!ve?null:h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto px-4 py-20 lg:py-24 max-w-6xl space-y-12",children:[h.jsxs("header",{className:"space-y-4",children:[h.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground",children:"Payment flow"}),h.jsx("h1",{className:"text-4xl font-semibold text-foreground",children:Se?"Your GLASS-Connect free listing":"Stripe-first billing built for labs"}),h.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:Se?"Confirm your free plan so your listing stays live while you edit. You can upgrade anytime.":"We keep billing transparent: standard plans go through Stripe Checkout (with optional SEPA transfer), and multi-lab operators can request a custom agreement."}),h.jsxs("div",{className:"flex flex-wrap gap-3",children:[h.jsx(xn,{href:"/subscriptions",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full border border-border px-5 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"View subscriptions"})}),h.jsx(xn,{href:"/labs",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Explore live listings"})})]})]}),Se&&h.jsxs(Jn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-4",children:[h.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"Free plan confirmation"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Confirm your free GLASS-Connect listing. Well email a confirmation and keep your profile live while you edit."}),h.jsx("button",{onClick:Zt,disabled:F==="loading",className:"inline-flex w-full items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",children:F==="loading"?"Sending confirmation":"Confirm free plan"}),F==="success"&&h.jsxs("p",{className:"text-sm text-emerald-600",children:["Confirmation sent to ",i?.email??"your email on file",". If you dont see it, check spam or contact support."]}),F==="error"&&h.jsx("p",{className:"text-sm text-destructive",children:X??"We couldnt send the confirmation. Please try again or contact support."})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-4",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"What you get"}),h.jsxs("ul",{className:"space-y-3 text-sm text-muted-foreground",children:[h.jsxs("li",{className:"flex items-start gap-2",children:[h.jsx(xc,{className:"h-4 w-4 text-primary mt-0.5"}),"Standardised lab profile with capabilities, equipment, and contact prefs."]}),h.jsxs("li",{className:"flex items-start gap-2",children:[h.jsx(xc,{className:"h-4 w-4 text-primary mt-0.5"}),"Inbound requests routed to your team while you edit and refine details."]}),h.jsxs("li",{className:"flex items-start gap-2",children:[h.jsx(xc,{className:"h-4 w-4 text-primary mt-0.5"}),"Upgrade anytime to add verification, placement, and media support."]})]})]})]}),Re&&h.jsxs(Jn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid gap-8 lg:grid-cols-[1.1fr_0.9fr]",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-6",children:[h.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"Stripe Checkout"}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Youll be redirected to a Stripe-hosted checkout page for the ",me," plan. Glass never touches raw card numbers."]}),h.jsx("button",{onClick:()=>{window.location.href=We},className:"inline-flex w-full items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Proceed to Stripe Checkout"}),h.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-background/60 p-4 text-sm text-muted-foreground",children:"After payment, well activate your listing within one business day and schedule verification if needed."})]}),h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-4",children:[h.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Prefer bank transfer (SEPA)?"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Bank transfer option coming soon. We'll share SEPA details once the Glass account is live."})]})]}),Be&&h.jsxs(Jn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid gap-8 lg:grid-cols-[1.1fr_0.9fr]",children:[h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-6",children:[h.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"Enterprise intake"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Tell us about your network and billing needs. Well follow up with the right agreement, procurement details, and onboarding."}),h.jsxs("ul",{className:"space-y-3 text-sm text-muted-foreground",children:[h.jsx("li",{children:"Dedicated partner manager and verification scheduling across sites."}),h.jsx("li",{children:"Custom invoicing (ACH/SEPA/wire), procurement docs, and data exports."}),h.jsx("li",{children:"API access and multi-lab routing preferences."})]})]}),h.jsxs("div",{id:"custom",className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(C$,{className:"h-5 w-5 text-primary"}),h.jsxs("div",{children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Enterprise form"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Well get back to you within one business day."})]})]}),C==="success"&&h.jsx("div",{className:"rounded-2xl border border-emerald-300 bg-emerald-50 px-4 py-3 text-sm text-emerald-900",children:"Thanks! Weve logged your details and will respond within one business day."}),C==="error"&&h.jsx("div",{className:"rounded-2xl border border-destructive/50 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:M??"We couldnt send your message. Please try again."}),h.jsxs("form",{className:"space-y-4",onSubmit:Ht,children:[h.jsxs("label",{className:"space-y-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Your name"}),h.jsx("input",{className:rr,value:y.ownerName,onChange:Ct("ownerName"),placeholder:"Jordan Reyes",required:!0})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs("label",{className:"space-y-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Contact email"}),h.jsx("input",{type:"email",className:rr,value:y.email,onChange:Ct("email"),placeholder:"you@labs.com",required:!0})]}),h.jsxs("label",{className:"space-y-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Phone number"}),h.jsx("input",{className:rr,value:y.phone,onChange:Ct("phone"),placeholder:"+49 171 2345678",required:!0})]})]}),h.jsxs("label",{className:"space-y-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Organization"}),h.jsx("input",{className:rr,value:y.organization,onChange:Ct("organization"),placeholder:"Atlas Applied Biology",required:!0})]}),h.jsxs("label",{className:"space-y-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium text-foreground",children:"Labs managed (optional)"}),h.jsx("input",{className:rr,value:y.labsManaged,onChange:Ct("labsManaged"),placeholder:"e.g. 4 locations"})]}),h.jsxs("label",{className:"space-y-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium text-foreground",children:"What do you need?"}),h.jsx("textarea",{className:`${rr} min-h-[120px]`,value:y.message,onChange:Ct("message"),placeholder:"Tell us about your footprint, routing preferences, billing needs, or integrations."})]}),h.jsx("button",{type:"submit",disabled:C==="loading",className:"inline-flex w-full items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",children:C==="loading"?"Sending":"Send to Glass partnerships"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"We route this form to our Brevo/email inbox so a real person can follow up with invoices, contracts, or procurement info."})]})]})]}),h.jsxs(Jn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-4",children:[h.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Need a direct line?"}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Email ",h.jsx("a",{className:"text-primary underline",href:"mailto:contact@glass-funding.com",children:"contact@glass-funding.com"})," or drop a note in the custom form. We can accommodate purchase orders, wire transfers, and co-branded partnership agreements."]}),h.jsxs("div",{className:"flex flex-wrap gap-3",children:[h.jsx(xn,{href:"/subscriptions",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"Back to subscriptions"})}),h.jsx(xn,{href:"/labs",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"See partner labs"})})]})]})]})})}const xie=["Basics","Photos","Company details","Branding & Links","Compliance","Team","Offers"],vie=["1 = Lab Director","2 = Deputy Director","3 = Team Leader","4 = Researcher","5 = Postdoc","6 = PhD Student","7 = Research/Technical support"];function bie(){const{addLab:i}=Em(),{user:n}=Ma(),{hasFunctionalConsent:a}=w_(),[,d]=Al(),[y,v]=$.useState({name:"",labManager:"",contactEmail:n?.email??"",descriptionShort:"",descriptionLong:"",field:"",orgRole:"",offersLabSpace:!0,addressLine1:"",addressLine2:"",city:"",state:"",postalCode:"",country:"",website:"",linkedin:"",siretNumber:"",equipmentTags:[],priorityEquipmentTags:[],techniques:[],focusTags:[],complianceTags:[],offers:[],logoUrl:"",halStructureId:"",halPersonId:"",teamMembers:[]}),[C,s]=$.useState([]),[M,L]=$.useState([]),[F,W]=$.useState(""),[X,ee]=$.useState(""),[he,se]=$.useState(!1),[oe,ve]=$.useState(!1),[me,Se]=$.useState(!1),[Re,Be]=$.useState(null),[rt,We]=$.useState(null),[Ct,Ht]=$.useState(null),[Zt,rr]=$.useState([]),[$t,Rt]=$.useState(!1),[Gt,Ar]=$.useState(null),[Ut,Xt]=$.useState({field:"equipmentTags",value:""}),[ut,Mt]=$.useState({name:"",description:""}),[Qt,ze]=$.useState({name:"",title:"",linkedin:"",website:"",teamName:"",roleRank:""}),[It,xr]=$.useState(!1),[Lr,yn]=$.useState(null),[Yr,Zr]=$.useState("Basics"),Qr=xie,ir=Qr.indexOf(Yr),Hr=ir<=0,Ur=ir===Qr.length-1,[Ti,Sn]=$.useState("user"),[Ci,At]=$.useState({canCreateLab:!1,canManageMultipleLabs:!1,canManageTeams:!1,canManageMultipleTeams:!1,canPostNews:!1,canBrokerRequests:!1,canReceiveInvestor:!1}),[pt,Sr]=$.useState(!1),[Dr,Vr]=$.useState(!1),[Ke,Je]=$.useState(!1),jt=$.useMemo(()=>`new-lab-draft:${n?.id??"guest"}`,[n?.id]),yr=Ti==="admin"||Ci.canManageMultipleLabs,pr=Ci.canManageMultipleLabs?Number.POSITIVE_INFINITY:2;$.useEffect(()=>{n?.id&&fn.from("profiles").select(["role","can_create_lab","can_manage_multiple_labs","can_manage_teams","can_manage_multiple_teams","can_post_news","can_broker_requests","can_receive_investor"].join(",")).eq("user_id",n.id).maybeSingle().then(({data:Ze})=>{Sn((Ze?.role||"user").toLowerCase()),At({canCreateLab:!!Ze?.can_create_lab,canManageMultipleLabs:!!Ze?.can_manage_multiple_labs,canManageTeams:!!Ze?.can_manage_teams,canManageMultipleTeams:!!Ze?.can_manage_multiple_teams,canPostNews:!!Ze?.can_post_news,canBrokerRequests:!!Ze?.can_broker_requests,canReceiveInvestor:!!Ze?.can_receive_investor})}).catch(()=>{})},[n?.id]),$.useEffect(()=>{if(a)try{const Ze=localStorage.getItem(jt);if(!Ze)return;const ur=JSON.parse(Ze);ur?.form&&v(kr=>({...kr,...ur.form})),Array.isArray(ur?.photos)&&s(ur.photos),Array.isArray(ur?.partnerLogos)&&L(ur.partnerLogos),Array.isArray(ur?.complianceDocs)&&rr(ur.complianceDocs),typeof ur?.activeTab=="string"&&Qr.includes(ur.activeTab)&&Zr(ur.activeTab)}catch{}},[jt,Qr,a]),$.useEffect(()=>{if(!a)return;const Ze=window.setTimeout(()=>{const ur={form:y,photos:C,partnerLogos:M,complianceDocs:Zt,activeTab:Yr};localStorage.setItem(jt,JSON.stringify(ur))},250);return()=>window.clearTimeout(Ze)},[jt,y,C,M,Zt,Yr,a]);const Jt=(Ze,ur)=>{v(kr=>({...kr,[Ze]:ur}))},Or=()=>{const Ze=Qt.name.trim(),ur=Qt.title.trim();if(!Ze||!ur)return;const kr=Qt.linkedin.trim(),An=Qt.website.trim(),ki=Qt.teamName.trim(),Yn=Qt.roleRank.trim(),Ri=Yn?Number(Yn):null;v(ui=>({...ui,teamMembers:[...ui.teamMembers,{name:Ze,title:ur,linkedin:kr||null,website:An||null,teamName:ki||null,roleRank:Ri&&Number.isFinite(Ri)&&Ri>0?Ri:null,isLead:ui.teamMembers.length===0}]})),ze({name:"",title:"",linkedin:"",website:"",teamName:"",roleRank:""})},sn=(Ze,ur)=>{v(kr=>({...kr,teamMembers:kr.teamMembers.filter(An=>!(An.name===Ze&&An.title===ur))}))},Mn=(Ze,ur)=>{v(kr=>({...kr,teamMembers:kr.teamMembers.map(An=>({...An,isLead:An.name===Ze&&An.title===ur}))}))},Gi=(Ze,ur)=>{const kr=ur.trim();kr&&(v(An=>{const ki=new Set(An[Ze]);return ki.add(kr),{...An,[Ze]:Array.from(ki)}}),Xt({field:Ze,value:""}))},yi=(Ze,ur)=>{v(kr=>{const An=kr[Ze].filter(ki=>ki!==ur);return Ze==="equipmentTags"?{...kr,equipmentTags:An,priorityEquipmentTags:kr.priorityEquipmentTags.filter(ki=>ki!==ur)}:{...kr,[Ze]:An}})},vt=Ze=>ur=>{ur.key==="Enter"&&(ur.preventDefault(),Gi(Ze,Ut.value))},or=Ze=>{v(ur=>{const kr=new Set(ur.priorityEquipmentTags);if(kr.has(Ze))kr.delete(Ze);else{if(kr.size>=3)return ur;kr.add(Ze)}return{...ur,priorityEquipmentTags:Array.from(kr)}})},dn=()=>{const Ze=ut.name.trim();if(!Ze)return;const ur=ut.description?.toString().trim()||null;v(kr=>({...kr,techniques:[...kr.techniques,{name:Ze,description:ur}]})),Mt({name:"",description:""})},Ln=Ze=>{v(ur=>({...ur,techniques:ur.techniques.filter((kr,An)=>An!==Ze)}))},Bn=async()=>{xr(!0),yn(null);try{const Ze=await i({name:y.name.trim(),labManager:y.labManager.trim(),contactEmail:y.contactEmail.trim(),ownerUserId:n?.id??null,descriptionShort:y.descriptionShort.trim()||null,descriptionLong:y.descriptionLong.trim()||null,offersLabSpace:y.offersLabSpace,addressLine1:y.addressLine1.trim()||null,addressLine2:y.addressLine2.trim()||null,city:y.city.trim()||null,state:y.state.trim()||null,postalCode:y.postalCode.trim()||null,country:y.country.trim()||null,website:y.website.trim()||null,linkedin:y.linkedin.trim()||null,compliance:y.complianceTags,complianceDocs:Zt,labStatus:"confirmed",isVisible:!0,equipment:y.equipmentTags,priorityEquipment:y.priorityEquipmentTags.filter(ur=>y.equipmentTags.includes(ur)).slice(0,3),techniques:y.techniques,focusAreas:y.focusTags,offers:y.offers,photos:C,logoUrl:y.logoUrl.trim()||null,siretNumber:y.siretNumber.trim()||null,partnerLogos:M,field:y.field.trim()||null,orgRole:y.orgRole||null,halStructureId:y.halStructureId.trim()||null,halPersonId:y.halPersonId.trim()||null,teamMembers:y.teamMembers});a&&localStorage.removeItem(jt),d(`/lab/manage/${Ze.id}`)}catch(Ze){yn(Ze?.message||"Unable to create lab")}finally{xr(!1)}};return h.jsxs("section",{className:"bg-background min-h-screen",children:[h.jsxs("div",{className:"container mx-auto px-4 py-20 lg:py-24 max-w-3xl",children:[h.jsx(xn,{href:"/account?tab=manageLab",className:"text-sm text-muted-foreground hover:text-primary inline-flex items-center gap-1 mb-4 rounded-full border border-border px-3 py-1",children:" Back to manage labs"}),h.jsxs(Jn.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.5},className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Create"}),h.jsx("h1",{className:"text-3xl font-semibold text-foreground mt-1",children:"Add a new lab"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Start with the basics. You can add photos, equipment, and pricing later."}),h.jsxs("form",{className:"mt-8 space-y-8",onSubmit:Ze=>Ze.preventDefault(),onKeyDown:Ze=>{if(Ze.defaultPrevented||Ze.key!=="Enter")return;const ur=Ze.target;ur instanceof HTMLTextAreaElement||ur instanceof HTMLButtonElement||Ze.preventDefault()},children:[h.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:h.jsx("div",{className:"flex flex-wrap gap-2",children:Qr.map(Ze=>h.jsx("button",{type:"button",onClick:()=>Zr(Ze),className:`rounded-full border px-4 py-1.5 text-sm font-medium transition ${Yr===Ze?"border-primary bg-primary/10 text-primary":"border-border text-muted-foreground hover:border-primary/50 hover:text-primary"}`,children:Ze},Ze))})}),Yr==="Basics"&&h.jsxs(gg,{title:"Basics",children:[h.jsx(Co,{label:"Lab name",required:!0,children:h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.name,onChange:Ze=>Jt("name",Ze.target.value),required:!0})}),h.jsx(Co,{label:"SIRET (optional)",children:h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.siretNumber,onChange:Ze=>Jt("siretNumber",Ze.target.value)})}),h.jsx(Co,{label:"Lab manager",required:!0,children:h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.labManager,onChange:Ze=>Jt("labManager",Ze.target.value),required:!0})}),h.jsx(Co,{label:"Contact email",required:!0,children:h.jsx("input",{type:"email",className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.contactEmail,onChange:Ze=>Jt("contactEmail",Ze.target.value),required:!0})}),h.jsx(Co,{label:"Short description",children:h.jsx("textarea",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary min-h-[96px]",value:y.descriptionShort,onChange:Ze=>Jt("descriptionShort",Ze.target.value),placeholder:"One or two sentences that appear under your lab name."})}),h.jsx(Co,{label:"Long description (optional)",children:h.jsx("textarea",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary min-h-[140px]",value:y.descriptionLong,onChange:Ze=>Jt("descriptionLong",Ze.target.value),placeholder:"A longer overview for partners who want more detail."})}),h.jsx(Co,{label:"Science field (optional)",children:h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.field,onChange:Ze=>Jt("field",Ze.target.value),placeholder:"e.g., immunology, materials science, bioengineering"})}),h.jsx(Co,{label:"Organization role (optional)",children:h.jsxs("select",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.orgRole,onChange:Ze=>Jt("orgRole",Ze.target.value),children:[h.jsx("option",{value:"",children:"Select role type"}),f_.map(Ze=>h.jsx("option",{value:Ze,children:Ze},Ze))]})}),h.jsx(Co,{label:"HAL structure ID (optional)",children:h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.halStructureId,onChange:Ze=>Jt("halStructureId",Ze.target.value),placeholder:"e.g., struct-123456"})}),h.jsx(Co,{label:"HAL person ID (optional)",children:h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.halPersonId,onChange:Ze=>Jt("halPersonId",Ze.target.value),placeholder:"e.g., 123456"})}),h.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-foreground",children:[h.jsx("input",{type:"checkbox",className:"rounded border-border text-primary",checked:y.offersLabSpace,onChange:Ze=>Jt("offersLabSpace",Ze.target.checked)}),"Offers lab space"]})]}),Yr==="Photos"&&h.jsxs(gg,{title:"Photos",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Co,{label:"Logo",children:h.jsx("input",{className:"input",value:y.logoUrl,onChange:Ze=>Jt("logoUrl",Ze.target.value)})}),h.jsxs("label",{className:"inline-flex items-center gap-3",children:[h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async Ze=>{const ur=Ze.target.files?.[0];ur&&(Be(null),se(!0),await s0("lab-logos",ur,"new/logos",(kr,An)=>v(ki=>({...ki,logoUrl:kr||ki.logoUrl||""})),kr=>Be(kr)),se(!1),Ze.target&&(Ze.target.value=""))}})]}),he&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading"}),Re&&h.jsx("p",{className:"text-xs text-destructive",children:Re})]})]}),h.jsxs("div",{className:"space-y-3",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:"Photos"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(Ze=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("span",{className:"text-xs text-foreground break-all max-w-[200px] truncate",children:Ze.name||Ze.url}),h.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-destructive",onClick:()=>s(ur=>ur.filter(kr=>kr.url!==Ze.url)),children:"Remove"})]},Ze.url))}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("input",{className:"input flex-1",value:F,onChange:Ze=>W(Ze.target.value),placeholder:"https://example.com/photo.jpg"}),h.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-border px-3 py-2 text-sm font-medium text-foreground transition hover:border-primary",onClick:()=>{const Ze=F.trim();if(!Ze||C.length>=pr)return;const ur=Ze.split("/").pop()||`Photo ${C.length+1}`;s(kr=>[...kr,{name:ur,url:Ze}]),W("")},disabled:C.length>=pr,children:"Add photo"})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("label",{className:"inline-flex items-center gap-3",children:h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:C.length>=pr,onChange:async Ze=>{const ur=Ze.target.files?.[0];!ur||C.length>=pr||(We(null),ve(!0),await s0("lab-photos",ur,"new/photos",(kr,An)=>s(ki=>[...ki,{name:An,url:kr}]),kr=>We(kr)),ve(!1),Ze.target&&(Ze.target.value=""))}})]})}),oe&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading"}),rt&&h.jsx("p",{className:"text-xs text-destructive",children:rt})]})]}),yr&&h.jsxs("div",{className:"space-y-3",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:"Partner logos"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(Ze=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("span",{className:"text-xs text-foreground break-all max-w-[200px] truncate",children:Ze.name||Ze.url}),h.jsx("input",{className:"w-48 rounded-lg border border-border bg-background px-2 py-1 text-xs text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Partner website",value:Ze.website??"",onChange:ur=>L(kr=>kr.map(An=>An.url===Ze.url?{...An,website:ur.target.value}:An))}),h.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-destructive",onClick:()=>L(ur=>ur.filter(kr=>kr.url!==Ze.url)),children:"Remove"})]},Ze.url))}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("input",{className:"input flex-1",value:X,onChange:Ze=>ee(Ze.target.value),placeholder:"https://example.com/logo.png"}),h.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-border px-3 py-2 text-sm font-medium text-foreground transition hover:border-primary",onClick:()=>{const Ze=X.trim();if(!Ze)return;const ur=Ze.split("/").pop()||`Logo ${M.length+1}`;L(kr=>[...kr,{name:ur,url:Ze,website:null}]),ee("")},children:"Add logo"})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("label",{className:"inline-flex items-center gap-3",children:h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async Ze=>{const ur=Ze.target.files?.[0];ur&&(Ht(null),Se(!0),await s0("lab-logos",ur,"new/partners",(kr,An)=>L(ki=>[...ki,{name:An,url:kr,website:null}]),kr=>Ht(kr)),Se(!1),Ze.target&&(Ze.target.value=""))}})]})}),me&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading"}),Ct&&h.jsx("p",{className:"text-xs text-destructive",children:Ct})]})]})]}),Yr==="Company details"&&h.jsx(gg,{title:"Company details",children:h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsx(Co,{label:"Address line 1",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.addressLine1,onChange:Ze=>Jt("addressLine1",Ze.target.value)})}),h.jsx(Co,{label:"Address line 2",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.addressLine2,onChange:Ze=>Jt("addressLine2",Ze.target.value)})}),h.jsx(Co,{label:"City",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.city,onChange:Ze=>Jt("city",Ze.target.value)})}),h.jsx(Co,{label:"State/Region",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.state,onChange:Ze=>Jt("state",Ze.target.value)})}),h.jsx(Co,{label:"Postal code",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.postalCode,onChange:Ze=>Jt("postalCode",Ze.target.value)})}),h.jsx(Co,{label:"Country",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.country,onChange:Ze=>Jt("country",Ze.target.value)})})]})}),Yr==="Team"&&h.jsx(gg,{title:"Team members",children:h.jsxs("div",{className:"space-y-3",children:[h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Full name",value:Qt.name,onChange:Ze=>ze(ur=>({...ur,name:Ze.target.value}))}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Title",value:Qt.title,onChange:Ze=>ze(ur=>({...ur,title:Ze.target.value}))})]}),h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Team / group (optional)",value:Qt.teamName,onChange:Ze=>ze(ur=>({...ur,teamName:Ze.target.value}))}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Role rank (1-7)",value:Qt.roleRank,onChange:Ze=>ze(ur=>({...ur,roleRank:Ze.target.value}))}),h.jsxs("div",{className:"relative",children:[h.jsx("button",{type:"button",onClick:()=>Je(Ze=>!Ze),onMouseEnter:()=>Vr(!0),onMouseLeave:()=>Vr(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-border text-xs font-semibold text-muted-foreground hover:border-primary hover:text-primary","aria-label":"Role rank guidance",children:"i"}),(Ke||Dr)&&h.jsxs("div",{className:"absolute right-0 top-full z-10 mt-2 w-56 rounded-2xl border border-border bg-background/95 p-3 text-xs text-muted-foreground shadow-lg",children:[h.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Rank guide"}),h.jsx("ul",{className:"mt-2 space-y-1",children:vie.map(Ze=>h.jsx("li",{children:Ze},Ze))})]})]})]})]}),h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"LinkedIn (optional)",value:Qt.linkedin,onChange:Ze=>ze(ur=>({...ur,linkedin:Ze.target.value}))}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Website (optional)",value:Qt.website,onChange:Ze=>ze(ur=>({...ur,website:Ze.target.value}))})]}),h.jsx("button",{type:"button",onClick:Or,className:"inline-flex items-center rounded-full border border-border px-3 py-2 text-sm font-medium text-foreground transition hover:border-primary",children:"Save team member"}),h.jsx("div",{className:"space-y-2",children:y.teamMembers.map(Ze=>h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-xl border border-border bg-muted/30 px-3 py-2",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsxs("p",{className:"text-sm font-medium text-foreground",children:[Ze.name,Ze.isLead&&h.jsx("span",{className:"ml-2 text-xs text-primary",children:"Lead"})]}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[Ze.title,Ze.roleRank?`  Rank ${Ze.roleRank}`:""]}),Ze.teamName&&h.jsxs("p",{className:"text-xs text-muted-foreground",children:["Team: ",Ze.teamName]}),(Ze.linkedin||Ze.website)&&h.jsx("p",{className:"text-xs text-muted-foreground",children:Ze.linkedin||Ze.website})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx("button",{type:"button",onClick:()=>Mn(Ze.name,Ze.title),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-primary hover:text-primary",children:"Set lead"}),h.jsx("button",{type:"button",onClick:()=>sn(Ze.name,Ze.title),className:"rounded-full border border-border px-3 py-1 text-xs text-muted-foreground hover:border-destructive hover:text-destructive",children:"Remove"})]})]},`${Ze.name}-${Ze.title}`))})]})}),Yr==="Branding & Links"&&h.jsx(gg,{title:"Branding & Links",children:h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsx(Co,{label:"Website",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.website,onChange:Ze=>Jt("website",Ze.target.value)})}),h.jsx(Co,{label:"LinkedIn",children:h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",value:y.linkedin,onChange:Ze=>Jt("linkedin",Ze.target.value)})})]})}),Yr==="Compliance"&&h.jsxs(gg,{title:"Compliance",children:[h.jsx(Co,{label:"Equipment",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Add equipment and press Enter",value:Ut.field==="equipmentTags"?Ut.value:"",onChange:Ze=>Xt({field:"equipmentTags",value:Ze.target.value}),onKeyDown:vt("equipmentTags")}),h.jsx("div",{className:"flex flex-wrap gap-2",children:y.equipmentTags.map(Ze=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[Ze,h.jsx("button",{type:"button",onClick:()=>yi("equipmentTags",Ze),className:"text-muted-foreground hover:text-destructive",children:""})]},Ze))}),h.jsxs("div",{className:"pt-2",children:[h.jsx("p",{className:"text-xs text-muted-foreground",children:"Select up to three priority items."}),h.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[y.equipmentTags.map(Ze=>{const ur=y.priorityEquipmentTags.includes(Ze);return h.jsx("button",{type:"button",onClick:()=>or(Ze),className:`rounded-full border px-3 py-1 text-xs ${ur?"border-primary bg-primary/10 font-semibold text-primary":"border-border text-muted-foreground hover:border-primary hover:text-primary"}`,children:Ze},`priority-${Ze}`)}),y.equipmentTags.length===0&&h.jsx("span",{className:"text-xs text-muted-foreground",children:"Add equipment to enable prioritization."})]})]})]})}),h.jsx(Co,{label:"Techniques",children:h.jsxs("div",{className:"space-y-3",children:[h.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:y.techniques.map((Ze,ur)=>h.jsx("div",{className:"rounded-2xl border border-border px-4 py-3",children:h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold text-foreground",children:Ze.name}),Ze.description&&h.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:Ze.description})]}),h.jsx("button",{type:"button",onClick:()=>Ln(ur),className:"text-muted-foreground hover:text-destructive",children:""})]})},`${Ze.name}-${ur}`))}),h.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Technique name",value:ut.name,onChange:Ze=>Mt(ur=>({...ur,name:Ze.target.value}))}),h.jsx("input",{className:"w-full rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Short description",value:ut.description??"",onChange:Ze=>Mt(ur=>({...ur,description:Ze.target.value}))}),h.jsx("button",{type:"button",onClick:dn,className:"md:col-span-2 inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-sm text-muted-foreground hover:border-primary hover:text-primary",children:"Save technique"})]})]})}),h.jsx(Co,{label:"Focus areas",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Add focus area and press Enter",value:Ut.field==="focusTags"?Ut.value:"",onChange:Ze=>Xt({field:"focusTags",value:Ze.target.value}),onKeyDown:vt("focusTags")}),h.jsx("div",{className:"flex flex-wrap gap-2",children:y.focusTags.map(Ze=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[Ze,h.jsx("button",{type:"button",onClick:()=>yi("focusTags",Ze),className:"text-muted-foreground hover:text-destructive",children:""})]},Ze))})]})}),h.jsx(Co,{label:"Compliance",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("input",{className:"w-full rounded-xl border-2 border-primary/30 bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",placeholder:"Add compliance and press Enter",value:Ut.field==="complianceTags"?Ut.value:"",onChange:Ze=>Xt({field:"complianceTags",value:Ze.target.value}),onKeyDown:vt("complianceTags")}),h.jsx("div",{className:"flex flex-wrap gap-2",children:y.complianceTags.map(Ze=>h.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-xs text-muted-foreground",children:[Ze,h.jsx("button",{type:"button",onClick:()=>yi("complianceTags",Ze),className:"text-muted-foreground hover:text-destructive",children:""})]},Ze))})]})}),h.jsxs("div",{className:"space-y-3",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:"Compliance documents (PDF)"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:Zt.map(Ze=>h.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border bg-muted/40 px-3 py-2",children:[h.jsx("span",{className:"text-xs text-foreground break-all max-w-[200px] truncate",children:Ze.name||Ze.url}),h.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-destructive",onClick:()=>rr(ur=>ur.filter(kr=>kr.url!==Ze.url)),children:"Remove"})]},Ze.url))}),h.jsx("label",{className:"inline-flex items-center gap-3",children:h.jsxs("span",{className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground cursor-pointer transition hover:bg-primary/90",children:["Choose file",h.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",onChange:async Ze=>{const ur=Ze.target.files?.[0];ur&&(Ar(null),Rt(!0),await s0("lab-pdfs",ur,"new/compliance",(kr,An)=>rr(ki=>[...ki,{name:An,url:kr}]),kr=>Ar(kr)),Rt(!1),Ze.target&&(Ze.target.value=""))}})]})}),$t&&h.jsx("p",{className:"text-xs text-muted-foreground",children:"Uploading"}),Gt&&h.jsx("p",{className:"text-xs text-destructive",children:Gt}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload PDF compliance certificates; you can add more later."})]})]}),Yr==="Offers"&&h.jsx(gg,{title:"Offers",children:h.jsxs("div",{className:"space-y-2",children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:"Offers"}),h.jsx("div",{className:"flex flex-wrap gap-2",children:Dw.map(Ze=>h.jsxs("label",{className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-1 text-sm text-foreground",children:[h.jsx("input",{type:"checkbox",className:"rounded border-border text-primary",checked:y.offers.includes(Ze),onChange:ur=>{const kr=ur.target.checked?[...y.offers,Ze]:y.offers.filter(An=>An!==Ze);Jt("offers",kr)}}),Ze]},Ze))})]})}),h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-border/70 pt-4",children:[h.jsx("button",{type:"button",onClick:()=>Zr(Qr[Math.max(0,ir-1)]),className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary disabled:opacity-50",disabled:Hr,children:"Back"}),h.jsxs("div",{className:"flex items-center gap-2",children:[!Ur&&h.jsx("button",{type:"button",onClick:()=>Zr(Qr[Math.min(Qr.length-1,ir+1)]),className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"Next"}),Ur&&h.jsx("button",{type:"button",onClick:()=>Sr(!0),disabled:It,className:"inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-60",children:It?"Creating":"Create lab"})]})]}),Lr&&h.jsx("p",{className:"text-sm text-destructive",children:Lr})]})]})]}),pt&&h.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-8",children:h.jsxs("div",{className:"w-full max-w-md rounded-3xl border border-border bg-background p-6 shadow-xl",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Create this lab?"}),h.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"We'll publish this lab profile using the details you entered. You can update it anytime in Manage labs."}),h.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-2",children:[h.jsx("button",{type:"button",onClick:()=>Sr(!1),className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground hover:border-primary hover:text-primary",children:"Cancel"}),h.jsx("button",{type:"button",onClick:()=>{Sr(!1),Bn()},disabled:It,className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90 disabled:opacity-60",children:It?"Creating":"Yes, create"})]})]})})]})}function Co({label:i,children:n,required:a}){return h.jsxs("label",{className:"grid gap-1 text-sm font-medium text-foreground",children:[i," ",a?h.jsx("span",{className:"text-destructive",children:"*"}):null,h.jsx("div",{className:"text-foreground font-normal",children:n})]})}function gg({title:i,children:n}){return h.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-5 space-y-4",children:[h.jsx("h2",{className:"text-lg font-semibold text-foreground",children:i}),h.jsx("div",{className:"grid gap-4",children:n})]})}const wie=i=>{const n=i.split(".").pop()||"jpg";return typeof crypto<"u"&&crypto.randomUUID?`${crypto.randomUUID()}.${n}`:`${Date.now()}.${n}`},s0=async(i,n,a,d,y)=>{try{const v=`${a}/${wie(n.name)}`,{error:C}=await fn.storage.from(i).upload(v,n,{upsert:!0,contentType:n.type});if(C)throw C;const{data:s}=fn.storage.from(i).getPublicUrl(v);d(s.publicUrl,n.name)}catch(v){y(v?.message||"Upload failed")}},Sie=[{name:"Base",monthly_price:0,yearly_price:0,description:"Launch on GLASS-Connect with the essentials.",highlights:["Profile page","Equipment showcase","Inbound contact form"],featured:!1},{name:"Verified",monthly_price:99,yearly_price:999,description:"Add the badge researchers trust.",highlights:["Remote/on-site verification","Badge on listing","Priority placement"],featured:!1},{name:"Premier",monthly_price:199,yearly_price:1990,description:"Flagship placement plus media support.",highlights:["Free verification","Direct collaboration management","Seminar access"],featured:!0},{name:"Custom",monthly_price:null,yearly_price:null,description:"For networks or operators managing multiple labs.",highlights:["Central billing","Dedicated partner manager","API & tooling access"],featured:!1}];function Tie(){const[i,n]=$.useState(Sie),[a,d]=$.useState(!1);return $.useEffect(()=>{let y=!0;async function v(){d(!0);try{const C=await fetch("/api/pricing"),s=C.headers.get("content-type")||"";if(!C.ok||!s.includes("application/json")){await C.text();return}const M=await C.json();y&&Array.isArray(M?.tiers)&&M.tiers.length&&n(M.tiers.map(L=>({name:L.name,monthly_price:L.monthly_price===void 0?null:L.monthly_price,yearly_price:L.yearly_price===void 0?null:L.yearly_price,currency:L.currency??null,description:L.description,highlights:Array.isArray(L.highlights)?L.highlights:[],featured:!!L.featured})))}catch{}finally{y&&d(!1)}}return v(),()=>{y=!1}},[]),{tiers:i,loading:a}}function Eie(){const{tiers:i}=Tie();return h.jsx("section",{className:"bg-background min-h-screen",children:h.jsxs("div",{className:"container mx-auto max-w-5xl px-4 py-20 lg:py-24 space-y-10",children:[h.jsxs("header",{className:"space-y-4",children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Subscriptions"}),h.jsx("h1",{className:"text-4xl md:text-5xl font-semibold text-foreground",children:"Choose your GLASS plan"}),h.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:"New accounts start on Base. Upgrade anytime; after payment well switch your subscription tier automatically."}),h.jsx("div",{className:"flex flex-wrap gap-3",children:h.jsx(xn,{href:"/account",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Back to profile"})})})]}),h.jsx(Jn.div,{initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{duration:.5},className:"grid gap-6 lg:grid-cols-2",children:i.map(n=>{const a=n.featured,d=n.name.toLowerCase(),y=d==="custom"?"/payments?plan=custom#custom":`/payments?plan=${d}`,v=n.monthly_price??n.monthlyPrice,C=v===0||v==="0",s=v!=null&&!C,M=C?"Free":s?`${v}/mo`:"Talk to us";return h.jsxs("article",{className:`rounded-[32px] border border-border bg-card/90 p-8 shadow-sm ${a?"lg:col-span-2 bg-gradient-to-br from-card to-primary/5":""}`,children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:n.name}),h.jsx("p",{className:"mt-3 text-3xl font-semibold text-foreground",children:M}),h.jsx("p",{className:"text-sm text-muted-foreground",children:n.description??"Choose your plan and switch anytime."})]}),n.name==="Base"&&h.jsx(xc,{className:"h-6 w-6 text-muted-foreground"}),a&&h.jsx(KM,{className:"h-6 w-6 text-primary"})]}),h.jsx("ul",{className:"mt-5 space-y-3 text-sm text-muted-foreground",children:n.highlights?.map(L=>h.jsxs("li",{className:"flex items-center gap-3",children:[h.jsx(WM,{className:"h-4 w-4 text-primary"}),L]},L))}),h.jsx(xn,{href:y,children:h.jsx("a",{className:`mt-6 inline-flex items-center rounded-full px-4 py-2 text-sm font-medium transition ${d==="custom"?"border border-border text-muted-foreground hover:border-primary hover:text-primary":"bg-primary text-primary-foreground hover:bg-primary/90"}`,children:d==="custom"?"Talk to us":"Subscribe"})})]},d)})})]})})}function XR(){return h.jsx("div",{className:"max-w-3xl mx-auto px-4 pb-20",children:h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-4 text-center",children:[h.jsx("h1",{className:"text-2xl font-semibold",children:"Donations are paused for now"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"We're finalizing the donation flow. During the beta you can keep using Glass Connect for freeno payment needed right now."}),h.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-3 pt-4",children:[h.jsx(xn,{href:"/",className:"rounded-full bg-primary px-5 py-2 text-primary-foreground text-sm font-medium hover:bg-primary/90",children:"Back to home"}),h.jsx(xn,{href:"/labs",className:"text-sm text-muted-foreground hover:text-foreground",children:"Explore labs"})]})]})})}function Zf({path:i,component:n}){const{user:a,loading:d}=Ma(),[,y]=Al(),[v,C]=$.useState(!0),[s,M]=$.useState(null);return $.useEffect(()=>{let L=!0;async function F(){C(!0);try{const{data:W}=await fn.auth.getSession();if(!L)return;M(!!W.session?.user)}finally{L&&C(!1)}}return a?(M(!0),C(!1)):F(),()=>{L=!1}},[a]),h.jsx(gs,{path:i,component:L=>{if(d||v||s===null)return null;if(a||s)return h.jsx(n,{...L});const F=encodeURIComponent(window.location.pathname+window.location.search);return y(`/login?next=${F}`,{replace:!0}),null}})}function o0({path:i,component:n}){const{user:a,loading:d}=Ma(),[y,v]=$.useState(null);return $.useEffect(()=>{let C=!0;async function s(){if(!a){v(!1);return}const{data:M,error:L}=await fn.from("profiles").select("can_create_lab").eq("user_id",a.id).maybeSingle();if(C){if(L){v(!1);return}v(!!M?.can_create_lab)}}return d||s(),()=>{C=!1}},[d,a?.id]),h.jsx(gs,{path:i,component:C=>{if(d||y===null)return null;if(!a){const s=encodeURIComponent(window.location.pathname);return window.location.replace(`/login?next=${s}`),null}if(!y){const s=C?.params?.id;return window.location.replace(s?`/labs/${s}`:"/"),null}return h.jsx(n,{...C})}})}function Cie({path:i,component:n}){const{user:a,loading:d}=Ma(),[y,v]=$.useState(null);return $.useEffect(()=>{let C=!0;async function s(){if(!a){v(!1);return}const{data:M,error:L}=await fn.from("profiles").select("role").eq("user_id",a.id).maybeSingle();if(!C)return;if(L){v(!1);return}const F=typeof M?.role=="string"?M.role.toLowerCase().trim():"";v(F==="admin")}return d||s(),()=>{C=!1}},[d,a?.id]),h.jsx(gs,{path:i,component:C=>d||y===null?null:a?y?h.jsx(n,{...C}):(window.location.replace("/"),null):(window.location.replace(`/login?next=${encodeURIComponent(i)}`),null)})}function Aie(){const{user:i,loading:n}=Ma(),[a,d]=Al(),[y,v]=$.useState(!1),C=typeof window<"u"?window.location.search:"",s=$.useMemo(()=>{try{return new URLSearchParams(C).get("plan")?.toLowerCase()??null}catch{return null}},[C]),L=s&&["verified","premier","custom"].includes(s);return $.useEffect(()=>{if(!n){if(!L){d("/subscriptions");return}if(!i){const F=encodeURIComponent(`/stripe?plan=${s}`);d(`/login?next=${F}`);return}v(!0),window.location.href=`/api/stripe/checkout?plan=${s}`}},[i,n,L,s,d]),n||!L?null:h.jsx("section",{className:"bg-background min-h-screen",children:h.jsx("div",{className:"container mx-auto px-4 py-20 max-w-3xl",children:h.jsxs("div",{className:"rounded-3xl border border-border bg-card/80 p-8 shadow-sm space-y-6 text-center",children:[h.jsx("div",{className:"flex justify-center",children:h.jsx("span",{className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-1.5 text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Stripe checkout"})}),h.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:"Redirecting to Stripe"}),h.jsxs("p",{className:"text-muted-foreground text-sm",children:["Were opening Stripe for the ",s," plan. If nothing happens, use the button below."]}),h.jsx("div",{className:"flex justify-center",children:h.jsx(Jn.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.4,ease:"linear"},children:h.jsx(ST,{className:"h-10 w-10 text-primary"})})}),h.jsxs("button",{onClick:()=>{v(!0),window.location.href=`/api/stripe/checkout?plan=${s}`},className:"inline-flex items-center justify-center rounded-full bg-primary px-5 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",disabled:y,children:[h.jsx(j$,{className:"mr-2 h-4 w-4"}),y?"Opening Stripe...":"Open Stripe Checkout"]}),h.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-background/60 p-4 text-xs text-muted-foreground text-left space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2 text-foreground font-semibold text-sm",children:[h.jsx(xc,{className:"h-4 w-4 text-primary"}),"What to expect"]}),h.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[h.jsx("li",{children:"We never see or store card numbersStripe handles everything."}),h.jsx("li",{children:"Youll receive a receipt immediately after payment."}),h.jsx("li",{children:"Your listing is activated within one business day."})]})]}),h.jsxs("div",{className:"flex flex-wrap justify-center gap-3 text-sm",children:[h.jsx(xn,{href:"/subscriptions",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full border border-border px-4 py-2 text-muted-foreground transition hover:border-primary hover:text-primary",children:"Back to subscriptions"})}),h.jsx(xn,{href:"/payments",children:h.jsx("a",{className:"inline-flex items-center justify-center rounded-full bg-foreground px-4 py-2 text-background transition hover:bg-foreground/90",children:"View payment options"})})]})]})})})}function Iie(){const{openPreferences:i}=w_();return h.jsx("footer",{className:"bg-muted py-12",children:h.jsxs("div",{className:"container mx-auto px-4",children:[h.jsxs(Jn.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},className:"grid md:grid-cols-4 gap-8",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"font-bold text-lg mb-4",children:"Glass"}),h.jsx("p",{className:"text-muted-foreground text-sm",children:"Connecting labs with collaborators through trusted, verified profiles."})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Quick Links"}),h.jsxs("ul",{className:"space-y-2",children:[h.jsx("li",{children:h.jsx(xn,{href:"/",className:"text-muted-foreground hover:text-primary transition-colors",children:"Home"})}),h.jsx("li",{children:h.jsx(xn,{href:"/about",className:"text-muted-foreground hover:text-primary transition-colors",children:"About Us"})}),h.jsx("li",{children:h.jsx(xn,{href:"/contact",className:"text-muted-foreground hover:text-primary transition-colors",children:"Contact"})})]})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),h.jsxs("ul",{className:"space-y-2",children:[h.jsx("li",{children:h.jsx(xn,{href:"/privacy",className:"text-muted-foreground hover:text-primary transition-colors",children:"Privacy Policy"})}),h.jsx("li",{children:h.jsx(xn,{href:"/terms",className:"text-muted-foreground hover:text-primary transition-colors",children:"Terms of Service"})}),h.jsx("li",{children:h.jsx("button",{type:"button",onClick:i,className:"text-muted-foreground hover:text-primary transition-colors",children:"Cookie Preferences"})})]})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-4",children:"Follow Us"}),h.jsxs("div",{className:"flex space-x-4",children:[h.jsx("a",{href:"https://x.com/GlassFunding",className:"text-muted-foreground hover:text-primary transition-colors",children:h.jsx(Jf,{className:"h-5 w-5"})}),h.jsx("a",{href:"",className:"text-muted-foreground hover:text-primary transition-colors",children:h.jsx(N2,{className:"h-5 w-5"})}),h.jsx("a",{href:"https://www.instagram.com/glass_funding/",className:"text-muted-foreground hover:text-primary transition-colors",children:h.jsx(ZM,{className:"h-5 w-5"})})]})]})]}),h.jsx("div",{className:"border-t border-border mt-12 pt-8 text-center text-sm text-muted-foreground",children:h.jsxs("p",{children:[" ",new Date().getFullYear()," Glass. All rights reserved."]})})]})})}function Pie(){const{needsConsent:i,showPreferences:n,openPreferences:a,closePreferences:d,acceptAll:y,declineAll:v,savePreferences:C,hasFunctionalConsent:s,hasAnalyticsConsent:M}=w_(),[L,F]=$.useState({functional:s,analytics:M});return $.useEffect(()=>{n&&F({functional:s,analytics:M})},[n,s,M]),!i&&!n?null:h.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50",children:h.jsx("div",{className:"mx-auto mb-6 w-[min(960px,92vw)] rounded-3xl border border-border bg-card/95 p-6 shadow-lg backdrop-blur",children:n?h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"text-base font-semibold text-foreground",children:"Cookie preferences"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose which non-essential features you want to enable. You can update this anytime."})]}),h.jsx("button",{type:"button",onClick:d,className:"text-sm text-muted-foreground transition hover:text-primary",children:"Close"})]}),h.jsxs("div",{className:"grid gap-3",children:[h.jsxs("label",{className:"flex items-start justify-between gap-3 rounded-2xl border border-border bg-background/60 px-4 py-3",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:"Functional"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Saves preferences and drafts on your device so you can resume where you left off."})]}),h.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4",checked:L.functional,onChange:W=>F(X=>({...X,functional:W.target.checked}))})]}),h.jsxs("label",{className:"flex items-start justify-between gap-3 rounded-2xl border border-border bg-background/60 px-4 py-3",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-foreground",children:"Analytics"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Helps us measure lab profile views and improve the directory experience."})]}),h.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4",checked:L.analytics,onChange:W=>F(X=>({...X,analytics:W.target.checked}))})]})]}),h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end",children:[h.jsx("button",{type:"button",onClick:v,className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"Decline non-essential"}),h.jsx("button",{type:"button",onClick:()=>C(L),className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Save preferences"})]})]}):h.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx("h3",{className:"text-base font-semibold text-foreground",children:"We respect your privacy"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"We use cookies and local storage for preferences and draft saving, plus optional analytics to understand lab page usage."})]}),h.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[h.jsx("button",{type:"button",onClick:v,className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-muted-foreground transition hover:border-primary hover:text-primary",children:"Decline non-essential"}),h.jsx("button",{type:"button",onClick:a,className:"rounded-full border border-border px-4 py-2 text-sm font-medium text-foreground transition hover:border-primary hover:text-primary",children:"Manage preferences"}),h.jsx("button",{type:"button",onClick:y,className:"rounded-full bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition hover:bg-primary/90",children:"Accept all"})]})]})})})}function kie(){const[i]=Al();return $.useEffect(()=>{window.scrollTo(0,0)},[i]),null}function Nie({children:i}){const[n]=Al(),[a,d]=$.useState(!1);return $.useEffect(()=>{d(!1);const y=window.requestAnimationFrame(()=>d(!0));return()=>window.cancelAnimationFrame(y)},[n]),$.useEffect(()=>{const y=window.requestAnimationFrame(()=>d(!0));return()=>window.cancelAnimationFrame(y)},[]),h.jsx("div",{className:`page-transition ${a?"page-transition--active":""}`,children:i})}function jie(){return h.jsxs(GU,{children:[h.jsx(gs,{path:"/labs",component:Dne}),h.jsx(gs,{path:"/labs/:id",component:Qne}),h.jsx(gs,{path:"/teams",component:fie}),h.jsx(gs,{path:"/teams/:id",component:pie}),h.jsx(gs,{path:"/labs/:id/request",component:Jne}),h.jsx(o0,{path:"/labs/:id/collaborate",component:eie}),h.jsx(Cie,{path:"/admin/labs",component:rB}),h.jsx(gs,{path:"/lab-profile",component:iie}),h.jsx(Zf,{path:"/account",component:uie}),h.jsx(Zf,{path:"/account/edit",component:hB}),h.jsx(Zf,{path:"/requests",component:fB}),h.jsx(Zf,{path:"/subscriptions",component:Eie}),h.jsx(Zf,{path:"/favorites",component:gB}),h.jsx(o0,{path:"/lab/manage",component:pB}),h.jsx(o0,{path:"/lab/manage/new",component:bie}),h.jsx(o0,{path:"/lab/manage/:id",component:gie}),h.jsx(Zf,{path:"/team/manage",component:mB}),h.jsx(Zf,{path:"/team/manage/new",component:WR}),h.jsx(Zf,{path:"/team/manage/:id",component:WR}),h.jsx(gs,{path:"/payments",component:_ie}),h.jsx(gs,{path:"/stripe",component:Aie}),h.jsx(gs,{path:"/donate",component:XR}),h.jsx(gs,{path:"/donate-confirmation",component:XR}),h.jsx(Zf,{path:"/subscribe",component:UR}),h.jsx(gs,{path:"/logout",component:yie}),h.jsx(gs,{path:"/login",component:Cee}),h.jsx(gs,{path:"/signup",component:Aee}),h.jsx(gs,{path:"/confirm-email",component:jee}),h.jsx(gs,{path:"/forgot-password",component:Pee}),h.jsx(gs,{path:"/forgot-password/confirmation",component:kee}),h.jsx(gs,{path:"/reset-password",component:Nee}),h.jsx(gs,{path:"/",component:$Q}),h.jsx(gs,{path:"/about",component:nee}),h.jsx(gs,{path:"/pricing",component:UR}),h.jsx(gs,{path:"/contact",component:Tee}),h.jsx(gs,{path:"/one-pagers",component:Vne}),h.jsx(gs,{path:"/roadmap",component:qne}),h.jsx(gs,{path:"/status",component:Hne}),h.jsx(gs,{path:"/500",component:Zne}),h.jsx(gs,{path:"/maintenance",component:Xne}),h.jsx(gs,{path:"/terms",component:One}),h.jsx(gs,{path:"/privacy",component:zne}),h.jsx(gs,{path:"/Waitlist",component:Fne}),h.jsx(gs,{component:Eee})]})}function Rie(){return h.jsx(b6,{client:T6,children:h.jsx(Kne,{children:h.jsx(CZ,{children:h.jsx(Ree,{children:h.jsxs(die,{children:[h.jsx(AZ,{}),h.jsx(kie,{}),h.jsx("div",{className:"pt-16",children:h.jsx(Nie,{children:h.jsx(jie,{})})}),h.jsx(Iie,{}),h.jsx(Pie,{}),h.jsx(E8,{})]})})})})})}const Mie=document.getElementById("root");SU.createRoot(Mie).render(h.jsx(Rie,{}));window.requestAnimationFrame(()=>{document.body.classList.add("is-page-loaded")});
